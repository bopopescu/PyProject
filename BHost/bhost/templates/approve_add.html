<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>manager</title>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<link rel="stylesheet" href="/manage/css/style.css">
	<link rel="stylesheet" href="/manage/css/jquery.datepick.css">
	<link rel="stylesheet" href="/manage/css/ui-dialog.css" type="text/css" />
	<link rel="stylesheet" href="/manage/css/new-head.css">
	<link rel="stylesheet" href="/manage/css/G-style.css" type="text/css" />
	<!--script-->
	<script src="/manage/js/jquery.min.js"></script>
	<script src="/manage/js/jquery.easing.js"></script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/layer.js"></script>
	<script type="text/javascript" src="/manage/js/dialog-plus.js"></script>
	<script src="/manage/js/select2.full.min.js"></script>
	<script src="/manage/js/jquery.plugin.js"></script>
	<script src="/manage/js/jquery.datepick.js"></script>
	<script src="/manage/js/icheck.min.js"></script>
	<script src="/manage/js/common_e.js"></script>
	<script src="/manage/js/xSelect.js"></script>
	<script src="/manage/js/md5.js"></script>
	<!--icheck-->
	<!--select2-->
	<style>
		.form-label {
			padding-right: 20px;
			margin-top: -1px;
		}
		.form-li{
			float:right;
			margin-top: 2px;
		}
		#smssvr_suspend .form-item {
			float: left;
		}

		#smtp_suspend .form-item {
			float: left;
		}
	</style>
</head>

<body style="overflow:hidden;display:none;" class="bg-white">
	<div class="rwrap">
		<div class="c-top">
			<div class="c-title">
			
				<div class="manual-head" style="float:left;width:100px">
    				<div class="manual-title" >
       					<span id="approve_strategy" style="cursor: pointer;">审批策略</span>
        				<i class="approve_strategy_icon"></i>
   					</div>
				</div>

				<div class="ctr">
					<a href="javascript:;" class="ret" onclick="parent._closePage(this)"><i></i></a>
				</div>
			</div>
		</div>
		<div class="mainer">
			<!-- 添加 修改模块 -->
			<div class="container" id="add_div">
				<div class="c-cont">
					<div class="c-form" style="padding-bottom:10px;width: 900px;">
						<div class="form">
							<div class="form-item " style="width: 472px;float: left;">
								<span class="form-tag"><em class="imp">*</em>名称：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="ApproveStrategyName" name="ApproveStrategyName" onblur="regCheck(this,nameReg);"
									 maxlength="128"><i class="v-check"></i>
									<p class="form-tip">特殊字符仅支持下划线、横杠、小数点</p>
								</div>
							</div>
							<div class="form-item" style="float: left;width: 301px;">
								<span class="form-tag" style="width: 139px;"><em class="imp">*</em>审批人数：</span>
								<div class="form-c" style="padding-left: 147px;">
									<input edited="0" type="text" class="form-text" id="ApproveNum" name="ApproveNum" maxlength="3" style="width: 28px;float: left;text-align: center;padding-right:8px;padding-left: 8px;"
									 onfocus="this.select()" onkeyup="this.value = this.value.replace(/\D/g,'');$(this).attr('edited',2);">
									<li id="" style="float: left;color: #000;margin-top: 4px;margin-left: 7px;">/</li>
									<li id="admin_num" style="float: left;color: #000;margin-top: 5px;margin-left: 7px;">0</li>
								</div>
							</div>
							<div class="form-item " style="float: left;">
								<span class="form-tag" style=""><em class="imp">*</em>方式：</span>
								<div class="form-c" style="" id="checkbox">
									<label class="form-label" style="">
										<input id="checkbox1" name="checkbox1" class="form-checkbox" type="checkbox" name="">
										<li class="form-li">消息</li>
									</label>
									<!-- <label class="form-label" style="">
										<input id="checkbox2" name="checkbox2" class="form-checkbox" type="checkbox" name="">
										<li class="form-li">短信猫</li>
									</label> -->
									<label class="form-label" style="">
										<input id="checkbox4" name="checkbox4" class="form-checkbox" type="checkbox" name="">
										<li class="form-li">短信</li>
									</label>
									
									<label class="form-label" style="">
										<input id="checkbox8" name="checkbox8" class="form-checkbox" type="checkbox" name="">
										<li class="form-li">邮件</li>
									</label>
									
									<!-- <label class="form-label" style="">
										<input id="checkbox16" name="checkbox16" class="form-checkbox" type="checkbox" name="">
										<li class="form-li">TOKEN</li>
									</label> -->
									
								</div>
							</div>
							<div class="form-item" style="float: left;padding: 10px 0px;width: 400px;display: none;">
								<span class="form-tag form-tag_change" style="">短信默认：</span>
								<div class="form-c form-c_change" style="">
									<div class="xSelect xSelect_phone_m"></div>
								</div>
							</div>
							<div class="form-item" style="float: left;padding: 10px 0px;width: auto;display: none;">
								<span class="form-tag form-tag_change" style="">短信备用：</span>
								<div class="form-c form-c_change" style="">
									<div class="xSelect xSelect_phone_s"></div>
								</div>
							</div>
							<div class="form-item" style="float: left;padding: 10px 0px;width: 400px;display: none;">
								<span class="form-tag form-tag_change" style="">邮件默认：</span>
								<div class="form-c form-c_change" style="">
									<div class="xSelect xSelect_smtp_m"></div>
								</div>
							</div>
							<div class="form-item" style="float: left;padding: 10px 0px;width: auto;display: none;">
								<span class="form-tag form-tag_change" style="">邮件备用：</span>
								<div class="form-c form-c_change" style="">
									<div class="xSelect xSelect_smtp_s"></div>
								</div>
							</div>
						</div>
						<div class="form-item form-item-100" style="    float: left;padding-top: 10px;">
							<span class="form-tag"><em class="imp">*</em>审批者：</span>
							<div class="h-content3" style="width: 605px;padding-left:8px;padding-top: 2px;" name="label_list" id="label_list">
								<div class="item" style="padding-top:0px;width:195px;" id="admin_check" name="admin_check" value="0">
									<select class="filter-select" name="admin_select" id="admin_select" style="width:160px;" onmouseover="this.size='4';" onmouseout="this.size='1';">
										<option value="0" selected>请选择</option>
									</select>
									<i class="ctrl add" style="margin-left: 1px;" onclick="_addadmin(this)"></i>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="btns perm_disabled">
					<a href="javascript:;" class="btn btn-normal btn-submit" onclick="save_data();">保&nbsp;&nbsp;存</a>
					<!--
					<a href="javascript:;" class="btn btn-normal btn-cancel" onclick="cal(0);">取&nbsp;&nbsp;消</a>
					-->
				</div>
				<div id="bBtn" style="position: fixed;z-index:5;">
					<a href="javascript:;" class="btn" style="float: right;" onclick="cal(0);"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
				</div>
			</div>
		</div>
	</div>
	</div>
	<form action="/bhost/approve_strategy" method="POST" name="frm_approve_add" id="frm_approve_add">
		<input type="hidden" name="tasktype" id="tasktype" value="{{tasktype}}" />
		<input type="hidden" name="a" id="a" value="{{a}}" />
		<input type="hidden" name="b" id="b" value="{{b}}" />
		<input type="hidden" name="c" id="c" value="{{c}}" />
		<input type="hidden" name="d" id="d" value="{{d}}" />
		<input type="hidden" name="e" id="e" value="{{e}}" />
		<input type="hidden" name="se" id="se" value="{{se}}" />
		<!-- a=id b=当前显示个数 c=第几页 -->
	</form>
	<!--邮件  -->
	<div class="dialog-cont" id="smtp_suspend" style="display:none;max-height:500px">
		<div class="container" style="margin-top: -10px;">
			<div class="c-cont" style="padding: 0px; height: 281px;">
				<!-- <div class="" style="padding: 0px; height: 281px;"> -->
				<div class="c-form ">
					<div class="form">
						<div class="form-item" style="padding: 10px 0;" id="SmtpConfig_Master" name="SmtpConfig_Master">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>配置名称：</span>
							<div class="form-c">
								<input style="width: 224px;" maxlength="128" type="text" class="form-text" id="SmtpConfigName_Master" name="SmtpConfigName_Master"
								 onblur="regCheck(this,nameReg);">
								<i class="v-check" style=""></i>
								<p class="form-tip" style="padding-left: 84px;">特殊字符仅支持下划线、横杠、小数点</p>
							</div>
						</div>

						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>服务器地址：</span>
							<div class="form-c">
								<input style="padding-right: 8px;" type="text" class="form-text" id="SmtpServer_Master" name="SmtpServer_Master">
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>发送邮箱地址：</span>
							<div class="form-c">
								<input style="padding-right: 8px;" 
								onblur="if($('#Sender_Master').val()==''){$('#Sender_Master').val($('#SenderEmail_Master').val());}"
								maxlength="128" type="text" class="form-text" id="SenderEmail_Master" name="SenderEmail_Master">
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								服务器账号：</span>
							<div class="form-c">
								<input style="padding-right: 8px;" 
								onblur="if($('#Sender_Master').val()==''){$('#Sender_Master').val($('#SenderEmail_Master').val());}"
								maxlength="128" type="text" class="form-text" id="Sender_Master" name="Sender_Master">
							</div>
						</div>

						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">服务器验证：</span>
							<div class="form-c g-radios" id="ServerVerify_Master" name="ServerVerify_Master">
								<label class="form-label" style="line-height: 30px;">
									<input class="form-radio" type="radio" name="b" value="1" id="b1" checked="checked">否</label>
								<label class="form-label" style="line-height: 30px;">
									<input class="form-radio" type="radio" name="b" value="2" id="b2">是
									<input type="password"
										class="form-text" maxlength="64" value="" style="display: none;width: 156px;margin-top: -1px;padding-right: 8px;"
										id="SenderEmailPass_Master" name="SenderEmailPass_Master">
								</label>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>附件大小：</span>
							<div class="form-c">
								<input type="text" maxlength="5" class="form-text" onblur="limitCheck(this);" style="width: 82px;padding-right: 8px;" id="AttachMaxLimit_Master"
								 name="AttachMaxLimit_Master"> M (应用于报表邮件抄送)
							</div>
						</div>

						
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;"><em class="imp">*</em>编码方式：</span>
							<div class="form-c">
								<select name="smtpEnCode" id="smtpEnCode" class="filter-select" style="width: 100px" onchange="">
									<option value="0" selected>UTF-8</option>
									<option value="1">GBK</option>
								</select>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;"><em class="imp">*</em>方式：</span>
							<div class="form-c" style="">
								<select name="smtpFlag" id="smtpFlag" class="filter-select" style="width: 100px" onchange="">
									<option value="2">默认</option>
									<option value="1">备用</option>
									<option value="0">其他</option>
								</select>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="clearfix"></div>
		<div class="btns" style="margin-bottom: -20px;margin-left:-20px;width:840px;">
			<a href="javascript:;" class="btn btn-normal btn-submit perm_1_disabled">保&nbsp;&nbsp;存</a>
			<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
		</div>
	</div>
	<!-- 短信猫 -->
	<div class="dialog-cont" id="smsm_suspend" style="display:none;max-height:500px">
		<div class="container" style="margin-top: -10px;">
			<div class="c-cont" style="padding: 0px; height: 281px;">
				<div class="c-form ">
					<div class="form">
						<div class="form-item" style="padding: 10px 0;" id="SmtpConfig_Master" name="SmtpConfig_Master">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>配置名称：</span>
							<div class="form-c">
								<input style="width: 234px;" type="text" maxlength="128" class="form-text" id="SmsMConfigName" name="SmsMConfigName" onblur="regCheck(this,nameReg);">
								<i class="v-check" style=""></i>
								<p class="form-tip" style="padding-left: 84px;">特殊字符仅支持下划线、横杠、小数点</p>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>短信中心：</span>
							<div class="form-c">
								<input style="width: 100px;" type="text" maxlength="24" class="form-text" id="SmsMSender" name="SmsMSender" onblur="limitCheck(this);NumCheck1(this);">
								<i class="v-check"></i>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>发送限制：</span>
							<div class="form-c">
								每月
								<input style="width: 48px;padding-right: 8px;" maxlength="3" type="text" class="form-text" id="SmsMLimit" name="SmsMLimit"
								 onblur="limitCheck(this);">条(0为不限制)
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;"><em class="imp">*</em>编码方式：</span>
							<div class="form-c">
								<select name="smsmEnCode" id="smsmEnCode" class="filter-select" style="width: 100px" onchange="">
									<option value="0" selected>UTF-8</option>
									<option value="1">GBK</option>
								</select>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;"><em class="imp">*</em>方式：</span>
							<div class="form-c" style="">
								<select name="smsmFlag" id="smsmFlag" class="filter-select" style="width: 100px" onchange="">
									<option value="2">默认</option>
									<option value="1">备用</option>
									<option value="0">其他</option>
								</select>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="clearfix"></div>
		<div class="btns" style="margin-bottom: -20px;margin-left:-20px;width:840px;">
			<a href="javascript:;" class="btn btn-normal btn-submit perm_1_disabled">保&nbsp;&nbsp;存</a>
			<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
		</div>
	</div>
	<!-- 短信网关 -->
	<div class="dialog-cont" id="smssvr_suspend" style="display:none;max-height:500px">
		<div class="container" style="margin-top: -10px;">
			<div class="c-cont" style="padding: 0px; height: 281px;">
				<div class="c-form ">
					<div class="form">
						<div class="form-item" style="padding: 10px 0;" id="SmtpConfig_Master" name="SmtpConfig_Master">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>配置名称：</span>
							<div class="form-c">
								<input style="width: 234px;" type="text" maxlength="128" class="form-text" id="SmsSvrConfigName" name="SmsSvrConfigName"
								 onblur="regCheck(this,nameReg);">
								<i class="v-check" style=""></i>
								<p class="form-tip" style="padding-left: 84px;">特殊字符仅支持下划线、横杠、小数点</p>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>数据库类型：</span>
							<div class="form-c">
								<select name="SmsSvrDBType" id="SmsSvrDBType" class="filter-select" style="width: 100px" onchange="">
									<option value="1">ORACLE</option>
									<option value="2">MSSQL</option>
									<option value="3">MYSQL</option>
									<option value="4">SYBASE</option>
								</select>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;width: 429px;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>服务器地址：</span>
							<div class="form-c">
								<input style="width: 110px;" type="text" class="form-text" id="SmsSvrDBServerIP" name="SmsSvrDBServerIP" onblur="IPCheck(this);">
								<i class="v-check" style="margin-top: 6px;"></i>
							</div>
						</div>

						<div class="form-item" style="padding: 10px 0;width: 123px;">
							<span class="form-tag" style="width: 0;">
								<em class="imp">*</em>端口：</span>
							<div class="form-c" style="padding-left: 50px;">
								<input style="width: 40px;" type="text" maxlength="5" class="form-text" id="SmsSvrDBPort" name="SmsSvrDBPort" onblur="limitCheck(this);NumCheck(this);">
								<i class="v-check" style="margin-top: 6px;"></i>
								<p class="form-tip" style="width: 78px;padding-left: 0px;">0-65535之间</p>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>账号：</span>
							<div class="form-c">
								<input style="width: 234px;" type="text" maxlength="128" class="form-text" id="SmsSvrDBUserName" name="SmsSvrDBUserName"
								 onblur="NameCheck(this);">
								<i class="v-check"></i>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>密码：</span>
							<div class="form-c">
								<input style="width: 248px;padding-right: 8px;" maxlength="64" type="password" class="form-text" onfocus="$(this).val('');"
								 onblur="if($(this).val()==''){$(this).val(smssvrconfig_save.SmsSvrDBPassword_old);}" id="SmsSvrDBPassword" name="SmsSvrDBPassword">
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>数据库：</span>
							<div class="form-c">
								<input style="width: 234px;" type="text" maxlength="128" class="form-text" id="SmsSvrDBDatabase" name="SmsSvrDBDatabase">
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>短信sql语句模板：</span>
							<div class="form-c">
								<input style="width: 234px;" type="text" maxlength="1024" class="form-text" id="SmsSvrDBInsertTemp" name="SmsSvrDBInsertTemp"
								 onblur="temp_check(this);">
								<i class="v-check"></i>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;width: 390px;">
							<span class="form-tag" style="width: 285px;"><em class="imp">*</em>编码方式：</span>
							<div class="form-c">
								<select name="smssvrEnCode" id="smssvrEnCode" class="filter-select" style="width: 100px" onchange="">
									<option value="0" selected>UTF-8</option>
									<option value="1">GBK</option>
								</select>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;width: 160px;">
							<span class="form-tag" style="width: 61px;"><em class="imp">*</em>方式：</span>
							<div class="form-c" style="padding-left: 43px;">
								<select name="smssvrFlag" id="smssvrFlag" class="filter-select" style="width: 100px" onchange="">
									<option value="2">默认</option>
									<option value="1">备用</option>
									<option value="0">其他</option>
								</select>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="clearfix"></div>
		<div class="btns" style="margin-bottom: -20px;margin-left:-20px;width:840px;">
			<a href="javascript:;" class="btn btn-normal btn-submit perm_1_disabled">保&nbsp;&nbsp;存</a>
			<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
		</div>
	</div>
	<script>
		var perm={{perm}};
		var perm_1={{perm_1}};
		if (perm==0) parent.parent.$('#nav-s1 a.active').click();
		else{
			$('.bg-white').show();
			if(perm==1){
				$('.perm_disabled').remove();
			}
			if(perm_1==1){
				$('.perm_1_disabled').remove();
			}
		}
		$('.filter-select').select2();
		$('.form-checkbox,.form-radio').iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		});
	</script>

	<!---->
	<script>
		var all_option_str = [];
		var check_option_str = [];
		
		var smtpconfig_save = {
			"SmtpConfigId": 0,
			"SmtpConfigName": null,
			"SmtpServer": null,
			"DNS": null,
			"Sender": null,
			"SenderEmail": null,
			"AttachMaxLimit": 20,
			"ServerVerify": true,
			"SenderEmailPass": null,
			"Flag": 0,
			"EnCode": 0
		};
		var smssvrconfig_save = {
			"SmsSvrConfigId": 1,
			"SmsSvrConfigName": "短信网关配置1",
			"SmsSvrDBType": 2,
			"SmsSvrDBServerIP": "192.168.0.1",
			"SmsSvrDBPort": 1433,
			"SmsSvrDBUserName": "root",
			"SmsSvrDBPassword": "d106f6959747b5ac",
			"SmsSvrDBPassword_old": null,
			"SmsSvrDBDatabase": "mysql",
			"SmsSvrDBInsertTemp": null,
			"Flag": 0,         //--2-主，1-备，0-其它
			"EnCode": 0
		};
		var numCheck = /\D/;
		var ipcheck_route = /(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;
		var nameCheck = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
		var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
		function IPCheck(obj) {
			var ip = $(obj).val().trim();
			var $i = $(obj).next('i.v-check');
			if (!ipcheck_route.test(ip)) {
				$i.show().attr('class', 'v-check v-wrong');
			} else {
				$i.show().attr('class', 'v-check v-right');
			}
		}
		function NameCheck(obj) {
			var Name = $(obj).val();
			var $i = $(obj).next('i.v-check');
			if (!nameCheck.test(Name)) {
				$i.show().attr('class', 'v-check v-wrong');
			} else {
				$i.show().attr('class', 'v-check v-right');
			}
		}
		function NumCheck(obj) {
			var num = $(obj).val();
			var $i = $(obj).next('i.v-check');
			if (numCheck.test(num) || num == "") {
				$i.show().attr('class', 'v-check v-wrong');
				return false;
			} else {
				if (parseInt(num) > 65534) {
					$i.show().attr('class', 'v-check v-wrong');
					return false;
				}
				if (parseInt(num) < 1) {
					$i.show().attr('class', 'v-check v-wrong');
					return false;
				}
				$i.show().attr('class', 'v-check v-right');
			}
		}
		function NumCheck1(obj) {
			var num = $(obj).val();
			var $i = $(obj).next('i.v-check');
			if (numCheck.test(num) || num == "") {
				$i.show().attr('class', 'v-check v-wrong');
				return false;
			} else {
				$i.show().attr('class', 'v-check v-right');
			}
		}
		function temp_check(obj) {
			var v = $(obj).val();
			var $i = $(obj).next('i.v-check');
			if (v.indexOf("%phone%") === -1 || v.indexOf("%content%") === -1) {
				$i.show().attr('class', 'v-check v-wrong');
			} else {
				$i.show().attr('class', 'v-check v-right');
			}
		}
		function limitCheck(obj) {
			obj.value = obj.value.replace(/\D/g, "");
			var v = obj.value.trim();
		}
		//删除接收人
		function _deladmin(obj) {
			var $c = $(obj).parent();
			var m_i = $(obj).parent().attr('value');
				all_option_str[parseInt(m_i)] = check_option_str[parseInt(m_i)];
				check_option_str[parseInt(m_i)] = null;
				for(var i=(parseInt(m_i)+1);i<all_option_str.length;i++){
					if(all_option_str[i]!=null){
						if($('#admin_select option[value='+i+']').length!=0){
							$('#admin_select option[value='+i+']').before(all_option_str[m_i]);
							break;
						}
					}
				}
				if(i==all_option_str.length){
					$('#admin_select').append(all_option_str[m_i]);
				}
			$c.fadeOut(function () {
				$c.remove();
				edit_admin_num();
				$('#admin_select').trigger('change');
			});
			
		}
		//添加接收人
		function _addadmin(obj) {
			var m_i = $(obj).parent().children('select').find("option:selected").val();
			var text = $(obj).parent().children('select').find("option:selected").text();
			if (m_i == "0") {
				_alert(2, '审批策略', '请选择审批者');
				return false;
			}
			var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + m_i + '" id="' + m_i + '"/>');
			$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + text + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin(this)"></i>');
			$(obj).parent().after($c);
			$(obj).parent().children('select').find('option[value=' + m_i + ']').remove();
			$(obj).parent().children('select').val(0).trigger("change");
			check_option_str[m_i] = all_option_str[m_i];
			all_option_str[m_i] = null;
		}
		var check_value='false false';
		var $focusObj;
		$(function () {
			$('.xSelect').on('click', '.xSelect-show', function () {
				$focusObj = $(this).parents('.xSelect');
			});
			// document.frm_approve_add.se.value=window.parent.document.frm.se.value;
			parent._switchBtn(0);//隐藏按钮
			var tasktype = document.frm_approve_add.tasktype.value;
			//用户列表
			$.ajax({
				url: "/bhost/get_user_list_app",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(),a2:6},
				success: function (result) {
					var userinfo_result = JSON.parse(result);
					if (userinfo_result.Result) {
						var userinfo_data = userinfo_result.info;
						$.each(userinfo_data, function (i, item) {
							var text='';
							if(item.Email!=null && item.Email!=''){
								text+='email';
							}
							if(item.MobilePhone!=null && item.MobilePhone!=''){
								text+='phone';
							}
							$("#admin_select").append("<option value=\"" + item.UserId + "\" index=\"0\" data-text=\""+text+"\">" + item.UserCode + "</option>");
							all_option_str[item.UserId] = "<option value=\"" + item.UserId + "\" index=\"0\" data-text=\""+text+"\">" + item.UserCode + "</option>";
						});
						////console.log(all_option_str);
					}else{
						_alert(1,'审批策略',userinfo_result.ErrMsg);
						return false;
					}
				}
			});
			$('#admin_select').on('change', function () {
				var admin_select = $('#admin_select').val();
				$('#admin_check').attr('value', admin_select);
				if ($('#admin_select').find('option').length == 2 && $('#admin_select option:selected').val() != '0') {
					_addadmin($('#admin_select').siblings('i'));
					$('#admin_check').hide();
				} else if ($('#admin_select').find('option').length == 1 && $('div.item').length>1) {
					$('#admin_check').hide();
				} else {
					$('#admin_check').show();
				}
				edit_admin_num();
			});
			//输入数字
			$("#ApproveNum").bind('keydown', function (e) {
				DigitInput(e);
			});
			$('.g-radios').on('ifChecked', 'input[type=radio]', function () {
				var v = $(this).val();
				if (v == 2 || v == 3) {
					$(this).parents('.g-radios').find('input[type=text],input[type=password]').show();
				} else {
					$(this).parents('.g-radios').find('input[type=text],input[type=password]').hide();
				}
			}).on('ifChecked', 'input[type=checkbox]', function () {
				$(this).parents('label').next('span.forCheck').show();
			}).on('ifUnchecked', 'input[type=checkbox]', function () {
				$(this).parents('label').next('span.forCheck').hide();
			});
			$('#checkbox').on('ifChanged','input',function(e){
				if($('#checkbox4').is(':checked') && !$('#checkbox8').is(':checked')){
					update_xSelect($('.xSelect_phone_m'));
					update_xSelect($('.xSelect_phone_s'));
					$('.xSelect_phone_m').parents('.form-item').show();
					$('.xSelect_phone_s').parents('.form-item').show();
					$('.xSelect_smtp_m').parents('.form-item').hide();
					$('.xSelect_smtp_s').parents('.form-item').hide();
					$('#admin_select').select2('close');
					if(check_value=='true false'){
						return false;
					}
					check_value='true false';
					var admin_select_value=$('#admin_select').val();
					// setTimeout(function(){
						$.each($('#admin_select option[value!=0]'),function(i,item){
							if(item.getAttribute("data-text").indexOf('phone')<0){
								item.remove();
							}
						})
						for(var i in check_option_str){
							if(check_option_str[i]==null){
								continue;
							}
							////////console.log(i+':'+check_option_str[i]);
							if(check_option_str[i].indexOf('data-text="emailphone"')<0 && check_option_str[i].indexOf('data-text="phone"')<0){
								////console.log(check_option_str[i]);
								all_option_str[i]=check_option_str[i];
								// setTimeout(function() {
									$('#'+i).fadeOut(function () {
										$('#'+i).remove();
										edit_admin_num();
									});
									// $('#'+i).remove();
								// }, 10);
								check_option_str[i]=null;
								continue;
							}
						}
						for(var i in all_option_str){
							if(all_option_str[i]==null){
								continue;
							}
							//////////console.log(i+':'+all_option_str[i]);
							if((all_option_str[i].indexOf('data-text="emailphone"')>=0 || all_option_str[i].indexOf('data-text="phone"')>=0) && $('#admin_select option[value='+i+']').length==0){
								for(var j=i+1;j<all_option_str.length;j++){
									if(all_option_str[j]!=null){
										if($('#admin_select option[value='+j+']').length!=0){
											$('#admin_select option[value='+j+']').before(all_option_str[i]);
											break;
										}
									}
								}
								if(j==all_option_str.length){
									$('#admin_select').append(all_option_str[i]);
								}
							}
						}
						if($('#admin_select option[value='+admin_select_value+']').length==0){
							admin_select_value=0;
						}
						$('#admin_select').val(admin_select_value).trigger('change');
					// },1);
					
				}
				else if(!$('#checkbox4').is(':checked') && $('#checkbox8').is(':checked')){
					update_xSelect($('.xSelect_smtp_m'));
					update_xSelect($('.xSelect_smtp_s'));
					$('.xSelect_phone_m').parents('.form-item').hide();
					$('.xSelect_phone_s').parents('.form-item').hide();
					$('.xSelect_smtp_m').parents('.form-item').show();
					$('.xSelect_smtp_s').parents('.form-item').show();
					$('#admin_select').select2('close');
					if(check_value=='false true'){
						return false;
					}
					check_value='false true';
					var admin_select_value=$('#admin_select').val();
					// $('#admin_select').val(0).trigger('change');
					// setTimeout(function(){
						$.each($('#admin_select option[value!=0]'),function(i,item){
							if(item.getAttribute("data-text").indexOf('email')<0){
								item.remove();
							}
						})
						for(var i in check_option_str){
							if(check_option_str[i]==null){
								continue;
							}
							////////console.log(i+':'+check_option_str[i]);
							if(check_option_str[i].indexOf('data-text="emailphone"')<0 && check_option_str[i].indexOf('data-text="email"')<0){
								all_option_str[i]=check_option_str[i];
								// setTimeout(function() {
									$('#'+i).fadeOut(function () {
										$('#'+i).remove();
										edit_admin_num();
									});
									// $('#'+i).remove();
								// }, 10);
								check_option_str[i]=null;
								continue;
							}
						}
						for(var i in all_option_str){
							if(all_option_str[i]==null){
								continue;
							}
							if((all_option_str[i].indexOf('data-text="email"')>=0 || all_option_str[i].indexOf('data-text="emailphone"')>=0) && $('#admin_select option[value='+i+']').length==0){
								for(var j=i+1;j<all_option_str.length;j++){
									if(all_option_str[j]!=null){
										if($('#admin_select option[value='+j+']').length!=0){
											$('#admin_select option[value='+j+']').before(all_option_str[i]);
											break;
										}
									}
								}
								if(j==all_option_str.length){
									$('#admin_select').append(all_option_str[i]);
								}
							}
						}
						if($('#admin_select option[value='+admin_select_value+']').length==0){
							admin_select_value=0;
						}
						$('#admin_select').val(admin_select_value).trigger('change');
					// },1)
					
				}
				else if(!$('#checkbox4').is(':checked') && !$('#checkbox8').is(':checked')){
					$('.xSelect_phone_m').parents('.form-item').hide();
					$('.xSelect_phone_s').parents('.form-item').hide();
					$('.xSelect_smtp_m').parents('.form-item').hide();
					$('.xSelect_smtp_s').parents('.form-item').hide();
					$('#admin_select').select2('close');
					if(check_value=='false false'){
						return false;
					}
					check_value='false false';
					////console.log(all_option_str);
					var admin_select_value=$('#admin_select').val();
					// $('#admin_select').val(0).trigger('change');
					// setTimeout(function(){
						$('#admin_select option[value!=0]').remove();
						for(var i in all_option_str){
							if(all_option_str[i]==null){
								continue;
							}
							$('#admin_select').append(all_option_str[i]);
						}
						$('#admin_select').val(admin_select_value).trigger('change');
					// },1);
					
				}else if($('#checkbox4').is(':checked') && $('#checkbox8').is(':checked')){
					update_xSelect($('.xSelect_phone_m'));
					update_xSelect($('.xSelect_phone_s'));
					update_xSelect($('.xSelect_smtp_m'));
					update_xSelect($('.xSelect_smtp_s'));
					$('.xSelect_phone_m').parents('.form-item').show();
					$('.xSelect_phone_s').parents('.form-item').show();
					$('.xSelect_smtp_m').parents('.form-item').show();
					$('.xSelect_smtp_s').parents('.form-item').show();
					$('#admin_select').select2('close');
					if(check_value=='true true'){
						return false;
					}
					check_value='true true';
					var admin_select_value=$('#admin_select').val();
					// $('#admin_select').val(0).trigger('change');
					// setTimeout(function() {
						$.each($('#admin_select option[value!=0]'),function(i,item){
							if(item.getAttribute("data-text").indexOf('emailphone')<0){
								item.remove();
							}
						})
						for(var i in check_option_str){
							if(check_option_str[i]==null){
								continue;
							}
							////////console.log(i+':'+check_option_str[i]);
							if(check_option_str[i].indexOf('data-text="emailphone"')<0){
								all_option_str[i]=check_option_str[i];
								// setTimeout(function() {
								$('#'+i).fadeOut(function () {
									$('#'+i).remove();
									edit_admin_num();
								});
								// $('#'+i).remove();
								// }, 10);
								check_option_str[i]=null;
								continue;
							}
						}
						for(var i in all_option_str){
							if(all_option_str[i]==null){
								continue;
							}
							////console.log(all_option_str[i].indexOf('data-text="emailphone"'));
							////console.log($('#admin_select option[value='+i+']').length);
							if(all_option_str[i].indexOf('data-text="emailphone"')>=0 && $('#admin_select option[value='+i+']').length==0){
								////console.log("len:"+all_option_str.length);
								for(var j=i-1;j<all_option_str.length;j--){
									if(all_option_str[j]!=null){
										if($('#admin_select option[value='+j+']').length!=0){
											$('#admin_select option[value='+j+']').before(all_option_str[i]);
											break;
										}
									}
									////console.log("j1:"+j);
								}
								////console.log("j:"+j);
								if(j==0){
									$('#admin_select').prepend(all_option_str[i]);
								}
							}
						}
						////console.log("9999999999999999zzzzz")
						if($('#admin_select option[value='+admin_select_value+']').length==0){
							admin_select_value=0;
						}
						$('#admin_select').val(admin_select_value).trigger('change');
					// }, 1);
					
				}
			});
			$('#checkbox1').iCheck('check');
			$('#checkbox1').iCheck('disable');
			//编辑页面
			if (tasktype == "2") {
				var approveId = document.frm_approve_add.a.value;
				$.ajax({
					url: "/bhost/get_approve_list",
					type: "POST",
					async: false,
					data: { a0: $("input[name=se]").val(), a1: approveId },
					success: function (result) {
						var approve_result = JSON.parse(result);
						if (approve_result.Result == true) {
							var approve_data = approve_result.info.data[0];
							$("#ApproveStrategyName").val(approve_data.ApproveStrategyName);
							$("#ApproveStrategyName").attr("disabled", true);
							var ApproveType=parseInt(approve_data.ApproveType.toString(2),2);
							var text=[];
							var num_smssvr=0;
							var num_smtp=0;
							if(ApproveType&1){
								$('#checkbox1').iCheck('check');
							}
							if(ApproveType&2){
								$('#checkbox2').iCheck('check');
								if($.inArray('phone',text)<0){
									text.push('phone');
								}
								if(approve_data.MasterSmsSvrConfigId!=null){
									$('.xSelect_phone_m').data('value',approve_data.MasterSmsSvrConfigId);
									num_smssvr++;
								}
								if(approve_data.StandBySmsSvrConfigId!=null){
									$('.xSelect_phone_s').data('value',approve_data.StandBySmsSvrConfigId);
									num_smssvr++;
								}
							}
							if(ApproveType&8){
								$('#checkbox8').iCheck('check');
								text.push('email');
								if(approve_data.MasterSmtpConfigId!=null){
									$('.xSelect_smtp_m').data('value',approve_data.MasterSmtpConfigId);
									num_smtp++;
								}
								if(approve_data.StandBySmtpConfigId!=null){
									$('.xSelect_smtp_s').data('value',approve_data.StandBySmtpConfigId);
									num_smtp++;
								}
							}
							if(ApproveType&4){
								$('#checkbox4').iCheck('check');
								if($.inArray('phone',text)<0){
									text.push('phone');
								}
								if(approve_data.MasterSmsSvrConfigId!=null){
									$('.xSelect_phone_m').data('value',approve_data.MasterSmsSvrConfigId);
									num_smssvr++;
								}
								if(approve_data.StandBySmsSvrConfigId!=null){
									$('.xSelect_phone_s').data('value',approve_data.StandBySmsSvrConfigId);
									num_smssvr++;
								}
							}
							
							if(ApproveType&16){
								$('#checkbox16').iCheck('check');
							}
							if(num_smssvr!=0){
								update_xSelect($('.xSelect_phone_m'));
								update_xSelect($('.xSelect_phone_s'));
							}
							if(num_smtp!=0){
								update_xSelect($('.xSelect_smtp_m'));
								update_xSelect($('.xSelect_smtp_s'));
							}
							if (approve_data.UserSet != null) {
								// $('#admin_num').text(approve_data.UserSet.length);
								// $.each(approve_data.UserSet, function (i, item) {
								// 	check_option_str[item.UserId] = all_option_str[item.UserId];
								// 	all_option_str[item.UserId] = null;
								// 	var text='';
								// 	if(item.Email!=null && item.Email!=''){
								// 		text+='email';
								// 	}
								// 	if(item.MobilePhone!=null && item.MobilePhone!=''){
								// 		text+='phone';
								// 	}
								// 	var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + item.UserId + '" id="' + item.UserId +'"/>');
								// 	$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + item.UserCode + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin(this)"></i>');
								// 	$("#admin_select").parent().after($c);
								// 	$("#admin_select").find('option[value=' + item.UserId + ']').remove();
								// 	$("#admin_select").trigger('change');
								// });
								//////console.log(approve_data.UserSet.length-1);
								for(var i=0;i<approve_data.UserSet.length-1;i++){
									var item=approve_data.UserSet[i];
									// if (all_option_str[item.UserId]==undefined || all_option_str[item.UserId]==null){
									// 	all_option_str[item.UserId] = "<option value=\"" + item.UserId + "\" index=\"0\" data-text=\""+text.join(' ')+"\">" + item.UserCode + "</option>";
									// }
									check_option_str[item.UserId] = all_option_str[item.UserId];
									all_option_str[item.UserId] = null;
									
									var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + item.UserId + '" id="' + item.UserId +'"/>');
									$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + item.UserCode + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin(this)"></i>');
									$("#admin_select").parent().after($c);
									$("#admin_select").find('option[value=' + item.UserId + ']').remove();
									$("#admin_select").trigger('change');
								}
								////console.log(all_option_str[approve_data.UserSet[i].UserId]);
								////console.log(approve_data.UserSet[i]);
								if(all_option_str[approve_data.UserSet[i].UserId].indexOf('data-text="'+text.join('')+'"')<0 || (all_option_str[approve_data.UserSet[i].UserId]==undefined || all_option_str[approve_data.UserSet[i].UserId]==null)){
									var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + approve_data.UserSet[i].UserId + '" id="' + approve_data.UserSet[i].UserId +'"/>');
									$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + approve_data.UserSet[i].UserCode + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin(this)"></i>');
									$("#admin_select").parent().after($c);
									$("#admin_select").find('option[value=' + approve_data.UserSet[i].UserId + ']').remove();
									check_option_str[approve_data.UserSet[i].UserId] = all_option_str[approve_data.UserSet[i].UserId];
									all_option_str[approve_data.UserSet[i].UserId] = null;
									$("#admin_select").trigger('change');
								}else{
									$("#admin_select").val(approve_data.UserSet[i].UserId).trigger('change');
								}
							}
							$("#ApproveNum").val(approve_data.ApproveNum);
							$('#ApproveNum').attr('edited',1);
							ApproveNum_old=approve_data.ApproveNum;
							all_check_old=approve_data.UserSet.length;
						}else{
							_alert(1,'审批策略',approve_result.ErrMsg);
							return false;
						}

					}
				});
			}
		});
		var ApproveNum_old=0;
		var all_check_old=0;
		function update_xSelect($obj){
			var id_value=$obj.data('value');
			var text_value=$('.xSelect-show-text',$obj).text();
			var id=$('.xSelect-show',$obj).data('id');
			$obj.empty().data('xSelect','');
			$('.'+id).remove();
			////console.log('id_value');
			////console.log(id_value);
			if(id_value==undefined){
				////console.log('id_value==undefined');
				id_value=0;
				text_value='全局指定'
				////console.log(id_value+':'+text_value);
			}
			switch ($obj.attr('class').split(' ')[1]) {
				case 'xSelect_phone_m':
					$.ajax({
						url: "/bhost/get_smssvrconfig",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val() },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								ftpconfig_data_all=result.info.data;
								var data = result.info;
								ftpserver = new Array();
								ftpserver[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
								$.each(data.data, function (i, item) {
									if(item.SmsSvrConfigId==0){
										return true;
									}else if(id_value==item.SmsSvrConfigId){
										text_value=item.SmsSvrConfigName;
									}
									ftpserver[item.SmsSvrConfigId] =(JSON.parse('{"value":'+item.SmsSvrConfigId+',"name":"'+item.SmsSvrConfigName+'","type":"'+(perm_1==2?'edit':'check')+'"}'));
								})
							} else {
								_alert(1, '短信网关查询', result.ErrMsg);
								return false;
							}
						}
					});
					var ftpserver1=ftpserver;
					////console.log(ftpserver1);
					var ftp2_id=$('.xSelect_phone_s').data('value');
					////console.log(ftp2_id);
					if(ftp2_id!=undefined &&  ftp2_id!='' && ftp2_id>0){
						// ftpserver1.splice(parseInt(ftp2_id),1);
						delete ftpserver1[ftp2_id];
					}
					// for(i in ftpserver1){
					// 	if(ftpserver1[i]==null){
					// 		delete ftpserver1[i];
					// 	}
					// }
					xSelect_json={
						num:'1',
						width: 168,
						defaultText: '全局指定',
						items:ftpserver1,
						edit: function(item,obj){
							$('.'+$('.xSelect_phone_m .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 3);
						},
						check: function(item,obj){
							$('.'+$('.xSelect_phone_m .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 3);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
							update_xSelect($('.xSelect_phone_s'));
						}
					};
					if(perm_1==2){
						xSelect_json.num='2';
						xSelect_json.btn.push({
								'name':'新增',
								'event': function(items,obj){
									get_dialog(items, 2, 3);
								}
							});
					}
					$obj.xSelect(xSelect_json);
					break;
				case 'xSelect_phone_s':
					$.ajax({
						url: "/bhost/get_smssvrconfig",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val() },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								ftpconfig_data_all=result.info.data;
								var data = result.info;
								ftpserver = new Array();
								ftpserver[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
								$.each(data.data, function (i, item) {
									if(item.SmsSvrConfigId==0){
										return true;
									}else if(id_value==item.SmsSvrConfigId){
										text_value=item.SmsSvrConfigName;
									}
									ftpserver[item.SmsSvrConfigId] =(JSON.parse('{"value":'+item.SmsSvrConfigId+',"name":"'+item.SmsSvrConfigName+'","type":"'+(perm_1==2?'edit':'check')+'"}'));
								})
							} else {
								_alert(1, '短信网关查询', result.ErrMsg);
								return false;
							}
						}
					});
					var ftpserver2=ftpserver;
					var ftp1_id=$('.xSelect_phone_m').data('value');
					if(ftp1_id!=undefined && ftp1_id!='' && ftp1_id>0){
						delete ftpserver2[ftp1_id];
						// ftpserver2.splice(parseInt(ftp1_id),1);
					}
					// for(i in ftpserver2){
					// 	if(ftpserver2[i]==null){
					// 		delete ftpserver2[i];
					// 	}
					// }
					xSelect_json={
						num:'1',
						width: 168,
						defaultText: '全局指定',
						items:ftpserver2,
						edit: function(item,obj){
							$('.'+$('.xSelect_phone_s .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 3);
						},
						check: function(item,obj){
							$('.'+$('.xSelect_phone_s .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 3);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
							update_xSelect($('.xSelect_phone_m'));
						}
					};
					if(perm_1==2){
						xSelect_json.num='2';
						xSelect_json.btn.push({
								'name':'新增',
								'event': function(item,obj){
									get_dialog(item, 2, 3);
								}
							});
					}
					$obj.xSelect(xSelect_json);
					break;
				case 'xSelect_smtp_m':
					$.ajax({
						url: "/bhost/get_smtpconfig",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val() },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								var data = result.info;
								smtpconfig_data_all=result.info.data;
								smtpconfig=new Array();
								smtpconfig[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
								$.each(data.data, function (i, item) {
									if(item.SmtpConfigId==0){
										return true;
									}else if(id_value==item.SmtpConfigId){
										text_value=item.SmtpConfigName;
									}
									smtpconfig[item.SmtpConfigId]=(JSON.parse('{"value":'+item.SmtpConfigId+',"name":"'+item.SmtpConfigName+'","type":"'+(perm_1==2?'edit':'check')+'"}'));
								})
							} else {
								_alert(1, '邮件服务器查询', result.ErrMsg);
								return false;
							}
						}
					});
					var smtpconfig1=smtpconfig;
					var stmp2_id=$('.xSelect_smtp_s').data('value');
					if (stmp2_id!=undefined && stmp2_id!='' && stmp2_id>0) {
						delete smtpconfig1[stmp2_id];
						// smtpconfig1.splice(parseInt(stmp2_id),1);
					}
					// for(i in smtpconfig1){
					// 	if(smtpconfig1[i]==null){
					// 		delete smtpconfig1[i];
					// 	}
					// }
					xSelect_json={
						num:'1',
						width: 168,
						defaultText: '全局指定',
						items:smtpconfig1,
						edit: function(item,obj){
							$('.'+$('.xSelect_smtp_m .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 1);
						},
						check: function(item,obj){
							$('.'+$('.xSelect_smtp_m .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 1);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
							update_xSelect($('.xSelect_smtp_s'));
						}
					};
					if(perm_1==2){
						xSelect_json.num='2';
						xSelect_json.btn.push({
								'name':'新增',
								'event': function(items,obj){
									get_dialog(items, 2, 1);
								}
							});
					}
					$obj.xSelect(xSelect_json);
					break;
				case 'xSelect_smtp_s':
					$.ajax({
						url: "/bhost/get_smtpconfig",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val() },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								var data = result.info;
								smtpconfig_data_all=result.info.data;
								smtpconfig=new Array();
								smtpconfig[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
								$.each(data.data, function (i, item) {
									if(item.SmtpConfigId==0){
										return true;
									}else if(id_value==item.SmtpConfigId){
										text_value=item.SmtpConfigName;
									}
									smtpconfig[item.SmtpConfigId]=(JSON.parse('{"value":'+item.SmtpConfigId+',"name":"'+item.SmtpConfigName+'","type":"'+(perm_1==2?'edit':'check')+'"}'));
								})
							} else {
								_alert(1, '邮件服务器查询', result.ErrMsg);
								return false;
							}
						}
					});
					var smtpconfig2=smtpconfig;
					var smtp1_id=$('.xSelect_smtp_m').data('value');
					if(smtp1_id!=undefined && smtp1_id!='' && smtp1_id>0){
						delete smtpconfig2[smtp1_id];
						// smtpconfig2.splice(smtp1_id,1);
					}
					// for(i in smtpconfig2){
					// 	if(smtpconfig2[i]==null){
					// 	}
					// }
					xSelect_json={
						num:'1',
						width: 168,
						defaultText: '全局指定',
						items:smtpconfig2,
						edit: function(item,obj){
							$('.'+$('.xSelect_smtp_s .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 1);
						},
						check: function(item,obj){
							$('.'+$('.xSelect_smtp_s .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 1);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
							update_xSelect($('.xSelect_smtp_m'));
						}
					};
					if(perm_1==2){
						xSelect_json.num='2';
						xSelect_json.btn.push({
								'name':'新增',
								'event': function(items,obj){
									get_dialog(items, 2, 1);
								}
							});
					}
					$obj.xSelect(xSelect_json);
					break;
			}
			$obj.data('value',id_value);
			$('.xSelect-show-text',$obj).text(text_value);
		}
		function smtp_clear() {
			$('#smtp_suspend i.v-check').attr('class', 'v-check');
			$('#SmtpConfigName_Master').attr("disabled", false);
			$('#SmtpConfigName_Master').val('');
			$('#SmtpConfigName_Master').next('i.v-check').attr('class', 'v-check');
			$('#SmtpServer_Master').val('');
			$('#Sender_Master').val('');
			$('#SenderEmail_Master').val('');
			$('#AttachMaxLimit_Master').val('');
			$('#b1').iCheck('check');
			$('#SenderEmailPass_Master').val('');
			$('#test_Master').iCheck('uncheck');
			$('#test_Master').parents('label').next('span.forCheck').hide();
			$('#test_Master_input').val('');
			$('#DNS_Master').val('');
			$('#smtpEnCode').val(0).trigger('change');
			var smtpconfig_data_all_Flag = smtpconfig_data_all.map(function (params) {
				return params.Flag;
			});
			if ($.inArray(2, smtpconfig_data_all_Flag) < 0) {
				$('#smtpFlag').val(2).trigger('change');
			} else if ($.inArray(1, smtpconfig_data_all_Flag) < 0) {
				$('#smtpFlag').val(1).trigger('change');
			} else {
				$('#smtpFlag').val(0).trigger('change');
			}
		}
		function smssvr_clear() {
			$('#smssvr_suspend i.v-check').attr('class', 'v-check');
			$('#SmsSvrConfigName').val('');
			$('#SmsSvrConfigName').attr("disabled", false);
			$('#SmsSvrDBType').val(1).trigger('change');
			$('#SmsSvrDBServerIP').val('');
			$('#SmsSvrDBPort').val('');
			$('#SmsSvrDBUserName').val('');
			$('#SmsSvrDBPassword').val('');
			$('#SmsSvrDBDatabase').val('');
			$('#SmsSvrDBInsertTemp').val('');
			$('#smssvrEnCode').val(0).trigger('change');
			var smtpconfig_data_all_Flag = ftpconfig_data_all.map(function (params) {
				return params.Flag;
			});
			if ($.inArray(2, smtpconfig_data_all_Flag) < 0) {
				$('#smssvrFlag').val(2).trigger('change');
			} else if ($.inArray(1, smtpconfig_data_all_Flag) < 0) {
				$('#smssvrFlag').val(1).trigger('change');
			} else {
				$('#smssvrFlag').val(0).trigger('change');
			}
		}
		function smtp_input(data) {
			smtpconfig_save.SmtpConfigId = data.SmtpConfigId;
			$('#SmtpConfigName_Master').val(data.SmtpConfigName);
			$('#SmtpConfigName_Master').attr("disabled", true);
			$('#SmtpServer_Master').val(data.SmtpServer);
			$('#Sender_Master').val(data.Sender);
			$('#SenderEmail_Master').val(data.SenderEmail);
			$('#AttachMaxLimit_Master').val(data.AttachMaxLimit);
			if (data.ServerVerify) {
				$('#b2').iCheck('check');
				$('#SenderEmailPass_Master').val(data.SenderEmailPass);
				smtpconfig_save.SenderEmailPass = data.SenderEmailPass;
			} else {
				$('#b1').iCheck('check');
			}
			$('#DNS_Master').val(data.DNS);
			$('#test_Master').iCheck('uncheck');
			$('#test_Master').parents('label').next('span.forCheck').hide();
			$('#test_Master_input').val('');
			$('#smtpEnCode').val(data.EnCode).trigger('change');
			$('#smtpFlag').val(data.Flag).trigger('change');
		}
		function smssvr_input(data) {
			smssvrconfig_save.SmsSvrConfigId = data.SmsSvrConfigId;
			$('#SmsSvrConfigName').val(data.SmsSvrConfigName);
			$('#SmsSvrConfigName').attr("disabled", true);
			$('#SmsSvrDBType').val(data.SmsSvrDBType).trigger('change');
			$('#SmsSvrDBServerIP').val(data.SmsSvrDBServerIP);
			$('#SmsSvrDBPort').val(data.SmsSvrDBPort);
			$('#SmsSvrDBUserName').val(data.SmsSvrDBUserName);
			$('#SmsSvrDBPassword').val(data.SmsSvrDBPassword);
			$('#SmsSvrDBDatabase').val(data.SmsSvrDBDatabase);
			$('#SmsSvrDBInsertTemp').val(data.SmsSvrDBInsertTemp);
			$('#smssvrEnCode').val(data.EnCode).trigger('change');
			$('#smssvrFlag').val(data.Flag).trigger('change');
			smssvrconfig_save.SmsSvrDBPassword_old = data.SmsSvrDBPassword;
		}
		function get_dialog(obj, type, num) {
			var title;
			var ajax_url;
			var dialogCont_id;
			switch (num) {
				case 1:
					smtp_clear();
					title = '邮件配置';
					ajax_url = 'smtpconfig';
					dialogCont_id = 'smtp_suspend';
					smtpconfig_save.SmtpConfigId = 0;
					smtpconfig_save.SenderEmailPass = null;
					break;
				// case 2:
				// 	smsm_clear();
				// 	title = '短信猫配置';
				// 	ajax_url = 'smsmconfig';
				// 	dialogCont_id = 'smsm_suspend';
				// 	smsmconfig_save.SmsMConfigId = 0;
				// 	break;
				case 3:
					smssvr_clear();
					title = '短信网关配置';
					ajax_url = 'smssvrconfig';
					dialogCont_id = 'smssvr_suspend';
					smssvrconfig_save.SmsSvrConfigId = 0;
					smssvrconfig_save.SmsSvrDBPassword_old = null;
					break;
				// case 4:
				// 	snmp_clear();
				// 	title = 'SNMP配置';
				// 	ajax_url = 'snmpconfig';
				// 	dialogCont_id = 'snmp_suspend';
				// 	snmpconfig_save.SnmpConfigId = 0;
				// 	break;
				// case 5:
				// 	syslog_clear();
				// 	title = 'SYSLOG配置';
				// 	ajax_url = 'syslogconfig';
				// 	dialogCont_id = 'syslog_suspend';
				// 	syslogconfig_save.SyslogConfigId = 0;
				// 	break;
			}
			// var title_d;
			if (type == 1) {
				var id = obj.value;
				// title_d = "编辑" + title;
				$.ajax({
					url: "/bhost/get_" + ajax_url,
					type: "POST",
					async: false,
					data: { a0: $("input[name=se]").val(), a1: id },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							var data = result.info.data[0];
							switch (num) {
								case 1:
									smtp_input(data);
									break;
								// case 2:
								// 	smsm_input(data);
								// 	break;
								case 3:
									smssvr_input(data);

									break;
								// case 4:
								// 	snmp_input(data);
								// 	break;
								// case 5:
								// 	syslog_input(data);
								// 	break;
							}
						} else {
							_alert(1, title, result.ErrMsg);
							return false;
						}
					}
				});

			} else {
				// title_d = "创建" + title;
			}
			var $dialogCont = $("#" + dialogCont_id).show();

			var d = dialog({
				title: title,
				content: $dialogCont,
				id: dialogCont_id,
				width: "800px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				switch (num) {
					case 1:
						smtp_clear();
						break;
					// case 2:
					// 	smsm_clear();
					// 	break;
					case 3:
						smssvr_clear();
						break;
					// case 4:
					// 	snmp_clear();
					// 	break;
					// case 5:
					// 	syslog_clear();
					// 	break;
				}
				if (type == 1) {
					var id = obj.value;
					$.ajax({
						url: "/bhost/get_" + ajax_url,
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val(), a1: id },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								var data = result.info.data[0];
								switch (num) {
									case 1:
										smtp_input(data);
										break;
									// case 2:
									// 	smsm_input(data);
									// 	break;
									case 3:
										smssvr_input(data);
										break;
									// case 4:
									// 	snmp_input(data);
									// 	break;
									// case 5:

									// 	syslog_input(data);
									// 	break;
								}
							} else {
								_alert(1, title, result.ErrMsg);
								return false;
							}
						}
					});
				} else {
				}
			});

			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				var pass = false;
				switch (num) {
					case 1:
						if (save_smtp_date()) {
							pass = save_smtpconfig();
						}
						break;
					// case 2:
					// 	if (save_smsm_date()) {
					// 		pass = save_smsmconfig();
					// 	}
					// 	break;
					case 3:
						if (save_smssvr_date()) {
							pass = save_smssvrconfig();
						}

						break;
					// case 4:

					// 	if (save_snmp_date()) {
					// 		pass = save_snmpconfig();
					// 	}
					// 	break;
					// case 5:
					// 	if (save_syslog_date()) {
					// 		pass = save_syslogconfig();
					// 	}
					// 	break;
				}
				if (pass) {
					$('.btn').blur(); parent.layer.open({
						type: 1,
						title: title,
						content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						yes: function (i) {
							parent.layer.close(i);
							d.close().remove();
						}
					});
				}
			})
		}
		var ipReg = /(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;
		var hostcheck1=/^(https?:\/\/)?(w{3}\.)?([a-zA-Z0-9-_.])+\.(com|cn|gov|info|us|hk|tw|cc|tv|uk|org)$/;
		var hostcheck2=/^(https?:\/\/)?((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$/;		
		var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
		var ipReg = /(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;
		var phonecheck = /^[0-9]{11}$/;
		var emailcheck = /^([a-zA-Z0-9_\.\-])+@(([a-zA-Z0-9_\-])+\.)+([a-zA-Z0-9])+$/;
		var urlReg = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
		function save_smtp_date() {
			var SmtpConfigName_Master = $("#SmtpConfigName_Master").val();
			if (SmtpConfigName_Master == '') {
				_alert(2, '邮件配置', '请输入名称', $('#SmtpConfigName_Master'));
				return false;
			} else if (!nameReg.test(SmtpConfigName_Master)) {
				_alert(1, '邮件配置', '名称格式不正确', $('#SmtpConfigName_Master'));
				return false;
			}
			var SmtpServer = $('#SmtpServer_Master').val();
			var DNS = $('#DNS_Master').val();
			if (SmtpServer == "") {
				_alert(2, '邮件配置', '请输入服务器地址', $('#SmtpServer_Master'));
				return false;
			} else if (!ipReg.test(SmtpServer) && (!hostcheck1.test(SmtpServer)) && (!hostcheck2.test(SmtpServer))) {
				_alert(1, '邮件配置', '服务器地址格式不正确', $('#SmtpServer_Master'));
				return false;
			}
			if (DNS == "") {
				DNS = null;
			}
			var Sender = $('#Sender_Master').val();
			if (Sender == "") {
				_alert(2, '邮件配置', '请输入服务器账号', $('#Sender_Master'));
				return false;
			}
			var SenderEmail = $('#SenderEmail_Master').val();
			if (SenderEmail == "") {
				_alert(2, '邮件配置', '请输入发送邮箱地址', $('#SenderEmail_Master'));
				return false;
			} else if (!urlReg.test(SenderEmail)) {
				_alert(1, '邮件配置', '发送邮箱地址格式不正确', $('#SenderEmail_Master'));
				return false;
			}
			var AttachMaxLimit = $('#AttachMaxLimit_Master').val();
			if (AttachMaxLimit == "") {
				_alert(2, '邮件配置', '请输入附件大小', $('#AttachMaxLimit_Master'));
				return false;
			}
			var ServerVerify = ($('#ServerVerify_Master').find('input[type=radio]:checked').val() == '2');
			var SenderEmailPass = "";
			if (ServerVerify) {
				SenderEmailPass = $('#SenderEmailPass_Master').val();
				if (SenderEmailPass == "") {
					_alert(2, '邮件配置', '请输入验证码', $('#SenderEmailPass_Master'));
					return false;
				}
			} else {
				SenderEmailPass = null;
			}
			smtpconfig_save.SmtpConfigName = SmtpConfigName_Master;
			smtpconfig_save.SmtpServer = SmtpServer;
			smtpconfig_save.DNS = DNS;
			smtpconfig_save.Sender = Sender;
			smtpconfig_save.SenderEmail = SenderEmail;
			smtpconfig_save.AttachMaxLimit = AttachMaxLimit;
			smtpconfig_save.ServerVerify = ServerVerify;
			smtpconfig_save.SenderEmailPass = SenderEmailPass;
			smtpconfig_save.EnCode = parseInt($('#smtpEnCode').val());
			smtpconfig_save.Flag = parseInt($('#smtpFlag').val());
			return true;
		}
		function save_smssvr_date() {
			var SmsSvrConfigName = $("#SmsSvrConfigName").val();
			var SmsSvrDBType = $("#SmsSvrDBType").val();
			var SmsSvrDBServerIP = $("#SmsSvrDBServerIP").val();
			var SmsSvrDBPort = $("#SmsSvrDBPort").val();
			var SmsSvrDBUserName = $("#SmsSvrDBUserName").val();
			var SmsSvrDBPassword = $("#SmsSvrDBPassword").val();
			var SmsSvrDBDatabase = $("#SmsSvrDBDatabase").val();
			var SmsSvrDBInsertTemp = $("#SmsSvrDBInsertTemp").val();
			if (SmsSvrConfigName == "") {
				_alert(2, "短信网关", "请输入名称", $("#SmsSvrConfigName"));
				return false;
			} else {
				if (!nameCheck.test(SmsSvrConfigName)) {
					_alert(1, "短信网关", "名称格式不正确", $("#SmsSvrConfigName"));
					return false;
				}
			}
			if (SmsSvrDBServerIP == "") {
				_alert(2, "短信网关", "请输入服务器地址", $("#SmsSvrDBServerIP"));
				return false;
			} else {
				if (!ipcheck_route.test(SmsSvrDBServerIP)) {
					_alert(1, "短信网关", "服务器地址格式不正确", $("#SmsSvrDBServerIP"));
					return false;
				}
			}
			if (SmsSvrDBPort == "") {
				_alert(2, "短信网关", "请输入端口", $("#SmsSvrDBPort"));
				return false;
			} else {
				if (numCheck.test(parseInt(SmsSvrDBPort))) {
					_alert(1, "短信网关", "端口格式不正确", $("#SmsSvrDBPort"));
					return false;
				}
				if (parseInt(SmsSvrDBPort) > 65534) {
					_alert(1, "短信网关", "端口不能大于65534", $("#SmsSvrDBPort"));
					return false;
				}
				if (parseInt(SmsSvrDBPort) < 1) {
					_alert(1, "短信网关", "端口不能小于1", $("#SmsSvrDBPort"));
					return false;
				}
			}
			if (SmsSvrDBUserName == "") {
				_alert(2, "短信网关", "请输入账号", $("#SmsSvrDBUserName"));
				return false;
			} else {
				if (!nameCheck.test(SmsSvrDBUserName)) {
					_alert(1, "短信网关", "账号格式不正确", $("#SmsSvrDBUserName"));
					return false;
				}
			}
			if (SmsSvrDBPassword == "") {
				_alert(2, "短信网关", "请输入密码", $("#SmsSvrDBPassword"));
				return false;
			}
			if (SmsSvrDBDatabase == "") {
				_alert(2, "短信网关", "请输入数据库", $("#SmsSvrDBDatabase"));
				return false;
			}
			if (SmsSvrDBInsertTemp == "") {
				_alert(2, "短信网关", "请输入短信sql语句模板", $("#SmsSvrDBInsertTemp"));
				return false;
			} else {
				if (SmsSvrDBInsertTemp.indexOf("%phone%") === -1 || SmsSvrDBInsertTemp.indexOf("%content%") === -1) {
					_alert(1, "短信网关", "模板格式不正确", $("#SmsSvrDBInsertTemp"));
					return false;
				}
			}
			smssvrconfig_save.SmsSvrConfigName = SmsSvrConfigName;
			smssvrconfig_save.SmsSvrDBType = SmsSvrDBType;
			smssvrconfig_save.SmsSvrDBServerIP = SmsSvrDBServerIP;
			smssvrconfig_save.SmsSvrDBPort = parseInt(SmsSvrDBPort);
			smssvrconfig_save.SmsSvrDBUserName = SmsSvrDBUserName;
			smssvrconfig_save.SmsSvrDBPassword = SmsSvrDBPassword;
			smssvrconfig_save.SmsSvrDBDatabase = SmsSvrDBDatabase;
			smssvrconfig_save.SmsSvrDBInsertTemp = SmsSvrDBInsertTemp;
			smssvrconfig_save.Flag = parseInt($("#smssvrFlag").val());
			smssvrconfig_save.EnCode = parseInt($("#smssvrEnCode").val());
			return true;
		}
		function save_smtpconfig() {
			var pass = true;
			if (smtpconfig_save == null) {
				return false;
			}
			msstr = aceg(JSON.stringify(smtpconfig_save),$("input[name=se]").val());
			$.ajax({
				url: "/bhost/add_smtpconfig",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a1: JSON.stringify(smtpconfig_save),a2:'运维管理>审批策略',m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						//刷新下拉
						var focusObj_value = $focusObj.data('value');
						if (focusObj_value == 0) {
							$focusObj.data('value',result.SmtpConfigId);
						}
						update_xSelect($('.xSelect_smtp_m'));
						update_xSelect($('.xSelect_smtp_s'));
					} else {
						if (result.ErrMsg == "同名邮件服务器配置已存在") {
							_alert(2, "邮件配置", result.ErrMsg, $('#SmtpConfigName_Master'));
						} else {
							_alert(2, "邮件配置", result.ErrMsg);
						}
						pass = false;
					}
				}
			});
			return pass;
		}
		function save_smssvrconfig() {
			var pass = true;
			if (smssvrconfig_save == null) {
				return false;
			}
			var msstr = aceg(JSON.stringify(smssvrconfig_save),$('input[name=se]').val());
			$.ajax({
				url: "/bhost/add_smssvrconfig",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a1: JSON.stringify(smssvrconfig_save),a10:'运维管理>审批策略' ,m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						//刷新下拉
						var focusObj_value = $focusObj.data('value');
						if (focusObj_value == 0) {
							$focusObj.data('value',result.SmsSvrConfigId);
						}
						update_xSelect($('.xSelect_phone_m'));
						update_xSelect($('.xSelect_phone_s'));
					} else {
						if (result.ErrMsg == "同名短信网关服务配置已存在") {
							_alert(2, "短信网关", result.ErrMsg, $('#SmtpConfigName_Master'));
						} else {
							_alert(2, "短信网关", result.ErrMsg);
						}
						pass = false;
					}
				}
			});
			return pass;
		}
		function edit_admin_num() {
			$('#label_list').find('div[value!=0]:hidden').remove();
			var len = $('#label_list').find('div[value!=0]').length;
			$('#admin_num').text(len);
			var ApproveNum_count=$('#ApproveNum').val();
			var edited=$('#ApproveNum').attr('edited');
			////console.log(all_check_old);
			////console.log(ApproveNum_old);
			if(len==0){
				all_check_old=0;
				ApproveNum_old=0;
			}
			if(edited=='0'){
				$('#ApproveNum').val(len);
			}
			else if(edited=='1'){ 
				if(ApproveNum_count!='' && ApproveNum_count!='0'){	
					ApproveNum_count=parseInt(ApproveNum_count);
					if(ApproveNum_count>len){
						$('#ApproveNum').val(len);
						//$('#ApproveNum').attr('edited',0);
					}	
				}
				/*
				var num_right=len-(all_check_old-ApproveNum_old);
				if(num_right<0){
					num_right=0;
					all_check_old--;
				}
				////console.log(num_right);
				if(ApproveNum_count!='' && ApproveNum_count!='0'){
					ApproveNum_count=parseInt(ApproveNum_count);
					if(ApproveNum_count>len){
						all_check_old=0;
						ApproveNum_old=0;
						$('#ApproveNum').val(len);
					}else{
						// if((len-num_right)<0){
							// $('#ApproveNum').val(0);
						// }else{
							$('#ApproveNum').val(num_right);
						// }
					}
				}else{
					// if((len-num_right)<0){
					// 	$('#ApproveNum').val(0);
					// }else{
						$('#ApproveNum').val(num_right);
					// }
				}
				*/
			}
		}
		function cal(num,id) {
			if(num==1){
				$.ajax({
					url: '/bhost/PGetRecordRownum',
					type: "POST",
					async: false,
					data: { a0: $("input[name=se]").val(), a1: id,a2:5 },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result == true) {
							if(result.info%MAX_PAGE==0){
								document.frm_approve_add.c.value=parseInt(result.info/MAX_PAGE);
							}else{
								document.frm_approve_add.c.value=parseInt(result.info/MAX_PAGE)+1;
							}
						}
					}
				});
				document.frm_approve_add.d.value = '';
				document.frm_approve_add.e.value = ':';
			}
			document.frm_approve_add.tasktype.value = 1;
			document.frm_approve_add.action = '/bhost/approve_strategy'
			document.frm_approve_add.submit();
		}
		function save_data() {
			var approve_item = {
				"ApproveStrategyId": 0,
				"ApproveStrategyName": "",
				"ApproveNum": 0,
				"ApproveType": 0,   
				"UserSet": [],
				"MasterSmsMConfigId": null,
				"MasterSmsMConfig": null,
				"StandBySmsMConfigId": null,
				"StandBySmsMConfig": null,
				"MasterSmsSvrConfigId": null,
				"MasterSmsSvrConfig": null,
				"StandBySmsSvrConfigId": null,
				"StandBySmsSvrConfig": null,
				"MasterSmtpConfigId": null,
				"MasterSmtpConfig": null,
				"StandBySmtpConfigId": null,
				"StandBySmtpConfig": null
			}
			var val = $("#ApproveStrategyName").val();
			//审批策略名
			if (val == "") {
				_alert(2, "审批策略", '请输入名称', $("#ApproveStrategyName"));
				//$("#d_n").val("");
				return false;
			}
			if (!nameReg.test(val)) {
				_alert(1, "审批策略", '名称格式不正确', $("#ApproveStrategyName"));
				//$("#d_n").val("");
				return false;
			}
			var ApproveNum = $('#ApproveNum').val();
			if (ApproveNum == "") {
				_alert(2, "审批策略", '请输入审批人数', $("#ApproveNum"));
				//$("#d_n").val("");
				return false;
			}
			var numReg = /^[0-9]+$/;
			if (!numReg.test(ApproveNum)) {
				_alert(1, "审批策略", '审批人数格式不正确', $("#ApproveNum"));
				//$("#d_n").val("");
				return false;
			}
			ApproveNum = parseInt(ApproveNum);
			if (ApproveNum == 0) {
				_alert(1, "审批策略", '审批人数不能为0', $("#ApproveNum"));
				//$("#d_n").val("");
				return false;
			}
			if($('#checkbox1').is(':checked')){
				approve_item.ApproveType+=1;
			}
			if($('#checkbox2').is(':checked')){
				approve_item.ApproveType+=2;
			}
			if($('#checkbox4').is(':checked')){
				approve_item.ApproveType+=4;
				var xSelect_phone_m_id=$('.xSelect_phone_m').data('value');
				var xSelect_phone_s_id=$('.xSelect_phone_s').data('value');
				approve_item.MasterSmsSvrConfigId=xSelect_phone_m_id;
				approve_item.MasterSmsSvrConfig=$('.xSelect_phone_m .xSelect-show-text').text();
				approve_item.StandBySmsSvrConfigId=xSelect_phone_s_id;
				approve_item.StandBySmsSvrConfig=$('.xSelect_phone_s .xSelect-show-text').text();
			}
			if($('#checkbox8').is(':checked')){
				approve_item.ApproveType+=8;
				var xSelect_smtp_m_id=$('.xSelect_smtp_m').data('value');
				var xSelect_smtp_s_id=$('.xSelect_smtp_s').data('value');
				approve_item.MasterSmtpConfigId=xSelect_smtp_m_id;
				approve_item.MasterSmtpConfig=$('.xSelect_smtp_m .xSelect-show-text').text();
				approve_item.StandBySmtpConfigId=xSelect_smtp_s_id;
				approve_item.StandBySmtpConfig=$('.xSelect_smtp_s .xSelect-show-text').text();
			}
			if(approve_item.ApproveType==0){
				_alert(2, "审批策略", '请选择方式');
				return false;
			}
			var $all = $("#label_list").find('div[value!=0]');
			var len = $all.length;
			if (len == 0) {
				_alert(2, "审批策略", '请选择审批者');
				return false;
			}
			var id = document.frm_approve_add.a.value;
			approve_item.ApproveStrategyId = parseInt(id);
			approve_item.ApproveStrategyName = val;
			//////////console.log(len);
			if (ApproveNum > len) {
				ApproveNum = len;
			}
			approve_item.ApproveNum = (ApproveNum);
			approve_item.UserSet = new Array();

			for (var j = len - 1; j >= 0; j--) {
				var t_i = $all.eq(j).attr('value');
				//////////console.log('t_i' + t_i);
				if (t_i != '0' && t_i != '') {
					var json_a = '{"UserId":' + t_i + '}';
					approve_item.UserSet.push(JSON.parse(json_a));
				}
			}
			var msstr = aceg(JSON.stringify(approve_item),$("input[name=se]").val());
			$.ajax({
				url: '/bhost/add_approve',
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a1: JSON.stringify(approve_item) ,m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						$('.btn').blur(); parent.layer.open({
							type: 1,
							title: '审批策略',
							content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
							btn: ['确&nbsp;&nbsp;定'],
							btnAlign: 'c',
							closeBtn: false,
							skin: 'layer-custom',
							area: ['380px', '310px'],
							move: false,
							resize: false,
							yes: function (i) {
								$('.btn').blur();
								parent.layer.close(i);
								cal(1,result.ApproveStrategyId);
							}
						});
					} else {
						_alert(1, "审批策略", result.ErrMsg, $("#ApproveStrategyName"));
						return false;
					}
				}
			});
		}
$(function(){
	
	$("#approve_strategy").on("click",function(){
		location.reload();
	});
 });
	</script>
</body>

</html>
