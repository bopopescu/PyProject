<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Logbase运维安全管理系统</title>
	<!--script-->
	<script src="/manage/js/jquery.min.js"></script>
	<script src="/manage/js/jquery.easing.js"></script>
	<script src="/manage/js/layer.js"></script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/common_e.js"></script>
	<script src="/manage/js/select2.full.min.js"></script>
	<script src="/manage/js/icheck.min.js"></script>
	<script src="/manage/js/jquery.plugin.js"></script>
	<script src="/manage/js/jquery.datepick.js"></script>
	<script type="text/javascript" src="/manage/js/dialog-plus.js"></script>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<link rel="stylesheet" href="/manage/css/style.css">
	<link rel="stylesheet" href="/manage/css/jquery.datepick.css">
	<link rel="stylesheet" href="/manage/css/new-head.css">
	<link rel="stylesheet" href="/manage/css/ui-dialog.css" type="text/css" />
<!--icheck-->


</head>
<body style="overflow:hidden;" class="bg-white">
	<!---->
	<div class="rwrap">
		<!---->
		<div class="mainer">
			
			<div class="container container3">
				<div class="c-top">
					<div class="manual-head">
						{%if auth_flag1 != 0%}
						<div class="manual-title-other title-item" style="color: rgb(121, 121, 121);background: rgb(222, 222, 222)">
							<span id="manage_auth">访问授权</span>
							<i style="display: none;"></i>
						</div>
						{%endif%}
						{%if auth_flag2 != 0%}
						<div class="manual-title-other title-item" style="color: rgb(121, 121, 121);">
							<span id="manage_work"> 工单授权</span>
							<i style="display: none;"></i>
						</div>
						{%endif%}
						<div class="manual-title-other title-item" id="frist">
							<span id="cmd_auth"> 指令授权</span>
							<i class="cmdAuth_icon"></i>
						</div>
						{%if auth_flag4 != 0%}
						<div class="manual-title-other title-item" style="color: rgb(121, 121, 121);">
							<span id="manage_add"> 管理授权</span>
							<i style="display: none;"></i>
						</div>
						{%endif%}
					</div>
				</div>

				<div class="c-cont">
					<div class="c-wrap" style="padding: 0px 0px 28px;">
						<div class="c-table">
							<div class="tab-t">
								<div class="ctr" style="width: 310px;">
									{%if auth_flag3 == 1%}
									<a href="javascript:;" class="btn btn-default" onmouseover="_showNode(this)">创建<i class="icon-arr"></i></a>
									<a href="javascript:;" class="btn btn-default" onclick="dalete_all();">删除</a>
									<a href="javascript:;" class="btn btn-default" onclick="select_all();">全选</a>
									{%endif%}
									<a href="javascript:;" class="btn btn-default" onclick="flash();">刷新</a>
								</div>

								<div class="filter">
									<div class="search">
										<select name="" id="filter" class="filter-select" onchange="filter_change();">
											<option value="0">所有</option>
											<option value="1">名称</option>
											<option value="2">管理员</option>
											<option value="3">授权方式</option>
											<option value="4">授权动作</option>
											<option value="5">状态</option>
											<option value="6">响应方式</option>
											<option value="7">用户组</option>
											<option value="8">运维用户</option>
											<option value="9">主机组</option>
											<option value="10">主机名</option>
											<option value="11">服务器范围</option>
											<option value="12">主机服务</option>
											<option value="13">账号</option>
											<option value="14">指令</option>
										</select>
										
										<input type="text" class="filter-text" id="srgjz" placeholder="输入关键字" style="padding: 0 22px 0 4px;" onkeydown="if($('#keyword').val()==''){$('#text_check').hide();}else{$('#text_check').show();};if (event.keyCode == 13){_addFilter(this,false);return false;} else return;" onchange="if($('#keyword').val()==''){$('#text_check').hide();}else{$('#text_check').show();}" onkeyup="if($('#keyword').val()==''){$('#text_check').hide();}else{$('#text_check').show();}" onblur="change_input(this)">
										
										<i class="v-check v-wrong" id="text_check" onclick="_clear_keyword(this)" style="display:none;cursor: pointer;float: left;position: static;"></i>
										<button class="btn filter-btn" onclick="_addFilter(this,false)"><i class="add-filter"></i></button>
										<button class="btn filter-btn" onclick="_addFilter(this,true)"><i class="append-filter"></i></button>
									</div>
									<div class="search" id="clearFilter" style="margin: 0px 15px 0px -16px;display:none;">
										<button class="filter-btn" onclick="_clearFilter(this)"><i class="clear-filter"></i></button>
									</div>
									<div class="selector selector-multiple" id="filterWW" style="display: none;">
										<span class="ww">搜索条件</span>
										<ul></ul>
									</div>
								</div>
							</div>
							<div class="box-table">
							<table cellpadding="0" cellspacing="0">
								<thead>
									<tr><th width="10"><input type="checkbox" class="form-checkbox" id="check_page"/></th>
										<th width="42">优先级</th>
										<th>名称</th>
										<th width="90">管理员</th>
										<th width="80">授权方式</th>
										<th width="70">授权动作</th>	
										<th width="40">状态</th>
										<th width="135">响应方式</th>
										{%if auth_flag3 == 1%}
										<th width="80"></th>
										{%else%}
										<th width="20"></th>
										{%endif%}
									</tr>
								</thead>

								<tbody id="cmdAuth_list">
																			
								</tbody>
							</table>
							</div>
							<div class="tab-i">
								<div class="il">
									每页显示<span id="page_nums">10</span>条 总数：<span id = "total">25</span>选中：<span id="sum">0</span>
								</div>

								<div class="ipage">
									<a href="javascript:;" class="nav2 begin" id="begin_page" onclick="begin_page();"><i></i></a>
									<a href="javascript:;" class="nav prev" id="prev_page" onclick="prev_page();"><i></i></a>
									<input type="text" id = "present_page" value="1" onchange="present_page();">/&nbsp;<span id = "all_pages">25</span>
									<a href="javascript:;" class="nav next" id="next_page" onclick="next_page();"><i></i></a>
									<a href="javascript:;" class="nav2 end" id="end_page" onclick="end_page();"><i></i></a>
								</div>
							</div>
						</div>
						
						<div class="clearfix"></div>
						<!--
						<div class="btns">
							<a href="javascript:;" class="btn btn-normal" onclick="back()">返&nbsp;&nbsp;回</a>
						</div>
						-->
					</div>
				</div>
			<div class="clearfix"></div>
				<div class="btns">
					{%if auth_flag3 == 1%}
					<a href="javascript:;" class="btn btn-normal s-hide" id="importUser" onclick="_import_user(1);">导&nbsp;&nbsp;入</a>
					{%endif%}
					<a href="javascript:;" class="btn btn-normal" onclick="_export_user(2);">导&nbsp;&nbsp;出</a>
				</div>
				<div id="bBtn" style="z-index: 5;">
					<a href="javascript:;" class="btn" onclick="back();"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
				</div>
			</div>

			<!--<div class="clearfix"></div>
			<div class="btns">
				<a href="javascript:;" class="btn btn-normal s-hide" id="importUser" onclick="_import_user(1);">导&nbsp;&nbsp;入</a>
				<a href="javascript:;" class="btn btn-normal" onclick="_export_user(2);">导&nbsp;&nbsp;出</a>
			</div>
			<div id="bBtn" style="z-index: 5;">
				<a href="javascript:;" class="btn" onclick="back();"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
			</div>-->
		</div>

		<!--导入信息详情-->
		<div class="container6">
			<div id="importPage" style="display: none;">
				<div class="ap-top" id="">
					<div class="ctrl">
						<a href="javascript:;" class="re" onclick="_reloadDetail(2)" style="border-radius: 14px;"><i style="margin: 3px auto;margin-left: 8px;"></i></a>
						<!--<a href="javascript:;" class="close" onclick="_closeDetail(2)"><i></i></a>-->
					</div>
					<div class="types">
						<label>
							<input type="checkbox" name="" id="fail_IP_box" class="form-checkbox" >失败的授权</label>
					</div>
				</div>
				<div class="apWrap">
					<div class="title">
						<h2>导入详情</h2>
					</div>
					<div class="top">
						<div class="mm mm1">
							总数：<span>11</span> 成功数量：<span>11</span> 失败数量：<span>11</span>
						</div>
					</div>
					<div class="clearfix"></div>
					<div id="apArea1" style="height:auto;">
					</div>
					<div id="aploadTip1">正在加载</div>
				</div>
				<div id="bBtn" style="position: fixed;z-index:5;">
                			<a href="javascript:;" class="btn" style="float: right;" onclick="_closeDetail(2)"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
        			</div>
			</div>
		</div>

		<div class="dialog-cont" id="scDCTab2_import" style="display:none;">
			<div class="fsel" style="margin-left: 0;">
				<ul><li><a class="active" href="javascript:;" id="task_import" onclick="set_tab(this,1);">授权导入</a></li>
					<li><a href="javascript:;" id="task_list_tab" onclick="set_tab(this,2);">任务列表</a></li>
				</ul>
			</div>
			<div class="container5">
				<div id="import_module" class="c-cont" style="min-height:400px;max-height:400px;overflow:hidden;">
					<div class="c-form" style="padding-bottom:10px;padding-left:50px;">
						<div class="tab-t c-form">
							<span class="form-tag">下载模板：</span>
							<div class="ctr" style="margin-left:6px;">
								<a class="btn" href="javascript:;" style="" onclick="_export_user(1);">下载</a>
							</div>
						</div>
						<div class="c-form" style="">
							<form id="uploadForm">
								<div class="form-item tab-t">
									<span class="form-tag"><em class="imp">*</em>选择文件：</span>
									<div class="form-c ctr" style="width:300px;padding:0 0 0 7px;">
										<div class="item" style="float: left;width:67%">
											<input id="file_v" name="file_v" class="form-text" type="text" style="float: left;width: 220px;">
											<input id="file_change" name="file_change" class="form-text" type="text" onclick="browes();" onchange="/*filetip(this);*/" style="float: left;opacity: 0;margin-top: -28px;cursor: pointer;">
											<input id="file_change1" name="file_change1" class="form-text" type="file" onchange="filetip(this);" style="float: left;opacity: 0;margin-top: -28px;cursor: pointer;display: none;">
										</div>
										<div class="item" style="float: left;width:33%">
											<a class="btn" href="javascript:;" style="margin-left: 70px;height: 26px;width:33px;" onclick="browes();">浏览</a>
										</div>
										<p class="form-tip" id="" style="margin-top: 28px;width: 243px;height: 32px;">特殊字符仅支持下划线、横杠、小数点</p>
									</div>
								</div>
							</form>
						</div>
						<div class="c-form">
							<span class="form-tag">覆盖：</span>
							<div style="width: 215px;margin-left: 200px;margin-top: 4px;">
								<input class="form-checkbox" id="cover_box1" type="checkbox"/>
								<span class="tip" style="color: #b2b2b2;">覆盖相同名称的授权</span>
							</div>
						</div>
						<div class="btns" style="">
							<a href="javascript:;" class="btn btn-normal btn-submit" >确&nbsp;&nbsp;定</a>
						</div>
					</div>
				</div>
			
				<div id="details_module" class="c-cont" style="min-height:400px;max-height:400px;overflow:hidden;display:none;">
					<div class="c-form" style="padding:0;width: auto;">
						<div class="c-wrap" style="padding:0;">
						<div class="c-table r-list" style="padding:0;">
							<div class="tab-t">
								<div class="ctr">
									<a href="javascript:;" class="btn btn-default" onclick="select_all1()">全选</a>
									<a href="javascript:;" class="btn btn-default" onclick="del_hosttask_more()">删除</a>
									<a href="javascript:;" class="btn btn-default" onclick="fresh_task_list()">刷新</a>
								</div>
							</div>
							<div class="box-table" style="overflow: hidden;">
								<table cellpadding="0" cellspacing="0" id="usertask_list">
									<thead>
										<tr>		
											<th width="50"><input type="checkbox" class="form-checkbox" id="check_task_page"/></th>
											<th>名称</th>
											<th>成功数</th>
											<th>失败数</th>
											<th>状态</th>
											<th>错误信息</th>
											<th width="50"></th>
										</tr>
									</thead>
									<tbody>
										
									</tbody>
								</table>
							</div>
							<div class="tab-i">
								<div class="il">
									每页显示<span id="page_total">10</span>条 总数<span id = "task_total">25</span>  选中：<span id = "select_total">0</span>
								</div>

								<div class="ipage">
									<a href="javascript:;" class="nav2 begin" onclick="turn_page(1);"><i></i></a>
									<a href="javascript:;" class="nav prev" onclick="turn_page(2)"><i></i></a>
									<input type="text" value="1" id="curpage" onchange="turn_page(5)">/ <span id = "totalpage">25</span>
									<a href="javascript:;" class="nav next" onclick="turn_page(3)"><i></i></a>
									<a href="javascript:;" class="nav2 end" onclick="turn_page(4)"><i></i></a>
								</div>
							</div>
						</div>
						
						<div class="clearfix"></div>
					</div>
				</div>
			</div>
		</div>	
	</div>
	<!-- 导出方式 浮层-->
	<div class="dialog-cont s-hide" id="export_type" style="display:none;">
		<div class="container">
			<div id="export_module" class="c-cont" style="min-height:350px;max-height:300px;overflow:hidden;">
				<div class="c-form" style="padding-bottom:10px;padding-left:50px;">
					<span>方式：</span>
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="all_check" value="all" name="exportType_radio" checked="checked"/>所有
					</label>
					<!-- <label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="resource_check" value="resource" name="exportType_radio"/>资源
					</label>
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="acc_check" value="acc" name="exportType_radio"/>访问
					</label>
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="work_check" value="work" name="exportType_radio"/>工单
					</label>
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="cmd_check" value="cmd" name="exportType_radio"/>指令
					</label>
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="manage_check" value="manage" name="exportType_radio"/>管理
					</label> -->
				</div>
				<div class="c-form" style="padding-bottom:10px;padding-left:50px;padding-top: 5px;">
					<span style="padding-right: 46px;"></span>
					<!-- <label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="all_check" value="all" name="exportType_radio" checked="checked"/>所有
					</label> -->
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="resource_check" value="resource" name="exportType_radio"/>资源
					</label>
					{%if auth_flag1 != 0%}
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="acc_check" value="acc" name="exportType_radio"/>访问
					</label>
					{%endif%}
					{%if auth_flag2 != 0%}
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="work_check" value="work" name="exportType_radio"/>工单
					</label>
					{%endif%}
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="cmd_check" value="cmd" name="exportType_radio"/>指令
					</label>
					{%if auth_flag4 != 0%}
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="manage_check" value="manage" name="exportType_radio"/>管理
					</label>
					{%endif%}
				</div>
				<div class="c-form" style="padding-bottom:10px;padding-left:50px;">
					<span>格式：</span>
					<label class="form-label" style="width: 60px;">
						<input type="radio" class="form-radio" value=0 name="exportType_radio2" checked="checked"/>CSV
					</label>
					<label class="form-label" style="width: 60px;">
						<input type="radio" class="form-radio" value=1 name="exportType_radio2"/>XLS
					</label>
					<!--<label class="form-label" style="width: 60px;">
						<input type="radio" class="form-radio" value=2 name="exportType_radio2"/>XLSX
					</label>-->
				</div>
			</div>
			<div class="btns" style="/*padding: 20px 0 0px;*/">
				<a href="javascript:;" class="btn btn-normal btn-submit" >确&nbsp;&nbsp;定</a>
			</div>
		</div>
	</div>
	<div id="newNode" class="drop-node" style="width: 104px;">
		<p><i class="arr"></i>创建</p>
		<ul>
			<li><a href="javascript:;" onclick="creat_cmdauth_u()">按对象授权</a></li>
			<li><a href="javascript:;" onclick="creat_cmdauth_w()">按工单授权</a></li>
			<li><a href="javascript:;" onclick="creat_cmdauth_a()">按访问授权</a></li>
		</ul>
	</div>
	<form action="/bhost/access_user_index" method="POST" name="frm_access">
			<input type="hidden" name="tasktype" id = "tasktype" value="{{ tasktype }}" />
			<input type="hidden" name="se" id = "se" value="" />
			<input type="hidden" name="user" id = "user" value="" />
			<input type="hidden" name="page" id = "page" value="{{ page }}" />
			<input type="hidden" name="id" id = "id" value="" />
			<input type="hidden" name="name" id = "name" value="{{ name }}" />
			<input type="hidden" name="type" id = "type" value="{{ type }}" />
			<input type="hidden" name="a0" id = "a0" value="" />
			<input type="hidden" name="z1" id = "z1" value="" />
			<input type="hidden" name="z2" id = "z2" value="" />
			<input type="hidden" name="z3" id = "z3" value="" />
			<input type="hidden" name="z4" id = "z4" value="" />
			<input type="hidden" name="z5" id = "z5" value="" />
			<input type="hidden" name="z6" id = "z6" value="" />
	</form>
	
	<form action="/bhost/import_data" method="POST" name="frm1" enctype="multipart/form-data">
		<input type="hidden" name="z1"  value="" />
		<input type="hidden" name="a0"  value="" />
		<input type="hidden" name="a1"  value="" />
		<input type="hidden" name="a99"  value="" />
	</form>
<style>
	#importUser {
		outline:none;
	}
	.fsel {
		position: fixed;
		margin: -67px 0 0 -20px;
		width: 580px;
		height: 45px;
		background: #FFF;
	}
	.fsel ul li {
		float: left;
	}

	.fsel ul li a.active {
		border-top: 5px solid #4cb2d0;
		border-right: 1px solid #DDD;
		border-left: 1px solid #DDD;
		line-height: 41px;
		border-bottom: 1px solid #FFF;
	}
	.fsel ul li a {
		float: left;
		padding: 0 32px;
		line-height: 45px;
		font-size: 18px;
		color: #000;
	}
	.ui-dialog-body{
		padding: 20px 0 0 0;
	}
	#details_module table th {
		text-align:center
	}
	#details_module table td {
		text-align:center
	}
	#table_title th{
		text-align:center
	}
	#hosttask_list_detail td{
		text-align:center
	}
	#import_host_list_detail td{
		text-align:center
	}
	#importPage{
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: #f3f3f3;
		overflow: auto;
	}
	.apItem .label.succ:before{
		content: '';
		float: left;
		width: 20px;
		height: 20px;
		margin: 3px 14px 0 14px;
		background: url(/manage/images/cmd_succ.png) no-repeat 0 0;
	}
	.apItem .label.fail:before{
		content: '';
		float: left;
		width: 20px;
		height: 20px;
		margin: 3px 14px 0 14px;
		background: url(/manage/images/cmd_fail.png) no-repeat 0 0;
	}
	#filterWW_account:after{
		margin: 11px 0 0 34.5em;
	}
	.apItem {
		width: 50%;
		padding: 5px 0;
		overflow: hidden;
		transition: background-color 0.4s;
		float: left;
	}
	#usertask_list .tab-ctr {
		display: none !important;
	}
	#usertask_list tr:hover td div.tab-ctr {
		display: block !important;
	}
</style>
<script>
$('.filter-select').select2({minimumResultsForSearch: -1});
$('.form-checkbox,.form-radio').iCheck({
	checkboxClass: 'icheckbox_minimal-blue',
	radioClass: 'iradio_minimal-blue',
	increaseArea: '0' // optional
});

</script>

<!---->
<script>
var select_c=0;
var ifflash=0;
var save_check={{selectid|safe}};
var name_x=[];
var way="";
var time = null;
var namecheck = /^[_\-.\n\w\u4e00-\u9fa5]*$/;
var manage_filter_flag = {{manage_filter_flag}};
var se;
$(document).ready(function () {
	
	$("#auth_way").next('span').find('span.select2-selection').css({"border-bottom-left-radius":"1px","border-top-left-radius":"1px","margin-left":"-1px"})
	var titleItem = $(".title-item");
	$("#manage_auth").on("click",function(){
		fw_z();
	});
	$("#manage_work").on("click",function(){
		manage_work();
	});
	$("#cmd_auth").on("click",function(){
		cmd_auth();
	});
	$("#manage_add").on("click",function(){
		sq_h();
	});

})

var filter_json = {
	"1":"名称",
	"2":"管理员",
	"3":"授权方式",
	"4":"授权动作",
	"5":"状态",
	"6":"响应方式",
	"7":"用户组",
	"7":"运维用户",
	"9":"主机组",
	"10":"主机名",
	"11":"服务器范围",
	"12":"主机服务",
	"13":"账号",
	"14":"指令"
}

var auth_type = {
	"1":"按对象授权",
	"2":"按访问授权",
	"3":"按工单授权"
}

var auth_action = {
	"1":"允许",
	"2":"拒绝"
}

var auth_status = {
	"true":"启用",
	"false":"停用"
}

var response_mode = {
	"1":"产生告警",
	"2":"阻断会话",
	"4":"忽略指令",
	"8":"指令审批"
}

$(function(){
	
	se = window.parent.document.frm.se.value;
	$("#auth_way").next().hide();
	if(document.frm_access.page.value)
	{
		$("#present_page").val(document.frm_access.page.value);
	}
	////////console.log("manage_filter_flag:"+manage_filter_flag);
	////////console.log(document.frm_access.name.value);
	if(document.frm_access.tasktype.value==4)
	{
		if(document.frm_access.name.value!="")
		{
			filter_v = document.frm_access.name.value;
			name_x = JSON.parse(document.frm_access.name.value);
		}
		if((document.frm_access.name.value != "" && document.frm_access.name.value != "[]") || document.frm_access.type.value != "")
		{
			way=document.frm_access.type.value;
			var name_x_len = name_x.length;
		
			if (manage_filter_flag == 1 && name_x_len == 1){
				var filter_arry = name_x[0].split('-');
				var filter_v = filter_arry[0];
				filter_arry.splice(0,1);
				var v = filter_arry.join('-');
				var addfilter_v = "";
				$("#filter").val(filter_v).trigger('change');
				if (filter_v == '3' || filter_v == '4' || filter_v == '5' || filter_v == '6'){
					$("#auth_way").val(v).trigger('change');
				}else{
					$("#srgjz").show();
					$("#srgjz").val(v);
					$("#srgjz").focus();
					$("#text_check").show();
					keyword_v = v;
				}
			}else{
				$("#filterWW").show();
				$("#clearFilter").show();
				$.each(name_x,function(i,item){
					var filter_arry = item.split('-');
					var filter_v = filter_arry[0];
					filter_arry.splice(0,1);
					var v = filter_arry.join('-');
					
					var addfilter_v = "";
					if (filter_v == "0"){
						addfilter_v = v;
					}else{
						var data_v = "";
						if (filter_v == 3){
							data_v = auth_type[v];
						}else if (filter_v == 4){
							data_v = auth_action[v];
						}else if (filter_v == 5){
							data_v = auth_status[v];
						}else if (filter_v == 6){
							data_v = response_mode[v];
						}else{
							data_v = v;
						}
						addfilter_v = filter_json[filter_v] + '-' + data_v;
					}
					if (i + 1 != name_x_len){
						$('#filterWW>ul').append('<li><span class="ww" title="'+addfilter_v+'" data-value="'+item+'">'+addfilter_v+'</span><i class="del" onclick="_delFilter(this)"></i></li>');
					}else{
						if (manage_filter_flag == 0){
							$('#filterWW>ul').append('<li><span class="ww" title="'+addfilter_v+'" data-value="'+item+'">'+addfilter_v+'</span><i class="del" onclick="_delFilter(this)"></i></li>');
						}else{
							$("#filter").val(filter_v).trigger('change');
							if (filter_v == '3' || filter_v == '4' || filter_v == '5' || filter_v == '6'){
								$("#auth_way").val(v).trigger('change');
							}else{
								$("#srgjz").show();
								$("#srgjz").val(v);
								$("#srgjz").focus();
								$("#text_check").show();
								keyword_v = v;
							}
						}
					}	
				})
			}
			/*
			if (manage_filter_flag == 1){
				if (name_x_len == 1){
					var filter_arry = name_x[0].split('-');
					var filter_v = filter_arry[0];
					filter_arry.splice(0,1);
					var v = filter_arry.join('-');
					var addfilter_v = "";
					$("#filter").val(filter_v).trigger('change');
					if (filter_v == '3' || filter_v == '4' || filter_v == '5' || filter_v == '6'){
						$("#auth_way").val(v).trigger('change');
					}else{
						$("#srgjz").show();
						$("#srgjz").val(v);
						$("#srgjz").focus();
						$("#text_check").show();
						keyword_v = v;
					}
				}else{
					$("#filterWW").show();
					$("#clearFilter").show();
					$.each(name_x,function(i,item){
						var filter_arry = item.split('-');
						var filter_v = filter_arry[0];
						filter_arry.splice(0,1);
						var v = filter_arry.join('-');
						
						var addfilter_v = "";
						if (filter_v == "0"){
							addfilter_v = v;
						}else{
							var data_v = "";
							if (filter_v == 3){
								data_v = auth_type[v];
							}else if (filter_v == 4){
								data_v = auth_action[v];
							}else if (filter_v == 5){
								data_v = auth_status[v];
							}else if (filter_v == 6){
								data_v = response_mode[v];
							}else{
								data_v = v;
							}
							addfilter_v = filter_json[filter_v] + '-' + data_v;
						}
						
						if (i + 1 != name_x_len){
							$('#filterWW>ul').append('<li><span class="ww" title="'+addfilter_v+'" data-value="'+item+'">'+addfilter_v+'</span><i class="del" onclick="_delFilter(this)"></i></li>');
						}else{
							$("#filter").val(filter_v).trigger('change');
							if (filter_v == '3' || filter_v == '4' || filter_v == '5' || filter_v == '6'){
								$("#auth_way").val(v).trigger('change');
							}else{
								$("#srgjz").show();
								$("#srgjz").val(v);
								$("#srgjz").focus();
								$("#text_check").show();
								keyword_v = v;
							}
						}	
					})
				}
			}else{
				$("#filterWW").show();
				$("#clearFilter").show();
				$.each(name_x,function(i,item){
					var filter_arry = item.split('-');
					var filter_v = filter_arry[0];
					filter_arry.splice(0,1);
					var v = filter_arry.join('-');
					var addfilter_v = "";
					if (filter_v == "0"){
						addfilter_v = v;
					}else{
						var data_v = "";
						if (filter_v == 3){
							data_v = auth_type[v];
						}else if (filter_v == 4){
							data_v = auth_action[v];
						}else if (filter_v == 5){
							data_v = auth_status[v];
						}else if (filter_v == 6){
							data_v = response_mode[v];
						}else{
							data_v = v;
						}
						addfilter_v = filter_json[filter_v] + '-' + data_v;
					}
					
					$('#filterWW>ul').append('<li><span class="ww" title="'+addfilter_v+'" data-value="'+item+'">'+addfilter_v+'</span><i class="del" onclick="_delFilter(this)"></i></li>');
					if (i+1 == name_x_len){
						$("#filter").val(filter_v).trigger('change');
						if (filter_v == '3' || filter_v == '4' || filter_v == '5' || filter_v == '6'){
							$("#auth_way").val(v).trigger('change');
						}else{
							$("#srgjz").show();
							$("#srgjz").val(v);
							$("#srgjz").focus();
							$("#text_check").show();
							keyword_v = v;
						}
					}
				});
			}
			*/
		}
	}
	get_cmdauth_list();
	tabArr();
});

function filter_change(){
	var v = $("#filter").val();
	if(v == "3" || v == "4" || v == "5" || v == "6"){//授权方式
		if ($("#auth_way").length == 0){
			if (v == "3"){
				var select_str = '<select name="" id="auth_way" class="filter-select"><option value="0">所有</option><option value="1">按对象授权</option><option value="2">按访问授权</option><option value="3">按工单授权</option></select>';
			}else if (v == "4"){
				var select_str = '<select name="" id="auth_way" class="filter-select"><option value="0">所有</option><option value="1">允许</option><option value="2">拒绝</option></select>';
			}else if (v == "5"){
				var select_str = '<select name="" id="auth_way" class="filter-select"><option value="0">所有</option><option value="true">启用</option><option value="false">停用</option></select>';
			}else if (v == "6"){
				var select_str = '<select name="" id="auth_way" class="filter-select"><option value="0">所有</option><option value="1">产生告警</option><option value="2">阻断会话</option><option value="4">忽略指令</option><option value="8">指令审批</option></select>';
			}
			$("#filter").next().after(select_str);
			$("#auth_way").select2({minimumResultsForSearch:-1});
			$("#auth_way").next('span').find('span.select2-selection').css({"border-bottom-left-radius":"1px","border-top-left-radius":"1px","margin-left":"-1px"});
		}else{
			if (v == "3"){
				$("#auth_way").empty().append('<option value="0">所有</option><option value="1">按对象授权</option><option value="2">按访问授权</option><option value="3">按工单授权</option>');
			}else if (v == "4"){
				$("#auth_way").empty().append('<option value="0">所有</option><option value="1">允许</option><option value="2">拒绝</option>');
			}else if (v == "5"){
				$("#auth_way").empty().append('<option value="0">所有</option><option value="true">启用</option><option value="false">停用</option>');
			}else if (v == "6"){
				$("#auth_way").empty().append('<option value="0">所有</option><option value="1">产生告警</option><option value="2">阻断会话</option><option value="4">忽略指令</option><option value="8">指令审批</option>');
			}
		}
		
		$("#auth_way").show();
		$("#auth_way").next().show();
		$("#srgjz").hide();
	}else{
		$("#srgjz").show();
		$("#auth_way").hide();
		$("#auth_way").next().hide();
	}
}

String.prototype.ResetBlank=function(){
	var regEx = /\s+/g; 
	return this.replace(regEx, ' '); 
};

var keyword_v = "";
function _addFilter(obj,type){
	var f = $("#filter").val();
	var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
	var add = 0;
	way = "";
	$("#srgjz").blur();
	var filter_v = "";
	
	if (f == 3 || f == 4 || f == 5 || f == 6){
		var v = $("#auth_way").val();
		var status_v = $("#auth_way").find('option:selected').text();
	}else{
		var v = $("#srgjz").val();
		var status_v = "";
	}
	if (v == ""){
		_alert(2,"搜索","请输入关键字",$("#srgjz"));
		return false;
	}
	v = v.ResetBlank();
	var addfilter_v = "";
	
	if (f == '0'){
		filter_v = v;
	}else{
		var filter_name = filter_json[f];
		filter_v = filter_name + '-' + (status_v != ""?status_v:v);
	}

	addfilter = f + "-" + v;
	
	
	$("#filterWW li").each(function(i,item){
		var filter = $(item).find('.ww').attr('data-value');
		var filter_array = filter.split('-');
		var index = filter.indexOf('-');
		var key_v = filter.substring(index + 1);
		if (filter_array[0] == '4' && filter_array[0] == f){
			add = 1;
			_alert(2,"搜索","只能搜索一个状态");
			return false;
		}else if (filter_array[0] == '5' && filter_array[0] == f){
			add = 1;
			_alert(2,"搜索","只能搜索一个动作");
			return false;
		}else{
			if (filter == addfilter){
				add = 1;
				_alert(2,"搜索","相同的搜索条件已存在",$("#keyword"));
				return false;
			}
		}
	});
	if (add == 1){
		return false;
	}
	
	if (type){
		if (manage_filter_flag == 1){
			name_x.splice(-1,1);
			manage_filter_flag = 0;
		}
		name_x.push(addfilter);
		keyword_v = "";
		$("#text_check").hide();
		$("#srgjz").val('');
		$("#filterWW").show();
		$("#clearFilter").show();
		$('#filterWW>ul').append('<li><span class="ww" title="'+filter_v+'" data-value="'+addfilter+'">'+filter_v+'</span><i class="del" onclick="_delFilter(this)"></i></li>')
	}else{
		if (manage_filter_flag == 1){
			name_x.splice(-1,1);
		}
		manage_filter_flag = 1;
		name_x.push(addfilter);
		keyword_v = addfilter;
	}
	save_check=[];
	$("#present_page").val(1);
	get_cmdauth_list();
}


function _clearFilter(obj){
	$("#filterWW").children('ul').empty();
	$("#filterWW").hide();
	$("#clearFilter").hide();
	name_x = [];
	way="";
	$("srgjz").val('');
	keyword_v = "";
	manage_filter_flag = 0;
	$("#text_check").hide();
	get_cmdauth_list();
}

function _delFilter(obj){
	$(obj).parent().remove();
	var v=$(obj).parent().children("span").attr('data-value');
	name_x.splice($.inArray(v,name_x),1);
	selView();
	$("#present_page").val(1);
	get_cmdauth_list();
}

function _clear_keyword(obj){
	$("#srgjz").val("");
	$("#text_check").hide();
	if (keyword_v != ""){
		keyword_v = "";
		name_x.splice(-1,1);
		manage_filter_flag = 0;
		get_cmdauth_list();
	}
}

function change_input(obj){
	if ($(obj).val() == "" && keyword_v != "" && $("#filter").val() != 3 && $("#filter").val() != 4 && $("#filter").val() != 5 && $("#filter").val() != 6){
		keyword_v = "";
		manage_filter_flag = 0;
		name_x.splice(-1,1);
		$("#text_check").hide();
		get_cmdauth_list();
	}
}

function selView(){
	var $sel = $('#filterWW');
	var len = $('li',$sel).length;
	if(len == 0){
		$sel.hide();
		$("#clearFilter").hide();
	}else if(len == 1){
		$sel.show();
		$('>span.ww',$sel).show();
		$("#clearFilter").show();
		$sel.addClass('selector-multiple');
	}else{
		$sel.show();
		$('>span.ww',$sel).show();
		$("#clearFilter").show();
		$sel.addClass('selector-multiple');
	}
}

var eCheck = true;
function manage_work(){
	document.frm_access.a0.value=se;
	document.frm_access.z3.value=2;
	document.frm_access.z4.value="[]";
	document.frm_access.z5.value=0;
	document.frm_access.z6.value="[]";
	document.frm_access.action = '/bhost/show_manage_workorder';
	document.frm_access.submit();
}
function fw_z()
{
	document.frm_access.a0.value=se;
	document.frm_access.z3.value=2;
	document.frm_access.z4.value="[]";
	document.frm_access.z5.value=0;
	document.frm_access.z6.value="[]";
	document.frm_access.action = '/bhost/show_manage_accessauth';
	document.frm_access.submit();
}
function zl_x()
{
	document.frm_access.a0.value=se;
	document.frm_access.tasktype.value=4;
	document.frm_access.action = '/bhost/cmdAuth_show';
	document.frm_access.submit();
}
function sq_h()
{
	document.frm_access.tasktype.value=3;
	document.frm_access.se.value = se;
	document.frm_access.user.value = window.parent.document.frm.us.value;
	document.frm_access.action = '/bhost/manage_auth_add';
	document.frm_access.submit();
}
function _editSort(obj,id){
	if ({{auth_flag3}} == 2){
		return false;
	}
	if($(obj).children('input').length>0){
		return;
	}

	if(!eCheck){
		return;
	}
	var v = $(obj).text();
	var s = v.length;
	PRI = parseInt(v);
	var $i = $('<input type="text"  value="'+v+'" name="" id="del" style="width:'+(s/2+0.5)+'em" onblur="_checkNum(this,'+id+','+v+')" onkeydown="_autoWidth(this)" onkeyup="_Numcheck(this);"/>');
	$(obj).empty().html($i);
	$('input',obj).focus().select();
}

function _Numcheck(obj){
	var num = $(obj).val();
	num = num.replace(/\D/g,"");
	$(obj).val(num);
}

var PRI = "";
function _checkNum(obj,id,_v){
	var v = $(obj).val().trim();
	var numCheck = /^\d+$/;

	if(!numCheck.test(v)){
		$(obj).parent().empty().text(_v);
		eCheck = true;
		return false;
	}else{
		var position;
		if (v == 0){
			v = 1;
		}
		if (v == PRI){
			$(obj).parent().empty().text(v);
			eCheck = true;
			return;
		}else if (v < PRI){
			position = 1;
		}else{
			position = 2;
		}
		now = $("#present_page").val();
		var modifyid = id;
		var referid = "";
		$.ajax({
			url:'/bhost/check_edit_cmdAuth',
			type:'post',
			async:false,
			data:{a0:se,z1:-1},
			success:function(result){
				var all_auth = JSON.parse(result);
				var lastpostid = all_auth.totalrow;//最后一个优先级
				if (v > lastpostid){
					referid = all_auth.data[parseInt(lastpostid)-1].CmdAuthId;
				}else{
					referid = all_auth.data[v-1].CmdAuthId;
				}
			}
		});
		
		if (referid == modifyid){
			$(obj).parent().empty().text(PRI);
			eCheck = true;
			return false;
		}
		
		$.ajax({
			url:'/bhost/modify_priority_cmd',
			type:'post',
			async:false,
			data:{a0:se,z1:modifyid,z2:referid,z3:position},
			success:function(result){
				if (result == '1'){
					$('#present_page').val(now);
					get_cmdauth_list();			
				}else{
					$(obj).parent().empty().text(PRI);
					eCheck = true;
				}
			}
		})
	}
}

function _autoWidth(obj){
	var v = $(obj).val();
	var len = v.length;
	$(obj).width((len/2+1) + 'em');
}
function _goPage(obj,e){
	var e = e || window.e;
	var v = $(obj).val();

	if(!/[\d.]/.test(v) || v <= 0){
		return;
	}

	if(e.keyCode==13){
		alert('跳页：'+v);
	}
}

function get_cmdauth_list()//获取指令授权列表
{
	page=$("#present_page").val();
	ts=$("#page_nums").text();
	var all_pages;
	$.ajax({
		url:'/bhost/get_cmdauth_list_x',
		type:'post',
		async:false,
		data:{a0:se,a1:JSON.stringify(name_x),a3:page,a4:ts},
		success:function(result){
			cmddata = JSON.parse(result);
			if(cmddata.Result==false)
			{
				_alert(1,"指令授权","执行失败："+range_result.ErrMsg);
				return false;
			}
			$("#cmdAuth_list").empty();
			$("#total").text(cmddata.totalrow);
			
			if(parseInt(cmddata.totalrow)%10==0)
			{
				all_pages=parseInt(cmddata.totalrow)/10;
			}
			else{
				all_pages=parseInt((cmddata.totalrow)/10)+1;
			}
			if(all_pages==0)
			{
				all_pages=1;
			}
			$("#all_pages").text(all_pages);
			var yxj=parseInt(page)*10-10;
			$.each(cmddata.data,function(i,item){
				yxj++;
				if(item.Enabled==true)
				{
					Enabled="启用";
					//var e_class = "stop_use";
					var e_class = "stop_icon";
					var e_type = 2;
					var e_v = "停用";
				}
				else{
					Enabled="停用";
					//var e_class = "start_use";
					var e_class = "start_icon";
					var e_type = 1;
					var e_v = "启用";
				}
				if(item.Action==1)
				{
					action="只允许";
				}
				else if(item.Action==2)
				{
					action="禁止";
				}
				var t="";
				if(item.CmdAuthType==1)//<td><div class=\"sortEdit\" onclick=\"_editSort(this)\">"+yxj+"</div></td>优先级
				{
					t="按对象授权";
				}
				else if(item.CmdAuthType==2)
				{
					t="按访问授权";
				}
				else if(item.CmdAuthType==3)
				{
					t="按工单授权";
				}
				var float_str = "";
				if(item.CmdAuthType==1)//<td><div class=\"sortEdit\" onclick=\"_editSort(this)\">"+yxj+"</div></td>优先级
				{
					var user="";
					var userg="";
					var range="";
					
					$.each(item.AuthObjectSet.AuthUserSet,function(i,xitem){
						if(xitem.Type==2)
						{
							userg=userg+xitem.Name+",";
						}
						else if(xitem.Type==1)
						{
							user=user+xitem.Name+",";
						}
					});
					if(userg!="")
					{
						userg=userg.substring(0,userg.length-1);
						float_str = "<p>用户组："+userg+"</p>";
					}
					if(user!="")
					{
						user=user.substring(0,user.length-1);
						float_str = float_str + "<p>用户："+user+"</p>";
					}
					$.each(item.AuthObjectSet.AuthScope,function(i,xitem){
						range=range+xitem.ServerScopeName+",";
					})
					if(range!="")
					{
						range=range.substring(0,range.length-1);
						float_str = float_str + "<p>服务器范围："+range+"</p>";
					}
					if(item.AuthProtocolName!=null)
					{
						//$("#"+item.CmdAuthId).append("<p>协议："+item.AuthProtocolName+"</p>");
						float_str = float_str + "<p>协议："+item.AuthProtocolName+"</p>";
					}
					if(item.AuthAccountName!=null)
					{
						//$("#"+item.CmdAuthId).append("<p>账号："+item.AuthAccountName+"</p>");
						float_str = float_str + "<p>账号："+item.AuthAccountName+"</p>";
					}
					if(item.AuthConnParamName!=null)
					{
						//$("#"+item.CmdAuthId).append("<p>连接参数："+item.AuthConnParamName+"</p>");
						float_str = float_str + "<p>连接参数："+item.AuthConnParamName+"</p>";
					}
					//t="按用户、主机组授权";
				}
				else if(item.CmdAuthType==2)
				{
					var nameo="";
					$.each(item.AuthObjectSet,function(i,xitem){
						nameo=nameo+xitem.AccessAuthName+",";
					})
					if(nameo!="")
					{
						nameo=nameo.substring(0,nameo.length-1);
						//$("#"+item.CmdAuthId).append("<p>访问授权："+nameo+"</p>");
						float_str = float_str + "<p>访问授权："+nameo+"</p>";
					}
				}
				else if(item.CmdAuthType==3)
				{
					var namew="";
					$.each(item.AuthObjectSet,function(i,xitem){
						namew=namew+xitem.WorkOrderName+",";
					})
					if(namew!="")
					{
						namew=namew.substring(0,namew.length-1);
						//$("#"+item.CmdAuthId).append("<p>工单授权："+namew+"</p>");
						float_str = float_str + "<p>工单授权："+namew+"</p>";
					}
				}
				var namez="";
				$.each(item.AuthCmdSet,function(i,xitem){
					if (xitem.Name != null){
						namez=namez+xitem.Name+",";
					}
				})
				if(namez!="")
				{
					namez=namez.substring(0,namez.length-1);
					//$("#"+item.CmdAuthId).append("<p>指令集合："+namez+"</p>");
					float_str = float_str + "<p>指令集合："+namez+"</p>";
				}
				var nameg="";
				$.each(item.AdminSet,function(i,xitem){
					nameg=nameg+xitem.UserCode+",";
				})
				if(nameg!="")
				{
					nameg=nameg.substring(0,nameg.length-1);
					//$("#"+item.CmdAuthId).append("<p>管理员："+nameg+"</p>");
					float_str = float_str + "<p>管理员："+nameg+"</p>";
				}
				var namer="";
				if (item.ResponseMode == 1){
					namer="产生告警";
				}
				else if(item.ResponseMode==2)
				{
					namer=" 阻断会话";
				}
				else if(item.ResponseMode==3)
				{
					namer="阻断会话，产生告警";
				}
				else if(item.ResponseMode==4)
				{
					namer="忽略指令";
				}
				else if(item.ResponseMode==5)
				{
					namer="忽略指令，产生告警";
				}
				else if(item.ResponseMode==8)
				{
					namer="指令审批";
				}
				else if(item.ResponseMode==9)
				{
					namer="指令审批，产生告警";
				}

				if(item.ApproveStrategyName!=null)
				{
					float_str = float_str + "<p>审批策略："+item.ApproveStrategyName+"</p>";
				}
				if(item.EventAlarmInfoName!=null)
				{
					float_str = float_str + "<p>告警方式："+item.EventAlarmInfoName+"</p>";
				}
				
				var append_str = "<tr>"+
				"<td><input type=\"checkbox\" class=\"form-checkbox\" value="+item.CmdAuthId+"></td>"+
				'<td><div class="sortEdit" id="del" onclick="_editSort(this,'+item.CmdAuthId+')" style="width:40px">'+item.PrioNum+'</div></td>'+
				"<td title=\""+item.CmdAuthName+"\">"+item.CmdAuthName+"</td>"+
				"<td title=\""+nameg+"\">"+nameg+"</td>"+
				"<td title=\""+t+"\">"+t+"</td>"+
				"<td title=\""+action+"\">"+action+"</td>"+
				"<td title=\""+Enabled+"\">"+Enabled+"</td>"+
				"<td title=\""+namer+"\">"+namer+"</td>"+
				"<td><div class=\"tab-ctr\">";
				
				if ({{auth_flag3}} == 2){
					append_str = append_str + "<a href=\"javascript:;\" class=\"search_result\" title=\"查看\" onclick=\"edit("+item.CmdAuthId+","+item.CmdAuthType+")\" value="+item.CmdAuthId+"></a></div><div class=\"tab-moreinfo\" id="+item.CmdAuthId+">"+float_str+"</div></td></tr>";
				}else{
					append_str = append_str + "<a href=\"javascript:;\" class=\"edit\" title=\"编辑\" onclick=\"edit("+item.CmdAuthId+","+item.CmdAuthType+")\" value="+item.CmdAuthId+"></a><a href=\"javascript:;\" class=\""+e_class+"\" title=\""+e_v+"\" onclick=\"enable_work("+e_type+","+item.CmdAuthId+")\"></a><a href=\"javascript:;\" class=\"del\" title=\"删除\" id=\"del\" onclick=\"del("+item.CmdAuthId+")\" value="+item.CmdAuthId+"></a></div><div class=\"tab-moreinfo\" id="+item.CmdAuthId+">"+float_str+"</div></td></tr>";
				}
				
				$("#cmdAuth_list").append(append_str);
				tabArr();
			})
		}
	});

	if (parseInt(page) > all_pages){
		$("#present_page").val(all_pages);
		get_cmdauth_list();
	}
	 $("#cmdAuth_list>tr").unbind().bind("dblclick", function (e){
		x=e.target;
		if (x.nodeName != "INS"){
			$(this).children('td:last').find('.edit').click();
			$(this).children('td:last').find('.search_result').click();
		}
	})
	$('#check_page').iCheck('uncheck');
	var check_page_flag = 0;
	$("#cmdAuth_list input[type='checkbox']").each(function(){
		if ($.inArray(parseInt(this.value), save_check) != -1){					
			$(this).iCheck('check');
			check_page_flag++;
		}
    });
	if (check_page_flag == $("#cmdAuth_list input[type='checkbox']").length && check_page_flag != 0){
		$('#check_page').iCheck('check');
	}
	$('.form-checkbox').iCheck({
		checkboxClass: 'icheckbox_minimal-blue',
		radioClass: 'iradio_minimal-blue',
		increaseArea: '0' // optional
	});
	$('#check_page').on('ifClicked',function(e){
		if(!$('#check_page').prop('checked')){
			$("#cmdAuth_list").children('tr').find('input[type=checkbox]').iCheck('check');
		}else{
			$("#cmdAuth_list").children('tr').find('input[type=checkbox]').iCheck('uncheck');
		}	
	});
	num = save_check.length;
	$("#sum").text(num);
	$("#cmdAuth_list tr input[type='checkbox']").on("ifChanged",function(){
		if ($(this).is(":checked")){
			num = $("#sum").text();   
			num++;
			if (save_check.indexOf(parseInt(this.value)) == -1){
				save_check.push(parseInt(this.value));
			}
			$("#sum").text(num);
		}else{
			num = $("#sum").text();
			num--;
			save_check.splice($.inArray(parseInt(this.value),save_check),1);
			$("#sum").text(num);   
		}
		if ($("#cmdAuth_list tr").find('input[type=checkbox]:checked').length == $("#cmdAuth_list input[type='checkbox']").length){
			$('#check_page').iCheck('check');
		}else{
			$('#check_page').iCheck('uncheck');
		}
	});
}

function enable_work(type,id){
	$.ajax({
		url:'/bhost/enable_cmdauth',
		type:'post',
		async:false,
		data:{a0:se,z1:id,z2:type},
		success:function(result){
			get_cmdauth_list();
		}
	});
}

function begin_page(){//第一页
	save_checked();
	$("#present_page").val(1);
	get_cmdauth_list();
	check_checkbox();
}
function prev_page(){//上一页
	save_checked();
	if($("#present_page").val()==1)
	{
		return false;
	}
	page=parseInt($("#present_page").val())-1;
	$("#present_page").val(page);
	get_cmdauth_list();
	check_checkbox();
}
function present_page(){//换页
	var s=/^[0-9]*$/;
	save_checked();
	if(parseInt($("#present_page").val())>parseInt($("#all_pages").text()))
	{
		$("#present_page").val($("#all_pages").text());
	}
	if(s.test($("#present_page").val())==false)
	{
		$("#present_page").val(1);
	}
	if($("#present_page").val()==0)
	{
		$("#present_page").val(1);
	}
	get_cmdauth_list();
	check_checkbox();
}
function next_page(){//下一页
	save_checked();
	if($("#present_page").val()==$("#all_pages").text())
	{
		return false;
	}
	page=parseInt($("#present_page").val())+1;
	$("#present_page").val(page);
	get_cmdauth_list();
	check_checkbox();
}
function end_page(){//最后一页
	save_checked();
	$("#present_page").val($("#all_pages").text());
	get_cmdauth_list();
	check_checkbox();
}
function flash(){//刷新
	ifflash=1;
	save_check = [];
	get_cmdauth_list();
	save_checked();
}
function creat_cmdauth_u(){//创建1
	document.frm_access.tasktype.value=2;
	page=parseInt($("#present_page").val());
	document.frm_access.page.value=page;
	document.frm_access.name.value=JSON.stringify(name_x);
	document.frm_access.type.value=way;
	document.frm_access.z1.value=manage_filter_flag;
	document.frm_access.z2.value=JSON.stringify(save_check);
	document.frm_access.action = '/bhost/cmdAuth_show';
	document.frm_access.submit();
}
function creat_cmdauth_a(){//创建2
	document.frm_access.tasktype.value=2;
	page=parseInt($("#present_page").val());
	document.frm_access.page.value=page;
	document.frm_access.name.value=JSON.stringify(name_x);
	document.frm_access.type.value=way;
	document.frm_access.z1.value=manage_filter_flag;
	document.frm_access.z2.value=JSON.stringify(save_check);
	document.frm_access.action = '/bhost/cmdAuth_show_a';
	document.frm_access.submit();
}
function creat_cmdauth_w(){//创建3
	document.frm_access.tasktype.value=2;
	page=parseInt($("#present_page").val());
	document.frm_access.page.value=page;
	document.frm_access.name.value=JSON.stringify(name_x);
	document.frm_access.type.value=way;
	document.frm_access.z1.value=manage_filter_flag;
	document.frm_access.z2.value=JSON.stringify(save_check);
	document.frm_access.action = '/bhost/cmdAuth_show_w';
	document.frm_access.submit();
}
function back(){//返回
	document.frm_access.tasktype.value=3;
	document.frm_access.se.value=se;
	document.frm_access.user.value=window.parent.document.frm.us.value;
	document.frm_access.action = '/bhost/index';
	document.frm_access.submit();

}
function edit(obj,type)//编辑
{
	clearTimeout(time);
	document.frm_access.tasktype.value=3;
	document.frm_access.type.value=way;
	/*
	var n="";
	$.each(name_x,function(i,item){
		n=n+item+',';
	})
	n=n.substring(0,n.length-1);
	*/
	document.frm_access.name.value = JSON.stringify(name_x);
	/*
	if($("#filter").children('option:selected').val()==0)
	{
		document.frm_access.name.value="";
		document.frm_access.type.value="";
	}
	*/
	page=parseInt($("#present_page").val());
	document.frm_access.page.value=page;
	document.frm_access.id.value=obj;
	document.frm_access.z1.value=manage_filter_flag;
	document.frm_access.z2.value=JSON.stringify(save_check);
	if(type==1)
	{
		document.frm_access.action = '/bhost/cmdAuth_show';
	}
	else if(type==2)
	{
		document.frm_access.action = '/bhost/cmdAuth_show_a';
	}
	else if(type==3)
	{
		document.frm_access.action = '/bhost/cmdAuth_show_w';
	}
	document.frm_access.submit();
}
function dalete_all()//批量删除
{
	save_checked();
	if(save_check.length==0)
	{
		_alert(2,"指令授权","请选择要删除的数据");
		return false;
	}
		$('.btn').blur();
		parent.layer.open({
		type:1,
		title:"指令授权",
		content:'<div class="layer-alert"><i class="alert warning"></i>是否批量删除</div>',
		btn:['确定','取消'],
		btnAlign:'c',
		closeBtn: false,
		skin:'layer-custom',
		area:['380px','310px'],
		move: false,
		resize: false,
		btn1:function(i){
		parent.layer.close(i);
		$.ajax({
			url:'/bhost/del_cmdauth_x',
			type:'post',
			async:false,
			data:{a0:se,a1:JSON.stringify(save_check),a2:1},
			success:function(result){
				var re_del = JSON.parse(result)
				if (re_del.Result){
					_alert(0,"指令授权","删除成功");
					save_check = [];
				}else{
					_alert(0,"指令授权","删除失败："+re_del.ErrMsg);
				}
			}
		})
		get_cmdauth_list();
		},
		btn2:function(i){
			 parent.layer.close(i);
		}
		});
}

var select_all_click = 0;
function select_all()//全选
{
	save_check = [];
	
	var name_s="";
	var way_s=way;
	
	$.each(name_x,function(i,item){
		name_s=name_s+item+"\\n";
	})
	if(name_x.length!=0)
	{
		name_s=name_s.substring(0,name_s.length-2);
	}
	var sum = $("#sum").text();
	var total = $("#total").text();
	if (sum == total){
		$("#cmdAuth_list").parent().find('input').iCheck('uncheck');
	}else{
		name_s = "";
		way_s = "";
		$.ajax({
			url:'/bhost/get_cmdauth_list_x',
			type:'post',
			async:false,
			data:{a0:se,a1:'[]',a2:way_s,a3:"null",a4:"null"},
			success:function(result){
				var cmd_result = JSON.parse(result);
				$.each(cmd_result.data,function(i,item){
					save_check.push(item.CmdAuthId);
				})
			}
		});
		$("#cmdAuth_list").parent().find('input').each(function(i,item){
			$(item).iCheck('check');
		});
	}
	$("#sum").text(save_check.length);
}
function del(obj)//删除
{
	cmdid=obj;
	$('.btn').blur();
	parent.layer.open({
		type:1,
		title:"指令授权",
		content:'<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
		btn:['确定','取消'],
		btnAlign:'c',
		closeBtn: false,
		skin:'layer-custom',
		area:['380px','310px'],
		move: false,
		resize: false,
		btn1:function(i){
		parent.layer.close(i);
		$.ajax({
			url:'/bhost/del_cmdauth_x',
			type:'post',
			async:false,
			data:{a0:se,a1:cmdid,a2:0},
			success:function(result){
				cmddata = JSON.parse(result);
				if(cmddata.Result==false)
				{
					_alert(1,"指令授权","删除失败："+range_result.ErrMsg);
					return false;
				}
				else{
					_alert(0,"指令授权","删除成功");
					
					save_check.splice(save_check.indexOf(cmdid),1);
					get_cmdauth_list();
					return;
				}
			}
		})
		},
		btn2:function(i){
			parent.layer.close(i);
		}
	});
}
function save_checked()
{
	var flog=0;
	$("#cmdAuth_list tr").each(function(i,item){
		$.each(save_check,function(j,xitem){
			v=parseInt($(item).find("input[type=checkbox]").val());
			if(v==xitem)
			{
				if($(item).find("input[type=checkbox]").prop("checked")==false)
				{
					save_check.splice(j,1);
				}
			}
		})
	})
	$("#cmdAuth_list tr").each(function(i,item){
		if($(item).find("input[type=checkbox]").prop("checked")==true)
		{
			v=parseInt($(item).find("input[type=checkbox]").val());
			$.each(save_check,function(i,xitem){
			if(xitem==v)
			{
				flog=1;
				return false;
			}
			})
			if(flog==1)
			{
				flog=0;
			}
			else{
				save_check.push(v);
			}
		}
		
	})

}

function check_checkbox()//记录之前选中
{
	$("#cmdAuth_list tr").each(function(i,item){
		$.each(save_check,function(j,xitem){
			v=$(item).find("input[type=checkbox]").val();
			if(v==xitem)
			{
				$(item).find("input[type=checkbox]").iCheck("check");
			}
		})
	})
	$("#sum").text(save_check.length);
	select_c=save_check.length;
}
function _showNode(obj){
	var offset = $(obj).offset();
	$('#newNode').css({
		'top':offset.top,
		'left':offset.left
	}).fadeIn().hover(function(){
		$(this).show();
	},function(){
		$(this).fadeOut();
	});
}
function cmd_auth(){
	document.frm_access.a0.value=se;
	document.frm_access.tasktype.value=0;
	document.frm_access.z1.value=0;
	document.frm_access.z2.value="[]";
	document.frm_access.action = '/bhost/auth_manage_xtc';
	document.frm_access.submit();
}

/*
**
**import-->18/3/16
**
*/
/*
导入浮层
*/
function _initSize(){
	var h = $(window).height();
	$('.h-catelog').height(h-200);
	$('.h-content').height(h-220);
	$('.h-content').width($('.h-explorer').width()-$('.h-catelog').width() - 33);
	$('div.container3 div.h-content').width($('div.container3 div.h-explorer').width()-$('.h-catelog').width() - 33);
}

function _closeDetail(type) {
	if (type == 1){
		$('#allPage').hide();
	}else{
		$('#importPage').hide();
	}
	$(".container3").show();
	_import_user(1);
	$("#task_list_tab").click();
}

function _reloadDetail(type) {
	$('#apArea1').empty();
	$('#aploadTip1').html('正在加载').hide();
	page = 0;
	ppage = 0;
	append_flag = 0;
	row_len = 0;
	hostip = "";
	remain_page = 0;
	page_flag = 0;
	same_page = 0;
	_initLoadData1();
}

function get_task_data(){
	$.ajax({  
		url:'/bhost/get_cmdtask_data',
		type:"post",
		async:false,
		data:{a0:se,a1:'null',a2:'null'},
		success:function(result){
			var result = JSON.parse(result);
			$.each(result.data,function(i,item){
				selectid.push(item.AuthImportTaskId);
			});
		}
	});
}

//全选任务
function select_all1(){
	selectid=[];
	var select_total = $("#select_total").text();
	var task_total = $("#task_total").text();
	if (parseInt(select_total) == parseInt(task_total)){
		$("#usertask_list").find('input').iCheck('uncheck');
	}else{
		get_task_data();
		$("#usertask_list tbody input[type='checkbox']").each(function(){
			if (!$(this).prop("disabled")){
				$(this).iCheck('check');   
			}
		})      
	}
	$("#select_total").text(selectid.length);
}

//刷新任务
function fresh_task_list(){
	get_usertask_list();
	selectid = [];
	$("#details_module input[type='checkbox']").each(function(){	
		$(this).iCheck('uncheck');
	});
	$("#select_total").text(0);
}

function delete_usertask(type,id){

	$.ajax({
		url:'/bhost/del_cmdtask',
		type:'post',
		async:false,
		data:{a0:se,a1:id},
		success:function(result){
			del_result = JSON.parse(result);
			if (del_result.Result){
				_alert(0,"授权任务","删除成功");
				$('div.tab-moreinfo-on').hide();
				return false;
			}else{
				_alert(1,"授权任务",del_result.ErrMsg);
				return false;
			}
		}
	})
}

function del_usertask_r(id){
	$('.btn').blur();
	parent.layer.open({
		type:1,
		title:"授权任务",
		content:'<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
		btn:['确&nbsp;&nbsp;定','取&nbsp;&nbsp;消'],
		btnAlign:'c',
		closeBtn: false,
		skin:'layer-custom',
		area:['380px','310px'],
		move: false,
		resize: false,
		btn1:function(i){
			parent.layer.close(i);
			delete_usertask(0,id);
			for (var i = 0; i < selectid.length; i++){      
				if (selectid[i] == parseInt(id)){
					num = $("#select_total").text();
					num = parseInt(num)-1;
					$("#select_total").text(num);
					selectid.splice($.inArray(parseInt(id),selectid),1);
					break;
				}
        	}
			get_usertask_list();
		},
		btn2:function(i){
			parent.layer.close(i);
		}
	});
}
//批量删除
function del_hosttask_more(){
	if (selectid.length == 0){
		_alert(2,"授权任务","请选择要删除的数据");
		return;
	}
	$('.btn').blur();
	parent.layer.open({
		type:1,
		title:"授权任务",
		content:'<div class="layer-alert"><i class="alert warning"></i>是否批量删除</div>',
		btn:['确定','取消'],
		btnAlign:'c',
		closeBtn: false,
		skin:'layer-custom',
		area:['380px','310px'],
		move: false,
		resize: false,
		btn1:function(i){
			parent.layer.close(i);
			selectid_str = selectid.toString();
			delete_usertask(1,selectid_str);
			selectid=[];
			get_usertask_list();
		},
		btn2:function(i){
			parent.layer.close(i);
		}
	});
}

function filetip(obj){
	var c=$(obj).val();
	c = c.split("\\");
	var b = c[c.length-1];
	$('#file_v').val(b);
}
var setinterval=null;
function browes(){
	if(use_BH=='0'){
		$("#file_change1").click();
		return 0;
	}
	var referrer_arr=document.referrer.toString().split('/');
	referrer_arr.pop();
	var referrer=referrer_arr.join('/');
	var sesstimet = (new Date()).valueOf();
	var json_download = {
			"Type": "Upload",
			"Url": referrer,
			"Path": "/usr/storage/.system/upload/",
			"Filename": sesstimet+'',
			"Session": se,
			"sesstimet":sesstimet+''
	}
	var if_html_client = false;
	var base64_str = '';
	$.ajax({
			url: "/bhost/get_base64",
			type:"POST",
			async:false,
			data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(json_download)},
			success:function(result){
					var result=JSON.parse(result);
					if(result.Result){
							if_html_client = result.info;
							base64_str = result.b64;
					}else{
							_alert(1,"授权导出",result.ErrMsg); 
					}
			}
	})
	if(if_html_client) window.open('https://'+document.domain+':'+location.port+'/bhost/test_html?se='+window.parent.document.frm.se.value+'&z1='+JSON.stringify(json_download));
	else{
		get_regedit('bhost', window.parent.document.frm.se.value,'',sesstimet);
		$('#YuFrame1').remove();
		$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
		$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+base64_str);
	}
	clearInterval(setinterval);
	setinterval=setInterval(function(){
		$.ajax({
			url: "/bhost/find_item_sql",
			type:"POST",
			async:false,
			data:{a0:window.parent.document.frm.se.value,a1:sesstimet},
			success:function(result){
				var result=JSON.parse(result);
				if(result.Result){
					if(result.info==null){

					}else{
						var info_arr=result.info.split('/');
						if(info_arr.length>1){
							$('#file_v').val(info_arr.pop());
							$('#file_change').val('/usr/storage/.system/upload/'+sesstimet);
						}else{
							if(result.info=='NULL'){
								$('#file_v').val('');
								$('#file_change').val('');
							}else{
								$('#file_v').val(result.info);
								$('#file_change').val('/usr/storage/.system/upload/'+sesstimet);
							}
						}
						
						clearInterval(setinterval);
					}
				}
			}
		});
	}, 3000);
}

var task_list_detail;
function _initLoadData() {
	var h1 = $('#allPage').height();
	var h2 = $('#apArea').height();
	var add = function() {
		if (h1 - 203 > h2){
			page++;
			get_data(page,10);
			h2 = $('#apArea').height();
		}else{
			clearInterval(if_select);
			return false;
		}
	}

	var if_select = setInterval(function(){
		if (h1 - 203 <= h2 || task_list_detail.totalrow <= 10){
			clearInterval(if_select);
			return false;
		}
		add();	
	},1000);

	add();
}

var keyword_re=[];//搜索条件
var selectid = [];
function get_usertask_list(){
	var MAX_PAGE = 5;
	var cur = $("#curpage").val();
	$.ajax({
		url:'/bhost/get_cmdtask_data',
		type:'post',
		async:false,
		data:{a0:se,a1:cur,a2:MAX_PAGE},
		success:function(result){
			task_list = JSON.parse(result);
			$("#usertask_list tbody").empty();
			var Status = "";
			var succcount;
			var FailCount;
			var ErrorLog;
			$.each(task_list.data,function(i,item){
				if(item.Status == 0){
					Status = "正在执行";
				}else if(item.Status == 1){
					Status = "执行完成";
				}else if(item.Status == 2){
					Status = "执行失败";
				}
				if (item.SuccCount == null){
					SuccCount = "";
				}else{
					SuccCount = item.SuccCount;
				}
				if (item.FailCount == null){
					FailCount = "";
				}else{
					FailCount = item.FailCount;
				}
				if (item.ErrorLog == null){
					ErrorLog = "";
				}else{
					ErrorLog = item.ErrorLog;
				}
				var HostCount = parseInt(SuccCount) + parseInt(FailCount);
				float_str = "<p>错误信息："+ErrorLog+"</p>";
				$("#usertask_list tbody").append('<tr><td width="50"><input type="checkbox" class="form-checkbox" value="'+item.AuthImportTaskId+'"/></td><td title="'+item.AuthImportTaskName+'">'+item.AuthImportTaskName+'</td><td title="'+SuccCount+'">'+SuccCount+'</td><td title="'+FailCount+'">'+FailCount+'</td><td title="'+Status+'">'+Status+'</td><td title="'+ErrorLog+'">'+ErrorLog+'</td><td width="50"><div class=\"tab-ctr\"><a href="javascript:;" class="icon7" id="edit" title="导入详情" data="'+item.AuthImportTaskName+'" data1="'+item.Status+'"onclick="task_detail(this,'+item.AuthImportTaskId+');"></a><a href=\"javascript:;\" class=\"del\" id=\"del\" title="删除任务" onclick=\"del_usertask_r('+item.AuthImportTaskId+')\"></a></div><div class="tab-moreinfo">'+float_str+'</div></td></tr>');
			});
			$('.form-checkbox,.form-radio').iCheck({
				checkboxClass: 'icheckbox_minimal-blue',
				radioClass: 'iradio_minimal-blue',
				increaseArea: '0' 
			});
		}
	});
	tabArr1();
	$("#task_total").text(task_list.totalrow);
	totalpage = Math.ceil(parseInt(task_list.totalrow)/MAX_PAGE);
	if (totalpage < 1){
		totalpage = 1;
	}
	$("#totalpage").text(totalpage.toString());
	$("#page_total").text(MAX_PAGE);
	//<tr>中选择按钮进行设置
	$('#check_task_page').iCheck('uncheck');
	var check_page_flag = 0;
	$("#usertask_list tbody input[type='checkbox']").each(function(){
		if ($.inArray(parseInt(this.value), selectid) != -1){					
			$(this).iCheck('check');
			check_page_flag++;
		}
	});
	if (check_page_flag == $("#usertask_list tbody input[type='checkbox']").length && check_page_flag != 0){
		$('#check_task_page').iCheck('check');
	}
	if (parseInt(cur) > totalpage){
		$("#curpage").val(totalpage);
		get_usertask_list();
	}
	var flag_id = 0;
	num = selectid.length;
	$("#select_total").text(num);
	$("#usertask_list tbody input[type='checkbox']").on("ifChanged",function(){
		if ($(this).is(":checked")){
			num = $("#select_total").text();   
			num++;
			if (selectid.indexOf(parseInt(this.value)) == -1){
				selectid.push(parseInt(this.value))	
			}
			$("#select_total").text(num);
		}else{
			num = $("#select_total").text();
			num--;
			selectid.splice($.inArray(parseInt(this.value),selectid),1);
			$("#select_total").text(num);   
		}
		var check_num = 0;
		$("#usertask_list tbody input[type='checkbox']").each(function(){
			if (!$(this).prop("disabled")){
				check_num++;
			}
		}) 
		if ($("#usertask_list tbody").find('input[type=checkbox]:checked').length == check_num){
			$('#check_task_page').iCheck('check');
		}else{
			$('#check_task_page').iCheck('uncheck');
		}
	});
	$('#check_task_page').on('ifClicked',function(e){
		if(!$('#check_task_page').prop('checked')){
			$("#usertask_list tbody input[type='checkbox']").each(function(){
				$(this).iCheck('check');   
			}) 
		}else{
			$("#usertask_list").children('tbody').find('input[type=checkbox]').iCheck('uncheck');
		}
	});	
}


//切换导入/任务
function set_tab(obj,type){
	if (type == 1){
		$("#import_module").show();
		$("#details_module").hide();
	}else if(type == 2){
		$("#details_module").show();
		$("#import_module").hide();
	}
	$(obj).addClass("active").parent().siblings().children().removeClass("active");
	if (type == 2){
		clearInterval(if_ok);
		get_usertask_list();
		repeat_execute = function(){
			if_ok = setInterval(function(){
				get_usertask_list();
			},5000)}
		repeat_execute();
	}else{
		clearInterval(if_ok);
	}
	var w = $(window).width();
	_initSize();
}

var d;
var if_ok;
var if_ok_down;
var host_task_id;
var MAX_PAGE_T = 5;
function task_detail(obj,id){
	var filename = $(obj).attr('data');
	status = $(obj).attr('data1');
	var host_count = $(obj).attr('data2');
	var acct_count = $(obj).attr('data3');
	$("#hosttask_list_detail tbody").empty();
	$("#cover_box").iCheck('uncheck');
	$("#import_host_list_detail tbody").empty();
	$(".tab-moreinfo.tab-moreinfo-on").remove();
	$('#apArea').empty();
	$('#apArea1').empty();
	page = 0;
	ppage = 0;
	append_flag = 0;
	row_len = 0;
	remain_page = 0;
	page_flag = 0;
	same_page = 0;
	keyword_t = null;
	if (status == 0){
		_alert(2,"授权任务","该任务正在导入中");
		return false;
	}
	if (status == 2){//导入中断
		_alert(1,"授权任务","该任务发生错误");
		return false;
	}
	d.close().remove();
	var succ_flag = $(obj).parents('tr:first').children('td:eq(2)').text();
	var fail_flag = $(obj).parents('tr:first').children('td:eq(3)').text();
	clearInterval(if_ok);
	if (status == 1){//导入完成
		$("#fail_IP_box").iCheck('uncheck');
		$(".mm.mm1").children('span').eq(0).text(parseInt(succ_flag)+parseInt(fail_flag));
		$(".mm.mm1").children('span').eq(1).text(succ_flag);
		$(".mm.mm1").children('span').eq(2).text(fail_flag);
		host_task_IP_id = id;
		_initLoadData1();
		$("#fail_IP_box").on('ifChanged',function(){//仅显示导入失败的授权信息
			if ($(this).prop("checked")){
				keyword_t = 1;
			}else{
				keyword_t = null;
			}
			$('#apArea1').empty();
			page = 0;
			ppage = 0;
			append_flag = 0;
			row_len = 0;
			remain_page = 0;
			page_flag = 0;
			same_page = 0;
			_initLoadData1();
		});
		$(".container3").hide();
		$('#importPage').show();
	}
}

function _initLoadData1() {
	var h1 = $('#importPage').height();
	var h2 = $('#apArea1').height();
	var add = function() {
		if (h1 - 203 > h2) {
			page++;
			var offsetrow = (page-1)*10;
			get_import_detail_user(host_task_IP_id,10,offsetrow);
			get_data_i(0);
			h2 = $('#apArea1').height();
		}else{
			clearInterval(if_select1);
			return false;
		}
	}
	var if_select1 = setInterval(function(){
		if (row_len < 10){
			clearInterval(if_select1);
			return false;
		}
		if (row_len == 10 && import_list_detail.totalrow == 10){
			clearInterval(if_select1);
			return false;
		}
		add();	
	},1000);
	
	add();
}
function get_data_i(type_add){
	if($("#apArea1").find('.apSort').length==0){
		$("#apArea1").append('<div class="apSort"></div>');
	}
	$('#aploadTip1').show();
	var html = '';
	var Status;
	var append_a = append_flag % 10
	var npage = 0;
	
	var page_i = -1;
	var page_re = 0;
	if (import_list_detail.data.length == 0){
		return false;
	}
	$.each(import_list_detail.data,function(i,item){
		html='';
		//var host_v = JSON.parse(item.UserInfo);
		if (item.Status == 0){
			Status = "成功";
			html += '<div class="apItem"><div class="label succ" style="width:50%; text-overflow: ellipsis;">' + item.AuthName + '</div><div class="cc" style="padding-left: 50%;"><table cellpadding="0" cellspacing="0"><tbody><tr><td style="width:153px;">' + Status + '<span class="a"></span></td></tr>';
		}else if (item.Status == 1){
			Status = "失败：" + item.ErrorLog;
			html += '<div class="apItem"><div class="label fail" style="width:50%; text-overflow: ellipsis;">' + item.AuthName + '</div><div class="cc" style="padding-left: 50%;"><table cellpadding="0" cellspacing="0"><tbody><tr><td style="width:153px;">' + Status + '<span class="a"></span></td></tr>';
		}
		html += '</tbody></table></div></div>';
		$("#apArea1").find('.apSort:last').append(html);
		html = '<div class="ap-pc"> 共' + import_list_detail.totalrow + '条</div>';
		$("#apArea1").find('.ap-pc:last').remove();
		$('#apArea1').append(html);
		
	});
	html = '<div class="ap-pc"> 共' + import_list_detail.totalrow + '条</div>';
	$("#apArea1").find('.ap-pc:last').remove();
	$('#apArea1').append(html);
	var maxPage = Math.floor(import_list_detail.totalrow / 10);

	var task_page = page - 1,
		num = 10;
	var pnum = (task_page * num + 1) + '-' + (task_page + 1) * num;
	if((task_page + 1) * num > import_list_detail.totalrow){
		pnum = (task_page * num + 1) + '-' + import_list_detail.totalrow;
	}
	
	if (task_page >= maxPage) {
		$('#aploadTip1').html('已全部加载').show();
		return;
	} else if (task_page < maxPage) {
		$('#aploadTip1').hide();
	}
	if(type_add<2){
		type_add++;
		_addData1(type_add);
	}
}
var append_flag = 0;
var ppage = 0;
var row_len = 0;
var remain_page = 0;
var page_flag = 0;
var same_page = 0;

var page = 0;

$('#importPage').scroll(function() {
	var wh = $('#importPage').height(),
		vh = $('#apArea1').height(),
		st = $('#importPage').scrollTop();

	if (wh + st >= vh) {
		_addData1(0);
	}
})

function _addData1(type_add) {
	if ($('#aploadTip1').is(':visible')) {
		return;
	}
	page++;
	var offsetrow = (page-1)*10;
	get_import_detail_user(host_task_IP_id,10,offsetrow);
	get_data_i(type_add);
}

//获取导入完成的详细信息
var import_list_detail;
var keyword_t;
function get_import_detail_user(id,limitrow,offsetrow){
	$.ajax({
		url:'/bhost/get_import_detail_cmd',
		type:'post',
		async:false,
		data:{'a0':se,'a1':id,'a2':keyword_t,a3:limitrow,a4:offsetrow},
		success:function(result){
			import_list_detail = JSON.parse(result);
			//import_list_detail.data.sort(import_list_detail);
		}
	});
}
function _import_user(type){
	$("#file_v").val('');
	$("#file_change").val('');$("#file_change1").val('');
	$("#pending_box").iCheck('uncheck');
	$("#cover_box1").iCheck('uncheck');
	var $dialogCont = $("#scDCTab2_import").show();
	d = dialog({
		title:"授权导入",
		content:$dialogCont,
		id:"scDCTab2_import",
		width:"850px"
	});
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();


		$('#check_page').iCheck('uncheck');
		var check_page_flag = 0;
		$("#cmdAuth_list input[type='checkbox']").each(function(){
			if ($.inArray(parseInt(this.value), save_check) != -1){					
				$(this).iCheck('check');
				check_page_flag++;
			}
	    });
		if (check_page_flag == $("#cmdAuth_list input[type='checkbox']").length && check_page_flag != 0){
			$('#check_page').iCheck('check');
		}
		$('.form-checkbox').iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		});
		$('#check_page').on('ifClicked',function(e){
			if(!$('#check_page').prop('checked')){
				$("#cmdAuth_list").children('tr').find('input[type=checkbox]').iCheck('check');
			}else{
				$("#cmdAuth_list").children('tr').find('input[type=checkbox]').iCheck('uncheck');
			}	
		});
		num = save_check.length;
		$("#sum").text(num);
		$("#cmdAuth_list tr input[type='checkbox']").on("ifChanged",function(){
			if ($(this).is(":checked")){
				num = $("#sum").text();   
				num++;
				if (save_check.indexOf(parseInt(this.value)) == -1){
					save_check.push(parseInt(this.value));
				}
				$("#sum").text(num);
			}else{
				num = $("#sum").text();
				num--;
				save_check.splice($.inArray(parseInt(this.value),save_check),1);
				$("#sum").text(num);   
			}
			if ($("#cmdAuth_list tr").find('input[type=checkbox]:checked').length == $("#cmdAuth_list input[type='checkbox']").length){
				$('#check_page').iCheck('check');
			}else{
				$('#check_page').iCheck('uncheck');
			}
		});


		if (if_ok == null){
		}else{
			clearInterval(if_ok);
		}
	});
	d.showModal();
	if (type == 1){
		$("#import_module").show();
		$("#details_module").hide();
		$("#task_import").addClass("active").parent().siblings().children().removeClass("active");
		_initSize();
	}
	$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
		d.close().remove();
	});
	$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
		if ($("#details_module").is(':visible')){
			d.close().remove();
			return false;
		}
		var cover_flag = 0;
		var pending_flag = 0;
		if ($("#file_v").val() == ""){
			_alert(2,"授权导入","请选择文件");
			return false;
		}
		var file_v = $("#file_v").val();
		var fileReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
		if (!fileReg.test(file_v)){
			_alert(1,"授权导入","导入文件名称格式不正确");
			return false;
		}
		var len_4=file_v.substr(file_v.length-4).toLowerCase();
		var len_5=file_v.substr(file_v.length-5).toLowerCase();
		if (len_4 != ".csv" && len_4!='.xls' && len_5!='.xlsx'){
			_alert(1,"授权导入","导入文件格式不正确，只支持.CSV、.XLS、.XLSX格式文件");
			return false;
		}
		var file_name = file_v.substring(0,file_v.length-4);

		var file_exist = 0;
		var formData_f = new FormData($("#uploadForm")[0]);
		formData_f.append('a0',se);
		$.ajax({
			url:'/bhost/isexist_import_cmd',
			type:'post',
			data:formData_f,
			async: false,  
			cache: false,
			contentType: false,
			processData: false,
			success:function(result){
				var is_r = JSON.parse(result);
				if (is_r.Result){
					file_exist = 0;
				}else{
					file_exist = 1;
					_alert(2,"授权导入","该任务已存在");
					return false;
				}	
			}
		});
		if (file_exist == 1){
			return false;
		}		
		if ($("#cover_box1").prop('checked')){
			cover_flag = 1;
		}else{
			cover_flag = 0;
		}
		var formData = new FormData($("#uploadForm")[0]);
		formData.append('a1',cover_flag);
		formData.append('a0',se);
		formData.append('a99',use_BH);

		$.ajax({
			url:'/bhost/import_data_cmd',
			type: 'POST',
			data: formData,  
			async: false,  
			cache: false,
			contentType: false,  
			processData: false,  
			success: function (result) {
				$("#file_v").val('');
				$("#file_change").val('');$("#file_change1").val('');
				$("#cover_box1").iCheck('uncheck');
				$.ajax({
					url:'/bhost/get_cmdtask_data',
					type:'post',
					async:false,
					data:{a0:se,a1:1,a2:5},
					success:function(result){
						var task_list_data = JSON.parse(result);
						var totalpage = Math.ceil(parseInt(task_list_data.totalrow)/MAX_PAGE_T);
						if (totalpage < 1){
							totalpage = 1;
						}
						//$("#curpage").val(totalpage);
						$("#curpage").val(1);
						set_tab($("#task_list_tab"),2);
					}
				});
				set_tab($("#task_list_tab"),2);
			}
		});
	});
}
function _export_user(type){
	if (type == 1){
		_export();
	}else{
		var $dialogCont = $("#export_type").show();	
		title="导出";
		var d = dialog({
			title:title,
			content:$dialogCont,
			id:"export_type",
			width:"700px",
		});
		d.addEventListener('close', function () {
			$dialogCont.appendTo("body").hide();
		});
		$('#all_check').unbind().on('ifChecked',function(){
				resource_check=$('#resource_check').is(':checked');
				acc_check=$('#acc_check').is(':checked');
				work_check=$('#work_check').is(':checked');
				manage_check=$('#manage_check').is(':checked');
				cmd_check=$('#cmd_check').is(':checked');
				if(!resource_check || !acc_check || !work_check || !cmd_check || !manage_check){
					$('#acc_check').iCheck('check');
					$('#resource_check').iCheck('check');
					$('#work_check').iCheck('check');
					$('#cmd_check').iCheck('check');
					$('#manage_check').iCheck('check');
				}
				
			}).on('ifUnchecked',function(){
				resource_check=$('#resource_check').is(':checked');
				acc_check=$('#acc_check').is(':checked');
				work_check=$('#work_check').is(':checked');
				manage_check=$('#manage_check').is(':checked');
				cmd_check=$('#cmd_check').is(':checked');
				if(resource_check && acc_check && work_check && manage_check && cmd_check){
					$('#acc_check').iCheck('uncheck');
					$('#resource_check').iCheck('uncheck');
					$('#work_check').iCheck('uncheck');
					$('#cmd_check').iCheck('uncheck');
					$('#manage_check').iCheck('uncheck');
				}
			});
			$('#resource_check').unbind().on('ifChecked',function(){
				if ($('#resource_check').is(':checked') && $('#acc_check').is(':checked') && $('#work_check').is(':checked') && $('#cmd_check').is(':checked') && $('#manage_check').is(':checked')){
					$('#all_check').iCheck('check');
				}
			}).on('ifUnchecked',function(){
				$('#all_check').iCheck('uncheck');
			});
			$('#acc_check').unbind().on('ifChecked',function(){
				if ($('#resource_check').is(':checked') && $('#acc_check').is(':checked') && $('#work_check').is(':checked') && $('#cmd_check').is(':checked') && $('#manage_check').is(':checked')){
					$('#all_check').iCheck('check');
				}
			}).on('ifUnchecked',function(){
				$('#all_check').iCheck('uncheck');
				
			});
			$('#work_check').unbind().on('ifChecked',function(){
				if ($('#resource_check').is(':checked') && $('#acc_check').is(':checked') && $('#work_check').is(':checked') && $('#cmd_check').is(':checked') && $('#manage_check').is(':checked')){
					$('#all_check').iCheck('check');
				}
			}).on('ifUnchecked',function(){
				$('#all_check').iCheck('uncheck');
			});
			$('#cmd_check').unbind().on('ifChecked',function(){
				if ($('#resource_check').is(':checked') && $('#acc_check').is(':checked') && $('#work_check').is(':checked') && $('#cmd_check').is(':checked') && $('#manage_check').is(':checked')){
					$('#all_check').iCheck('check');
				}
			}).on('ifUnchecked',function(){
				$('#all_check').iCheck('uncheck');
			});
			$('#manage_check').unbind().on('ifChecked',function(){
				if ($('#resource_check').is(':checked') && $('#acc_check').is(':checked') && $('#work_check').is(':checked') && $('#cmd_check').is(':checked') && $('#manage_check').is(':checked')){
					$('#all_check').iCheck('check');
				}
			}).on('ifUnchecked',function(){
				$('#all_check').iCheck('uncheck');
			});
			$('#all_check').iCheck('uncheck');
			$('#acc_check').iCheck('uncheck');
			$('#resource_check').iCheck('check');
			$('#work_check').iCheck('uncheck');
			$('#cmd_check').iCheck('check');
			$('#manage_check').iCheck('uncheck');
		$('input[name=exportType_radio2][value=0]').iCheck('check');
		d.showModal();
		$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
			d.close().remove();
			parent.layer.open({
				type: 1,
				title: '指令授权',
				content: '<div class="layer-alert"><i class="alert warning"></i>是否导出</div>',
				btn:['确&nbsp;&nbsp;定','取&nbsp;&nbsp;消'],
				btnAlign:'c',
				closeBtn: false,
				skin:'layer-custom',
				area:['380px','310px'],
				move: false,
				resize: false,
				btn1:function(i){
					var exportType=[];
					format=$("#export_type").find("input[name=exportType_radio2]:checked").val();
					if($('#resource_check').is(':checked')){
						exportType.push('resource');
					}
					if($('#acc_check').is(':checked')){
						exportType.push('acc');
					}
					if($('#work_check').is(':checked')){
						exportType.push('work');
					}
					if($('#cmd_check').is(':checked')){
						exportType.push('cmd');
					}
					if($('#manage_check').is(':checked')){
						exportType.push('manage');
					}
					// if($('#all_check').is(':checked')){
					// 	exportType.push('all');
					// }
					exportType=exportType.join(',');
					parent.layer.close(i);
					$.ajax({
						url:'/bhost/export_data_cmd',
						type:'post',
						async:false,
						data:{a0:se,z2:exportType,z3:format},
						success:function(result){
							var result_arr=result.split(':');
								if (result.split(':')[0]=='true'){
									var file_name=result.split(':')[1]
								}else{
									var result=JSON.parse(result);
									if(!result.Result){
										_alert(1,"授权导出",result.info);
										return false;
									}
								}
							_showLoading();
							repeat_get = function(){
								if_ok_down = setInterval(function(format){
									get_down_ok(file_name);
								},5000)}
							repeat_get();
						}
					});				
				},
				btn2:function(i){
					parent.layer.close(i);
				}
			})
		});
	}
}
var format=0;
var use_BH=window.parent.parent.document.frm.use_BH.value;
function get_down_ok(file_name){
	$.ajax({
		url:'/bhost/get_down_ok_cmd',
		type:'post',
		async:false,
		data:{a0:se,a1:format,a2:file_name},
		success:function(result){
			var down_result = JSON.parse(result);
			if (down_result.Result){
				clearInterval(if_ok_down);
				if (down_result.ErrMsg != "None"){
					_alert(1,"授权导出",down_result.ErrMsg);
					return false;
				}
				_closeLoading();
				if(use_BH=='0'){
					document.frm1.action='/bhost/download_file_cmd';
					document.frm1.a0.value = se;
					document.frm1.a1.value = down_result.file_name;
					document.frm1.z1.value = format;
					document.frm1.a99.value = use_BH;
					document.frm1.submit();
					return 0;
				}
				
				$.ajax({
					url:'/bhost/download_file_cmd',
					type:'post',
					async:false,
					data:{a0:se,z1:format,a99:use_BH,a1:down_result.file_name},
					success:function(result){
						var result=JSON.parse(result);
						if(result.Result){
							var sesstimet = (new Date()).valueOf();
							var referrer_arr=document.referrer.toString().split('/');
							referrer_arr.pop();
							var referrer=referrer_arr.join('/');
							var filename_arr=result.filename.split('.');
							filename_arr.pop(1);
							filename_arr.pop(1);
							var json_download = {
									"Type": "Download",
									"Url": referrer,
									"Path": result.path,
									"Filename": result.filename,
									"Session": se,
									"sesstimet":sesstimet,
									"Filenewname": result.filenewname,
							}
							var if_html_client = false;
							var base64_str = '';
							$.ajax({
									url: "/bhost/get_base64",
									type:"POST",
									async:false,
									data:{a0:se,z1:JSON.stringify(json_download)},
									success:function(result){
											var result=JSON.parse(result);
											if(result.Result){
													if_html_client = result.info;
													base64_str = result.b64;
											}else{
													_alert(1,"授权导出",result.ErrMsg); 
											}
									}
							})
							if(if_html_client) window.open('https://'+document.domain+':'+location.port+'/bhost/test_html?se='+window.parent.document.frm.se.value+'&z1='+JSON.stringify(json_download));
							else{
								get_regedit('bhost', window.parent.document.frm.se.value,'',sesstimet);
								$('#YuFrame1').remove();
								$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
								$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+base64_str);
							}
						}
					}
				});
				/*
				$.ajax({
			                url:'/bhost/del_cmd_file',
			                type:'post',
			                async:false,
			                data:{a0:se,a1:format},
			                success:function(result){
					}
				});
				*/
			}
		}
	});
}
//弹窗列表绑定
function tabArr1(){
	$('table').unbind();
	var tout,tin;
	var $cloneItem;
	var z = false;

	$('#usertask_list').on('mouseover','tbody>tr',function(){
		document.onclick = null;
	}).on('mouseout','tbody>tr',function(){
		document.onclick = function(){
			$('div.tab-moreinfo-on').hide();
			$('tr.on').removeClass('on');
		}
	}).on('click','tbody>tr',function(e){
		x=e.target;
		if(x.id=='del'){
			return false;
		}
		if(x.id=='edit'){
			return false;
		}
		document.onclick = null;

		var $this = $(this);

			var $tr = $this;

			var oset = $tr.offset();
			var trc = $tr.attr('class');
			if(trc && trc.indexOf('on') >=0 ){
				$('div.tab-moreinfo-on').hide();
				$('div.tab-moreinfo-on').remove();
				$('tr.on').removeClass('on');
				return;
			}

			$('div.tab-moreinfo-on').hide();
			$('tr.on').removeClass('on');
			$tr.addClass('on');
			
			var $box = $this.parents('div.box-table');
			var boxh = $box.outerHeight(), boxo = $box.offset();

			var $item = $this.children('td:last').children('div.tab-moreinfo');
			var ih = $item.outerHeight(),th = $tr.outerHeight();
			$cloneItem = $item.clone().addClass('tab-moreinfo-on').appendTo('body');
			if(boxh < oset.top-boxo.top + ih + th - 40 ){
				$cloneItem.css({
					top:oset.top - ih,
					left:oset.left,
					width:$tr.outerWidth() - 1,
					opacity:0,
					display:'block'
				}).stop().animate({
					opacity:1
				});
			}else{
				$cloneItem.css({
					top:oset.top + $tr.outerHeight() + 1,
					left:oset.left,
					width:$tr.outerWidth() - 1,
					opacity:0,
					display:'block'
				}).stop().animate({
					opacity:1
				});
			}
			//$cloneItem.prev('div').remove();
			z_v = $cloneItem.prev('div').css('z-index');
			$cloneItem.css('z-index',z_v+1);
	});
	$('.box-table,body,.c-cont2,.c-cont').on('scroll',function(){
		$('div.tab-moreinfo-on').remove();
		$('tr.on').removeClass('on');
	})
	
	//var len = $('.tab-ctr:first').children('a').length;
	var len = 2;
	$('#usertask_list>thead>tr>th:last').width(len*26);
}

//任务列表翻页
function turn_page(type){
	switch (type){
		case 1: //首页
			$("#curpage").val(1);
			break;
		case 2://上一页
			var cur = $("#curpage").val();
			if (cur == '1'){
				return false;
			}else{
				$("#curpage").val((parseInt(cur)-1));	
			}
			break;
		case 3://下一页
			var cur = $("#curpage").val();
			var total = $("#totalpage").text();
			if (cur == total){
				return false;
			}else {
				$("#curpage").val((parseInt(cur)+1));
			}
			break;
		case 4:
			$("#curpage").val($("#totalpage").text());
			break;
		case 5:
			var cur = $("#curpage").val();
			var numReg = /\D/;
			if (numReg.test(cur) || parseInt(cur) < 1 || cur == ''){
				$("#curpage").val(1);
			}
			break;
		default:
			;
	}
	get_usertask_list();
}
function _export(){
	var data = [
		// ['类型'],
		[
			// '服务器集合',
			'*服务器集合名称','是否启用IP限制','IP地址','IP区间','主机组'],
		[
			// '',
			'特殊字符仅支持下划线、横杠、小数点','启用/不启用（默认：启用）','0.0.0.0-255.255.255.255之间','0.0.0.0-255.255.255.255','1、主机组要填写绝对路径；'],
		['','','','2、若是主机组全选则在路径后加(*)否则为按组授权'],
		// [''],
		// [''],
		// [''],
		// ['协议','*协议名称','*端口','描述'],
		// ['','特殊字符仅支持下划线、横杠、小数点','0-65535之间',''],
		// [''],
		// [''],
		// [''],
		// ['AD域','*AD域名称','*服务器IP'],
		// ['','特殊字符仅支持下划线、横杠、小数点','0.0.0.0-255.255.255.255之间'],
		// [''],
		// [''],
		// [''],
		// ['连接参数','*连接参数名称','*协议','配置'],
		// ['','唯一','RDP/SSH/ORACLE/MSSQL/MYSQL/HTTP(S)/TELNET/FTP/VNC/X11/RADMIN/SYBASE/DB2/RLOGIN/PCANY/TN5250','RDP/TELNET/FTP/VNC/X11/RLOGIN/PCANY协议，配置为空即不填'],
		// ['','特殊字符仅支持下划线、横杠、小数点','','RDP：1.访问方式：NORMAL/CONSOLE；2.格式：访问方式'],
		// ['','','','SSH：1.版本：1/2；2.格式：1/2'],
		// ['','','','ORACLE:1.指定：SID/SERVICE_NAME；2.实例名或服务名：不能含有特殊字符；3.连接方式：未指定/NORMAL/SYSDBA/SYSOPER；4.格式：指定|实例名/服务名|连接方式'],
		// ['','','','MSSQL：1.实例名：不能含有特殊字符；2.认证方式：未指定/SQL服务器验证/Windows验证/Windows单一登录；3.格式：实例名|认证方式'],
		// ['','','','MYSQL/DB2：1.数据库名：不能含有特殊字符；2.格式：数据库名'],
		// ['','','','SYBASE：1.实例名：不能含有特殊字符；2.格式：实例名'],	
		// ['','','','HTTP(S)：1.URL；2.账号：不能含有特殊字符；3.密码：不能含有特殊字符；4.提交元素：不能含有\'|\'；5.格式：URL|账号|密码|提交元素'],
		// ['','','','RADMIN；1.认证方式：未指定/RADMIN/Windows；2.格式：认证方式'],
		// [''],
		// [''],
		// [''],
		[
			// '指令集合',
			'*指令集合名称','描述','*指令'],
		[
			// '',
			'特殊字符仅支持下划线、横杠、小数点','','"多个指令请使用换行符分隔\n<match>通>配符    <nmatch>取非\n<regex>正则表达式匹配<nregex>取非\n<include>包含匹配    \n<ninclude>取非\n<equ>完全匹配\n    默认为包含匹配，增加如下例子的匹配方式，表示包含ls和-al，花括号需单独占一行：\n{\nls\n-al\n}"'],
		// [''],
		// [''],
		// [''],
		// ['邮件','*邮件名称','*服务器地址','*发送邮箱地址','*服务器账号','服务器验证','*附件大小','编码方式','方式'],
		// ['','特殊字符仅支持下划线、横杠、小数点','0.0.0.0-255.255.255.255之间','','','1、是[密码]/否；2、不填为否','单位为M','1、utf-8/gbk；2、不填为utf-8','1、默认/备用/其他；2、不填为其他'],
		// [''],
		// [''],
		// [''],
		// ['短信网关','*短信网关名称','*数据库类型','*服务器地址','*端口','*账号','*密码','数据库','*短信sql语句模板','编码方式','方式'],
		// ['','特殊字符仅支持下划线、横杠、小数点','1、ORACLE/MYSQL/MSSQL/SYBASE；2、默认为ORACLE','','0-65535之间','','','','1、utf-8/gbk；2、不填为utf-8','1、默认/备用/其他；2、不填为其他'],
		// [''],
		// [''],
		// [''],
		// ['SYSLOG','*SYSLOG名称','*服务器地址','*端口','编码方式','方式'],
		// ['','特殊字符仅支持下划线、横杠、小数点','0.0.0.0-255.255.255.255之间','0-65535之间','1、utf-8/gbk；2、不填为utf-8','1、默认/备用/其他；2、不填为其他'],
		// [''],
		// [''],
		// [''],
		// ['SNMP','*SNMP名称','*服务器地址','*端口','编码方式','方式'],
		// ['','特殊字符仅支持下划线、横杠、小数点','0.0.0.0-255.255.255.255之间','0-65535之间','1、utf-8/gbk；2、不填为utf-8','1、默认/备用/其他；2、不填为其他'],
		// [''],
		// [''],
		// [''],
		// ['审批策略','*审批策略名称','短信网关（默认）','短信网关（备用）','邮件（默认）','邮件（备用）','审批者','审批人数'],
		// ['','*特殊字符仅支持下划线、横杠、小数点','特殊字符仅支持下划线、横杠、小数点','特殊字符仅支持下划线、横杠、小数点','特殊字符仅支持下划线、横杠、小数点','特殊字符仅支持下划线、横杠、小数点','特殊字符仅支持下划线、横杠、小数点','数字且不等于0'],
		// [''],
		// [''],
		// [''],
		// ['事件告警','*事件告警名称','描述','等级','类型','方式','默认','备用','接收者已定义','接收者自定义'],
		// ['','*特殊字符仅支持下划线、横杠、小数点','方式不为无时，为必填项','1、无/低/中/高；2、不填为无','1、无/违规操作/高危操作/登录异常；2、不填为无','1、无/邮件/短信网关/SNMP/SYSLOG；2、不填为无','','','仅限邮件、短信网关','仅限邮件、短信网关'],
		// [''],
		// [''],
		// [''],
		[
			// '指令授权',
			'*指令授权名称','*管理者','是否启用','*授权方式','用户组/用户','对象指定/范围指定','服务器/范围','协议/(协议|端口|连接参数)','账号','工单授权','访问授权','授权动作','手工输入指令','指令集合','*响应方式','是否产生告警','审批策略','*告警信息'],
		[
			// '',
			'特殊字符仅支持下划线、横杠、小数点','特殊字符仅支持下划线、横杠、小数点','1、是/否；2、不填为是','对象/工单/访问','1、仅限授权方式为按对象授权；','1、仅限授权方式为按对象授权；','1、仅限授权方式为按对象授权；','1、仅限授权方式为按对象授权；','1、仅限授权方式为按工单授权','1、仅限授权方式为按指令授权','1、允许/禁止；2、不填为允许','手工输入指令和指令集合必填其中一项','"多个指令请使用换行符分隔\n<match>通>配符    <nmatch>取非\n<regex>正则表达式匹配<eql>完全匹配\n<nregex>取非\n<include>包含匹配    <ninclude>取非\n<equ>完全匹配\n默认为包含匹配，增加如下例子的匹配方式，表示包含ls和-al，花括号需单独占一行：\n{\nls\n-al\n}"','手工输入指令和指令集合必填其中一项','阻断会话/忽略指令/指令审批','1、是/否；2、不填为是','仅限响应方式为指令审批','仅限选择产生告警时使用'],
		[
			// '',
			'','','','','2、用户组要填写绝对路径；','2、自定义/已定义(所有/共有))；','2、对象指定时填写主机组和主机IP （非按组后面加*，如：/主机组名/*）；范围指定时填写服务器范围；','2、对象指定时填写所选服务名称；范围指定时填写(协议|端口|连接参数)','2、对象指定时填写格式为账号名称 范围指定直接填写账号名称','2、特殊字符仅支持下划线、横杠、小数点','2、特殊字符仅支持下划线、横杠、小数点','','','','','','',''],
		[
			// '',
			'','','','','3、用户/用户组名称中特殊字符仅支持下划线、横杠、小数点','3、多项内容用|分割，例：已定义|所有；','3、主机组要填写绝对路径；','3、范围指定时所有服务填[*]','3、范围指定时所有账号填[*]','','','','','','','','',''],		
		[
			// '',
			'','','','','','4、不填为对象指定','4、主机组名称中特殊字符仅支持下划线、横杠、小数点','4.对象指定时，按组、按主机、非按组填*，非按主机填-','4.对象指定时，按组、按主机、非按组填*，非按主机填-','','','','','','','','','']

	]; 
	var csvContent = "data:text/csv;charset=utf-8,\ufeff";
	if (window.navigator.msSaveOrOpenBlob) {
		csvContent = "\ufeff";
	}
	data.forEach(function(infoArray, index){
		dataString = infoArray.join(",");
		csvContent += index < data.length ? dataString+ "\n" : dataString;
	});
	if (window.navigator.msSaveOrOpenBlob) {
		// if browser is IE
		var blob = new Blob([decodeURIComponent(encodeURI(csvContent))],{
			type: "text/csv;charset=utf-8;"
		});
		navigator.msSaveBlob(blob, '指令授权模板.csv');
	}else{
		var encodedUri = encodeURI(csvContent);
		var link = document.createElement("a");
		link.setAttribute("href", encodedUri);
		link.setAttribute("download", "指令授权模板.csv");
		document.body.appendChild(link);
		link.click();
		document.body.removeChild(link);
	}
}
/**
**
**/
</script>
</body>
</html>
