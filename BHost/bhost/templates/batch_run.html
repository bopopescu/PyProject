<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8" http-equiv="X-UA-Compatible" content="IE=11;IE=10;IE=9; IE=8; IE=EDGE,chrome=1" />
	<title>manager</title>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<link rel="stylesheet" href="/manage/css/style.css">
	<link rel="stylesheet" href="/manage/css/new-head.css">
	<script src="/manage/js/base64.js"></script>
	<script src="/manage/js/my_scrollbar.js"></script>
</head>

<body style="overflow:hidden;" class="bg-white">
	<div class="container">
		<div class="c-top">
			<div class="c-title">
				<div class="manual-head" style="">
					<div class="manual-title title-item" id="" style="">
						<span>批量启动</span>
						<i class="batchr_icon" style=""></i>
					</div>

					<div class="secnav1">
						<ul>
							<li class="active" onclick="_goStep(1,this)">
								范围选定<div class='before'></div>
							</li>
							<li onclick="_goStep(2,this)">协议配置
								<div class='before'></div>
						</li>
						</ul>
					</div>
				</div>
			</div>

			<!---->
			<div id="contWrap">
				<!--page 1-->
				<div class="c-cont">
					<div class="c-wrap" style="padding: 10px 0 0;" id="step2">
						<div class="c-exp">

							<div class="h-explorer">
								<div class="h-top">

									<div class="h-tit">
										<div class="form-item form-nm">
											<div style="margin-top:-1px">
												<select name="" id="typeSet" class="filter-select" style="width: 120px; margin-top: -2px; display: none;" onchange="_typeSet(this)">
													<option value="1" selected>对象指定</option>
													<option value="2">范围指定</option>
												</select>
											</div>
										</div>
									</div>
								</div>
								<div id="pointSet1" style="display:none;">
									<div class="h-content3 sel-type1" id="server_frame" style="border-bottom: 1px solid #CCC;color: #9a9a9a;overflow-x: hidden;width:100%;">
										<div class="form-tag" style="width:105px;line-height:43px;padding:0px;">
											<em class="imp">*</em>服务器范围：
										</div>
										<!-- <div class="form-c c-form-host" style="min-width: 1173px;margin-left: 85px;" id="server_frame_list">
											<div class="item" style="width:229px;margin-left: -14px;">
												<div class="" id="ips" style="float:left;width: 162px;margin-left: 17px;"></div>
												<i class="ctrl add" style="margin-top: 6px" onclick="add_server_scope(this)"></i>
											</div>
										</div> -->
										<div id="ip_n" name="ip_n" class="form-c c-form-host" style="float:left;padding-left:10px;padding-bottom:0px;width:auto;min-width: 380px;" value="0">
											<span class="ss ss-add" id="ip_span" value="0" style="float:left;width: 312px;position:static;padding: 0 7px 10px 0;">
												<input type="text" class="form-text form-text2" id="input1" onblur="_addIp($('#btn1'),1);" placeholder="起始IP地址" style="width:122px;">
												<span style="vertical-align:middle;">-</span>
												<input type="text" class="form-text form-text2" id="input2" onblur="_addIp($('#btn1'),1);" placeholder="结束IP地址" style="width:122px;">
												<i class="ctr ctr-add" id="btn1" onclick="_addIp(this);" style="margin-left: 5px;"></i>
											</span>
										</div>
									</div>
									<div class="dialog-cont" id="server_suspend" style="display:none;max-height:500px">
										<div class="container" style="margin-top: -10px;">
											<div class="c-cont2" style="padding: 0px;">
												<div class="c-wrap" style="padding: 0px 0 0">
													<div class="c-exp" style="">

														<div class="h-explorer1" style="border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-image: initial;margin: 0px auto;">
															<div class="h-top">
																<div class="form-item" style="padding: 0 0 0 21px;float:left;width:auto;margin:3px;">
																	<span class="form-tag" style="float:left;width:auto;">
																		<em class="imp">*</em>名称：</span>
																	<div class="form-c" style="float:left;padding-left:0px;">
																		<input type="text" class="form-text" id="d_n" name="d_n" style="width:160px;" maxlength="128" onblur="regCheck(this,nameReg);">
																		<i class="v-check" style="    margin: 7px 0 0 -26px;"></i>
																		<span>特殊字符仅支持下划线、横杠、小数点</span>
																	</div>
																</div>
															</div>

															<div class="h-catelog h-catelog2 h-catelog2_tmp" style="width:353px;max-height:400px;background: none;overflow-x: hidden;">
																<h2 style="font-size: 14px;padding: 19px 0 0 0;font-weight: 400;">IP地址：</h2>
																<div id="ip_n1" name="ip_n1" class="form-c c-form-host" style="padding-left:10px;width:360px;min-width:300px;float: left;"
																 value="0">
																	<span class="ss ss-add" id="ip_span1" value="0" style="position:static;padding-bottom: 10px;width:170px">
																		<input type="text" class="form-text" style="width:110px;">
																		<i class="ctr ctr-add" onclick="_addIp1(this)" style="margin-left: 5px;"></i>
																	</span>
																</div>
																<h2 style="font-size: 14px;padding:0px;float:left;font-weight: 400;">IP区间：</h2>
																<div id="ip_n" name="ip_n" class="form-c c-form-host" style="padding-left:10px;width:320px;min-width:300px;float: left;"
																 value="0">
																	<span class="ss ss-add" id="ip_span" value="0" style="position:static;padding-bottom: 10px;">
																		<input type="text" class="form-text" placeholder="起始IP地址" style="width:110px;">
																		<span style="vertical-align:middle;">-</span>
																		<input type="text" class="form-text" placeholder="结束IP地址" style="width:110px;">
																		<i class="ctr ctr-add" onclick="_addIp2(this);" style="margin-left: 5px;"></i>
																	</span>
																</div>
															</div>

															<div class="h-content2 h-catelog2_tmp" style="max-height:400px;overflow:hidden">
																<div class="h-top" style="background-color: #fff; margin-top: -22px;">
																	<div class="filter" style="float:right;  min-width: auto;">
																		<div id="waitTip" class="waitTip1" style="float: right;margin-top: 7px;margin-left: -26px;"></div>
																		<div class="search">
																			<select name="server_select" id="server_select" class="filter-select">
																				<option value="0" selected>所有</option>
																				<option value="hgname">组名</option>
																				<option value="hostname">主机名</option>
																				<option value="ip">IP</option>
																			</select>

																			<input type="text" class="filter-text server_text" placeholder="输入关键字" name="server_text" id="server_text" maxlength="128"
																			 onkeydown="if (event.keyCode == 13){_addFilter1(this,false);return false;} else return;">

																			<button class="btn filter-btn" onclick="_addFilter1(this,false)">
																				<i class="add-filter"></i>
																			</button>
																			<button class="btn filter-btn" onclick="_addFilter1(this,true)">
																				<i class="append-filter"></i>
																			</button>
																		</div>
																		<div class="search" id="clearFilter1" style="margin: 0px 15px 0px -16px;display:none;">
																			<button class="filter-btn" onclick="_clearFilter1(this)">
																				<i class="clear-filter"></i>
																			</button>
																		</div>
																		<div class="selector selector-multiple" id="filterWW" style="display: none;width: 146px;">
																			<span class="ww" style="width:9.5em">搜索条件</span>
																			<ul style="padding-left: 0px;    width: 146px;"></ul>
																		</div>
																	</div>
																</div>

																<div style="overflow: auto;width:100%;height:96%;margin-top: 2px;" id="hosttree_div">
																	<h2 style="font-size: 14px;margin-top:3px;">
																		<em class="imp">*</em>主机：</h2>
																	<ul id="userTree1" class="hosttree" style="padding: 0 0 0 0; float: left;    margin-top: 0px;"></ul>
																</div>
															</div>
														</div>
													</div>

													<div class="clearfix"></div>
													<div class="btns" style="margin-bottom: -25px;">
														<a href="javascript:;" class="btn btn-submit btn-normal">保&nbsp;&nbsp;存</a>
														<a href="javascript:;" class="btn btn-cancel btn-normal">重&nbsp;&nbsp;置</a>
													</div>
												</div>
											</div>
										</div>
									</div>
									<div class="h-top">

										<div class="h-tit">
											<div class="form-item form-nm" style="width:200px;">
												<div style="margin-top:-1px">
													<select name="" id="define_select" class="filter-select" style="width: 80px;margin-top:-2px" onchange="define_change(this);">
														<option value="1">已定义</option>
														<option value="2">自定义</option>
													</select>
												</div>
												<div id="mix_module" style="margin-top: -34px;margin-left: 85px;">
													<select name="" id="mix_select" class="filter-select" style="width: 80px;display:none;" onchange="mix_change(this);">
														<option value="1">所有</option>
														<option value="2">共有</option>
													</select>
												</div>
											</div>
										</div>
									</div>
									<div id="custom_info" style="display:none">
										<div class="h-catelog h-catelog2 h-content2_temp" style="height: 350px; width: 28.3%;background-color: #ffffff; padding: 0px;max-height:400px;overflow-x: hidden;">
											<div class="c-col2 ss" style="width: 320px;padding: 0;margin-left: 22px;margin-top: 10px;">

												<div>
													<span class="form-tag" style="float: none;">
														<em class="imp">*</em>账号：</span>	
												</div>

												<div class="ss-cont h-content3" id="account_module" style="padding: 0;min-width:100%">
													<li class="item">
														<select class="filter-select" name="" id="account_select" style="width:120px" onchange="change_account(this);">
														</select>
														<i class="ctrl add" onclick="_addaccount(this)"></i>
													</li>
												</div>
											</div>
										</div>
										<div class="h-catelog h-catelog2 h-content2_temp" style="height: 350px; width: 71.6%;background-color: #ffffff;padding: 0px;border-right:0px;max-height:400px">
											<div class="c-col2 ss">


												<div>
													<span class="form-tag" style="float: none;">
														<em class="imp">*</em>服务：</span>
												</div>
												<div class="h-content22" style="height: auto;width: 100%;overflow: hidden;padding: 0px;">
													<div class="c-table">


														<table cellpadding="0" cellspacing="0" style="margin-bottom:20px;">
															<thead>
																<tr>
																	<th>协议</th>
																	<th>端口</th>
																	<th>连接参数</th>
																	<th width="55"></th>
																</tr>
															</thead>

															<tbody id="service_list1" style="height:auto">

															</tbody>
															</tbody>
														</table>
														<div class="form">
															<div class="form-item form-item-100" style="width:100%">
																<div style="text-align: right;">
																	<a href="javascript:;" id="" class="btn btn-normal1" onclick="_getDialog1('add','');">添&nbsp;&nbsp;加</a>
																</div>
															</div>
														</div>
													</div>
												</div>


												<div class="dialog-cont" id="scDCTab1" style="display:none;">
													<div class="container">
														<div class="c-cont1" style="max-height:280px;overflow:auto; min-height: 220px;">
															<div class="c-wrap" style="padding:0 0 90px;margin-top: -10px;overflow: hidden;">
																<div class="c-form c-form-host col3" style="min-width:760px;">

																	<div class="clearfix"></div>
																	<div class="c-table" style="padding: 0;margin-left: 10px;">
																		<div class="form" style="overflow: hidden;">
																			<div class="form-item" style="width:284px;margin-left: -5px;" id="device_module">
																				<span class="form-tag">设备类型：</span>
																				<div class="form-c">
																					<select class="form-select" name="" id="device_type" onchange="change_device_type(this);" style="width: 140px;">
																						<option value="-1">请选择</option>
																					</select>
																				</div>
																			</div>
																			<div class="form-item" style="width:284px;margin-left: -10px;" id="module_server">
																				<span class="form-tag">模板载入：</span>
																				<div class="form-c">
																					<select class="form-select2" name="" id="def_server" onchange="show_def_server(this);" style="width: 140px;">
																						<option value="-1">请选择</option>
																					</select>
																				</div>
																			</div>
																			<div class="form-item" style="width: 284px;margin-left: -5px;">
																				<span class="form-tag">
																					<em class="imp">*</em>协议：</span>
																				<div class="form-c" id="ProtocolName"></div>
																				<!--
																				<div class="form-c">
																					<select class="form-select" name="" id="ProtocolName" style="width: 140px;">
																						<option value="">请选择</option>
																					</select>
																				</div>
																				-->
																			</div>
																			<div class="form-item" style="width: 284px;margin-left: -5px;">
																				<span class="form-tag">
																					<em class="imp">*</em>端口：</span>
																				<div class="form-c">
																					<input type="text" class="form-text" id="Port" maxlength="5" onkeyup="port_check(this);" style="width:108px">
																				</div>
																			</div>

																			<div class="form-item" style="width: 284px;margin-left: -5px;">
																				<span class="form-tag">连接参数：</span>
																				<div class="form-c" id="ConnParamName"></div>
																				<!--
																				<div class="form-c">
																					<select class="form-select" name="" id="ConnParamName" style="width: 140px;">
																						<option value="">请选择</option>
																					</select>
																				</div>
																				-->
																			</div>
																		</div>
																	</div>

																	<div class="btns" style="margin-bottom:-20px;">
																		<a href="javascript:;" class="btn btn-normal btn-submit">确&nbsp;&nbsp;定</a>
																		<a href="javascript:;" class="btn btn-normal" onclick="clear_serverdata();">重&nbsp;&nbsp;置</a>
																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>
												
												<div class="dialog-cont" id="protoDialog" style="display:none;">
													<div class="container">
														<div class="c-cont" style="min-height:200px;max-height:200px;overflow:auto;">
															<div class="c-form c-form-host" style="padding: 0 0 90px;min-width:0px;">
																<div class="clearfix"></div>
																<div class="c-table">
																	<div class="form">
																		<div class="form-item" style="width: 300px;">
																			<span class="form-tag" style="width: 72px;"><em class="imp">*</em>名称：</span>
																			<div class="form-c" style="padding-left: 0;">
																				<input type="text" class="form-text" id="Protocol_Name0" maxlength="15" style="width: 195px;" tabindex="1">
																				<i class="v-check" style=""></i>
																				<p class="form-tip" style="width: 185px;margin-left: 66px;">特殊字符仅支持下划线、横杠</p>
																			</div>
																		</div>
																		<div class="form-item" style="width: 185px;">
																			<span class="form-tag" style="width:85px;"><em class="imp">*</em>端口：</span>
																			<div class="form-c" style="padding-left: 0px;">
																				<input type="text" class="form-text" id="Port0" maxlength="5" style="width: 50px;" tabindex="1">
																				<i class="v-check" style=""></i>
																				<p class="form-tip" style="width: 78px;margin-left: 80px;">0-65535之间</p>
																			</div>
																		</div>
																		<div class="form-item" style="width: 185px;">
																			<span class="form-tag" style="width:85px;"><em class="imp">*</em>端口1：</span>
																			<div class="form-c" style="padding-left: 0px;">
																				<input type="text" class="form-text" id="Port1" maxlength="5" style="width: 50px;" tabindex="1">
																				<i class="v-check" style=""></i>
																				<p class="form-tip" style="width: 78px;margin-left: 80px;">0-65535之间</p>
																			</div>
																		</div>
																		<div class="form-item" style="width: 250px;">
																			<span class="form-tag" style="width:85px;">描述：</span>
																			<div class="form-c" style="padding-left: 0px;">
																				<input type="text" class="form-text" id="Description0" maxlength="128" style="width:170px;" tabindex="1">
																			</div>
																		</div>
																	</div>
																	<!-- <div class="btns" style="padding: 10px 0 10px;">
																		<a href="javascript:;" class="btn btn-normal btn-submit" >保&nbsp;&nbsp;存</a>
																		<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
																	</div> -->
																</div>
															</div>
														</div>
													</div>
												</div>
												
												<div class="dialog-cont" id="connDialog" style="display:none;">
													<div class="container">
														<div class="c-cont" style="max-height:500px;">
															<div class="c-form" style="">
																<div class="form" style="padding-left:50px;">
																	<div class="form-item">
																		<span class="form-tag"><em class="imp">*</em>名称：</span>
																		<div class="form-c">
																			<input type="text" class="form-text" id="d_n_con" name="d_n_con" onblur="regCheck(this,cnameReg);" maxlength="128">
																			<i class="v-check"></i>
																			<p class="form-tip">特殊字符仅支持下划线、横杠、小数点</p>
																		</div>
																	</div>
																	<div class="form-item">
																		<span class="form-tag"><em class="imp">*</em>协议类型：</span>
																		<div class="form-c">
																			<select class="form-select form-select2" name="Protocol_con" id="Protocol_con" style="width:150px;">
																				<option value="0" selected>请选择</option>
																			</select>
																		</div>
																		<span class="form-tag" id="Protocol_port"></span>
																	</div>
																	<!-- SSH -->
																	<div id="SSH" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag">版本号：</span>
																			<div class="form-c">
																				<select class="form-select" name="ServiceName_ssh" id="ServiceName_ssh" style="width:150px;">
																					<option value="1" selected>1</option>
																					<option value="2" >2</option>
																				</select>
																			</div>
																		</div>
																	</div>
																	<!--HTTP-->
																	<div id="HTTP" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag"><em class="imp">*</em>URL：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="url" name="url" maxlength="128" style="width:252px;padding-right:8px;">
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">账号：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="UserName" name="UserName" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">密码：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="UserPwd" name="UserPwd" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">提交元素：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="Submit" name="Submit" maxlength="128" style="width:252px;padding-right:8px;">
																			</div>
																		</div>
																	</div>
																	<!--HTTPs-->
																	<div id="HTTPs" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag"><em class="imp">*</em>URL：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="httpsurl" name="httpsurl" maxlength="128" style="width:252px;padding-right:8px;">
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">账号：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="httpsUserName" name="httpsUserName" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">密码：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="httpsUserPwd" name="httpsUserPwd" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">提交元素：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="httpsSubmit" name="httpsSubmit" maxlength="128" style="width:252px;padding-right:8px;">
																			</div>
																		</div>
																	</div>
																	<!--ORACLE-->
																	<div id="ORACLE" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag"><em class="imp">*</em>指定：</span>
																			<div class="form-c">
																				<select class="form-select" name="appoint" id="appoint" style="width:150px;">
																				<option value="0" text="请选择" selected>请选择</option>
																				<option value="SID" text="SID">SID</option>
																				<option value="SERVICE_NAME" text="SERVICE_NAME">SERVICE_NAME</option>
																			</select>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag"><em class="imp">*</em>实例名或服务名：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="s_n" name="s_n" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">连接方式：</span>
																			<div class="form-c">
																				<select class="form-select" name="conn" id="conn" style="width:150px;">
																				<option value="0" text="未指定" selected>未指定</option>
																				<option value="NORMAL" text="NORMAL">NORMAL</option>
																				<option value="SYSDBA" text="SYSDBA">SYSDBA</option>
																				<option value="SYSOPER" text="SYSOPER">SYSOPER</option>
																			</select>
																			</div>
																		</div>
																	</div>
																	<!--RADMIN-->
																	<div id="RADMIN" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag">认证方式：</span>
																			<div class="form-c">
																				<select class="form-select" name="authtype" id="authtype" style="width:150px;">
																				<option value="0" text="未指定" selected>未指定</option>
																				<option value="RADMIN" text="RADMIN">RADMIN</option>
																				<option value="Windows" text="Windows">Windows</option>
																			</select>
																			</div>
																		</div>
																	</div>
																	<!--MSSQL-->
																	<div id="MSSQL" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag"><em class="imp">*</em>实例名：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="o_n" name="o_n" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">认证方式：</span>
																			<div class="form-c">
																				<select class="form-select" name="R_authtype" id="R_authtype" style="width:150px;">
																				<option value="0" text="未指定" selected>未指定</option>
																				<option value="SQL服务器验证" text="SQL服务器验证" >SQL服务器验证</option>
																				<option value="Windows验证" text="Windows验证" >Windows验证</option>
																				<option value="Windows单一登录" text="Windows单一登录" >Windows单一登录</option>
																			</select>
																			</div>
																		</div>
																	</div>
																	<!--MYSQL &&　DB2-->
																	<div id="MY_DB2" style="display:none;">
																		<div class="form-item" style="min-height:40px;">
																			<span class="form-tag"><em class="imp">*</em>数据库名：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="sql_n" name="sql_n" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																	</div>
																	<div id="MY_ConnType" style="display:none;">
																		<div class="form-item" style="min-height:40px;">
																			<span class="form-tag"><em class="imp">*</em>版本号：</span>
																			<div class="form-c">
																				<select class="form-select" name="select_my" id="select_my" style="width:150px;">
																					<option value="0" text="0" selected>&lt;7.5</option>
																					<option value="1" text="1" >≥7.5</option>
																				</select>
																			</div>
																		</div>
																	</div>
																	<div id="DB2" style="display:none;">
																		<div class="form-item" style="min-height:40px;">
																			<span class="form-tag"><em class="imp">*</em>数据库名：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="dbsql_n" name="dbsql_n" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																	</div>
																	<!--SYBASE-->
																	<div id="SYBASE" style="display:none;">
																		<div class="form-item" style="min-height:40px;">
																			<span class="form-tag"><em class="imp">*</em>实例名：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="sy_o_n" name="sy_o_n" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																	</div>
																	<!---->
																</div>
															</div>
															<!-- <div class="c-form">
																<div class="btns">
																	<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
																	<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
																</div>
															</div> -->
														</div>
													</div>
												</div>
												
											</div>
										</div>
									</div>
									<div id="defined_info" style="">
										<div class="h-catelog h-catelog2 h-content2_temp" style="height: 350px; width:30%;background-color: #ffffff; padding: 0px;border-right: 1px solid #CCC;/*overflow:hidden;*/">
											<div class="c-col2 ss">

												<div>
													<span class="form-tag" style="float: none;">
														<em class="imp">*</em>账号：</span>
													
													<select name="" id="a_mix_select" class="filter-select" style="width: 80px;display:none;margin-left: 16px;" onchange="a_mix_change(this);">
														<option value="1">指定</option>
														<option value="2">所有</option>
													</select>
													
												</div>

												<div class="ss-cont" id="account" style="padding: 0;">
													<div class="h-content222" style="height: auto;width: 100%;overflow: hidden;padding: 0px;">
														<div class="c-table tab-type2" style="padding: 0;margin-top: 10px;">
															<table cellpadding="0" cellspacing="0" style="">
																<thead>
																	<tr>
																		<th width="50">
																			<input type="checkbox" class="form-checkbox" id="check_all_a" />
																		</th>
																		<th>账号</th>

																	</tr>
																</thead>
															</table>
														</div>
														<div class="c-table tab-type2" style="padding: 0;overflow:auto;">
															<table cellpadding="0" cellspacing="0" style="">
																<!--
																<thead>
																	<tr>
																		<th width="50">
																			<input type="checkbox" class="form-checkbox" id="check_all_a" />
																		</th>
																		<th>账号</th>

																	</tr>
																</thead>
																-->
																<tbody id="service_list_a" style="height:auto;">
																</tbody>
															</table>
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="h-catelog h-catelog2 h-content2_temp" style="height: 350px; width:69.9%;background-color: #ffffff;padding: 0px; border-right: 0px;/*overflow:hidden;*/">
											<div class="c-col2 ss">
												<div>
													<span class="form-tag" style="float: none;">
														<em class="imp">*</em>服务：</span>
													<select name="" id="s_mix_select" class="filter-select" style="width: 80px;display:none;margin-left: 16px;" onchange="s_mix_change(this);">
														<option value="1">指定</option>
														<option value="2">所有</option>
													</select>
												</div>
												<div class="h-content222" style="height: auto;width: 100%;overflow: hidden;padding: 0px;" id="service_module">
													<div class="c-table tab-type2" style="padding: 0;margin-top: 10px;">
														<table cellpadding="0" cellspacing="0" style="">
															<thead>
																<tr>
																	<th width="50">
																		<input type="checkbox" class="form-checkbox" id="check_all" />
																	</th>
																	<th>协议</th>
																	<th>端口</th>
																	<th>连接参数</th>

																</tr>
															</thead>
														</table>
													</div>
													
													<div class="c-table tab-type2" style="padding: 0;overflow:auto;">
														<table cellpadding="0" cellspacing="0" style="">
															<!--
															<thead>
																<tr>
																	<th width="50">
																		<input type="checkbox" class="form-checkbox" id="check_all" />
																	</th>
																	<th>协议</th>
																	<th>端口</th>
																	<th>连接参数</th>

																</tr>
															</thead>
															-->
															<tbody id="service_list2" style="height:auto">
															</tbody>
														</table>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div id="pointSet2">
									<div class="h-content2 p-h-2" style="overflow:hidden;">
										<div class="h-top" style="background-color: #fff;    margin-top: -22px;">
											<div class="filter" style="float:right;min-width:auto;">
												<div id="waitTip" class="waitTip" style="float: right;margin-top: 7px;margin-left: -26px;"></div>
												<div class="search">
													<select name="server_select1" id="server_select1" class="filter-select">
														<option value="0" selected>所有</option>
														<option value="hgname">组名</option>
														<option value="hostname">主机名</option>
														<option value="ip">IP</option>
														<option value="hostservicename">服务名</option>
														<option value="accountname">账号</option>
													</select>
													<input type="text" class="filter-text" 
													placeholder="输入关键字" name="server_text" id="server_text1" 
													maxlength="128" style="border-left:0px;padding-right: 22px;"
													onchange="if($('#server_text1').val()==''){$('#server_text_check1').hide();}else{$('#server_text_check1').show();}"
													onkeyup="if($('#server_text1').val()==''){$('#server_text_check1').hide();}else{$('#server_text_check1').show();}"
													onkeydown="if($('#server_text1').val()==''){$('#server_text_check1').hide();}else{$('#server_text_check1').show();}if (event.keyCode == 13){_addFilter2(this,false);return false;} else return;" onblur="change_input(this);">
													<i class="v-check v-wrong" id="server_text_check1" 
													 onclick="_clear_keyword2(this)" 
													 style="display:none;cursor: pointer;float: left;position: static;"></i>
													<button class="btn filter-btn" onclick="_addFilter2(this,false)">
														<i class="add-filter"></i>
													</button>
													<button class="btn filter-btn" onclick="_addFilter2(this,true)">
														<i class="append-filter"></i>
													</button>
												</div>
												<div class="search" id="clearFilter2" style="margin: 0px 15px 0px -16px;display:none;">
													<button class="filter-btn" onclick="_clearFilter2(this)">
														<i class="clear-filter"></i>
													</button>
												</div>
												<div class="selector selector-multiple" id="filterWW2" style="display: none;width: 146px;">
													<span class="ww" style="width: 132px;">搜索条件</span>
													<ul style="padding-left: 0px;    width: 146px;"></ul>
												</div>
											</div>
										</div>
										<div style="overflow: auto;width:100%;height:94%;margin-top:10px;" id="hosttree_div1">
											<h2 style="margin-left: 30px;">
												<em class="imp">*</em>主机：</h2>
											<ul id="hostTree" class="hosttree"></ul>
										</div>
									</div>
								</div>

							</div>
						</div>

						<div class="clearfix"></div>
						<div class="btns">
							<a href="javascript:;" class="btn btn-normal" onclick="next(1);">上一步</a>
							<a href="javascript:;" class="btn btn-normal" onclick="next(3);">下一步</a>
						</div>
					</div>
				</div>

				<!--page 2-->
				<div class="c-cont" style="display: none;">
					<div class="proItems">
						<div class="pro-item">
							<div class="pro-item-tit">RDP配置</div>
							<div class="pro-item-cont">

								<div class="item linkmode_div0">
									<div class="label">连接模式：</div>
									<div class="group">
											<label class="web_con"><input type="radio" name="linkmode0" checked>WEB访问</label>
											<label class="local_client"><input type="radio" name="linkmode0">本地客户端</label>
									</div>
								</div>

								<div class="item">
									<div class="label">屏幕大小：</div>
									<div class="group">
										<select name="" id="screensize" class="select2" style="width: 100px">
											<option value="0">自适应</option>
											<option value="1">全屏</option>
											<option value="800*600">800*600</option>
											<option value="1024*768">1024*768</option>
											<option value="1280*800">1280*800</option>
											<option value="1440*900">1440*900</option>
										</select>
									</div>
								</div>

								<div class="item">
									<div class="label">设置：</div>
									<div class="group">
										<label><input type="checkbox" name="" id="EnableRDPClipboard">开启RDP剪贴板</label>
										<label><input type="checkbox" name="" id="EnableRDPDiskMap">开启磁盘映射</label>
									</div>
								</div>

								<div class="item disk_map" id="DiskMap" style="display: none;">
									<div class="label">磁盘映射：</div>
									<div class="group">
										<label><input type="checkbox" name="" id="">C:</label>
										<label><input type="checkbox" name="" id="">D:</label>
										<label><input type="checkbox" name="" id="">E:</label>
										<label><input type="checkbox" name="" id="">F:</label>
										<label><input type="checkbox" name="" id="">G:</label>
										<label><input type="checkbox" name="" id="">H:</label>										
									</div>
								</div>

								<div class="item">
									<div class="label">访问方式：</div>
									<div class="group">
										<select name="" id="access_select" class="select2" style="width:120px;">
											<option value="NORMAL">NORMAL</option>
											<option value="CONSOLE">CONSOLE</option>
										</select>
									</div>
								</div>
								<div class="item passageway" style="display: none;" id="accessType_Rdp">
									<div class="label">方式：</div>
										<div class="group ctr" style="width:235px;">
											<select name="" id="passageway_select1" class="select2" style="width:120px;">
											<option value="1">端口访问</option>
											<option value="2">访问通道</option>
											</select>
									</div>
								</div>								
								<!-- <div class="item">
									<div class="label">启动次数：</div>
									<div class="group">
										<input name="" class="text" id="RDPTime" style="width: 40px;display: inline-block;height: 26px;padding: 0px 1px 0 1px;border: 1px solid #b2b2b2;border-radius: 5px;vertical-align: middle;text-overflow: ellipsis;margin-right: 5px;text-align: center;" type="number" tabindex="-1" aria-hidden="true">次
									</div>
								</div> -->
							</div>
						</div>

						<div class="dialog-cont" id="remarkDialog" style="display:none;">
							<div class="container">
								<div class="c-cont" style="max-height:300px;">
									<div class="c-form" style="">
										<div class="clearfix"></div>
										<div class="form">
											<div class="form-item" style="">
												<span class="form-tag" style=""><em class="imp">*</em>访问备注：</span>
												<div class="form-c" style="">
													<textarea id="operation_content" class="form-textarea" name="" cols="30" rows="10"></textarea>
												</div>
											</div>
										</div>
									</div>
									<div class="c-form" style="">
										<div class="btns" style="">
											<a href="javascript:;" class="btn btn-normal btn-submit" >保&nbsp;&nbsp;存</a>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!---->
						<div class="pro-item">
							<div class="pro-item-tit">SSH配置</div>
							<div class="pro-item-cont">

								<div class="item linkmode_div1">
									<div class="label">连接模式：</div>
									<div class="group">
										<label class="web_con"><input type="radio" name="linkmode1" checked>WEB访问</label>
										<label class="local_client"><input type="radio" name="linkmode1">本地客户端</label>
									</div>
								</div>

								<div class="item" style="display: none;">
									<div class="label">本地客户端：</div>
									<div class="group">
										<select name="" id="ClientSSH" class="select2"  style="width: 160px">
											<!--<option value="Putty">Putty</option>
											<option value="SecureCRT">SecureCRT</option>
											<option value="XShell">XShell</option>-->
										</select>
									</div>
								</div>

								<div class="item">
									<div class="label">访问方式：</div>
									<div class="group">
										<select name="" id="AuthTypeSSH" class="select2" style="width: 120px">
											<option value="1">SSH1</option>
											<option value="2" selected >SSH2</option>
										</select>
									</div>
								</div>

								<div class="item passageway" style="display: none;">
									<div class="label">方式：</div>
										<div class="group ctr" style="width:235px;">
											<select name="" id="passageway_select2" class="select2" style="width:120px;">
											<option value="1">端口访问</option>
											<option value="2">访问通道</option>
											</select>
									</div>
								</div>
								<!-- <div class="item">
									<div class="label">启动次数：</div>
									<div class="group">
										<input name="" class="text" id="SSHTime" style="width: 40px;display: inline-block;height: 26px;padding: 0px 1px 0 1px;border: 1px solid #b2b2b2;border-radius: 5px;vertical-align: middle;text-overflow: ellipsis;margin-right: 5px;text-align: center;" type="number" tabindex="-1" aria-hidden="true">次
									</div>
								</div> -->
							</div>
						</div>

						<!---->
						<div class="pro-item">
							<div class="pro-item-tit">TELNET配置</div>
							<div class="pro-item-cont">
							
								<div class="item linkmode_div2">
									<div class="label">连接模式：</div>
									<div class="group">
										<label class="web_con"><input type="radio" name="linkmode2" checked>WEB访问</label>
										<label class="local_client"><input type="radio" name="linkmode2">本地客户端</label>
									</div>
								</div>

								<div class="item" style="display: none;">
									<div class="label">本地客户端：</div>
									<div class="group">
										<select name="" id="ClientTELNET" class="select2" style="width: 160px">
											<!--
											<option value="Netterm">Netterm</option>
											<option value="Putty">Putty</option>
											<option value="SecureCRT">SecureCRT</option>
											<option value="XShell">XShell</option>-->
										</select>
									</div>
								</div>
								<div class="item passageway" style="display: none;">
									<div class="label">方式：</div>
										<div class="group ctr" style="width:235px;">
											<select name="" id="passageway_select3" class="select2" style="width:120px;">
											<option value="1">端口访问</option>
											<option value="2">访问通道</option>
											</select>
									</div>
								</div>								
								<!-- <div class="item">
									<div class="label">启动次数：</div>
									<div class="group">
										<input name="" class="text" id="TELNETTime" style="width: 40px;display: inline-block;height: 26px;padding: 0px 1px 0 1px;border: 1px solid #b2b2b2;border-radius: 5px;vertical-align: middle;text-overflow: ellipsis;margin-right: 5px;text-align: center;" type="number" tabindex="-1" aria-hidden="true">次
									</div>
								</div> -->
							</div>
						</div>

						<!---->
						<!-- <div class="pro-item" id="Part1" style="display: none;">
							<div class="pro-item-tit">访问备注</div>
							<div class="pro-item-cont">								
								<div class="item">
									<div class="label"><em class="imp">*</em>访问备注：</div>
									<div class="group">
										<input name="" class="text" id="operation_content" style="width: 40px;">
									</div>
								</div>
							</div>
						</div> -->

					</div>
				</div>

				<div id="client_module" style="overflow:hidden;height: 200px;display:none;">
						<div class="c-form" style="padding:10px;">
							<span class="form-tag" style="width:222px;">路径：</span>
							<div style="width: 450px;margin-left: 200px;">
								<label style="float: left;margin-right:8px;">
									<select class="form-select select_clt" name=""  style="width: 60px;">
										<option value="0" selected >全局</option>
										<option value="1"  >指定</option>
									</select>
								</label>
								<input class="form-text" id="client_input1" type="text" style="float: left;"/>
								<a href="javascript:;" class="btn btn-normal btn-global" onclick="get_win_path(this);">浏&nbsp;&nbsp;览</a>
							</div>
						</div>
						
						<div class="c-form" style="padding:10px;">
							<span class="form-tag" style="width:222px;">路径：</span>
							<div style="width: 450px;margin-left: 200px;">
								<label style="float: left;margin-right:8px;">
									<select class="form-select select_clt" name=""  style="width: 60px;">
										<option value="0" selected >全局</option>
										<option value="1"  >指定</option>
									</select>
								</label>
								<input class="form-text" id="client_input2" type="text" style="float: left;"/>
								<a href="javascript:;" class="btn btn-normal btn-global" onclick="get_win_path(this);">浏&nbsp;&nbsp;览</a>
							</div>
						</div>
						<div class="btns" style="/*padding: 20px 0 0px;*/position:absolute;    width: 890px;margin-left: -20px;">
							<a href="javascript:;" class="btn btn-normal btn-submit" >保&nbsp;&nbsp;存</a>
							<a href="javascript:;" class="btn btn-normal btn-cancel" >取&nbsp;&nbsp;消</a>
						</div>
				</div>
			</div>
		</div>

		<div class="btns" id="pageBtns">
			<a href="javascript:;" class="btn btn-normal btn-cancle" onclick="_goStep(2,this)">下一步</a>
			<a href="javascript:;" class="btn btn-normal btn-cancle" onclick="_goStep(1,this)" style="display: none;">上一步</a>
			<a href="javascript:;" class="btn btn-normal btn-cancle" onclick="_submit();" style="display: none;">确&nbsp;&nbsp;定</a>
		</div>
	</div>

	<script>
		var userAgent = navigator.userAgent;
		var ie8 = userAgent.indexOf('Trident/4.0');

		if(ie8 != -1){
			document.write('<script src="/manage/js/jquery-IE8.js"></' + 'script>');
		}else{
			document.write('<script src="/manage/js/jquery.min.js"></' + 'script>');
		}
	</script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/common_e.js"></script>
	<script src="/manage/js/layer.js"></script>

	<!--icheck-->
	<script src="/manage/js/icheck.min.js"></script>
	<!--select2-->
	<script src="/manage/js/select2.full.min.js"></script>
	<!-- xSelect -->
	<script src="/manage/js/xSelect.js"></script>
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<!-- dialog -->
	<script type="text/javascript" src="/manage/js/dialog-plus.js"></script>
	<link rel="stylesheet" href="/manage/css/ui-dialog.css" type="text/css" />
	<link rel="stylesheet" href="/manage/css/G-style.css" type="text/css" />
	<style>
		.ui-dialog-body {
			padding: 20px 0;
			text-align: center;
		}
		.c-form-host span.ss {
			padding-left: 
		}	
		.h-content3 .item {
			width: auto;
			padding: 0 0 10px 0;
		}
		.h-content3.sel-type1{
			padding:0px;
		}
		.select2-container .select2-selection--single {
			height: 28px;
			line-height: 26px;
		}
		.select2-container--default .select2-selection--single .select2-selection__rendered {
			line-height: 26px;
		}
		.filter .selector.selector-multiple:after {
			content: '';
			display: block;
			border-color: #888 transparent transparent transparent;
			border-style: solid;
			border-width: 5px 4px 0 4px;
			height: 0;
			width: 0px;
			overflow: hidden;
			position: absolute;
			margin: 11px 0 0 9.3em;
		}
		.h-content22 .form-item-100 .btn {
			display: inline-block;
			width: 90px;
			height: 32px;
			border: 1px solid #DDD;
			text-align: center;
			line-height: 32px;
			border-radius: 18px;
			margin: 0 10px;
			background-color: #fff;
			transition: background-color 0.4s;
			color: #7c7c7c;
		}

		.h-content22 .form-item-100 .btn:hover {
			background-color: #8d808a;
			color: #fff;
		}
		.select2-container--open {
			z-index: 9999999;
		}

		.labels2 label {
			width: 170px;
		}

		.filter .search .filter-text {
			border-left: 0px;
		}

		.filter .search .server_text {
			border-left: 1px solid #ccc;
		}

		.set-type .input-group {
			float: left;
			width: 90px;
			height: 26px;
			overflow: hidden;
			border: 1px solid #acacac;
			border-radius: 3px;
			text-align: center;
			/*border-radius: 5px;*/
		}

		.form-text2 {
			padding: 0 8px;
		}

		.btns {
			background-color:#ffffff;
		}
	
	</style>
	<style>
		a.btn-global{
			float: left;
			padding: 0px 8px;
			line-height: 26px;
			color: #8D808A;
			border: 1px solid #8D808A;
			margin-left:8px;
			border-radius: 5px;
			transition: all 0.4s;
		}
		a.btn-global:hover{
			background-color: #8D808A;
			border-color: #8D808A;
			color: #fff;
		}
	</style>
	<script>
		$('.form-checkbox,.form-radio,.ss input').iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		});
		$('.proItems input[type=checkbox],.proItems input[type=radio]').iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		});
		$('#typeSet').select2({ minimumResultsForSearch: -1 });
		$('.proItems .select2').select2({minimumResultsForSearch: -1,tags: true});
		$('.filter-select,.select2,.type-select').select2({ minimumResultsForSearch: -1 });
		$('.form-select').select2({ minimumResultsForSearch: -1 });
		$('.select_clt').select2({ minimumResultsForSearch: -1 });
	</script>
	
<script>
	var RDPDisplay = SSHDisplay = TELNETDisplay = 0;//是否disabled 0->disabled  1->show
	var HideIP;
	var EAccount;//当前登录的运维用户的可选账号
	var path_array;
	var IsTunnel;
	var MapPort;
	var global_data;
	var remote_data;
	var MARKFLAG = 0; //0->未填写过备注
	var remark_need = 0;
	var client_ip_global='';
	var document_domain = "";
	var window_location_host = "";
	$(function(){
		if(IEVersion() == 8){
			loadStyle('/manage/css/ie-css.css');
		}
		if( IEVersion() < 10 && IEVersion() >0){
			$('.web_con').remove();
			$('.local_client').iCheck('check');
		}
		//用于数据库保存权限
		$.ajax({
			url:'/bhost/Get_AuthObjectByLevel',
			type:'post',
			async:false,
			cache:false,
			data:{a0:se,z1:-1},
			success:function(result){
			}
		})
		$.ajax({
			url: "/bhost/RealIPGet",
			type: "POST",
			async: false,
			data: { a0: se, a1: document.domain},
			success: function (result) {
				var result = JSON.parse(result);
				if(result.result == true){
					if(result.dev_type == "gluster"){
						document_domain = result.info;
						window_location_host = result.info;
					}else{
						document_domain = document.domain;
						window_location_host = window.location.host;
					}
				}else{
					document_domain = document.domain;
					window_location_host = window.location.host;
				}
			}
		})
		Get_GlobalStrategy();
		get_account();
		get_server();		
		//get_AccessScope();
		_initList();
		$("#EnableRDPDiskMap").on('ifChecked',function(){
			//if($('.local_client').find('input').prop('checked')){
				$("#DiskMap").show();
			//}
		}).on('ifUnchecked',function(){
			$("#DiskMap").hide();
		})
		$('.linkmode_div0 .web_con').find('input').on('ifChecked',function(){
			// if($('#EnableRDPDiskMap').prop('checked')){
				$("#accessType_Rdp").hide();
			//}
		})
		$('.linkmode_div0 .local_client').find('input').on('ifChecked',function(){
			//if($('#EnableRDPDiskMap').prop('checked')){
				$("#accessType_Rdp").hide();
				if (global_data.IsTunnel){
					$("#passageway_select1").empty().append('<option value="2">访问通道</option>');
				}else{
					$("#passageway_select1").empty().append('<option value="1">端口访问</option>');
				}
			//}
		})
		$('.linkmode_div1 .web_con').find('input').on('ifChecked',function(){
			$(".linkmode_div1").siblings('.item').eq(0).hide();
			$(".linkmode_div1").siblings('.item').eq(2).hide();
		})
		$('.linkmode_div1 .local_client').find('input').on('ifChecked',function(){
			$(".linkmode_div1").siblings('.item').show();
			$(".passageway").hide();
			if (global_data.IsTunnel){
				$("#passageway_select2").empty().append('<option value="2">访问通道</option>');
			}else{
				$("#passageway_select2").empty().append('<option value="1">端口访问</option>');
			}
		})
		$('.linkmode_div2 .web_con').find('input').on('ifChecked',function(){
			$(".linkmode_div2").siblings('.item').hide();
		})
		$('.linkmode_div2 .local_client').find('input').on('ifChecked',function(){
			$(".linkmode_div2").siblings('.item').show();
			$(".passageway").hide();
			if (global_data.IsTunnel){
				$("#passageway_select3").empty().append('<option value="2">访问通道</option>');
			}else{
				$("#passageway_select3").empty().append('<option value="1">端口访问</option>');
			}	
		})

		$('#hostTree').on('change', 'span.authtype input', function () {
			var checked = $(this).prop('checked');
			_authTypeTheme($(this));
			if (checked) {
				var $input1 = $(this).parent().parent().siblings('ul').find('span.authtype input');
				var $input2 = $(this).parent().parent().siblings('ul').find('input.zcheck');
				var $input3 = $(this).parent().parent().siblings('input.zcheck');
				$input2.attr("data-loadlast", 2);
				$input3.attr("data-loadlast", 2);
				$(this).attr('data-ifselect', true);
				$input1.prop('disabled', true);
				_authTypeTheme($input1);
				$input2.prop('checked', true).prop('disabled', true);
				$(this).parent().parent().siblings('input.zcheck').prop('checked', true).next('span.checkbox').attr('class', 'checkbox checked');
				$.each($input2, function () {
					$(this).next('span.checkbox').attr('class', 'checkbox checked disabled');
				});
				_checkEvent($(this).parent().parent().siblings('input.zcheck'));
			} else {
				var $input1 = $(this).parent().parent().siblings('ul').children('li').find('span.authtype').find('input');
				var $input2 = $(this).parent().parent().siblings('ul').children('li').find('input.zcheck');
				$(this).attr('data-ifselect', false);
				$input1.prop('disabled', false);
				_checkEvent1($(this));
				authtype_click = 1;
				
			}
		});	
		$("#check_all").on("ifClicked", function () {
			if (!$(this).prop("checked")) {
				$("#service_list2").find('input').iCheck('check');
			} else {
				$("#service_list2").find('input').iCheck('uncheck');
			}
		});		
		get_hostdirectory(0, 0, TYPE);
		_viewHTML(h_data, '#hostTree', 0);
		$.ajax({
			url: "/bhost/PGet_LocalClient",
			type:"POST",
			async:false,
			data:{a0:se},
			success:function(result){
				var result=JSON.parse(result);
				if(result.Result){
					path_array = result.info.data;
					client_ip_global = result.client_ip_global;
					//case "SSH":
					//case "RLOGIN":
					var Putty_flag = 0;
					var SecureCRT_flag = 0;
					var XShell_flag = 0;
					
					var Netterm_flag = 0;
					var option_str = "";
					$.each(path_array,function(i,item){
						//if (item.ProtocolName == pro_name){
							if (item.ClientName == "Putty"){
								Putty_flag = 1;
							}else if (item.ClientName == "SecureCRT"){
								SecureCRT_flag = 1;
							}else if (item.ClientName == "XShell"){
								XShell_flag = 1;
							}else if (item.ClientName == "Netterm"){
								Netterm_flag = 1;
							}
						//}
					});
					
					if (Putty_flag == 1){
						option_str = option_str + '<option value="Putty">Putty</option>';
					}else{
						option_str = option_str + '<option value="Putty">Putty(未设置)</option>';
					}
					
					if (SecureCRT_flag == 1){
						option_str = option_str + '<option value="SecureCRT">SecureCRT</option>';
					}else{
						option_str = option_str + '<option value="SecureCRT">SecureCRT(未设置)</option>';
					}
					
					if (XShell_flag == 1){
						option_str = option_str + '<option value="XShell">XShell</option>';
					}else{
						option_str = option_str + '<option value="XShell">XShell(未设置)</option>';
					}
					$('#ClientSSH').append(option_str).trigger('change');
					
					if (Netterm_flag == 1){
						option_str =  '<option value="Netterm">Netterm</option>' +option_str;
					}else{
						option_str =  '<option value="Netterm">Netterm(未设置)</option>' + option_str;
					}
					$('#ClientTELNET').append(option_str).trigger('change');
					
					
				}else{
					_alert(2,'全局设定',result.ErrMsg);
					return false;
				}
			}
		});
		$.ajax({
			url:'/bhost/get_globalstrategy',
			type:'post',
			async:false,
			data:{a0:se},
			success:function(result){
				global_data = JSON.parse(result);
				IsTunnel = global_data.IsTunnel + "";
				MapPort = global_data.MapPort;
			}
		});
		$.each(window.parent._power,function(i,item){
			manage_auth_array.push(item.SubMenuId);
		});
		_initSize();
	});

	$(window).resize(function(){
		_initSize();
	});
	function _initSize(){
		var h1 = $("#server_frame").width() - 145;
		$("#ip_n").width(h1);
	}
	var CRTNum = NettermNum = RDPNum = 0;
	var I = 0;
	var Cmd_Array = []
	function _submit(){
		check_cilent = false;
		list_ip = [];
		list_ip_ssh = [];
		Cmd_Array = [];
		$.ajax({
			url:'/bhost/get_globalstrategy',
			type:'post',
			async:false,
			data:{a0:se},
			success:function(result){
				global_data = JSON.parse(result);
				IsTunnel = global_data.IsTunnel + "";
				MapPort = global_data.MapPort;
			}
		})
		var arr_client_ssh = '';
		var arr_client_telnet = '';
		if($("#ClientSSH").attr("disabled") == false || $("#ClientSSH").attr("disabled") == undefined ){
			if($('.linkmode_div1 .local_client').find('input').prop('checked')){
				ClientSSH_v = $("#ClientSSH").val();
				ClientSSH_text = $("#ClientSSH").children('option:selected').text();
				if(ClientSSH_text.indexOf('未设置')>=0){
					arr_client_ssh = ClientSSH_v
				}
			}
		}
		if($("#ClientTELNET").attr("disabled") == false || $("#ClientTELNET").attr("disabled") == undefined){
			if($('.linkmode_div2 .local_client').find('input').prop('checked')){
				ClientTELNET_v = $("#ClientTELNET").val();
				ClientTELNET_text = $("#ClientTELNET").children('option:selected').text();
				if(ClientTELNET_text.indexOf('未设置')>=0){
					arr_client_telnet = ClientTELNET_v
				}
			}
		}

		if(arr_client_ssh.length > 0 || arr_client_telnet.length > 0 ){
			client_module_show(arr_client_ssh,arr_client_telnet);
		}else{
			/*
			/connect
			/2.27,2018
			*/
			MARKFLAG = 0;
			sesstimet = (new Date()).valueOf();
			CRTNum = NettermNum = RDPNum = 0;
			I = 0;
			connect(I,EnabledAccount);		
			sub_callback(I,EnabledAccount);
		}
		
		if(list_ip.length == 0 && list_ip_ssh.length >0 ){
			$(list_ip_ssh).each(function(iii,item1){
				window.open(item1);
			})
		}else if(list_ip.length > 0 && list_ip_ssh.length > 0){
			var c = 0;		
			var if_ok_down_other = setInterval(function(){													
				if(check_cilent == true){
					$(list_ip_ssh).each(function(ii,item){
						window.open(item);
					})
					clearInterval(if_ok_down_other);
					return 0;				
				}
				if(c >=10){
					clearInterval(if_ok_down_other);	
					return 0;
				}			
				c = c + 1;				
			},500)
		}
	}
	var sub_callback = function(i,item){
		var arr = Object.keys(item);
		var len = arr.length;
		if(FLAG_OVER == 1){
			if(i < len-1){
				connect(i+1,item);
				sub_callback(i+1,item);	
			}
		}else{
			setTimeout(function(){sub_callback(i,item)}, 100);
		}
	}
	var Content_tmp = "";
	var sesstimet = (new Date()).valueOf();
	function connect(i,item){
		FLAG_OVER = 0;
		item = item[i]
		var HostAccessCfg = {
			"UserCode": "",
			"ServerIP": "",
			"ProtocolName": "",
			"SessionId": "",
			"ServerUser": "",
			"ServerPort": 0,
			"ServiceName": "",
			"ConnMode": "",
			"ConnParam": "",
			"ConnParamId": null,
			"ExePath": null,
			"Pwd": "",
			"ClientName": "",
			"SSHType": null,
			"RDPScreen": "0",
			"RDPClipboard": null,
			"RDPDiskMap": null,
			"RDPDiskMapList": null,
			"ConnParamName": null,
			"ConnModeName": null,
			"AppRelease": null,
			"AppChannel": null,
			"ConnWay": null
		}
		var encrypt_pwd;
		var decrypt_pwd;
		var encrypt_flag = 0;
		var pwd_flag = 0;
		var pro_name = item.ProtocolName;
		var port = item.Port + '';
		var ip = item.HostIP;
		var ServiceName = item.HostServiceName;
		//console.log("ServiceName: "+ServiceName);
		var user;
		if(item.AccountName == "-"){
			user = "";
		}else{
			user = item.AccountName;
		}
		if ($("#screensize").attr('disabled') != 'disabled' && $("#EnableRDPDiskMap").prop('checked')){
			if ($('.disk_map').is(':visible') && $(".disk_map").find('input:checked').length == 0){
				_alert(1,"批量启动","请选择硬盘");
				return false;
			}
		}
		if(item.Password == null){
			item.Password = "";
		}
		var pwd = item.Password;//未解密
		encrypt_pwd = pwd;
		/*$.ajax({
			url:'/bhost/rc4_decrypt',
			type:'post',
			async:false,
			data:{a0:se,z1:pwd},
			success:function(result){
				var result = JSON.parse(result);
				if (result.Result){
					//pwd = result.info;
					decrypt_pwd = result.info;
				}else{
					_alert(1,"批量启动",result.info);
					return false;
				}
			}
		});*/
		decrypt_pwd = encrypt_pwd;
		remark_need = 0;
		var ConnType = '';
		switch (pro_name) {
			case "SSH":
				ConnType = $("#AuthTypeSSH").val();
				break;
			case "RDP":
				ConnType = $("#access_select").val();
				break;
		}
		//console.log("ConnType: "+ConnType);
		//console.log("ServiceName: "+ServiceName);
		var remark_need_flag = 0;
		$.ajax({
			url:"/bhost/Get_AuthObjectByInput",
			type:'post',
			async:false,
			data:{a0:se,z1:ip,z2:pro_name,z3:port,z4:user.replace(/\\/g,"\\\\"), z5: ServiceName, z6: ConnType},
			success:function(result){
				if (result == ""){
					return false;
				}else{
					var obj_json = JSON.parse(result);
					if (obj_json.EnableAccessInfo){
						remark_need = 1;
					}
				}
			}
		});
		if (pro_name != "RDP"){//SSH TELNET

			var client_ip = window.parent.client_ip;
			var client_v,client_text;
			if(pro_name == "SSH"){
				client_v = $("#ClientSSH").val();
				client_text = $("#ClientSSH").children('option:selected').text();
			}else if(pro_name == "TELNET"){
				client_v = $("#ClientTELNET").val();
				client_text = $("#ClientTELNET").children('option:selected').text();					
			}
			var path_input = "";
			//if (client_text.indexOf('未设置') != -1){
				//_alert(1,"批量启动",client_text+"客户端路径未设置");
				//client_module_show(client_v);
				//return false;
			//}else{
				$.each(path_array,function(i1,item1){
					if (item1.ClientName == client_v){
						path_input = item1.ClientProgram;
						return false;
					}
				});
			//}
			// if(path_input == undefined || path_input == ""){
			// 	_alert(1,"批量启动",client_text+"客户端路径未设置");
			// 	return false;
			// }
			path_input = path_input.replace(/\\/g,"\\\\\\\\");
			var cur_domain = document.domain+ (location.port!=''?':'+location.port:'');
			var cmd_str;

			if((pro_name == "SSH" && $('.linkmode_div1 .local_client').find('input').prop('checked')) || (pro_name == "TELNET" && $('.linkmode_div2 .local_client').find('input').prop('checked'))){//客户端 SSH TELNET
				var timestamp = new Date().getTime();
				var username = se + '@' + timestamp;
				var bhus = window.parent.frm.us.value;				
				var json_data = {
					"BHUser":"", //堡垒机用户wen:xxx@root@192.168.0.83:22  base64加密
					"ServerUser":"",//服务器用户
					"ServerPassword":"", //rc4加密
					"BHIP":"",//堡垒机地址
					"ServerIP":"",//服务器地址
					"ServerPort":"",//服务器端口
					"ClientPath":"",//客户端全路径
					"ClientName":"",//客户端名称
					"Protocol":"",//协议名称
					"ServerName":"",//实例名、SID
					"ServerNameType":"",//实例名类型
					"ConnMode":"",//连接方式
					"title":"",
					"IsTunnel":"false",
					"MapPort":0,
					"Port":0,
					"Number":1,
					"screensize":"",
					"fullscreen":"true",
					"clip":"false",
					"diskmap":"false",
					"mapdisks":"",
					"AccAPP":"false",
					"RemoteApp":"false",
					"SshKeyName": "",
					"UrlIp": document_domain+ (location.port!=''?':'+location.port:''),
					"Sessid": se,
					"IfHiddenHostIP": "true"
				}

				if(client_v == "SecureCRT"){
					CRTNum++;
					json_data.Number = CRTNum.toString();
				}else if(client_v == "Netterm"){
					NettermNum++;
					json_data.Number = NettermNum.toString();
				}
				HostAccessCfg.ConnModeName = 'local_client';

				if (HideIP == true) {
					json_data.IfHiddenHostIP = "true"
				} else {
					json_data.IfHiddenHostIP = "false"
				}
				if (IsTunnel == "false"){
					if(pro_name == "SSH"){
						if ($("#passageway_select2").val() == 1){
							IsTunnel = 'false';
						}else{
							IsTunnel = 'true';
						}
					}else if(pro_name == "TELNET"){
						if ($("#passageway_select3").val() == 1){
							IsTunnel = 'false';
						}else{
							IsTunnel = 'true';
						}
					}
				}

				json_data.IsTunnel = IsTunnel;
				json_data.MapPort = MapPort;
				json_data.ServerPassword = "en::" + encrypt_pwd;
				if (client_v == "Putty"){
					json_data.BHUser = window.parent.parent.frm.us.value;
				}else{
					json_data.BHUser = window.parent.parent.frm.us.value;
					json_data.ServerPort = port + '';
				}
				json_data.Port = port;
				if (pro_name == "SSH") {
					json_data.ServerName = $("#AuthTypeSSH").val();
				}else if(pro_name == "TELNET"){
					json_data.ServerName = "";
				}
				$.ajax({
					url:'/bhost/module_app_set_list',
					type:'post',
					async:false,
					data:{a0:se},
					success:function(result){
						var re_result = JSON.parse(result);
						$.each(re_result.data,function(i,item){
							if (pro_name == "SSH"){
								if (item.ApplicationName.indexOf(pro_name) != -1){
									json_data.ServerPort = item.ServicePort;
								}
							}else{
								if (item.ApplicationName.indexOf("菜单") === -1 && item.ApplicationName.indexOf(pro_name) != -1){
									param_port = '{"name":"port","value":"' + item.ServicePort + '"}';
									json_data.ServerPort = item.ServicePort;
									return false;
								}
							}
						});
					}
				});
				
				HostAccessCfg.UserCode = window.parent.parent.frm.us.value;
				HostAccessCfg.ServerIP = ip;
				HostAccessCfg.ProtocolName = pro_name;
				HostAccessCfg.SessionId = se;
				HostAccessCfg.ServerUser = user;
				HostAccessCfg.ServerPort = port;
				HostAccessCfg.Pwd = encrypt_pwd;
				HostAccessCfg.SSHType = $("#AuthTypeSSH").val();
				HostAccessCfg.ClientName = client_v;
				
				//json_data.BHUser = window.parent.parent.frm.us.value;
				json_data.ServerUser = user;
				//json_data.ServerPassword = pwd;
				json_data.BHIP = document_domain;
				json_data.ServerIP = ip;
				//json_data.ServerPort = port;
				json_data.ClientPath = path_input;
				json_data.ClientName = client_v;
				json_data.Protocol = pro_name;
				if(json_data.Protocol == "SSH"){
					json_data.Protocol = "SSH"+$("#AuthTypeSSH").val();
				}
				if ($("#passageway_select2").is(":visible")) {
					HostAccessCfg.ConnWay = $('#passageway_select2').val();
				}
				cmd_str = JSON.stringify(json_data);

				var remark_json = {
					"PlanId": 0,
					"UserCode": "test3", 
					"HostIP": "192.168.0.53",
					"HostName": "主机4Group", 
					"PlanMsg": "testtt"
				}
				var remarktype = 0;
				if ((global_data.IfGiveAccessInfo || remark_need == 1) && MARKFLAG == 0){
					get_plan(ip);
					
					var $dialogCont = $("#remarkDialog").show();
					var title = '访问备注';
					var d = dialog({
						title:title,
						content:$dialogCont,
						id:"remarkDialog",
						width:"780px"
					});
					function addEventListener(ele,event,fn){
						if(ele.addEventListener){
							ele.addEventListener(event,fn,false);
						}else{
							ele.attachEvent('on'+event,fn.bind(ele));
						}
					}
					addEventListener(d,'close',function () {
						 $dialogCont.appendTo("body").hide();
					});
					d.showModal();
					$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
						
					});
					$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
						if($("#operation_content").val() == ""){
							_alert(1,"批量启动",'访问备注不能为空');
							return false;
						}
						Content_tmp = $("#operation_content").val();
						save_remark(planid,ip);
						
						d.close().remove();
						var if_html_client = false;
						var base64_str = '';
						json_data['sesstimet'] = sesstimet;
						if(global_data.IsTunnel == false){
							json_data['IsTunnel'] = "false";
						}else{
							json_data['IsTunnel'] = "true";
							json_data['MapPort'] = global_data.MapPort;
						}
						$.ajax({
							url: "/bhost/get_base64",
							type:"POST",
							async:false,		
							data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(json_data)},
							success:function(result){
								var result=JSON.parse(result);
								if(result.Result){
									if_html_client = result.info;
									base64_str = result.b64;
								}else{
									_alert(1,"批量启动",result.ErrMsg);
								}
							}
						})
						if(if_html_client) window.open('https://'+document_domain+':'+location.port+'/bhost/test_html?se='+window.parent.document.frm.se.value+'&z1='+JSON.stringify(json_data));
						else{
							Cmd_Array.push(json_data);
							var rdp_num = 0;
							$.each(EnabledAccount,function(i,item){
								if(item.ProtocolName == "RDP"){
									rdp_num++;
								}
							})
							
							if(i >= rdp_num-1){
								var msstr = aceg(JSON.stringify(Cmd_Array),window.parent.document.frm.se.value);
								$.ajax({
									url: "/bhost/Save_BatchCmd",
									type:"POST",
									async:false,
									data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(Cmd_Array),z2:window_location_host,z19:sesstimet,m1:msstr},
									success:function(result){
										//window.location.href = 'bhost://cmd&'+result;
										if(i==0) get_regedit('bhost', window.parent.document.frm.se.value,'',sesstimet);
										$('#YuFrame1').remove();
										$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
										$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result);
									}
								})
							}
						}
						FLAG_OVER = 1;
					});
				}else if((global_data.IfGiveAccessInfo || remark_need == 1) && MARKFLAG != 0){
					get_plan(ip);
					save_remark(planid,ip);
					var if_html_client = false;
					var base64_str = '';
					json_data['sesstimet'] = sesstimet;
					if(global_data.IsTunnel == false){
						json_data['IsTunnel'] = "false";
					}else{
						json_data['IsTunnel'] = "true";
						json_data['MapPort'] = global_data.MapPort;
					}
					$.ajax({
						url: "/bhost/get_base64",
						type:"POST",
						async:false,		
						data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(json_data)},
						success:function(result){
							var result=JSON.parse(result);
							if(result.Result){
								if_html_client = result.info;
								base64_str = result.b64;
							}else{
								_alert(1,"批量启动",result.ErrMsg);
							}
						}
					})
					if(if_html_client) window.open('https://'+document_domain+':'+location.port+'/bhost/test_html?se='+window.parent.document.frm.se.value+'&z1='+JSON.stringify(json_data));
					else{
						Cmd_Array.push(json_data);
						var rdp_num = 0;
						$.each(EnabledAccount,function(i,item){
							if(item.ProtocolName == "RDP"){
								rdp_num++;
							}
						})
						if(i >= rdp_num-1){
							var msstr = aceg(JSON.stringify(Cmd_Array),window.parent.document.frm.se.value);
							$.ajax({
								url: "/bhost/Save_BatchCmd",
								type:"POST",
								async:false,		
								data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(Cmd_Array),z2:window_location_host,z19:sesstimet,m1:msstr},
								success:function(result){
									//window.location.href = 'bhost://cmd&'+result;
									if(i==0) get_regedit('bhost', window.parent.document.frm.se.value,'',sesstimet);
									$('#YuFrame1').remove();
									$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
									$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result);
								}
							})
						}
					}	
					FLAG_OVER = 1;
				}else{
					var if_html_client = false;
					var base64_str = '';
					json_data['sesstimet'] = sesstimet;
					if(global_data.IsTunnel == false){
						json_data['IsTunnel'] = "false";
					}else{
						json_data['IsTunnel'] = "true";
						json_data['MapPort'] = global_data.MapPort;
					}
					$.ajax({
						url: "/bhost/get_base64",
						type:"POST",
						async:false,		
						data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(json_data)},
						success:function(result){
							var result=JSON.parse(result);
							if(result.Result){
								if_html_client = result.info;
								base64_str = result.b64;
							}else{
								_alert(1,"批量启动",result.ErrMsg);
							}
						}
					})
					if(if_html_client) window.open('https://'+document_domain+':'+location.port+'/bhost/test_html?se='+window.parent.document.frm.se.value+'&z1='+JSON.stringify(json_data));
					else{
						Cmd_Array.push(json_data);
						var rdp_num = 0;
						$.each(EnabledAccount,function(i,item){
							if(item.ProtocolName == "RDP"){
								rdp_num++;
							}
						})						
						if(i >= rdp_num-1){
							var msstr = aceg(JSON.stringify(Cmd_Array),window.parent.document.frm.se.value);
							$.ajax({
								url: "/bhost/Save_BatchCmd",
								type:"POST",
								async:false,		
								data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(Cmd_Array),z2:window_location_host,z19:sesstimet,m1:msstr},
								success:function(result){
									//window.location.href = 'bhost://cmd&'+result;
									if(i==0) get_regedit('bhost', window.parent.document.frm.se.value,'',sesstimet);
									$('#YuFrame1').remove();
									$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
									$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result);
								}
							})
						}
					}	
					FLAG_OVER = 1;
				}
			}else{
				var json_data = {
					"BHIP": "",//堡垒机地址
					"Port": "",
					"Protocol": "",//协议名称
					"screensize": "",
					"diskmap": "false",
					"mapdisks": "",
					"username": "",
					"H5Flag": 1,
					"UrlIp": document_domain+ (location.port!=''?':'+location.port:''),
					"Sessid": se,
					"IfHiddenHostIP": "true",
					"Password":"123456",
					"IsTunnel":"",
					"MapPort":""
				}
				json_data.IsTunnel = global_data.IsTunnel.toString();
				json_data.MapPort = global_data.MapPort;
				if (HideIP == true) {
					json_data.IfHiddenHostIP = "true";
				} else {
					json_data.IfHiddenHostIP = "false";
				}				
				var bhus = window.parent.parent.frm.us.value;
				//var username = se + '@' + user + '@' + ip + ':' + port + ':' + pro_name;// + '@h5';
				var timestamp = new Date().getTime();
				var username = se + '@' + timestamp;
				
				var param_host = '{"name":"hostname","value":"127.0.0.1"}';
				var get_module_flag = 0;
				var param_port;

				HostAccessCfg.UserCode = bhus;
				HostAccessCfg.ServerIP = ip;
				json_data.BHIP = document_domain;
				HostAccessCfg.ProtocolName = pro_name;
				HostAccessCfg.SessionId = se;
				HostAccessCfg.ServerUser = user;
				HostAccessCfg.ServerPort = port;
				HostAccessCfg.Pwd = encrypt_pwd;
				HostAccessCfg.SSHType = $("#AuthTypeSSH").val();
				HostAccessCfg.ConnMode = $("#AuthTypeSSH").val();
				HostAccessCfg.RDPClipboard = false;
				HostAccessCfg.RDPScreen = $("#screensize").val();
				json_data.screensize = $("#screensize").val();
				HostAccessCfg.RDPDiskMap = false;
				HostAccessCfg.RDPDiskMapList = "";
				json_data.diskmap = "false";
				json_data.mapdisks = "";
				$.ajax({
					url:'/bhost/module_app_set_list',
					type:'post',
					async:false,
					data:{a0:se},
					success:function(result){
						var re_result = JSON.parse(result);
						$.each(re_result.data,function(i,item){
							if (item.ApplicationName.indexOf("菜单") != -1 && item.ApplicationName.indexOf(pro_name) != -1){
								get_module_flag = 1;
								param_port = '{"name":"port","value":"'+item.ServicePort+'"}';
								json_data.Port = item.ServicePort;
								return false;
							}
						});
						if (get_module_flag == 0){
							$.each(re_result.data,function(i,item){
								if (item.ApplicationName.indexOf(pro_name) != -1){
									param_port = '{"name":"port","value":"'+item.ServicePort+'"}';
									json_data.Port = item.ServicePort;
									return false;
								}else{
									json_data.Port = item.ServicePort;
									param_port = '{"name":"port","value":"'+port+'"}';
								}
							});
						}
					}
				});

				var type_ver = "";
				if (pro_name == "SSH"){
					type_ver = $("#AuthTypeSSH").val();
				}
				if (get_module_flag == 1){
					var param_username = '{"name":"username","value":"'+bhus+'@'+user+'@'+ip+':'+port+':'+pro_name+type_ver+'@h5"}';
				}else{
					var param_username = '{"name":"username","value":"'+bhus+'@'+user+'@'+ip+':'+port+'@h5"}';
				}
				var nwidth = 0;
				var nheight = 0;
				var RDP_Select = 0;
				var DiskMap = 0;
				var client_ip = window.parent.parent.client_ip;
					if (encrypt_pwd == "") {
						encrypt_pwd = "-";
					}				
				var param_password = '{"name":"password","value":"'+client_ip+':0@'+encrypt_pwd+'"}';
				json_data.Password = JSON.parse(param_password).value;
				var param_array = [];
				if (pro_name == "SSH") {
					var param_sftp = '{"name":"enable-sftp","value":"true"}';
					param_array.push(JSON.parse(param_sftp));
				}
				param_array.push(JSON.parse(param_host));
				param_array.push(JSON.parse(param_port));
				param_array.push(JSON.parse(param_username));
				param_array.push(JSON.parse(param_password));

				var url_str = "https://"+document_domain+':8443';

				if ((global_data.IfGiveAccessInfo || remark_need == 1) && MARKFLAG == 0){
					get_plan(ip);
					
					var $dialogCont = $("#remarkDialog").show();
					var title = '访问备注';
					var d = dialog({
						title:title,
						content:$dialogCont,
						id:"remarkDialog",
						width:"780px"
					});
					function addEventListener(ele,event,fn){
						if(ele.addEventListener){
							ele.addEventListener(event,fn,false);
						}else{
							ele.attachEvent('on'+event,fn.bind(ele));
						}
					}
					addEventListener(d,'close',function () {
						$dialogCont.appendTo("body").hide();
					});
					d.showModal();
					$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
						
					});
					$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
						if($("#operation_content").val() == ""){
							_alert(1,"批量启动",'访问备注不能为空');
							return false;
						}
						Content_tmp = $("#operation_content").val();
						save_remark(planid,ip);
						d.close().remove();
						
						$.ajax({
							url: "/bhost/get_token_remote",
							type:"POST",
							async:false,
							data:{a0:se,z1:JSON.stringify(param_array),z2:ip,z3:pro_name,z4:username,z5:pwd,z6:url_str,z7:user,z8:JSON.stringify(HostAccessCfg),z9:0,z10:HostAccessCfg.RDPDiskMap,z12:JSON.stringify(json_data),m1:mac },
							success:function(result){
								var result=JSON.parse(result);
								var url_addr = 'https://'+document_domain+':8443/bhremote/?token='+result.authToken;
								//window.open(url_addr);
								list_ip_ssh.push(url_addr);
							}
						});
						FLAG_OVER = 1;
					});
				}else if((global_data.IfGiveAccessInfo || remark_need == 1) && MARKFLAG != 0){
					get_plan(ip);
					save_remark(planid,ip);
				
					$.ajax({
						url: "/bhost/get_token_remote",
						type:"POST",
						async:false,
						data:{a0:se,z1:JSON.stringify(param_array),z2:ip,z3:pro_name,z4:username,z5:pwd,z6:url_str,z7:user,z8:JSON.stringify(HostAccessCfg),z9:0,z10:HostAccessCfg.RDPDiskMap,z12:JSON.stringify(json_data),m1:mac },
						success:function(result){
							var result=JSON.parse(result);
							var url_addr = 'https://'+document_domain+':8443/bhremote/?token='+result.authToken;
							//window.open(url_addr);
							list_ip_ssh.push(url_addr);
						}
					});
					FLAG_OVER = 1;
				}else{
					$.ajax({
						url: "/bhost/get_token_remote",
						type:"POST",
						async:false,
						data:{a0:se,z1:JSON.stringify(param_array),z2:ip,z3:pro_name,z4:username,z5:pwd,z6:url_str,z7:user,z8:JSON.stringify(HostAccessCfg),z9:0,z10:HostAccessCfg.RDPDiskMap,z12:JSON.stringify(json_data),m1:mac },
						success:function(result){
							var result=JSON.parse(result);
							var url_addr = 'https://'+document_domain+':8443/bhremote/?token='+result.authToken;
							//window.open(url_addr);
							list_ip_ssh.push(url_addr);
						}
					});
					FLAG_OVER = 1;
				}
			}
		}else{
			//rdp web
			if($('.linkmode_div0').find('.web_con').find('input').is(':checked')){
				var encrypt_pwd;
				var decrypt_pwd;
				var pro_name = item.ProtocolName;
				var port = item.Port + '';
				var ip = item.HostIP;

				var user;
				if(item.AccountName == "-"){
					user = "";
				}else{
					user = item.AccountName;
				}

				if(item.Password == null){
					item.Password = "";
				}
				var pwd = item.Password;//未解密
				encrypt_pwd = pwd;
				/*$.ajax({
					url:'/bhost/rc4_decrypt',
					type:'post',
					async:false,
					data:{a0:se,z1:pwd},
					success:function(result){
						var result = JSON.parse(result);
						if (result.Result){
							//pwd = result.info;
							decrypt_pwd = result.info;
						}else{
							_alert(1,"批量启动",result.info);
							return false;
						}
					}
				});*/
				decrypt_pwd = encrypt_pwd;//解密在本地执行
				var bhus = window.parent.parent.frm.us.value;
				//var username = se + '@' + user + '@' + ip + ':' + port + ':' + pro_name;// + '@h5';
				var timestamp = new Date().getTime();
				var username = se + '@' + timestamp;
				
				var param_host = '{"name":"hostname","value":"127.0.0.1"}';
				var get_module_flag = 0;
				var param_port;
				
				var json_data = {
					"BHIP": "",//堡垒机地址
					"Port": "",
					"Protocol": "",//协议名称
					"screensize": "",
					"diskmap": "false",
					"mapdisks": "",
					"username": "",
					"H5Flag": 1,
					"UrlIp": document_domain+ (location.port!=''?':'+location.port:''),
					"Sessid": se,
					"IfHiddenHostIP": "true",
					"Password":"123456"
				}
				if (HideIP == true) {
					json_data.IfHiddenHostIP = "true"
				} else {
					json_data.IfHiddenHostIP = "false"
				}
				HostAccessCfg.UserCode = bhus;
				HostAccessCfg.ServerIP = ip;
				json_data.BHIP = document_domain;
				HostAccessCfg.ProtocolName = pro_name;
				HostAccessCfg.SessionId = se;
				HostAccessCfg.ServerUser = user;
				HostAccessCfg.ServerPort = port;
				HostAccessCfg.Pwd = encrypt_pwd;
				HostAccessCfg.SSHType = $("#AuthTypeSSH").val();
				HostAccessCfg.ConnMode = $("#access_select").val();
				if ($("#EnableRDPClipboard").prop('checked')){
					HostAccessCfg.RDPClipboard = true;
				}else{
					HostAccessCfg.RDPClipboard = false;
				}
				HostAccessCfg.RDPScreen = $("#screensize").val();
				json_data.screensize = $("#screensize").val();

				if ($("#EnableRDPDiskMap").prop('checked')){
					HostAccessCfg.RDPDiskMap = true;
					var mapdisks = "";
					$('.disk_map').find('input:checked').each(function(i,item){
						mapdisks = mapdisks + $(item).parents('label:first').text() + '|';
					})
					if (mapdisks != ""){
						mapdisks = mapdisks.substring(0,mapdisks.length-1);
					}
					HostAccessCfg.RDPDiskMapList = mapdisks;
					json_data.diskmap = "true";
					json_data.mapdisks = mapdisks;
				}else{
					HostAccessCfg.RDPDiskMap = false;
					HostAccessCfg.RDPDiskMapList = "";
					json_data.diskmap = "false";
					json_data.mapdisks = "";
				}
				HostAccessCfg.ConnModeName = 'web_con';
				// var mapdisks = "";
				// $('.disk_map').find('input:checked').each(function(i,item){
				// 	mapdisks = mapdisks + $(item).parents('label:first').text() + '|';
				// })
				// if (mapdisks != ""){
				// 	mapdisks = mapdisks.substring(0,mapdisks.length-1);
				// }
				// HostAccessCfg.RDPDiskMapList = mapdisks;
				if ((global_data.IfGiveAccessInfo || remark_need == 1) && MARKFLAG == 0){
					get_plan(ip);
					
					var $dialogCont = $("#remarkDialog").show();
					var title = '访问备注';
					var d = dialog({
						title:title,
						content:$dialogCont,
						id:"remarkDialog",
						width:"780px"
					});
					function addEventListener(ele,event,fn){
						if(ele.addEventListener){
							ele.addEventListener(event,fn,false);
						}else{
							ele.attachEvent('on'+event,fn.bind(ele));
						}
					}
					addEventListener(d,'close',function () {
						 $dialogCont.appendTo("body").hide();
					});
					d.showModal();
					$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
						
					});
					$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
						if($("#operation_content").val() == ""){
							_alert(1,"批量启动",'访问备注不能为空');
							return false;
						}
						Content_tmp = $("#operation_content").val();
						save_remark(planid,ip);
						d.close().remove();
						var get_rdp_mode = 0;
						$.ajax({
							url:'/bhost/module_app_set_list',
							type:'post',
							async:false,
							data:{a0:se},
							success:function(result){
								var re_result = JSON.parse(result);
								$.each(re_result.data,function(i,item){
									if (item.ApplicationName.indexOf("菜单") != -1 && item.ApplicationName.indexOf(pro_name) != -1){
										get_module_flag = 1;
										param_port = '{"name":"port","value":"'+item.ServicePort+'"}';
										json_data.Port = item.ServicePort;
										return false;
									}
								});
								if (get_module_flag == 0){
									$.each(re_result.data,function(i,item){
										if (item.ApplicationName.indexOf(pro_name) != -1){
											param_port = '{"name":"port","value":"'+item.ServicePort+'"}';
											if (pro_name == 'RDP') {
												get_rdp_mode = item.Mode;
											}	
											json_data.Port = item.ServicePort;
											return false;
										}else{
											json_data.Port = item.ServicePort;
											param_port = '{"name":"port","value":"'+port+'"}';
										}
									});
								}
							}
						});
						if (get_module_flag == 1){
							var param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+':'+pro_name+'@h5"}';
						}else{
							var param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+'@h5"}';
						}

						if (HostAccessCfg.RDPScreen == 0){
							var nwidth = 0;
							var nheight = 0;
						}else if (HostAccessCfg.RDPScreen == 1){
							var nwidth = 1;
							var nheight = 1;
							if (pro_name == "X11"){
								var nwidth = window.screen.width;
								var nheight = window.screen.height;
							}
						}else{
							var nwidth = HostAccessCfg.RDPScreen.split("*")[0];
							var nheight = HostAccessCfg.RDPScreen.split("*")[1];
						}
						if (HostAccessCfg.RDPClipboard){
							var RDP_Select = 1;
						}else{
							var RDP_Select = 0;
						}
						if (HostAccessCfg.RDPDiskMap){
							var DiskMap = 1;
						}else{
							var DiskMap = 0;
						}
						var param_username = '{"name":"username","value":"' + bhus + '@' + user.replace(/\\/g, "\\\\") + '@' + ip + ':' + port + ':' + pro_name + '-' + $("#access_select").val() + '@h5' + nwidth + '*' + nheight + '*' + RDP_Select + '*' + DiskMap + '"}';
						var client_ip = window.parent.client_ip;
						if (encrypt_pwd == "") {
							encrypt_pwd = "-";
						}	
						if (encrypt_pwd == "") {
							encrypt_pwd = "-";
						}
						var param_password = '{"name":"password","value":"'+client_ip+':0@'+encrypt_pwd+'"}';
						var param_array = [];
						json_data.Password = JSON.parse(param_password).value;
						if (HostAccessCfg.RDPScreen != 0 && HostAccessCfg.RDPScreen != 1) {
							//var nwidth = HostAccessCfg.RDPScreen.split("*")[0];
							//var nheight = HostAccessCfg.RDPScreen.split("*")[1];
							var param_width = '{"name":"width","value":"' + nwidth + '"}';
							var param_height = '{"name":"height","value":"' + nheight + '"}';
							param_array.push(JSON.parse(param_width));
							param_array.push(JSON.parse(param_height));
						}
				
						param_array.push(JSON.parse(param_host));
						param_array.push(JSON.parse(param_port));
						param_array.push(JSON.parse(param_username.replace(/\\/g,'\\\\')));
						param_array.push(JSON.parse(param_password));
						
						var url_str = "https://"+document_domain+':8443';
						//var url_str = "https://"+ip;
						json_data['sesstimet'] = sesstimet;
						if(global_data.IsTunnel == false){
							json_data['IsTunnel'] = "false";
						}else{
							json_data['IsTunnel'] = "true";
							json_data['MapPort'] = global_data.MapPort;
						}
						$.ajax({
							url: "/bhost/get_token_remote",
							type:"POST",
							async:false,
							data:{a0:se,z1:JSON.stringify(param_array),z2:ip,z3:pro_name,z4:username,z5:pwd,z6:url_str,z7:user,z8:JSON.stringify(HostAccessCfg),z9:0,z10:HostAccessCfg.RDPDiskMap,z12:JSON.stringify(json_data),m1:mac },
							success:function(result){
								var result=JSON.parse(result);
								var url_addr = 'https://'+document_domain+':8443/bhremote/?token='+result.authToken;
								//window.open(url_addr);
								
								if (HostAccessCfg.RDPDiskMap){
									
									if (pro_name == "RDP"){
										list_ip.push(url_addr);
										if (result.Flag == 1){
											json_data.username = result.UserName.substring(0,result.UserName.length-1) + 2;
											window.open('https://'+window_location_host+'/bhost/test_html?se={{se}}&z1='+JSON.stringify(json_data));
										}else{
											//cmd_set['username'] +'\t'+ host_set_json['ServiceName'] +'\t'+ host_set_json['ConnMode'] +'\t'+ host_set_json['ConnParam'] +'\t'+ host_set_json['ClientName'] +'\t'
											json_data.username = result.UserName2 + '\t'+ HostAccessCfg['ServiceName'] +'\t'+ HostAccessCfg['ConnMode'] +'\t'+ HostAccessCfg['ConnParam'] +'\t'+ 'default' +'\t';
											Cmd_Array.push(json_data);
											var rdp_num = 0;
											$.each(EnabledAccount,function(i,item){
												if(item.ProtocolName == "RDP"){
													rdp_num++;
												}
											})	
											if(i >= rdp_num-1){
												var msstr = aceg(JSON.stringify(Cmd_Array),window.parent.document.frm.se.value);
												$.ajax({
													url: "/bhost/Save_BatchCmd",
													type:"POST",
													async:false,		
													data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(Cmd_Array),z2:window_location_host,z19:sesstimet,m1:msstr},
													success:function(result){
														//window.location.href = 'bhost://cmd&'+result;
														//if(i==0) {
															get_regedit('bhost', window.parent.document.frm.se.value,'',sesstimet);														
														//}
														$('#YuFrame1').remove();
														$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
														$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result);
														_showLoading_client('正在启动客户端，请稍后');												
														var c = 0;		
														var if_ok_down_other = setInterval(function(){													
															if(check_cilent == true){
																$(list_ip).each(function(ii,item){
																	window.open(item);
																})
																clearInterval(if_ok_down_other);
																_closeLoading_client();
																return 0;				
															}
															if(c >=10){
																clearInterval(if_ok_down_other);	
																_closeLoading_client();
																return 0;
															}			
															c = c + 1;				
														},500)
														
													}
												})
											}
										}
									}else{
										list_ip_ssh.push(url_addr);
									}
								}else{
									list_ip_ssh.push(url_addr);
									//window.open(url_addr);
								}
								FLAG_OVER = 1;
							}
						});
					});
				}else if((global_data.IfGiveAccessInfo || remark_need == 1) && MARKFLAG != 0){
					get_plan(ip);
					save_remark(planid,ip);
					$.ajax({
						url:'/bhost/module_app_set_list',
						type:'post',
						async:false,
						data:{a0:se},
						success:function(result){
							var re_result = JSON.parse(result);
							$.each(re_result.data,function(i,item){
								if (item.ApplicationName.indexOf("菜单") != -1 && item.ApplicationName.indexOf(pro_name) != -1){
									get_module_flag = 1;
									param_port = '{"name":"port","value":"'+item.ServicePort+'"}';
									json_data.Port = item.ServicePort;
									return false;
								}
							});
							if (get_module_flag == 0){
								$.each(re_result.data,function(i,item){
									if (item.ApplicationName.indexOf(pro_name) != -1){
										param_port = '{"name":"port","value":"'+item.ServicePort+'"}';
										if (pro_name == 'RDP') {
											get_rdp_mode = item.Mode;
										}
										json_data.Port = item.ServicePort;
										return false;
									}else{
										json_data.Port = item.ServicePort;
										param_port = '{"name":"port","value":"'+port+'"}';
									}
								});
							}
						}
					});
					if (get_module_flag == 1){
						var param_username = '{"name":"username","value":"'+bhus+'@'+user+'@'+ip+':'+port+':'+pro_name+'@h5"}';
					}else{
						var param_username = '{"name":"username","value":"'+bhus+'@'+user+'@'+ip+':'+port+'@h5"}';
					}
					if (encrypt_pwd == "") {
						encrypt_pwd = "-";
					}
					var param_password = '{"name":"password","value":"'+client_ip+':0@'+encrypt_pwd+'"}';
					json_data.Password = JSON.parse(param_password).value;

					if (HostAccessCfg.RDPScreen == 0){
						var nwidth = 0;
						var nheight = 0;
					}else if (HostAccessCfg.RDPScreen == 1){
						var nwidth = 1;
						var nheight = 1;
					}else{
						var nwidth = HostAccessCfg.RDPScreen.split("*")[0];
						var nheight = HostAccessCfg.RDPScreen.split("*")[1];
					}
					if (HostAccessCfg.RDPClipboard){
						var RDP_Select = 1;
					}else{
						var RDP_Select = 0;
					}
					if (HostAccessCfg.RDPDiskMap){
						var DiskMap = 1;
					}else{
						var DiskMap = 0;
					}

					var param_username = '{"name":"username","value":"' + bhus + '@' + user.replace(/\\/g, "\\\\") + '@' + ip + ':' + port + ':' + pro_name + '-' + $("#access_select").val() + '@h5' + nwidth + '*' + nheight + '*' + RDP_Select + '*' + DiskMap + '"}';
					var client_ip = window.parent.parent.client_ip;
					var param_array = [];
					if (HostAccessCfg.RDPScreen != 0 && HostAccessCfg.RDPScreen != 1) {
						//var nwidth = HostAccessCfg.RDPScreen.split("*")[0];
						//var nheight = HostAccessCfg.RDPScreen.split("*")[1];
						var param_width = '{"name":"width","value":"' + nwidth + '"}';
						var param_height = '{"name":"height","value":"' + nheight + '"}';
						param_array.push(JSON.parse(param_width));
						param_array.push(JSON.parse(param_height));
					}					
					param_array.push(JSON.parse(param_host));
					param_array.push(JSON.parse(param_port));
					param_array.push(JSON.parse(param_username.replace(/\\/g,'\\\\')));
					param_array.push(JSON.parse(param_password));
					
					var url_str = "https://"+document_domain+':8443';
					//var url_str = "https://"+ip;
					json_data['sesstimet'] = sesstimet;
					if(global_data.IsTunnel == false){
						json_data['IsTunnel'] = "false";
					}else{
						json_data['IsTunnel'] = "true";
						json_data['MapPort'] = global_data.MapPort;
					}
					$.ajax({
						url: "/bhost/get_token_remote",
						type:"POST",
						async:false,
						data:{a0:se,z1:JSON.stringify(param_array),z2:ip,z3:pro_name,z4:username,z5:pwd,z6:url_str,z7:user,z8:JSON.stringify(HostAccessCfg),z9:0,z10:HostAccessCfg.RDPDiskMap,z12:JSON.stringify(json_data),m1:mac },
						success:function(result){
							var result=JSON.parse(result);
							var url_addr = 'https://'+document_domain+':8443/bhremote/?token='+result.authToken;
							//	window.open(url_addr);
							
							if (HostAccessCfg.RDPDiskMap){
								
								if (pro_name == "RDP"){
									list_ip.push(url_addr);
									if (result.Flag == 1){
										json_data.username = result.UserName.substring(0,result.UserName.length-1) + 2;
										window.open('https://'+window_location_host+'/bhost/test_html?se={{se}}&z1='+JSON.stringify(json_data));
									}else{
										json_data.username = result.UserName2 + '\t'+ HostAccessCfg['ServiceName'] +'\t'+ HostAccessCfg['ConnMode'] +'\t'+ HostAccessCfg['ConnParam'] +'\t'+ 'default' +'\t';;
										Cmd_Array.push(json_data);
										var rdp_num = 0;
										$.each(EnabledAccount,function(i,item){
											if(item.ProtocolName == "RDP"){
												rdp_num++;
											}
										})
										if(i >= rdp_num-1){
											var msstr = aceg(JSON.stringify(Cmd_Array),window.parent.document.frm.se.value);
											$.ajax({
												url: "/bhost/Save_BatchCmd",
												type:"POST",
												async:false,		
												data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(Cmd_Array),z2:window_location_host,z19:sesstimet,m1:msstr},
												success:function(result){
													//window.location.href = 'bhost://cmd&'+result;
													//if(i==0) {
														get_regedit('bhost', window.parent.document.frm.se.value,'',sesstimet);
													//}
													$('#YuFrame1').remove();
													$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
													$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result);
													
													_showLoading_client('正在启动客户端，请稍后');												
													var c = 0;		
													var if_ok_down_other = setInterval(function(){													
													if(check_cilent == true){
														$(list_ip).each(function(ii,item){
															window.open(item);
														})
														clearInterval(if_ok_down_other);
														_closeLoading_client();
														return 0;				
													}
													if(c >=10){
														clearInterval(if_ok_down_other);	
														_closeLoading_client();
														return 0;
													}			
													c = c + 1;				
												},500)
													
												}
											})
										}
									}
								}else{
									list_ip_ssh.push(url_addr);
									//window.open(url_addr);
								}
							}else{
								list_ip_ssh.push(url_addr);
								//window.open(url_addr);
							}
							FLAG_OVER = 1;
						}
					});				
				}else{
					$.ajax({
						url:'/bhost/module_app_set_list',
						type:'post',
						async:false,
						data:{a0:se},
						success:function(result){
							var re_result = JSON.parse(result);
							$.each(re_result.data,function(i,item){
								if (item.ApplicationName.indexOf("菜单") != -1 && item.ApplicationName.indexOf(pro_name) != -1){
									get_module_flag = 1;
									param_port = '{"name":"port","value":"'+item.ServicePort+'"}';
									json_data.Port = item.ServicePort;
									return false;
								}
							});
							if (get_module_flag == 0){
								$.each(re_result.data,function(i,item){
									if (item.ApplicationName.indexOf(pro_name) != -1){
										param_port = '{"name":"port","value":"'+item.ServicePort+'"}';
										if (pro_name == 'RDP') {
											get_rdp_mode = item.Mode;
										}
										json_data.Port = item.ServicePort;
										return false;
									}else{
										json_data.Port = item.ServicePort;
										param_port = '{"name":"port","value":"'+port+'"}';
									}
								});
							}
						}
					});
					if (get_module_flag == 1){
						var param_username = '{"name":"username","value":"'+bhus+'@'+user+'@'+ip+':'+port+':'+pro_name+'@h5"}';
					}else{
						var param_username = '{"name":"username","value":"'+bhus+'@'+user+'@'+ip+':'+port+'@h5"}';
					}
					if (encrypt_pwd == "") {
						encrypt_pwd = "-";
					}
					
					if (HostAccessCfg.RDPScreen == 0){
						var nwidth = 0;
						var nheight = 0;
					}else if (HostAccessCfg.RDPScreen == 1){
						var nwidth = 1;
						var nheight = 1;
					}else{
						var nwidth = HostAccessCfg.RDPScreen.split("*")[0];
						var nheight = HostAccessCfg.RDPScreen.split("*")[1];
					}
					if (HostAccessCfg.RDPClipboard){
						var RDP_Select = 1;
					}else{
						var RDP_Select = 0;
					}
					if (HostAccessCfg.RDPDiskMap){
						var DiskMap = 1;
					}else{
						var DiskMap = 0;
					}

					var param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+':'+pro_name+'-'+$("#access_select").val()+'@h5'+nwidth+'*'+nheight+'*'+RDP_Select+'*'+DiskMap+'"}';	
					var client_ip = window.parent.client_ip;
					if (encrypt_pwd == "") {
						encrypt_pwd = "-";
					}					
					var param_password = '{"name":"password","value":"'+client_ip+':0@'+encrypt_pwd+'"}';
					json_data.Password = JSON.parse(param_password).value;
					var param_array = [];
					if (HostAccessCfg.RDPScreen != 0 && HostAccessCfg.RDPScreen != 1){
						var param_width = '{"name":"width","value":"'+nwidth+'"}';
						var param_height = '{"name":"height","value":"'+nheight+'"}';
						param_array.push(JSON.parse(param_width));
						param_array.push(JSON.parse(param_height));
					}
					param_array.push(JSON.parse(param_host));
					param_array.push(JSON.parse(param_port));
					param_array.push(JSON.parse(param_username));
					param_array.push(JSON.parse(param_password));
					
					var url_str = "https://"+document_domain+':8443';
					//var url_str = "https://"+ip;
					json_data['sesstimet'] = sesstimet;
					if(global_data.IsTunnel == false){
						json_data['IsTunnel'] = "false";
					}else{
						json_data['IsTunnel'] = "true";
						json_data['MapPort'] = global_data.MapPort;
					}
					$.ajax({
						url: "/bhost/get_token_remote",
						type:"POST",
						async:false,
						data:{a0:se,z1:JSON.stringify(param_array),z2:ip,z3:pro_name,z4:username,z5:pwd,z6:url_str,z7:user,z8:JSON.stringify(HostAccessCfg),z9:0,z10:HostAccessCfg.RDPDiskMap,z12:JSON.stringify(json_data),m1:mac },
						success:function(result){
							var result=JSON.parse(result);
							var url_addr = 'https://'+document_domain+':8443/bhremote/?token='+result.authToken;
							//window.open(url_addr);
							
							if (HostAccessCfg.RDPDiskMap){
								
								if (pro_name == "RDP"){
									list_ip.push(url_addr);
									if (result.Flag == 1){
										json_data.username = result.UserName.substring(0,result.UserName.length-1) + 2;
										window.open('https://'+window_location_host+'/bhost/test_html?se={{se}}&z1='+JSON.stringify(json_data));
									}else{
										json_data.username = result.UserName2 + '\t'+ HostAccessCfg['ServiceName'] +'\t'+ HostAccessCfg['ConnMode'] +'\t'+ HostAccessCfg['ConnParam'] +'\t'+ 'default' +'\t';;
										Cmd_Array.push(json_data);
										var rdp_num = 0;
										$.each(EnabledAccount,function(i,item){
											if(item.ProtocolName == "RDP"){
												rdp_num++;
											}
										})
										if(i >= rdp_num-1){
											var msstr = aceg(JSON.stringify(Cmd_Array),window.parent.document.frm.se.value);
											$.ajax({
												url: "/bhost/Save_BatchCmd",
												type:"POST",
												async:false,		
												data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(Cmd_Array),z2:window_location_host,z19:sesstimet,m1:msstr},
												success:function(result){
													//window.location.href = 'bhost://cmd&'+result;
													//if(i==0) {
														get_regedit('bhost', window.parent.document.frm.se.value,'',sesstimet);														
													//}
													$('#YuFrame1').remove();
													$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
													$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result);
													_showLoading_client('正在启动客户端，请稍后');												
													var c = 0;		
													var if_ok_down_other = setInterval(function(){													
														if(check_cilent == true){
															$(list_ip).each(function(ii,item){
																window.open(item);
															})
															clearInterval(if_ok_down_other);
															_closeLoading_client();
															return 0;				
														}
														if(c >=10){
															clearInterval(if_ok_down_other);	
															_closeLoading_client();
															return 0;
														}			
														c = c + 1;				
													},500)
												}
											})
										}
									}
								}else{
									list_ip_ssh.push(url_addr);
								}
							}else{
								list_ip_ssh.push(url_addr);
								//window.open(url_addr);
							}
							FLAG_OVER = 1;
						}
					});
				}
			}
			else{//rdp client
				var client_ip = window.parent.client_ip;
				var client_v,client_text;
				client_v = 'MSTSC';
				client_text = 'MSTSC';
				var path_input;
				//path_input
				var cur_domain = document_domain+ (location.port!=''?':'+location.port:'');
				var cmd_str;

				var json_data = {
					"BHUser": "", //堡垒机用户wen:xxx@root@192.168.0.83:22  base64加密
					"ServerUser": "",//服务器用户
					"ServerPassword": "", //rc4加密
					"BHIP": "",//堡垒机地址
					"ServerIP": "",//服务器地址
					"ServerPort": "",//服务器端口
					"ClientPath": "",//客户端全路径
					"ClientName": "",//客户端名称
					"Protocol": "",//协议名称
					"ServerName": "",//实例名、SID
					"ServerNameType": "",//实例名类型
					"ConnMode": "",//连接方式
					"title": "",
					"IsTunnel": "false",
					"MapPort": 0,
					"Port": 0,
					"screensize": "",
					"fullscreen": "true",
					"clip": "false",
					"diskmap": "false",
					"mapdisks": "",
					"AccAPP": "false",
					"RemoteApp": "false",
					"SshKeyName": "",
					"UrlIp": document_domain+ (location.port!=''?':'+location.port:''),
					"Sessid": se,
					"IfHiddenHostIP": "true"
				}
				if (HideIP == true) {
					json_data.IfHiddenHostIP = "true"
				} else {
					json_data.IfHiddenHostIP = "false"
				}
				RDPNum++;
				json_data.Number = RDPNum.toString();
				json_data.IsTunnel = IsTunnel;
				json_data.MapPort = MapPort;
				json_data.ConnMode = $("#access_select").val();				
				if (client_v == "Putty"){
					json_data.BHUser = window.parent.parent.frm.us.value;
				}else{
					json_data.BHUser = window.parent.parent.frm.us.value;
					json_data.ServerPort = port + '';
				}
				if (remote_data != null && remote_data.EnableRemoteApp) {
					json_data.RemoteApp = "true";
				} else {
					json_data.RemoteApp = "false";
				}
				json_data.screensize = $("#screensize").val();
				json_data.clip = $("#EnableRDPClipboard").prop('checked') + '';
				json_data.diskmap = $("#EnableRDPDiskMap").prop('checked') + '';
				var mapdisks = "";
				if (json_data.diskmap == "true"){
					$('.disk_map').find('input:checked').each(function(i,item){
						mapdisks = mapdisks + $(item).parents('label:first').text() + '|';
					})
					if (mapdisks != ""){
						mapdisks = mapdisks.substring(0,mapdisks.length-1);
					}
				}
				json_data.mapdisks = mapdisks;
				HostAccessCfg.RDPDiskMapList = mapdisks;

				json_data.Port = port;

				if ($("#EnableRDPClipboard").prop('checked')){
					var RDP_Select = 1;
				}else{
					var RDP_Select = 0;
				}
				if ($("#EnableRDPDiskMap").prop('checked')){
					var DiskMap = 1
				}else{
					var DiskMap = 0
				}
				if (encrypt_pwd == "") {
					$.ajax({
						url: '/bhost/rc4_encrypt',
						type: 'post',
						async: false,
						data: { a0: se, z1: '-' },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								encrypt_pwd1 = result.info;
							} else {
								_alert(1, "批量启动", result.info);
								return false;
							}
						}
					});
					json_data.ServerPassword = encrypt_pwd1 + ':' + RDP_Select + ':' + DiskMap;
				}else{
					json_data.ServerPassword = encrypt_pwd + ':' + RDP_Select + ':' + DiskMap;
				}
				
				$.ajax({
					url:'/bhost/module_app_set_list',
					type:'post',
					async:false,
					data:{a0:se},
					success:function(result){
						var re_result = JSON.parse(result);
						$.each(re_result.data,function(i,item){
							if (pro_name == "SSH"){
								if (item.ApplicationName.indexOf(pro_name) != -1){
									json_data.ServerPort = item.ServicePort;
								}
							}else{
								if (item.ApplicationName.indexOf("菜单") === -1 && item.ApplicationName.indexOf(pro_name) != -1){
									json_data.ServerPort = item.ServicePort;
									return false;
								}
							}
						});
					}
				});
				
				HostAccessCfg.UserCode = window.parent.parent.frm.us.value;
				HostAccessCfg.ServerIP = ip;
				HostAccessCfg.ProtocolName = pro_name;
				HostAccessCfg.SessionId = se;
				HostAccessCfg.ServerUser = user;
				HostAccessCfg.ServerPort = port;
				HostAccessCfg.Pwd = encrypt_pwd;
				HostAccessCfg.SSHType = $("#access_select").val();
				HostAccessCfg.ClientName = client_v;
				if ($("#EnableRDPClipboard").prop('checked')){
					HostAccessCfg.RDPClipboard = true;
				}else{
					HostAccessCfg.RDPClipboard = false;
				}
				HostAccessCfg.RDPScreen = $("#screensize").val();
				if ($("#EnableRDPDiskMap").prop('checked')){
					HostAccessCfg.RDPDiskMap = true;
				}else{
					HostAccessCfg.RDPDiskMap = false;
				}
				//json_data.BHUser = window.parent.parent.frm.us.value;
				json_data.ServerUser = user;
				//json_data.ServerPassword = pwd;
				json_data.BHIP = document_domain;
				json_data.ServerIP = ip;
				//json_data.ServerPort = port;
				json_data.ClientPath = "";
				json_data.ClientName = client_v;
				json_data.Protocol = pro_name;
				cmd_str = JSON.stringify(json_data);

				var remark_json = {
					"PlanId": 0,
					"UserCode": "test3", 
					"HostIP": "192.168.0.53",
					"HostName": "主机4Group", 
					"PlanMsg": "testtt"
				}
				var remarktype = 0;

				if ((global_data.IfGiveAccessInfo || remark_need == 1) && MARKFLAG == 0){
					get_plan(ip);
					
					var $dialogCont = $("#remarkDialog").show();
					var title = '访问备注';
					var d = dialog({
						title:title,
						content:$dialogCont,
						id:"remarkDialog",
						width:"780px"
					});
					function addEventListener(ele,event,fn){
						if(ele.addEventListener){
							ele.addEventListener(event,fn,false);
						}else{
							ele.attachEvent('on'+event,fn.bind(ele));
						}
					}
					addEventListener(d,'close',function () {
						 $dialogCont.appendTo("body").hide();
					});
					d.showModal();
					$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
						
					});
					$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
						if($("#operation_content").val() == ""){
							_alert(1,"批量启动",'访问备注不能为空');
							return false;
						}
						Content_tmp = $("#operation_content").val();
						save_remark(planid,ip);
						d.close().remove();
						var if_html_client = false;
						var base64_str = '';
						json_data['sesstimet'] = sesstimet;
						if(global_data.IsTunnel == false){
							json_data['IsTunnel'] = "false";
						}else{
							json_data['IsTunnel'] = "true";
							json_data['MapPort'] = global_data.MapPort;
						}
						$.ajax({
							url: "/bhost/get_base64",
							type:"POST",
							async:false,		
							data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(json_data)},
							success:function(result){
								var result=JSON.parse(result);
								if(result.Result){
									if_html_client = result.info;
									base64_str = result.b64;
								}else{
									_alert(1,"批量启动",result.ErrMsg);
								}
							}
						})
						if(if_html_client) window.open('https://'+document_domain+':'+location.port+'/bhost/test_html?se='+window.parent.document.frm.se.value+'&z1='+JSON.stringify(json_data));
						else{
							Cmd_Array.push(json_data);
							var rdp_num = 0;
							$.each(EnabledAccount,function(i,item){
								if(item.ProtocolName == "RDP"){
									rdp_num++;
								}
							})
							if(i >= rdp_num-1){
								var msstr = aceg(JSON.stringify(Cmd_Array),window.parent.document.frm.se.value);
								$.ajax({
									url: "/bhost/Save_BatchCmd",
									type:"POST",
									async:false,		
									data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(Cmd_Array),z2:window_location_host,z19:sesstimet,m1:msstr},
									success:function(result){
										//window.location.href = 'bhost://cmd&'+result;
										if(i==0) get_regedit('bhost', window.parent.document.frm.se.value,'',sesstimet);
										$('#YuFrame1').remove();
										$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
										$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result);
									}
								})
							}
						}	
						FLAG_OVER = 1;
					});
				}else if((global_data.IfGiveAccessInfo || remark_need == 1) && MARKFLAG != 0){
					get_plan(ip);
					save_remark(planid,ip);
					var if_html_client = false;
					var base64_str = '';
					json_data['sesstimet'] = sesstimet;
					if(global_data.IsTunnel == false){
						json_data['IsTunnel'] = "false";
					}else{
						json_data['IsTunnel'] = "true";
						json_data['MapPort'] = global_data.MapPort;
					}
					$.ajax({
						url: "/bhost/get_base64",
						type:"POST",
						async:false,		
						data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(json_data)},
						success:function(result){
							var result=JSON.parse(result);
							if(result.Result){
								if_html_client = result.info;
								base64_str = result.b64;
							}else{
								_alert(1,"批量启动",result.ErrMsg);
							}
						}
					})
					if(if_html_client) window.open('https://'+document_domain+':'+location.port+'/bhost/test_html?se='+window.parent.document.frm.se.value+'&z1='+JSON.stringify(json_data));
					else{
						Cmd_Array.push(json_data);
						var rdp_num = 0;
						$.each(EnabledAccount,function(i,item){
							if(item.ProtocolName == "RDP"){
								rdp_num++;
							}
						})
						if(i >= rdp_num-1){
							var msstr = aceg(JSON.stringify(Cmd_Array),window.parent.document.frm.se.value);
							$.ajax({
								url: "/bhost/Save_BatchCmd",
								type:"POST",
								async:false,		
								data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(Cmd_Array),z2:window_location_host,z19:sesstimet,m1:msstr},
								success:function(result){
									//window.location.href = 'bhost://cmd&'+result;
									if(i==0) get_regedit('bhost', window.parent.document.frm.se.value,'',sesstimet);
									$('#YuFrame1').remove();
									$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
									$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result);
								}
							})
						}
					}	
					FLAG_OVER = 1;
				}else{
					var if_html_client = false;
					var base64_str = '';
					json_data['sesstimet'] = sesstimet;
					if(global_data.IsTunnel == false){
						json_data['IsTunnel'] = "false";
					}else{
						json_data['IsTunnel'] = "true";
						json_data['MapPort'] = global_data.MapPort;
					}
					$.ajax({
						url: "/bhost/get_base64",
						type:"POST",
						async:false,		
						data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(json_data)},
						success:function(result){
							var result=JSON.parse(result);
							if(result.Result){
								if_html_client = result.info;
								base64_str = result.b64;
							}else{
								_alert(1,"批量启动",result.ErrMsg);
							}
						}
					})
					if(if_html_client) window.open('https://'+document_domain+':'+location.port+'/bhost/test_html?se='+window.parent.document.frm.se.value+'&z1='+JSON.stringify(json_data));
					else{
						Cmd_Array.push(json_data);
						var rdp_num = 0;
						$.each(EnabledAccount,function(i,item){
							if(item.ProtocolName == "RDP"){
								rdp_num++;
							}
						})
						if(i >= rdp_num-1){
							var msstr = aceg(JSON.stringify(Cmd_Array),window.parent.document.frm.se.value);
							$.ajax({
								url: "/bhost/Save_BatchCmd",
								type:"POST",
								async:false,		
								data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(Cmd_Array),z2:window_location_host,z19:sesstimet,m1:msstr},
								success:function(result){
									//window.location.href = 'bhost://cmd&'+result;
									if(i==0) get_regedit('bhost', window.parent.document.frm.se.value,'',sesstimet);
									$('#YuFrame1').remove();
									$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
									$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result);
								}
							})
						}
					}	
					FLAG_OVER = 1;
				}
			}
		}
		return true;
	}

	function save_remark(planid,ip){
		$.ajax({
			url:'/bhost/get_hostName',
			type:'post',
			async:false,
			data:{a0:se,a1:ip},
			success:function(result){
				var result_name = JSON.parse(result);
				HostName = result_name.info;
			}
		})

		var remark_json = {
			"PlanId": 0,
			"UserCode": "test3", 
			"HostIP": "192.168.0.53",
			"HostName": "主机4Group", 
			"PlanMsg": "testtt"
		}
		remark_json.PlanId = planid;
		remark_json.UserCode = window.parent.parent.frm.us.value;
	
		remark_json.HostIP = ip;
		remark_json.HostName = HostName;
		remark_json.PlanMsg = Content_tmp;
		var msstr = aceg(JSON.stringify(remark_json),se);
		$.ajax({
			url:'/bhost/save_remark',
			type:'post',
			async:false,
			data:{a0:se,z1:JSON.stringify(remark_json),m1:msstr},
			success:function(result){
				var remark_re = JSON.parse(result);
				if (remark_re.Result){
					MARKFLAG = 1;
				}else{
					_alert(1,"访问备注","保存失败");
				}
			}
		})
	}
	var planid = 0;
	function get_plan(hostip){
		$.ajax({
			url:'/bhost/get_plan',
			type:'post',
			async:false,
			data:{a0:se,z1:hostip},
			success:function(result){
				var plan_result = JSON.parse(result);
				if (plan_result.data.length != 0){
					$("#operation_content").val(plan_result.data[0].PlanMsg);
					planid = plan_result.data[0].PlanId;
				}else{
					$("#operation_content").val('');
					planid = 0;
				}
			}
		})
	}

	function Get_GlobalStrategy(){
		$.ajax({
			url:'/bhost/get_globalstrategy',
			type:"POST",
			async:true,
			data:{a0:se},
			success: function(Result){
				global_data = JSON.parse(Result);
				IsTunnel = global_data.IsTunnel + "";
				MapPort = global_data.MapPort;				
				HideIP = global_data.IfHiddenHostIP
				if (global_data.IsTunnel){
					$(".passageway").hide();
				}else{
					if($('.linkmode_div1 .local_client').find('input').prop('checked')){
						$('.item.linkmode_div1').siblings(".passageway").show();
					}
					if($('.linkmode_div2 .local_client').find('input').prop('checked')){
						$('.item.linkmode_div2').siblings(".passageway").show();
					}
				}
			} 
		})
		$.ajax({
			url: "/bhost/PGet_UserGlobalConfig",
			type: "POST",
			async: false,
			data: { a0: se },
			success: function (result) {
				var result = JSON.parse(result);
				if (result.Result) {
					remote_data = result.info;
				} else {
					_alert(2, '批量启动', result.ErrMsg);
					return false;
				}
			}
		});		
	}
	function _goStep(i,obj){
		if($(obj).hasClass('active')){
			return;
		}

		var $snav = $('div.secnav1>ul>li');
		var $c = $('#contWrap>div.c-cont');
		var $b = $('#pageBtns>a.btn');

		if(i == 1){//第一页
			$snav.eq(0).addClass('active').siblings('li').removeClass('active');
			$c.eq(0).show().siblings('div.c-cont').hide();
			$b.eq(0).show().siblings('a.btn').hide();
		}else{//第二页
			var flag_return = save_data();
			if(flag_return == -1){
				return false;
			}			
			$snav.eq(1).addClass('active').siblings('li').removeClass('active');
			$c.eq(1).show().siblings('div.c-cont').hide();
			$b.eq(1).show();
			$b.eq(2).show();
			$b.eq(0).hide();
			if(RDPDisplay == 0){
				$(".pro-item").eq(0).css('background',"#eeeeee");
				$("#screensize").attr('disabled',true);
				$("#EnableRDPClipboard").attr('disabled',true);
				// $(".icheckbox_minimal-blue").css('background','#eeeeee');
				$("#EnableRDPDiskMap").attr('disabled',true);
				$("#access_select").attr('disabled',true);
				$("#passageway_select1").attr('disabled',true);
				$("#RDPTime").attr('disabled',true);
				$("#RDPTime").css('background',"#eeeeee");
			}else{
				$(".pro-item").eq(0).css('background','none');
				$("#screensize").removeAttr("disabled");
				$("#EnableRDPClipboard").removeAttr("disabled");
				$("#EnableRDPDiskMap").removeAttr("disabled");
				$("#access_select").removeAttr("disabled");
				$("#passageway_select1").removeAttr('disabled');
				$("#RDPTime").removeAttr("disabled");
				$("#RDPTime").css('background',"none");
			}
			if(SSHDisplay == 0){
				$(".pro-item").eq(1).css('background',"#eeeeee");
				$("#ClientSSH").attr('disabled',true);
				$("#AuthTypeSSH").attr('disabled',true);
				$("#passageway_select2").attr('disabled',true);
				$("#SSHTime").attr('disabled',true);
				$("#SSHTime").css('background',"#eeeeee");
			}else{
				$(".pro-item").eq(1).css('background',"none");
				$("#ClientSSH").removeAttr("disabled");
				$("#AuthTypeSSH").removeAttr("disabled");
				$("#passageway_select2").removeAttr('disabled');
				$("#SSHTime").removeAttr("disabled");
				$("#SSHTime").css('background',"none");
			}
			if(TELNETDisplay == 0){
				$(".pro-item").eq(2).css('background',"#eeeeee");
				$("#ClientTELNET").attr('disabled',true);
				$("#passageway_select3").attr('disabled',true);
				$("#TELNETTime").attr('disabled',true);
				$("#TELNETTime").css('background',"#eeeeee");
			}else{
				$(".pro-item").eq(2).css('background',"none");
				$("#ClientTELNET").removeAttr("disabled");
				$("#passageway_select3").removeAttr("disabled");
				$("#TELNETTime").removeAttr("disabled");
				$("#TELNETTime").css('background',"none");
			}
		}
	}
	//var hostdata = {""}
	var DeviceType = {
		"ServiceSet": [],
	}
	function save_data(){
		if($("#typeSet").val() == 1){
			save_host($("#hostTree"));	
			if(HostSet.length == 0){
				_alert(1, "批量启动", "选择对象为空");
				return -1;
			}
		}
		var getEAccount_json = {
			"LoginUserCode":"test",
			"SrcIp":"192.168.0.1",
			"BatchType": 4,
			"HostSet": []
		};
		if($("#typeSet").val() == 2){

			if ($("#ip_n").find(".ss").length < 2){
				if($("#input1").val() == "" || $("#input2").val() == ""){
					_alert(2, "批量启动", "请添加服务器范围");
					return -1;
				}
			}

			var AuthMode = 0;
			if ($("#typeSet").val() == 2) { //范围已定义
				if ($("#define_select").val() == 1) {
					if ($("#mix_select").val() == 1) {
						AuthMode = 3; //范围所有
					} else if ($("#mix_select").val() == 2) {
						AuthMode = 2; //范围共有
					}
				} else { //范围自定义
					AuthMode = 4;
				}
			} else { //对象指定
				AuthMode = 1;
			}

			if ($("#define_select").val() == 1) {//已定义
				if ($("#a_mix_select").val() == 1){
					if (accountid.length == 0) {
						_alert(2, "批量启动", "请选择账号");
						return -1;
					}
				}
				if ($("#s_mix_select").val() == 1){
					if ($("#service_list2").find('input:checked').length == 0) {
						_alert(2, "批量启动", "请选择服务");
						return -1;
					}
				}
				
			} else {//自定义
				if (account_arry.length == 1 && account_arry[0] == '-1') {
					_alert(2, "批量启动", "请选择账号");
					return -1;
				}
				if ($("#service_list1").children('tr').length == 0) {
					_alert(2, "批量启动", "请选择服务");
					return -1;
				}
			}

			getEAccount_json = {
				"LoginUserCode":"test",
				"SrcIp":"192.168.0.1",
				"BatchType": 4,
				"IPAddr": [
				],
				"AuthServiceSet": [
				],
				"AccountSet": [
				]
			}

			$.each($("#ip_n").find(".ss"),function(i,item){
				if($(item).attr("id") == "ip_span"){
					if($("#input1").val() == "" || $("#input2").val() == ""){
						return true;
					}
				}
				tmp3 = {
					"StartIP": "192.168.0.18",
					"EndIP": "192.168.0.200"
				}
				tmp3.StartIP = $(item).find("input").eq(0).val();
				tmp3.EndIP = $(item).find("input").eq(1).val();
				getEAccount_json.IPAddr.push(tmp3);
			});
			if ($("#a_mix_select").val() == 2){
				getEAccount_json.AccountSet = null;
			}else{
				var arry_f = account_arry.indexOf('-1');
				if (arry_f != -1) {
					account_arry.splice(arry_f, 1);
				}
				var a_tmp1 = [];
				if (AuthMode == 3 || AuthMode == 2){
					$.each(accountid,function(i,item){
						var a_tmp = {"AccountId":3};
						a_tmp.AccountId = item;
						a_tmp1.push(a_tmp);
					})
				}else{
					$.each(account_arry,function(i,item){
						var a_tmp = {"AccountId":3};
						a_tmp.AccountId = item;
						a_tmp1.push(a_tmp);
					})
				}
				getEAccount_json.AccountSet = a_tmp1;
			}

			if ($("#s_mix_select").val() == 2){
				getEAccount_json.AuthServiceSet = null;
			}else{
				var a_tmp2 = [];
				if (AuthMode == 3 || AuthMode == 2){
					$.each(AuthServiceSet,function(i,item){
						var s_tmp = {
							"ProtocolId": 3,
							"Port": 1521,  
							"ConnParamId": 50
						};
						var serverset = item.split('-');
						s_tmp.ProtocolId = serverset[0];
						s_tmp.Port = serverset[2];
						if(serverset[1] == "null"){
							serverset[1] = null;
						}
						s_tmp.ConnParamId = serverset[1];
						a_tmp2.push(s_tmp);
					})
				}else{
					$.each(DeviceType.ServiceSet,function(i,item){
						var s_tmp = {
							"ProtocolId": 3,
							"Port": 1521,  
							"ConnParamId": 50
						};
						s_tmp.ProtocolId = item.ProtocolId;
						s_tmp.Port = item.Port;
						if(item.ConnParamId == "null"){
							item.ConnParamId = null;
						}
						s_tmp.ConnParamId = item.ConnParamId;
						a_tmp2.push(s_tmp);
					})
				}
				getEAccount_json.AuthServiceSet = a_tmp2;
			}
		}
		getEAccount_json.HostSet = HostSet;
		$.ajax({
			url:'/bhost/Get_EnabledAccount',
			type:'post',
			async:false,
			data:{a0:se,a1:JSON.stringify(getEAccount_json)},
			success:function(result){
				EnabledAccount = JSON.parse(result).info;
				RDPDisplay = SSHDisplay = TELNETDisplay = 0;
				$.each(EnabledAccount,function(i,item){
					if(item.ProtocolName == "RDP"){
						RDPDisplay = 1;
					}else if(item.ProtocolName == "SSH"){
						SSHDisplay = 1;
					}else if(item.ProtocolName == "TELNET"){
						TELNETDisplay = 1;
					}
				})
			}
		})
	}
	var HostSet;
	function save_host(obj){
		HostSet = [];
		$(obj).find('span.checkbox').each(function(i,item){
			if ($(item).parent()[0].tagName == "LABEL") return true;
			var state = $(item).attr('class');
			var $u = $(item).next().next().next().next();
			var $i = $(item).parent().find('ul:first').children('li');
			var $_authtype = $(item).siblings('span.authtype');
			
			var $_input = $(item).prev('input');
			var _id = $_input.attr("id").split('-');
			var loadfirst = $_input.attr('data-loadfirst');
			var loadlast = $_input.attr('data-loadlast');
			
			if($_input.prop("disabled")) return true;
			if(loadfirst != loadlast){
				if ((loadfirst == 0 && loadlast == 2) || (loadfirst == 1 && loadlast == 2)){ //add
					if ($_authtype.length != 0){
						if ($_authtype.find('input').length != 0){
							if ($_authtype.find('input').prop('checked')){ //按组授权
								if (_id[0] == "nodehg"){
									if (loadfirst == 1 && loadlast == 2){
										var set = '{"HGId":'+_id[1]+',"HostId":null,"IsGroupAuth":true,"IsDelOld":true}';
									}else{
										var set = '{"HGId":'+_id[1]+',"HostId":null,"IsGroupAuth":true}';
									}
									var object_str = JSON.stringify(HostSet);
									if (object_str.indexOf(set) === -1){
										HostSet.push(JSON.parse(set));
									}
								}else{
									var HGroupId = _id[1]
									var HostId = _id[2];
									if (loadfirst == 1 && loadlast == 2){
										var set = '{"HGId":'+HGroupId+',"HostId":'+HostId+',"IsGroupAuth":true,"IsDelOld":true}';
									}else{
										var set = '{"HGId":'+HGroupId+',"HostId":'+HostId+',"IsGroupAuth":true}';
									}
									var object_str = JSON.stringify(HostSet);
									if (object_str.indexOf(set) === -1){
										HostSet.push(JSON.parse(set));
									}
								}
							}else{
								if ($(item).parent().parent().siblings('span.checkbox').length != 0){
									if ($(item).parent().parent().siblings('span.checkbox').attr('class').indexOf('checked') != -1){
										return true;
									}
								}
								if (_id[0] == "nodehg"){
									var set = '{"HGId":'+_id[1]+',"HostId":null,"IsGroupAuth":false}';
									var object_str = JSON.stringify(HostSet);
									if (object_str.indexOf(set) === -1){
										HostSet.push(JSON.parse(set));
									}
								}else{
									var HGroupId = _id[1]
									var HostId = _id[2];
									var set = '{"HGId":'+HGroupId+',"HostId":'+HostId+',"IsGroupAuth":false}';
									var object_str = JSON.stringify(HostSet);
									if (object_str.indexOf(set) === -1){
										HostSet.push(JSON.parse(set));
									}
								}
							}
						}else{//未分组
							if (_id[0] == "nodehg"){
								var set = '{"HGId":'+_id[1]+',"HostId":null,"IsGroupAuth":false}';
								var object_str = JSON.stringify(HostSet);
								if (object_str.indexOf(set) === -1){
									HostSet.push(JSON.parse(set));
								}
							}
						}
					}else{ //服务账号
						if ($(item).parent().parent().siblings('span.checkbox').length != 0){
							if ($(item).parent().parent().siblings('span.checkbox').attr('class').indexOf('checked') != -1){
								return true;
							}
						}
						if (_id[0] == "nodes"){
							var HGroupId = _id[1];
							var HostId = _id[2];
							var HostServiceId = _id[3];
							$(item).siblings('ul').children('li').each(function(i1,item1){
								var AccountId = $(item1).children('input').attr('id').split('-')[3];
								var set = '{"HGId":'+HGroupId+',"HostId":'+HostId+',"HostServiceId":'+HostServiceId+',"AccountId":'+AccountId+'}';
								var object_str = JSON.stringify(HostSet);
								if (object_str.indexOf(set) === -1){
									HostSet.push(JSON.parse(set));
								}
							})
						}else{
							var HGroupId = _id[1];
							var HostId = _id[2];
							var AccountId = _id[3];
							var HostServiceId = _id[4];
							var set = '{"HGId":'+HGroupId+',"HostId":'+HostId+',"HostServiceId":'+HostServiceId+',"AccountId":'+AccountId+'}';
							var object_str = JSON.stringify(HostSet);
							if (object_str.indexOf(set) === -1){
								HostSet.push(JSON.parse(set));
							}
						}
					}
				}else if ((loadfirst == 2 && loadlast == 0) || (loadfirst == 1 && loadlast == 0)){
					var $p_input = $(item).parent().parent().siblings('input');
					if ($p_input.length != 0){
						var p_loadfirst = $p_input.attr('data-loadfirst');
						var p_loadlast = $p_input.attr('data-loadlast');
						if (p_loadfirst == 2 && p_loadlast == 0){
							return true;
						} 
					}
					if (_id[0] == "nodehg"){
						var set = '{"HGId":'+_id[1]+',"HostId":null}';
						var object_str = JSON.stringify(DeleteAuthObject);
						if (object_str.indexOf(set) === -1){
							DeleteAuthObject.push(JSON.parse(set));
						}
					}else if (_id[0] == "nodeh"){
						var HGroupId = _id[1];
						var HostId = _id[2];
						var set = '{"HGId":'+HGroupId+',"HostId":'+HostId+'}';
						var object_str = JSON.stringify(DeleteAuthObject);
						if (object_str.indexOf(set) === -1){
							DeleteAuthObject.push(JSON.parse(set));
						}
					}else if (_id[0] == "nodes"){
						var HGroupId = _id[1];
						var HostId = _id[2];
						var HostServiceId = _id[3];
						$(item).siblings('ul').children('li').each(function(i1,item1){
							var AccountId = $(item1).children('input').attr('id').split('-')[3];
							var set = '{"HGId":'+HGroupId+',"HostId":'+HostId+',"HostServiceId":'+HostServiceId+',"AccountId":'+AccountId+'}';
							var object_str = JSON.stringify(DeleteAuthObject);
							if (object_str.indexOf(set) === -1){
								DeleteAuthObject.push(JSON.parse(set));
							}
						});
					}else if (_id[0] == "nodea"){
						var HGroupId = _id[1];
						var HostId = _id[2];
						var AccountId = _id[3];
						var HostServiceId = _id[4];
						var set = '{"HGId":'+HGroupId+',"HostId":'+HostId+',"HostServiceId":'+HostServiceId+',"AccountId":'+AccountId+'}';
						var object_str = JSON.stringify(DeleteAuthObject);
						if (object_str.indexOf(set) === -1){
							DeleteAuthObject.push(JSON.parse(set));
						}
					}
				}else if (loadfirst == 2 && loadlast == 1){
					if ($_input.attr('data-ifselect') == "true"){
						if (_id[0] == "nodehg"){
							var set = '{"HGId":'+_id[1]+',"HostId":null,"IsGroupAuth":false,"IsDelOld":true}';
							var object_str = JSON.stringify(HostSet);
							if (object_str.indexOf(set) === -1){
								HostSet.push(JSON.parse(set));
							}
						}else if (_id[0] == "nodeh"){
							var HGroupId = _id[1];
							var HostId = _id[2];
							var set = '{"HGId":'+HGroupId+',"HostId":'+HostId+',"IsGroupAuth": false,"IsDelOld":true}';
							var object_str = JSON.stringify(HostSet);
							if (object_str.indexOf(set) === -1){
								HostSet.push(JSON.parse(set));
							}
						}
					}
				}
			}else{
				if ($_authtype.length != 0){
					if ($_authtype.find('input').length != 0){
						if (($_authtype.find('input').prop('checked')) && ($_input.attr('data-ifselect') == 'false')){ //未按组——>按组授权
							if(_id[0] == 'nodehg') HostSet.push(JSON.parse('{"HGId": '+_id[1]+',"HostId": null,"IsGroupAuth": true,"IsDelOld":true}'));
							else HostSet.push(JSON.parse('{"HGId": '+_id[1]+',"HostId": '+_id[2]+',"IsGroupAuth": true,"IsDelOld":true}'));
						}else if (($_authtype.find('input').prop('checked') == false) && ($_input.attr('data-ifselect') == 'true')){
							if(_id[0] == 'nodehg') {
								HostSet.push(JSON.parse('{"HGId": '+_id[1]+',"HostId": null,"IsGroupAuth": false,"IsDelOld":true}'));
							}
							else{
								HostSet.push(JSON.parse('{"HGId": '+_id[1]+',"HostId": '+_id[2]+',"IsGroupAuth": false,"IsDelOld":true}'));
							}
						}
					}
				}
			}
		});
	}
	var flag_two = '';//记录是否已经保存过
	function client_module_show(arr_client_ssh,arr_client_telnet){
		$("#client_module").find('div.c-form').hide();
		$("#client_module").find('span.form-tag').text('');
		$("#client_module").find('input').val('');
		$("#client_module").find('select').val('0').trigger('change');
		var $dialogCont = $("#client_module").show();
		d = dialog({
			title:"批量启动",
			content:$dialogCont,
			id:"client_module",
			width:"850px"
				});
		var n = 0;
		var arr_client = [];
		var flag_same= 0 ;
		if(arr_client_ssh == arr_client_telnet){
			$("#client_module").find('div.c-form').eq(0).show();
			$("#client_module").find('span.form-tag').eq(0).text(arr_client_ssh+'：');
			arr_client.push({"ProtocolName":"SSH","ClientName":arr_client_ssh});
			flag_same =1;
		}else{
			if(arr_client_ssh ==""){
				$("#client_module").find('div.c-form').eq(1).show();
				$("#client_module").find('span.form-tag').eq(1).text(arr_client_telnet+'：');
				arr_client.push({"ProtocolName":"TELNET","ClientName":arr_client_telnet});
			}else if(arr_client_telnet ==''){
				$("#client_module").find('div.c-form').eq(0).show();
				$("#client_module").find('span.form-tag').eq(0).text(arr_client_ssh+'：');
				arr_client.push({"ProtocolName":"SSH","ClientName":arr_client_ssh})
			}else{
				$("#client_module").find('div.c-form').eq(0).show();
				$("#client_module").find('span.form-tag').eq(0).text(arr_client_ssh+'：');
				$("#client_module").find('div.c-form').eq(1).show();
				$("#client_module").find('span.form-tag').eq(1).text(arr_client_telnet+'：');
				arr_client.push({"ProtocolName":"SSH","ClientName":arr_client_ssh});
				arr_client.push({"ProtocolName":"TELNET","ClientName":arr_client_telnet});
			}
		}
				function addEventListener(ele,event,fn){
			if(ele.addEventListener){
				ele.addEventListener(event,fn,false);
			}else{
				ele.attachEvent('on'+event,fn.bind(ele));
			}
		}
		addEventListener(d,'close',function () {
			 $dialogCont.appendTo("body").hide();
		});
				d.showModal();
		$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
			d.close().remove();
				});
				$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
			
			var n = 0;
			var m = 0;
			$.each(arr_client,function(i,item){
				if($('#ClientSSH').attr('disabled')=='disabled' || $('#ClientSSH option:selected').text().indexOf('未设置') <0){
					m +=1;
				}
				if(flag_two == item.ClientName) return true;
				
				var LocalClient_json = {
					"LocalClientId": 0,    
					"ProtocolName": null,
					"ClientName": null,        
					"ClientProgram": null,
					"ClientIP":null
				};
				if(item.ClientName == "Netterm")  LocalClient_json.ProtocolName = "TELNET";
				else LocalClient_json.ProtocolName = "SSH";					
				LocalClient_json.ClientName = item.ClientName;
				LocalClient_json.ClientProgram = $("#client_module").find('input').eq(m).val();
				if ($("#client_module").find('input').eq(m).prev('label').find('select').val() == '1') LocalClient_json.ClientIP=client_ip_global;
				
				if(LocalClient_json.ClientProgram == ""){
					n = 1;
					_alert(2,'批量启动',"请输入路径",$("#client_module").find('input').eq(m));
					return false;
				}
				var msstr = aceg(JSON.stringify(LocalClient_json),se);
				$.ajax({
					url: "/bhost/PSave_LocalClient",
					type:"POST",
					async:false,
					data:{a0:se,a1:JSON.stringify(LocalClient_json),m1:msstr}, 
					success:function(result){
						var result=JSON.parse(result);
						if(result.Result){
							$.ajax({
								url: "/bhost/PGet_LocalClient",
								type:"POST",
								async:false,
								data:{a0:se},
								success:function(result){
									var result=JSON.parse(result);
									if(result.Result){
										path_array = result.info.data;
										client_ip_global = result.client_ip_global;
									}else{
										_alert(2,'批量启动',result.ErrMsg);
										return false;
									}
								}
							});
							
							if(m == 0) {
								flag_two = item.ClientName;
								$('select option[value='+item.ClientName+']').text(item.ClientName)
								$('#ClientSSH').select2('destroy').select2()
								if(flag_same == 0){
									;
								}else{
									$('#ClientTELNET').select2('destroy').select2()
								}
							}
							if(m == 1) {							
								$('select option[value='+item.ClientName+']').text(item.ClientName)
								$('#ClientTELNET').select2('destroy').select2()
							}
							
						}else{
							_alert(2,'批量启动',result.ErrMsg);
							return false;
						}
					}
				});
			})
			if(n) return false;
			d.close().remove();
			_submit();	
			flag_two = '';
		});
	}

</script>

<script>
//范围选定
//
//
var se = window.parent.document.frm.se.value;
var usercode = window.parent.document.frm.us.value;
var SUP_PROTOCOL = ['RDP','SSH','TELNET'];
var TYPE = 4;
var accountid = [];
var h_data = "";
function _typeSet(obj) {
	var i = $(obj).val();//2:范围指定，1:个别指定

	if (i == 1) {
		$('#pointSet2').show();
		$('#pointSet1').hide();
	} else if (i == 2) {
		$('#pointSet2').hide();
		$('#pointSet1').show();
		bind_server_xSelect();
		_initSize();
	}
}

var push_hgid = [];
var push_hid = [];
var push_hid_len = 0;
var editid = 0;
var type_json = {
	"Type":2,
}
//获取host
function get_hostdirectory(id,editid,type){
	$.ajax({
		url:'/bhost/GetAuthObject_B',
		type:'post',
		async:false,
		cache:false,
		data:{a0:se,a1:id,a3:false,a4:type,a6:JSON.stringify(type_json)},
		success:function(result){
			h_data = JSON.parse(result);
			if(h_data.Result == false){
				_alert(1,"批量启动",h_data.ErrMsg);
			}
			if(editid > 0 ){
				$(h_data.data.HGroup).each(function(i,item){
					if(push_hgid.indexOf(item.HGId) <0){
						push_hgid.push(item.HGId + ":false");
					}
				})
			}
		}
	})
}


//获取服务器范围内容
var ajax_flag1 = false;
function add_server() {
	if ($("#a_mix_select").val() == 2 && $("#s_mix_select").val() == 2){//所有
		return false;
	}
	//--1.系统批处理，2.MYSQL，3.ORACLE
	var auth_json = {
		"BatchType": "",
		"IPAddr": []
	};
	var add = 0;
	$("#service_list_a,#protocol,#param,#service_list2").empty();
	$("#check_all_a").iCheck('uncheck');
	$("#check_all").iCheck('uncheck');
	auth_json.BatchType = 4;
	$.each($("#ip_n").find(".ss"),function(i,item){
		if($(item).attr("id") == "ip_span"){
			if($("#input1").val() == "" || $("#input2").val() == ""){
				return true;
			}
		}
		var tmp_a = {"StartIP": "192.168.1.1","EndIP": "192.168.1.255"};
		tmp_a.StartIP = $(item).find("input").eq(0).val();
		tmp_a.EndIP = $(item).find("input").eq(1).val();
		auth_json.IPAddr.push(tmp_a)
		add = 1;
	})
	// if ($("#ips").data('value') != undefined && $("#ips").data('value') != '-1'){
		// var serverset = '{"ServerScopeId":' + $("#ips").data('value') + '}';
		// serverset = JSON.parse(serverset);
		// auth_json.ServerScopeSet.push(serverset);
		// add = 1;
	// }
	// $("#server_frame_list").children('div:not(:first)').each(function (i, item) {
		// var id = $(item).attr('id');
		// var serverset = '{"ServerScopeId":' + id + '}';
		// serverset = JSON.parse(serverset);
		// auth_json.ServerScopeSet.push(serverset);
		// add = 1;
	// });
	if (add == 1) {
		var accountid_temp = [];
		var ConnParamName = "";
		var set;
		var AuthServiceSet_temp = [];
		var apdata;

		//获取所有的账号和服务
		if (all_flag == 1) {
			ajax_flag1 = false;
			$.ajax({
				url: '/bhost/get_AccountProtocolForAuth_B',
				type: 'post',
				async: false,
				data: { a0: se, z1: JSON.stringify(auth_json) },
				success: function (result) {
					apdata = JSON.parse(result);
					if(apdata.Result == false){
						_alert(2, "批量启动", apdata.ErrMsg);
						return false;
					}
					ajax_flag1 = true;
				}
			});
		} else {
			ajax_flag1 = false;
			$.ajax({
				url: '/bhost/Get_SameAccountProtocolForAuth_B',
				type: 'post',
				async: false,
				data: { a0: se, z1: JSON.stringify(auth_json) },
				success: function (result) {
					if (result == "None") {
						add = 0;
					} else {
						apdata = JSON.parse(result);
						if(apdata.Result == false){
							_alert(2, "批量启动", apdata.ErrMsg);
							return false;
						}
					}
					ajax_flag1 = true;
				}
			})
		}
		if (add == 0) {
			return false;
		}
		if ($("#a_mix_select").val() != 2){
			var account_table = "";
			$.each(apdata.AccountSet, function (i, item) {
				if (accountid_temp.indexOf(item.AccountId) === -1) {
					accountid_temp.push(item.AccountId);
					/*
					if (item.AccountId == 5){
						return true;
					}
					*/
					account_table = account_table + '<tr><td width="50"><input type="checkbox" class="form-checkbox" id="ai' + item.AccountId + '"/></td><td>' + item.AccountName + '</td></tr>';
				}
			});
			$("#service_list_a").append(account_table);
		}
		if ($("#s_mix_select").val() != 2){
			var service_table = "";
			$.each(apdata.ServiceSet, function (i, item) {
				if (item.ConnParamName == null) {
					ConnParamName = "";
				} else {
					ConnParamName = item.ConnParamName;
				}
				set = item.ProtocolId + '-' + item.ConnParamId + '-' + item.Port;
				AuthServiceSet_temp.push(set);
				service_table = service_table + "<tr><td width=\"50\"><input type=\"checkbox\" class=\"form-checkbox\" id=\"" + item.ProtocolId + "-" + item.ConnParamId + "-" + item.Port + "\"/></td><td>" + item.ProtocolName + "</td><td>" + item.Port + "</td><td>" + ConnParamName + "</td></tr>";
			});
			$("#service_list2").append(service_table);
		}
		_change_app();
		
		var isexist = 0;
		var A_C_TEMP = accountid.slice(0);
		$.each(A_C_TEMP, function (i, item) {
			$.each(accountid_temp, function (i1, item1) {
				if (item1 == item) {
					isexist = 1;
					return false;
				} else {
					isexist = 0;
				}
			});
			if (isexist == 1) {
				return true;
			} else {
				accountid.splice($.inArray(item, accountid), 1);
			}
		});
		var A_S_TEMP = AuthServiceSet.slice(0);
		$.each(A_S_TEMP, function (i, item) {
			$.each(AuthServiceSet_temp, function (i1, item1) {
				if (item1 == item) {
					isexist = 1;
					return false;
				} else {
					isexist = 0;
				}
			});
			if (isexist == 1) {
				return true;
			} else {
				//if (item != '-1') {
					AuthServiceSet.splice($.inArray(item, AuthServiceSet), 1);
				//}
			}
		});
	} else {
		accountid = [];
		AuthServiceSet = [];
	}
	if ($("#defined_info").is(':visible') && $("#a_mix_select").val() == 1){
		var de_h = $("#defined_info").children(".h-catelog.h-catelog2.h-content2_temp:eq(0)").height();
		$("#service_list_a").parents('.c-table.tab-type2').css('max-height',de_h-109);
	}
	if ($("#defined_info").is(':visible') && $("#s_mix_select").val() == 1){
		var de_h = $("#defined_info").children(".h-catelog.h-catelog2.h-content2_temp:eq(1)").height();
		$("#service_list2").parents('.c-table.tab-type2').css('max-height',de_h-109);
	}
}
var s_index_all = [];
var serverid_list = ['-1'];
function change_ser_scope(obj){
	var t = $(obj).find('span').data('value');
	if (serverid_list.indexOf(t) === -1 && t != undefined) {
		serverid_list.splice(0, 1, t);
	}
}

var protocol_id;
function _editNode5(obj,type){
	clear_protocol();
	var title;
	if (type == 1) {//
		protocol_id = $(obj).children('span').data('value');
		title = "协议";
	} else if (type == 2) {
		protocol_id = 0;
		title = "协议";
	}
	var $dialogCont = $("#protoDialog").show();
	var d = dialog({
		title: title,
		content: $dialogCont,
		id: "protoDialog",
		width: "1000px"
	});
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	d.showModal();
	if (manage_auth_array.indexOf(14) === -1){
		$("#protoDialog").find('.btn-submit').remove();
	}
	protocol_main(type);
	$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
		clear_protocol();
		protocol_main(type);
	});
	$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
		save_pro(d);
	})
}

function protocol_main(type){
	$("#Port1").parent().parent().hide();
	$("#Port0").on("input propertychange",function(){
		this.value = this.value.replace(/\D/g, "");
	}).on("paste",function(){return false});
	$("#Port1").on("input propertychange",function(){
		this.value = this.value.replace(/\D/g, "");
	}).on("paste",function(){return false});
	if(type == 1){
		$.ajax({
			 url:'/bhost/select_protocol',
			 type:"post",
			 async:false,
			 data:{a0:se,x1:protocol_id},
			 success:function(result){
				protdata = JSON.parse(result);
				$.each(protdata.data,function(i,item){
					if(item.ProtocolName=="PCANY")
					{
						$("#Port1").parent().parent().show();
						$("#Port1").val(item.Port1);
					}
					$("#Protocol_Name0").val(item.ProtocolName);
					$("#Port0").val(item.Port);
					$("#Description0").val(item.Description);
					$("#Protocol_Name0").attr("disabled",true);
				});
			}
		});
	}
}

function namecheck(name){
	var flag=true;
	$.ajax({
		url:'/bhost/select_name',
		type: "post",
		async:false,
		data: {a0:se,x1:name},
		success:function(result){
			data = parseInt(result);
			if (data !=0){
				flag=false;
			}
		}
	});
	return flag;
}

var proto_list;
function get_protocol_list(){
	$.ajax({
		url:'/bhost/get_protocol_list',
		type: "post",
		async:false,
		cache:false,
		data: {a0:se,a1:1,a2:null,a3:null,a4:',,',a5:null},
		success: function(Result) {
			proto_list = JSON.parse(Result);
		}
	});
}

function clear_protocol(){
	$("#protoDialog").find('input').val('');
	$("#Protocol_Name0").attr('disabled',false);
}

function bind_protocol_select(){
	get_protocol_list();
	var protocol_array = [];
	/*$.each(proto_list.data,function(i,item){
		if (manage_auth_array.indexOf(14) != -1){
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'check'
			};
		}else if (access_auth_array.indexOf(14) != -1){
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'check'
			};
		}else{
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':null
			};
		}
		select_data_json.value = item.ProtocolId;
		select_data_json.name = item.ProtocolName;
		protocol_array.push(select_data_json);
	});*/
		protocol_array = [
			{
				'value':1,
				'name':'RDP',
				'type':'check'
			},
			{
				'value':2,
				'name':'SSH',
				'type':'check'
			},
			{
				'value':9,
				'name':'TELNET',
				'type':'check'
			}
		];
	$('#ProtocolName').empty().data('xSelect',"");
	if (manage_auth_array.indexOf(14) != -1){
		$('#ProtocolName').xSelect({
			width: 140,
			defaultText: '请选择',
			items:protocol_array,
			module_type:'protocol',
			check: function(item,obj){
				$(obj).parents('.xSelect-view').hide();
				_editNode5(obj,1);
			},
			btn:[
			],
			setval:function(item,obj){
				sel_id = $(obj).find('span').data('value');		
				bind_conn_select();
				$.each(proto_list.data,function(i,item){
					if (sel_id == item.ProtocolId){
						$("#Port").val(item.Port);
						return false;
					}
				});
				var ProtocolId_arr=[9,10,11,12,16,17,18];
				if($.inArray(sel_id,ProtocolId_arr)>=0){
					// $('#ConnParamName').parent('div.form-item').hide();
				}else{
					$('#ConnParamName').parent('div.form-item').show();
				}
					
			}
		});
	}else{
		$('#ProtocolName').xSelect({
			width: 140,
			defaultText: '请选择',
			items:protocol_array,
			module_type:'protocol',
			check: function(item,obj){
				$(obj).parents('.xSelect-view').hide();
				_editNode5(obj,1);
			},
			setval:function(item,obj){
				sel_id = $(obj).find('span').data('value');		
				bind_conn_select();
				$.each(proto_list.data,function(i,item){
					if (sel_id == item.ProtocolId){
						$("#Port").val(item.Port);
						return false;
					}
				});
				var ProtocolId_arr=[9,10,11,12,16,17,18];
				if($.inArray(sel_id,ProtocolId_arr)>=0){
					// $('#ConnParamName').parent('div.form-item').hide();
				}else{
					$('#ConnParamName').parent('div.form-item').show();
				}
			}
		});
	}
}

////服务器范围 浮层
var d = null;
var last_object_s = [];

//绑定服务器范围
function binding_ServerScope() {
	$.ajax({
		url: '/bhost/get_ServerScope',
		type: 'post',
		async: false,
		data: { a0: se },
		success: function (result) {
			serdata = JSON.parse(result);
		}
	});
}

function bind_server_xSelect(){
	binding_ServerScope();
	var server_array = [];
	s_index_all = [];
	$.each(serdata.data,function(i,item){
		if ($("#ips").data('value') == item.ServerScopeId){
			
		}else{
			if (serverid_list.indexOf(item.ServerScopeId) > -1){
				return true;
			}
		}
		var select_data_json = {
			'value':1,
			'name':'admin2'
		};
		select_data_json.value = item.ServerScopeId;
		select_data_json.name = item.ServerScopeName;
		server_array.push(select_data_json);
		s_index_all.push(item.ServerScopeId);
	});
	$('#ips').xSelect({
		width: 162,
		defaultText: '请选择',
		items:server_array,
		module_type:'server',
		btn:[
		],
		setval:function(item,obj){
			change_ser_scope(obj);
			if (($("#a_mix_select").val() == 1 || $("#s_mix_select").val() ==1)){
				//change_server(obj);
			}
		}
	});
}

function add_server_scope(obj){
	var server_id = $(obj).prev('div').data('value');
	var v = $(obj).prev('div').find('span').text();
	if (server_id == undefined || server_id == '-1'){
		_alert(2, "批量启动", "请选择服务器范围");
		return false;
	}
	var $c = $('<div style="width:214px;" class="item" id="' + server_id + '"/>');
	if (serverid_list.indexOf(server_id) === -1) {
		serverid_list.push(server_id);
	}
	serverid_list.splice(0, 0, '-1');
	s_index_all.splice($.inArray(parseInt(server_id), s_index_all), 1);
	$c.html('<input style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;width: 144px;padding: 0 8px;" typr="text" class="form-text" disabled="true" value="' + v + '"><i class="ctrl del" onclick="_del_scope(this,3)"></i>');
	$(obj).parent().after($c);
	//$(obj).parent().find('input:first').val("");
	$("#ips").find('span').text('请选择');
	$("#ips").data('value',-1);
	$("div[data-id=xSelect-server]").children('input').val('');
	$("div[data-id=xSelect-server]").find('span[data-value='+server_id+']').parent('li').remove();
}
var server_find_json = {
	"loginusercode": null,
	"hgid": 0,
	"istree": true,
	"hgname": "",
	"hostname": "",
	"hostip": "",
	"limitrow": null,
	"offsetrow": null
}
//已定义自定义
function define_change(obj) {
	var v = $(obj).val();
	if (v == 1) { //已定义	
		$("#mix_module").show();
		$("#custom_info").hide();
		$("#server_frame").show();
		$("#defined_info").show();
		add_server();
	} else if (v == 2) { //自定义
		$("#mix_module").hide();
		$("#defined_info").hide();
		//$("#server_frame").hide();
		$("#custom_info").show();
	}
}
//绑定账号协议连接参数事件
var AuthServiceSet = [];
function _change_app() {
	$('#account,#protocol,#param,#service_list2').find('input').iCheck({
		checkboxClass: 'icheckbox_minimal-blue',
		radioClass: 'iradio_minimal-blue',
		increaseArea: '0' // optional
	});
	
	$.each(accountid, function (i, item) {
		$("#ai" + item).iCheck('check');
	});
	var list_len_a = $("#service_list_a").find('input').length;
	if ($("#service_list_a").find('input:checked').length == list_len_a && list_len_a != 0) {
		$("#check_all_a").iCheck('check');
	} else {
		$("#check_all_a").iCheck('uncheck');
	}
	$.each(AuthServiceSet, function (i, item) {
		$("#" + item).iCheck('check');
	});
	var list_len = $("#service_list2").find('input').length;
	if ($("#service_list2").find('input:checked').length == list_len && list_len != 0) {
		$("#check_all").iCheck('check');
	} else {
		$("#check_all").iCheck('uncheck');
	}
	
	$('#service_list_a').find('input').on('ifChanged', function () {
		var id = $(this).attr('id').substring(2);
		if ($(this).prop('checked')) {
			if (accountid.indexOf(id) === -1) {
				accountid.push(id);
			}
		} else {
			accountid.splice($.inArray(id, accountid), 1);
		}
	});
	//var list_len = $("#service_list2").find('input').length;
	$('#service_list2').find('input').on('ifChanged', function () {
		var id = $(this).attr('id');
		if ($(this).prop("checked")) {
			if (AuthServiceSet.indexOf(id) === -1) {
				AuthServiceSet.push(id);
			}
		} else {
			AuthServiceSet.splice($.inArray(id, AuthServiceSet), 1);
		}
		if ($("#service_list2").find('input:checked').length == list_len && list_len != 0) {
			$("#check_all").iCheck('check');
		} else {
			$("#check_all").iCheck('uncheck');
		}
	});
	//var list_len_a = $("#service_list_a").find('input').length;
	$('#service_list_a').find('input').on('ifChanged', function () {
		var id = $(this).attr('id').substring(2);
		if ($(this).prop("checked")) {
			if (accountid.indexOf(id) === -1) {
				accountid.push(id);
			}
		} else {
			accountid.splice($.inArray(id, accountid), 1);
		}
		if ($("#service_list_a").find('input:checked').length == list_len_a && list_len_a != 0) {
			$("#check_all_a").iCheck('check');
		} else {
			$("#check_all_a").iCheck('uncheck');
		}
	});
	$("#check_all_a").on("ifClicked", function () {
		if (!$(this).prop("checked")) {
			$("#service_list_a").find('input').iCheck('check');
		} else {
			$("#service_list_a").find('input').iCheck('uncheck');
		}
	});
	$("#service_list_a").children('tr').bind('click', function (e) {
		x = e.target;
		if (x.nodeName != 'A') {
			var input = $(this).find("input[type='checkbox']");
			if ($(input).prop('checked') == false) {
				$(input).iCheck('check');
			} else {
				$(input).iCheck('uncheck');
			}
		}
	});
	$("#service_list2").children('tr').bind('click', function (e) {
		x = e.target;
		if (x.nodeName != 'A') {
			var input = $(this).find("input[type='checkbox']");
			if ($(input).prop('checked') == false) {
				$(input).iCheck('check');
			} else {
				$(input).iCheck('uncheck');
			}
		}
	});
}

var account_arry = ['-1'];
//选择账号
function change_account(obj) {
	var t = $(obj).children('option:selected').val();
	if (account_arry.indexOf(t) === -1 && t != undefined) {
		account_arry.splice(0, 1, t);
	}
	if ($(obj).children('option').length == 2 && t != '-1') {
		$(obj).parent().children('i.add').click();
		$(obj).parent().hide();
	}
}
var a_data;
var a_index_all = [];
//获取账号
function get_account() {
	$.ajax({
		url: '/bhost/select_account_all',
		type: 'post',
		async: false,
		data: { a0: se, z11: -1 },
		success: function (result) {
			a_data = JSON.parse(result);
			$("#account_select").append('<option value="-1">请选择</option>');
			var AName;
			$.each(a_data.data, function (i, item) {
				/*
				if (item.AccountName == '*') {
					AName = '任意账号';
				} else if (item.AccountName == '-') {
					AName = '空账号';
				} else {
					AName = item.AccountName;
				}
				*/
				AName = item.AccountName;
				$("#account_select").append('<option value="' + item.AccountId + '">' + AName + '</option>');
				a_index_all.push(item.AccountId);
			});
		}
	});
	$('#account_select').select2();
}

function _addaccount(obj) {
	var add = 0;
	var name2 = $(obj).parent().children('select').children('option:selected').val();
	var t = $(obj).parent().children('select').children('option[value=' + name2 + ']').text();
	if (name2 == undefined) {
		$(obj).parent().children('select').val('-1').trigger('change');
		return false;
	}
	if (name2 == -1) {
		_alert(2, "批量启动", "请选择账号");
		return;
	}
	account_arry.splice(0, 0, '-1');
	a_index_all.splice($.inArray(parseInt(name2), a_index_all), 1);
	var $c = $(obj).parent();
	var d = $('select>option:first', $c).val();
	$c.children('select').val(d);
	var $s = $('<li class="item" id="' + name2 + '"><input type="text" class="form-text" value="' + t + '" style="width:86px;" disabled="true"><i class="ctrl del" style="margin-left: 10px;" onclick="_del_mora(this,2)"></i></li>');
	$c.children('select').find('option[value=' + name2 + ']').remove();
	$c.after($s);
}
//删除账号
var m_index_all = [];
function _del_mora(obj, type) {
	var $c = $(obj).parent();
	var id = $c.attr('id');
	var t = $(obj).siblings('input').val();
	var v, data, max;
	var min = 0;
	if (type == 1) {
		max = m_index_all.length - 1;
		data = m_index_all;
		$("#manager_select").parent().show();
		manager_arry.splice($.inArray(id, manager_arry), 1);
		$p = $("#manager_select");
	} else {
		max = a_index_all.length - 1;
		$("#account_select").parent().show();
		account_arry.splice($.inArray(id, account_arry), 1);
		data = a_index_all;
		$p = $("#account_select");
	}
	$c.remove();
	if (max < 0){
		var index_1 = -1;
	}else{
		var index_1 = search_i(min, max, id, data);
	}
	//var index_1 = search_i(min, max,id, data);
	index_1 = parseInt(index_1);

	if (index_1 == -1) {
		index_1 = max + 1;
		$p.append('<option value="' + id + '">' + t + '</option>');
	} else if (index_1 == -2) {
		index_1 = 0;
		$p.children('option').eq(0).after('<option value="' + id + '">' + t + '</option>');
	} else {
		$p.children('option[value=' + data[index_1] + ']').before('<option value="' + id + '">' + t + '</option>');
	}
	if (type == 1) {
		m_index_all.splice(index_1, 0, parseInt(id));
	} else {
		a_index_all.splice(index_1, 0, parseInt(id));
	}
}
function search_i(min, max, id, data) {
	var mid, res;
	if (data[max] < id) {
		return -1;
	}
	
	if (data[min] > id) {
		return -2;
	}
	while (min <= max) {
		mid = parseInt((min + max) / 2);
		if (data[mid] > id) {
			max = mid - 1;
			res = mid;
		} else {
			min = mid + 1;
		}
	}
	return res;
}

function _authTypeTheme(obj) {
	$.each(obj, function (i, item) {
		var $_item = $(item);

		if ($_item.parent().children('span').length == 0) {
			$_item.after('<span class="checkbox"></span>');
		}

		var $s = $_item.next('span');
		var checked = $_item.prop('checked');
		var disabled = $_item.prop('disabled');

		if (checked) {
			$s.addClass('checked');
		} else {
			$s.removeClass('checked');
		}

		if (disabled) {
			$s.addClass('disabled');
		} else {
			$s.removeClass('disabled');
		}
	})
}

function clear_conn(){
	$("#d_n_con").attr('disabled',false).val("");
	$("#d_n_con").next('i').attr('class','v-check');
	$("#connDialog").find('input').val('');
	$("#connDialog").find('select').val('0').trigger('change');
	$("#ServiceName_ssh").val('1').trigger('change');
	$("#rdpType").val('NORMAL').trigger('change');
}

var conn_id;
var manage_auth_array = [];
function _editNode6(obj,type){
	clear_conn();
	var title;
	if (type == 1) {//
		conn_id = $(obj).children('span').data('value');
		title = "连接参数";
	} else if (type == 2) {
		protocol_id = 0;
		title = "连接参数";
	}
	var $dialogCont = $("#connDialog").show();
	var con_d = dialog({
		title: title,
		content: $dialogCont,
		id: "connDialog",
		width: "800px;"
	});
	con_d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	con_d.showModal();
	if (manage_auth_array.indexOf(14) === -1){
		$("#connDialog").find('.btn-submit').remove();
	}
	conn_main(type);
	$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
		clear_conn();
		conn_main(type);
	});
	$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
		//connection_add(con_d);
	})
}

function conn_main(type){
	var ProtocolId_arr=[9,10,11,12,16,17,18];
	//协议类型下拉框
	$.ajax({
		url: "/bhost/get_protocol_list",
		type: "POST",
		async: false,
		data: { a0: se, a3: 17, a2: 1, a4: ",," },
		success: function (result) {
			var userinfo_result = JSON.parse(result);
			var userinfo_data = userinfo_result.data;
			$("#Protocol_con").empty();
			$("#Protocol_con").append('<option value="0">请选择</option>');
			$.each(userinfo_data, function (i, item) {
				if($.inArray(item.ProtocolId,ProtocolId_arr)>=0){
					return true;
				}
				$("#Protocol_con").append('<option value="' + item.ProtocolId + '" text="' + item.ProtocolName + '">' + item.ProtocolName + '</option>');
			});
		}
	});
	if (type == 1) {
		$.ajax({
			url: "/bhost/get_connection_list",
			type: "POST",
			async: false,
			data: { a0:se, a1: conn_id },
			success: function (result) {
				var connection_result = JSON.parse(result);
				if (connection_result.Result == true) {
					var connection_data = connection_result.info.data[0];
					$("#d_n_con").val(connection_data.ConnParamName);
					$("#d_n_con").attr("disabled", true);
					$("#Protocol_con").val(connection_data.ProtocolId).trigger('change');
					$("#HTTP").hide();
					$("#HTTPs").hide();
					$("#ORACLE").hide();
					$("#RADMIN").hide();
					$("#MSSQL").hide();
					$("#SYBASE").hide();
					$("#MY_DB2").hide();
					$('#RDP').hide();
					$("#SSH").hide();
					//$('#MY_ConnType').hide();
					$("#DB2").hide();
					switch (connection_data.ProtocolName) {
						case 'RDP':
							$('#RDP').show();
							$('#rdpType').val(connection_data.ConnType).trigger('change');
							break;
						case 'SSH':
							$('#SSH').show();
							$('#ServiceName_ssh').val(connection_data.ServiceName).trigger('change');
							break;
						case 'SFTP':
							$('#SFTP').show();
							$('#ServiceName_sftp').val(connection_data.ServiceName).trigger('change');
							break;
						//HTTP(S)
						case 'HTTP(S)':
							$("#HTTP").show();
							$("#url").val(connection_data.ServiceName);
							var index=connection_data.ConnParamValue.indexOf('|');
							$("#UserName").val(connection_data.ConnParamValue.substring(0,index));
							connection_data.ConnParamValue=connection_data.ConnParamValue.substring(index+1);
							var index=connection_data.ConnParamValue.indexOf('|');
							$("#UserPwd").val(connection_data.ConnParamValue.substring(0,index));
							$("#Submit").val(connection_data.ConnParamValue.substring(index+1));
							break;
						//HTTPs
						case 'HTTPS':
							$("#HTTPs").show();
							$("#httpsurl").val(connection_data.ServiceName);
							var index=connection_data.ConnParamValue.indexOf('|');
							$("#httpsUserName").val(connection_data.ConnParamValue.substring(0,index));
							connection_data.ConnParamValue=connection_data.ConnParamValue.substring(index+1);
							var index=connection_data.ConnParamValue.indexOf('|');
							$("#httpsUserPwd").val(connection_data.ConnParamValue.substring(0,index));
							$("#httpsSubmit").val(connection_data.ConnParamValue.substring(index+1));
							break;
						//ORACLE
						case 'ORACLE':
							//
							if (connection_data.ConnParamValue == null) {
								connection_data.ConnParamValue = 0;
							}
							//指定项必填
							$("#appoint").val(connection_data.ConnParamValue).trigger('change');
							$("#s_n").val(connection_data.ServiceName);
							if (connection_data.ConnType == null) {
								connection_data.ConnType = 0;
							}
							$("#conn").val(connection_data.ConnType).trigger('change');
							//
							$("#ORACLE").show();
							break;
						//RADMIN
						case 'RADMIN':
							//认证方式：
							if (connection_data.ConnType == null) {
								connection_data.ConnType = "0";
							}
							$("#authtype").val(connection_data.ConnType).trigger("change");
															$("#RADMIN").show();
							break;
						//MSSQL
						case 'MSSQL':
							//
							//实例名：
							$("#o_n").val(connection_data.ServiceName);
							//认证方式：
							if (connection_data.ConnType == null) {
								connection_data.ConnType = "0";
							}
							$("#R_authtype").val(connection_data.ConnType).trigger("change");
							//
							$("#MSSQL").show();
							break;
						//MYSQL 
						case 'MYSQL':
							//
							//数据库名：
							$('#sql_n').val(connection_data.ServiceName);
							//
							$("#MY_DB2").show();
							//$('#MY_ConnType').show();
							break;
						//DB2
						case 'DB2':
							//
							//数据库名：
							$('#dbsql_n').val(connection_data.ServiceName);
							//
							$("#DB2").show();
							break;
						//SYBASE
						case 'SYBASE':
							//
							//实例名：
							$('#sy_o_n').val(connection_data.ServiceName);
							//
							$("#SYBASE").show();
							break;
					}
				} else {
					_alert(1, '连接参数', connection_result.ErrMsg);
					return false;
				}
			}
		});
	}

	$("#Protocol_con").change(function () {
		var p_id = $(this).val();
		$("#HTTP").hide();
		$("#HTTPs").hide();
		$("#ORACLE").hide();
		$("#RADMIN").hide();
		$("#MSSQL").hide();
		$("#SYBASE").hide();
		$("#MY_DB2").hide();
		$('#RDP').hide();
		$("#SFTP").hide();
		$('#MY_ConnType').hide()
		$("#SSH").hide();
		//$('#MY_ConnType').hide();
		$("#DB2").hide();
		switch ($('#Protocol_con option[value='+p_id+']').text()) {
			case "RDP":
				$('#RDP').show();
				break;
			case "SSH":
				$('#SSH').show();
				break;
			case "SFTP":
				$('#SFTP').show();
				$("#ServiceName_sftp").val('1').trigger('change');
				break;
			//HTTP(S)
			case "HTTP(S)":
				$("#HTTP").show();
				break;
			//HTTP
			case "HTTPS":
				$("#HTTPs").show();
				break;
			//ORACLE
			case "ORACLE":
				$("#ORACLE").show();
				break;
			//RADMIN
			case "RADMIN":
				$("#RADMIN").show();
				break;
			//MSSQL
			case "MSSQL":
				$("#MSSQL").show();
				break;
			//MYSQL 
			case "MYSQL":
				$("#MY_DB2").show();
				//$('#MY_ConnType').show();
				break;
			//DB2
			case "DB2":
				$("#DB2").show();
				break;
			//SYBASE
			case "SYBASE":
				$("#SYBASE").show();
				break;
		}
	});
}
var server_set;
//设备类型选择
function change_device_type(obj) {
	$("#def_server").children('option').not('option:first').remove();
	$("#def_server").val('-1').trigger('change');
	//$("#ProtocolName").select2('destroy').select2();
	//$("#ProtocolName option:eq(0)").prop("selected", true);
	//$("#ProtocolName").change();
	sel_id = -1;
	bind_conn_select();
	server_set = [];
	if ($(obj).val() != '-1') {
		$.each(device_data.data, function (i, item) {
			if (item.DeviceTypeId == $(obj).val()) {
				server_set = item.ServiceSet;
				return false;
			}
		});
		$.each(server_set, function (i, item) {
			$("#def_server").append('<option value="' + item.DeviceServiceId + '">' + item.DeviceServiceName + '</option>');
		});
		$("#def_server").select2();
	}
}

//模板载入
function show_def_server(obj) {
	if ($(obj).val() != '-1') {
		$.each(server_set, function (i, item) {
			if ($(obj).val() == item.DeviceServiceId) {
				$("#Port").val(item.Port);
				$("#ProtocolName").data('value',item.ProtocolId);
				$("#ProtocolName").find('span').text(item.ProtocolName);
				sel_id = item.ProtocolId;
				bind_conn_select();
				if (item.ConnParamId != null){
					$("#ConnParamName").data('value',item.ConnParamId);
					$("#ConnParamName").find('span').text(item.ConnParamName);
				}
			}
		})
	} else {
		$("#Port").val('');
		$("#ProtocolName").data('value','-1');
		$("#ProtocolName").find('span').text('请选择');
		$("#ConnParamName").data('value','-1');
		$("#ConnParamName").find('span').text('请选择');
	}
}

var device_data;
//获取设备类型
function get_server() {
	$.ajax({
		url: '/bhost/get_server',
		type: 'post',
		async: false,
		data: { a0: se },
		success: function (result) {
			device_data = JSON.parse(result);
			$.each(device_data.data, function (i, item) {
				$("#device_type").append('<option value="' + item.DeviceTypeId + '">' + item.DeviceTypeName + '</option>');
			})
		}
	});
	$('#device_type').select2();
	$('#def_server').select2();
}
//获取连接参数
var connparm_list = null;
function get_ConnParam_list(id){
	$.ajax({
		url:'/bhost/get_ConnParam_list',
		type: "post",
		async:false,
		cache:false,
		data: {a0:se,a1:id},
		success: function(Result) {
			connparm_list = JSON.parse(Result);			
		}
	});
}

var sel_id = -1;
function bind_conn_select(){
	get_ConnParam_list(sel_id);
	var conn_array = [];
	if (connparm_list != null){
		$.each(connparm_list.data,function(i,item){
			if (manage_auth_array.indexOf(14) != -1){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':'check'
				};
			}else if (access_auth_array.indexOf(14) != -1){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':'check'
				};
			}else{
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':null
				};
			}
			select_data_json.value = item.ConnParamId;
			select_data_json.name = item.ConnParamName;
			conn_array.push(select_data_json);
		});
	}
	$('#ConnParamName').empty().data('xSelect',"");
	if (manage_auth_array.indexOf(14) != -1){
		$('#ConnParamName').xSelect({
			width: 140,
			defaultText: '请选择',
			items:conn_array,
			module_type:'conn',
			check: function(item,obj){
				$(obj).parents('.xSelect-view').hide();
				_editNode6(obj,1);
			},
			btn:[
			]
		});
	}else{
		$('#ConnParamName').xSelect({
			width: 140,
			defaultText: '请选择',
			items:conn_array,
			module_type:'conn',
			check: function(item,obj){
				$(obj).parents('.xSelect-view').hide();
				_editNode6(obj,1);
			}
		});
	}
}

//端口校正
function port_check(obj) {
	obj.value = obj.value.replace(/\D/g, "");
}

var ServerIndex = -1;
//添加服务
function _addServer(type,obj) {
	var ServiceSet = {
		"ProtocolId": 0,
		"ProtocolName":"",
		"Port": 0,
		"ConnParamId": 0,
		"ConnParamName":""
	}
	//ProtocolId = $("#ProtocolName").val();
	var ProtocolId = $("#ProtocolName").data('value');
	var pro_name = $("#ProtocolName").find('span').text();
	if (ProtocolId == undefined || ProtocolId == '-1') {
		_alert(2, '访问授权', "请选择协议");
		return false;
	}
	Port = $("#Port").val();
	if (Port == "") {
		_alert(2, '访问授权', "请输入端口", $("#Port"));
		return false;
	}

	if (parseInt(Port) <= 0 || parseInt(Port) >= 65535) {
		_alert(2, '访问授权', "协议端口在0~65535之间", $("#Port"));
		return false;
	}
	//ConnParamId = $("#ConnParamName").val();
	var ConnParamId = $("#ConnParamName").data('value');
	var conn_name = $("#ConnParamName").find('span').text();
	if (ConnParamId == undefined || ConnParamId == '-1') {
		ConnParamId = null;
	}
	var n = 0;
	if (type == 'edit'){
		var edit_index = $(obj).parents('tr:eq(0)').index();
	}
	$.each(DeviceType.ServiceSet, function (i, item) {
		if (item.ProtocolId == ProtocolId && item.Port == Port && item.ConnParamId == ConnParamId && edit_index != i) {
			n = 1;
			_alert(2, "访问授权", "已存在相同的服务");
			return false;
		}
	})
	if (n) return false;
	ServiceSet.ProtocolId = parseInt(ProtocolId);
	ServiceSet.ProtocolName = pro_name;
	ServiceSet.Port = parseInt($("#Port").val());
	ServiceSet.ConnParamId = ConnParamId;
	ServiceSet.ConnParamName = conn_name;
	
	if (type == "add") {
		DeviceType.ServiceSet.push(ServiceSet);
		ServerIndex = ServerIndex + 1;
		$("#service_list1").append("<tr id=\"ser_" + ServerIndex + "\"><td>" + pro_name + "</td><td>" + Port + "</td><td>" + conn_name.replace("请选择", "") + "</td><td><div class=\"tab-ctr\"><a style=\"width:8px;\" href=\"javascript:;\" class=\"edit\" onclick=\"_getDialog1('edit',this)\"></a><a style=\"width:8px;\" href=\"javascript:;\" class=\"del\" onclick=\"_delServer(this)\"></a></div></td></tr>");
	}
	else {
		DeviceType.ServiceSet[edit_index] = ServiceSet;
		$(obj).parents('tr:first').html("<td>" + pro_name + "</td><td>" + Port + "</td><td>" + conn_name.replace("请选择", "") + "</td><td><div class=\"tab-ctr\"><a style=\"width:8px;\" href=\"javascript:;\" class=\"edit\" onclick=\"_getDialog1('edit',this)\"></a><a style=\"width:8px;\" href=\"javascript:;\" class=\"del\" onclick=\"_delServer(this)\"></a></div></td></td>");

	}
	$("#service_list1 tr").bind("dblclick", function () {
		$(this).children('td:last').find('.edit').click();
	});
	clear_serverdata();
}
//删除服务
function _delServer(obj) {
	$('.btn').blur();
	parent.layer.open({
		type: 1,
		title: "访问授权",
		content: '<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
		btn: ['确&nbsp;&nbsp;定', '取&nbsp;&nbsp;消'],
		btnAlign: 'c',
		closeBtn: false,
		skin: 'layer-custom',
		area: ['380px', '310px'],
		move: false,
		resize: false,
		btn1: function (i) {
			parent.layer.close(i);
			//var index = parseInt(num) - 1;
			var index = $(obj).parents('tr:eq(0)').index();
			DeviceType.ServiceSet.splice(index, 1);
			$(obj).parent().parent().parent().remove();
			clear_serverdata();
		},
		btn2: function (i) {
			parent.layer.close(i);
		}
	});
}

//重置数据
function clear_serverdata() {
	$("#def_server").children('option').not('option:first').remove();
	$("#device_type").val('-1').trigger('change');
	$("#device_type").select2();
	$('#ConnParamName').parent('div.form-item').show();
	bind_protocol_select();
	sel_id = -1;
	bind_conn_select();
	//ServerIndex = -1;
}

//编辑 服务列表数据绑定
function _editServer(obj) {
	//var index = parseInt(num) - 1;
	//ServerIndex = index;
	var index = $(obj).parents('tr:eq(0)').index();
	$("#ProtocolName").data('value',DeviceType.ServiceSet[index].ProtocolId);
	$("#ProtocolName").find('span').text(DeviceType.ServiceSet[index].ProtocolName);
	sel_id = DeviceType.ServiceSet[index].ProtocolId;
	bind_conn_select();
	if (DeviceType.ServiceSet[index].ConnParamId != null){
		$("#ConnParamName").data('value',DeviceType.ServiceSet[index].ConnParamId);
		$("#ConnParamName").find('span').text(DeviceType.ServiceSet[index].ConnParamName);
	}
	//$("#ProtocolName").val(DeviceType.ServiceSet[index].ProtocolId).trigger("change");
	//$("#ConnParamName").val(DeviceType.ServiceSet[index].ConnParamId).trigger("change");
	$("#Port").val(DeviceType.ServiceSet[index].Port);
}

////服务 浮层
function _getDialog1(type, obj) {
	$('.btn-normal1').blur();
	clear_serverdata();
	var $dialogCont = $("#scDCTab1").show();
	if (type == 'edit') {
		title = '服务';
	} else {
		title = '服务';
	}
	var d = dialog({
		title: title,
		content: $dialogCont,
		id: "scDCTab1",
		width: "600px"
	});
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	if (type == 'edit') {
		$("#device_module").hide();
		$("#module_server").hide();
	}else{
		$("#device_module").show();
		//$("#module_server").show();
		$("#module_server").hide();
	}
	d.showModal();
	
	bind_protocol_select();
	bind_conn_select();
	if (type == 'edit') {
		_editServer(obj);
	}
	$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
		d.close().remove();
	});
	$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
		if (_addServer(type,obj) == false) return false;
		d.close().remove();
	})
}

var server = {
	"ServerScopeId": 0,
	"ServerScopeName": "",
	"IsApplyToClientScope": false,
	"HostList": [],
	"IPList": {
		"IPSetId": 0,
		"Set": []
	}
};
var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
var ipReg = /^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])(\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])){3}$/;
var server_edit = null;
var type = 1;
var serverId = 0;


function _authTypeTheme(obj) {
	$.each(obj, function (i, item) {
		var $_item = $(item);

		if ($_item.parent().children('span').length == 0) {
			$_item.after('<span class="checkbox"></span>');
		}

		var $s = $_item.next('span');
		var checked = $_item.prop('checked');
		var disabled = $_item.prop('disabled');

		if (checked) {
			$s.addClass('checked');
		} else {
			$s.removeClass('checked');
		}

		if (disabled) {
			$s.addClass('disabled');
		} else {
			$s.removeClass('disabled');
		}
	})
}

function _checkView_host(obj) {
	_authTypeTheme($('span.authtype input', obj));
	$('input.zcheck', obj).each(function () {
		//$(obj).find('input.zcheck').each(function(){
		var $s = $('<span class="checkbox"></span>');
		$(this).after($s);
		var v = $(this).prop('checked');
		if (v) {
			$s.addClass('checked');
		} else {
			var c = $(this).data('check');
			if (c && c == 2) {
				$s.addClass('half');
			}
		}

		var d = $(this).prop('disabled');
		if (d) {
			$s.addClass('disabled');
		}
	}).on('change', function () {
		var v = $(this).prop('checked');
		var $s = $(this).next('span.checkbox');
		var $u = $(this).parent().children('ul').find('li');
		var $authInput = $(this).siblings('span.authtype').find('input');
		if (v) {
			$s.attr('class', 'checkbox checked');
			$('input.zcheck', $u).prop('checked', true);
			$('span.checkbox:first', $u).attr('class', 'checkbox checked');
			//$u.find('span.authtype').show();
			$(this).attr("data-loadlast", 2);
			$('input.zcheck', $u).attr("data-loadlast", 2);
			$u.each(function () {
				if ($(this).children('span.authtype').find('input').prop('checked')) {
					var $u_li = $(this).children('ul').find('li');
					$('input.zcheck', $u_li).prop('disabled', true);
					$('span.checkbox:first', $u_li).addClass('disabled');
				};
			});

		} else {
			$s.attr('class', 'checkbox');
			//$('input.zcheck',$u).prop('checked',false).prop('disabled',false);
			//$('span.checkbox:first',$u).attr('class','checkbox');
			$('input', $u).prop('checked', false).prop('disabled', false);
			$('span.checkbox', $u).attr('class', 'checkbox');
			$(this).attr("data-loadlast", 0);
			$('input.zcheck', $u).attr("data-loadlast", 0);

			$authInput.prop('checked', false).trigger('change');
			$(this).siblings('span.authtype').find('span').attr('class', 'checkbox');
		}
		_checkEvent(this);
	});
}
function _checkEvent(obj) {
	var _run = function () {
		var $li = $(obj).parent().parent().parent();
		var tagname = $li[0].tagName.toLowerCase();
		var v = $(obj).prop('checked');

		if (tagname == 'li') {
			var c1 = 0, c2 = 0;
			var len = $(obj).parent().parent().children('li').length;

			$(obj).parent().parent().children('li').each(function () {
				var c = $(this).children('span.checkbox').attr('class');
				if (c.indexOf('checked') > 0) {
					c1++;
				} else if (c.indexOf('half') > 0) {
					c2++;
				}
				if (c1 == len) {
					var span_class = $li.children('input.zcheck').prop('checked', false).siblings('span.checkbox').attr('class');
					var d_class = "";
					if (span_class.indexOf('disabled') != -1) {
						d_class = 'disabled';
					}
					var attr_class = 'checkbox checked ' + d_class;
					$li.children('input.zcheck').prop('checked', true).siblings('span.checkbox').attr('class', attr_class);
					$li.children('input.zcheck').attr("data-loadlast", 2);
				} else if (c1 == 0 && c2 == 0) {
					$li.children('input.zcheck').prop('checked', false).prop('disabled', false).siblings('span.checkbox').attr('class', 'checkbox').removeClass('disabled');
					$li.children('input.zcheck').attr("data-loadlast", 0);
					$li.children('input.zcheck').siblings('span.authtype').children('input').prop('checked', false).siblings('span.checkbox').attr('class', 'checkbox');
				} else {
					var span_class = $li.children('input.zcheck').prop('checked', false).siblings('span.checkbox').attr('class');
					var d_class = "";
					if (span_class.indexOf('disabled') != -1) {
						d_class = 'disabled';
					}
					var attr_class = 'checkbox half ' + d_class;
					$li.children('input.zcheck').prop('checked', false).siblings('span.checkbox').attr('class', attr_class);
					$li.children('input.zcheck').attr("data-loadlast", 1);
				}
			});
			_checkEvent($li.children('input.zcheck'));
		} else {
			return;
		}
	}

	_run();
}
function _checkEvent1(obj) {
	if ($(obj).length == 0) return false;
	var _run1 = function () {
		_input = $(obj).parent().parent().siblings('input.zcheck');
		_ul = _input.siblings('ul');
		if (_input.length > 0 && (_ul.children('li').length > 0)) {
			$inp = _ul.children('li').children('input.zcheck');
			$($inp).each(function (i, item) {
				$parent = $(item).parent().parent().siblings('span.authtype').find('input');
				v = $($parent).prop("checked");
				$spanp = $(item).siblings('span.authtype');
				//如果发现父节点还是disabled
				if ($($parent).prop("disabled") == true) v = true;
				if (v == false) {
					$(item).prop("disabled", false);
					$(item).siblings('span.checkbox').removeClass("disabled");
					$spanp.find('input').prop("disabled", false);
					$spanp.find('span').removeClass("disabled");
					if ($spanp.length == 0) {
						_checkEvent2($(item).siblings('ul').children('li').children('input.zcheck'));
					}
					else {
						if ($(item).prop('checked') == false) $spanp.find('input').prop('checked', false).next('span').removeClass('checked');
						_checkEvent1($spanp.find('input'));
					}
				} else {
					$(item).prop("checked", true).prop("disabled", true);
					$(item).siblings('span.checkbox').addClass("disabled");
					$spanp.find('input').prop("disabled", true);
					$spanp.find('span').addClass("disabled");
					if ($spanp.length == 0) _checkEvent2($(item).siblings('ul').children('li').children('input.zcheck'));
					else _checkEvent1($spanp.find('input'));

				}
			})


		} else {

			return;
		}
	}

	_run1();
}
function _checkEvent2(obj) {
	if (obj.length == 0) return false;
	var _run2 = function () {
		_input = $(obj).parent().parent().siblings('input.zcheck');;
		if ($(_input).prop('disabled') == true) {
		$(obj).prop("checked",true).prop("disabled",true);
			$(obj).siblings('span.checkbox').addClass("disabled");
		} else {
			$(obj).prop("disabled", false);
			$(obj).siblings('span.checkbox').removeClass("disabled");
		}
		_checkEvent2($(obj).siblings('ul').children('li').children('input.zcheck'));
	}
	_run2();
}

function get_hostdirectory1(obj, id, v, d, t, pid, sername) {
	flag_loading = true;
	var loading_hgid;
	$.ajax({
		url: '/bhost/GetAuthObject_B',
		type: 'post',
		async: true,
		data: { a0: se, a1: id, a3:ajax_find_host_doing?'true':'false', a4: t,a6:JSON.stringify(type_json)},
		success: function (result) {
			var hdata = JSON.parse(result);
			if(hdata.Result == false){
				_alert(1,"批量启动",hdata.ErrMsg);
			}			
			loading_hgid = id;
			if (editid > 0 && ajax_find_host_doing == false)
				disabled_flag = "disabled";
			else
				disabled_flag = "";
			var loadfirst = 0;
			var loadlast = 0;
			var parent_id = $(obj).siblings('input').attr('id').split('-')[1];
			var _p_loadfirst = $(obj).siblings('input').attr('data-loadfirst');
			var _p_loadlast = $(obj).siblings('input').attr('data-loadlast');
			var auth_type_checked = false;
			if ($(obj).siblings('span.authtype').find('input').length != 0) {
				auth_type_checked = $(obj).siblings('span.authtype').find('input').prop('checked');
			}
			if ((_p_loadfirst == 0) && (_p_loadlast == 0)) {
			}
			if (auth_type_checked) {
				disabled_flag = "";
			}
			if (_p_loadfirst == _p_loadlast) {
				if (_p_loadlast == 2) {
					loadfirst = 2
					loadlast = 2;
				}
			} else {
				if (_p_loadlast == 2) {
					loadlast = 2;
				}
				if (_p_loadfirst == 2) {
					loadfirst = 2;
				}
			}

			if (hdata.data.HGroup == null) hdata.data.HGroup = new Array();
			var i_HG=0;
			var current_i_HG=0;
			var HG_d0_time;
			var HGlen=hdata.data.HGroup.length;
			function _initHTML_do(){
				clearTimeout(HG_d0_time);
				var s=0;
				var $H_all='';
				for(i_HG=current_i_HG;i_HG<current_i_HG+1000;i_HG++){
					if(i_HG>=HGlen){
						if($H_all!=''){
							$(obj).append($H_all);
						}
						_checkView_host(obj);
						if (ajax_find_host_doing == false) {
							select_checkbox("Host", parent_id);
						}
						if (hdata.data.Host == null) {
							hdata.data.Host = [];
							flag_loading = false;
							_closeLoading();
							return false;
						}
						_initHTML_do1();
						s=1;
						break;
					}
					var item=hdata.data.HGroup[i_HG];
					if (item.Mode == 2) var $auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + '" >组授权</label>';
					else var $auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + '" >组授权</label>';
					if ((ajax_find_host_doing == true && $(obj).siblings('span.h-name-red').length == 0)) {
						var $H = $('<li style="display: none;"></li>');
					} else {
						var $H = $('<li></li>');
					}
					//if ((item.MemberNum + item.HostNum) == 0) i_class = "h-blank";
					//else 
					i_class = "h-aicon";
					
					str_list =  item.HGName.split('');
					var stp = '';
					for(var i=0;i<str_list.length;i++){
						stp += '<font>'+str_list[i]+'</font>';
					}
					if (v == 1 && d == 0) {
						if (item.Mode == 2) $auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false disabled data-mode="' + item.Mode + '" >组授权</label>';
						else $auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + '" disabled>组授权</label>';
						$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" checked="checked" id="nodehg-' + item.HGId + '" data-check="1" class="zcheck zcheck-g" disabled data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-mode="' + item.Mode + '" data-name="' + item.HGName + '"><span class="checkbox"></span><i class="h-eicon h-eicon-g"></i><span class="h-name" id="spanHG-' + item.HGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
													stp + 
													'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
					} else if (v == 1) { //v == 1 d ==1
						$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" checked="checked" id="nodehg-' + item.HGId + '" data-check="1" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-mode="' + item.Mode + '" data-name="' + item.HGName + '"></i><span class="checkbox"></span><i class="h-eicon h-eicon-g"><span class="h-name" id="spanHG-' + item.HGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
												 stp + 
													'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
					} else if (v == 0) {
						$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" id="nodehg-' + item.HGId + '" data-check="0" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-mode="' + item.Mode + '" data-name="' + item.HGName + '"><i class="h-eicon h-eicon-g"></i><span class="h-name" id="spanHG-' + item.HGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
												 stp + 
													'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
					} else {
						$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" id="nodehg-' + item.HGId + '" data-check="0" class="zcheck zcheck-g" ' + disabled_flag + ' data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-ifselect=false data-mode="' + item.Mode + '" data-name="' + item.HGName + '"><span class="checkbox"></span><i class="h-eicon h-eicon-g"></i><span class="h-name" id="spanHG-' + item.HGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
												 stp + 
													'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
					}
					if (editid > 0) {
						if (auth_type_checked) {
						} else {
							if (push_hgid.indexOf(item.HGId + ":false") < 0) {
								push_hgid.push(item.HGId + ":false");
							}
						}
					}
					// $(obj).append($H);
					$H_all+=$H[0].outerHTML;
				}
				if(!s){
					$(obj).append($H_all);
					current_i_HG=i_HG;
					HG_d0_time=setTimeout(function(){_initHTML_do();},0);
				}
			}
			_initHTML_do();
			var i_H = 0;
			var current_i_H = 0;
			var H_do_time;
			var Hlen=hdata.data.Host.length;
			function _initHTML_do1() {
				clearTimeout(H_do_time);
				var $H_all='';
				for(i_H=current_i_H;i_H<current_i_H+1000;i_H++){
					if(i_H>=Hlen){
						if($H_all!=''){
							$(obj).append($H_all);
						//	_checkView1($('input.zcheck-host',$(obj)));
						}
						_checkView_host(obj);
						_closeLoading();
						if (ajax_find_host_doing == false) {
							select_checkbox("Host", parent_id);
						}
						flag_loading = false;
						return false;
					}
					var item=hdata.data.Host[i_H];
					if ((item.Selected == 0 && item.Mode == 0 && ajax_find_host_doing == true) || (editid <= 0 && item.Mode == 0 && item.Selected == 0)) {
						continue;
					}
					var $auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HostId + '"  ' + disabled_flag + ' data-ifselect=false data-mode="' + item.Mode + '" >主机授权</label>';
					if ((ajax_find_host_doing == true && $(obj).siblings('span.h-name-red').length == 0) || (item.Mode == 0 && item.Selected == 0)) {
						var $H = $('<li style="display: none;"></li>');
					} else {
						var $H = $('<li></li>');
					}
					//var HostName_h = autoAddEllipsis(item.HostName, '12');
					var HostName_h = item.HostName;
					if (item.AccountNum == 0) i_class = "h-blank";
					else i_class = "h-aicon";
					
					str_list =  (item.HostIP+'('+HostName_h+')').split('');
					var stp = '';
					for(var i=0;i<str_list.length;i++){
						stp += '<font>'+str_list[i]+'</font>';
					}
					
					if (v == 1 && d == 0) {
						$auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HostId + '" disabled data-ifselect=false data-mode="' + item.Mode + '" >主机授权</label>';
						$H.html('<i class="' + i_class + '" data-id="arrH-' + item.HostId + '" /><input type="checkbox" checked="checked" id="nodeh-' + parent_id + '-' + item.HostId + '" data-check="1" class="zcheck zcheck-g zcheck-host" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + '  disabled  data-ifselect=false data-mode="' + item.Mode + '" data-name="' + item.HostIP + '\t' + item.HostName + '"><i class="h-eicon h-eicon-u"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+item.HostId+'">' + '<span class="h-name-son" style="">' + 
													stp +
													'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');

					} else if (v == 1) {
						$H.html('<i class="' + i_class + '" data-id="arrH-' + item.HostId + '" /><input type="checkbox" checked="checked" id="nodeh-' + parent_id + '-' + item.HostId + '" data-check="1" class="zcheck zcheck-g zcheck-host" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-ifselect=false data-mode="' + item.Mode + '" data-name="' + item.HostIP + '\t' + item.HostName + '"><i class="h-eicon h-eicon-u"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+item.HostId+'">' + '<span class="h-name-son" style="">' + 
													stp +
													'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
					} else if (v == 0) {
						$H.html('<i class="' + i_class + '" data-id="arrH-' + item.HostId + '" /><input type="checkbox" id="nodeh-' + parent_id + '-' + item.HostId + '" data-check="0" class="zcheck zcheck-g zcheck-host" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-ifselect=false data-mode="' + item.Mode + '" data-name="' + item.HostIP + '\t' + item.HostName + '"><i class="h-eicon h-eicon-u"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+item.HostId+'">' + '<span class="h-name-son" style="">' + 
													stp +
													'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
					} else {
						$H.html('<i class="' + i_class + '" data-id="arrH-' + item.HostId + '" /><input type="checkbox" id="nodeh-' + parent_id + '-' + item.HostId + '" data-check="0" class="zcheck zcheck-g zcheck-host" data-ifselect=false data-loadfirst=0 data-loadlast=' + loadlast + ' ' + disabled_flag + ' data-mode="' + item.Mode + '" data-name="' + item.HostIP + '\t' + item.HostName + '"><i class="h-eicon h-eicon-u" class="zcheck"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+item.HostId+'">' + '<span class="h-name-son" style="">' + 
												 stp +
													'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
						if (ajax_find_host_doing == false) {
							$H.html('<i class="' + i_class + '" data-id="arrH-' + item.HostId + '" /><input type="checkbox" id="nodeh-' + parent_id + '-' + item.HostId + '" data-check="0" class="zcheck zcheck-g zcheck-host" data-ifselect=false data-loadfirst=0 data-loadlast=' + loadlast + ' ' + disabled_flag + ' data-mode="' + item.Mode + '" data-name="' + item.HostIP + '\t' + item.HostName + '"><i class="h-eicon h-eicon-u" class="zcheck"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+item.HostId+'">' + '<span class="h-name-son" style="">' + 
													stp +
													'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
						}
						else {
							switch (item.Selected) {
								case 0:
									$H.html('<i class="' + i_class + '" data-id="arrH-' + item.HostId + '" /><input type="checkbox" id="nodeh-' + parent_id + '-' + item.HostId + '" data-check="0" class="zcheck zcheck-g zcheck-host" data-ifselect=false data-loadfirst=0 data-loadlast=' + item.Selected + ' data-mode="' + item.Mode + '" data-name="' + item.HostIP + '\t' + item.HostName + '"><i class="h-eicon h-eicon-u" class="zcheck"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+item.HostId+'">' + '<span class="h-name-son" style="">' + 
												 stp +
													'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
									break;
								case 1:
									$H.html('<i class="' + i_class + '" data-id="arrH-' + item.HostId + '" /><input type="checkbox" id="nodeh-' + parent_id + '-' + item.HostId + '" data-check="2" class="zcheck zcheck-g zcheck-host" data-ifselect=false data-loadfirst=1 data-loadlast=' + item.Selected + ' data-mode="' + item.Mode + '" data-name="' + item.HostIP + '\t' + item.HostName + '"><i class="h-eicon h-eicon-u" class="zcheck"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+item.HostId+'">' + '<span class="h-name-son" style="">' + 
													stp +
													'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
									break;
								case 2:
									$.each(last_object, function (i1, item1) {
										if ((item1.HostId == item.HostId) && (item1.HGId == parseInt(parent_id)) && (item1.AccountId == null) && (item1.HostServiceId == null)) {
											$auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HostId + '" checked="checked" data-ifselect=true data-mode="' + item.Mode + '" >主机授权</label>';
											return false;
										}
									});
									$H.html('<i class="' + i_class + '" data-id="arrH-' + item.HostId + '" /><input type="checkbox" checked="checked" id="nodeh-' + parent_id + '-' + item.HostId + '" data-check="1" class="zcheck zcheck-g zcheck-host" data-ifselect=false data-loadfirst=2 data-loadlast=' + item.Selected + ' data-mode="' + item.Mode + '" data-name="' + item.HostIP + '\t' + item.HostName + '"><i class="h-eicon h-eicon-u" class="zcheck"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+item.HostId+'">' + '<span class="h-name-son" style="">' + 
													stp +
													'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
									break;
							}
						}
					}
					if (editid > 0) {
						if (auth_type_checked) {
						} else {
							if (push_hid.indexOf(parent_id + ':' + item.HostId + ":false") < 0) {
								if (ajax_find_host_doing == false) {
									push_hid.push(parent_id + ':' + item.HostId + ":false");
								}
							}
						}
					}
					
					$H_all+=$H[0].outerHTML;
				}
				$(obj).append($H_all);
				current_i_H=i_H;
				H_do_time=setTimeout(function(){_initHTML_do1();},1);
			}
		},
		error:function(){
			flag_loading = false;
		}
	});
}
var s_h_array = [];
var s_s_array = [];
function _checkView1(obj) {
	_authTypeTheme($(obj).parent().find('span.authtype input'));
	$(obj).each(function () {
		var $s = $('<span class="checkbox"></span>');
		$(this).after($s);
		var v = $(this).prop('checked');
		if (v) {
			$s.addClass('checked');
		} else {
			var c = $(this).data('check');
			if (c && c == 2) {
				$s.addClass('half');
			}
		}

		var d = $(this).prop('disabled');
		if (d) {
			$s.addClass('disabled');
		}
	}).on('change', function () {
		var v = $(this).prop('checked');
		var $s = $(this).next('span.checkbox');
		var $u = $(this).parent().children('ul');
		var d;
		if ($(this).siblings('span.authtype').find('input').is(':checked')) {
			d = 0;
		} else {
			d = 1;
		}

		if (v) {
			$s.attr('class', 'checkbox checked');
			$('input.zcheck', $u).prop('checked', true);
			$('span.checkbox', $u).attr('class', 'checkbox checked');
			$(this).attr("data-loadlast", "2");
			$(this).find('input.zcheck').attr('data-loadlast', 2);

		} else {
			$s.attr('class', 'checkbox');
			$('input.zcheck', $u).prop('checked', false).prop('disabled', false);
			$('span.checkbox', $u).attr('class', 'checkbox');
			$(this).siblings('span.authtype').find('input').prop('checked', false);
			$(this).siblings('span.authtype').find('span').attr('class', 'checkbox');
			$(this).siblings('span.authtype').find('span').trigger('change');
			$(this).attr("data-loadlast", "0");
			$(this).siblings('ul').find('input.zcheck').attr('data-loadlast', 0);
		}

		_checkEvent(this);
	});
}

//所有共有
var all_flag = 1;
function mix_change(obj) {
	var v = $(obj).val();
	if (v == 1) {
		all_flag = 1;
		add_server();
	} else {
		all_flag = 0;
		add_server();
	}
}

function a_mix_change(obj){
	var v = $(obj).val();
	if (v == 2){
		//$("#service_list_a").empty();
		$("#account").hide();
	}else{
		$("#account").show();
		if ($("#mix_select").val() == 1){
			all_flag = 1;
			add_server();
		}else{
			all_flag = 0;
			add_server();
		}
	}
}

function s_mix_change(obj){
	var v = $(obj).val();
	if (v == 2){
		$("#service_module").hide();
	}else{
		$("#service_module").show();
		if ($("#mix_select").val() == 1){
			all_flag = 1;
			add_server();
		}else{
			all_flag = 0;
			add_server();
		}
	}
}

//根目录
function _viewHTML(data, obj, type) {
	$(obj).empty();
	if (type == 0) {
		disabled_flag = "";
		if (editid > 0) disabled_flag = "disabled";
		var $auth = '';
		$.each(data.data.HGroup, function (i, item) {

			if (item.HGId == 1) {
				$auth = '';
			} else if (item.Mode == 2) {
				$auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + ' " >组执行</label>';
			} else {
				$auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + '" >组执行</label>';
			}
			//$auth = '';
			var $H = $('<li></li>');
			//data-loadfirst(初始的状态) 0->未选中 1->部分选中 2->全选中 
			//data-loadlast(最后保存的状态) 
			//data-ifselect(组或者主机 是否是按组启动或者 按主机启动)
			//if ((item.HGroupNum + item.HostNum) == 0) i_class = "h-blank";
			//else 
			i_class = "h-aicon";
			
			str_list =  item.HGName.split('');
			var stp = '';
			for(var i=0;i<str_list.length;i++){
				stp += '<font>'+str_list[i]+'</font>';
			}
			
			$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" id="nodehg-' + item.HGId + '" data-check="0" class="zcheck zcheck-g" ' + disabled_flag + ' data-loadfirst=0 data-loadlast=0 data-ifselect=false data-mode="2" data-name="'+item.HGName+'"><i class="h-eicon h-eicon-g" ></i><span class="h-name" id="spanHG-' + item.HGId + '" style="width: 12em;"><span class="h-name-son" style="">' + stp + 
										'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
			$(obj).append($H);
		});
		_checkView_host(obj);
		if (editid > 0) {
			var _ajax_find_host_doing=ajax_find_host_doing;
			select_checkbox("HGroup", 0,_ajax_find_host_doing);	 //只有编辑情况下 才需要判断 select 
		}
	}
}

function _initList() {
	//获取user
	$('#hostTree').on('click','i.h-aicon',function(){
		var id = $(this).data('id').split('-')[1];
		var uorh = $(this).data('id').split('-')[0]; 
		var $u = $(this).parent().children('ul');
		if($u.is(':hidden')){
			$(this).addClass('h-aicon-d');
			$u.show();
			if($u.children('li').length == 0){
				var v = 2,d;
				var $input = $(this).siblings('span.checkbox');
				if($(this).siblings('span.authtype').find('input').is(':checked')){
					d = 0;
				}else{
					d = 1;
				}
				if ($input.attr('class').indexOf('disabled')>0){
					d = 0;
				}
				var c = $input.attr('class');
				if(c.indexOf('checked')>0){
					v=1;
				}else if(c == 'checkbox'){
					v=0;
				}
				var pid,sername;
				if(uorh == 'arrHG'){
					pid = null;
					sername = null;
				}else if(uorh == 'arrH'){
					pid = $(this).siblings('input').attr('id').split('-')[1];
					id = $(this).siblings('input').data('name').split('\t')[0];
					sername = null;
				}else if(uorh == 'arrS'){
					pid = $(this).siblings('input').attr('id').split('-')[1];
					id = $(this).siblings('input').data('name').split('\t')[1];
					sername = $(this).siblings('input').data('name');
				}
				_initHTML($u,id,v,d,uorh,pid,sername);
			}
		}else{
			$(this).removeClass('h-aicon-d');
			$u.hide();
		}
	}).on('dblclick', 'i.h-eicon,span.h-name', function () {
		var i_class_arr = $(this).siblings('i.h-aicon');
		if (i_class_arr.length == 0) {
			return false;
		}
		var $item = i_class_arr;
		var id = $item.data('id').split('-')[1];
		var t = $item.data('id').split('-')[0];
		var uorh = $item.data('id').split('-')[0];
		var $u = $item.parent().children('ul');
		if ($u.is(':hidden')) {
			$item.addClass('h-aicon-d');
			$u.show();
			if($u.children('li').length == 0){
				var v = 2,d = 1;
				var $input = $(this).siblings('span.checkbox');
				if($(this).siblings('span.authtype').find('input').is(':checked')){
					d = 0;
				}else{
					d = 1;
				}
				if ($input.attr('class').indexOf('disabled')>0){
					d = 0;
				}
				var c = $input.attr('class');
				if(c.indexOf('checked')>0){
					v=1;
				}else if(c == 'checkbox'){
					v=0;
				}
				var pid,sername;
				if(uorh == 'arrHG'){
					pid = null;
					sername = null;
				}else if(uorh == 'arrH'){
					pid = $(this).siblings('input').attr('id').split('-')[1];
					id = $(this).siblings('input').data('name').split('\t')[0];
					sername = null;
				}else if(uorh == 'arrS'){
					pid = $(this).siblings('input').attr('id').split('-')[1];
					id = $(this).siblings('input').data('name').split('\t')[1];
					sername = $(this).siblings('input').data('name');
				}				
				_initHTML($u,id,v,d,t,pid,sername);
			}
		} else {
			$item.removeClass('h-aicon-d');
			$u.hide();
		}
	});
}

var ajax_data = [];
var MAX_AJAX = 50;
//子节点
function _initHTML(obj, id, v, d, uorh, pid, sername) {
	$(obj).empty();
	if (uorh == "arrHG" || uorh == "arrH") {
		if (uorh == "arrHG") {
			//过滤中 不需要 showloading
			if (filter_flag_append == true) filter_flag_append = false;
			else _showLoading();
			get_hostdirectory1(obj, id, v, d, TYPE, pid, sername);
			return true;
		} else if(uorh == "arrH") {
			if (filter_flag_append == true) filter_flag_append = false;
			else _showLoading();
			_showLoading();
			$.ajax({
				url: '/bhost/GetAuthObject_B',
				type: 'post',
				cache:false,
				async: true,
				data: {a0:se,a1:pid,a2:id,a3:false,a4:TYPE,a6:JSON.stringify(type_json)},
				beforeSend :function(xmlHttp){
					xmlHttp.setRequestHeader("If-Modified-Since","0"); 
					xmlHttp.setRequestHeader("Cache-Control","no-cache");
				},
				success: function (result) {
					var adata = JSON.parse(result);
					if(adata.Result == false){
						_alert(1,"批量启动",adata.ErrMsg);
					}
					adata = adata.data;
					////data-loadfirst(初始的状态) 0->未选中 1->部分选中 2->全选中 
					//data-loadlast(最后保存的状态) 
					//data-ifselect(组或者主机 是否是按组执行或者 按主机执行
					var flag_change = false;
					var _loadfirst = $(obj).siblings('input.zcheck').attr("data-loadfirst");
					var _loadlast = $(obj).siblings('input.zcheck').attr("data-loadlast");
					var parents_aid = $(obj).siblings('input.zcheck').attr('id').split('-');
					var parents_id = parents_aid[2];
					var parentss_id = parents_aid[1];
					//判断 父节点是否状态改变

					var loadfirst = 0;
					var loadlast = 0;

					if (_loadfirst == _loadlast) {
						if (_loadlast == 2) {
							loadfirst = 2;
							loadlast = 2;
						} else if (_loadlast == 1) {
							flag_change = true;
						}
					} else {
						if (_loadlast == 2) {
							loadlast = 2;
						}
					if (_loadfirst == 2){
						loadfirst = 2;
					}
				}
				$.each(adata, function (i, item) {
					$.each(SUP_PROTOCOL,function(i_p,item_p){
						if(item.ProtocolName == item_p){
								var $a = '';
								var class_flag = 0;
								$.ajax({
									url: '/bhost/GetAuthObject_B',
									type: 'post',
									cache:false,
									async: false,
									data: {a0:se,a1:pid,a2:id,a3:false,a4:TYPE,a5:item.HostServiceName,a6:JSON.stringify(type_json)},
									success: function (result) {
										var accdata = JSON.parse(result);											
										if(accdata.Result == false){
											_alert(1,"批量启动",accdata.ErrMsg);
										}

										adata.AccountSet = accdata.data;
									}
								})
								$.each(adata.AccountSet, function (i2, item2) {
									// $.each(item2.HostServiceSet, function (i1, item1) {
									// 	if (item.HostServiceId == item1.HostServiceId) {
											class_flag = 1;
											if (loadlast == 2) {
												$a = $a + '<li><i class="h-blank" /><input type="checkbox" id="nodea-' + parentss_id + '-' + parents_id + '-' + item2.AccountId + '-' + item.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' checked="checked" data-name="'+item2.AccountName+'"><i class="h-eicon h-eicon-a2"></i><span class="h-name h-name2" style="margin-top:-6px;">' + item2.AccountName + '</span></li>'
											} else {
												$a = $a + '<li><i class="h-blank" /><input type="checkbox" id="nodea-' + parentss_id + '-' + parents_id + '-' + item2.AccountId + '-' + item.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-name="'+item2.AccountName+'"><i class="h-eicon h-eicon-a2"></i><span class="h-name h-name2" style="margin-top:-6px;">' + item2.AccountName + '</span></li>'
											}

											//return false;
									// 	}
									// })
								});
								if (class_flag == 0) {
									A_class = "h-blank";
								} else {
									A_class = "h-aicon";
								}
								if (loadlast == 2) {
									$(obj).append('<li><i class="' + A_class + '" data-id="arrS-' + item.HostServiceId + '"/><input type="checkbox" id="nodes-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' checked="checked" data-name="'+item.HostServiceName+'\t'+item.ProtocolName+'"><i class="h-eicon h-eicon-s2"></i><span class="h-name h-name2">' + item.HostServiceName + '</span><ul style="display:none">' + $a + '</ul></li>');
								} else {
									$(obj).append('<li><i class="' + A_class + '" data-id="arrS-' + item.HostServiceId + '"/><input type="checkbox" id="nodes-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-name="'+item.HostServiceName+'\t'+item.ProtocolName+'"><i class="h-eicon h-eicon-s2"></i><span class="h-name h-name2">' + item.HostServiceName + '</span><ul style="display:none">' + $a + '</ul></li>');
								}
						}
					})
				});

				if (flag_change) {
					if (jsondata.HostSet != null && edit != "None") {
						var ser_flag = 0;
						var serid_flag = 0;
						var first_serid = 1;
						if (v != 0) {
							$.each(jsondata.HostSet, function (i1, item1) {
								if (item1.HGId == parentss_id && item1.HostId == parents_id) {
									$("#nodea-" + parentss_id + '-' + parents_id + '-' + item1.AccountId + '-' + item1.HostServiceId).attr('checked', true);
									$("#nodea-" + parentss_id + '-' + parents_id + '-' + item1.AccountId + '-' + item1.HostServiceId).next('span').attr("class", "checkbox checked");
									$("#nodea-" + parentss_id + '-' + parents_id + '-' + item1.AccountId + '-' + item1.HostServiceId).attr('data-loadfirst', 2);
									$("#nodea-" + parentss_id + '-' + parents_id + '-' + item1.AccountId + '-' + item1.HostServiceId).attr('data-loadlast', 2);

								
									if ($("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).siblings('ul').find('input:checked').length == $("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).siblings('ul').find('input').length) {
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('checked', true);
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).next('span').attr("class", "checkbox checked");
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('data-loadfirst', 2);
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('data-loadlast', 2);
									} else {
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr("data-check", "2");
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('data-loadfirst', 1);
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('data-loadlast', 1);
									}
								}
							})
						}
					}
				}


				if (d == 0) {
					$(obj).find('input').prop('disabled', true);
					if ($(obj).siblings('span.authtype').find('input').length > 0) {
						if ($(obj).siblings('span.authtype').find('input').next('span').attr('class').indexOf('checked') != -1 || $(obj).siblings('input').prop('disabled')) {

						} else {
							$(obj).find('input').each(function () {
								$(this).attr('disabled', false);
								$(this).next('span.checkbox').removeClass('disabled');
							});
						}
					}
				}

				_checkView_host(obj);
				_closeLoading();
			},
			error:function(XmlHttpRequest,textStatus, errorThrown){
				}
			});
		} else if(uorh == "arrS") {
			if (filter_flag_append == true) filter_flag_append = false;
			else _showLoading();
				
			$.ajax({
				url: '/bhost/GetAuthObject_B',
				type: 'post',
				cache:false,
				async: false,
				data: {a0:se,a1:pid,a2:id,a3:false,a4:TYPE,a5:sername,a6:JSON.stringify(type_json)},
				beforeSend :function(xmlHttp){
					xmlHttp.setRequestHeader("If-Modified-Since","0"); 
					xmlHttp.setRequestHeader("Cache-Control","no-cache");
				},
				success: function (result) {
					var adata = JSON.parse(result);
					if(adata.Result == false){
						_alert(1,"批量启动",adata.ErrMsg);
					}
					////data-loadfirst(初始的状态) 0->未选中 1->部分选中 2->全选中 
					//data-loadlast(最后保存的状态) 
					//data-ifselect(组或者主机 是否是按组执行或者 按主机执行
					var flag_change = false;
					var _loadfirst = $(obj).siblings('input.zcheck').attr("data-loadfirst");
					var _loadlast = $(obj).siblings('input.zcheck').attr("data-loadlast");
					var parents_aid = $(obj).siblings('input.zcheck').attr('id').split('-');
					var parents_id = parents_aid[2];
					var parentss_id = parents_aid[1];
					//判断 父节点是否状态改变

					var loadfirst = 0;
					var loadlast = 0;

					if (_loadfirst == _loadlast) {
						if (_loadlast == 2) {
							loadfirst = 2;
							loadlast = 2;
						} else if (_loadlast == 1) {
							flag_change = true;
						}
					} else {
						if (_loadlast == 2) {
							loadlast = 2;
						}
					if (_loadfirst == 2){
						loadfirst = 2;
					}
				}
				$.each(adata.ServiceSet, function (i, item) {
					$.each(SUP_PROTOCOL,function(i_p,item_p){
						if(item.ProtocolName == item_p){
							var $a = '';
							var class_flag = 0;

							$.each(adata.AccountSet, function (i2, item2) {
								if(item2.HostAccount == null){
									return true;
								}
								$.each(item2.HostServiceSet, function (i1, item1) {
									if (item.HostServiceId == item1.HostServiceId) {
										class_flag = 1;
										if (loadlast == 2) {
											$a = $a + '<li><i class="h-blank" /><input type="checkbox" id="nodea-' + parentss_id + '-' + parents_id + '-' + item2.HostAccount.AccountId + '-' + item1.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' checked="checked" data-name="'+item2.HostAccount.AccountName+'"><i class="h-eicon h-eicon-a2"></i><span class="h-name h-name2" style="margin-top:-6px;">' + item2.HostAccount.AccountName + '</span></li>'
										} else {
											$a = $a + '<li><i class="h-blank" /><input type="checkbox" id="nodea-' + parentss_id + '-' + parents_id + '-' + item2.HostAccount.AccountId + '-' + item1.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-name="'+item2.HostAccount.AccountName+'"><i class="h-eicon h-eicon-a2"></i><span class="h-name h-name2" style="margin-top:-6px;">' + item2.HostAccount.AccountName + '</span></li>'
										}

										return false;
									}
								})
							});
							if (class_flag == 0) {
								A_class = "h-blank";
							} else {
								A_class = "h-aicon";
							}
							if (loadlast == 2) {
								$(obj).append('<li><i class="' + A_class + '" data-id="arrS-' + item.HostServiceId + '"/><input type="checkbox" id="nodes-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' checked="checked" data-name="'+item.HostServiceName+'\t'+item.ProtocolName+'"><i class="h-eicon h-eicon-s2"></i><span class="h-name h-name2">' + item.HostServiceName + '</span><ul style="display:none">' + $a + '</ul></li>');
							} else {
								$(obj).append('<li><i class="' + A_class + '" data-id="arrS-' + item.HostServiceId + '"/><input type="checkbox" id="nodes-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-name="'+item.HostServiceName+'\t'+item.ProtocolName+'"><i class="h-eicon h-eicon-s2"></i><span class="h-name h-name2">' + item.HostServiceName + '</span><ul style="display:none">' + $a + '</ul></li>');
							}
						}
					})
				});

				if (flag_change) {
					if (jsondata.HostSet != null && edit != "None") {
						var ser_flag = 0;
						var serid_flag = 0;
						var first_serid = 1;
						if (v != 0) {
							$.each(jsondata.HostSet, function (i1, item1) {
								if (item1.HGId == parentss_id && item1.HostId == parents_id) {
									$("#nodea-" + parentss_id + '-' + parents_id + '-' + item1.AccountId + '-' + item1.HostServiceId).attr('checked', true);
									$("#nodea-" + parentss_id + '-' + parents_id + '-' + item1.AccountId + '-' + item1.HostServiceId).next('span').attr("class", "checkbox checked");
									$("#nodea-" + parentss_id + '-' + parents_id + '-' + item1.AccountId + '-' + item1.HostServiceId).attr('data-loadfirst', 2);
									$("#nodea-" + parentss_id + '-' + parents_id + '-' + item1.AccountId + '-' + item1.HostServiceId).attr('data-loadlast', 2);

								
									if ($("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).siblings('ul').find('input:checked').length == $("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).siblings('ul').find('input').length) {
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('checked', true);
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).next('span').attr("class", "checkbox checked");
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('data-loadfirst', 2);
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('data-loadlast', 2);
									} else {
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr("data-check", "2");
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('data-loadfirst', 1);
										$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('data-loadlast', 1);
									}
								}
							})
						}
					}
				}


				if (d == 0) {
					$(obj).find('input').prop('disabled', true);
					if ($(obj).siblings('span.authtype').find('input').length > 0) {
						if ($(obj).siblings('span.authtype').find('input').next('span').attr('class').indexOf('checked') != -1 || $(obj).siblings('input').prop('disabled')) {

						} else {
							$(obj).find('input').each(function () {
								$(this).attr('disabled', false);
								$(this).next('span.checkbox').removeClass('disabled');
							});
						}
					}
				}

				_checkView_host(obj);
				_closeLoading();
			},
			error:function(XmlHttpRequest,textStatus, errorThrown){
				}
			});
		}
	}
}
// 绑定 主机组状态
function select_checkbox(select_flag, pid) {
	if (select_flag == "HGroup") { //主机组 

		var i = 0;
		var index_w = 0;
		var indx = 0;
		var t_doselect;
		function _doselect() {
			clearTimeout(t_doselect);
			for (i = index_w; i < index_w + 5; i += 5) { //每次只加载一个 根据情况定
				if (i >= push_hgid.length) {
					if (push_hgid.length == 0) {
						return false;
					} else {
						index_w = 0;
						i = 0;
						t_doselect = setTimeout(function () { _doselect(); }, 1);
						return false;
					}
				}
				var PGetHNodeSelected_json={
					"type":11,
					"id":editid,
					"ishost": false,
					"hnodeset": new Array()
				}
				for (var m = i; m < i + 5; m++) {
					if (m >= push_hgid.length) {
						break;
					}
					var hg_id = push_hgid[m].split(":")[0];
					var flag_sec = push_hgid[m].split(":")[1];
					var $hg_pinput = $("#nodehg-"+hg_id).parent().parent().siblings('input');
					var hg_pid = 0;
					if ($hg_pinput.length != 0){
						hg_pid = $hg_pinput.attr('id').split('-')[1];
						if(push_hgid.indexOf(hg_id + ':true')>=0){
							continue;
						}
						if(push_hgid.indexOf(hg_pid + ':false')>=0){
							continue;
						}
						if(push_hgid.indexOf(hg_pid + ':true')>=0){
							continue;
						}
					}
					if(flag_sec == 'false'){
						PGetHNodeSelected_json.hnodeset.push(JSON.parse('{"parentid": null,"hid": '+hg_id+'}'));
						push_hgid[m] = hg_id + ":" + "true";
					}
				}

				if(PGetHNodeSelected_json.hnodeset.length>0){
					//push_hgid[i] = hg_id + ":" + "true";
					$.ajax({
						url: '/bhost/PGetHNodeSelected',
						type: 'post',
						async: true,
						cache: false,
						data: { a0: se, z1: JSON.stringify(PGetHNodeSelected_json) },//hg_id
						success: function (result) {
							var result = JSON.parse(result);
							var data = result.info;
							$.each(data,function (i,item) {
								var _currentId = $("#nodehg-" + item.hid);
								var _span_authtype = _currentId.siblings('span.authtype');
								var mode = parseInt(_currentId.attr("data-mode"));
								var p_id;
								if (_currentId.parent().parent().siblings("input").length > 0)
									p_id = _currentId.parent().parent().siblings("input").attr('id').split('-')[1];
								else p_id = 0;
								var if_change_parent = false; //主机组是否改变
								var loadlast = 0;
								var _p_loadfirst = $('#nodehg-' + p_id).attr("data-loadfirst");
								var _p_loadlast = $('#nodehg-' + p_id).attr("data-loadlast");

								if (_p_loadfirst == _p_loadlast) { //没改变


								} else {
									if_change_parent = true;
									loadlast = _p_loadlast;
								}

								var gl_selected = false;
								if (item.selected == 0) {
									_currentId.next('span').attr("class", "checkbox");
									_currentId.prop('checked', false);
									_currentId.attr('data-loadfirst', item.selected);
									if (if_change_parent == false) { _currentId.attr('data-loadlast', item.selected); }
									else _currentId.attr('data-loadlast', loadlast);

								} else if (item.selected == 1) {
									_currentId.next('span').attr("class", "checkbox half");
									_currentId.prop('checked', false);
									_currentId.attr('data-loadfirst', item.selected);
									if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
									else _currentId.attr('data-loadlast', loadlast);
								} else {
									_currentId.next('span').attr("class", "checkbox checked");
									_currentId.prop('checked', true);
									_currentId.attr('data-loadfirst', item.selected);
									if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
									else _currentId.attr('data-loadlast', loadlast);
									//判断该主机组是否是 按组授权
									for(var i1=0;i1<last_object.length;i1++){
										var item1=last_object[i1];
										if (item1.HGId == item.hid) {
											if (item1.AccountId == null && item1.HostId == null && item1.HostServiceId == null) {
												gl_selected = true;
												break;
											}
										}
									}
								}

								if (gl_selected) {
									_span_authtype.find('input').attr('data-ifselect', true);
									_currentId.attr('data-ifselect', true);
								} else {
									_span_authtype.find('input').attr('data-ifselect', false);
									_currentId.attr('data-ifselect', false);
								}
								//判断是否隐藏按组授权
								if (mode == 0 && item.selected == 0) { //隐藏按组授权
									_span_authtype.children('label').remove();
								} else if (mode == 0 && item.selected == 1) { //隐藏按组授权
									_span_authtype.children('label').remove();
								} else if (mode == 0 && item.selected == 2) {
									if (gl_selected) _span_authtype.children('label').show();
									else _span_authtype.children('label').remove();
								} else if (mode == 2) {
									_span_authtype.children('label').show();
								}

								//如果父节点的状态改变了
								if (if_change_parent == true) {
									if (_p_loadlast == 0) { //1-0 2-0
										_currentId.next('span').attr("class", "checkbox");
										_currentId.prop('checked', false);

										_span_authtype.find('span').attr("class", "checkbox");
										_span_authtype.find('input').prop("checked", false);

										if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == false) {
											_span_authtype.find('input').prop("disabled", false);
											_currentId.prop('disabled', false);
										}
										_currentId.attr('data-loadfirst',item.selected);
										//
										if(_p_loadfirst == 2) _currentId.attr('data-loadfirst',2);
									} else if (_p_loadlast == 2) {	 // 0-2	 1-2							
										_currentId.prop('checked', true);
										//父节点 按组授权
										if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
											_currentId.prop('disabled', true);//input
											_currentId.next('span').attr("class", "checkbox checked disabled");
											//<<<< 
											_currentId.attr("data-loadlast", "2");
											_span_authtype.find('span').attr('class', "checkbox disabled");
											_span_authtype.find('input').prop('disabled', true);

										} else { // 1-0 1-2
											//alert(111);
											_currentId.prop('disabled', false);//input
											_currentId.next('span').attr("class", "checkbox checked");
											_currentId.attr("data-loadlast", "2");
											//_span_authtype.find('input').prop('disabled',false);
											//_span_authtype.find('span').attr('class','checkbox');
											if (gl_selected) {
												_span_authtype.find('span').attr('class', "checkbox checked");
												_span_authtype.find('input').prop('checked', true).prop('disabled', false);
											} else {
												_span_authtype.find('input').prop('disabled', false);
												_span_authtype.find('span').attr('class', 'checkbox');
											}
										}
									}
								} else {
									//父节点 按组启动
									if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
										_currentId.prop('disabled', true);//input
										_currentId.prop('checked', true);
										_currentId.next('span').attr("class", "checkbox checked disabled");

										if (_p_loadlast == 2) {
											_currentId.attr("data-loadlast", "2");
										}

										if (gl_selected) {
											_span_authtype.find('span').attr('class', "checkbox checked disabled");
											_currentId.siblings('span.authtype').find('input').prop('checked', true).prop('disabled', true);
										} else {
											_span_authtype.find('input').prop('disabled', true);
											_span_authtype.find('span').attr('class', 'checkbox disabled');
										}
									} else {
										_currentId.attr('disabled', false);//input
										_currentId.next('span').removeClass("disabled");

										if (_p_loadlast == 2) {
											_currentId.prop('checked', true);
											_currentId.attr("data-loadlast", "2");
											_currentId.next('span').attr("class", "checkbox checked");
										}
										if (gl_selected) {
											_span_authtype.find('span').attr('class', "checkbox checked");
											_span_authtype.find('input').prop('checked', true).prop('disabled', false);
										} else {
											_span_authtype.find('input').prop('disabled', false);
											_span_authtype.find('span').attr('class', 'checkbox');
										}
									}
								}
								if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('disabled')) {
									_currentId.prop('checked', true);
									_currentId.prop('disabled', true);//input
									_currentId.next('span').attr("class", "checkbox checked disabled");
									//<<<< 
									_span_authtype.find('span').addClass("disabled");
									_span_authtype.find('input').prop('disabled', true);
								}
								//触发change
								var ind = push_hgid.indexOf(item.hid + ":" + "true");
								if (ind != -1) {
									push_hgid.splice(ind, 1);
									i = 0;
								}
							});
							index_w = i;
							t_doselect = setTimeout(function () { _doselect(); }, 1);
						},
						error: function (XmlHttpRequest, textStatus, errorThrown) {
							var ind = push_hgid.indexOf(hg_id + ":" + "true");
							if (ind >= 0) {
								push_hgid.splice(ind, 1);
								push_hgid.push(hg_id + ":" + "false");
							}
							index_w = i;
							t_doselect = setTimeout(function () { _doselect(); }, 1);
							return false;
						}
					})
				}else{
					index_w = i;
					t_doselect = setTimeout(function () { _doselect(); }, 1);
				}
			}
		}
		_doselect();
	}
	else if (select_flag == "Host") { //主机
		var i = 0;
		var index_w = 0;
		var indx = 0;
		var t_doselect1;
		function _doselect1() {
			clearTimeout(t_doselect1);
			for (i = index_w; i < index_w + 5; i += 5) { //每次只加载一个 根据情况定
				if (i >= push_hid.length) {
					if (push_hid.length == 0) {
						//clearInterval(if_select1);
						return false;
					} else {
						index_w = 0;
						i = 0;
						t_doselect1 = setTimeout(function () { _doselect1(); }, 1);
						return false;
					}
				}
				var PGetHNodeSelected_json={
					"type":11,
					"id":editid,
					"ishost": true,
					"hnodeset": new Array()
				}
				for (var m = i; m < i + 5; m++) {
					if (m >= push_hid.length) {
						break;
					}
					var pid_h = push_hid[m].split(":")[0];
					var h_id = push_hid[m].split(":")[1];
					var flag_sec = push_hid[m].split(":")[2];
					if(push_hid.indexOf(pid_h + ':' + h_id + ":" + "true")>=0){
						continue;
					}
					if(push_hgid.indexOf(pid_h + ':false')>=0){
						continue;
					}
					if(push_hgid.indexOf(pid_h + ':true')>=0){
						continue;
					}
					if(flag_sec == 'false'){
						PGetHNodeSelected_json.hnodeset.push(JSON.parse('{"parentid": '+pid_h+',"hid": '+h_id+'}'));
						push_hid[m] = pid_h + ':' + h_id + ":" + "true";
					}
				}
				if(PGetHNodeSelected_json.hnodeset.length>0){

					atr = $.ajax({
						url: '/bhost/PGetHNodeSelected',
						type: 'post',
						async: true,
						cache: false,
						data: { a0: se, z1: JSON.stringify(PGetHNodeSelected_json) },//hg_id
						success: function (result) {
							var result = JSON.parse(result);
							data = result.info;
							$.each(data,function (i,item) {
								var p_id = item.parentid;//当前组所在的父组id
								_currentId = $("#nodeh-" + p_id + '-' + item.hid);//当前id
								atr_flag = 1;
								if (_currentId.length == 0) {
									return true;
								}
								var _span_authtype = _currentId.siblings('span.authtype');//当前按组授权
								var li_currentId = _currentId.parent();
								var mode = parseInt(_currentId.attr("data-mode"));
								var if_change_parent = false; //主机组是否改变
								var loadlast = 0;
								var _p_loadfirst = $('#nodehg-' + p_id).attr("data-loadfirst");
								var _p_loadlast = $('#nodehg-' + p_id).attr("data-loadlast");
								if (_p_loadfirst == _p_loadlast) { //没改变

								} else {
									if_change_parent = true;
									loadlast = _p_loadlast;
								}

								//绑定 data-loadfirst状态 和 data-loadlast
								var gl_selected = false;
								if (item.selected == 0) {
									_currentId.next('span').attr("class", "checkbox");
									_currentId.prop('checked', false);
									_currentId.attr('data-loadfirst', item.selected);

									if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
									else _currentId.attr('data-loadlast', loadlast);
								} else if (item.selected == 1) {
									_currentId.next('span').attr("class", "checkbox half");
									_currentId.prop('checked', false);
									_currentId.attr('data-loadfirst', item.selected);

									if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
									else _currentId.attr('data-loadlast', loadlast);

								} else {
									_currentId.next('span').attr("class", "checkbox checked");
									_currentId.prop('checked', true);
									_currentId.attr('data-loadfirst', item.selected);

									if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
									else _currentId.attr('data-loadlast', loadlast);
									//
									$.each(last_object, function (i1, item1) {
										if (item1.HostId == item.hid && item1.HGId == p_id && item1.AccountId == null && item1.HostServiceId == null) {
											gl_selected = true;
											return false;
										}
									})
								}
								//绑定是否按组启动状态
								if (gl_selected) {
									_span_authtype.find('input').attr('data-ifselect', true);
									_currentId.attr('data-ifselect', true);
								} else {
									_span_authtype.find('input').attr('data-ifselect', false);
									_currentId.attr('data-ifselect', false);
								}
								//判断是否隐藏主机 因为存在 当前用户的管理权限 加了这个
								if (tmp_list == null) {
									if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
										if (mode != 0 || item.selected != 0) {
											_currentId.attr('data-mode', '2');
											li_currentId.show();
										} else {
											li_currentId.remove();
										}
									} else {
										if (mode == 0 && item.selected == 0) { //隐藏主机
											li_currentId.remove();
										} else if (mode == 0 && item.selected == 1) { //隐藏主机
											_currentId.attr('data-mode', '2');
											li_currentId.show();
										} else if (mode == 0 && item.selected == 2) {
											_currentId.attr('data-mode', '2');
											li_currentId.show();
										} else if (mode == 2) {
											li_currentId.show();
										}
									}
								} else {
									li_currentId.hide();
									if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
										if (mode != 0 || item.selected != 0) {
											_currentId.attr('data-mode', '2');
											li_currentId.show();
										} else {
											li_currentId.remove();
										}
									} else {
										if (mode == 0 && item.selected == 0) { //隐藏主机
											li_currentId.remove();
										} else if (mode == 0 && item.selected == 1) { //隐藏主机
											_currentId.attr('data-mode', '2');
											li_currentId.show();
										} else if (mode == 0 && item.selected == 2) {
											_currentId.attr('data-mode', '2');
											li_currentId.show();
										} else if (mode == 2) {
											li_currentId.show();
										}
									}
								}
								
								//查看 父节点 是否是 1、全选还是空 2、是否按组启动 勾选 / disabled
								if (if_change_parent) {
									if (_p_loadlast == 0) {
										_currentId.next('span').attr("class", "checkbox");
										_currentId.prop('checked', false);
										_span_authtype.find('span').attr("class", "checkbox");
										_span_authtype.find('input').prop("checked", false);
										if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == false) {
											_span_authtype.find('input').prop("disabled", false);
											_currentId.prop('disabled', false);
										}
										if(_p_loadfirst == 2) _currentId.attr('data-loadfirst',2);
									} else if (_p_loadlast == 2) {
										_currentId.prop('checked', true);

										//父节点 按组启动
										if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
											_currentId.prop('disabled', true);//input
											_currentId.next('span').attr("class", "checkbox checked disabled");
											_currentId.attr("data-loadlast", "2");
											_span_authtype.find('input').prop('disabled', true);
											_span_authtype.find('span').attr('class', 'checkbox disabled');

										} else {
											_currentId.prop('disabled', false);//input
											_currentId.next('span').attr("class", "checkbox checked");
											_currentId.attr("data-loadlast", "2");
											//_span_authtype.find('input').prop('disabled',false);
											//_span_authtype.find('span').attr('class','checkbox');
											if (gl_selected) {
												_span_authtype.find('span').attr('class', "checkbox checked");
												_span_authtype.find('input').prop('checked', true).prop('disabled', false);
											} else {
												_span_authtype.find('input').prop('disabled', false);
												_span_authtype.find('span').attr('class', 'checkbox');
											}
										}
									}
								} else {
									//父节点 按组启动
									if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
										_currentId.prop('disabled', true);//input
										_currentId.next('span').attr("class", "checkbox checked disabled");
										if (_p_loadlast == 2) {
											_currentId.prop('checked', true);
											_currentId.attr("data-loadlast", "2");
										}
										if (gl_selected) {
											_span_authtype.find('span').attr('class', "checkbox checked disabled");
											_span_authtype.find('input').prop('checked', true).prop('disabled', true);
										} else {
											_span_authtype.find('input').prop('disabled', true);
											_span_authtype.find('span').attr('class', 'checkbox disabled');
										}

									} else {
										_currentId.prop('disabled', false);//input
										_currentId.next('span').removeClass("disabled");
										if (_p_loadlast == 2) {
											_currentId.prop('checked', true);
											_currentId.next('span').attr("class", "checkbox checked");
											_currentId.attr("data-loadlast", "2");
										}
										if (gl_selected) {
											_span_authtype.find('span').attr('class', "checkbox checked");
											_span_authtype.find('input').prop('checked', true).prop('disabled', false);
										} else {
											_span_authtype.find('input').prop('disabled', false);
											_span_authtype.find('span').attr('class', 'checkbox');
										}

									}
								}
								//发现父主机组是disabled
								if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('disabled')) {
									_currentId.prop('checked', true);
									_currentId.prop('disabled', true);//input
									_currentId.next('span').attr("class", "checkbox checked disabled");
									//<<<< 
									_span_authtype.find('span').addClass("disabled");
									_span_authtype.find('input').prop('disabled', true);
								}

								var ind = push_hid.indexOf(p_id + ':' + item.hid + ":" + "true");
								if (ind != -1) {
									push_hid.splice(ind, 1);
									i = 0;
								}
							});
							index_w = i;
							t_doselect1 = setTimeout(function () { _doselect1(); }, 1);
						},
						error: function (XmlHttpRequest, textStatus, errorThrown) {
							index_w = i;
							t_doselect1 = setTimeout(function () { _doselect1(); }, 1);
							return false;
						}
					});
				}else{
					index_w = i;
					t_doselect1 = setTimeout(function () { _doselect1(); }, 1);
				}
			}

		}
		_doselect1();
	}
}


var old_path_all = [];
var filter_flag_append = false;
var timeout = [];
var ajax_flag = false;
var host_path_all = [];
var flag_loading = false;
var index_f = 0;
var tmp_list=null;
var tmp_list_path_strarray=null;
var ajax_find_host_doing=false;
var first_find_index=null;
function find_append(){
	ajax_data = [];
	ajax_flag = false;
	var i = 0;
	var t_do1;
	index_f =0;
	function _do1(){
		clearTimeout(t_do1);
		for(i=index_f;i< index_f+1000;i++){
			if(ajax_flag == true) {
				t_do1=setTimeout(function () {_do1();},1);
				return false;
			}
			if (flag_loading == true) {
				t_do1 = setTimeout(function () { _do1(); }, 1);
				return false;
			}
			if(flag_ajax_true == true)  {
				return false;
			}
			if (i >= host_path_all.length){    //
				if (host_path_all.length == 0) {
					scrollTop_check_server1();
					return false;
				} else {
					if (ajax_data.length > 0) ajax_host(); //300个检索叫条件里面的主机 都没达到50 也去执行ajax——host
					index_f = 0;
					t_do1 = setTimeout(function () { _do1(); }, 1);
					return false;
				}
			}

			if (i %50==0 && i!=0){
				get_msg();
			}			
			var Path_array=host_path_all[i].Path.split('/');
			var len=Path_array.length;
			if (len == 2){//主机层
				if($('#nodehg-'+host_path_all[i].Id).length == 0) {
					continue;
				}//
				//show
				$('#nodehg-'+host_path_all[i].Id).parent('li').show();
				$('#nodehg-'+host_path_all[i].Id).siblings('span.h-name').addClass('h-name-red');
				//$('#nodehg-'+host_path_all[i].Id).siblings('ul').find('li').show();
			}
			else{
				if (host_path_all[i].Type == 3 || host_path_all[i].Type == 4){ //服务/账号
					for (var j = 1; j < len; j++){
						var id=Path_array[j].split(',')[1];
						s = 0;
						if (j == len-1){ //主机层
							//数据正在展开 留在 host_path_all，下次继续执行
							if (flag_loading == true) {
								s = 1;
								break;
							}
							//数据未完全展开 留在 host_path_all，下次继续执行
							if ($('#nodeh-' + Path_array[j - 1].split(',')[1] + '-' + id).length == 0) {
								continue;
							}
							//show
							$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+id).parent('li').show();
							//$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+id).addClass('show_input');
							$i_item=$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+id).prev('i');
							if($i_item.attr('class') == "h-blank"){ //
								host_path_all.splice(i,1);	
								//i--;
								s = 1;
								break;
							}
							if (push_hid.indexOf((Path_array[j-1].split(',')[1]+':'+id+':true')) != -1){
								s = 1;
								break;
							}
							if (push_hid.indexOf((Path_array[j-1].split(',')[1]+':'+id+':false')) != -1){
								s = 1;
								break;
							}
							if($('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+id).siblings('ul').children('li').length == 0){
								filter_flag_append = true;
								if(ajax_data.length >= MAX_AJAX){
									ajax_host();
									t_do1=setTimeout(function () {_do1();},1);
									return false;
								}else{
									hg_id = Path_array[j-1].split(',')[1];
									inv = ajax_data.indexOf(hg_id + ":" + id);
									if(inv < 0 ) ajax_data.push(hg_id + ":" + id); //没展开的主机 放入ajax_data	
								}
							}else{
								if(($i_item.attr('class').indexOf('h-aicon-d')) === -1){
									$i_item.trigger('click');
								}
							}	
						}

						else{ //主机组层	
							if($('#nodehg-'+id).length == 0) {
								s = 1
								break;//
							}
							if(flag_loading == true){
								s =1;
								break;
							}
							//show
							$('#nodehg-'+id).parent('li').show();
							$i_item=$('#nodehg-'+id).prev('i');
							//发现主机或者组 其实下面没数据，跳过该条数据
							if($i_item.attr('class') == "h-blank"){ //
								host_path_all.splice(i,1);	
								s = 1;
								break;
							}
							if(($i_item.attr('class').indexOf('h-aicon-d')) === -1){
								filter_flag_append = true;
								$i_item.trigger('click');
							}
						}
					}
					if(s) continue;
					var s = 0;
					if (host_path_all[i].Type == 4){
						if(flag_loading == true) {continue;}
						var hg_id=Path_array[j-2].split(',')[1];
						var h_id=Path_array[j-1].split(',')[1];
						if ($("#nodes-"+hg_id+'-'+h_id+'-'+host_path_all[i].Parent).length == 0){
							continue;
						}
						//show
						$("#nodes-"+hg_id+'-'+h_id+'-'+host_path_all[i].Parent).parent('li').show();
						var $i_item = $("#nodes-"+hg_id+'-'+h_id+'-'+host_path_all[i].Parent).prev('i');
						
						if(($i_item.attr('class').indexOf('h-aicon-d')) === -1){
							filter_flag_append = true;
							$i_item.trigger('click');
						}
						//show
						$("#nodea-"+hg_id+'-'+h_id+'-'+host_path_all[i].Id+'-'+host_path_all[i].Parent).parent('li').show();
						$("#nodea-"+hg_id+'-'+h_id+'-'+host_path_all[i].Id+'-'+host_path_all[i].Parent).siblings('span.h-name').addClass('h-name-red');
						//$("#nodea-"+hg_id+'-'+h_id+'-'+host_path_all[i].Id+'-'+host_path_all[i].Parent).siblings('ul').find('li').show();
					}else{
						var all_id = $i_item.siblings('input').attr('id').split('-');
						if ($("#nodes-"+all_id[1]+'-'+all_id[2]+'-'+host_path_all[i].Id).length == 0){
							continue;
						}
						//show
						$("#nodes-"+all_id[1]+'-'+all_id[2]+'-'+host_path_all[i].Id).parent('li').show();
						$("#nodes-"+all_id[1]+'-'+all_id[2]+'-'+host_path_all[i].Id).siblings('span.h-name').addClass('h-name-red');
						//$("#nodes-"+all_id[1]+'-'+all_id[2]+'-'+host_path_all[i].Id).siblings('ul').find('li').show();
					}
				}else{
					s = 0;
					for(var j=1;j<len-1;j++){
						var id=Path_array[j].split(',')[1];
						if($('#nodehg-'+id).length == 0) {
							s = 1;
							break;//
						}
						if(flag_loading == true) {
							s = 1;
							break;
						}
						//show
						$('#nodehg-'+id).parent('li').show();
						$i_item=$('#nodehg-'+id).prev('i');
						
						if($i_item.attr('class') == "h-blank"){ //
							host_path_all.splice(i,1);	
							//i--;
							s = 1;
							break;//
						}
						if (push_hgid.indexOf(Path_array[j-1].split(',')[1]+':true') != -1){
							continue;
						}
						if (push_hgid.indexOf(Path_array[j-1].split(',')[1]+':false') != -1){
							continue;
						}
						if($('#nodehg-'+id).length >0){
							if(($i_item.attr('class').indexOf('h-aicon-d')) == -1){
								filter_flag_append = true;
								$i_item.trigger('click');
							}		
						}
					}
					if(s) continue;
					if(host_path_all[i].Type==1){
						if($('#nodehg-'+host_path_all[i].Id).length == 0) continue;//
						//show
						$('#nodehg-'+host_path_all[i].Id).parent('li').show();
						$('#nodehg-'+host_path_all[i].Id).siblings('span.h-name').addClass('h-name-red');
						//$('#nodehg-'+host_path_all[i].Id).siblings('ul').find('li').show();
					}else{
						if($('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+host_path_all[i].Id).length == 0){
							continue;
						}//
						//show
						$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+host_path_all[i].Id).parent('li').show();
						//$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+host_path_all[i].Id).addClass('show_input');
						$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+host_path_all[i].Id).siblings('span.h-name').addClass('h-name-red');
						//$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+host_path_all[i].Id).siblings('ul').find('li').show();
					}
				}
			}
			//数据展开后 从host_path_all删除掉，并且放在old_path_all，为标红和定位准备
			push_filter_wait.push(host_path_all[i]);
			old_path_all.push(host_path_all[i]);
			host_path_all.splice(i,1);
		}
		index_f = i;
		get_msg();	
		t_do1=setTimeout(function () {_do1();},1);
	}
	_do1();
}
function get_msg(){
	var n=0;
	$.ajax({
		url: '/bhost/get_msg',
		type: "post",
		async:false,
		data: {a0:se},
		success: function(result) {
			var result=JSON.parse(result);
			if(result.Result == false){
				if(result.info.indexOf('系统异常')>=0 || result.info.indexOf('非法访问')>=0 || result.info.indexOf('系统超时') >=0 ){
					_alert(2,'系统',result.info);
				}else{
					_alert(2,'系统',result.info);
				}
			}
			else{
			}
		}
	})
	if(n) return false;	
}
var find_host_arry = [];
var find_host_flag = 0;
var search_typeall_host_r=[];
var search_typeall_host_new='';
function _addFilter2(obj, type) {
	top1 = 9007199254740992;
	var id = $(obj).parent().children('select').children('option:selected').val();
	var v1 = $(obj).parent().children('select').children('option:selected').text();
	var v3 = v1;
	var v2 = $.trim( $(obj).parent().children('input[type=text]').val());
	var filter_flag = 0;
	if(id=='0'){
		v1='';
	}else{
		v1=v1+'-';
	}
	if (v2 == '') {
		// if (find_host_arry.length > 0) {
			$("#server_text1").blur();
			_alert(2, "搜索", "请输入关键字", $("#server_text1"));
			return false;
		// }
		// click_h1();
		// find_host_arry = [];
		return false;
	}else{
		if ($.inArray(id+'-'+v2,search_typeall_host_r)>=0){
			_alert(1, "批量启动", "相同的关键字已存在", $("#server_text1"));
			return false;
		}
		if (type) {
			// $("#filterWW2").children('ul').children('li').each(function (i, item) {
			// 	if ($(this).children('span').eq(0).text() == id+'-'+v2) {
			// 	}
			// });
			$("#server_text1").val("");
			$('#server_text_check1').hide();
			if (v3 != "所有"){
				$("#server_select1").empty().append('<option value="0">所有</option><option value="'+id+'">'+v3+'</option>');
				$("#server_select1").val(id).trigger('change');
			}
			if (find_host_flag == 1) {
				// find_host_arry.splice(-1, 1);
				//find_host_arry=[];
				find_host_flag = 0;
			}
			search_typeall_host_r.push(id+'-'+v2);
			search_typeall_host_new='';
			// find_host_arry.push(v2);
			$('#filterWW2>ul').append('<li style="height: 18px;"><span style = "display:none">'+id+'-'+v2+'</span><span class="ww" style="width:9em">' + v1+v2 + '</span><i class="del" style="margin-top: -17px;" onclick="_delFilter2(this)"></i></li>')
			selView2();
		} else {
			if (find_host_flag != 0) {
				// find_host_arry.splice(-1, 1);
			}
			find_host_flag = 1;
			//_clearFilter2();
			//find_host_arry=[];
			// find_host_arry.push(v2);
			search_typeall_host_new=id+'-'+v2;
			selView2();
		}
	}
}

function _clearFilter2(obj,num) {
	if(num==1){
		top1 = 9007199254740991;
	$("#server_text1").val('');
	$('#server_text_check1').hide();
	find_host_arry = [];
	search_typeall_host_new='';
	selView2();
		return;
	}
	top1 = 9007199254740991;
	$("#filterWW2").children('ul').empty();
	$("#filterWW2").hide();
	$("#clearFilter2").hide();
	$("#server_text1").val('');
	$('#server_text_check1').hide();
	find_host_arry = [];
	search_typeall_host_new='';
	search_typeall_host_r=[];
	$("#server_select1").empty().append('<option value="0">所有</option><option value="hgname">组名</option><option value="hostname">主机名</option><option value="ip">IP</option><option value="hostservicename">服务名</option><option value="accountname">账号</option>');
	selView2();
}

function _delFilter2(obj) {
	top1 = 9007199254740991;
	var v = $(obj).parent().children('span').eq(0).text();
	$(obj).parent().remove();
	search_typeall_host_r.splice($.inArray(v, search_typeall_host_r), 1);
	var filter_name = $("#server_select1").val();
	$.each(search_typeall_host_r,function(i,item){
		var filter_array = item.split('-');
		var filter_v = filter_array.splice(0,1).join('-');
		if (filter_array[0] != "0"){
			$("#server_select1").empty().append('<option value="0">所有</option><option value="'+filter_array[0]+'">'+filter_v+'</option>');
			$("#server_select1").val(filter_name).trigger('change');
			return false;
		}
	});
	if (search_typeall_host_r.length == 0){
		$("#server_select1").empty().append('<option value="0">所有</option><option value="hgname">组名</option><option value="hostname">主机名</option><option value="ip">IP</option><option value="hostservicename">服务</option><option value="accountname">账号</option>');
		$("#server_select1").val(filter_name).trigger('change');
	}
	selView2();
}

function _clear_keyword2(){
	$("#server_text1").val("");
	if (search_typeall_host_new != ""){
		search_typeall_host_new = "";
	}
	$("#server_text_check1").hide();
	selView2();
}

function change_input(obj){
	if ($(obj).val() == ""){
		if (search_typeall_host_new != ""){
			search_typeall_host_new = "";
			selView2();
		}
	}
}
	
function selView2() {
	var $sel = $('#filterWW2');
	var len = $('li', $sel).length;

	if (len == 0) {
		$sel.hide();
		$("#clearFilter2").hide();
	} else if (len == 1) {
		$("#filterWW2").show();
		$("#clearFilter2").show();
		$('>span.ww', $sel).show();
		$sel.addClass('selector-multiple');
	} else {
		$("#filterWW2").show();
		$("#clearFilter2").show();
		$('>span.ww', $sel).show();
		$sel.addClass('selector-multiple');
	}
	find_host_group();
}
function find_host_group() {
	find_host_arry=JSON.parse(JSON.stringify(search_typeall_host_r));
	if(search_typeall_host_new!=''){
		find_host_arry.push(search_typeall_host_new);
	}
	_getWait($(".waitTip"));
	if(find_host_arry.length!=0 && $.inArray(first_find_index,find_host_arry)>=0){
		if(ajax_find_host_doing==false){
			if(mtr==null){
				_getWait($(".waitTip"));
				//消红+展开标红
				$('#hostTree').find('span.h-name-red').find('.font-red').removeClass('font-red');
				$('#hostTree').find('span.h-name-red').removeClass('h-name-red');
				setTimeout(function () {
					red_to_no_red_and_open_to_red($('#hostTree'),0);
				},1);
			}else{
				
			}
		}else{
			
		}
		return false;
	}
	_getWait($(".waitTip"));
	//先清空之前的过滤信息
	click_h1();
}
function click_h1() {
	//清空数据
	var i = 0;
	index = 0;
	flag_ajax_true = true;
	$("#hostTree").find('i.h-aicon-d').removeClass('h-aicon-d');
	$("#hostTree").find('ul').hide();
	$("#hostTree").find('li').hide();
	$('#hostTree').find('span.h-name-red').find('.font-red').removeClass('font-red');
	$("#hostTree").find('span.h-name-red').removeClass('h-name-red');
	host_path_all = [];
	old_path_all = [];
	push_filter_wait = [];
	click_h0();
}
function red_to_no_red_and_open_to_red(obj, num) {
	for (var i = 0; i < tmp_list.length; i++) {
		var item = tmp_list[i];
		var pass = true;
		for (var jm = 0; jm < find_host_arry.length; jm++) {
			var pass_one = false;
			var jm_index_=find_host_arry[jm].indexOf('-');
			var search_arr = find_host_arry[jm].substr(jm_index_ + 1, find_host_arry[jm].length).split(' ');
			// var search_arr = find_host_arry[jm].split(' ');
			$.each(search_arr, function (i1, item1) {
				if (item1 != '') {
					if(find_host_arry[jm].substr(0,jm_index_)=='hostname'){
						var Name=item.Name.split('\t')[0];
						if (item.Type!=2){
							return false;
						}
					}else if(find_host_arry[jm].substr(0,jm_index_)=='ip'){
						var Name=item.Name.split('\t')[1];
						if (item.Type!=2){
							return false;
						}
					}else if(find_host_arry[jm].substr(0,jm_index_)=='hgname'){
						var Name=item.Name;
						if (item.Type!=1){
							return false;
						}
					}else if(find_host_arry[jm].substr(0,jm_index_)=='hostservicename'){
						var Name=item.Name.split('\t')[0];
						if (item.Type!=3){
							return false;
						}
					}else if(find_host_arry[jm].substr(0,jm_index_)=='accountname'){
						var Name=item.Name;
						if (item.Type!=4){
							return false;
						}
					}else{
						var Name=item.Name;
					}
					if (coverString(item1, Name)) {
						pass_one = true;
						return false;
					}
				}
			});
			if (pass_one == false) {
				pass = false;
				break;
			}
		}
		if (pass == true) {
			open_and_make_red(item);
		} else {
		}
	}
	if (li_red_to_no_red($('#hostTree')))
	//定位
	top_to_move($('#hostTree'));
}
var mtr = null;
var flag_ajax_true = false;
function click_h0(){
	if(mtr!=null){
		mtr.abort();
		mtr=null;
	}
	flag_ajax_true = true;
	//条件没有的情况 直接返回
	if (JSON.stringify(find_host_arry) == "[]"){
		_waitDone($(".waitTip"));
		$('#hosttree_div1').scrollTop(0);
		tmp_list = null;
		first_find_index = null;
		$('#hostTree').find('li').show();
		$("#hostTree").find('i.h-aicon-d').removeClass('h-aicon-d');
		$('#hostTree').find('ul').hide();
		$("#hostTree").find('span.h-name-red').removeClass('h-name-red');
		return false;
	}
	first_find_index=find_host_arry[0];
	var a=new Array();
	a[0]=find_host_arry[0];
	_getWait($(".waitTip"));
	mtr = $.ajax({
		url: '/bhost/FindAuthObject_B',
		type: "POST",
		async: true,
		data: {a0:se,a1:JSON.stringify(a),a2:TYPE,a3:2},
		success: function(result){
			_getWait($(".waitTip"));
			mtr=null;
			tmp_list=null;
			flag_ajax_true = false;
			$('#hostTree').find('li').show();
			$('#hostTree').children('li').hide();
			if (result == "None"){
				tmp_list=new Array();
				$("#server_text1").blur();
				_alert(0,'搜索','无搜索结果',$("#server_text1"));
				_waitDone($(".waitTip"));
				flag_ajax_true = true;
				return false;
			}
				tmp_list = JSON.parse(result);
				ajax_find_host_doing = true;
				if (find_host_arry.length > 1) {
					var new_list_arr = new Array();
					new_list_arr = tmp_list.filter(function (item) {
						var pass = true;
						for (var jm = 0; jm < find_host_arry.length; jm++) {
							var pass_one = false;
							if (find_host_arry[jm] == '' || find_host_arry[jm] == undefined || find_host_arry[jm] == null) {
								continue;
							}
							var jm_index_ = find_host_arry[jm].indexOf('-');
							var search_arr = find_host_arry[jm].substr(jm_index_ + 1, find_host_arry[jm].length).split(' ');
							
							$.each(search_arr, function (i1, item1) {
								if (item1 != '') {
									if (find_host_arry[jm].substr(0, jm_index_) == 'hostname') {
										var Name = item.Name.split('\t')[0];
										if (item.Type!=2){
											return false;
										}
									} else if (find_host_arry[jm].substr(0, jm_index_) == 'ip') {
										var Name = item.Name.split('\t')[1];
										if (item.Type!=2){
											return false;
										}
									} else if (find_host_arry[jm].substr(0, jm_index_) == 'hgname'){
										var Name = item.Name;
										if (item.Type!=1){
											return false;
										}
									}else if (find_host_arry[jm].substr(0, jm_index_) == 'hostservicename'){
										var Name = item.Name.split('\t')[0];
										if (item.Type!=3){
											return false;
										}
									}else if (find_host_arry[jm].substr(0, jm_index_) == 'accountname'){
										var Name = item.Name;
										if (item.Type!=4){
											return false;
										}
									}else {
										var Name = item.Name;
									}
									if (coverString(item1, Name)) {
										pass_one = true;
										return false;
									}
								}
							});
							if (pass_one == false) {
								pass = false;
								break;
							}
						}
						return pass;
					});
					if (new_list_arr.length == 0) {
						ajax_find_host_doing = false;
						$("#server_text1").blur();
						_alert(0, '搜索', '无搜索结果', $("#server_text1"));
						_waitDone($(".waitTip"));
						flag_ajax_true = true;
						return false;
					}
				}
			//把 过滤信息放入 host_path_all 全局变量
			if (tmp_list.length != 0){
				host_path_all = JSON.parse(JSON.stringify(tmp_list));
				flag_ajax_true = false;
				//开始过滤
				find_append();
			}else{
				ajax_find_host_doing=false;
				flag_ajax_true = true;
				$("#server_text1").blur();
				_alert(0,'搜索','无搜索结果',$("#server_text1"));
				_waitDone($(".waitTip"));
			}
		}
	});
}
var push_filter_wait = [];
var top1 = 9007199254740992;
function scrollTop_check_server1(){
	var i = 0;
	var index_i = 0;
	li_red_to_no_red($('#hostTree'));
}

function open_and_make_red(item){
	var Path_array=item.Path.split('/');
	var len=Path_array.length;
	if (len == 2){//主机层
		//show
		$('#nodehg-'+item.Id).parent('li').show();
		$('#nodehg-'+item.Id).siblings('span.h-name').addClass('h-name-red');
	}else{
		if (item.Type == 3 || item.Type == 4){ //服务/账号
			var s=0;
			for (var j = 1; j < len; j++){
				var id=Path_array[j].split(',')[1];
				if (j == len-1){ //主机层
					//show
					$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+id).parent('li').show();
					$i_item=$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+id).prev('i');
					if(($i_item.attr('class').indexOf('h-aicon-d')) === -1){
						$i_item.trigger('click');
					}
				}
				else{ //主机组层
					//show
					$('#nodehg-'+id).parent('li').show();
					$i_item=$('#nodehg-'+id).prev('i');
					if(($i_item.attr('class').indexOf('h-aicon-d')) === -1){
						filter_flag_append = true;
						$i_item.trigger('click');
					}
				}
			}
			if(s){
				return false;
			}
			if (item.Type == 4){
				$i_item.siblings('ul').find('input').each(function(i1,item1){
					var checkbox_id = $(item1).attr('id');
					if(checkbox_id==undefined){
						return true;
					}
					if (checkbox_id.indexOf('-') != -1){
						var all_id = checkbox_id.split('-');
						if (all_id.length == 5){
							var hg_id = all_id[1];
							var h_id = all_id[2];
							var a_id = all_id[3];
							var s_id = all_id[4];
							if (a_id == item.Id){
								//show
								$("#nodes-"+hg_id+'-'+h_id+'-'+s_id).parent('li').show();
								var $i_item = $("#nodes-"+hg_id+'-'+h_id+'-'+s_id).prev('i');
								if(($i_item.attr('class').indexOf('h-aicon-d')) === -1){
									filter_flag_append = true;
									$i_item.trigger('click');
								}
								//show
								$(item1).parent('li').show();
								$(item1).siblings('span.h-name').addClass('h-name-red');
							}
						}
					}
				})
			}
			else{
				var all_id = $i_item.siblings('input').attr('id').split('-');
				//show
				$("#nodes-"+all_id[1]+'-'+all_id[2]+'-'+item.Id).parent('li').show();
				$("#nodes-"+all_id[1]+'-'+all_id[2]+'-'+item.Id).siblings('span.h-name').addClass('h-name-red');
			}
		}else{
			for(var j=1;j<len-1;j++){
				var id=Path_array[j].split(',')[1];
				//show
				$('#nodehg-'+id).parent('li').show();
				$i_item=$('#nodehg-'+id).prev('i');
				if(($i_item.attr('class').indexOf('h-aicon-d')) == -1){
					filter_flag_append = true;
					$i_item.trigger('click');
				}		
			}
			if(item.Type==1){
				//show
				$('#nodehg-'+item.Id).parent('li').show();
				$('#nodehg-'+item.Id).siblings('span.h-name').addClass('h-name-red');
			}else{
				//show
				$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+item.Id).parent('li').show();
				$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+item.Id).siblings('span.h-name').addClass('h-name-red');
			}
		}
	}
}
function top_to_move(obj){
	var top_arr=$(obj).find('span.h-name-red');
	if(top_arr.length!=0){
		li_hide_while_no_red(obj, 0);
		$('#hosttree_div1').scrollTop(top_arr.eq(0).offset().top - 200);
		_waitDone($(".waitTip"));
	}else{
		$("#server_text1").blur();
		_alert(0, '搜索', '无搜索结果', $("#server_text1"));
		_waitDone($(".waitTip"));
	}
}

var _jScrollBar_array = [];
function _jScrollBar(scid) {
	var myBar = new MyScrollBar({
		selId:scid,
		hasX:true,
		hasY:false,
		width:6,
		// enterShow:false,
	})
}
	
function li_red_to_no_red(obj){
	var red_input = $(obj).find('span.h-name-red');
	var red_input_len=red_input.length;
	var im=0;
	var index_red=0;
	var red_do;
	_jScrollBar_array = [];
	function red_do_func(){
		clearTimeout(red_do);
		for(im=index_red;im<index_red+100;im++){
			if(im>=red_input_len){
				li_hide_while_no_red($('#hostTree'), 0);
				if ($('#hostTree').find('span.h-name-red').length == 0) {
					$("#server_text1").blur();
					_alert(0, '搜索', '无搜索结果', $("#server_text1"));
					_waitDone($(".waitTip"));
					flag_ajax_true = true;
					ajax_find_host_doing = false;
					return false;
				}
				$('#hosttree_div1').scrollTop($('#hostTree').find('span.h-name-red').eq(0).offset().top - 200);
				ajax_find_host_doing = false;
				flag_ajax_true = true;
				_waitDone($(".waitTip"));
				old_path_all = new Array();
				return false;
			}
			var item = red_input.eq(im);
			var pass = true;
			var item_name = item.siblings('input').attr('data-name');
			var Type=item.siblings('input').attr('id');
			var $span_son_font=$('.h-name-son',item).find('font');
			if(Type.indexOf('nodeh')<0){
				var span_son_name=item_name.toLowerCase();
			}else{
				var host_span_arr=item_name.split('\t');
				var span_son_name=(host_span_arr[0]+'('+host_span_arr[1]+')').toLowerCase();
			}
			for (var jm = 0; jm < find_host_arry.length; jm++) {
				var pass_one = false;
				if (find_host_arry[jm] == '' || find_host_arry[jm] == undefined || find_host_arry[jm] == null) {
					continue;
				}
				var pass_one = false;
				var jm_index_=find_host_arry[jm].indexOf('-');
				var search_arr = find_host_arry[jm].substr(jm_index_ + 1, find_host_arry[jm].length).split(' ');
				$.each(search_arr, function (i1, item1) {
					if (item1==''){
						return true;
					}
					if(find_host_arry[jm].substr(0,jm_index_)=='hostname'){
						var Name=item_name.split('\t')[1];
						if (Type.indexOf('nodeh')<0){
							return false;
						}
					}else if(find_host_arry[jm].substr(0,jm_index_)=='ip'){
						var Name=item_name.split('\t')[0];
						if (Type.indexOf('nodeh')<0){
							return false;
						}
					}else if(find_host_arry[jm].substr(0,jm_index_)=='hgname'){
						var Name=item_name;
						if (Type.indexOf('nodehg')<0){
							return false;
						}
					}else if(find_host_arry[jm].substr(0,jm_index_)=='hostservicename'){
						var Name=item_name.split('\t')[0];
						if (Type.indexOf('nodes')<0){
							return false;
						}
					}else if(find_host_arry[jm].substr(0,jm_index_)=='accountname'){
						var Name=item_name;
						if (Type.indexOf('nodea')<0){
							return false;
						}
					}else{
						var Name=item_name;
					}
					if (coverString(item1, Name)) {
						item1=item1.toLowerCase();
						if(find_host_arry[jm].substr(0, jm_index_) == 'hostname'){
							var index_start=span_son_name.indexOf('(');
							var index_true=span_son_name.indexOf(item1,index_start);
							if(index_true>=0){
								for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
									$span_son_font.eq(i_red_span).addClass('font-red');
								}
							}
						}else{
							var index_true=span_son_name.indexOf(item1);
							if(index_true>=0){
								for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
									$span_son_font.eq(i_red_span).addClass('font-red');
								}
							}
						}
						pass_one = true;
						return false;
					}
				});
				if (pass_one == false) {
					pass = false;
					break;
				}
			}
			if (pass == false) {
				item.removeClass('h-name-red');
			} else {
			}
		}
		index_red=im;
		red_do=setTimeout(function(){red_do_func();},1);
	}
	red_do_func();	
}
var t_li_hide_while_no_red;
function li_hide_while_no_red(obj,num){
	var li_visible=$(obj).children('li');
	for(var i=num;i<num+100;i++){
		if(i>=li_visible.length){
			break;
		}
		var item=li_visible.eq(i);
		var span_id = $(item).children('span.h-name').attr('id');
		if (_jScrollBar_array.indexOf(span_id) === -1){
			_jScrollBar_array.push(span_id);
			_jScrollBar(span_id);
		}
		var span_red_time=$(item).find('span.h-name-red').length;
		if(span_red_time==0){
			$(item).hide();
		}else if(span_red_time>0){
			$(item).show();
			var children_red_time=$(item).children('span.h-name-red').length;
			if(children_red_time>0 && span_red_time==1){
				$(item).find('i.h-aicon-d').removeClass('h-aicon-d');
				$(item).find('ul').hide();
				$(item).find('li').show();
			}
			else if(children_red_time>0 && span_red_time>1){
				$(item).find('li').show();
			}
			else if (children_red_time==0) {
				var $children_ul=$(item).children('ul');
				setTimeout(function () {li_hide_while_no_red($children_ul, 0); }, 1);
			}
		}
	}
	if(i<li_visible.length){
		setTimeout(function () { li_hide_while_no_red(obj, i); }, 1);
	}
}
function _jScrollBar(scid) {
	var myBar = new MyScrollBar({
		selId:scid,
		hasX:true,
		hasY:false,
		width:6,
	})
}
//比较IP大小
function _compare_ip(x, y) {
	var ip1 = x.split('.');
	var ip2 = y.split('.');
	for (var i1 = 0; i1 < 4; i1++) {
		if (parseInt(ip1[i1]) < parseInt(ip2[i1])) {
			return 3;
		} else if (parseInt(ip1[i1]) > parseInt(ip2[i1])) {
			return 2
		} else {

		}
	}
	return 1
}

/* 
* 处理过长的字符串，截取并添加省略号 
* 注：半角长度为1，全角长度为2 
*  
* pStr:字符串 
* pLen:截取长度 
*  
* return: 截取后的字符串 
*/
function autoAddEllipsis(pStr, pLen) {
	var _ret = cutString(pStr, pLen);
	var _cutFlag = _ret.cutflag;
	var _cutStringn = _ret.cutstring;

	if ("1" == _cutFlag) {
		return _cutStringn + "...";
	} else {
		return _cutStringn;
	}
}
/* 
* 取得指定长度的字符串 
* 注：半角长度为1，全角长度为2 
*  
* pStr:字符串 
* pLen:截取长度 
*  
* return: 截取后的字符串 
*/
function cutString(pStr, pLen) {
	// 原字符串长度  
	var _strLen = pStr.length;

	var _tmpCode;

	var _cutString;

	// 默认情况下，返回的字符串是原字符串的一部分  
	var _cutFlag = "1";

	var _lenCount = 0;

	var _ret = false;

	if (_strLen <= pLen / 2) {
		_cutString = pStr;
		_ret = true;
	}

	if (!_ret) {
		for (var i = 0; i < _strLen; i++) {
			if (isFull(pStr.charAt(i))) {
				_lenCount += 2;
			} else {
				_lenCount += 1;
			}

			if (_lenCount > pLen) {
				_cutString = pStr.substring(0, i);
				_ret = true;
				break;
			} else if (_lenCount == pLen) {
				_cutString = pStr.substring(0, i + 1);
				_ret = true;
				break;
			}
		}
	}

	if (!_ret) {
		_cutString = pStr;
		_ret = true;
	}

	if (_cutString.length == _strLen) {
		_cutFlag = "0";
	}

	return { "cutstring": _cutString, "cutflag": _cutFlag };
}

/* 
* 判断是否为全角 
*  
* pChar:长度为1的字符串 
* return: true:全角 
*          false:半角 
*/

function  coverString(subStr,str){
	subStr=subStr.replace(/\?/g, "\\?").replace(/\|/g, "\\|").replace(/\\/g, "\\\\").replace(/\$/g, "\\$").replace(/\(/g, "\\(").replace(/\)/g, "\\)").replace(/\*/g, "\\*").replace(/\./g, "\\.").replace(/\[/g, "\\[").replace(/\^/g, "\\^").replace(/\{/g, "\\{");
	var reg = eval("/"+subStr+"/ig");
	return reg.test(str);
}
function isFull(pChar) {
	if ((pChar.charCodeAt(0) > 128)) {
		return true;
	} else {
		return false;
	}
}

function _getWait(obj) {
	if (typeof waitDonelayer != 'undefined') {
		layer.close(waitDonelayer);
	}

	$(obj).removeClass('done').show().unbind().on('mouseover', function () {
		waitlayer = layer.tips('搜索中', this, {
			tips: 1,
			time: 0,
			skin: 'waitlayer'
		});
	}).on('mouseout', function () {
		if (typeof waitlayer != 'undefined') {
			layer.close(waitlayer);
		}
	});

	// //完成
	// setTimeout(function(){
	// 	_waitDone();
	// },3000)
}
function AscSort(a,b){
	a = parseInt(a.split(':')[1]);
	b = parseInt(b.split(':')[1]);
	return a - b;
}
function ajax_host(){
	ajax_flag = true;
	if(ajax_data.length == 0) return ;
	$.ajax({
		url:'/bhost/get_hosts',
		type:'post',
		cache:false,
		async:true,
		data:{a0:se,z1:ajax_data.join(",")},
		beforeSend :function(xmlHttp){ 
			xmlHttp.setRequestHeader("If-Modified-Since","0"); 
			xmlHttp.setRequestHeader("Cache-Control","no-cache");
		 },
		success:function(result){
			if(ajax_data.length == 0) return;
			
			results = JSON.parse(result);
			//ajax_data 排序
			ajax_data.sort(AscSort);
			$(results.info).each(function(i,item){
				var adata = item;
				var hgid = ajax_data[i].split(':')[0];
				//
				//改变样式
				
				$('#nodeh-'+hgid+'-'+adata.HostId).prev('i').addClass('h-aicon-d');
				obj = $('#nodeh-'+hgid+'-'+adata.HostId).siblings('ul');
				
				$(obj).empty().show();
				var v = 2,d;
					var $input = $('#nodeh-'+hgid+'-'+adata.HostId).siblings('span.checkbox');
				if($input.length  ==0) return true;
				if($('#nodeh-'+hgid+'-'+adata.HostId).siblings('span.authtype').find('input').is(':checked')){
					d = 0;
				}else{
					d = 1;
				}
				if ($input.attr('class').indexOf('disabled')>0){
					d = 0;
				}
				var c = $input.attr('class');
				if(c.indexOf('checked')>0){
					v=1;
				}else if(c == 'checkbox'){
					v=0;
				}
				
				var flag_change = false;
				var _loadfirst = $(obj).siblings('input.zcheck').attr("data-loadfirst");
				var _loadlast = $(obj).siblings('input.zcheck').attr("data-loadlast");
				var parents_aid = $(obj).siblings('input.zcheck').attr('id').split('-');
				var parents_id = parents_aid[2];
				var parentss_id = parents_aid[1];
				//判断 父节点是否状态改变
				
				var loadfirst = 0;
				var loadlast = 0;
				
				if(_loadfirst == _loadlast){
					if (_loadlast == 2){
						loadfirst = 2;
						loadlast = 2;
					}else if (_loadlast == 1){
						flag_change = true;
					}
				}else{
					if (_loadlast == 2){
						loadlast = 2;
					}
					if (_loadfirst == 2){
						loadfirst = 2;
					}
					//flag_change = true;
				}
				
				$.each(adata.ServiceSet, function (i, item) {
					var $a = '';
					var class_flag = 1;
					var flag_ser = 0;
					Ser_str = 'G'+hgid+'@H'+adata.HostId+'@S'+item.HostServiceId;
					$.each(Avalible_Account,function(i_a,item_a){
						if(item_a.indexOf(Ser_str) != -1){
							flag_ser = 1;
							return false;
						}
					})

					if(flag_ser == 0){
						return true;
					}

					if (ajax_find_host_doing == true && $(obj).siblings('span.h-name-red').length == 0) {
						var li_class_item = 'style="display: none;"';
					} else {
						var li_class_item = '';
					}
					$.each(adata.AccountSet, function (i2, item2) {
						$.each(item2.HostServiceSet, function (i1, item1) {
							if (item.HostServiceId == item1.HostServiceId) {
								var flag_acc = 0;
								Acc_str = 'G'+hgid+'@H'+adata.HostId+'@S'+item1.HostServiceId+'@A'+item2.HostAccount.AccountId;
								flag_account = $.inArray(Acc_str,Avalible_Account)
								if(flag_account != -1){
									flag_acc = 1;
								}
								if(flag_acc == 0){
									return true;
								}
								class_flag = 1;
								
								
								str_list = item2.HostAccount.AccountName.split('');
								var stp = '';
								for(var i3=0;i3<str_list.length;i3++){
									stp += '<font>'+str_list[i3]+'</font>';
								}
								
								
								if (loadlast == 2) {
									$a = $a + '<li ' + li_class_item + '><i class="h-blank" /><input type="checkbox" id="nodea-' + parentss_id + '-' + parents_id + '-' + item2.HostAccount.AccountId + '-' + item1.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' checked="checked" data-name="' + item2.HostAccount.AccountName + '"><i class="h-eicon h-eicon-a2"></i><span class="h-name h-name2" style="margin-top:-6px;width:12em;" id="spana-' + parentss_id + '-' + parents_id + '-' + item2.HostAccount.AccountId + '-' + item1.HostServiceId + '">' + '<span class="h-name-son" style="">' + stp + 
																								'</span>' + '</span></li>'
								} else {
									$a = $a + '<li ' + li_class_item + '><i class="h-blank" /><input type="checkbox" id="nodea-' + parentss_id + '-' + parents_id + '-' + item2.HostAccount.AccountId + '-' + item1.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-name="' + item2.HostAccount.AccountName + '"><i class="h-eicon h-eicon-a2"></i><span class="h-name h-name2" style="margin-top:-6px;width:12em;" id="spana-' + parentss_id + '-' + parents_id + '-' + item2.HostAccount.AccountId + '-' + item1.HostServiceId + '">' + '<span class="h-name-son" style="">' + 
																							 stp + 
																								'</span>' + '</span></li>'
								}
								return false;
							}
						})
					});
					if (class_flag == 0) {
						A_class = "h-blank";
					} else {
						A_class = "h-aicon";
					}
					str_list =  item.HostServiceName.split('');
					var stp = '';
					for(var i3=0;i3<str_list.length;i3++){
						stp += '<font>'+str_list[i3]+'</font>';
					}
					if (loadlast == 2) {
						$(obj).append('<li ' + li_class_item + '><i class="' + A_class + '" data-id="arrS-' + item.HostServiceId + '"/><input type="checkbox" id="nodes-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' checked="checked" data-name="' + item.HostServiceName + '\t' + item.ProtocolName + '"><i class="h-eicon h-eicon-s2"></i><span class="h-name h-name2" id="spans-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
								stp + 
								'</span>' + '</span><ul style="display:none">' + $a + '</ul></li>');
					} else {
						$(obj).append('<li ' + li_class_item + '><i class="' + A_class + '" data-id="arrS-' + item.HostServiceId + '"/><input type="checkbox" id="nodes-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-name="' + item.HostServiceName + '\t' + item.ProtocolName + '"><i class="h-eicon h-eicon-s2"></i><span class="h-name h-name2" id="spans-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
								stp + 
								'</span>' + '</span><ul style="display:none">' + $a + '</ul></li>');
					}
				});
				if (flag_change){
					if (AccessAuth.AuthObject != null && edit != "None"){
						var ser_flag = 0;
						var serid_flag = 0;
						var first_serid = 1;
						if (v != 0){
							$.each(AccessAuth.AuthObject,function(i1,item1){
								if (item1.HGId == parentss_id && item1.HostId == parents_id){
									$("#nodea-"+parentss_id+'-'+parents_id+'-'+item1.AccountId+'-'+item1.HostServiceId).attr('checked',true);				
									$("#nodea-"+parentss_id+'-'+parents_id+'-'+item1.AccountId+'-'+item1.HostServiceId).next('span').attr("class","checkbox checked");
									$("#nodea-"+parentss_id+'-'+parents_id+'-'+item1.AccountId+'-'+item1.HostServiceId).attr('data-loadfirst',2);
									$("#nodea-"+parentss_id+'-'+parents_id+'-'+item1.AccountId+'-'+item1.HostServiceId).attr('data-loadlast',2);
									
									if ($("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).siblings('ul').find('input:checked').length == $("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).siblings('ul').find('input').length){
										$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).attr('checked',true);
										$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).next('span').attr("class","checkbox checked");
										$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).attr('data-loadfirst',2);
										$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).attr('data-loadlast',2);
									}else{
										$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).attr("data-check","2");
										$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).attr('data-loadfirst',1);
										$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).attr('data-loadlast',1);
									}
									return false;
								}
							})
						}
					}
				}

				if(d==0){
					$(obj).find('input').prop('disabled',true);
					if ($(obj).siblings('span.authtype').find('input').length > 0){
						if ($(obj).siblings('span.authtype').find('input').next('span').attr('class').indexOf('checked') != -1 || $(obj).siblings('input').prop('disabled')){
							
						}else{
							$(obj).find('input').each(function(){
								$(this).attr('disabled', false);
								$(this).next('span.checkbox').removeClass('disabled');
							});
						}
					}
				}
				
				_checkView_host(obj);
			});
			get_msg();
			//50个结束 继续调用 过滤信息
			if (host_path_all.length == 0 && flag_ajax_true == false) {
				scrollTop_check_server1();
			} else {
			}
			ajax_flag = false;
			ajax_data = [];		
			return true;
		}
	})	
}

function _waitDone(obj) {
	if (typeof waitlayer != 'undefined') {
		layer.close(waitlayer);
	}
	$(obj).fadeOut(3000);
	if (typeof waitDonelayer != 'undefined') {
		layer.close(waitDonelayer);
	}
}

function up_filter(){
	if($('#keyword').val() != ''){
		$('#v_clear').show();
	}else{
		$('#v_clear').hide();
	};
}

function change_client(obj){
	if ($(obj).val() == "sqlldr"){
		$(".oracle_ctl").show();
	}else{
		$(".oracle_ctl").hide();
	}
}
function save_client(){
	var LocalClient_json = {
		"LocalClientId": 0,    
		"ProtocolName": null,
		"ClientName": null,        
		"ClientProgram": null,
	};
	if (quick_link == 1){
		var pro_name = $("#pro_select").children('option:selected').text();
	}else{
		if ($("#fList").find('a.prolink.active').length != 0){
			var tr_index = $('a.prolink.active').parents('tr:first').index();
			var a_index = $('a.prolink.active').index();
			var pro_name = service_array_all[tr_index][a_index].ProtocolName;
		}else{
			var a_index = $('a.prolink.active').index();
			var pro_name = service_array_all[tr_click][a_index].ProtocolName;
		}
	}
	LocalClient_json.ClientName = $("#sel_client").val();
	if(pro_name=='SFTP' || pro_name=='FTP'){
		pro_name='FTP';
	}
	if (LocalClient_json.ClientName == "SecureCRT" || LocalClient_json.ClientName == "Putty" || LocalClient_json.ClientName == "XShell"){
		LocalClient_json.ProtocolName = "SSH";
	}else{
		LocalClient_json.ProtocolName = pro_name;
	}
	LocalClient_json.ClientProgram = $("#client_input").val();
	$.ajax({
		url: "/bhost/PSave_LocalClient",
		type:"POST",
		async:false,
		data:{a0:se,a1:JSON.stringify(LocalClient_json)}, 
		success:function(result){
			var result=JSON.parse(result);
			if(result.Result){
				$.ajax({
					url: "/bhost/PGet_LocalClient",
					type:"POST",
					async:false,
					data:{a0:se},
					success:function(result){
						var result=JSON.parse(result);
						if(result.Result){
							path_array = result.info.data;
						}else{
							_alert(2,'批量启动',result.ErrMsg);
							return false;
						}
					}
				});
				//$(".local_client").find('input').trigger('change');
				//$("#sel_client").val(LocalClient_json.ClientName).trigger('change');
				$("#sel_client").children('option:selected').text(LocalClient_json.ClientName);
				$("#select2-sel_client-container").text(LocalClient_json.ClientName);
				$("#select2-sel_client-container").attr('title',LocalClient_json.ClientName);
				$("#connect").click();
			}else{
				_alert(2,'批量启动',result.ErrMsg);
				pass=false;
				return false;
			}
		}
	});
}
var Avalible_Account = [];

function get_AccessScope(){
	$.ajax({
		url:'/bhost/_get_Access',
		type:"POST",
		async:true,
		data:{a0:se, a1:4},//1是好的
		success: function(Result) {
			Avalible_Account = JSON.parse(Result);
		}
	})
	/*
	$.ajax({
		url:'/bhost/_get_Access_IP',
		type:"POST",
		async:true,
		data:{a0:se, a1:TYPE},
		success: function(Result) {
			//G + host group id + @H + host ip + @S + service id + @A + account id + : account name + : + service name + : + protocol name + : + param name + : + protocol id
			Avalible_Account_S = JSON.parse(Result)
			Hosts_arr = [];
			$.each(Avalible_Account_S,function(i,item){
				Hosts_arr.push(item.split('@H')[1].split('@S')[0])
			})
			var new_Hosts_arr = [];
			for(var i =0;i<Hosts_arr.length-1;i++){
					if(new_Hosts_arr.indexOf(Hosts_arr[i]) == -1){
					new_Hosts_arr.push(Hosts_arr[i]);
				}
			}			
		}
	})
	*/
}
function get_win_path(obj){
	sesstime = new Date().getTime();
	
	//{"Session":"1533965498777","ClientName":"xShell","BHostUrl":"https://192.168.0.167"}
	
	cmd_json ={
		"ClientName":"xShell",
		"Session": ""+sesstime,//
		"BHostUrl":"https://"+document.domain+ (location.port!=''?':'+location.port:'')		
	}
	var base64_str = '';
	var sesstimet = (new Date()).valueOf();
	cmd_json['sesstimet'] = sesstimet;
	$.ajax({
		url: "/bhost/get_base64",
		type:"POST",
		async:false,		
		data:{a0:se,z1:JSON.stringify(cmd_json)},
		success:function(result){
			var result=JSON.parse(result);
			if(result.Result){
				if_html_client = result.info;
				base64_str = result.b64;
			}else{
				_alert(1,"批量启动",result.ErrMsg);
			}
		}
	})
	
	
	//window.location.href = 'bhost://cmd&'+base64_str;
	get_regedit('bhost', se,'',sesstimet);
	$('#YuFrame1').remove();
	$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
	$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+base64_str);
	//插入数据库数据
	$.ajax({
		url: "/bhost/insert_usbkeys",
		type:"POST",
		async:false,		
		data:{a0:se,z1:sesstime,t1:"find_client_path",u1:' ',c1:' ',a10:"批量启动"},
		success:function(result){
			var result=JSON.parse(result);
			if(result.Result){
			}else{
				_alert(1,"批量启动",result.ErrMsg);
				return false;
			}
		}
	})
	
	//循环获取 数据库状态
	var c = 0;
	
	if_ok_down = setInterval(function(){
		ret = repeat_get_path(sesstime);
		
		if(ret[0] == 1){
			clearInterval(if_ok_down);
			$(obj).prev('input').val(ret[1]);
			return 0;				
		}
		if(ret[0] == 2){
			clearInterval(if_ok_down);
			_alert(1,"批量启动",'浏览失败');
			return 0;				
		}
		if(c >=60){
			clearInterval(if_ok_down);
			
		}			
		c = c + 1;				
	},500)
}
function repeat_get_path(sesstime){
	var st = 0;
	$.ajax({
		url: "/bhost/repeat_get_path",
		type:"POST",
		async:false,		
		data:{a0:se,z1:sesstime},
		success:function(result){
			var result=JSON.parse(result);
			if(result.Result){
				st = result.info;
				absolute_path = result.path;
			}else{
				_alert(1,"批量启动",result.ErrMsg);
				return false;
			}
		}
	})
	return [st,absolute_path];
}

//删除ip
function _delIp(obj) {
	var $c = $(obj).parent();
	$c.fadeOut(function () {
		$c.remove();
		add_server();
	});
}
//加入ip
function _addIp(obj,type) {
	if(type == 1){
		if($("#input1").val() == "" || $("#input2").val() == ""){
			return true;
		}
	}
	var pass = 1;
	var v1 = $(obj).prev().val().trim();
	var v = $(obj).prev().prev().prev().val().trim();

	if (v == '') {
		_alert(2, '批量启动', '请输入起始IP地址');
		return false;
	} else if (!ipReg.test(v)) {
		_alert(1, '批量启动', '起始IP地址格式不正确');
		return false;
	}
	if (v1 == '') {
		_alert(2, '批量启动', '请输入结束IP地址');
		return false;
	} else if (!ipReg.test(v1)) {
		_alert(1, '批量启动', '结束IP地址格式不正确');
		return false;
	}
	// if (v == v1) {
	// 	_alert(1, '批量启动', '起始IP地址不能大于等于结束IP地址');
	// 	return false;
	// }
	$('>span[class=ss]', '#ip_n').each(function () {
		var input1 = $(this).find('input').eq(0).val();
		var input2 = $(this).find('input').eq(1).val();
		if (input1 == v && input2 == v1) {
			_alert(2, '批量启动', '相同的IP区间已存在');
			pass = 0;
			return false;
		}
	});
	if(v != v1){
		//add zero
		var v_str = v.split(".");
		var v1_str = v1.split(".");
		for (var i = 0; i < 4; i++) {
			if (parseInt(v_str[i]) > parseInt(v1_str[i])) {
				_alert(1, '批量启动', '起始IP地址不能大于等于结束IP地址');
				return false;
			} else if (parseInt(v_str[i]) < parseInt(v1_str[i])) {
				break;
			}
		}
	}
	if (pass == 1 && type != 1) {
		var ip_id = $("#ip_span").attr("value");
		var $c = $('<span class="ss" value="' + ip_id + '" style="float: left;width: 312px;position: static;padding: 0 7px 10px 0;"/>');
		$c.html('<input type="text" class="form-text form-text2" value="' + v + '"  style="width:122px;" disabled>'
			+ '<span style="vertical-align:middle;padding-left: 4px;padding-right: 4px;">-</span>'
			+ '<input type="text" class="form-text form-text2" value="' + v1 + '" style="width:122px;" disabled>'
			+ '<i class="ctr ctr-del" style="margin-top: 5px;margin-left: -3px;" onclick="_delIp(this)"></i>');
		$(obj).parent().after($c);
		$(obj).prev().val("");
		$(obj).prev().prev().prev().val("");
		$(obj).prev().prev().prev().focus();
		$("#ip_span").attr("value", "0");
	}
	add_server();
}
		var cip='{{cip}}';
		function mac_get(){
			sesstime = (new Date()).valueOf();
			cmd_json ={
				"type":"bhostupdate",
				"sesstime": sesstime,//毫秒
				"UrlIp":document.domain+ (location.port!=''?':'+location.port:''),
				"sesstimet":'',
				//"UpdateExe":client_str,
				"session":sesstime,
				"BHUser":''
			}
			cmd_json['login'] =1;
			cmd_json['cip'] = cip;	
			var base64_str = '';
			var sesstimet = (new Date()).valueOf() +1;
			cmd_json['sesstimet'] = sesstimet;
			$.ajax({
				url: "/bhost/get_base64",
				type:"POST",
				async:false,		
				data:{z1:JSON.stringify(cmd_json)},
				success:function(result){
					var result=JSON.parse(result);
					if(result.Result){
						if_html_client = result.info;
						base64_str = result.b64;
					}else{
						_alert(1,"批量启动",result.ErrMsg);
					}
				}
			})
			get_regedit_mac('bhostupdate','',uCode,sesstimet);
			$('#YuFrame1').remove();
			$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
			$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+base64_str);
		}
		var uCode=window.parent.parent.document.frm.us.value;
		var mac='';
		function get_regedit_mac(typ,se,uCode,sesstimet){
			se = se || ' ';
			uCode = uCode || ' ';
			//插入数据库数据
			$.ajax({
				url: "/bhost/insert_usbkeys",
				type:"POST",
				async:false,
				data:{a0:se,z1:sesstimet,t1:"IfUpdate",u1:' ',c1:' ',a10:""},
				success:function(result){
					var result=JSON.parse(result);
					if(result.Result){
					}else{
						_alert(1,"检查客户端",result.ErrMsg);
						return false;
					}
				}
			})
			//循环获取 数据库状态
			var c = 0;
			var if_ok_down_other = setInterval(function(){
				var  ret = repeat_get_path_other(sesstimet,se);
				var rrrt = ret[1].split(',');
				if(ret[0] == 1 && rrrt[0].toLowerCase() =='true' ){
					if(rrrt.length >1 && rrrt[1] !=''){
						mac = rrrt[1];
					}
					else mac = '';
					clearInterval(if_ok_down_other);
					if(typ =='bhostupdate') {
					}
					return 0;
				}
				if(c >=10){
					clearInterval(if_ok_down_other);
					alertError1(typ,se,uCode);
					if(typ =='bhostupdate') _closeLoading();
					return 0;
				}
				c = c + 1;
			},500)
		}
		var UpdateNoAlert = 1;
		function alertError1(type,se,uCode){
			type = type || "bhost";
			se = se || '';
			uCode = uCode || '';
			var checkg = false;
			$.ajax({
				url: '/bhost/GetNoAlert',
				type: 'post',
				async: false,
				data: { a0: se,a1:uCode},
				success: function (result) {
					var result=JSON.parse(result);
					
					if(result.Result){
						result = result.info;
						if(result == '1'){
							checkg = true;
						}
					}else{
						_alert(2,"更新客户端",result.ErrMsg);
						return false;
					}
				}
			})
			var title = '检测到当前用户没有安装最新的客户端，建议安装';
			var content ='<div class="layer-alert"><i class="alert warning"></i><span>'+title+'</span><div style="margin-top: 5px;"><input type="checkbox" class="form-checkbox" name="" id="layer_div" value="" >不再提示</div></div>';
			
			if(checkg){
				 parent.parent.layer.open({
					type:1,
					title:"运维客户端",
					content:content,
					btn:['下&nbsp;&nbsp;载', '取&nbsp;&nbsp;消'],
					btnAlign:'c',
					closeBtn: false,
					skin:'layer-custom',
					area:['380px','310px'],
					move: false,
					resize: false,
					btn1:function(i){
						parent.parent.layer.close(i);
						location.href='/bhost/download_BHostClient_exe';	
						NoAlert(se,uCode);
					},
					btn2:function(i){
						parent.parent.layer.close(i);
						NoAlert(se,uCode);
					},success: function(i){
						if(type.toLowerCase() =='bhost') $('#layer_div').parent().remove();
						else{
							$('#layer_div').iCheck({
								checkboxClass: 'icheckbox_minimal-blue',
								radioClass: 'iradio_minimal-blue',
								increaseArea: '0' // optional
							});
							$('.layer-alert .warning').css('height',"110px");
						}
					}
				});
			}else{
			}
		}
		
		var loadLayer_client = false;
		var check_cilent = false;
		var list_ip = [];
		var list_ip_ssh = [];
		function _showLoading_client(tit){
			var t = tit || '';
			loadLayer_client =  parent.layer.open({
				title:false,
				closeBtn:false,
				content:'<div id="Loading">'+tit+'</div>',
				btn:false,
				skin:'loadingbar',
				area:['250px','250px'],
				move:false,
				resize:false,
				isOutAnim: false,
				shade:[0.1,'#000']
			})
		}
		function _closeLoading_client(){
			if(loadLayer_client) parent.layer.close(loadLayer_client);
		}
</script>
</body>

</html>
