<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Logbase运维安全管理系统</title>
	<!--script-->
	<script src="/manage/js/jquery.min.js"></script>
	<script src="/manage/js/jquery.easing.js"></script>
	<script src="/manage/js/layer.js"></script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/common_e.js"></script>
	<script src="/manage/js/select2.full.min.js"></script>
	<script src="/manage/js/icheck.min.js"></script>
	<script src="/manage/js/jquery.plugin.js"></script>
	<script src="/manage/js/jquery.datepick.js"></script>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<link rel="stylesheet" href="/manage/css/style.css">
	<link rel="stylesheet" href="/manage/css/jquery.datepick.css">
	
<!--icheck-->
	<script src="/manage/js/icheck.min.js"></script>
	<script src="/manage/js/select2.full.min.js"></script>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<script type="text/javascript" src="/manage/js/dialog-plus.js"></script>
	<link rel="stylesheet" href="/manage/css/ui-dialog.css" type="text/css" />
	<link rel="stylesheet" href="/manage/css/G-style.css" type="text/css" />
	<link rel="stylesheet" href="/manage/css/new-head.css">
</head>
<body style="overflow:hidden;" class="bg-white">
	<!---->
	<div class="rwrap">
		<!---->
		<div class="mainer">
			
			<div class="container">
				<div class="c-top">
					<div class="c-title">
						<!--
						<h3 onclick="show_list(1)" class="tit"><span style="width:120px">按访问授权</span><i class="icon-by-access"></i></h3>
						-->
						<div class="manual-head" style="width:123px;;float:left;">
							<div class="manual-title-other title-item" id="frist" style="background-color: #ababab;">
								<span class="cmdauth_access" style="">按访问授权</span>
								<i class="cmdAuth_access_icon" style=""></i>
							</div>
						</div>
						<div class="secnav">
							<ul id="step">
								<li style="width:123px;" class="active">访问授权</li>
								<li style="width:123px;" onclick="to(2)">指令集合/响应方式</li>
							</ul>
						</div>

					</div>
				</div>

				<div class="c-cont" style="">
					<div class="c-wrap" style="padding: 10px 0 0">
						<div class="c-exp" id="c-exp">
						
							<div class="h-explorer h-explorer3">
								<div class="h-top">
									<div class="h-tit">
										<div class="form-item form-nm">
											<div class="form-tag"><em class="imp">*</em>授权名称：</div>
											<div class="form-c">
												<input type="text" class="form-text" style="width:160px;" maxlength="128" name="ManageAuthName" id="ManageAuthName" onblur="NameCheck(this)"><i class="v-check" style=" margin-top: 11px;"></i>
												<span style="font-size: 12px;">特殊字符仅支持下划线、横杠、小数点</span>
											</div>
										</div>
									</div>
									<div class="form-tiem" style="float:right">
										<div class="form-tag" style="float: left;color: #9a9a9a;line-height: 34px;">启用授权：</div>
										<div class="form-c" style="margin-top:8px">
											<input id="Enable" type="checkbox" class="form-checkbox" name="" value="">
										</div>
									</div>
									<div class="filter" style="display:none">
										<div class="search">
											<select name="user_select" id="user_select" class="filter-select">
												<option value="0" selected>所有</option>
												<option value="name">姓名</option>
											</select>

											<input type="text" class="filter-text" placeholder="输入关键字" name="user_text" id="user_text" maxlength="128">

											<button class="filter-btn" onclick="_addFilter_user(this)"><img src="/manage/images/search-icon.png"></button>
										</div>

										<div class="selector" id="filterWW_user" style="display: none;">
											<span class="ww">搜索条件</span>
											<ul></ul>
										</div>
									</div>
				                </div>
								<!--
								<div class="h-content2" style="max-height:55px;border-bottom: 1px solid #CCC;overflow: hidden;">
									<div style="margin-bottom: 10px;float:left;width:49%;margin-left: 16px;">
										<h2>启用策略：</h2>
										<ul id="" style="">
											<li style="padding: -1px 0;margin-left: -26px;margin-top: -8px;"><label><input id="Enable" type="checkbox" class="form-checkbox" name="" value=""></label></li>
										</ul>
									</div>
								</div>
								-->
				                <div class="h-catelog h-catelog2" style="background-color: #ffffff;    width: 298px;">
				                    <h5><em class="imp" style="color: #F00;font-style: normal;">*</em><i class="h-eicon h-eicon-u"></i>协助管理者</h5>
				                    <ul id="contlist">	
										<li style="width:50%;"><select class="filter-select" name="" id="manager_select" style="width:120px" onchange="change_manager(this);">
											</select>
											<i class="ctrl add" onclick="_addmanager(this)" style="margin-left:0px;"></i>
										</li>
				                    </ul>
				                </div>
								<div class="h-catelog h-catelog2 h-catelog3" style="background-color: #ffffff;    padding: 0;    border-right: 0px;">
									<div class="c-col2 ss">
									<div>
										<span class="form-tag" style="float: none;"><em class="imp">*</em>访问授权：</span>
									</div>

									<div class="ss-cont" id="access_way" style="padding: 0;overflow: hidden;height: auto;">
										<!--div class="item">
											<label><input type="checkbox" name="" checked="checked">account1</label>
										</div-->
									</div>
									</div>
								</div>
				                <!--div class="h-catelog h-catelog2">
				                	<h2>访问方式：</h2>
				                	<ul id="contlist"></ul>
				                </div-->
				            </div>
			            </div>
						<div class="c-exp" id="c-exp3" style="display:none">
						
							<div class="h-explorer">
				                <div class="h-top">
				                	<div class="h-tit">
				                		<div class="form-item form-nm">
											<div class="form-tag">配置指令集合</div>
										</div>
									</div>
									<div style="float:left;    padding: 8px 0 0 28px;"><input type="radio" id="" value="1" name="action" style="margin-top: 5px;margin-right:10px" class="form-radio" checked > 允许用户使用以下指令集</div>
									<div style="float:left;    padding: 8px 0 0 16px;"><input type="radio" id="" value="2" name="action" class="form-radio" > 禁止用户使用以下指令集</div>
				                </div>
								<div class="h-content3" style="padding: 0px;">
									<!--
									<div class="form-item" style="width:49%;float:left;border-right: 1px solid #CCC;">
										<span class="form-tag" style="width:6em; margin-top:-5px"><em class="imp">*</em>动作：</span>
										<label style="    padding: 10px;"><input type="radio" id="" value="1" name="action" style="margin-top: 5px;margin-right:10px" class="form-radio" checked > 只允许用户使用以下指令集</label>
										<label style="        padding: 10px;"><input type="radio" id="" value="2" name="action" class="form-radio" > 禁止用户使用以下指令集</label>
										
																				
									</div>	
									-->
									<div class="form-item" style="width: 48%;margin-left: 36px;float: left;">
										<span class="form-tag" style="width:105px;margin-left: -8px;">手工输入指令：</span>
										<div class="form-c" style="padding-left:0;">
											<textarea id="Content" class="form-textarea" name="" id="Content" cols="30" rows="10"style="height:140px;width:76%;margin-left:10px;"></textarea>
										</div>
									</div>
									<div style="margin-top: 20px;height:162px;"><span class="form-tip">多个指令请使用换行符分隔<br /><span class="form-tip">&lt;match&gt;通配符</span><span class="form-tip">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;nmatch&gt;取非</span><br/><span class="form-tip">&lt;regex&gt;正则表达式匹配</span><span class="form-tip">&lt;nregex&gt;取非</span><br /><span class="form-tip">&lt;include&gt;包含匹配</span><span class="form-tip">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ninclude&gt;取非</span><br /><span class="form-tip">&lt;equ&gt;完全匹配</span><br /><span class="form-tip">默认为包含匹配，增加如下例子的匹配方式，表示包含ls和-al，花括号需单独占一行：</span><br/><span class="form-tip">{</span><br /><span class="form-tip">ls</span><br /><span class="form-tip">-al</span><br /><span class="form-tip">}</span></span></div>
									<div class="form-item" id="cmdset" style="/*border-bottom: 1px solid #CCC;*/">
										<span class="form-tag" style="width:136px; margin-top:-5px;    margin-top: -6px;"><em class="imp">*</em>指令集合：</span>
										<div id="cmd_list" style="margin-left: 134px;">
											<div class="item" style="height: auto;padding:0px;width: 170px;height: 28px;margin-top: -5px;margin-left: 7px;">
												<!--
												<div class="item" style="margin-top: -11px;margin-left: 10px;">
													<select class="filter-select" name="" id="cmd" style="width:70%">
														<option value="0">请选择</option>
													</select>
													<i class="ctrl add" onclick="_addcmd(this)"></i>
												</div>
												-->
												
												<div class="cmd" id="cmd"></div>
												<i style="margin-top: -46px;margin-left: 148px;" class="ctrl add" onclick="_addcmd(this)"></i>
											</div>
										</div>
									</div>
									<div class="clear" style="clear: both;border-bottom: 1px solid #CCC;"></div>
									<div class="h-top">		                    
										<div class="h-tit">
											<div class="form-item form-nm">
												<div class="form-tag">配置响应方式</div>
											</div>
										</div>
									</div>
							
									<div class="form-item" style="float: left;width:522px;margin-left: 50px;padding: 20px 0px 0 0px;" id="response_check">
										<label style="padding: 10px;"><input type="checkbox" id="Blocke" value="2" name="response" style="margin-top: 5px;margin-right:10px" class="form-checkbox"> 阻断会话</label>
										<label style="padding: 10px;"><input type="checkbox" id="ignore" value="4" name="response" class="form-checkbox" > 忽略指令</label>
										<label style="padding: 10px;"><input type="checkbox" id="insapp" value="8" name="response" style="margin-top: 5px;margin-right:10px" class="form-checkbox" >指令审批 </label>
										<span class="form-tag" style="width:6em;margin-top: -5px;"><em class="imp">*</em>响应方式：</span>
										<label style=" padding: 10px;"><input type="checkbox" id="warning_checkbox" value="1" name="" style="margin-top: 5px;margin-right:10px" class="form-checkbox" checked>产生告警</label>	

									</div>	
									
									<div class="form-item" style="width:49%;float:left;">
										<div id="ApproveStrategy_massage" style="display:none;width: 50%;float: left;">
											<span class="form-tag" style="width:6em; margin-top:-5px;"><em class="imp">*</em>审批策略：</span>
											<div class="form-c" id="" style="padding-left: 86px;margin-top: -4px;">
												<div class="approve_Select" id="EnableApprove"></div>
											</div>
										</div>
										<div id="warning_massage" style="float: left;width: 50%;">
											<span class="form-tag" style="width:6em; margin-top:-5px;"><em class="imp">*</em>告警信息：</span>
											<div class="form-c" id="" style="padding-left: 86px;margin-top: -4px;">
												<div class="" id="EventAlarmInfoId"></div>
											</div>
										</div>
										<!--审批-->
										<div class="dialog-cont" id="EnableApprove_suspend" style="display:none;">
											<div class="container" id="add_div">
												<div class="c-cont2" style="min-height:434px;max-height:280px">
													<div class="c-form" style="padding-bottom:10px;padding:0;">
														<div class="c-form" style="padding:0;">
															<div class="form-item " style="float: left;width: 45%;padding: 20px 0px 0 85px;">
																<span class="form-tag" style="width: 50px;"><em class="imp">*</em>名称：</span>
																<div class="form-c" style="padding: 0 0 0 0;">
																	<input type="text" class="form-text" id="ApproveStrategyName" name="ApproveStrategyName" onblur="regCheck(this,nameReg);"
																	 maxlength="128" style="margin-left:8px;"><i class="v-check"></i>
																	<p class="form-tip" style="margin-left: 52px;">特殊字符仅支持下划线、横杠、小数点</p>
																</div>
															</div>
															<div class="form-item" style="padding-left: 500px;width: 36%;">
																<span class="form-tag" style="    width: 88px;"><em class="imp">*</em>审批人数：</span>
																<div class="form-c" style="padding-left: 98px;">
																	<input edited="0" type="text" class="form-text" id="ApproveNum" name="ApproveNum" maxlength="3" style="width: 28px;float: left;text-align: center;padding: 0 5px 0 5px;"
																	 onfocus="this.select()" onkeyup="this.value = this.value.replace(/\D/g,'');$(this).attr('edited',2);">
																	<li id="" style="float: left;color: #000;margin-top: 4px;margin-left: 7px;">/</li>
																	<li id="admin_num" style="float: left;color: #000;margin-top: 5px;margin-left: 7px;">0</li>
																</div>
															</div>
															
															<div class="form-item " style="float: left;">
																<span class="form-tag form-tag_change" style=""><em class="imp">*</em>方式：</span>
																<div class="form-c form-c_change" style="" id="checkbox">
																	<label class="form-label" style="">
																		<span class="form-li">消息</span>
																		<input id="checkbox1" name="checkbox1" class="form-checkbox" type="checkbox" name="">
																	</label>
																	<!-- <label class="form-label" style="">
																		<input id="checkbox2" name="checkbox2" class="form-checkbox" type="checkbox" name="">
																		<li class="form-li">短信猫</li>
																	</label> -->
																	<label class="form-label" style="">
																		<span class="form-li">短信</span>
																		<input id="checkbox4" name="checkbox4" class="form-checkbox" type="checkbox" name="">
																	</label>
																	
																	<label class="form-label" style="">
																		<span class="form-li">邮件</span>
																		<input id="checkbox8" name="checkbox8" class="form-checkbox" type="checkbox" name="">
																	</label>
																	
																	<!-- <label class="form-label" style="">
																		<input id="checkbox16" name="checkbox16" class="form-checkbox" type="checkbox" name="">
																		<li class="form-li">TOKEN</li>
																	</label> -->
																	
																</div>
															</div>
															<div class="form-item" style="float: left;padding: 10px 0px;width: 382px;display: none;">
																<span class="form-tag form-tag_change" style="">短信默认：</span>
																<div class="form-c form-c_change" style="">
																	<div class="xSelect xSelect_phone_m"></div>
																</div>
															</div>
															<div class="form-item" style="float: left;padding: 10px 0px;width: auto;display: none;">
																<span class="form-tag form-tag_change" style="">短信备用：</span>
																<div class="form-c form-c_change" style="">
																	<div class="xSelect xSelect_phone_s"></div>
																</div>
															</div>
															<div class="form-item" style="float: left;padding: 10px 0px;width: 382px;display: none;">
																<span class="form-tag form-tag_change" style="">邮件默认：</span>
																<div class="form-c form-c_change" style="">
																	<div class="xSelect xSelect_smtp_m"></div>
																</div>
															</div>
															<div class="form-item" style="float: left;padding: 10px 0px;width: auto;display: none;">
																<span class="form-tag form-tag_change" style="">邮件备用：</span>
																<div class="form-c form-c_change" style="">
																	<div class="xSelect xSelect_smtp_s"></div>
																</div>
															</div>
															
														</div>
														<div class="form-item form-item-100" style="width: 90%;margin-left: 36px;max-height:152px;">
															<span class="form-tag" style="width: 100px;"><em class="imp">*</em>审批者：</span>
															<div class="h-content3" style="padding: 0 0 0 8px;max-height:114px;" name="label_list_a" id="label_list_a">
																<div class="item" style="padding-top:0px;width:195px;" id="admin_check_a" name="admin_check_a" value="0">
																	<select class="filter-select" name="admin_select_a" id="admin_select_a" style="width:160px;">
																		<option value="0" selected>请选择</option>
																	</select>
																	<i class="ctrl add" style="    margin-left: 1px;" onclick="_addadmin_a(this)"></i>
																</div>
															</div>
														</div>
													</div>
												</div>
												<div class="btns" style="margin-bottom: -20px;">
													<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
													<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
												</div>
											</div>
										</div>
										<!--警告-->
										<div class="dialog-cont" id="eventinfo_suspend" style="display:none;">
											<div class="container">
												<div class="c-cont" style="min-height:410px;max-height:280px">
													<div class="c-form" style="padding:0;">
														<div class="form">
															<div class="form-item" style="float: left;width: 43%;margin-left:50px;">
																<span class="form-tag" style="width:50px;"><em class="imp">*</em>名称：</span>
																<div class="form-c" style="padding-left:0px;">
																	<input type="text" class="form-text" id="e_n" name="e_n" onblur="regCheck(this,nameReg);" maxlength="128" style="margin-left:8px;"><i class="v-check"></i>
																	<p class="form-tip" style="margin-left:52px;">特殊字符仅支持下划线、横杠、小数点</p>
																</div>
															</div>
															<div class="form-item" style="width: 50%;float:left;">
																<span class="form-tag" style="width: 58px;padding-left: 0px;"><em class="imp" id="Description_imp" style="display:none;">*</em>描述：</span>
																<div class="form-c" style="padding-left:0px;">
																	<input type="text" class="form-text" id="Description" name="Description" maxlength="1024" style="width: 183px;">
																</div>
															</div>
															<div class="form-item" style="float: left;width: 24%;margin-left:50px">
																<span class="form-tag" style="width:50px;">等级：</span>
																<div class="form-c" style="padding-left:0px;">
																	<select class="filter-select" name="EventLevel" id="EventLevel" style="width:50px;margin-left:9px;">
																		<option value="0" selected>无</option>
																		<option value="1" >低</option>
																		<option value="2" >中</option>
																		<option value="3" >高</option>
																	</select>
																</div>
															</div>
															<div class="form-item" style="width: 29.2%;float: left;">
																<span class="form-tag" style="width: 62px;">类型：</span>
																<div class="form-c" style="padding-left: 70px;">
																	<select class="filter-select" name="EventType" id="EventType" style="width:100px;">
																			<option value="0" selected>无</option>
																			<option value="1" >违规操作</option>
																			<option value="2" >高危操作</option>
																			<option value="3" >登录异常</option>
																		</select>
																</div>
															</div>
															
															<div class="form-item" style="width: 30%;float: left;">
																<span class="form-tag" style="width: 95px;">警告方式：</span>
																<div class="form-c" style="padding-left: 103px;">
																	<select class="filter-select" name="AlarmAction" id="AlarmAction" style="width:90px;">
																		<option value="0" selected>无</option>
																		<option value="1" >邮件</option>
																		<!--
																		<option value="2" >短信猫</option>
																		-->
																		<option value="3" >短信</option>
																		<option value="4" >snmp</option>
																		<option value="5" >syslog</option>
																	</select>
																</div>
															</div>
															
															<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="mail1_div">
																<span class="form-tag" style="width:50px;">默认：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="mail_div1" style="margin-left: 58px;"></div>
																</div>
															</div>
															<div class="form-item" style="width: 50%;float:left;display:none;" id="mail2_div">
																<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="mail_div2" style="margin-left: 10px;"></div>
																</div>
															</div>
															
															<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="smsm1_div">
																<span class="form-tag" style="width:50px;">默认：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="smsm_div1" style="margin-left: 58px;"></div>
																</div>
															</div>
															<div class="form-item" style="width: 50%;float:left;display:none;" id="smsm2_div">
																<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="smsm_div2" style="margin-left: 10px;"></div>
																</div>
															</div>
															
															<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="smssvr1_div">
																<span class="form-tag" style="width:50px;">默认：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="smssvr_div1" style="margin-left: 58px;"></div>
																</div>
															</div>
															<div class="form-item" style="width: 50%;float:left;display:none;" id="smssvr2_div">
																<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="smssvr_div2" style="margin-left: 10px;"></div>
																</div>
															</div>
															
															<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="snmp1_div">
																<span class="form-tag" style="width:50px;">默认：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="snmp_div1" style="margin-left: 58px;"></div>
																</div>
															</div>
															<div class="form-item" style="width: 50%;float:left;display:none;" id="snmp2_div">
																<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="snmp_div2" style="margin-left: 10px;"></div>
																</div>
															</div>
															
															<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="syslog1_div">
																<span class="form-tag" style="width:50px;">默认：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="syslog_div1" style="margin-left: 58px;"></div>
																</div>
															</div>
															<div class="form-item" style="width: 50%;float:left;display:none;" id="syslog2_div">
																<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="syslog_div2" style="margin-left: 10px;"></div>
																</div>
															</div>
															
															<div class="form-item" style="float: left;padding: 20px 0 0px;">
																<span class="form-tag" id="AlarmReceiver_span" name="AlarmReceiver_span" style="display:none;width: 100px;float: left;"><em class="imp" id="AlarmReceiver_imp">*</em>信息接收者：</span>
																<div class="h-content3" style="width: 605px;padding-left: 8px;float: left;display:none;padding-top: 0px;padding-bottom: 0px;max-height:76px;" name="label_list" id="label_list">
																	<div class="item" style="padding-top:0px;width:195px;" id="admin_check" name="admin_check">
																		<select class="filter-select" name="admin_select" id="admin_select" style="width:160px;">
																			<option value="0" selected>请选择</option>
																		</select>
																		<i class="ctrl add" style="margin-left: 0px;" onclick="_addadmin(this,1)"></i>
																	</div>
																</div>
																<div class="" style="width: 84.8%;display:none;float:left;max-height:73px;margin-left:72px" id="AlarmReceiver_div" name="AlarmReceiver_div">
																	<label class="form-label" name="AlarmReceiver" id="AlarmReceiver" style="float: left;margin-left:35px;margin-top:3px;">
																		<input class="form-checkbox" type="checkbox" name="AlarmReceiver_check" id="AlarmReceiver_check">
																	</label>
																	<span style="vertical-align:middle;font-size:14px;float: left;margin-top:4px;">自定义：</span>
																	<div class="h-content3" style="padding: 0px;display:none;max-height: 76px;" id="AlarmReceiver_text" name="AlarmReceiver_text">
																		<div id="AlarmReceiver_input" name="AlarmReceiver_input"  class="item" style="padding-top: 0px;width: 260px;">
																				<input type="text" class="form-text" style="width: 193px;">
																				<i class="ctrl add" onclick="_addphone_or_email(this);" style="margin-left: 0px;"></i>
																		</div>
																	</div>
																</div>
																<div class="h-content3" style="width: 605px;padding-left: 8px;float: left;display:none;padding-top: 0px;padding-bottom: 0px;max-height:76px;" name="label_list1" id="label_list1">
																	<div class="item" style="padding-top:0px;width:195px;" id="admin_check1" name="admin_check1">
																		<select class="filter-select" name="admin_select1" id="admin_select1" style="width:160px;">
																			<option value="0" selected>请选择</option>
																		</select>
																		<i class="ctrl add" style="margin-left: 0px;" onclick="_addadmin(this,2)"></i>
																	</div>
																</div>
																<div class="" style="width: 84.8%;display:none;float:left;max-height:73px;margin-left:72px;" id="AlarmReceiver_div1" name="AlarmReceiver_div1">
																	<label class="form-label" name="AlarmReceiver1" id="AlarmReceiver1" style="float: left; margin-left:35px;margin-top:3px;">
																		<input class="form-checkbox" type="checkbox" name="AlarmReceiver_check1" id="AlarmReceiver_check1">
																	</label>
																	<span style="vertical-align:middle;font-size:14px;float: left;margin-top:4px;">自定义：</span>
																	<div class="h-content3" style="padding: 0px;display:none;max-height: 76px;" id="AlarmReceiver_text1" name="AlarmReceiver_text1">
																		<div id="AlarmReceiver_input1" name="AlarmReceiver_input1" class="item" style="padding-top: 0px;width: 260px;">
																			<input type="text" class="form-text" style="width: 193px;">
																			<i class="ctrl add" onclick="_addphone_or_email(this);" style="margin-left: 0px;"></i>
																		</div>
																	</div>
																</div>
															</div>
														</div>						
													</div>
												</div>
												<div class="btns" style="margin-bottom:-20px;">
													<a href="javascript:;" class="btn btn-submit btn-normal">保&nbsp;&nbsp;存</a>
													<a href="javascript:;" class="btn btn-cancel btn-normal">重&nbsp;&nbsp;置</a>
												</div>
											</div>
										</div>
										<!--邮件-->
										<div class="dialog-cont" id="mail_suspend" style="display:none;">
											<div class="c-cont2">
												<div class="c-form" style="padding:0;">
													<div class="form">	
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>配置名称：</span>
															<div class="form-c">
																<input id="SmtpConfigName" name="SmtpConfigName" class="form-text" maxlength="128" type="text" onblur="NameCheck(this);"><i class="v-check"></i>
																<p class="form-tip" style="width: 270px;margin-left: 70px;">特殊字符仅支持下划线、横杠、小数点</p>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>服务器地址：</span>
															<div class="form-c">
																<input id="SmtpServer" name="SmtpServer" class="form-text" type="text" style="width:238px;"  maxlength="128" onblur="IPCheck_DNS(this);"><i class="v-check"></i>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>发送邮箱地址：</span>
															<div class="form-c">
																<input id="SenderEmail" name="SenderEmail" class="form-text" maxlength="128" type="text" onblur="EmailCheck(this);fill_text();"><i class="v-check"></i>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag">服务器账号：</span>
															<div class="form-c">
																<input id="Sender" name="Sender" class="form-text" type="text" style="width: 238px;"  maxlength="128" onblur="fill_text();"><i class="v-check"></i>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>服务器验证：</span>
															<div class="form-c" style="float:left;width:100px;padding: 4px 0 0 8px;">
																<input id="ServerVerify_off" name="ServerVerify" class="form-radio" type="radio" checked="checked">
																<span style="vertical-align:middle;font-size:14px;">否</span>
																<input id="ServerVerify_on" name="ServerVerify" class="form-radio" type="radio">
																<span style="vertical-align:middle;font-size:14px;">是</span>
															</div>
															<div class="form-c" style="float:left;padding: 0px 0 0 0;display:none;">
																<input id="SenderEmailPass" name="SenderEmailPass" class="form-text" type="password" maxlength="128">
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag">附件大小：</span>
															<div class="form-c">
																<input id="AttachMaxLimit" name="AttachMaxLimit" value="0" class="form-text" onblur="NumCheck(this);" type="text" style="width: 34px;padding: 0 3px 0px 3px;" maxlength="9">
																<span style="vertical-align:middle;font-size:14px;">M(应用于邮件报表发送)</span>
															</div>
														</div>
														
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>编码方式：</span>
															<div class="form-c">
																<select class="filter-select" id="EnCode_mail" style="width:90px;">
																	<option value="0">UTF-8</option>
																	<option value="1">GBK</option>
																</select>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>方式：</span>
															<div class="form-c">
																<select class="filter-select" id="Flag_mail" style="width:90px;">
																	<option value="2">默认</option>
																	<option value="1">备用</option>
																	<option value="0">其他</option>
																</select>
															</div>
														</div>
													</div>
												</div>
												<div class="c-form">
													<div class="btns" style="margin-bottom: -20px;">
														<a href="javascript:;" class="btn btn-normal btn-submit" >保&nbsp;&nbsp;存</a>
														<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
													</div>
												</div>
											</div>
										</div>
										<!--短信猫-->
										<div class="dialog-cont" id="smsm_suspend" style="display:none;">
											<div class="c-cont2" style="max-height:416px;">
												<div class="c-form" style="padding-bottom:10px;width: 460px;" id="smsmset">
													<div class="form">	
														<div class="sel-type1" style="float: left;width: 100%;">
															<div class="form-item" style="float:left;">
																<span class="form-tag" style="width: 90px;"><em class="imp">*</em>配置名称：</span>
																<div class="form-c" style="padding: 0 0;">
																	<input id="SmsMConfigName" name="SmsMConfigName" class="form-text" style="width:230px;" type="text" onblur="NameCheck(this);" maxlength="128"><i class="v-check"></i>
																	<p class="form-tip" style="width: 270px;margin-left: 84px;">特殊字符仅支持下划线、横杠、小数点</p>
																</div>
															</div>
															<div class="form-item" style="float:left;">
																<span class="form-tag" style="width: 90px;"><em class="imp">*</em>短信中心：</span>
																<div class="form-c" style="padding: 0 0;">
																	<input id="SmsMSender" name="SmsMSender" class="form-text" type="text" style="width:140px;"  maxlength="32" onblur="NumCheck(this)"><i class="v-check"></i>
																</div>
															</div>
															<div class="form-item" style="float:left;">
																<span class="form-tag" style="width: 93px;"><em class="imp">*</em>发送限制：</span>
																<div class="form-c" style="padding: 0 0;width: 270px;">
																	<span style="vertical-align:middle;font-size:14px;">每月</span>
																	<input id="SmsMLimit" name="SmsMLimit" value="0" class="form-text" onblur="limitCheck(this);" type="text" style="width: 34px;padding: 0 3px 0px 3px;" maxlength="9">
																	<span style="vertical-align:middle;font-size:14px;">条(0为不限制)</span>
																</div>
															</div>
															<div class="form-item" style="float:left;">
																<span class="form-tag" style="width:90px;"><em class="imp">*</em>编码方式：</span>
																<div class="form-c" style="padding:0;">
																	<select class="filter-select" id="EnCode_smsm" style="width:90px;">
																		<option value="0">UTF-8</option>
																		<option value="1">GBK</option>
																	</select>
																</div>
															</div>
															<div class="form-item" style="float:left;">
																<span class="form-tag" style="width:90px;"><em class="imp">*</em>方式：</span>
																<div class="form-c" style="padding:0;">
																	<select class="filter-select" id="Flag_smsm" style="width:90px;">
																		<option value="2">默认</option>
																		<option value="1">备用</option>
																		<option value="0">其他</option>
																	</select>
																</div>
															</div>
															<!--
															
															-->
														</div>
													</div>
												</div>
												<div class="c-form">
													<div class="btns" style="margin-bottom: -20px;">
														<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
														<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
													</div>
												</div>
											</div>
										</div>
										<!--短信网关-->
										<div class="dialog-cont" id="smssvr_suspend" style="display:none;">
											<div class="c-cont2" style="min-height:575px;">
												<div class="c-form" style="padding-bottom:10px;padding: 0;width: 700px;">
													<div class="form">	
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>配置名称：</span>
															<div class="form-c">
																<input id="SmsSvrConfigName" name="SmsSvrConfigName" style="width: 267px;" class="form-text" type="text" onblur="NameCheck(this);"><i class="v-check" maxlength="128"></i>
																<p class="form-tip" style="width: 270px;margin-left: -5px;">特殊字符仅支持下划线、横杠、小数点</p>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>数据库类型：</span>
															<div class="form-c">
																<select name="" id="SmsSvrDBType" class="type-select" style="width:299px">
																	<option value="1">ORACLE</option>
																	<option value="2">MSSQL</option>
																	<option value="3">MYSQL</option>
																	<option value="4">SYBASE</option>
																</select>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>服务器地址：</span>
															<div class="form-c">
																<input id="SmsSvrDBServerIP" name="SmsSvrDBServerIP" class="form-text" type="text" style="width: 124px;" onblur="IPCheck(this);"><i class="v-check" style="margin-top: 9px;" maxlength="64"></i>
																<span style="width: 50px;text-align: right;color: #000;line-height: 28px;"><em class="imp" style="color: #F00;font-style: normal;">*</em>端口：</span>
																<input id="SmsSvrDBPort" name="SmsSvrDBPort" class="form-text" type="text" maxlength="5" style="width: 47px;" onblur="NumCheck(this);"><i class="v-check" style="margin-top: 9px;"></i><p class="form-tip" style="width: 78px;margin-left: 216px;">0-65535之间</p>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>账号：</span>
															<div class="form-c">
																<input id="SmsSvrDBUserName" name="SmsSvrDBUserName" style="width: 267px;" class="form-text" type="text" onblur="NameCheck(this);"maxlength="128"><i class="v-check"></i>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>密码：</span>
															<div class="form-c">
																<input id="SmsSvrDBPassword" name="SmsSvrDBPassword" class="form-text" type="password" style="width: 291px;padding: 0 3px 0px 3px;" maxlength="128">
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>数据库：</span>
															<div class="form-c">
																<input id="SmsSvrDBDatabase" name="SmsSvrDBDatabase" class="form-text" type="text" maxlength="128" style="width: 267px;">
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>短信sql语句模板：</span>
															<div class="form-c">
																<input id="SmsSvrDBInsertTemp" name="SmsSvrDBInsertTemp" class="form-text" type="text" onblur="temp_check(this);" maxlength="1024" style="width: 267px;"><i class="v-check"></i>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag" style=""><em class="imp">*</em>编码方式：</span>
															<div class="form-c" style="">
																<select class="filter-select" id="EnCode_smssvr" style="width:90px;">
																	<option value="0">UTF-8</option>
																	<option value="1">GBK</option>
																</select>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag" style=""><em class="imp">*</em>方式：</span>
															<div class="form-c" style="">
																<select class="filter-select" id="Flag_smssvr" style="width:90px;">
																	<option value="2">默认</option>
																	<option value="1">备用</option>
																	<option value="0">其他</option>
																</select>
															</div>
														</div>
													</div>
												</div>
												<div class="btns" style="margin-bottom:-20px;">
													<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
													<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
												</div>
											</div>
										</div>
										<!--SNMP-->
										<div class="dialog-cont" id="snmp_suspend" style="display:none;">
											<div class="c-cont2" style="max-height: 416px;">
												<div class="c-form" style="padding-bottom:10px;padding: 0;width: 650px;" id="snmpset">
													<div class="form">	
														<div class="sel-type1" style="float: left;width: 100%;">
															<div class="form-item" style="">
																<span class="form-tag" style=""><em class="imp">*</em>配置名称：</span>
																<div class="form-c" style="">
																	<input id="SnmpConfigName" name="SnmpConfigName" class="form-text" maxlength="128" style="width:235px;" type="text" onblur="NameCheck(this);"><i class="v-check"></i>
																	<p class="form-tip" style="width: 270px;margin-left: -5px;">特殊字符仅支持下划线、横杠、小数点</p>
																</div>
															</div>
															<div class="form-item" style="">
																<span class="form-tag" style=""><em class="imp">*</em>服务器地址：</span>
																<div class="form-c" style="">
																	<input id="SnmpServerIP" name="SnmpServerIP" class="form-text" type="text" style="width:125px;"  maxlength="64" onblur="IPCheck(this);"><i class="v-check"></i>
																</div>
															</div>
															<div class="form-item" style="">
																<span class="form-tag" style=""><em class="imp">*</em>端口：</span>
																<div class="form-c" style="">
																	<input id="SnmpPort" name="SnmpPort" class="form-text" type="text" maxlength="5" onblur="PortCheck(this);" style="width: 58px;"><i class="v-check"></i>
																	<p class="form-tip" style="width: 270px;margin-left: -5px;">0-65535之间</p>
																</div>
															</div>
															<div class="form-item">
																<span class="form-tag" style=""><em class="imp">*</em>编码方式：</span>
																<div class="form-c" style="">
																	<select class="filter-select" id="EnCode_snmp" style="width:90px;">
																		<option value="0">UTF-8</option>
																		<option value="1">GBK</option>
																	</select>
																</div>
															</div>
															<div class="form-item">
																<span class="form-tag" style=""><em class="imp">*</em>方式：</span>
																<div class="form-c" style="">
																	<select class="filter-select" id="Flag_snmp" style="width:90px;">
																		<option value="2">默认</option>
																		<option value="1">备用</option>
																		<option value="0">其他</option>
																	</select>
																</div>
															</div>
															<!--
															
															-->
														</div>
													</div>
												</div>
												<div class="c-form">
													<div class="btns" style="margin-bottom:-20px;">
														<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
														<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
													</div>
												</div>
											</div>
										</div>
										<!--SYSLOG-->
										<div class="dialog-cont" id="syslog_suspend" style="display:none;">
											<div class="c-cont2" style="max-height:416px;">
												<div class="c-form" style="padding-bottom:10px;padding:0;width: 680px;" id="syslogset">
													<div class="form">	
														<div class="sel-type1" style="float: left;width: 100%;">
															<div class="form-item" style="">
																<span class="form-tag" style=""><em class="imp">*</em>配置名称：</span>
																<div class="form-c" style="">
																	<input id="SyslogConfigName" name="SyslogConfigName" maxlength="128" class="form-text" style="width:230px;" type="text" onblur="NameCheck(this);"><i class="v-check"></i>
																	<p class="form-tip" style="width: 270px;margin-left: -5px;">特殊字符仅支持下划线、横杠、小数点</p>
																</div>
															</div>
															<div class="form-item" style="">
																<span class="form-tag" style=""><em class="imp">*</em>服务器地址：</span>
																<div class="form-c" style="">
																	<input id="SyslogServerIP" name="SyslogServerIP" class="form-text" type="text" style="width:125px;"  maxlength="64" onblur="IPCheck(this);"><i class="v-check"></i>
																</div>
															</div>
															<div class="form-item" style="">
																<span class="form-tag" style=""><em class="imp">*</em>端口：</span>
																<div class="form-c" style="">
																	<input id="SyslogPort" name="SyslogPort" class="form-text" type="text" maxlength="5" onblur="PortCheck(this);" style="width: 58px;"><i class="v-check"></i>
																	<p class="form-tip" style="width: 270px;margin-left: -5px;">0-65535之间</p>
																</div>
															</div>
															<div class="form-item">
																<span class="form-tag" style=""><em class="imp">*</em>编码方式：</span>
																<div class="form-c" style="">
																	<select class="filter-select" id="EnCode_syslog" style="width:90px;">
																		<option value="0">UTF-8</option>
																		<option value="1">GBK</option>
																	</select>
																</div>
															</div>
															<div class="form-item">
																<span class="form-tag" style=""><em class="imp">*</em>方式：</span>
																<div class="form-c" style="">
																	<select class="filter-select" id="Flag_syslog" style="width:90px;">
																		<option value="2">默认</option>
																		<option value="1">备用</option>
																		<option value="0">其他</option>
																	</select>
																</div>
															</div>
															<!--
															
															-->
														</div>
													</div>
												</div>
												<div class="c-form">
													<div class="btns" style="margin-bottom:-20px;">
														<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
														<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
													</div>
												</div>
											</div>
										</div>
										
										
										<!--指令-->
										<div class="dialog-cont" id="cmd_suspend" style="display:none;">
											<div class="container">
												<div class="c-cont2">
													<div class="c-form" style="padding:0px;">
														<div class="form">
															<div class="form-item">
																<span class="form-tag"><em class="imp">*</em>名称：</span>
																<div class="form-c">
																	<input id="CmdSetName" type="text" class="form-text" onblur="NameCheck(this)" maxlength="128"/><i class="v-check"></i>
																	<p class="form-tip">特殊字符仅支持下划线、横杠、小数点</p>
																</div>
															</div>

															<div class="form-item">
																<span class="form-tag">描述：</span>
																<div class="form-c">
																	<input id="Description_cmd" type="text" class="form-text" maxlength="128"/><i class="v-check"></i>
																</div>
															</div>

															<div class="form-item">
																<span class="form-tag"><em class="imp">*</em>指令：</span>
																<div class="form-c">
																	<textarea id="Content_cmd" class="form-textarea" name="" id="Content" cols="30" rows="10"></textarea>
																</div>
																 <div style="float:left;margin-left:195px"><span class="form-tip">多个指令请使用换行符分隔<br /><span class="form-tip">&lt;match&gt;通>配符</span><span class="form-tip">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;nmatch&gt;取非</span><br/><span class="form-tip">&lt;regex&gt;正则表达式匹配</span><span class="form-tip">&lt;nregex&gt;取非</span><br /><span class="form-tip">&lt;include&gt;包含匹配</span><span class="form-tip">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ninclude&gt;取非</span><br /><span class="form-tip">&lt;equ&gt;完全匹配</span><br /><span class="form-tip">默认为包含匹配，增加如下例子的匹配方式，表示包含ls和-al，花括号需单独占一行：</span><br/><span class="form-tip">{</span><br /><span class="form-tip">ls</span><br /><span class="form-tip">-al</span><br /><span class="form-tip">}</span></span></div>
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="btns" style="margin-bottom: -20px;">
												<a href="javascript:;" class="btn btn-normal btn-submit" >保&nbsp;&nbsp;存</a>
												<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
											</div>
										</div>
									</div>
				                </div>
				            </div>
				        </div>
						<div class="clearfix"></div>
						<div class="btns add">
							<a href="javascript:;" class="btn btn-normal" onclick="next()" id="nextstep">下一步</a>
							<!--a href="javascript:;" class="btn btn-normal" onclick="cancle()">取&nbsp;&nbsp;消</a-->
						</div>
					</div>
				</div>
			</div>
			<div id="bBtn" style="z-index: 5;">
				<a href="javascript:;" class="btn" onclick="show_list(1);"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
			</div>
		</div>
		
	</div>
	<form action="/bhost/access_user_index" method="POST" name="frm_access">
			<input type="hidden" name="tasktype" id = "tasktype" value="{{ tasktype }}" />
			<input type="hidden" name="user" id = "user" value="" />
			<input type="hidden" name="page" id = "page" value="{{ page }}" />
			<input type="hidden" name="id" id = "id" value="{{ id }}" />
			<input type="hidden" name="name" id = "name" value="{{ name }}" />
			<input type="hidden" name="type" id = "type" value="{{ type }}" />
			<input type="hidden" name="a0" id = "a0" value="" />
			<input type="hidden" name="z1" id = "z1" value="{{manage_filter_flag}}" />
			<input type="hidden" name="z2" id = "z2" value="" />
			<input type="hidden" name="us" id = "us" value="" />
			<input type="hidden" name="se" id = "se" value="" />
	</form>
<!--script-->
<script src="/manage/js/jquery.min.js"></script>
<script src="/manage/js/jquery.easing.js"></script>
<script src="/manage/js/layer.js"></script>
<script src="/manage/js/common.js"></script>
<script src="/manage/js/common_e.js"></script>
<script src="/manage/js/xSelect.js"></script>
<script src="/manage/js/base64.js"></script>

<!--icheck-->
<script src="/manage/js/icheck.min.js"></script>

<style>
.select2-container--open {
	z-index: 9999999;
}

.c-col2 .ss-cont .item {
	width:183px;
}
.ui-dialog-body{
	padding: 20px 0 20px 0;
}
#mail_suspend span.form-tag{
	width: 275px;
}
.form-tag_change{
	width:137px;
}
.form-c_change{
	padding: 0;
	margin-left:144px;
}
.form-label {
	padding-right: 20px;
	margin-top: 5px;
}
.form-li {
	float: right;
	margin-top: 2px;
}
</style>

<script>
	
	$('.form-checkbox,.form-radio').iCheck({
		checkboxClass: 'icheckbox_minimal-blue',
	    radioClass: 'iradio_minimal-blue',
	    increaseArea: '0' // optional
	});
	$('.ss input').iCheck({
		checkboxClass: 'icheckbox_minimal-blue',
	    radioClass: 'iradio_minimal-blue',
	    increaseArea: '0' // optional
	});
</script>

<!--select2-->
<script src="/manage/js/select2.full.min.js"></script>

<script>
$('.filter-select,.form-select,.type-select').select2({minimumResultsForSearch: -1});
$("#manager_select").select2();
</script>

<!---->
<script>
var manager_arry=['-1'];
function change_manager(obj){
	var t = $(obj).children('option:selected').val();
	if (manager_arry.indexOf(t) === -1 && t != undefined){
		manager_arry.splice(0,1,t);
	}
	if ($(obj).children('option').length == 2 && t != '-1'){
		$(obj).parent().children('i.add').click();
		$(obj).parent().hide();
	}
}

function _addmanager(obj){
	var add = 0;
	var name2 = $("#manager_select").children('option:selected').val();
	var t = $(obj).parent().children('select').children('option[value='+name2+']').text();
	if (name2 == undefined){
		$(obj).parent().children('select').val('-1').trigger('change');
		return false;
	}	
	if (name2 == -1){
		_alert(2,"指令授权","请选择管理者");
		return;
	} 
	manager_arry.splice(0,0,'-1');
	m_index_all.splice($.inArray(parseInt(name2),m_index_all),1);
	var $c = $(obj).parent();
	var d = $('select>option:first',$c).val();
	$c.children('select').val(d);
	$c.children('select').find('option[value='+name2+']').remove();
	var $s = $('<li class="item"><input type="text" class="form-text" id="'+name2+'" value="'+t+'" style="width:88px;" disabled="true"><i class="ctrl del" onclick="_del_morc(this,1)"></i></li>');
	$c.after($s);
}

function _del_frame(obj,data,arry){
	$(obj).children('select').children('option').remove();
	$(obj).children('select').append('<option value=\"-1\">请选择</option>');
	if (data[0].CmdSetId != undefined){
		$.each(data,function(i1,item1){
			$(obj).children('select').append('<option value="'+item1.CmdSetId+'">'+item1.Name+'</option>');
		});
	}else if (data[0].UserId != undefined){
		$.each(data,function(i1,item1){
			$(obj).children('select').append('<option value="'+item1.UserId+'">'+item1.UserCode+'</option>');
		})
	}
	$.each(arry,function(i2,item2){
		if (item2 != '-1' && i2 != 0){
			$(obj).children('select').children('option[value='+item2+']').remove();
		}
	});
	$(obj).children('select').val(arry[0]).trigger('change');
}

function _del_morc(obj,type){
	var $c = $(obj).parent();
	var id = $c.children('input').attr('id');
	var t = $(obj).siblings('input').val();
	var v,data,max;
	var min = 0;
								if (type == 1){
		max = m_index_all.length-1;
		$("#manager_select").parent().show();
		manager_arry.splice($.inArray(id,manager_arry),1);
		data = m_index_all;
		$p = $("#manager_select");
	}else if (type == 2){
		max = cmd_index_all.length-1;
		$("#cmd").parent().show();
				cmdset.splice($.inArray(id,cmdset),1);
		data = cmd_index_all;
		$p = $("#cmd");
	}
	$c.remove(); 
	if (max < 0){
		var index_1 = -1;
	}else{
		var index_1 = search_i(min, max, id, data);
	}
	//var index_1 = search_i(min,max,id,data);
	index_1 = parseInt(index_1);
			if (index_1 == -1){
		index_1 = max + 1;
		$p.append('<option value="'+id+'">'+t+'</option>');
	}else if (index_1 == -2){
		index_1 = 0;
		$p.children('option').eq(0).after('<option value="'+id+'">'+t+'</option>');
	}else {
		$p.children('option[value='+data[index_1]+']').before('<option value="'+id+'">'+t+'</option>');
	}
	if (type == 1){
						m_index_all.splice(index_1,0,parseInt(id));
			}else if(type == 2){
		cmd_index_all.splice(index_1,0,parseInt(id));
	}
}

function search_i(min,max,id,data){
	var mid,res;
	if (data[max] < id){
		return -1;
	}
	if (data[min] > id){
				return -2;
	}
	while (min <= max){
		mid = parseInt((min+max)/2);
				if (data[mid] > id){
			max = mid - 1;
			res = mid;
		}else{
			min = mid + 1;
		}
	}
	return res;
}
/*
function search_index(min,max,id,data){
	var mid;
	while (min <= max){
		if (data[min] == id){
			return min;
		}
		if (data[max] == id){
			return max;
		}
		mid =  Math.ceil((min+max)/2);
		if (data[mid] == id){
			return mid;
		}else if (data[mid] > id){
			max = mid - 1;
		}else{
			min = mid + 1;
		}
	}
	return false;
}
*/


function _del(obj){
	var id = $(obj).parent().children('input').attr('id');
	var $c = $(obj).parent();
	var $p = $(obj).parent().parent().children('li:first');
	var type = $(obj).parent().parent().attr('id');
	$c.remove(); 
	if (type == "contlist"){
		$("#manager_select").parent().show();
		manager_arry.splice($.inArray(id,manager_arry),1);
		_del_frame($p,mdata,manager_arry);
	}else if (type == "xx"){
		$("#cmd").parent().show();
		cmdset.splice($.inArray(id,cmdset),1);
		_del_frame($p,cmd_data.data,cmdset);
	}
}

var cmdauthdata={
        "CmdAuthId": 0,
        "CmdAuthName": "",
        "CmdAuthType": 2,//1-按用户/目标配置，2-按访问授权配置，3-按工单配置
        "Action": 1, //动作
        "AuthProtocolId": null,//协议
        "AuthAccountId": null,//账号 
        "AuthConnParamId": null,//连接参数
        "Enabled": true,//是否启用
        "ResponseMode": 4,
        "SQLLimitTime": 0, 
        "ApproveStrategyId": null,
        "EventAlarmInfoId": null,              
		"AuthCmdSet": [],   //指令集合id                                                     
        "AdminSet": [],    //管理员
		"AuthObjectSet": [],     // --CmdAuthType=2,
		"LoginUserCode": "123"
}
var flog=0;
var savestep1 = {
	"name":"",
	"Enable":true,
	"admin":[],
	"AccessAuthId":[]
};
var savestep2={
	"action":1,
	"cmd_all":[],
	"respone":0,
	"mode":1,
	"woring":null,
	"approve":null
};

var cmdsave=0;
//var namecheck = /^[_\-.\n\w\u4e00-\u9fa5]*$/;
function to(page)
{
	if(page==1)
	{
		up();
	}
	else
	{
		next();
	}
}
function _addFilter(obj){
	var v1 = $(obj).parent().children('select').children('option:selected').text();
	var v2 = $(obj).parent().children('input[type=text]').val().trim();
	if(v2 == ''){
		layer.alert('请输入关键字',{icon:2});
		return;
	}else{
		$('#filterWW>ul').append('<li><span class="ww">'+v1+'-'+v2+'</span><i class="del" onclick="_delFilter(this)"></i></li>')
		selView();
	}
	
}

function _delFilter(obj){
	$(obj).parent().remove();
	selView();
}

function selView(){
	var $sel = $('#filterWW');
	var len = $('li',$sel).length;

	if(len == 0){
		$sel.hide();
	}else if(len == 1){
		$('>span.ww',$sel).hide();
		$sel.removeClass('selector-multiple').show();
	}else{
		$('>span.ww',$sel).show();
		$sel.addClass('selector-multiple');
	}
}
</script>

<script>

/*
var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
function nameCheck(obj){
	var val = $(obj).val();
	var $i = $(obj).next('i.v-check')

	if(nameReg.test(val)){
		$i.show().attr('class','v-check v-right');
	}else{
		$i.show().attr('class','v-check v-wrong');
	}
}
*/
var se;
var usercode;
var selectid = {{selectid|safe}};
var manage_auth_array = [];
var access_auth_array = [];
var $focusObj_c;
$(function(){
	$("#Enable").iCheck('uncheck');
	if(document.frm_access.tasktype.value==3)
	{
	}else{
		$("#Enable").iCheck('check');
	}
	$('.xSelect').on('click', '.xSelect-show', function () {
		$focusObj_c = $(this).parents('.xSelect');
	});
	$.each(window.parent._power,function(i,item){
		if (item.Mode == 2){
			manage_auth_array.push(item.SubMenuId);
		}else{
			access_auth_array.push(item.SubMenuId);
		}
	});
	
	$(".cmdauth_access").on('click',function(){
		//show_list(1);
		if (document.frm_access.tasktype.value==1){
			document.frm_access.action = '/bhost/cmdAuth_show_a';
			document.frm_access.submit();
		}else{
			document.frm_access.z2.value=JSON.stringify(selectid);
			document.frm_access.action = '/bhost/cmdAuth_show_a';
			document.frm_access.submit();
		}
	});
	se = window.parent.document.frm.se.value;
	usercode = window.parent.document.frm.us.value;
    cmdauthdata.LoginUserCode = usercode;
	get_cont_list();
	get_access_way();
	
	//事件告警信息
	bind_alarm_xSelect();
	
	//审批策略
	bind_approval_xSelect();
	
	//指令集合
	bind_cmd_xSelect();
	
	
	if(document.frm_access.tasktype.value==3)
	{
		set_alldata();
				$("#ManageAuthName").val(savestep1.name);
		$("#ManageAuthName").attr("disabled",true);
				$.each(savestep1.admin,function(j,xitem){
						$("#manager_select").val(xitem).trigger('change');
			if (j != savestep1.admin.length-1){
				$("#manager_select").parent().children('i').click();
			}
			/*
			if (j != mdata.length-1){
				$("#manager_select").parent().children('i').click();
			}
			*/
		})
		$("#access_way input[type=checkbox]").each(function(i,item){
			$.each(savestep1.AccessAuthId,function(j,xitem){
				if($(item).val()==xitem)
				{
					$(item).iCheck('check');
				}
			})
		})
		if(savestep1.Enable==true)
		{
			$("#Enable").iCheck('check');
		}else{
			$("#Enable").iCheck('uncheck');
		}
	}else{
		$("#Enable").iCheck('check');
		/*
		$.each(mdata,function(i,item){
			if (item.UserCode == usercode){
				$("#manager_select").val(item.UserId).trigger('change');
				//$("#manager_select").parent().children('i.add').click();
			}
		})*/
	}
	$('.g-tsel').on('click',function () {
		var this_id=$(this).attr('id');
		var this_class=$(this).attr('class');
				if (this_class == "g-tsel"){
			$(this).children('input').focus().select();
		}
	});
	_initSize();
});
//告警事件
function bind_alarm_xSelect(){
	get_warning_all();
	var alarm_array = [];
	$.each(edata.data,function(i,item){
		if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(32) != -1){
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'edit'
			};
		}else{
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'check'
			};
		}
		select_data_json.value = item.EventAlarmInfoId;
		select_data_json.name = item.Name;
		alarm_array.push(select_data_json);
	});
	if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(32) != -1){
		$('#EventAlarmInfoId').xSelect({
			width: 192,
			defaultText: '请选择',
			items:alarm_array,
			module_type:'alarm',
			edit: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode3(obj,1);
			},
			btn:[
				{
					'name':'新增',
					'event': function(items,obj){
												$(obj).parents('.xSelect-view').hide();
						_editNode3(obj,2);
					}
				}
			]
		});
	}else{
		$('#EventAlarmInfoId').xSelect({
			width: 192,
			defaultText: '请选择',
			items:alarm_array,
			module_type:'alarm',
			check: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode3(obj,1);
			}
		});
	}
	
}

//审批策略
function bind_approval_xSelect(){
	get_ApproveStrategy();
	var approve_array = [];
	$.each(appdata.data,function(i,item){
		if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(32) != -1){
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'edit'
			};
		}else{
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'check'
			};
		}
		select_data_json.value = item.ApproveStrategyId;
		select_data_json.name = item.ApproveStrategyName;
		approve_array.push(select_data_json);
	});
	
	if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(32) != -1){
		$('#EnableApprove').xSelect({
			width: 192,
			defaultText: '请选择',
			items:approve_array,
			module_type:'approve',
			edit: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode4(obj,1);
			},
			btn:[
				{
					'name':'新增',
					'event': function(items,obj){
												$(obj).parents('.xSelect-view').hide();
						_editNode4(obj,2);
					}
				}
			]
		});
	}else{
		$('#EnableApprove').xSelect({
			width: 192,
			defaultText: '请选择',
			items:approve_array,
			module_type:'approve',
			check: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode4(obj,1);
			}
		});
	}
	
}

function bind_cmd_xSelect(){
	var cmd_array = [];
	cmd_index_all = [0];
	cmd_array.push({'value':-1,'name':"请选择",'type':null});
	$.ajax({
		url:"/bhost/get_cmd_all_x",
		type:"POST",
		async:false,
		data:{a0:se},
		success:function(result){ 
			var cmd_result = JSON.parse(result);
			$.each(cmd_result.data,function(i,item){
				if ($("#cmd").data('value') == item.CmdSetId){
					
				}else{
					if (cmdset.indexOf(item.CmdSetId) > -1){
						return true;
					}
				}
				if (manage_auth_array.indexOf(17) != -1){
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'edit'
					};
				}else{
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'check'
					};
				}
				select_data_json.value = item.CmdSetId;
				select_data_json.name = item.Name;
				cmd_array.push(select_data_json);
				cmd_index_all.push(item.CmdSetId);
			});
		}
	});
	if (manage_auth_array.indexOf(17) != -1){
		$('#cmd').xSelect({
			width: 140,
			defaultText: '请选择',
			items:cmd_array,
			module_type:'cmd',
			edit: function(item,obj){
				$(obj).parents('.xSelect-view').hide();
				_editNode(obj,1);
			},
			btn:[
				{
					'name':'新增',
					'event': function(items,obj){
						$(obj).parents('.xSelect-view').hide();
						_editNode(obj,2);
					}
				}
			],
			setval:function(item,obj){
				change_cmd(obj);
			}
		});
	}else{
		$('#cmd').xSelect({
			width: 140,
			defaultText: '请选择',
			items:cmd_array,
			module_type:'cmd',
			check: function(item,obj){
				$(obj).parents('.xSelect-view').hide();
				_editNode(obj,1);
			},
			setval:function(item,obj){
				change_cmd(obj);
			}
		});
	}
	
}

$(window).resize(function(){
    _initSize();
});

function _initSize(){
    var h = $(window).height();
    $('.h-catelog').height(h-221);
    $('.h-content2').height(h-280);
	//$('.ss-cont').height(h-280-30);
	//$('.h-explorer3').height($('.c-cont2').height() - 20);
	$('.h-catelog3').width($('.h-explorer3').width()-332);
}
function show_list(type,CmdAuthId){
	if(document.frm_access.tasktype.value==1)
	{
	document.frm_access.tasktype.value=3;
	document.frm_access.se.value=se;
	document.frm_access.us.value=usercode;
	document.frm_access.action = '/bhost/index';
	document.frm_access.submit();
	}
	else
	{
		if (type == 2){
			document.frm_access.name.value = "";
			document.frm_access.type.value = "";
			if (document.frm_access.tasktype.value==3){
				$.ajax({
					url:'/bhost/get_index',
					type:'post',
					async:false,
					data:{a0:se,z1:document.frm_access.id.value,z2:10},
					success:function(result){
						document.frm_access.page.value = Math.ceil(parseInt(result)/MAX_PAGE);
					}
				});
			}else{
				$.ajax({
					url:'/bhost/get_index',
					type:'post',
					async:false,
					data:{a0:se,z1:CmdAuthId,z2:10},
					success:function(result){
						document.frm_access.page.value = Math.ceil(parseInt(result)/MAX_PAGE);
					}
				});
			}
		}
		document.frm_access.a0.value=se;
		document.frm_access.tasktype.value=4;
		document.frm_access.z2.value=JSON.stringify(selectid);
		document.frm_access.action = '/bhost/cmdAuth_show_a';
		document.frm_access.submit();
	}
}
function get_access_way()
{
	$("#access_way").empty();
	$.ajax({
	        url:"/bhost/get_access_way_x",
	        type:"POST",
	        async:false,
	        data:{a0:se},
	        success:function(result){ 
	            var access_result = JSON.parse(result);
	        	if(access_result.Result == false){
					_alert(2,"指令授权","执行失败：" + access_result.ErrMsg);
					return false;
				}
				else{
				$.each(access_result.data,function(i,item){
					$("#access_way").append('<div class="item" style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;"><label><input type="checkbox" name="" value="'+item.AccessAuthId+'">'+item.AccessAuthName+'</label></div>');
					})
	            }
	   		}
			})
		$('.ss input').iCheck({
		checkboxClass: 'icheckbox_minimal-blue',
	    radioClass: 'iradio_minimal-blue',
	    increaseArea: '0' // optional
		});
}
var mdata;
var m_index_all = [];
var admin_1=window.parent.document.frm.us.value;
function get_cont_list()//获取管理员
{
	
	$.ajax({
		url: '/bhost/get_manager_z',
		type: 'post',
		async: false,
		data: { a0: se,a1:admin_1,a2:3 },
		success: function (result) {
			mdata = JSON.parse(result);
			if (mdata.Result == false) {
				_alert(1, "指令授权", "执行失败：" + mdata.info);
				return false;
			} else {
				$("#manager_select").append('<option value="-1">请选择</option>');
				$.each(mdata, function (i, item) {
					if (item.UserCode == 'admin' && item.UserCode != window.parent.document.frm.us.value){
						return true;
					}
					if (item.UserCode == admin_1){
						return true;
					}
					/*$.ajax({
						url: '/bhost/IsAllowToManageAuth',
						type: 'post',
						async: false,
						data: { a0: se, a1: item.UserId, a2: userid},
						success: function (result) {
							if(result == 1){*/
								$("#manager_select").append('<option value="' + item.UserId + '">' + item.UserCode + '</option>');
								m_index_all.push(item.UserId);
							/*}
						}
					})*/
				});
			}
		}
	});
}
function next(){//下一步
	var f=0;
	if(flog==0)
	{
		savedata1();
		if(savestep1.name=="")
		{
			_alert(2,"指令授权","请输入授权名称",$("#ManageAuthName"));
			return false;
		}
		if(!nameReg.test(savestep1.name))
		{
			_alert(1,"指令授权","授权名称格式不正确",$("#ManageAuthName"));
			return false;
		}
		/*
		if(savestep1.admin.length==0)
		{
			_alert(2,"指令授权","请选择管理者");
			return false;
		}*/
		if(savestep1.AccessAuthId.length==0)
		{
			_alert(2,"指令授权","请选择访问授权");
			return false;
		}
		if(document.frm_access.tasktype.value!=3)
		{
		$.ajax({
	        url:"/bhost/check_name",
	        type:"POST",
	        async:false,
	        data:{a0:se,a1:savestep1.name},
	        success:function(result){ 
	        	if(result!= 0){
					f=1;
					_alert(1,"指令授权","相同的授权名称已存在",$("#ManageAuthName"));
					return false;
				}
			}
			})
		}
	
	}
	if(f==1)
	{
		return false;
	}
	flog++;
	if(flog==1)
	{
		if(cmdsave!=1)
		{
			get_cmd_all();
						if(document.frm_access.tasktype.value==3)
			{
								$("input:radio[name='action']").each(function()
				{
					if($(this).val()==savestep2.action)
					{
												$(this).iCheck('check');;
					}

				})
				$("input:checkbox[name='response']").each(function()
				{
					if($(this).val()==savestep2.mode)
					{
												$(this).iCheck('check');;
					}

				})
				if(savestep2.mode==8)
				{
					//get_ApproveStrategy();
					$("#ApproveStrategy_massage").show();
					//$("#EnableApprove").val(savestep2.approvename);
					if (savestep2.approve != null){
						$("#EnableApprove").find('span').text(savestep2.approvename);
						$("#EnableApprove").data('value',savestep2.approve);
					}
				}
				if(savestep2.respone==1)
				{
					$("#warning_checkbox").iCheck("check");
					//get_warning_all();
					$("#warning_massage").show();
					//$("#EventAlarmInfoId").val(savestep2.woringname);
					if (savestep2.woring != null){
						$("#EventAlarmInfoId").find('span').text(savestep2.woringname);
						$("#EventAlarmInfoId").data('value',savestep2.woring);
					}
				}else{
					$("#warning_checkbox").iCheck("uncheck");
					$("#warning_massage").hide();
				}
				//$("input:radio[name=\"action\"][value='"+savestep2.action+"']").prop("checked", "checked");
			}
		}
		$("#c-exp").hide();
		$('#step').empty();
		$("#c-exp3").show();
		$(".btns.add").prepend("<a href=\"javascript:;\" class=\"btn btn-normal\" onclick=\"up()\" id=\"upstep\">上一步</a>");
		$('#step').append("<li onclick=\"to(1)\">访问授权</li><li style=\"width:146px\" class=\"active\">指令集合/响应方式</li>");
		$("#frist").css("background-color","rgba(222, 222, 222, 0)");
		
		$("#warning_checkbox,input:checkbox[name=response]").iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		})
		$("#warning_checkbox").on("ifClicked",function(){
									$(".xSelect-alarm").hide();
			$('div[data-id=xSelect-alarm]').removeClass('on');
			$(".xSelect-approve").hide();
			$('div[data-id=xSelect-approve]').removeClass('on');
			if($(this).prop("checked") == false)
			{
				get_warning_all();
				$("#warning_massage").show();
			}
			else{
				var check_radio = 0;
				$('input:checkbox[name="response"]').each(function(i,item){
					if ($(item).prop('checked') && $(item).val() != 0){
						check_radio = 1;
						return false;
					}
				})
								if (check_radio == 0){
					_alert(2,"指令授权","请至少选择一种响应方式");		
					/*
					$("#warning_checkbox").toggle(
						function(){
							$("#warning_checkbox").iCheck("check");
						}
					);
					*/
					setTimeout(function() {
						  $("#warning_checkbox").iCheck("check");
					}, 0)
					return false;
				}
								$(this).iCheck('uncheck');
				$("#warning_massage").hide();
			}
		})
		$("#Blocke").on("ifChanged",function(){
						if (!$("#Blocke").prop("checked")){
				if ($("#response_check").find('input:checked').length == 0){
					_alert(2,"指令授权","请至少选择一种响应方式");
					setTimeout(function() {
						  $("#Blocke").iCheck("check");
					}, 0)
					return false;
				}
			}else{
				$("#ignore").iCheck('uncheck');
				$("#insapp").iCheck('uncheck');
			}
		});
		$("#ignore").on("ifChanged",function(){
						if (!$("#ignore").prop("checked")){
				if ($("#response_check").find('input:checked').length == 0){
					_alert(2,"指令授权","请至少选择一种响应方式");
					setTimeout(function() {
						  $("#ignore").iCheck("check");
					}, 0)
					return false;
				}
			}else{
				$("#Blocke").iCheck('uncheck');
				$("#insapp").iCheck('uncheck');
			}
		});
		$("#insapp").on("ifChanged",function(){
			$(".xSelect-alarm").hide();
			$('div[data-id=xSelect-alarm]').removeClass('on');
			$(".xSelect-approve").hide();
			$('div[data-id=xSelect-approve]').removeClass('on');
						if (!$("#insapp").prop("checked")){
				if ($("#response_check").find('input:checked').length == 0){
					_alert(2,"指令授权","请至少选择一种响应方式");
					setTimeout(function() {
						  $("#insapp").iCheck("check");
					}, 0)
					return false;
				}
				$("#ApproveStrategy_massage").hide();
			}else{
				get_ApproveStrategy();
								$("#ApproveStrategy_massage").show();
				$("#ignore").iCheck('uncheck');
				$("#Blocke").iCheck('uncheck');
			}
		});
		/*
		$('input:radio[name="response"]').on("ifClicked",function(){
			var response= parseInt($(this).val());
			if ($(this).prop("checked")){
				if (!$("#warning_checkbox").prop("checked")){
					_alert(2,"指令授权","请至少选择一种响应方式");
					return;
				}
				if(response == 8)
				{
					$("#ApproveStrategy_massage").hide();
				}
								$(this).iCheck("uncheck");
							}else{
				if(response == 8)
				{
					get_ApproveStrategy();
					$("#ApproveStrategy_massage").show();
					$("#ApproveStrategy").val(0).trigger('change');
				}
				else{
					$("#ApproveStrategy_massage").hide();
				}
				if (response == 0){
					if (!$("#warning_checkbox").prop("checked")){
						$("#warning_checkbox").iCheck("check");
						get_warning_all();
						$("#warning_massage").show();
					}						
				}
								$(this).iCheck("check");
							}
		})
		*/
		var power_flag = 0;
		$.each(window.parent._power,function(i,item){
			if (item.SubMenuName == "指令授权" && item.Mode == 1){
				power_flag = 1;
				$("#nextstep").hide();
				return false;
			}
		});
		if (power_flag == 0){
			$("#nextstep").html('保&nbsp;&nbsp;存');
		}
	}
	if(flog==2)
	{
		savedata2();
		if(savestep2.cmd_all.length==0)
		{
			_alert(2,"指令授权","请选择指令集合或手动输入指令");
			flog--;
			return false;
		}
		if(savestep2.respone==1)
		{
			if ($("#EventAlarmInfoId").data('value') == undefined){
				flog--;
				_alert(2,"指令授权","请选择告警信息");
				return false;
			}
			savestep2.woring = $("#EventAlarmInfoId").data('value');
		}

		if(savestep2.mode==8&&savestep2.approve==0)
		{
			if ($("#EnableApprove").data('value') == undefined){
				_alert(2,"指令授权","请选择审批策略");
			}else{
				_alert(1,"指令授权","该审批策略不存在");
			}
			flog--;
			return false;
		}
		savedata_all();
		var msstr = aceg(JSON.stringify(cmdauthdata),se);
				$.ajax({
	        url:"/bhost/save_cmdauth_all_x",
	        type:"POST",
	        async:false,
	        data:{a0:se,a1:JSON.stringify(cmdauthdata),a2:Content_str,m1:msstr},
	        success:function(result){ 
	            var cmdauthdata_result = JSON.parse(result);
				if(cmdauthdata_result.Result)
				{
					$('.btn').blur();
					parent.layer.open({
					type:1,
					title:"指令授权",
					content:'<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
					btn:'确&nbsp;&nbsp;定',
					btnAlign:'c',
					closeBtn: false,
					skin:'layer-custom',
					area:['380px','310px'],
					move: false,
					resize: false,
					btn1:function(i){
						parent.layer.close(i);
						show_list(2,cmdauthdata_result.CmdAuthId);
						}
					});
				
				}
				else
				{
					_alert(1,"指令授权","执行失败：" + cmdauthdata_result.ErrMsg);
					flog--;
				}
			}
		})
	}
}
function up()//上一步
{
	if(flog==1)
	{
		cmdsave=1;
	}
	flog--;
	if(flog==0)
	{
		//get_cmd_all();
		$("#c-exp").show();
		$('#step').empty();
		$("#c-exp3").hide();
		$("#upstep").remove();
		$('#step').append("<li class=\"active\">指令授权</li><li style=\"width:146px\" onclick=\"to(2)\">指令集合/响应方式</li>");
		$("#nextstep").html('下一步');
		$("#nextstep").show();
		$("#manager_select").select2();
	}
	_initSize();
}

function savedata2()//保存第2步数据
{
	savestep2.woring=null;
	savestep2.approve=null;
	savestep2.cmd_all.splice(0,savestep2.cmd_all.length);
	savestep2.action=parseInt($('input:radio[name="action"]:checked').val());
	var Content = $("#Content").val();
	if (Content != ""){
		var set = '{"CmdSetId":-1}';
		savestep2.cmd_all.push(JSON.parse(set));
	}
	var cmd_id = $("#cmd").data('value');
	var cmd_text = $("#cmd").find('span').text();
	if (cmd_id != undefined && cmd_id != '-1'){
		var set = '{"CmdSetId":'+cmd_id+',"Name":"'+cmd_text+'"}';
		savestep2.cmd_all.push(JSON.parse(set));
	}
	$("#cmd_list").children('div:not(:first)').each(function(i,item){
		var v = $(item).attr('id');
		var t = $(item).children('input').val();
				var set = '{"CmdSetId":'+v+',"Name":"'+t+'"}';
		savestep2.cmd_all.push(JSON.parse(set));
	});

	if($("#warning_checkbox").prop('checked')==true)
	{
		savestep2.respone=1;
	}
	else{
		savestep2.respone=0;
	}
	
	if ($('input:checkbox[name="response"]:checked').length == 0){
		savestep2.mode = 0;
	}else{
		savestep2.mode=parseInt($('input:checkbox[name="response"]:checked').val());
	}
	
	if(savestep2.mode==8)
	{
		if ($("#EnableApprove").data('value') != undefined){
			savestep2.approve = $("#EnableApprove").data('value');
		}else{
			savestep2.approve = 0;
		}
		/*
		$.each(appdata.data,function(i,item){
			if ($("#EnableApprove").val() == item.ApproveStrategyName){
				savestep2.approve = item.ApproveStrategyId;
				return false;
			}else{
				savestep2.approve = 0;
			}
		});
		*/
		//savestep2.approve=$("#ApproveStrategy").val();
	}
	}
function savedata1()
{
	savestep1.name=$("#ManageAuthName").val();
	if($("#Enable").prop('checked'))
	{
		savestep1.Enable=true;
	}
	else{
		savestep1.Enable=false;
	}
	savestep1.admin.splice(0,savestep1.admin.length);
	savestep1.AccessAuthId.splice(0,savestep1.AccessAuthId.length);
	/*
	$("#contlist input[type=checkbox]").each(function(i,item){
		if($(item).prop('checked'))
		{
			id=$(item).val();
			savestep1.admin.push(parseInt(id));
		}
	})
	*/
		$.each(manager_arry,function(i,item){
		if (item != '-1'){
			savestep1.admin.push(parseInt(item));
		}
	});
	$("#access_way input[type=checkbox]").each(function(i,item){
		if($(item).prop('checked'))
		{
			id=$(item).val();
			savestep1.AccessAuthId.push(id);
		}
	})
	}
function savedata_all()
{
	cmdauthdata.CmdAuthName=$("#ManageAuthName").val();
	if($("#Enable").prop('checked'))
	{
		cmdauthdata.Enabled=true;
	}
	else{
		cmdauthdata.Enabled=false;
	}
	cmdauthdata.AdminSet = [];
	for (var m_i = manager_arry.length-1; m_i >= 0; m_i--){
		if (manager_arry[m_i] != '-1'){
			cmdauthdata.AdminSet.push(JSON.parse("{\"AdminId\": "+manager_arry[m_i]+"}"));
		}
	}
	cmdauthdata.AuthObjectSet = [];
	$("#access_way input[type=checkbox]").each(function(i,item){
		if($(item).prop('checked'))
		{
			id=$(item).val();
			cmdauthdata.AuthObjectSet.push(JSON.parse("{\"AccessAuthId\":"+id+"}"));
		}
	})
	
	cmdauthdata.Action=savestep2.action;
	cmdauthdata.ResponseMode=savestep2.respone+savestep2.mode;
	if(savestep2.mode==8)//审批策略
	{
		cmdauthdata.ApproveStrategyId=savestep2.approve;
	}
	else{
		cmdauthdata.ApproveStrategyId=null;
	}
	
	if(savestep2.respone==1)//告警信息
	{
		cmdauthdata.EventAlarmInfoId=savestep2.woring;
	}
	else{
		cmdauthdata.EventAlarmInfoId=null;
	}
		
	var Content = $("#Content").val();
	cmdauthdata.AuthCmdSet = [];
	if (Content != ''){
		Content_str = Content;
		Content = window.btoa(window.encodeURIComponent(Content));
		cmdauthdata.AuthCmdSet.push(JSON.parse("{\"CmdSetId\":0,\"Type\":2,\"Content\":\""+Content+"\"}"));
	}
	
	$.each(savestep2.cmd_all,function(i,item){//指令集合
		if (item.CmdSetId != '-1'){
			cmdauthdata.AuthCmdSet.push(JSON.parse("{\"CmdSetId\":"+parseInt(item.CmdSetId)+",\"Type\": 1,\"Content\": null}"));
		}
	});
	
	}
var Content_str = "";
function set_alldata()//获取编辑数据
{
	id=document.frm_access.id.value;
	$.ajax({
		url:'/bhost/PGetCmdAuth_x',
		type:'post',
		async:false,
		data:{a0:se,a1:id},
		success:function(result){
			var alldata = JSON.parse(result);
				cmdauthdata.CmdAuthId=alldata.data[0].CmdAuthId;
				savestep1.name=alldata.data[0].CmdAuthName;
				savestep1.Enable=alldata.data[0].Enabled;
				$.each(alldata.data[0].AdminSet,function(i,item){
					if(item.Type == 1){
						admin_1=item.UserCode;
						return true;
					}
					savestep1.admin.push(parseInt(item.AdminId));
				})
				$.each(alldata.data[0].AuthObjectSet,function(i,item){
					savestep1.AccessAuthId.push(item.AccessAuthId);
				})
				
				savestep2.action=alldata.data[0].Action;
				var response=alldata.data[0].ResponseMode;
				if (response == 1){
					savestep2.mode=0;
					savestep2.respone=1;
					savestep2.woring=alldata.data[0].EventAlarmInfoId;
					savestep2.woringname=alldata.data[0].EventAlarmInfoName;
				}
				else if(response==2)
				{
					savestep2.mode=2;
					savestep2.respone=0;
				}
				else if(response==3)
				{
					savestep2.mode=2;
					savestep2.respone=1;
					savestep2.woring=alldata.data[0].EventAlarmInfoId;
					savestep2.woringname=alldata.data[0].EventAlarmInfoName;
				}
				else if(response==4)
				{
					savestep2.mode=4;
					savestep2.respone=0;
				}
				else if(response==5)
				{
					savestep2.mode=4;
					savestep2.respone=1;
					savestep2.woring=alldata.data[0].EventAlarmInfoId;
					savestep2.woringname=alldata.data[0].EventAlarmInfoName;
				}
				else if(response==8)
				{
					savestep2.mode=8;
					savestep2.respone=0;
					savestep2.approve=alldata.data[0].ApproveStrategyId;
					savestep2.approvename=alldata.data[0].ApproveStrategyName;
				}
				else if(response==9)
				{
					savestep2.mode=8;
					savestep2.respone=1;
					savestep2.woring=alldata.data[0].EventAlarmInfoId;
					savestep2.approve=alldata.data[0].ApproveStrategyId;
					savestep2.woringname=alldata.data[0].EventAlarmInfoName;
					savestep2.approvename=alldata.data[0].ApproveStrategyName;
				}
				cmdset = [];
				$.each(alldata.data[0].AuthCmdSet,function(i,item){
					if (item.Type == 1){
						var set = '{"CmdSetId":'+item.CmdSetId+',"Name":"'+item.Name+'"}';
						savestep2.cmd_all.push(JSON.parse(set));
						cmdset.push((item.CmdSetId).toString());
					}else{
						//var Content = window.decodeURIComponent(window.atob(item.Content));
						var Content = item.Content;
						$("#Content").val(Content);
					}
				})
				cmdset.reverse();
		}
	});
}
var cmd_data;

var cmd_index_all = [];
function get_cmd_all()//获取指令集合
{
	if (savestep2.cmd_all.length != 0){
		var cmd_len = savestep2.cmd_all.length;
		$.each(savestep2.cmd_all,function(i,item){
			$("#cmd").data('value',item.CmdSetId);
			$("#cmd").find('span').text(item.Name);
			if (cmd_len-1 != i){	
				$("#cmd").next('i').trigger('click');
			}
		});
	}
}
var edata;
function get_warning_all()//获取告警信息
{
	$.ajax({
		url:"/bhost/get_warning_all_x",
		type:"POST",
		async:false,
		data:{a0:se},
		success:function(result){ 
			edata = JSON.parse(result);
		}
	})
}
var appdata;
function get_ApproveStrategy()//获取审批策略
{
	$.ajax({
		url:"/bhost/get_ApproveStrategy_all_x",
		type:"POST",
		async:false,
		data:{a0:se},
		success:function(result){ 
			appdata = JSON.parse(result);
		}
	})
}

var cmdset=['-1'];
function change_cmd(obj){
	//var t = $(obj).children('option:selected').val();
	var t = $(obj).find('span').data('value');
	if (cmdset.indexOf(t) === -1 && t != undefined){
		cmdset.splice(0,1,t);
	}
	/*
	if ($(obj).siblings('li').length == 2 && t != '-1'){
		$(obj).parent().children('i.add').click();
		$(obj).parent().hide();
	}
	*/
}

function _addcmd(obj){//添加指令集合
	var cmdset_id = $(obj).prev('div').data('value');
	var v = $(obj).prev('div').find('span').text();
	if (cmdset_id == undefined || cmdset_id == '-1') {
		_alert(2, "指令授权", "请选择指令集合");
		return false;
	}
	cmdset.splice(0,0,'-1');
	cmd_index_all.splice($.inArray(parseInt(cmdset_id),cmd_index_all),1);
	var $c = $('<div style="width:170px;margin-top: -15px;margin-left: 9px;" class="item" id="' + cmdset_id + '"/>');
	$c.html('<input style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;width: 122px;padding: 0 8px;border-radius: 2.5px;" typr="text" class="form-text" disabled="true" value="' + v + '"><i class="ctrl del" onclick="_del_scope(this,1)"></i>');
	
	$(obj).parent().after($c);
	$("#cmd").find('span').text('请选择');
	$("#cmd").data('value',-1);
	$("div[data-id=xSelect-cmd]").children('input').val('');
	$("div[data-id=xSelect-cmd]").find('span[data-value='+cmdset_id+']').parent('li').remove();
				/*
	var $c = $(obj).parent();
	var a=0;
	var v=$c.find('select:first').children('option:selected').val();
	var t = $(obj).parent().children('select').children('option[value='+v+']').text();
	if (v == undefined){
		$(obj).parent().children('select').val('-1').trigger('change');
		return false;
	}
	if(v==-1)
	{
		_alert(2,'指令集合','请选择指令集合');
		return false;
	}
			cmdset.splice(0,0,'-1');
	cmd_index_all.splice($.inArray(parseInt(v),cmd_index_all),1);

	$c.children('select').find('option[value='+v+']').remove();
	var $s = $('<li class="item" style="padding: 1px 0px 11px 11px;"><input type="text" class="form-text" id="'+v+'" value="'+t+'" style="width:106px;height:24px" disabled="true"><i class="ctrl del" onclick="_del_morc(this,2)"></i></li>');
	$c.after($s);
	$c.children('select').val(-1);
	$c.children('select').select2();
	*/
}

function _del_scope(obj,type){
	var $c = $(obj).parent();
	var id = $c.attr('id');
	var t = $(obj).siblings('input').val();
	var v, data, max;
	var min = 0;
	if (type == 1){//指令集合
		max = cmd_index_all.length - 1;
		data = cmd_index_all;
		$("#cmd").show();
		cmdset.splice($.inArray(parseInt(id), cmdset), 1);
		var $p = $("div[data-id=xSelect-cmd]").children('ul');
	}
		$c.remove();
	if (max < 0){
		var index_1 = -1;
	}else{
		var index_1 = search_i(min, max, parseInt(id), data);
	}
	//var index_1 = search_i(min, max, parseInt(id), data);
			index_1 = parseInt(index_1);
		if (index_1 == -1) {
		index_1 = max + 1;
		$p.append('<li style=""><i class="edit"></i><span data-value="'+id+'" style="width:132px">'+t+'</span></li>');
	} else if (index_1 == -2) {
		index_1 = 0;
		$p.children('li').eq(0).before('<li style=""><i class="edit"></i><span data-value="'+id+'" style="width:132px">'+t+'</span></li>');
	} else {
		$p.find('span[data-value='+data[index_1]+']').parent('li').before('<li style=""><i class="edit"></i><span data-value="'+id+'" style="width:132px">'+t+'</span></li>');
	}
	data.splice(index_1, 0, parseInt(id));
}

function _checkCls(obj,type){
	if(type==1){
		var len = $(obj).parent().parent().children('li').length;
		var n = 0;
		$(obj).parent().parent().children('li').each(function(z,zitem){
			if($('input[type=checkbox]',zitem).prop('checked')){
				n++;
			}
		});

		if(n==len){
			$(obj).parent().parent().parent().children('input[type=checkbox]').prop('checked',true).next('span.checkbox').attr('class','checkbox checked');
		}else{
			$(obj).parent().parent().parent().children('input[type=checkbox]').prop('checked',false).next('span.checkbox').attr('class','checkbox half');
		}
	}else if(type==2){
		var n = 0;
		$(obj).parent().siblings('li').each(function(z,zitem){
			if($('input[type=checkbox]',zitem).prop('checked')){
				n++;
			}
		});

		if(n==0){
			$(obj).parent().parent().parent().children('input[type=checkbox]').prop('checked',false).next('span.checkbox').attr('class','checkbox');
		}else{
			$(obj).parent().parent().parent().children('input[type=checkbox]').prop('checked',false).next('span.checkbox').attr('class','checkbox half');
		}
	}
}




var $focusObj;
var serdata;
function _autoView(obj,i,j){
		$(document)[0].onclick = null;
	$focusObj = $(obj);
		if (j == 2){
		get_ApproveStrategy();
	}else if (j == 3){
		get_warning_all();
	}
	var v = $.trim($(obj).val());
	var $view;
	if($('#autoView').length == 0){
		$('body').append('<div id="autoView" />');
	}
	$view = $('#autoView');
	var c = '';
	if (j == 2){
		$.each(appdata.data,function(i,item){
			if(v == ''){
				c += '<li><i class="edit" onclick="_editNode4(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden; href="javascript:;" id="'+item.ApproveStrategyId+'" onclick="_setVal(this,5);">'+item.ApproveStrategyName+'</a></li>';
			}else{
				if(item.ApproveStrategyName.indexOf(v) >= 0 ){
					c += '<li><i class="edit" onclick="_editNode4(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden; href="javascript:;" id="'+item.ApproveStrategyId+'" onclick="_setVal(this,5);">'+item.ApproveStrategyName+'</a></li>';
				}
			}
		});
	}else if (j == 3){
		$.each(edata.data,function(i,item){
			if(v == ''){
				c += '<li><i class="edit" onclick="_editNode3(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden; href="javascript:;" id="'+item.EventAlarmInfoId+'" onclick="_setVal(this,4);">'+item.Name+'</a></li>';
			}else{
				if(item.Name.indexOf(v) >= 0 ){
					c += '<li><i class="edit" onclick="_editNode3(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden; href="javascript:;" id="'+item.EventAlarmInfoId+'" onclick="_setVal(this,4);">'+item.Name+'</a></li>';
				}
			}
		});
	}

	if(i==1){
		$view.html('<ul>'+c+'</ul><div class="add2"><a href="javascript:;" onclick="_addNew(this)">创建新配置...</a></div>');
	}else if (i == 2){
		$view.html('<ul>'+c+'</ul><div class="add2"><a href="javascript:;" id="-1" onclick="_editNode(this,2);">添加新服务器范围</a></div>');
	}else if (i == 3){
		$view.html('<ul>'+c+'</ul><div class="add2"><a href="javascript:;" id="-1" onclick="_editNode4(this,2);">添加新审批策略</a></div>');
	}else if (i == 4){
		$view.html('<ul>'+c+'</ul><div class="add2"><a href="javascript:;" id="-1" onclick="_editNode3(this,2);">添加新事件告警</a></div>');
	}

	var offset = $(obj).offset();
	var w = $(obj).outerWidth();
	$view.css({
		top:offset.top+24,
		left:offset.left,
		width:w-12
	}).show();

	$(obj).parents('.g-tsel').addClass('on');
	input_val = $(obj).val();
	}
var input_val = "";
var serverid_list = [];
var server_id;
function _setVal(t,t1){
	var val = $(t).text();
	$($focusObj).val(val);
		$view = $('#autoView');
	$view.hide();
	var $item = $focusObj.parents('div.g-title').next('div.g-cont').find('div.forName');
	var $item2 = $focusObj.parent().next('input.forName');
	$item.hide();
	$item2.hide();
}


function _hideView(t){
	
	$(document)[0].onclick = function(){
		$('#autoView').hide();
		$('.g-tsel').removeClass('on');
	}
}



//警告
function clear_eventinfo(){
	$("#e_n").val("").attr("disabled",false);
	$("#Description").val("");
	$("#EventLevel").val(0).trigger('change');
	$("#EventType").val(0).trigger('change');
	$("#AlarmAction").val(0).trigger('change');
	$("#admin_select").empty();
	$("#admin_select1").empty();
	$("#label_list").children('div:not(:first)').remove();
	$("#label_list1").children('div:not(:first)').remove();
	$("#AlarmReceiver_text1").children('div:not(:first)').remove();
	$("#AlarmReceiver_text").children('div:not(:first)').remove();
	$("#AlarmReceiver_text1").find('input').val('');
	$("#AlarmReceiver_text").find('input').val('');
	$("#e_n").next('.v-check').attr('class',"v-check");
	$("#AlarmReceiver_check").iCheck('uncheck');
	$("#AlarmReceiver_check1").iCheck('uncheck');
	$(".xSelect-mail_div1").find('li').removeClass('active');
	$(".xSelect-mail_div2").find('li').removeClass('active');
	$("#mail_div1").data('value','-1');
	$("#mail_div2").data('value','-1');
}

var eventinfo_data;
function _editNode3(obj,type){
	clear_eventinfo();
	var title;
	if (type == 1){
		//eventinfoId = $(obj).parent().children('a').attr('id');
		eventinfoId = $(obj).children('span').data('value');
		$.ajax({
			url: "/bhost/get_eventinfo_list",
			type: "POST",
			async: false,
			data: { a0: se, a1: eventinfoId},
			success: function (result) {
				var eventinfo_result = JSON.parse(result);
				if (eventinfo_result.Result == true) {
					eventinfo_data = eventinfo_result.info.data[0];
					title = "告警事件";
				}
			}
		});
	}else{
		eventinfo_edit = null;
		eventinfoId = 0;
		title = "告警事件";
	}
	var $dialogCont = $("#eventinfo_suspend").show();
	
	var d = dialog({
		title:title,
		content:$dialogCont,
		id:"eventinfo_suspend",
		width:"800px"
	});
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	d.showModal();
	$("#EventLevel").next('span').css("margin-left",9);
	eventinfomain(type);
	$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
		clear_eventinfo();
		eventinfomain(type);
		//d.close().remove();
	});
	
	$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
		eventinfo_add(d);
	})
	
}


var eventinfo = {
	"EventAlarmInfoId": 0,
	"Name": "",
	"EventLevel": 0,
	"EventType": 0,
	"EventDescription": null,
	"AlarmAction": 0,
	"AlarmReceiver": null,
	"UserSet": new Array(),
	"MasterConfig":0,
	"StandByConfig":0,
	"MasterConfigName":"",
	"StandByConfigName":""
};

var phonecheck = /^[0-9]{11}$/;
var emailcheck = /^([a-zA-Z0-9_\.\-])+@(([a-zA-Z0-9_\-])+\.)+([a-zA-Z0-9])+$/;
var phone_or_emailcheck =null;
var phone_or_email=null;
function _addphone_or_email(obj) {
	var pass = 1;
	var v = $(obj).prev('input').val().trim();
	if (v == '') {
		_alert(2, '事件警告信息', '请输入'+phone_or_email,$(obj).prev('input'));
		$(obj).prev('input').focus();
		return false;
	} else if (!phone_or_emailcheck.test(v)) {
		_alert(1, '事件警告信息', phone_or_email+'格式不正确',$(obj).prev('input'));
		$(obj).prev('input').focus();
		return false;
	} else {
		var AlarmAction=$('#AlarmAction').val();
		if(AlarmAction=='1'){
			var it='';
		}else{
			var it='1';
		}
		$(">div[value]", "#AlarmReceiver_text"+it).each(function () {
			ip_str = $(this).find("input").val();
			if (ip_str == v) {
				_alert(1, '事件警告信息','相同的'+ phone_or_email+'已存在',$(obj).prev('input'));
				$(obj).prev('input').focus();
				pass = 0;
				return false;
			}
		});
	}
	if (pass == 1) {
		var $c = $('<div id="" name="" class="item" style="padding-top: 0px;width: 260px;" value>');
		$c.html('<input type="text" class="form-text" style="width: 193px;" value="' + v+ '">'
		+'<i class="ctrl del" onclick="_delphone_or_email(this)"  style="margin-top: 0px;margin-left: 4px;"></i>');
		$(obj).parent().after($c);
		$(obj).prev('input').val("");
		$(obj).prev('input').focus();
	}
}
function _delphone_or_email(obj){
	var $c = $(obj).parent();
	$c.fadeOut(function(){
		$c.remove();
	});
}
//删除接收人
function _deladmin(obj,type) {
	var $c = $(obj).parent();
	var m_i = $(obj).parent().attr('value');
	$c.fadeOut(function(){
		$c.remove();
		var AlarmAction = $('#AlarmAction').val();
		if (AlarmAction == '1') {
			all_option_str_1[parseInt(m_i)] = check_option_str_1[parseInt(m_i)];
			check_option_str_1[parseInt(m_i)] = null;
						$('#admin_select option[index=0]').remove();
			$.each(all_option_str_1, function (i, item) {
				if (item != null) {
					$('#admin_select').append(item);
				}
			});
			$('#admin_select').trigger('change');
		} else {
			all_option_str_2[parseInt(m_i)] = check_option_str_2[parseInt(m_i)];
			check_option_str_2[parseInt(m_i)] = null;
			$('#admin_select1 option[index=0]').remove();
			$.each(all_option_str_2, function (i, item) {
				if (item != null) {
					$('#admin_select1').append(item);
				}
			});
			$('#admin_select1').trigger('change');
		}
		/*
		if (type == 1){
			var h1 = $("#label_list").height();
						if (h1 < 68){
				$("#AlarmReceiver_div").css("margin-top",38);
			}
		}else{
			var h1 = $("#label_list1").height();
						if (h1 < 68){
				$("#AlarmReceiver_div1").css("margin-top",38);
			}
		}
		*/
	});
	$("#admin_select").select2();
}
//添加接收人
function _addadmin(obj,type) {
	var m_i = $(obj).parent().children('select').find("option:selected").val();
	var text = $(obj).parent().children('select').find("option:selected").text();
	if (m_i == "0") {
		_alert(2, '事件警告信息', '请选择接收人');
		return false;
	}
	var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + m_i + '"/>');
	if (type == 1){
		$c.html('<input class="form-text" type="text" style="width: 128px;" value="' + text + '" disabled="true"><i style="margin-left: 4px;" class="ctrl del" onclick="_deladmin(this,1)"></i>');
	}else{
		$c.html('<input class="form-text" type="text" style="width: 128px;" value="' + text + '" disabled="true"><i style="margin-left: 4px;" class="ctrl del" onclick="_deladmin(this,2)"></i>');
	}
	$(obj).parent().after($c);
	$(obj).parent().children('select').find('option[value=' + m_i + ']').remove();
	$(obj).parent().children('select').val(0).trigger("change");
	var AlarmAction = $('#AlarmAction').val();
	if (AlarmAction == '1') {
		check_option_str_1[parseInt(m_i)] = all_option_str_1[parseInt(m_i)];
		all_option_str_1[parseInt(m_i)] = null;
	} else {
		check_option_str_2[parseInt(m_i)] = all_option_str_2[parseInt(m_i)];
		all_option_str_2[parseInt(m_i)] = null;
	}
	//输入数字
	$(".num").bind('keydown', function (e) {
		DigitInput(e);
	});
	/*
	if (type == 1){
		var h1 = $("#label_list").height();
				if (h1 > 38){
			$("#AlarmReceiver_div").css("margin-top",68);
		}
	}else{
		var h1 = $("#label_list1").height();
				if (h1 > 38){
			$("#AlarmReceiver_div1").css("margin-top",68);
		}
	}
	*/
}
var check_option_str_1 = [];
var check_option_str_2 = [];
var all_option_str_1 = [];
var all_option_str_2 = [];

//绑定邮箱下拉框
function bind_mail_select(){
	var mail_array1 = [0];
	var mail_array2 = [0];
	xsel_mail_id1_pre[0] = -1;
	xsel_mail_id2_pre[0] = -1;
	$.ajax({
		url:'/bhost/select_mailserver_all',
		type:'post',
		async:false,
		data:{a0:se,z1:-1},
		success:function(result){
			maildata = JSON.parse(result);
		}
	});
	var mail_array = [];
	mail_array.push({'value':-1,'name':'全局指定','type':null});
	$.each(maildata.data,function(i,item){
		if (manage_auth_array.indexOf(24) != -1){
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'edit'
			};
		}else{
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'check'
			};
		}
		select_data_json.value = item.SmtpConfigId;
		select_data_json.name = item.SmtpConfigName;
		mail_array.push(select_data_json);
		mail_array1.push(item.SmtpConfigId);
		mail_array2.push(item.SmtpConfigId);
	});
	$(".xSelect-mail_div1").remove();
	$("#mail_div1").empty().data("xSelect","");
	
	if (manage_auth_array.indexOf(24) != -1){
		$("#mail_div1").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:mail_array,
			module_type:"mail_div1",
			edit: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode7(obj,1,1);
			},
			btn:[
				{
					'name':'新增',
					'event': function(items,obj){
												$(obj).parents('.xSelect-view').hide();
						_editNode7(obj,2,1);
					}
				}
			],
			setval:function(item,obj){
				var xsel_id1 = $(obj).find('span').data('value');
				change_mail_option(1,mail_array,$(".xSelect-mail_div2"),mail_array2,xsel_id1,xsel_mail_id1_pre);
			}
		});
	}else{
		$("#mail_div1").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:mail_array,
			module_type:"mail_div1",
			check: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode7(obj,1,1);
			},
			setval:function(item,obj){
				var xsel_id1 = $(obj).find('span').data('value');
				change_mail_option(1,mail_array,$(".xSelect-mail_div2"),mail_array2,xsel_id1,xsel_mail_id1_pre);
			}
		});
	}
	
	
	$("#mail_div1").data('value',-1);
	$(".xSelect-mail_div2").remove();
	$("#mail_div2").empty().data("xSelect","");
	
	if (manage_auth_array.indexOf(24) != -1){
		$("#mail_div2").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:mail_array,
			module_type:"mail_div2",
			edit: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode7(obj,1,2);
			},
			btn:[
				{
					'name':'新增',
					'event': function(items,obj){
												$(obj).parents('.xSelect-view').hide();
						_editNode7(obj,2,2);
					}
				}
			],
			setval:function(item,obj){
				var xsel_id2 = $(obj).find('span').data('value');
				change_mail_option(2,mail_array,$(".xSelect-mail_div1"),mail_array1,xsel_id2,xsel_mail_id2_pre);
			}
		});
	}else{
		$("#mail_div2").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:mail_array,
			module_type:"mail_div2",
			check: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode7(obj,1,2);
			},
			setval:function(item,obj){
				var xsel_id2 = $(obj).find('span').data('value');
				change_mail_option(2,mail_array,$(".xSelect-mail_div1"),mail_array1,xsel_id2,xsel_mail_id2_pre);
			}
		});
	}
	
	$("#mail_div2").data('value',-1);
}

var xsel_mail_id1_pre = [-1];
var xsel_mail_id2_pre = [-1];
function change_mail_option(type,mail_array,obj,div_array,xsel_id,xsel_id_pre){
					if (xsel_id_pre[0] != -1){
		var index = $.inArray(-1, div_array);
		var name = mail_array[index].name;
				div_array[index] = xsel_id_pre[0];
		if (index == 1){
			if (manage_auth_array.indexOf(24) != -1){
				$(obj).find('span[data-value='+div_array[index+1]+']').parent().before('<li><i class="edit"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
			}else{
				$(obj).find('span[data-value='+div_array[index+1]+']').parent().before('<li><i class="check"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
			}
			//$(obj).find('span[data-value='+div_array[index+1]+']').parent().before('<li><i class="edit"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
		}else if (index <= div_array.length){
			if (manage_auth_array.indexOf(24) != -1){
				$(obj).find('span[data-value='+div_array[index-1]+']').parent().after('<li><i class="edit"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
			}else{
				$(obj).find('span[data-value='+div_array[index-1]+']').parent().after('<li><i class="check"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
			}
			//$(obj).find('span[data-value='+div_array[index-1]+']').parent().after('<li><i class="edit"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
		}
	}
	if (xsel_id != -1){
		var sel_span = $(obj).find('span[data-value='+xsel_id+']');
		sel_span.parent().remove();
		div_array.splice($.inArray(parseInt(xsel_id), div_array),1, -1);
	}
	xsel_id_pre[0] = xsel_id;
	}

function clear_mail(){
	$("#mail_suspend").find('input').val('');
	$("#mail_suspend").find('i.v-check').attr('class','v-check');
	$("#SmtpConfigName").attr('disabled',false);
	$("#AttachMaxLimit").val(0);
	$("#EnCode_mail").val(0).trigger('change');
	$("#Flag_mail").val(2).trigger('change');
	//xsel_mail_id1_pre = [-1];
	//xsel_mail_id2_pre = [-1];
}

//邮件
var mailset = {
	"SmtpConfigId": 0, 
	"SmtpConfigName": "邮件服务器1",  
	"SmtpServer": "10.17.251.5",
	"DNS": null,         
	"Sender": "ithelp@fqnp.com",
	"SenderEmail": "ithelp@fqnp.com",
	"AttachMaxLimit": 20,        
	"ServerVerify": true,
	"SenderEmailPass": "d106f6959747b5ac",
	"Flag":0,
	"EnCode":0
}
var mail_result;
function _editNode7(obj,type,flag){
	clear_mail();
	var title;
	if (type == 1){
		//approveId = $(obj).parent().children('a').attr('id');
		mailId = $(obj).children('span').data('value');
		$.ajax({
			url: "/bhost/select_mailserver_all",
			type: "POST",
			async: false,
			data: { a0: se, z1: mailId},
			success: function (result) {
				mail_result = JSON.parse(result);
				mail_result = mail_result.data[0];	
				title = "邮件";
			}
		});
	}else{
		mailId = 0;
		title = "邮件";
	}
	
	var $dialogCont = $("#mail_suspend").show();
	
	var d = dialog({
		title:title,
		content:$dialogCont,
		id:"mail_suspend",
		width:"800px"
	});
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	d.showModal();
	mail_main(type);
	$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
		clear_mail();
		mail_main(type);
		//d.close().remove();
	});
	
	$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
		mailserver_save(d,flag);
	});
	
}

function mail_main(type){
	if (manage_auth_array.indexOf(24) === -1){
		$("#mail_suspend").find('.btn-submit').remove();
	}
	if (type == 1){
		mailset.SmtpConfigId = mail_result.SmtpConfigId;
		$("#SmtpConfigName").val(mail_result.SmtpConfigName);
		$("#SmtpConfigName").prop("disabled",true);
		$("#SmtpServer").val(mail_result.SmtpServer);
		$("#Sender").val(mail_result.Sender);
		$("#SenderEmail").val(mail_result.SenderEmail);
		$("#AttachMaxLimit").val(mail_result.AttachMaxLimit);
		
		if (mail_result.ServerVerify){
			$("#ServerVerify_on").iCheck("check");
			$("#SenderEmailPass").parent().show();
			$("#SenderEmailPass").val(mail_result.SenderEmailPass);
		}else{
			$("#ServerVerify_off").iCheck("check");
			$("#SenderEmailPass").parent().hide();
		}
		$("#EnCode_mail").val(mail_result.EnCode).trigger('change');
		$("#Flag_mail").val(mail_result.Flag).trigger('change');
		if (mail_result.Flag == 2){
			$.ajax({
				url:'/bhost/get_mail_flag',
				type:'post',
				async:false,
				data:{a0:se},
				success:function(result){
					var mail_flag = JSON.parse(result);
					if (mail_flag.Result){
						if (mail_flag.count_mail == 2){
							$("#Flag_mail").attr('disabled',true);
						}
					}
				}
			})
		}
	}else{
		$.ajax({
			url:'/bhost/get_mail_flag',
			type:'post',
			async:false,
			data:{a0:se},
			success:function(result){
				var mail_flag = JSON.parse(result);
				if (mail_flag.Result){
					if (mail_flag.count_mail == 1){
						$("#Flag_mail").val(2).trigger('change');
						$("#Flag_mail").attr('disabled',true);
					}else if (mail_flag.def_mail == 0){
						$("#Flag_mail").val(2).trigger('change');
					}else if (mail_flag.spare_mail == 0){
						$("#Flag_mail").val(1).trigger('change');
					}else{
						$("#Flag_mail").val(0).trigger('change');
					}
				}
			}
		})
	}
	
	$("#ServerVerify_on").on("ifChanged",function(){
		if ($(this).prop("checked")){
						$("#SenderEmailPass").parent().show();
		}else{
						$("#SenderEmailPass").parent().hide();
		}
	})
}

var emailReg = /^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]+)+)$/;
var ipcheck_route=/(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;
var hostcheck1=/^(https?:\/\/)?(w{3}\.)?([a-zA-Z0-9-_.])+\.(com|cn|gov|info|us|hk|tw|cc|tv|uk|org)$/;
var hostcheck2=/^(https?:\/\/)?((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$/;
var nameCheck = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;

//Email匹配
function EmailCheck(obj){
	var email = $(obj).val().trim();
	var $i = $(obj).next('i.v-check');
	if (!emailReg.test(email)){
		$i.show().attr('class','v-check v-wrong');
	}else{
		$i.show().attr('class','v-check v-right');
	}
}
function IPCheck(obj){
	var ip = $(obj).val().trim();
	var $i = $(obj).next('i.v-check');
	if (!ipcheck_route.test(ip)){
		$i.show().attr('class','v-check v-wrong');
	}else{
		$i.show().attr('class','v-check v-right');
	}
}
function IPCheck_DNS(obj){
	var ip = $(obj).val().trim();
	var $i = $(obj).next('i.v-check');
	if (!ipcheck_route.test(ip) && (!hostcheck1.test(ip)) && (!hostcheck2.test(ip))){
		$i.show().attr('class','v-check v-wrong');
	}else{
		$i.show().attr('class','v-check v-right');
	}
}
function fill_text(){
	var SenderEmail = $("#SenderEmail").val();
	if (SenderEmail != "" && $("#Sender").val() == ""){
		$("#Sender").val(SenderEmail);
	}
}

function NumCheck(obj){
	obj.value = obj.value.replace(/\D/g,"");
	var v = obj.value.trim();
	if (v == ""){
		obj.value = '0';
	}
}

//保存配置
function mailserver_save(d,flag){
	var SmtpConfigName = $("#SmtpConfigName").val();
	var SmtpServer = $("#SmtpServer").val().trim();
	var Sender = $("#Sender").val();
	var SenderEmail = $("#SenderEmail").val();
	var AttachMaxLimit = $("#AttachMaxLimit").val();
	var SenderEmailPass;
	if (SmtpConfigName == ""){
		_alert(2,"邮件","请输入名称",$("#SmtpConfigName"));
		return false;
	}else{
		if (!nameReg.test(SmtpConfigName)){
			_alert(1,"邮件","名称格式不正确",$("#SmtpConfigName"));
			return false;
		}
	}
	if (SmtpServer == ""){
		_alert(2,"邮件","请输入发送服务器",$("#SmtpServer"));
		return false;
	}else{
		if (!ipcheck_route.test(SmtpServer) && (!hostcheck1.test(SmtpServer)) && (!hostcheck2.test(SmtpServer))){
			_alert(1,"邮件","发送服务器格式不正确",$("#SmtpServer"));
			return false;
		}
	}
	if (SenderEmail == ""){
		_alert(2,"邮件","请输入发送方邮件地址",$("#SenderEmail"));
		return false;
	}else{
		if (!emailReg.test(SenderEmail)){
			_alert(1,"邮件","发送方邮件地址格式不正确",$("#SenderEmail"));
			return false;
		}
	}
	if ($("#ServerVerify_on").prop("checked")){
		if ($("#SenderEmailPass").val() == ""){
			_alert(2,"邮件","请输入服务器验证",$("#SenderEmailPass"));
			return false;
		}else{
			if($("#SenderEmailPass").val().length > 64){
				_alert(2, '邮件', "密码不能超过系统限定64位", $("#SenderEmailPass"));
				return false;
			}
			mailset.ServerVerify = true;
			mailset.SenderEmailPass = $("#SenderEmailPass").val();
		}
	}else{
		mailset.ServerVerify = false;
		mailset.SenderEmailPass = null;
	}

	mailset.SmtpConfigName = SmtpConfigName;
	mailset.SmtpServer = SmtpServer;
	mailset.DNS = null;
	mailset.Sender = Sender;
	mailset.SenderEmail = SenderEmail;
	mailset.AttachMaxLimit = AttachMaxLimit;
	mailset.Flag = parseInt($("#Flag_mail").val());
	mailset.EnCode = parseInt($("#EnCode_mail").val());
	msstr = aceg(JSON.stringify(mailset),se);
	$.ajax({
		url:'/bhost/save_mailserver',
		type:'post',
		async:false,
		data:{a0:se,z1:JSON.stringify(mailset),a10:"运维管理>指令授权",m1:msstr},
		success:function(result){
			data = JSON.parse(result);
			if (data.Result == true){
				parent.layer.open({
					type:1,
					title:"邮件",
					content:'<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
					btn:['确&nbsp;&nbsp;定'],
					btnAlign:'c',
					closeBtn: false,
					skin:'layer-custom',
					area:['380px','310px'],
					move: false,
					resize: false,
					btn1:function(i){
						$('.btn').blur();
						parent.layer.close(i);
						var mail_text1 = $('#mail_div1').find('span').text();
						var mail_text2 = $('#mail_div2').find('span').text();
						var mail_id1 = $('#mail_div1').data('value');
						var mail_id2 = $('#mail_div2').data('value');
						$("div[data-id=xSelect-mail_div1]").remove();
						$("div[data-id=xSelect-mail_div2]").remove();
						bind_mail_select();
						if (flag == 1){
							if ($("#mail_div1").data('value') == "-1" || $("#mail_div1").data('value') == undefined){
								mail_id1 = data.SmtpConfigId;
							}
						}else{
							if ($("#mail_div2").data('value') == "-1" || $("#mail_div2").data('value') == undefined){
								mail_id2 = data.SmtpConfigId;
							}
						}
						$(".xSelect-mail_div1").find('span[data-value='+mail_id1+']').click();
						$(".xSelect-mail_div2").find('span[data-value='+mail_id2+']').click();
						/*
						if (flag == 1){
							if ($("#mail_div1").data('value') == "-1" || $("#mail_div1").data('value') == undefined){
								//$("#mail_div1").data('value',data.SmtpConfigId);
								//$("#mail_div1").find('span').text(mailset.SmtpConfigName);
								$(".xSelect-mail_div1").find('span[data-value='+data.SmtpConfigId+']').click();
							}else{
								//$('#mail_div1').find('span').text(mail_text1);
								$(".xSelect-mail_div1").find('span[data-value='+mail_id1+']').click();
							}
							if (mail_id2 != undefined && mail_id2 != '-1'){
								//$("#mail_div2").data('value',mail_id2);
								//$("#mail_div2").find('span').text(mail_text2);
								$(".xSelect-mail_div2").find('span[data-value='+mail_id2+']').click();
							}
						}else{
							if ($("#mail_div2").data('value') == "-1" || $("#mail_div1").data('value') == undefined){
								//$("#mail_div2").data('value',data.SmtpConfigId);
								//$("#mail_div2").find('span').text(mailset.SmtpConfigName);
								$(".xSelect-mail_div2").find('span[data-value='+data.SmtpConfigId+']').click();
							}else{
								//$('#mail_div2').find('span').text(mail_text2);
								$(".xSelect-mail_div2").find('span[data-value='+mail_id2+']').click();
							}
							if (mail_id1 != undefined && mail_id1 != '-1'){
								//$("#mail_div1").data('value',mail_id1);
								//$("#mail_div1").find('span').text(mail_text1);
								$(".xSelect-mail_div1").find('span[data-value='+mail_id1+']').click();
							}
						}
						*/
						d.close().remove();
					},
					btn2:function(i){
						parent.layer.close(i);
					}
				});	
			}else{
				_alert(1,"邮件","执行失败：" + data.ErrMsg);
			}
		}
	});
}

//短信猫
var xsel_smsm_id1_pre = [-1];
var	xsel_smsm_id2_pre = [-1];
function bind_smsm_select(){
	var smsm_array1 = [0];
	var smsm_array2 = [0];
	xsel_smsm_id1_pre[0] = -1;
	xsel_smsm_id2_pre[0] = -1;
	var smsm_data;
	$.ajax({
		url:'/bhost/select_smsm_all',
		type:'post',
		async:false,
		data:{a0:se,z1:-1},
		success:function(result){
			smsm_data = JSON.parse(result);
		}
	});
	var smsm_array = [];
	smsm_array.push({'value':-1,'name':'全局指定','type':null});
	$.each(smsm_data.data,function(i,item){
		if (manage_auth_array.indexOf(24) != -1){
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'edit'
			};
		}else{
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'check'
			};
		}
		select_data_json.value = item.SmsMConfigId;
		select_data_json.name = item.SmsMConfigName;
		smsm_array.push(select_data_json);
		smsm_array1.push(item.SmsMConfigId);
		smsm_array2.push(item.SmsMConfigId);
	});
	$(".xSelect-smsm_div1").remove();
	$("#smsm_div1").empty().data("xSelect","");
	
	if (manage_auth_array.indexOf(24) != -1){
		$("#smsm_div1").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:smsm_array,
			module_type:"smsm_div1",
			edit: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode8(obj,1,1);
			},
			btn:[
				{
					'name':'新增',
					'event': function(items,obj){
												$(obj).parents('.xSelect-view').hide();
						_editNode8(obj,2,1);
					}
				}
			],
			setval:function(item,obj){
				var xsel_id1 = $(obj).find('span').data('value');
				change_mail_option(1,smsm_array,$(".xSelect-smsm_div2"),smsm_array2,xsel_id1,xsel_smsm_id1_pre);
			}
		});
	}else{
		$("#smsm_div1").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:smsm_array,
			module_type:"smsm_div1",
			check: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode8(obj,1,1);
			},
			setval:function(item,obj){
				var xsel_id1 = $(obj).find('span').data('value');
				change_mail_option(1,smsm_array,$(".xSelect-smsm_div2"),smsm_array2,xsel_id1,xsel_smsm_id1_pre);
			}
		});
	}
	
	$("#smsm_div1").data('value',-1);
	$(".xSelect-smsm_div2").remove();
	$("#smsm_div2").empty().data("xSelect","");
	
	if (manage_auth_array.indexOf(24) != -1){
		$("#smsm_div2").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:smsm_array,
			module_type:"smsm_div2",
			edit: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode8(obj,1,2);
			},
			btn:[
				{
					'name':'新增',
					'event': function(items,obj){
												$(obj).parents('.xSelect-view').hide();
						_editNode8(obj,2,2);
					}
				}
			],
			setval:function(item,obj){
				var xsel_id2 = $(obj).find('span').data('value');
				change_mail_option(2,smsm_array,$(".xSelect-smsm_div1"),smsm_array1,xsel_id2,xsel_smsm_id2_pre);
			}
		});
	}else{
		$("#smsm_div2").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:smsm_array,
			module_type:"smsm_div2",
			check: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode8(obj,1,2);
			},
			setval:function(item,obj){
				var xsel_id2 = $(obj).find('span').data('value');
				change_mail_option(2,smsm_array,$(".xSelect-smsm_div1"),smsm_array1,xsel_id2,xsel_smsm_id2_pre);
			}
		});
	}
	
	$("#smsm_div2").data('value',-1);
}

function clear_smsm(){
	$("#smsm_suspend").find('input').val('');
	$("#SmsMConfigName").attr('disabled',false);
	$("#smsm_suspend").find('i.v-check').attr('class','v-check');
	$("#SmsMLimit").val(0);
	$("#EnCode_smsm").val(0).trigger('change');
	$("#Flag_smsm").val(2).trigger('change');
	//xsel_smsm_id1_pre = [-1];
	//xsel_smsm_id2_pre = [-1];
}

var smsm_result;
function _editNode8(obj,type,flag){
	clear_smsm();
	var title;
	if (type == 1){
		//approveId = $(obj).parent().children('a').attr('id');
		smsmId = $(obj).children('span').data('value');
		$.ajax({
			url: "/bhost/select_smsm_all",
			type: "POST",
			async: false,
			data: { a0: se, z1: smsmId},
			success: function (result) {
				smsm_result = JSON.parse(result);
				smsm_result = smsm_result.data[0];	
				title = "短信猫";
			}
		});
	}else{
		smsmId = 0;
		title = "短信猫";
	}
	
	var $dialogCont = $("#smsm_suspend").show();
	
	var d = dialog({
		title:title,
		content:$dialogCont,
		id:"smsm_suspend",
		width:"800px"
	});
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	d.showModal();
	smsm_main(type);
	$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
		clear_smsm();
		smsm_main(type);
		//d.close().remove();
	});
	
	$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
		smsmset_save(d,flag);
	});
}

var smsmset = {
	"SmsMConfigId": 0,
	"SmsMConfigName": "短信猫配置1",
	"SmsMSender": "13612345678",  
	"SmsMLimit": 0,
	"Flag":0,
	"EnCode":0
}

function smsm_main(type){
	if (manage_auth_array.indexOf(24) === -1){
		$("#smsm_suspend").find('.btn-submit').remove();
	}
	$("#SmsMLimit,#SmsMSender").bind('keydown', function(e){
		DigitInput(e);
	});
	if (type == 1){
		smsmset.SmsMConfigId=smsm_result.SmsMConfigId;
		$("#SmsMConfigName").val(smsm_result.SmsMConfigName);
		$("#SmsMConfigName").prop("disabled",true);
		$("#SmsMSender").val(smsm_result.SmsMSender);
		$("#SmsMLimit").val(smsm_result.SmsMLimit);
		$("#Flag_smsm").val(smsm_result.Flag).trigger('change');
		$("#EnCode_smsm").val(smsm_result.EnCode).trigger('change');
		if (smsm_result.Flag == 2){
			$.ajax({
				url:'/bhost/get_smsm_flag',
				type:'post',
				async:false,
				data:{a0:se},
				success:function(result){
					var smsm_flag = JSON.parse(result);
					if (smsm_flag.Result){
						if (smsm_flag.count_smsm == 2){
							$("#Flag_smsm").attr('disabled',true);
						}
					}
				}
			});
		}
	}else{
		smsmset.SmsMConfigId = 0;
		$.ajax({
			url:'/bhost/get_smsm_flag',
			type:'post',
			async:false,
			data:{a0:se},
			success:function(result){
				var smsm_flag = JSON.parse(result);
				if (smsm_flag.Result){
					if (smsm_flag.count_smsm == 1){
						$("#Flag_smsm").val(2).trigger('change');
						$("#Flag_smsm").attr('disabled',true);
					}else if (smsm_flag.def_smsm == 0){
						$("#Flag_smsm").val(2).trigger('change');
					}else if (smsm_flag.spare_smsm == 0){
						$("#Flag_smsm").val(1).trigger('change');
					}else{
						$("#Flag_smsm").val(0).trigger('change');
					}
				}
			}
		})
	}
}

//检查名称是否存在
function check_name(name,obj){
	var add = 0;
	$.ajax({
		url:'/bhost/check_smsmconfig_name',
		type:'post',
		async:false,
		data:{a0:se,z1:name},
		success:function(result){
			if (result != "0"){
				add = 1;
				_alert(2,"短信猫","该名称已存在",$(obj));
				return false;
			}
		}
	})
	if (add == 1){
		return false;
	}else{
		return true;
	}
}
function limitCheck(obj){
	obj.value = obj.value.replace(/\D/g,"");
	var v = obj.value.trim();
	if (v == ""){
		obj.value = '0';
	}
}

//保存配置
function smsmset_save(d,flag){
	var smsmset_list = [];
	var add = 0;
	var numCheck = /\D/;
	var isexist;
	var SmsMConfigName = $("#SmsMConfigName").val();
	var SmsMSender = $("#SmsMSender").val();
	var SmsMLimit = $("#SmsMLimit").val();
	var EnCode = $("#EnCode_smsm").val();
	var Flag =	$("#Flag_smsm").val();

	if (SmsMConfigName == ""){
		add = 1;
		_alert(2,"短信猫","请输入名称",$("#SmsMConfigName"));
		return false;
	}else{
		if (!nameCheck.test(SmsMConfigName)){
			add = 1;
			_alert(1,"短信猫","名称格式不正确",$("#SmsMConfigName"));
			return false;
		}
	}
	if (SmsMSender == ""){
		add = 1;
		_alert(2,"短信猫","请输入短信中心",$("#SmsMSender"));
		return false;
	}else{
		if (numCheck.test(SmsMSender)){
			add = 1;
			_alert(1,"短信猫","短信中心格式不正确",$("#SmsMSender"));
			return false;
		}
	}
	if (SmsMLimit == ""){
		add = 1;
		_alert(2,"短信猫","请输入发送限制",$("#SmsMLimit"));
		return false
	}else{
		if (numCheck.test(SmsMLimit)){
			add = 1;
			_alert(1,"短信猫","短信猫格式不正确",$("#SmsMLimit"));
			return false;
		}
	}
	smsmset.SmsMConfigName = SmsMConfigName;
	smsmset.SmsMSender = SmsMSender;
	smsmset.SmsMLimit = SmsMLimit;
	smsmset.EnCode = parseInt(EnCode);
	smsmset.Flag = parseInt(Flag);
	smsmset_list.push(JSON.stringify(smsmset));
	var msstr = aceg(JSON.stringify(smsmset_list),se);
	$.ajax({
		url:'/bhost/save_smsm',
		type:'post',
		async:false,
		data:{a0:se,z1:JSON.stringify(smsmset_list),m1:msstr},
		success:function(result){
			data = JSON.parse(result);
			if (data.Result == true){
				parent.layer.open({
					type:1,
					title:"短信猫",
					content:'<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
					btn:['确&nbsp;&nbsp;定'],
					btnAlign:'c',
					closeBtn: false,
					skin:'layer-custom',
					area:['380px','310px'],
					move: false,
					resize: false,
					btn1:function(i){
						parent.layer.close(i);
						$('.btn').blur();
						var smsm_text1 = $('#smsm_div1').find('span').text();
						var smsm_text2 = $('#smsm_div2').find('span').text();
						var smsm_id1 = $('#smsm_div1').data('value');
						var smsm_id2 = $('#smsm_div2').data('value');
						$("div[data-id=xSelect-smsm_div1]").remove();
						$("div[data-id=xSelect-smsm_div2]").remove();
						bind_smsm_select();
						if (flag == 1){
							if ($("#smsm_div1").data('value') == "-1" || $("#smsm_div1").data('value') == undefined){
								smsm_id1 = data.SmsMConfigId;
							}	
						}else{
							if ($("#smsm_div2").data('value') == "-1" || $("#smsm_div2").data('value') == undefined){
								smsm_id2 = data.SmsMConfigId;
							}
						}
						$(".xSelect-smsm_div1").find('span[data-value='+smsm_id1+']').click();
						$(".xSelect-smsm_div2").find('span[data-value='+smsm_id2+']').click();
						/*
						if (flag == 1){
							if ($("#smsm_div1").data('value') == "-1" || $("#smsm_div1").data('value') == undefined){
								//$("#smsm_div1").data('value',data.SmsMConfigId);
								//$("#smsm_div1").find('span').text(smsmset.SmsMConfigName);
								$(".xSelect-smsm_div1").find('span[data-value='+data.SmsMConfigId+']').click();
							}else{
								//$('#smsm_div1').find('span').text(smsm_text1);
								$(".xSelect-smsm_div1").find('span[data-value='+smsm_id1+']').click();
							}
							if (smsm_id2 != undefined && smsm_id2 != '-1'){
								//$("#smsm_div2").data('value',smsm_id2);
								//$("#smsm_div2").find('span').text(smsm_text2);
								$(".xSelect-smsm_div2").find('span[data-value='+smsm_id2+']').click();
							}
						}else{
							if ($("#smsm_div2").data('value') == "-1" || $("#smsm_div2").data('value') == undefined){
								//$("#smsm_div2").data('value',data.SmsMConfigId);
								//$("#smsm_div2").find('span').text(smsmset.SmsMConfigName);
								$(".xSelect-smsm_div2").find('span[data-value='+data.SmsMConfigId+']').click();
							}else{
								//$('#smsm_div2').find('span').text(smsm_text2);
								$(".xSelect-smsm_div2").find('span[data-value='+smsm_id2+']').click();
							}
							if (smsm_id1 != undefined && smsm_id1 != '-1'){
								//$("#smsm_div1").data('value',smsm_id1);
								//$("#smsm_div1").find('span').text(smsm_text1);
								$(".xSelect-smsm_div1").find('span[data-value='+smsm_id1+']').click();
							}
						}
						*/
						d.close().remove();
					},
					btn2:function(i){
						parent.layer.close(i);
					}
				});	
			}else{
				_alert(1,"短信猫", "执行失败：" + data.ErrMsg);
			}
		}
	});
}

//短信网关
var xsel_smssvr_id1_pre = [-1];
var xsel_smssvr_id2_pre = [-1];
function bind_smssvr_select(){
	var smssvr_array1 = [0];
	var smssvr_array2 = [0];
	xsel_smssvr_id1_pre[0] = -1;
	xsel_smssvr_id2_pre[0] = -1;
	var smssvr_data;
	$.ajax({
		url:'/bhost/select_smssvr_all',
		type:'post',
		async:false,
		data:{a0:se,z1:-1},
		success:function(result){
			smssvr_data = JSON.parse(result);
		}
	});
	var smssvr_array = [];
	smssvr_array.push({'value':-1,'name':'全局指定','type':null});
	$.each(smssvr_data.data,function(i,item){
		if (manage_auth_array.indexOf(24) != -1){
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'edit'
			};
		}else{
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'check'
			};
		}
		select_data_json.value = item.SmsSvrConfigId;
		select_data_json.name = item.SmsSvrConfigName;
		smssvr_array.push(select_data_json);
		smssvr_array1.push(item.SmsSvrConfigId);
		smssvr_array2.push(item.SmsSvrConfigId);
	});
	$(".xSelect-smssvr_div1").remove();
	$("#smssvr_div1").empty().data("xSelect","");
	
	if (manage_auth_array.indexOf(24) != -1){
		$("#smssvr_div1").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:smssvr_array,
			module_type:"smssvr_div1",
			edit: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode9(obj,1,1);
			},
			btn:[
				{
					'name':'新增',
					'event': function(items,obj){
												$(obj).parents('.xSelect-view').hide();
						_editNode9(obj,2,1);
					}
				}
			],
			setval:function(item,obj){
				var xsel_id1 = $(obj).find('span').data('value');
				change_mail_option(1,smssvr_array,$(".xSelect-smssvr_div2"),smssvr_array2,xsel_id1,xsel_smssvr_id1_pre);
			}
		});
	}else{
		$("#smssvr_div1").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:smssvr_array,
			module_type:"smssvr_div1",
			check: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode9(obj,1,1);
			},
			setval:function(item,obj){
				var xsel_id1 = $(obj).find('span').data('value');
				change_mail_option(1,smssvr_array,$(".xSelect-smssvr_div2"),smssvr_array2,xsel_id1,xsel_smssvr_id1_pre);
			}
		});
	}
	
	$("#smssvr_div1").data('value',-1);
	$(".xSelect-smssvr_div2").remove();
	$("#smssvr_div2").empty().data("xSelect","");
	
	if (manage_auth_array.indexOf(24) != -1){
		$("#smssvr_div2").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:smssvr_array,
			module_type:"smssvr_div2",
			edit: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode9(obj,1,2);
			},
			btn:[
				{
					'name':'新增',
					'event': function(items,obj){
												$(obj).parents('.xSelect-view').hide();
						_editNode9(obj,2,2);
					}
				}
			],
			setval:function(item,obj){
				var xsel_id2 = $(obj).find('span').data('value');
				change_mail_option(2,smssvr_array,$(".xSelect-smssvr_div1"),smssvr_array1,xsel_id2,xsel_smssvr_id2_pre);
			}
		});
	}else{
		$("#smssvr_div2").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:smssvr_array,
			module_type:"smssvr_div2",
			check: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode9(obj,1,2);
			},
			setval:function(item,obj){
				var xsel_id2 = $(obj).find('span').data('value');
				change_mail_option(2,smssvr_array,$(".xSelect-smssvr_div1"),smssvr_array1,xsel_id2,xsel_smssvr_id2_pre);
			}
		});
	}
	
	$("#smssvr_div2").data('value',-1);
}

function clear_smssvr(){
	$("#smssvr_suspend").find('input').val('');
	$("#SmsSvrConfigName").attr('disabled',false);
	$("#smssvr_suspend").find('i.v-check').attr('class','v-check');
	$("#SmsSvrDBType").val(1).trigger('change');
	$("#EnCode_smssvr").val(0).trigger('change');
	$("#Flag_smssvr").val(2).trigger('change');
	//xsel_smssvr_id1_pre[0] = -1;
	//xsel_smssvr_id2_pre[0] = -1;
}

var smssvr_result;
function _editNode9(obj,type,flag){
	clear_smssvr();
	var title;
	if (type == 1){
		//approveId = $(obj).parent().children('a').attr('id');
		smssvrId = $(obj).children('span').data('value');
		$.ajax({
			url: "/bhost/select_smssvr_all",
			type: "POST",
			async: false,
			data: { a0: se, z1: smssvrId},
			success: function (result) {
				smssvr_result = JSON.parse(result);
				smssvr_result = smssvr_result.data[0];	
				title = "短信网关";
			}
		});
	}else{
		smssvrId = 0;
		title = "短信网关";
	}
	
	var $dialogCont = $("#smssvr_suspend").show();
	
	var d = dialog({
		title:title,
		content:$dialogCont,
		id:"smssvr_suspend",
		width:"800px"
	});
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	d.showModal();
	smssvr_main(type);
	$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
		clear_smssvr();
		smssvr_main(type);
		//d.close().remove();
	});
	
	$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
		smssvr_save(d,flag);
	});
}

var smssvset = {
	"SmsSvrConfigId": 0,
	"SmsSvrConfigName": "短信网关配置1",
	"SmsSvrDBType": 2, 
	"SmsSvrDBServerIP": "192.168.0.1",        
	"SmsSvrDBPort": 1433,
	"SmsSvrDBUserName": "root",       
	"SmsSvrDBPassword": "d106f6959747b5ac",
	"SmsSvrDBDatabase": "mysql",
	"SmsSvrDBInsertTemp": null,
	"Flag":0,
	"EnCode":0
}

function smssvr_main(type){
	if (manage_auth_array.indexOf(24) === -1){
		$("#smssvr_suspend").find('.btn-submit').remove();
	}
	$("#SmsSvrDBPort").bind('keydown', function(e){
		DigitInput(e);
	});
	if (type == 1){
		smssvset.SmsSvrConfigId = smssvr_result.SmsSvrConfigId;
		$("#SmsSvrConfigName").val(smssvr_result.SmsSvrConfigName);
		$("#SmsSvrConfigName").prop("disabled",true);
		$("#SmsSvrDBType").val(smssvr_result.SmsSvrDBType).trigger('change');
		$("#SmsSvrDBServerIP").val(smssvr_result.SmsSvrDBServerIP);
		$("#SmsSvrDBPort").val(smssvr_result.SmsSvrDBPort);
		$("#SmsSvrDBUserName").val(smssvr_result.SmsSvrDBUserName);
		$("#SmsSvrDBPassword").val(smssvr_result.SmsSvrDBPassword);
		$("#SmsSvrDBDatabase").val(smssvr_result.SmsSvrDBDatabase);
		if (smssvr_result.SmsSvrDBInsertTemp != null){
			$("#SmsSvrDBInsertTemp").val(smssvr_result.SmsSvrDBInsertTemp);
		}
		$("#Flag_smssvr").val(smssvr_result.Flag).trigger('change');
		$("#EnCode_smssvr").val(smssvr_result.EnCode).trigger('change');
		if (smssvr_result.Flag == 2){
			$.ajax({
				url:'/bhost/get_smssvr_flag',
				type:'post',
				async:false,
				data:{a0:se},
				success:function(result){
					var smssvr_flag = JSON.parse(result);
					if (smssvr_flag.Result){
						if (smssvr_flag.count_smssvr == 2){
							$("#Flag_smssvr").attr('disabled',true);
						}
					}
				}
			})
		}
	}else{
		smssvset.SmsSvrConfigId=0;
		$.ajax({
			url:'/bhost/get_smssvr_flag',
			type:'post',
			async:false,
			data:{a0:se},
			success:function(result){
				var smssvr_flag = JSON.parse(result);
				if (smssvr_flag.Result){
					if (smssvr_flag.count_smssvr == 1){
						$("#Flag_smssvr").val(2).trigger('change');
						$("#Flag_smssvr").attr('disabled',true);
					}else if (smssvr_flag.def_smssvr == 0){
						$("#Flag_smssvr").val(2).trigger('change');
					}else if (smssvr_flag.spare_smssvr == 0){
						$("#Flag_smssvr").val(1).trigger('change');
					}else{
						$("#Flag_smssvr").val(0).trigger('change');
					}
				}
			}
		})
	}
}

function temp_check(obj){
	var v = $(obj).val();
	var $i = $(obj).next('i.v-check');
	if (v.indexOf("%phone%") === -1 || v.indexOf("%content%") === -1){
		$i.show().attr('class','v-check v-wrong');
	}else{
		$i.show().attr('class','v-check v-right');
	}
}

//保存配置
function smssvr_save(d,flag){
	var numCheck = /\D/;
	var SmsSvrConfigName = $("#SmsSvrConfigName").val();
	var SmsSvrDBType = $("#SmsSvrDBType").val();
	var SmsSvrDBServerIP = $("#SmsSvrDBServerIP").val();
	var SmsSvrDBPort = $("#SmsSvrDBPort").val();
	var SmsSvrDBUserName = $("#SmsSvrDBUserName").val();
	var SmsSvrDBPassword = $("#SmsSvrDBPassword").val();
	var SmsSvrDBDatabase = $("#SmsSvrDBDatabase").val();
	var SmsSvrDBInsertTemp = $("#SmsSvrDBInsertTemp").val();
	if (SmsSvrConfigName == ""){
		_alert(2,"短信网关","请输入名称",$("#SmsSvrConfigName"));
		return false;
	}else{
		if (!nameCheck.test(SmsSvrConfigName)){
			_alert(1,"短信网关","名称格式不正确",$("#SmsSvrConfigName"));
			return false;
		}
	}
	if (SmsSvrDBServerIP == ""){
		_alert(2,"短信网关","请输入服务器地址",$("#SmsSvrDBServerIP"));
		return false;
	}else{
		if (!ipcheck_route.test(SmsSvrDBServerIP)){
			_alert(1,"短信网关","服务器地址格式不正确",$("#SmsSvrDBServerIP"));
			return false;
		}
	}
	if (SmsSvrDBPort == ""){
		_alert(2,"短信网关","请输入端口",$("#SmsSvrDBPort"));
		return false;
	}else{
		if (numCheck.test(SmsSvrDBPort)){
			_alert(1,"短信网关","端口格式不正确",$("#SmsSvrDBPort"));
			return false;
		}
		if (parseInt(SmsSvrDBPort) > 65534){
			_alert(1,"短信网关","端口不能大于65534",$("#SmsSvrDBPort"));
			return false;
		}
		if (parseInt(SmsSvrDBPort) < 1){
			_alert(1,"短信网关","端口不能小于1",$("#SmsSvrDBPort"));
			return false;
		}
	}
	if (SmsSvrDBUserName == ""){
		_alert(2,"短信网关","请输入账号",$("#SmsSvrDBUserName"));
		return false;
	}else{
		if (!nameCheck.test(SmsSvrDBUserName)){
			_alert(1,"短信网关","账号格式不正确",$("#SmsSvrDBUserName"));
			return false;
		}
	}
	if (SmsSvrDBPassword == ""){
		_alert(2,"短信网关","请输入密码",$("#SmsSvrDBPassword"));
		return false;
	}
	if (SmsSvrDBDatabase == ""){
		_alert(2,"短信网关","请输入数据库",$("#SmsSvrDBDatabase"));
		return false;
	}
	if (SmsSvrDBInsertTemp == ""){
		_alert(2,"短信网关","请输入短信sql语句模板",$("#SmsSvrDBInsertTemp"));
		return false;
	}else{
		if (SmsSvrDBInsertTemp.indexOf("%phone%") === -1 || SmsSvrDBInsertTemp.indexOf("%content%") === -1){
			_alert(1,"短信网关","模板格式不正确",$("#SmsSvrDBInsertTemp"));
			return false;
		}
	}
	smssvset.SmsSvrConfigName = SmsSvrConfigName;
	smssvset.SmsSvrDBType = SmsSvrDBType;
	smssvset.SmsSvrDBServerIP = SmsSvrDBServerIP;
	smssvset.SmsSvrDBPort = SmsSvrDBPort;
	smssvset.SmsSvrDBUserName = SmsSvrDBUserName;
	smssvset.SmsSvrDBPassword = SmsSvrDBPassword;
	smssvset.SmsSvrDBDatabase = SmsSvrDBDatabase;
	smssvset.SmsSvrDBInsertTemp = SmsSvrDBInsertTemp;
	smssvset.Flag = parseInt($("#Flag_smssvr").val());
	smssvset.EnCode = parseInt($("#EnCode_smssvr").val());
	var msstr = aceg(JSON.stringify(smssvset),se);
	$.ajax({
		url:'/bhost/save_smssvr',
		type:'post',
		async:false,
		data:{a0:se,z1:JSON.stringify(smssvset),a10:"运维管理>指令授权",m1:msstr},
		success:function(result){
			data = JSON.parse(result);
			if (data.Result == true){
				parent.layer.open({
					type:1,
					title:"短信网关",
					content:'<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
					btn:['确&nbsp;&nbsp;定'],
					btnAlign:'c',
					closeBtn: false,
					skin:'layer-custom',
					area:['380px','310px'],
					move: false,
					resize: false,
					btn1:function(i){
						parent.layer.close(i);
						$('.btn').blur();
						var smssvr_text1 = $('#smssvr_div1').find('span').text();
						var smssvr_text2 = $('#smssvr_div2').find('span').text();
						var smssvr_id1 = $('#smssvr_div1').data('value');
						var smssvr_id2 = $('#smssvr_div2').data('value');
						$("div[data-id=xSelect-smssvr_div1]").remove();
						$("div[data-id=xSelect-smssvr_div2]").remove();
						bind_smssvr_select();
						if (flag == 1){
							if ($("#smssvr_div1").data('value') == "-1" || $("#smssvr_div1").data('value') == undefined){
								smssvr_id1 = data.SmsSvrConfigId;
							}
						}else{
							if ($("#smssvr_div2").data('value') == "-1" || $("#smssvr_div2").data('value') == undefined){
								smssvr_id2 = data.SmsSvrConfigId;
							}
						}
						$(".xSelect-smssvr_div1").find('span[data-value='+smssvr_id1+']').click();
						$(".xSelect-smssvr_div2").find('span[data-value='+smssvr_id2+']').click();
						/*
						if (flag == 1){
							if ($("#smssvr_div1").data('value') == "-1" || $("#smssvr_div1").data('value') == undefined){
								//$("#smssvr_div1").data('value',data.SmsSvrConfigId);
								//$("#smssvr_div1").find('span').text(smssvset.SmsSvrConfigName);
								$(".xSelect-smssvr_div1").find('span[data-value='+data.SmsSvrConfigId+']').click();
							}else{
								//$('#smssvr_div1').find('span').text(smssvr_text1);
								$(".xSelect-smssvr_div1").find('span[data-value='+smssvr_id1+']').click();
							}
							if (smssvr_id2 != undefined && smssvr_id2 != '-1'){
								//$("#smssvr_div2").data('value',smssvr_id2);
								//$("#smssvr_div2").find('span').text(smssvr_text2);
								$(".xSelect-smssvr_div2").find('span[data-value='+smssvr_id2+']').click();
							}
						}else{
							if ($("#smssvr_div2").data('value') == "-1" || $("#smssvr_div2").data('value') == undefined){
								//$("#smssvr_div2").data('value',data.SmsSvrConfigId);
								//$("#smssvr_div2").find('span').text(smssvset.SmsSvrConfigName);
								$(".xSelect-smssvr_div2").find('span[data-value='+data.SmsSvrConfigId+']').click();
							}else{
								//$('#smssvr_div2').find('span').text(smssvr_text2);
								$(".xSelect-smssvr_div2").find('span[data-value='+smssvr_id2+']').click();
							}
							if (smssvr_id1 != undefined && smssvr_id1 != '-1'){
								//$("#smssvr_div1").data('value',smssvr_id1);
								//$("#smssvr_div1").find('span').text(smssvr_text1);
								$(".xSelect-smssvr_div2").find('span[data-value='+smssvr_id1+']').click();
							}
						}
						*/
						d.close().remove();
					},
					btn2:function(i){
						parent.layer.close(i);
					}
				});	
			}else{
				_alert(1,"短信网关","执行失败：" + data.ErrMsg);
			}
		}
	});
}

//snmp
var	xsel_snmp_id1_pre = [-1];
var	xsel_snmp_id2_pre = [-1];
function bind_snmp_select(){
	var snmp_array1 = [0];
	var snmp_array2 = [0];
	xsel_snmp_id1_pre[0] = -1;
	xsel_snmp_id2_pre[0] = -1;
	var snmp_data;
	$.ajax({
		url:'/bhost/select_snmp_all',
		type:'post',
		async:false,
		data:{a0:se,z1:-1},
		success:function(result){
			snmp_data = JSON.parse(result);
		}
	});
	var snmp_array = [];
	snmp_array.push({'value':-1,'name':'全局指定','type':null});
	$.each(snmp_data.data,function(i,item){
		if (manage_auth_array.indexOf(24) != -1){
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'edit'
			};
		}else{
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'check'
			};
		}
		select_data_json.value = item.SnmpConfigId;
		select_data_json.name = item.SnmpConfigName;
		snmp_array.push(select_data_json);
		snmp_array1.push(item.SnmpConfigId);
		snmp_array2.push(item.SnmpConfigId);
	});
	$(".xSelect-snmp_div1").remove();
	$("#snmp_div1").empty().data("xSelect","");
	
	if (manage_auth_array.indexOf(24) != -1){
		$("#snmp_div1").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:snmp_array,
			module_type:"snmp_div1",
			edit: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode10(obj,1,1);
			},
			btn:[
				{
					'name':'新增',
					'event': function(items,obj){
												$(obj).parents('.xSelect-view').hide();
						_editNode10(obj,2,1);
					}
				}
			],
			setval:function(item,obj){
				var xsel_id1 = $(obj).find('span').data('value');
				change_mail_option(1,snmp_array,$(".xSelect-snmp_div2"),snmp_array2,xsel_id1,xsel_snmp_id1_pre);
			}
		});
	}else{
		$("#snmp_div1").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:snmp_array,
			module_type:"snmp_div1",
			check: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode10(obj,1,1);
			},
			setval:function(item,obj){
				var xsel_id1 = $(obj).find('span').data('value');
				change_mail_option(1,snmp_array,$(".xSelect-snmp_div2"),snmp_array2,xsel_id1,xsel_snmp_id1_pre);
			}
		});
	}
	
	$("#snmp_div1").data('value',-1);
	$(".xSelect-snmp_div2").remove();
	$("#snmp_div2").empty().data("xSelect","");
	if (manage_auth_array.indexOf(24) != -1){
		$("#snmp_div2").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:snmp_array,
			module_type:"snmp_div2",
			edit: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode10(obj,1,2);
			},
			btn:[
				{
					'name':'新增',
					'event': function(items,obj){
												$(obj).parents('.xSelect-view').hide();
						_editNode10(obj,2,2);
					}
				}
			],
			setval:function(item,obj){
				var xsel_id2 = $(obj).find('span').data('value');
				change_mail_option(2,snmp_array,$(".xSelect-snmp_div1"),snmp_array1,xsel_id2,xsel_snmp_id2_pre);
			}
		});
	}else{
		$("#snmp_div2").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:snmp_array,
			module_type:"snmp_div2",
			check: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode10(obj,1,2);
			},
			setval:function(item,obj){
				var xsel_id2 = $(obj).find('span').data('value');
				change_mail_option(2,snmp_array,$(".xSelect-snmp_div1"),snmp_array1,xsel_id2,xsel_snmp_id2_pre);
			}
		});
	}
	
	$("#snmp_div2").data('value',-1);
}

function clear_snmp(){
	$("#snmp_suspend").find('input').val('');
	$("#SnmpConfigName").attr('disabled',false);
	$("#snmp_suspend").find('i.v-check').attr('class','v-check');
	$("#EnCode_snmp").val(0).trigger('change');
	$("#Flag_snmp").val(2).trigger('change');
	//xsel_snmp_id1_pre[0] = -1;
	//xsel_snmp_id2_pre[0] = -1;
}

var snmp_result;
function _editNode10(obj,type,flag){
	clear_snmp();
	var title;
	if (type == 1){
		//approveId = $(obj).parent().children('a').attr('id');
		snmpId = $(obj).children('span').data('value');
		$.ajax({
			url: "/bhost/select_snmp_all",
			type: "POST",
			async: false,
			data: { a0: se, z1: snmpId},
			success: function (result) {
				snmp_result = JSON.parse(result);
				snmp_result = snmp_result.data[0];	
				title = "SNMP";
			}
		});
	}else{
		snmpId = 0;
		title = "SNMP";
	}
	
	var $dialogCont = $("#snmp_suspend").show();
	
	var d = dialog({
		title:title,
		content:$dialogCont,
		id:"snmp_suspend",
		width:"800px"
	});
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	d.showModal();
	snmp_main(type);
	$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
		clear_snmp();
		snmp_main(type);
		//d.close().remove();
	});
	
	$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
		snmp_save(d,flag);
	});
}

var snmp = {
	"SnmpConfigId": 0, 
	"SnmpConfigName": "SYSLOG配置1",           
	"SnmpServerIP": "192.168.0.54",
	"SnmpPort": 514,
	"Flag":0,
	"EnCode":0
}

function snmp_main(type){
	if (manage_auth_array.indexOf(24) === -1){
		$("#snmp_suspend").find(".btn-submit").remove();
	}
	$("#SnmpPort").bind('keydown', function(e){
		DigitInput(e);
	});
	if (type == 1){
		snmp.SnmpConfigId = snmp_result.SnmpConfigId;
		$("#SnmpConfigName").val(snmp_result.SnmpConfigName);
		$("#SnmpConfigName").prop("disabled",true);
		$("#SnmpServerIP").val(snmp_result.SnmpServerIP);
		$("#SnmpPort").val(snmp_result.SnmpPort);
		$("#EnCode_snmp").val(snmp_result.EnCode).trigger('change');
		$("#Flag_snmp").val(snmp_result.Flag).trigger('change');
		if (snmp_result.Flag == 2){
			$.ajax({
				url:'/bhost/get_snmp_flag',
				type:'post',
				async:false,
				data:{a0:se},
				success:function(result){
					var snmp_flag = JSON.parse(result);
					if (snmp_flag.Result){
						if (snmp_flag.count_snmp == 2){
							$("#Flag_snmp").attr('disabled',true);
						}					
					}
				}
			})
		}
	}else{
		snmp.SnmpConfigId = 0;
		$.ajax({
			url:'/bhost/get_snmp_flag',
			type:'post',
			async:false,
			data:{a0:se},
			success:function(result){
				var snmp_flag = JSON.parse(result);
				if (snmp_flag.Result){
					if (snmp_flag.count_snmp == 1){
						$("#Flag_snmp").val(2).trigger('change');
						$("#Flag_snmp").attr('disabled',true);
					}else if (snmp_flag.def_snmp == 0){
						$("#Flag_snmp").val(2).trigger('change');
					}else if (snmp_flag.spare_snmp == 0){
						$("#Flag_snmp").val(1).trigger('change');
					}else{
						$("#Flag_snmp").val(0).trigger('change');
					}
				}
			}
		})
	}
}

function PortCheck(obj){
	var numCheck = /\D/;
	var num = $(obj).val().trim();
	var $i = $(obj).next('i.v-check');
	if (numCheck.test(num) || num == "" || parseInt(num) < 1 || parseInt(num) > 65534){	
		$i.show().attr('class','v-check v-wrong');
	}else{
		$i.show().attr('class','v-check v-right');
	}
}
//保存配置
function snmp_save(d,flag){
	var numCheck = /\D/;
	var snmp_list = [];
	var isexist;
	var SnmpConfigName = $("#SnmpConfigName").val();
	var SnmpServerIP = $("#SnmpServerIP").val();
	var SnmpPort = $("#SnmpPort").val();
	var Flag = $("#Flag_snmp").val();
	var EnCode = $("#EnCode_snmp").val();
	
	if (SnmpConfigName == ""){
		_alert(2,"SNMP","请输入名称",$("#SnmpConfigName"));
		return false;
	}else{
		if (!nameCheck.test(SnmpConfigName)){
			_alert(1,"SNMP","名称格式不正确",$("#SnmpConfigName"));
			return false;
		}
	}

	if (SnmpServerIP == ""){
		_alert(2,"SNMP","请输入服务器地址",$("#SnmpServerIP"));
		return false;
	}else{
		if (!ipcheck_route.test(SnmpServerIP)){
			_alert(1,"SNMP","服务器地址格式不正确",$("#SnmpServerIP"));
			return false;
		}
	}
	if (SnmpPort == ""){
		_alert(2,"SNMP","请输入端口",$("#SnmpPort"));
		return false
	}else{
		if (numCheck.test(parseInt(SnmpPort))){
			_alert(1,"SNMP","端口格式不正确",$("#SnmpPort"));
			return false;
		}
		if (parseInt(SnmpPort) < 1){
			_alert(1,"SNMP","端口不能小于1",$("#SnmpPort"));
			return false;
		}
		if (parseInt(SnmpPort) > 65534){
			add = 1;
			_alert(1,"SNMP","端口不能大于65534",$("#SnmpPort"));
			return false;
		}
	}
	snmp.SnmpConfigName = SnmpConfigName;
	snmp.SnmpServerIP = SnmpServerIP;
	snmp.SnmpPort = parseInt(SnmpPort);
	snmp.Flag = parseInt(Flag);
	snmp.EnCode = parseInt(EnCode);
	snmp_list.push(JSON.stringify(snmp));
	var msstr = aceg(JSON.stringify(snmp_list),se);
	$.ajax({
		url:'/bhost/save_snmp',
		type:'post',
		async:false,
		data:{a0:se,z1:JSON.stringify(snmp_list),a10:"运维管理>指令授权",m1:msstr},
		success:function(result){
			data = JSON.parse(result);
			if (data.Result == true){
				parent.layer.open({
					type:1,
					title:"SNMP",
					content:'<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
					btn:['确&nbsp;&nbsp;定'],
					btnAlign:'c',
					closeBtn: false,
					skin:'layer-custom',
					area:['380px','310px'],
					move: false,
					resize: false,
					btn1:function(i){
						parent.layer.close(i);
						$('.btn').blur();
						var snmp_text1 = $('#snmp_div1').find('span').text();
						var snmp_text2 = $('#snmp_div2').find('span').text();
						var snmp_id1 = $('#snmp_div1').data('value');
						var snmp_id2 = $('#snmp_div2').data('value');
						$("div[data-id=xSelect-snmp_div1]").remove();
						$("div[data-id=xSelect-snmp_div2]").remove();
						bind_snmp_select();
						if (flag == 1){
							if ($("#snmp_div1").data('value') == "-1" || $("#snmp_div1").data('value') == undefined){
								snmp_id1 = data.SnmpConfigId;
							}
						}else{
							if ($("#snmp_div2").data('value') == "-1" || $("#snmp_div2").data('value') == undefined){
								snmp_id2 = data.SnmpConfigId;
							}
						}
						$(".xSelect-snmp_div1").find('span[data-value='+snmp_id1+']').click();
						$(".xSelect-snmp_div2").find('span[data-value='+snmp_id2+']').click();
						/*
						if (flag == 1){
							if ($("#snmp_div1").data('value') == "-1" || $("#snmp_div1").data('value') == undefined){
								//$("#snmp_div1").data('value',data.SnmpConfigId);
								//$("#snmp_div1").find('span').text(snmp.SnmpConfigName);
								$(".xSelect-snmp_div1").find('span[data-value='+data.SnmpConfigId+']').click();
							}else{
								//$('#snmp_div1').find('span').text(snmp_text1);
								$(".xSelect-snmp_div1").find('span[data-value='+snmp_id1+']').click();
							}
							if (snmp_id2 != undefined && snmp_id2 != '-1'){
								//$("#snmp_div2").data('value',snmp_id2);
								//$("#snmp_div2").find('span').text(snmp_text2);
								$(".xSelect-snmp_div2").find('span[data-value='+snmp_id2+']').click();
							}
						}else{
							if ($("#snmp_div2").data('value') == "-1" || $("#snmp_div2").data('value') == undefined){
								//$("#snmp_div2").data('value',data.SnmpConfigId);
								//$("#snmp_div2").find('span').text(snmp.SnmpConfigName);
								$(".xSelect-snmp_div2").find('span[data-value='+data.SnmpConfigId+']').click();
							}else{
								//$('#snmp_div2').find('span').text(snmp_text2);
								$(".xSelect-snmp_div2").find('span[data-value='+snmp_id2+']').click();
							}
							if (snmp_id1 != undefined && snmp_id1 != '-1'){
								//$("#snmp_div1").data('value',snmp_id1);
								//$("#snmp_div1").find('span').text(snmp_text1);
								$(".xSelect-snmp_div1").find('span[data-value='+snmp_id1+']').click();
							}
						}
						*/
						d.close().remove();
					},
					btn2:function(i){
						parent.layer.close(i);
					}
				});	
			}else{
				_alert(1,"SNMP","执行失败：" + data.ErrMsg);
			}
		}
	});
}

//SYSLOG
var	xsel_syslog_id1_pre = [-1];
var	xsel_syslog_id2_pre = [-1];
function bind_syslog_select(){
	var syslog_array1 = [0];
	var syslog_array2 = [0];
	xsel_syslog_id1_pre[0] = -1;
	xsel_syslog_id2_pre[0] = -1;
	var syslog_data;
	$.ajax({
		url:'/bhost/select_syslog_all',
		type:'post',
		async:false,
		data:{a0:se,z1:-1},
		success:function(result){
			syslog_data = JSON.parse(result);
		}
	});
	var syslog_array = [];
	syslog_array.push({'value':-1,'name':'全局指定','type':null});
	$.each(syslog_data.data,function(i,item){
		if (manage_auth_array.indexOf(24) != -1){
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'edit'
			};
		}else{
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'check'
			};
		}
		select_data_json.value = item.SyslogConfigId;
		select_data_json.name = item.SyslogConfigName;
		syslog_array.push(select_data_json);
		syslog_array1.push(item.SyslogConfigId);
		syslog_array2.push(item.SyslogConfigId);
	});
	$(".xSelect-syslog_div1").remove();
	$("#syslog_div1").empty().data("xSelect","");
	
	if (manage_auth_array.indexOf(24) != -1){
		$("#syslog_div1").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:syslog_array,
			module_type:"syslog_div1",
			edit: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode11(obj,1,1);
			},
			btn:[
				{
					'name':'新增',
					'event': function(items,obj){
												$(obj).parents('.xSelect-view').hide();
						_editNode11(obj,2,1);
					}
				}
			],
			setval:function(item,obj){
				var xsel_id1 = $(obj).find('span').data('value');
				change_mail_option(1,syslog_array,$(".xSelect-syslog_div2"),syslog_array2,xsel_id1,xsel_syslog_id1_pre);
			}
		});
	}else{
		$("#syslog_div1").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:syslog_array,
			module_type:"syslog_div1",
			check: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode11(obj,1,1);
			},
			setval:function(item,obj){
				var xsel_id1 = $(obj).find('span').data('value');
				change_mail_option(1,syslog_array,$(".xSelect-syslog_div2"),syslog_array2,xsel_id1,xsel_syslog_id1_pre);
			}
		});
	}
	
	$("#syslog_div1").data('value',-1);
	$(".xSelect-syslog_div2").remove();
	$("#syslog_div2").empty().data("xSelect","");
	
	if (manage_auth_array.indexOf(24) != -1){
		$("#syslog_div2").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:syslog_array,
			module_type:"syslog_div2",
			edit: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode11(obj,1,2);
			},
			btn:[
				{
					'name':'新增',
					'event': function(items,obj){
												$(obj).parents('.xSelect-view').hide();
						_editNode11(obj,2,2);
					}
				}
			],
			setval:function(item,obj){
				var xsel_id2 = $(obj).find('span').data('value');
				change_mail_option(2,syslog_array,$(".xSelect-syslog_div1"),syslog_array1,xsel_id2,xsel_syslog_id2_pre);
			}
		});
	}else{
		$("#syslog_div2").xSelect({
			width: 162,
			defaultText: '全局指定',
			items:syslog_array,
			module_type:"syslog_div2",
			check: function(item,obj){
								$(obj).parents('.xSelect-view').hide();
				_editNode11(obj,1,2);
			},
			setval:function(item,obj){
				var xsel_id2 = $(obj).find('span').data('value');
				change_mail_option(2,syslog_array,$(".xSelect-syslog_div1"),syslog_array1,xsel_id2,xsel_syslog_id2_pre);
			}
		});
	}
	
	$("#syslog_div2").data('value',-1);
}

function clear_syslog(){
	$("#syslog_suspend").find('input').val('');
	$("#SyslogConfigName").attr('disabled',false);
	$("#syslog_suspend").find('i.v-check').attr('class','v-check');
	$("#EnCode_syslog").val(0).trigger('change');
	$("#Flag_syslog").val(2).trigger('change');
	//xsel_syslog_id1_pre[0] = -1;
	//xsel_syslog_id2_pre[0] = -1;
}

var syslog_result;
function _editNode11(obj,type,flag){
	clear_syslog();
	var title;
	if (type == 1){
		//approveId = $(obj).parent().children('a').attr('id');
		syslogId = $(obj).children('span').data('value');
		$.ajax({
			url: "/bhost/select_syslog_all",
			type: "POST",
			async: false,
			data: { a0: se, z1: syslogId},
			success: function (result) {
				syslog_result = JSON.parse(result);
				syslog_result = syslog_result.data[0];	
				title = "SYSLOG";
			}
		});
	}else{
		syslogId = 0;
		title = "SYSLOG";
	}
	
	var $dialogCont = $("#syslog_suspend").show();
	
	var d = dialog({
		title:title,
		content:$dialogCont,
		id:"syslog_suspend",
		width:"800px"
	});
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	d.showModal();
	syslog_main(type);
	$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
		clear_syslog();
		syslog_main(type);
		//d.close().remove();
	});
	
	$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
		syslog_save(d,flag);
	});
}

var syslog = {
	"SyslogConfigId": 0, 
	"SyslogConfigName": "SYSLOG配置1",           
	"SyslogServerIP": "192.168.0.54",
	"SyslogPort": 514,
	"Flag":0,
	"EnCode":0
}

function syslog_main(type){
	if (manage_auth_array.indexOf(24) === -1){
		$("#syslog_suspend").find(".btn-submit").remove();
	}
	$("#SyslogPort").bind('keydown', function(e){
		DigitInput(e);
	});
	if (type == 1){
		syslog.SyslogConfigId = syslog_result.SyslogConfigId;
		$("#SyslogConfigName").val(syslog_result.SyslogConfigName);
		$("#SyslogConfigName").prop("disabled",true);
		$("#SyslogServerIP").val(syslog_result.SyslogServerIP);
		$("#SyslogPort").val(syslog_result.SyslogPort);
		$("#Flag_syslog").val(syslog_result.Flag).trigger('change');
		$("#EnCode_syslog").val(syslog_result.EnCode).trigger('change');
		if (syslog_result.Flag == 2){
			$.ajax({
				url:'/bhost/get_syslog_flag',
				type:'post',
				async:false,
				data:{a0:se},
				success:function(result){
					var syslog_flag = JSON.parse(result);
					if (syslog_flag.Result){
						if (syslog_flag.count_syslog == 2){
							$("#Flag_syslog").attr('disabled',true);
						}			
					}
				}
			})
		}
	}else{
		syslog.SyslogConfigId = 0;
		$.ajax({
			url:'/bhost/get_syslog_flag',
			type:'post',
			async:false,
			data:{a0:se},
			success:function(result){
				var syslog_flag = JSON.parse(result);
				if (syslog_flag.Result){
					if (syslog_flag.count_syslog == 1){
						$("#Flag_syslog").val(2).trigger('change');
						$("#Flag_syslog").attr('disabled',true);
					}else if (syslog_flag.def_syslog == 0){
						$("#Flag_syslog").val(2).trigger('change');
					}else if (syslog_flag.spare_syslog == 0){
						$("#Flag_syslog").val(1).trigger('change');
					}else{
						$("#Flag_syslog").val(0).trigger('change');
					}
				}
			}
		})
	}
}

function syslog_save(d,flag){
	var numCheck = /\D/;
	var syslog_list = [];
	var SyslogConfigName = $("#SyslogConfigName").val();
	var SyslogServerIP = $("#SyslogServerIP").val();
	var SyslogPort = $("#SyslogPort").val();
	var EnCode = $("#EnCode_syslog").val();
	var Flag = $("#Flag_syslog").val();
	if (SyslogConfigName == ""){
		_alert(2,"SYSLOG","请输入名称",$("#SyslogConfigName"));
		return false;
	}else{
		if (!nameCheck.test(SyslogConfigName)){
			_alert(1,"SYSLOG","名称格式不正确",$("#SyslogConfigName"));
			return false;
		}
	}

	if (SyslogServerIP == ""){
		_alert(2,"SYSLOG","请输入服务器地址",$("#SyslogServerIP"));
		return false;
	}else{
		if (!ipcheck_route.test(SyslogServerIP)){
			_alert(2,"SYSLOG","服务器地址不正确",$("#SyslogServerIP"));
			return false;
		}
	}
	if (SyslogPort == ""){
		_alert(2,"SYSLOG","请输入端口",$("#SyslogPort"));
		return false
	}else{
		if (numCheck.test(parseInt(SyslogPort))){
			_alert(1,"SYSLOG","端口不正确",$("#SyslogPort"));
			return false;
		}
		if (parseInt(parseInt(SyslogPort)) < 1){
			_alert(1,"SYSLOG","端口不能小于1",$("#SyslogPort"));
			return false;
		}
		if (parseInt(parseInt(SyslogPort)) > 65534){
			_alert(1,"SYSLOG","端口不能大于65534",$("#SyslogPort"));
			return false;
		}
	}
	syslog.SyslogConfigName = SyslogConfigName;
	syslog.SyslogServerIP = SyslogServerIP;
	syslog.SyslogPort = parseInt(SyslogPort);
	syslog.EnCode = parseInt(EnCode);
	syslog.Flag = parseInt(Flag);	
	syslog_list.push(JSON.stringify(syslog));
	var msstr = aceg(JSON.stringify(syslog_list),se);
	$.ajax({
		url:'/bhost/save_syslog',
		type:'post',
		async:false,
		data:{a0:se,z1:JSON.stringify(syslog_list),a10:"运维管理>指令授权",m1:msstr},
		success:function(result){
			data = JSON.parse(result);
			if (data.Result == true){
				parent.layer.open({
					type:1,
					title:"SYSLOG",
					content:'<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
					btn:['确&nbsp;&nbsp;定'],
					btnAlign:'c',
					closeBtn: false,
					skin:'layer-custom',
					area:['380px','310px'],
					move: false,
					resize: false,
					btn1:function(i){
						parent.layer.close(i);
						$('.btn').blur();
						var syslog_text1 = $('#syslog_div1').find('span').text();
						var syslog_text2 = $('#syslog_div2').find('span').text();
						var syslog_id1 = $('#syslog_div1').data('value');
						var syslog_id2 = $('#syslog_div2').data('value');
						$("div[data-id=xSelect-syslog_div1]").remove();
						$("div[data-id=xSelect-syslog_div2]").remove();
						bind_syslog_select();
						if (flag == 1){
							if ($("#syslog_div1").data('value') == "-1" || $("#syslog_div1").data('value') == undefined){
								syslog_id1 = data.SyslogConfigId;
							}
						}else{
							if ($("#syslog_div2").data('value') == "-1" || $("#syslog_div2").data('value') == undefined){
								syslog_id2 = data.SyslogConfigId;
							}
						}
						$(".xSelect-syslog_div1").find('span[data-value='+syslog_id1+']').click();
						$(".xSelect-syslog_div2").find('span[data-value='+syslog_id2+']').click();
						/*
						if (flag == 1){
							if ($("#syslog_div1").data('value') == "-1" || $("#syslog_div1").data('value') == undefined){
								//$("#syslog_div1").data('value',data.SyslogConfigId);
								//$("#syslog_div1").find('span').text(syslog.SyslogConfigName);
								$(".xSelect-syslog_div1").find('span[data-value='+data.SyslogConfigId+']').click();
							}else{
								//$('#syslog_div1').find('span').text(syslog_text1);
								$(".xSelect-syslog_div1").find('span[data-value='+syslog_id1+']').click();
							}
							if (syslog_id2 != undefined && syslog_id2 != '-1'){
								//$("#syslog_div2").data('value',syslog_id2);
								//$("#syslog_div2").find('span').text(syslog_text2);
								$(".xSelect-syslog_div2").find('span[data-value='+syslog_id2+']').click();
							}
						}else{
							if ($("#syslog_div2").data('value') == "-1" || $("#syslog_div2").data('value') == undefined){
								//$("#syslog_div2").data('value',data.SyslogConfigId);
								//$("#syslog_div2").find('span').text(syslog.SyslogConfigName);
								$(".xSelect-syslog_div2").find('span[data-value='+data.SyslogConfigId+']').click();
							}else{
								//$('#syslog_div2').find('span').text(syslog_text2);
								$(".xSelect-syslog_div2").find('span[data-value='+syslog_id2+']').click();
							}
							if (syslog_id1 != undefined && syslog_id1 != '-1'){
								//$("#syslog_div1").data('value',syslog_id1);
								//$("#syslog_div1").find('span').text(syslog_text1);
								$(".xSelect-syslog_div1").find('span[data-value='+syslog_id1+']').click();
							}
						}
						*/
						d.close().remove();	
					},
					btn2:function(i){
						parent.layer.close(i);
					}
				});	
			}else{
				_alert(1,"SYSLOG","执行失败：" + data.ErrMsg);
			}
		}
	});
}



function eventinfomain(type){
	if (manage_auth_array.indexOf(15) === -1 && manage_auth_array.indexOf(16) === -1 && manage_auth_array.indexOf(17) === -1 &&manage_auth_array.indexOf(32) === -1){
		$("#eventinfo_suspend").find('.btn-submit').remove();
	}
	$("#AlarmReceiver").on("ifChecked", function (e) {
		$("#AlarmReceiver_text").show();
		$("#AlarmReceiver_input").find('input').focus();
	});
	$("#AlarmReceiver").on("ifUnchecked", function (e) {
		$("#AlarmReceiver_text").hide();
		$("#AlarmReceiver_input").find('input').blur();
	});
	$("#AlarmReceiver1").on("ifChecked", function (e) {
		$("#AlarmReceiver_text1").show();
		$("#AlarmReceiver_input1").find('input').focus();
	});
	$("#AlarmReceiver1").on("ifUnchecked", function (e) {
		$("#AlarmReceiver_text1").hide();
		$("#AlarmReceiver_input1").find('input').blur();
	});
	$("#AlarmAction").change(function () {
		var AlarmAction_i = $(this).children("option:selected").val();
		if (AlarmAction_i == 1) {
			$("#label_list").show();
			if ($("#label_list").children('div.item').length == 1){
				$("#admin_check").show();
			}
			$('#AlarmReceiver_div').show();
			$("#label_list1").hide();
			$('#AlarmReceiver_div1').hide();
			$('#AlarmReceiver_span').show();
			phone_or_emailcheck=emailcheck;
			phone_or_email='邮件地址';
		} else if (AlarmAction_i == 2 || AlarmAction_i == 3) {
			$("#label_list1").show();
			if ($("#label_list1").children('div.item').length == 1){
				$("#admin_check1").show();
			}
			$('#AlarmReceiver_div1').show();
			$("#label_list").hide();
			$('#AlarmReceiver_div').hide();
			$('#AlarmReceiver_span').show();
			phone_or_emailcheck=phonecheck;
			phone_or_email='手机号码';
		} else {
			$("#label_list1").hide();
			$('#AlarmReceiver_div1').hide();
			$("#label_list").hide();
			$('#AlarmReceiver_div').hide();
			$('#AlarmReceiver_span').hide();
		}
		if (AlarmAction_i == 0) {
			$("#Description_imp").hide();
			$("#mail1_div").hide();
			$("#mail2_div").hide();
			$("#smsm1_div").hide();
			$("#smsm2_div").hide();
			$("#smssvr1_div").hide();
			$("#smssvr2_div").hide();
			$("#snmp1_div").hide();
			$("#snmp2_div").hide();
			$("#syslog1_div").hide();
			$("#syslog2_div").hide();
		} else {
			$("#Description_imp").show();
		}
		if (AlarmAction_i == 1) {
			$("#mail1_div").show();
			$("#mail2_div").show();
			$("#smsm1_div").hide();
			$("#smsm2_div").hide();
			$("#smssvr1_div").hide();
			$("#smssvr2_div").hide();
			$("#snmp1_div").hide();
			$("#snmp2_div").hide();
			$("#syslog1_div").hide();
			$("#syslog2_div").hide();
		}else if (AlarmAction_i == 2){
			$("#mail1_div").hide();
			$("#mail2_div").hide();
			$("#smsm1_div").show();
			$("#smsm2_div").show();
			$("#smssvr1_div").hide();
			$("#smssvr2_div").hide();
			$("#snmp1_div").hide();
			$("#snmp2_div").hide();
			$("#syslog1_div").hide();
			$("#syslog2_div").hide();
		}else if (AlarmAction_i == 3){
			$("#mail1_div").hide();
			$("#mail2_div").hide();
			$("#smsm1_div").hide();
			$("#smsm2_div").hide();
			$("#smssvr1_div").show();
			$("#smssvr2_div").show();
			$("#snmp1_div").hide();
			$("#snmp2_div").hide();
			$("#syslog1_div").hide();
			$("#syslog2_div").hide();
		}else if (AlarmAction_i == 4){
			$("#mail1_div").hide();
			$("#mail2_div").hide();
			$("#smsm1_div").hide();
			$("#smsm2_div").hide();
			$("#smssvr1_div").hide();
			$("#smssvr2_div").hide();
			$("#snmp1_div").show();
			$("#snmp2_div").show();
			$("#syslog1_div").hide();
			$("#syslog2_div").hide();
		}else if (AlarmAction_i == 5){
			$("#mail1_div").hide();
			$("#mail2_div").hide();
			$("#smsm1_div").hide();
			$("#smsm2_div").hide();
			$("#smssvr1_div").hide();
			$("#smssvr2_div").hide();
			$("#snmp1_div").hide();
			$("#snmp2_div").hide();
			$("#syslog1_div").show();
			$("#syslog2_div").show();
		}
	});
	$('#admin_select').on('change', function () {
				if ($('#admin_select').find('option').length == 2 && $('#admin_select option:selected').val() != '0') {
			_addadmin($('#admin_select').siblings('i'));
			$('#admin_check').hide();
		} else if ($('#admin_select').find('option').length == 1) {
			$('#admin_check').hide();
		} else {
			$('#admin_check').show();
		}
	});
	$('#admin_select1').on('change', function () {
				if ($('#admin_select1').find('option').length == 2 && $('#admin_select1 option:selected').val() != '0') {
			_addadmin($('#admin_select1').siblings('i'));
			$('#admin_check1').hide();
		} else if ($('#admin_select1').find('option').length == 1) {
			$('#admin_check1').hide();
		} else {
			$('#admin_check1').show();
		}
	});
	//用户列表
	$.ajax({
		url: "/bhost/get_user_list",
		type: "POST",
		async: false,
		data: { a0: se},
		success: function (result) {
			var userinfo_result = JSON.parse(result);
			if (userinfo_result.Result == true) {
				var userinfo_data = userinfo_result.info;
				$("#admin_select").append("<option value=\"0\">请选择</option>");
				$("#admin_select1").append("<option value=\"0\">请选择</option>");
				$.each(userinfo_data, function (i, item) {
					if(item.Email!="" && item.Email!=null){
						$("#admin_select").append("<option value=\"" + item.UserId + "\" index=\"0\">" + item.UserCode + "</option>");
						all_option_str_1[item.UserId] = "<option value=\"" + item.UserId + "\" index=\"0\">" + item.UserCode + "</option>";
					}
					if(item.MobilePhone!="" && item.MobilePhone!=null){
						$("#admin_select1").append("<option value=\"" + item.UserId + "\" index=\"0\">" + item.UserCode + "</option>");
						all_option_str_2[item.UserId] = "<option value=\"" + item.UserId + "\" index=\"0\">" + item.UserCode + "</option>";
					}
				});
			}else{
				_alert(1,'事件告警',userinfo_result.ErrMsg);
				return false;
			}
		}
	});

	bind_mail_select();
	
	//bind_smsm_select();
	
	bind_smssvr_select();
	
	bind_snmp_select();
	
	bind_syslog_select();
	//编辑页面
	//var tasktype = document.frm_eventinfo_add.tasktype.value;
	//if (tasktype == "2") {
	if (type == 1){
		$("#e_n").val(eventinfo_data.Name);
		$("#e_n").attr("disabled", true);
		$("#Description").val(eventinfo_data.EventDescription);
		$("#EventLevel").val(eventinfo_data.EventLevel).trigger("change");;
		$("#EventType").val(eventinfo_data.EventType).trigger("change");;
		$("#AlarmAction").val(eventinfo_data.AlarmAction).trigger("change");
		var $select_div1;
		var $select_div2;
		if (eventinfo_data.AlarmAction == 1){
			$select_div1 = $('.xSelect-mail_div1');
			$select_div2 = $('.xSelect-mail_div2');
		}else if (eventinfo_data.AlarmAction == 2){
			$select_div1 = $('.xSelect-smsm_div1');
			$select_div2 = $('.xSelect-smsm_div2');
		}else if (eventinfo_data.AlarmAction == 3){
			$select_div1 = $('.xSelect-smssvr_div1');
			$select_div2 = $('.xSelect-smssvr_div2');
		}else if (eventinfo_data.AlarmAction == 4){
			$select_div1 = $('.xSelect-snmp_div1');
			$select_div2 = $('.xSelect-snmp_div2');
		}else if (eventinfo_data.AlarmAction == 5){
			$select_div1 = $('.xSelect-syslog_div1');
			$select_div2 = $('.xSelect-syslog_div2');
		}
		if (eventinfo_data.MasterConfig != null){
			$select_div1.find('span[data-value='+eventinfo_data.MasterConfig+']').click();
		}
		if (eventinfo_data.StandByConfig != null){
			$select_div2.find('span[data-value='+eventinfo_data.StandByConfig+']').click();
		}
		if (eventinfo_data.AlarmAction == 1) {
			var it = '';
		} else if (eventinfo_data.AlarmAction == 2 || eventinfo_data.AlarmAction == 3) {
			var it = '1';
		}
		if (eventinfo_data.AlarmReceiver != null) {
			$("#AlarmReceiver_check" + it).iCheck('check');
			var AlarmReceiver = eventinfo_data.AlarmReceiver.split(';');
			for(var i=0;i<AlarmReceiver.length-1;i++){
				var $c = $('<div id="" name="" class="item" style="padding-top: 0px;width: 260px;" value>');
				$c.html('<input type="text" class="form-text" style="width: 193px;" value="' + AlarmReceiver[i]+ '">'
				+'<i class="ctrl del" onclick="_delphone_or_email(this)"  style="margin-top: 0px;margin-left: 4px;"></i>');
				$('#AlarmReceiver_input'+it).after($c);
			}
			$('#AlarmReceiver_input'+it).find('input').val(AlarmReceiver[i]);
		}
		if (eventinfo_data.UserSet != null) {
			for(var i=0;i<eventinfo_data.UserSet.length-1;i++){
				var item=eventinfo_data.UserSet[i];
				if (eventinfo_data.AlarmAction == 1) {
					if (all_option_str_1[item.UserId] == undefined){
						continue;
					}
					check_option_str_1[item.UserId] = all_option_str_1[item.UserId];
					all_option_str_1[item.UserId] = null;
									} else if (eventinfo_data.AlarmAction == 2 || eventinfo_data.AlarmAction == 3) {
					if (all_option_str_2[item.UserId] == undefined){
						continue;
					}
					check_option_str_2[item.UserId] = all_option_str_2[item.UserId];
					all_option_str_2[item.UserId] = null;
									}
				var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + item.UserId + '"/>');
				$c.html('<input class="form-text" type="text" style="width: 128px;" value="' + item.UserCode + '" disabled="true"><i style="margin-left: 4px;" class="ctrl del" onclick="_deladmin(this)"></i>');
				$("#admin_select" + it).parent().after($c);
				$("#admin_select" + it).find('option[value=' + item.UserId + ']').remove();
				$("#admin_select" + it).trigger('change');
			}
			if (it == '1' && all_option_str_2[eventinfo_data.UserSet[i].UserId] != undefined){
				$("#admin_select" + it).val(eventinfo_data.UserSet[i].UserId).trigger('change');
			}
			if (it != '1' && all_option_str_1[eventinfo_data.UserSet[i].UserId] != undefined){
				$("#admin_select" + it).val(eventinfo_data.UserSet[i].UserId).trigger('change');
			}
		}
	}
	$("#admin_select").select2();
	$("#admin_select1").select2();
}
//创建
function eventinfo_add(d) {
	var val = $("#e_n").val();
	var $i = $("#e_n").next('i.v-check');
	var pass = 1;
	//事件警告信息名
	if (val == "") {
		_alert(2, "事件警告信息", '请输入名称', $("#d_n"));
		return false;
	}
	if (!nameReg.test(val)) {
		_alert(1, "事件警告信息", '名称格式不正确', $("#d_n"));
		return false;
	}
	//事件描述
	var AlarmAction_i = $("#AlarmAction").children("option:selected").val();
	var Description = $("#Description").val().trim();
	if (Description == "" && AlarmAction_i != "0") {
		_alert(2, "事件警告信息", '请输入事件描述', $("#Description"));
		return false;
	}
		if (AlarmAction_i == "1") {
		var it = '';
	} else {
		var it = '1';
	}
	if (AlarmAction_i != "0"){
		//主备
		if (AlarmAction_i == "1"){
			var $select_div1 = $("#mail_div1");
			var $select_div2 = $("#mail_div2");
		}else if (AlarmAction_i == "2"){
			var $select_div1 = $("#smsm_div1");
			var $select_div2 = $("#smsm_div2");
		}else if (AlarmAction_i == "3"){
			var $select_div1 = $("#smssvr_div1");
			var $select_div2 = $("#smssvr_div2");
		}else if (AlarmAction_i == "4"){
			var $select_div1 = $("#snmp_div1");
			var $select_div2 = $("#snmp_div2");
		}else if (AlarmAction_i == "5"){
			var $select_div1 = $("#syslog_div1");
			var $select_div2 = $("#syslog_div2");
		}
		var sel_div1 = $select_div1.data('value');
		var sel_div2 = $select_div2.data('value');
		if (sel_div1 != "-1" && sel_div1 != undefined){
			eventinfo.MasterConfig = sel_div1;
			eventinfo.MasterConfigName = $select_div1.find('span').text();
		}else{
			eventinfo.MasterConfig = 0;
			eventinfo.MasterConfigName = "全局策略";
		}
		if (sel_div2 != "-1" && sel_div2 != undefined){
			eventinfo.StandByConfig = sel_div2;
			eventinfo.StandByConfigName = $select_div1.find('span').text();
		}else{
			eventinfo.StandByConfig = 0;
			eventinfo.StandByConfigName = "全局策略";
		}
	}
	//信息接受者
	if (AlarmAction_i == "1" || AlarmAction_i == "2" || AlarmAction_i == "3") {
		if ($('#label_list' + it).find('div[value]').length == 0 && !$('#AlarmReceiver_check' + it).is(':checked') && $('#admin_select' + it).val() == '0') {
			_alert(2, "事件警告信息", "请选择信息接受者");
			return false;
		}
		//手动输入
		if ($("#AlarmReceiver_check" + it).is(':checked')) {
			if ($('#AlarmReceiver_text'+it).find('div[value]').length == 0 && $('#AlarmReceiver_input'+it).find('input').val().trim()=='') {
				_alert(2, "事件警告信息", "请手动输入信息", $("#AlarmReceiver_input" + it));
				return false;
			}
			var $all=$('#AlarmReceiver_text'+it).find('div[value]');
			var len=$all.length;
			var AlarmReceiver_text = "";
			
			var a_len = $("#AlarmReceiver_text"+it).children('div').length;
									$("#AlarmReceiver_text"+it).children("div").each(function(i,item){
				var input_v = $(item).find('input').val();
				if (i == 0 && a_len != 1 && input_v == ""){
					return true;
				}
				
				if (input_v == '') {
																				pass = 0;
					_alert(2, '事件告警信息','请输入'+ phone_or_email,$(item).find('input'));
					return false;
				} else if (!phone_or_emailcheck.test(input_v)) {
					pass = 0;
					_alert(1, '事件告警信息', phone_or_email+'格式不正确',$(item).find('input'));
					return false;
				} else {
					var AlarmAction=$('#AlarmAction').val();
					if(AlarmAction=='1'){
						var it='';
					}else{
						var it='1';
					}
					$("#AlarmReceiver_text"+it).children("div").not($(item)).each(function(i1,item1){
						if (i1 < i){
							return true;
						}
						var input_v1 = $(item1).find('input').val();
						if (input_v1 == '') {
							pass = 0;
							_alert(2, '事件告警信息','请输入'+ phone_or_email,$(item1).find('input'));
							return false;
						} else if (!phone_or_emailcheck.test(input_v1)) {
							pass = 0;
							_alert(1, '事件告警信息', phone_or_email+'格式不正确',$(item1).find('input'));
							return false;
						}
						if (input_v1 == input_v){
							pass = 0;
							_alert(2, '事件告警信息','相同的'+ phone_or_email+'已存在',$(item).find('input'));
							return false;
						}
					});
					if (pass == 0){
						return false;
					}
				}
			});
			if (pass == 0){
				return false;
			}
			
			for(var j=len-1;j>=0;j--){
				var input_txt=$all.eq(j).find('input').val();
				AlarmReceiver_text=AlarmReceiver_text+input_txt+';';
			}
			var AlarmReceiver_input=$('#AlarmReceiver_input'+it).find('input').val().trim();
			if (AlarmAction_i == "1" && AlarmReceiver_input != "") {
				if(emailcheck.test(AlarmReceiver_input)){
					AlarmReceiver_text = AlarmReceiver_text + AlarmReceiver_input + ';';	
				}else{
					_alert(1, "事件警告信息", "邮箱格式不正确", $("#AlarmReceiver_input" + it).find('input'));
					return false;
				}	
			}else if (AlarmAction_i == "2" && AlarmReceiver_input != "") {
				if(phonecheck.test(AlarmReceiver_input)){
					AlarmReceiver_text = AlarmReceiver_text + AlarmReceiver_input + ';';	
				}else{
					_alert(1, "事件警告信息", "手机号码格式不正确", $("#AlarmReceiver_input" + it).find('input'));
					return false;
				}
			}
			AlarmReceiver_text = AlarmReceiver_text.substr(0, AlarmReceiver_text.length - 1);
			var AlarmReceiver = AlarmReceiver_text;

		}
	} else {
		var AlarmReceiver = null;
	}
	eventinfo.EventAlarmInfoId = eventinfoId;
	eventinfo.Name = val;
	eventinfo.EventLevel = parseInt($("#EventLevel").children("option:selected").val());
	eventinfo.EventType = parseInt($("#EventType").children("option:selected").val());
	if (Description == "") {
		Description = null;
	}
	eventinfo.EventDescription = Description;
	eventinfo.AlarmAction = parseInt(AlarmAction_i);
	eventinfo.AlarmReceiver = AlarmReceiver;
	eventinfo.UserSet = new Array();
	if (AlarmAction_i == "1") {
		var it = '';
	} else if (AlarmAction_i == "2" || AlarmAction_i == "3") {
		var it = '1';
	}
	var $all = $("#label_list" + it).find('div[value]');
	var len = $all.length;
	if (AlarmAction_i == "1" || AlarmAction_i == "2" || AlarmAction_i == "3") {
		for (var j = len - 1; j >= 0; j--) {
			var t_i = $all.eq(j).attr('value');
						if (t_i != '0') {
				var json_a = '{"UserId":' + t_i + '}';
				eventinfo.UserSet.push(JSON.parse(json_a));
			}
		}
	}
	var val = $('#admin_select' + it).val();
	if (val != '0') {
		var json_a = '{"UserId":' + val + '}';
		eventinfo.UserSet.push(JSON.parse(json_a));
	}
	var msstr = aceg(JSON.stringify(eventinfo),se);
	$.ajax({
		url: '/bhost/add_eventinfo',
		type: "POST",
		async: false,
		data: { a0: se, a1: JSON.stringify(eventinfo), a10:"运维管理>指令授权",m1:msstr},
		success: function (result) {
			var result = JSON.parse(result);
			if (result.Result == true) {
				$('.btn').blur();parent.layer.open({
					type: 1,
					title: '事件警告信息',
					content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
					btn: ['确&nbsp;&nbsp;定'],
					btnAlign: 'c',
					closeBtn: false,
					skin: 'layer-custom',
					area: ['380px', '310px'],
					move: false,
					resize: false,
					yes: function (i) {
						$('.btn').blur();parent.layer.close(i);
						var alarm_text = $('#EventAlarmInfoId').find('span').text();
						$("div[data-id=xSelect-alarm]").remove();
						$('#EventAlarmInfoId').empty().data('xSelect','');
						bind_alarm_xSelect();
						if ($("#EventAlarmInfoId").data('value') == "-1" || $("#EventAlarmInfoId").data('value') == undefined){
							$("#EventAlarmInfoId").data('value',result.EventAlarmInfoId);
							$("#EventAlarmInfoId").find('span').text(eventinfo.Name);
						}else{
							$('#EventAlarmInfoId').find('span').text(alarm_text);
						}
						d.close().remove();
					}
				});
			} else {
				_alert(2, "事件警告信息", "执行失败：" + result.ErrMsg, $("#e_n"));
				return false;
			}
		}
	});
}

function clear_approve(){
	check_value = 'false false';
	all_option_str = [];
	check_option_str = [];
	$("#ApproveStrategyName").val("").attr("disabled",false);
	$("#ApproveNum").val("");
	$("#label_list_a").children('div:not(:first)').remove();
	$("#admin_select_a").empty();
	$("#admin_check_a").show();
	//$("#admin_select_a").children('option').not('option:first').remove();
	$("#ApproveStrategyName").next('.v-check').attr('class','v-check');
	$("#admin_num").text(0);
	$("#checkbox").find('input[type=checkbox]').iCheck('destroy');
	$("#checkbox").find('input[type=checkbox]').iCheck({
		checkboxClass: 'icheckbox_minimal-blue',
		radioClass: 'iradio_minimal-blue',
		increaseArea: '0' // optional
	});
	$("#checkbox").unbind();
	$("#checkbox").find('input[type=checkbox]').unbind();
	$("#checkbox").find('input[type=checkbox]').iCheck('uncheck');
	$('.xSelect_phone_m').data('value',0);
	$('.xSelect_phone_s').data('value',0);
	update_xSelect($('.xSelect_phone_m'));
	update_xSelect($('.xSelect_phone_s'));
	$('.xSelect_smtp_m').data('value',0);
	$('.xSelect_smtp_s').data('value',0);
	update_xSelect($('.xSelect_smtp_m'));
	update_xSelect($('.xSelect_smtp_s'));
	$("#ApproveNum").attr('edited',0);
	ApproveNum_old=0;
	all_check_old=0;
}

//审批
var approve_data;
function _editNode4(obj,type){
	clear_approve();
	var title;
	if (type == 1){
		//approveId = $(obj).parent().children('a').attr('id');
		approveId = $(obj).children('span').data('value');
		$.ajax({
			url: "/bhost/get_approve_list",
			type: "POST",
			async: false,
			data: { a0: se, a1: approveId },
			success: function (result) {
				var approve_result = JSON.parse(result);
				if (approve_result.Result == true) {
					approve_data = approve_result.info.data[0];
					title = "审批策略";
					
				}
			}
		});
	}else{
		//approve_edit = null;
		approveId = 0;
		title = "审批策略";
	}
	var $dialogCont = $("#EnableApprove_suspend").show();
	
	var d = dialog({
		title:title,
		content:$dialogCont,
		id:"EnableApprove_suspend",
		width:"800px"
	});
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	d.showModal();
	approvemain(type);
	$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
		clear_approve();
		approvemain(type);
		//d.close().remove();
	});
	
	$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
		save_data(d);
	})
	
}


var all_option_str = [];
var check_option_str = [];
var approve_item = {
	"ApproveStrategyId": 0,
	"ApproveStrategyName": "",
	"ApproveNum": 0,
	"ApproveType": 0, 
	"UserSet": []
}
//删除接收人
function _deladmin_a(obj) {
	var $c = $(obj).parent();
	var m_i = $(obj).parent().attr('value');
	all_option_str[parseInt(m_i)] = check_option_str[parseInt(m_i)];
	check_option_str[parseInt(m_i)] = null;
	for(var i=(parseInt(m_i)+1);i<all_option_str.length;i++){
		if(all_option_str[i]!=null){
			if	($('#admin_select_a option[value='+i+']').length!=0){
				$('#admin_select_a option[value='+i+']').before(all_option_str[m_i]);
				break;
			}
		}
	}
	if(i==all_option_str.length){
		$('#admin_select_a').append(all_option_str[m_i]);
	}
	$c.fadeOut(function () {
		$c.remove();
		edit_admin_num();
		$('#admin_select_a').trigger('change');
	});
	$('#admin_select_a').select2();
}

var ApproveNum_old=0;
var all_check_old=0;
function update_xSelect($obj){
	var id_value=$obj.data('value');
	var text_value=$('.xSelect-show-text',$obj).text();
	var id=$('.xSelect-show',$obj).data('id');
	$obj.empty().data('xSelect','');
	$('.'+id).remove();
			if(id_value==undefined || id_value == 0){
				id_value=0;
		text_value='全局指定'
			}
	switch ($obj.attr('class').split(' ')[1]) {
		case 'xSelect_phone_m':
			$.ajax({
				url: "/bhost/get_smssvrconfig",
				type: "POST",
				async: false,
				data: {a0:se},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						ftpconfig_data_all=result.info.data;
						var data = result.info;
						ftpserver = new Array();
						ftpserver[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
						$.each(data.data, function (i, item) {
							if(item.SmsSvrConfigId==0){
								return true;
							}else if(id_value==item.SmsSvrConfigId){
								text_value=item.SmsSvrConfigName;
							}
							ftpserver[item.SmsSvrConfigId] =(JSON.parse('{"value":'+item.SmsSvrConfigId+',"name":"'+item.SmsSvrConfigName+'","type":"'+(manage_auth_array.indexOf(24) != -1?'edit':'check')+'"}'));
						})
					} else {
						_alert(1, '短信网关查询', result.ErrMsg);
						return false;
					}
				}
			});
			var ftpserver1=ftpserver;
						var ftp2_id=$('.xSelect_phone_s').data('value');
						if(ftp2_id!=undefined && ftp2_id!='' && ftp2_id>0){
				delete ftpserver1[ftp2_id];
			}
			xSelect_json={
				num:'1',
				width: 168,
				defaultText: '全局指定',
				items:ftpserver1,
				edit: function(item,obj){
					$('.'+$('.xSelect_phone_m .xSelect-show').data('id')).hide();
					get_dialog(item, 1, 3);
				},
				check: function(item,obj){
					$('.'+$('.xSelect_phone_m .xSelect-show').data('id')).hide();
					get_dialog(item, 1, 3);
				},
				delete: function(item,obj){
				},
				btn:[
					
				],
				setval:function(item,obj){
					update_xSelect($('.xSelect_phone_s'));
				}
			};
			if(manage_auth_array.indexOf(24) != -1){
				xSelect_json.num='2';
				xSelect_json.btn.push({
					'name':'新增',
					'event': function(items,obj){
						get_dialog(items, 2, 3);
					}
				});
			}
			$obj.xSelect(xSelect_json);
			break;
		case 'xSelect_phone_s':
			$.ajax({
				url: "/bhost/get_smssvrconfig",
				type: "POST",
				async: false,
				data: {a0:se},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						ftpconfig_data_all=result.info.data;
						var data = result.info;
						ftpserver = new Array();
						ftpserver[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
						$.each(data.data, function (i, item) {
							if(item.SmsSvrConfigId==0){
								return true;
							}else if(id_value==item.SmsSvrConfigId){
								text_value=item.SmsSvrConfigName;
							}
							ftpserver[item.SmsSvrConfigId] =(JSON.parse('{"value":'+item.SmsSvrConfigId+',"name":"'+item.SmsSvrConfigName+'","type":"'+(manage_auth_array.indexOf(24) != -1?'edit':'check')+'"}'));
						})
					} else {
						_alert(1, '短信网关查询', result.ErrMsg);
						return false;
					}
				}
			});
			var ftpserver2=ftpserver;
			var ftp1_id=$('.xSelect_phone_m').data('value');
			if(ftp1_id!=undefined && ftp1_id!='' && ftp1_id>0){
				delete ftpserver2[ftp1_id];
			}
			xSelect_json={
				num:'1',
				width: 168,
				defaultText: '全局指定',
				items:ftpserver2,
				edit: function(item,obj){
					$('.'+$('.xSelect_phone_s .xSelect-show').data('id')).hide();
					get_dialog(item, 1, 3);
				},
				check: function(item,obj){
					$('.'+$('.xSelect_phone_s .xSelect-show').data('id')).hide();
					get_dialog(item, 1, 3);
				},
				delete: function(item,obj){
				},
				btn:[
					
				],
				setval:function(item,obj){
					update_xSelect($('.xSelect_phone_m'));
				}
			};
			if(manage_auth_array.indexOf(24) != -1){
				xSelect_json.num='2';
				xSelect_json.btn.push({
						'name':'新增',
						'event': function(item,obj){
							get_dialog(item, 2, 3);
						}
					});
			}
			$obj.xSelect(xSelect_json);
			break;
		case 'xSelect_smtp_m':
			$.ajax({
				url: "/bhost/get_smtpconfig",
				type: "POST",
				async: false,
				data: { a0: se },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						var data = result.info;
						smtpconfig_data_all=result.info.data;
						smtpconfig=new Array();
						smtpconfig[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
						$.each(data.data, function (i, item) {
							if(item.SmtpConfigId==0){
								return true;
							}else if(id_value==item.SmtpConfigId){
								text_value=item.SmtpConfigName;
							}
							smtpconfig[item.SmtpConfigId]=(JSON.parse('{"value":'+item.SmtpConfigId+',"name":"'+item.SmtpConfigName+'","type":"'+(manage_auth_array.indexOf(24) != -1?'edit':'check')+'"}'));
						})
					} else {
						_alert(1, '邮件服务器查询', result.ErrMsg);
						return false;
					}
				}
			});
			var smtpconfig1=smtpconfig;
			var stmp2_id=$('.xSelect_smtp_s').data('value');
			if (stmp2_id!=undefined && stmp2_id!='' && stmp2_id>0) {
				delete smtpconfig1[stmp2_id];
			}
			xSelect_json={
				num:'1',
				width: 168,
				defaultText: '全局指定',
				items:smtpconfig1,
				edit: function(item,obj){
					$('.'+$('.xSelect_smtp_m .xSelect-show').data('id')).hide();
					get_dialog(item, 1, 1);
				},
				check: function(item,obj){
					$('.'+$('.xSelect_smtp_m .xSelect-show').data('id')).hide();
					get_dialog(item, 1, 1);
				},
				delete: function(item,obj){
				},
				btn:[
					
				],
				setval:function(item,obj){
					update_xSelect($('.xSelect_smtp_s'));
				}
			};
			if(manage_auth_array.indexOf(24) != -1){
				xSelect_json.num='2';
				xSelect_json.btn.push({
					'name':'新增',
					'event': function(items,obj){
						get_dialog(items, 2, 1);
					}
				});
			}
			$obj.xSelect(xSelect_json);
			break;
		case 'xSelect_smtp_s':
			$.ajax({
				url: "/bhost/get_smtpconfig",
				type: "POST",
				async: false,
				data: { a0:se },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						var data = result.info;
						smtpconfig_data_all=result.info.data;
						smtpconfig=new Array();
						smtpconfig[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
						$.each(data.data, function (i, item) {
							if(item.SmtpConfigId==0){
								return true;
							}else if(id_value==item.SmtpConfigId){
								text_value=item.SmtpConfigName;
							}
							smtpconfig[item.SmtpConfigId]=(JSON.parse('{"value":'+item.SmtpConfigId+',"name":"'+item.SmtpConfigName+'","type":"'+(manage_auth_array.indexOf(24) != -1?'edit':'check')+'"}'));
						})
					} else {
						_alert(1, '邮件服务器查询', result.ErrMsg);
						return false;
					}
				}
			});
			var smtpconfig2=smtpconfig;
			var smtp1_id=$('.xSelect_smtp_m').data('value');
			if(smtp1_id!=undefined && smtp1_id!='' && smtp1_id>0){
				delete smtpconfig2[smtp1_id];
				// smtpconfig2.splice(smtp1_id,1);
			}
			// for(i in smtpconfig2){
			// 	if(smtpconfig2[i]==null){
			// 	}
			// }
			xSelect_json={
				num:'1',
				width: 168,
				defaultText: '全局指定',
				items:smtpconfig2,
				edit: function(item,obj){
					$('.'+$('.xSelect_smtp_s .xSelect-show').data('id')).hide();
					get_dialog(item, 1, 1);
				},
				check: function(item,obj){
					$('.'+$('.xSelect_smtp_s .xSelect-show').data('id')).hide();
					get_dialog(item, 1, 1);
				},
				delete: function(item,obj){
				},
				btn:[
					
				],
				setval:function(item,obj){
					update_xSelect($('.xSelect_smtp_m'));
				}
			};
			if(manage_auth_array.indexOf(24) != -1){
				xSelect_json.num='2';
				xSelect_json.btn.push({
						'name':'新增',
						'event': function(items,obj){
							get_dialog(items, 2, 1);
						}
					});
			}
			$obj.xSelect(xSelect_json);
			break;
	}
	$obj.data('value',id_value);
	$('.xSelect-show-text',$obj).text(text_value);
}
var smtpconfig_save = {
	"SmtpConfigId": 0,
	"SmtpConfigName": null,
	"SmtpServer": null,
	"DNS": null,
	"Sender": null,
	"SenderEmail": null,
	"AttachMaxLimit": 20,
	"ServerVerify": true,
	"SenderEmailPass": null,
	"Flag": 0,
	"EnCode": 0
};
var smssvrconfig_save = {
	"SmsSvrConfigId": 1,
	"SmsSvrConfigName": "短信网关配置1",
	"SmsSvrDBType": 2,
	"SmsSvrDBServerIP": "192.168.0.1",
	"SmsSvrDBPort": 1433,
	"SmsSvrDBUserName": "root",
	"SmsSvrDBPassword": "d106f6959747b5ac",
	"SmsSvrDBPassword_old": null,
	"SmsSvrDBDatabase": "mysql",
	"SmsSvrDBInsertTemp": null,
	"Flag": 0,         //--2-主，1-备，0-其它
	"EnCode": 0
};

function smtp_clear() {
	$('#mail_suspend i.v-check').attr('class', 'v-check');
	$('#SmtpConfigName').attr("disabled", false);
	$('#SmtpConfigName').val('');
	$('#SmtpConfigName').next('i.v-check').attr('class', 'v-check');
	$('#SmtpServer').val('');
	$('#Sender').val('');
	$('#SenderEmail').val('');
	$('#AttachMaxLimit').val('');
	$('#ServerVerify_off').iCheck('check');
	$('#SenderEmailPass').val('');
	
	//$('#test').iCheck('uncheck');
	//$('#test').parents('label').next('span.forCheck').hide();
	//$('#test_Master_input').val('');
	//$('#DNS_Master').val('');
	$('#EnCode_mail').val(0).trigger('change');
	var smtpconfig_data_all_Flag = smtpconfig_data_all.map(function (params) {
		return params.Flag;
	});
	if ($.inArray(2, smtpconfig_data_all_Flag) < 0) {
		$('#Flag_mail').val(2).trigger('change');
	} else if ($.inArray(1, smtpconfig_data_all_Flag) < 0) {
		$('#Flag_mail').val(1).trigger('change');
	} else {
		$('#Flag_mail').val(0).trigger('change');
	}
}
function smssvr_clear() {
	$('#smssvr_suspend i.v-check').attr('class', 'v-check');
	$('#SmsSvrConfigName').val('');
	$('#SmsSvrConfigName').attr("disabled", false);
	$('#SmsSvrDBType').val(1).trigger('change');
	$('#SmsSvrDBServerIP').val('');
	$('#SmsSvrDBPort').val('');
	$('#SmsSvrDBUserName').val('');
	$('#SmsSvrDBPassword').val('');
	$('#SmsSvrDBDatabase').val('');
	$('#SmsSvrDBInsertTemp').val('');
	$('#EnCode_smssvr').val(0).trigger('change');
	var smtpconfig_data_all_Flag = ftpconfig_data_all.map(function (params) {
		return params.Flag;
	});
	if ($.inArray(2, smtpconfig_data_all_Flag) < 0) {
		$('#Flag_smssvr').val(2).trigger('change');
	} else if ($.inArray(1, smtpconfig_data_all_Flag) < 0) {
		$('#Flag_smssvr').val(1).trigger('change');
	} else {
		$('#Flag_smssvr').val(0).trigger('change');
	}
}
function smtp_input(data) {
	smtpconfig_save.SmtpConfigId = data.SmtpConfigId;
	$('#SmtpConfigName').val(data.SmtpConfigName);
	$('#SmtpConfigName').attr("disabled", true);
	$('#SmtpServer').val(data.SmtpServer);
	$('#Sender').val(data.Sender);
	$('#SenderEmail').val(data.SenderEmail);
	$('#AttachMaxLimit').val(data.AttachMaxLimit);
	if (data.ServerVerify) {
		$('#ServerVerify_on').iCheck('check');
		$('#SenderEmailPass').val(data.SenderEmailPass);
		smtpconfig_save.SenderEmailPass = data.SenderEmailPass;
	} else {
		$('#ServerVerify_off').iCheck('check');
	}
	//$('#DNS_Master').val(data.DNS);
	//$('#test_Master').iCheck('uncheck');
	//$('#test_Master').parents('label').next('span.forCheck').hide();
	//$('#test_Master_input').val('');
	$('#EnCode_mail').val(data.EnCode).trigger('change');
	$('#Flag_mail').val(data.Flag).trigger('change');
}
function smssvr_input(data) {
	smssvrconfig_save.SmsSvrConfigId = data.SmsSvrConfigId;
	$('#SmsSvrConfigName').val(data.SmsSvrConfigName);
	$('#SmsSvrConfigName').attr("disabled", true);
	$('#SmsSvrDBType').val(data.SmsSvrDBType).trigger('change');
	$('#SmsSvrDBServerIP').val(data.SmsSvrDBServerIP);
	$('#SmsSvrDBPort').val(data.SmsSvrDBPort);
	$('#SmsSvrDBUserName').val(data.SmsSvrDBUserName);
	$('#SmsSvrDBPassword').val(data.SmsSvrDBPassword);
	$('#SmsSvrDBDatabase').val(data.SmsSvrDBDatabase);
	$('#SmsSvrDBInsertTemp').val(data.SmsSvrDBInsertTemp);
	$('#EnCode_smssvr').val(data.EnCode).trigger('change');
	$('#Flag_smssvr').val(data.Flag).trigger('change');
	smssvrconfig_save.SmsSvrDBPassword_old = data.SmsSvrDBPassword;
}

function get_dialog(obj, type, num) {
	var title;
	var ajax_url;
	var dialogCont_id;
	switch (num) {
		case 1:
			smtp_clear();
			title = '邮件';
			ajax_url = 'smtpconfig';
			dialogCont_id = 'mail_suspend';
			smtpconfig_save.SmtpConfigId = 0;
			smtpconfig_save.SenderEmailPass = null;
			break;
		case 3:
			smssvr_clear();
			title = '短信网关配置';
			ajax_url = 'smssvrconfig';
			dialogCont_id = 'smssvr_suspend';
			smssvrconfig_save.SmsSvrConfigId = 0;
			smssvrconfig_save.SmsSvrDBPassword_old = null;
			break;
	}
	$("#ServerVerify_on").on("ifChanged",function(){
		if ($(this).prop("checked")){
						$("#SenderEmailPass").parent().show();
		}else{
						$("#SenderEmailPass").parent().hide();
		}
	})
	if (type == 1) {
		var id = obj.value;
		$.ajax({
			url: "/bhost/get_" + ajax_url,
			type: "POST",
			async: false,
			data: { a0: se, a1: id },
			success: function (result) {
				var result = JSON.parse(result);
				if (result.Result) {
					var data = result.info.data[0];
					switch (num) {
						case 1:
							smtp_input(data);
							break;
						// case 2:
						// 	smsm_input(data);
						// 	break;
						case 3:
							smssvr_input(data);
							break;
						// case 4:
						// 	snmp_input(data);
						// 	break;
						// case 5:
						// 	syslog_input(data);
						// 	break;
					}
				} else {
					_alert(1, title, result.ErrMsg);
					return false;
				}
			}
		});

	} else {
		// title_d = "创建" + title;
	}
	var $dialogCont = $("#" + dialogCont_id).show();

	var d = dialog({
		title: title,
		content: $dialogCont,
		id: dialogCont_id,
		width: "800px"
	});
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	d.showModal();
	$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
		switch (num) {
			case 1:
				smtp_clear();
				break;
			// case 2:
			// 	smsm_clear();
			// 	break;
			case 3:
				smssvr_clear();
				break;
			// case 4:
			// 	snmp_clear();
			// 	break;
			// case 5:
			// 	syslog_clear();
			// 	break;
		}
		if (type == 1) {
			var id = obj.value;
			$.ajax({
				url: "/bhost/get_" + ajax_url,
				type: "POST",
				async: false,
				data: { a0: se, a1: id },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						var data = result.info.data[0];
						switch (num) {
							case 1:
								smtp_input(data);
								break;
							// case 2:
							// 	smsm_input(data);
							// 	break;
							case 3:
								smssvr_input(data);
								break;
							// case 4:
							// 	snmp_input(data);
							// 	break;
							// case 5:

							// 	syslog_input(data);
							// 	break;
						}
					} else {
						_alert(1, title, result.ErrMsg);
						return false;
					}
				}
			});
		} else {
		}
	});

	$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
		var pass = false;
		switch (num) {
			case 1:
				if (save_smtp_date()) {
					pass = save_smtpconfig();
				}
				break;
			// case 2:
			// 	if (save_smsm_date()) {
			// 		pass = save_smsmconfig();
			// 	}
			// 	break;
			case 3:
				if (save_smssvr_date()) {
					pass = save_smssvrconfig();
				}

				break;
			// case 4:

			// 	if (save_snmp_date()) {
			// 		pass = save_snmpconfig();
			// 	}
			// 	break;
			// case 5:
			// 	if (save_syslog_date()) {
			// 		pass = save_syslogconfig();
			// 	}
			// 	break;
		}
		if (pass) {
			$('.btn').blur(); parent.layer.open({
				type: 1,
				title: title,
				content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
				btn: ['确&nbsp;&nbsp;定'],
				btnAlign: 'c',
				closeBtn: false,
				skin: 'layer-custom',
				area: ['380px', '310px'],
				move: false,
				resize: false,
				yes: function (i) {
					parent.layer.close(i);
					d.close().remove();
				}
			});
		}
	})
}
var ipReg = /^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])(\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])){3}$/;
function save_smtp_date() {
	var SmtpConfigName_Master = $("#SmtpConfigName").val();
	if (SmtpConfigName_Master == '') {
		_alert(2, '邮件', '请输入名称', $('#SmtpConfigName'));
		return false;
	} else if (!nameReg.test(SmtpConfigName_Master)) {
		_alert(1, '邮件', '名称格式不正确', $('#SmtpConfigName'));
		return false;
	}
	var SmtpServer = $('#SmtpServer').val();
	//var DNS = $('#DNS_Master').val();
	if (SmtpServer == "") {
		_alert(2, '邮件', '请输入服务器地址', $('#SmtpServer'));
		return false;
	} else if (!ipReg.test(SmtpServer) && (!hostcheck1.test(SmtpServer)) && (!hostcheck2.test(SmtpServer))){
		_alert(1, '邮件', '服务器地址格式不正确', $('#SmtpServer'));
		return false;
	}
	/*
	if (DNS == "") {
		DNS = null;
	}
	*/
	var Sender = $('#Sender').val();
	if (Sender == "") {
		_alert(2, '邮件', '请输入服务器账号', $('#Sender'));
		return false;
	}
	var SenderEmail = $('#SenderEmail').val();
	if (SenderEmail == "") {
		_alert(2, '邮件', '请输入发送邮箱地址', $('#SenderEmail'));
		return false;
	} else if (!emailReg.test(SenderEmail)) {
		_alert(1, '邮件', '发送邮箱地址格式不正确', $('#SenderEmail'));
		return false;
	}
	var AttachMaxLimit = $('#AttachMaxLimit').val();
	if (AttachMaxLimit == "") {
		_alert(2, '邮件', '请输入附件大小', $('#AttachMaxLimit'));
		return false;
	}
	//var ServerVerify = ($('#ServerVerify').find('input[type=radio]:checked').val() == '2');
	if ($("#ServerVerify_on").prop("checked")){
		if ($("#SenderEmailPass").val() == ""){
			_alert(2,"邮件","请输入服务器验证",$("#SenderEmailPass"));
			return false;
		}else{
			if($("#SenderEmailPass").val().length > 64){
				_alert(2, '邮件', "密码不能超过系统限定64位", $("#SenderEmailPass"));
				return false;
			}			
			smtpconfig_save.ServerVerify = true;
			smtpconfig_save.SenderEmailPass = $("#SenderEmailPass").val();
		}
	}else{
		smtpconfig_save.ServerVerify = false;
		smtpconfig_save.SenderEmailPass = null;
	}

	smtpconfig_save.SmtpConfigName = SmtpConfigName_Master;
	smtpconfig_save.SmtpServer = SmtpServer;
	smtpconfig_save.DNS = null;
	smtpconfig_save.Sender = Sender;
	smtpconfig_save.SenderEmail = SenderEmail;
	smtpconfig_save.AttachMaxLimit = AttachMaxLimit;
	//smtpconfig_save.ServerVerify = ServerVerify;
	//smtpconfig_save.SenderEmailPass = SenderEmailPass;
	smtpconfig_save.EnCode = parseInt($('#EnCode_mail').val());
	smtpconfig_save.Flag = parseInt($('#Flag_mail').val());
	return true;
}
function save_smssvr_date() {
	var numCheck = /\D/;
	var SmsSvrConfigName = $("#SmsSvrConfigName").val();
	var SmsSvrDBType = $("#SmsSvrDBType").val();
	var SmsSvrDBServerIP = $("#SmsSvrDBServerIP").val();
	var SmsSvrDBPort = $("#SmsSvrDBPort").val();
	var SmsSvrDBUserName = $("#SmsSvrDBUserName").val();
	var SmsSvrDBPassword = $("#SmsSvrDBPassword").val();
	var SmsSvrDBDatabase = $("#SmsSvrDBDatabase").val();
	var SmsSvrDBInsertTemp = $("#SmsSvrDBInsertTemp").val();
	if (SmsSvrConfigName == "") {
		_alert(2, "短信网关", "请输入名称", $("#SmsSvrConfigName"));
		return false;
	} else {
		if (!nameCheck.test(SmsSvrConfigName)) {
			_alert(1, "短信网关", "名称格式不正确", $("#SmsSvrConfigName"));
			return false;
		}
	}
	if (SmsSvrDBServerIP == "") {
		_alert(2, "短信网关", "请输入服务器地址", $("#SmsSvrDBServerIP"));
		return false;
	} else {
		if (!ipcheck_route.test(SmsSvrDBServerIP)) {
			_alert(1, "短信网关", "服务器地址格式不正确", $("#SmsSvrDBServerIP"));
			return false;
		}
	}
	if (SmsSvrDBPort == "") {
		_alert(2, "短信网关", "请输入端口", $("#SmsSvrDBPort"));
		return false;
	} else {
		if (numCheck.test(parseInt(SmsSvrDBPort))) {
			_alert(1, "短信网关", "端口格式不正确", $("#SmsSvrDBPort"));
			return false;
		}
		if (parseInt(SmsSvrDBPort) > 65534) {
			_alert(1, "短信网关", "端口不能大于65534", $("#SmsSvrDBPort"));
			return false;
		}
		if (parseInt(SmsSvrDBPort) < 1) {
			_alert(1, "短信网关", "端口不能小于1", $("#SmsSvrDBPort"));
			return false;
		}
	}
	if (SmsSvrDBUserName == "") {
		_alert(2, "短信网关", "请输入账号", $("#SmsSvrDBUserName"));
		return false;
	} else {
		if (!nameCheck.test(SmsSvrDBUserName)) {
			_alert(1, "短信网关", "账号格式不正确", $("#SmsSvrDBUserName"));
			return false;
		}
	}
	if (SmsSvrDBPassword == "") {
		_alert(2, "短信网关", "请输入密码", $("#SmsSvrDBPassword"));
		return false;
	}
	if (SmsSvrDBDatabase == "") {
		_alert(2, "短信网关", "请输入数据库", $("#SmsSvrDBDatabase"));
		return false;
	}
	if (SmsSvrDBInsertTemp == "") {
		_alert(2, "短信网关", "请输入短信sql语句模板", $("#SmsSvrDBInsertTemp"));
		return false;
	} else {
		if (SmsSvrDBInsertTemp.indexOf("%phone%") === -1 || SmsSvrDBInsertTemp.indexOf("%content%") === -1) {
			_alert(1, "短信网关", "模板格式不正确", $("#SmsSvrDBInsertTemp"));
			return false;
		}
	}
	smssvrconfig_save.SmsSvrConfigName = SmsSvrConfigName;
	smssvrconfig_save.SmsSvrDBType = SmsSvrDBType;
	smssvrconfig_save.SmsSvrDBServerIP = SmsSvrDBServerIP;
	smssvrconfig_save.SmsSvrDBPort = parseInt(SmsSvrDBPort);
	smssvrconfig_save.SmsSvrDBUserName = SmsSvrDBUserName;
	smssvrconfig_save.SmsSvrDBPassword = SmsSvrDBPassword;
	smssvrconfig_save.SmsSvrDBDatabase = SmsSvrDBDatabase;
	smssvrconfig_save.SmsSvrDBInsertTemp = SmsSvrDBInsertTemp;
	smssvrconfig_save.Flag = parseInt($("#Flag_smssvr").val());
	smssvrconfig_save.EnCode = parseInt($("#EnCode_smssvr").val());
	return true;
}
function save_smtpconfig() {
	var pass = true;
	if (smtpconfig_save == null) {
		return false;
	}
	msstr = aceg(JSON.stringify(smtpconfig_save),se);
	$.ajax({
		url: "/bhost/add_smtpconfig",
		type: "POST",
		async: false,
		data: { a0: se, a1: JSON.stringify(smtpconfig_save),a2:'运维管理>指令授权',m1:msstr},
		success: function (result) {
			var result = JSON.parse(result);
			if (result.Result) {
				//刷新下拉
				var focusObj_value = $focusObj_c.data('value');
				if (focusObj_value == 0) {
					$focusObj_c.data('value',result.SmtpConfigId);
				}
				update_xSelect($('.xSelect_smtp_m'));
				update_xSelect($('.xSelect_smtp_s'));
			} else {
				if (result.ErrMsg == "同名邮件服务器配置已存在") {
					_alert(2, "邮件", result.ErrMsg, $('#SmtpConfigName_Master'));
				} else {
					_alert(2, "邮件", result.ErrMsg);
				}
				pass = false;
			}
		}
	});
	return pass;
}
function save_smssvrconfig() {
	var pass = true;
	if (smssvrconfig_save == null) {
		return false;
	}
	var msstr = aceg(JSON.stringify(smssvrconfig_save),se);
	$.ajax({
		url: "/bhost/add_smssvrconfig",
		type: "POST",
		async: false,
		data: { a0: se, a1: JSON.stringify(smssvrconfig_save),a10:'运维管理>指令授权' ,m1:msstr},
		success: function (result) {
			var result = JSON.parse(result);
			if (result.Result) {
				//刷新下拉
				var focusObj_value = $focusObj_c.data('value');
				if (focusObj_value == 0) {
					$focusObj_c.data('value',result.SmsSvrConfigId);
				}
				update_xSelect($('.xSelect_phone_m'));
				update_xSelect($('.xSelect_phone_s'));
			} else {
				if (result.ErrMsg == "同名短信网关服务配置已存在") {
					_alert(2, "短信网关", result.ErrMsg, $('#SmtpConfigName'));
				} else {
					_alert(2, "短信网关", result.ErrMsg);
				}
				pass = false;
			}
		}
	});
	return pass;
}

//添加接收人
function _addadmin_a(obj) {
	var m_i = $(obj).parent().children('select').find("option:selected").val();
	var text = $(obj).parent().children('select').find("option:selected").text();
			if (m_i == "0") {
		_alert(2, '审批策略', '请选择审批者');
		return false;
	}
	var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + m_i + '" id="' + m_i + '"/>');
	$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + text + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin_a(this)"></i>');
	$(obj).parent().after($c);
	$(obj).parent().children('select').find('option[value=' + m_i + ']').remove();
	$(obj).parent().children('select').val(0).trigger("change");
	check_option_str[m_i] = all_option_str[m_i];
	all_option_str[m_i] = null;
}
var check_value='false false';
function approvemain(type){
	if (manage_auth_array.indexOf(15) === -1 && manage_auth_array.indexOf(16) === -1 && manage_auth_array.indexOf(17) === -1 && manage_auth_array.indexOf(32) === -1){
		$("#EnableApprove_suspend").find('.btn-submit').remove();
	}
	//用户列表
	$.ajax({
		url: "/bhost/get_user_list_app",
		type: "POST",
		async: false,
		data: { a0: se,a2:6},
		success: function (result) {
			var userinfo_result = JSON.parse(result);
			if (userinfo_result.Result == true) {
				var userinfo_data = userinfo_result.info;
				$("#admin_select_a").empty().append("<option value=\"0\">请选择</option>");
				$.each(userinfo_data, function (i, item) {
					var text='';
					if(item.Email!=null && item.Email!=''){
						text+='email';
					}
					if(item.MobilePhone!=null && item.MobilePhone!=''){
						text+='phone';
					}
					$("#admin_select_a").append("<option value=\"" + item.UserId + "\" index=\"0\" data-text=\""+text+"\">" + item.UserCode + "</option>");
					all_option_str[item.UserId] = "<option value=\"" + item.UserId + "\" index=\"0\" data-text=\""+text+"\">" + item.UserCode + "</option>";
				});
			}else{
				_alert(2,'审批策略', "执行失败：" + userinfo_result.ErrMsg);
				return false;
			}
		}
	});
	$('#admin_select_a').on('change', function () {
		var admin_select = $('#admin_select_a').val();
		$('#admin_check_a').attr('value', admin_select);
		if ($('#admin_select_a').find('option').length == 2 && $('#admin_select_a option:selected').val() != '0') {
			_addadmin_a($('#admin_select_a').siblings('i'));
			$('#admin_check_a').hide();
		} else if ($('#admin_select_a').find('option').length == 1) {
			$('#admin_check_a').hide();
		} else {
			$('#admin_check_a').show();
		}
		edit_admin_num();
	});
	//输入数字
	$("#ApproveNum").bind('keydown', function (e) {
		DigitInput(e);
	});
	$('#checkbox').on('ifChanged','input',function(e){
						if($('#checkbox4').is(':checked') && !$('#checkbox8').is(':checked')){
			update_xSelect($('.xSelect_phone_m'));
			update_xSelect($('.xSelect_phone_s'));
			$('.xSelect_phone_m').parents('.form-item').show();
			$('.xSelect_phone_s').parents('.form-item').show();
			$('.xSelect_smtp_m').parents('.form-item').hide();
			$('.xSelect_smtp_s').parents('.form-item').hide();
			$('#admin_select_a').select2('close');
			if(check_value=='true false'){
				return false;
			}
			check_value='true false';
			var admin_select_value=$('#admin_select_a').val();
			// setTimeout(function(){
				$.each($('#admin_select_a option[value!=0]'),function(i,item){
					if(item.getAttribute("data-text").indexOf('phone')<0){
						item.remove();
					}
				})
				for(var i in check_option_str){
					if(check_option_str[i]==null){
						continue;
					}
					//////console.log(i+':'+check_option_str[i]);
					if(check_option_str[i].indexOf('data-text="emailphone"')<0 && check_option_str[i].indexOf('data-text="phone"')<0){
						all_option_str[i]=check_option_str[i];
						// setTimeout(function() {
							$('#'+i).fadeOut(function () {
								$('#'+i).remove();
								edit_admin_num();
							});
						// }, 10);
						check_option_str[i]=null;
						continue;
					}
				}
				for(var i in all_option_str){
					if(all_option_str[i]==null){
						continue;
					}
					if((all_option_str[i].indexOf('data-text="emailphone"')>=0 || all_option_str[i].indexOf('data-text="phone"')>=0) && $('#admin_select_a option[value='+i+']').length==0){
						for(var j=i+1;j<all_option_str.length;j++){
							if(all_option_str[j]!=null){
								if($('#admin_select_a option[value='+j+']').length!=0){
									$('#admin_select_a option[value='+j+']').before(all_option_str[i]);
									break;
								}
							}
						}
						if(j==all_option_str.length){
							$('#admin_select_a').append(all_option_str[i]);
						}
					}
				}
				$('#admin_select_a').val(admin_select_value).trigger('change');
			// },1);
			
		}else if(!$('#checkbox4').is(':checked') && $('#checkbox8').is(':checked')){
			update_xSelect($('.xSelect_smtp_m'));
			update_xSelect($('.xSelect_smtp_s'));
			$('.xSelect_phone_m').parents('.form-item').hide();
			$('.xSelect_phone_s').parents('.form-item').hide();
			$('.xSelect_smtp_m').parents('.form-item').show();
			$('.xSelect_smtp_s').parents('.form-item').show();
			$('#admin_select_a').select2('close');
			if(check_value=='false true'){
				return false;
			}
			check_value='false true';
			var admin_select_value=$('#admin_select_a').val();
				$.each($('#admin_select_a option[value!=0]'),function(i,item){
					if(item.getAttribute("data-text").indexOf('email')<0){
						item.remove();
					}
				})
				for(var i in check_option_str){
					if(check_option_str[i]==null){
						continue;
					}
					if(check_option_str[i].indexOf('data-text="emailphone"')<0 && check_option_str[i].indexOf('data-text="email"')<0){
						all_option_str[i]=check_option_str[i];
						$('#'+i).fadeOut(function () {
							$('#'+i).remove();
							edit_admin_num();
						});
						check_option_str[i]=null;
						continue;
					}
				}
				for(var i in all_option_str){
					if(all_option_str[i]==null){
						continue;
					}
					if((all_option_str[i].indexOf('data-text="email"')>=0 || all_option_str[i].indexOf('data-text="emailphone"')>=0) && $('#admin_select_a option[value='+i+']').length==0){
						for(var j=i+1;j<all_option_str.length;j++){
							if(all_option_str[j]!=null){
								if($('#admin_select_a option[value='+j+']').length!=0){
									$('#admin_select_a option[value='+j+']').before(all_option_str[i]);
									break;
								}
							}
						}
						if(j==all_option_str.length){
							$('#admin_select_a').append(all_option_str[i]);
						}
					}
				}
				if($('#admin_select_a option[value='+admin_select_value+']').length==0){
					admin_select_value=0;
				}
				$('#admin_select_a').val(admin_select_value).trigger('change');
		}else if(!$('#checkbox4').is(':checked') && !$('#checkbox8').is(':checked')){
			$('.xSelect_phone_m').parents('.form-item').hide();
			$('.xSelect_phone_s').parents('.form-item').hide();
			$('.xSelect_smtp_m').parents('.form-item').hide();
			$('.xSelect_smtp_s').parents('.form-item').hide();
			$('#admin_select_a').select2('close');
			if(check_value=='false false'){
				return false;
			}
			check_value='false false';
			var admin_select_value=$('#admin_select_a').val();
				$('#admin_select_a option[value!=0]').remove();
				for(var i in all_option_str){
					if(all_option_str[i]==null){
						continue;
					}
					$('#admin_select_a').append(all_option_str[i]);
				}
				$('#admin_select_a').val(admin_select_value).trigger('change');
		}else if($('#checkbox4').is(':checked') && $('#checkbox8').is(':checked')){
			update_xSelect($('.xSelect_phone_m'));
			update_xSelect($('.xSelect_phone_s'));
			update_xSelect($('.xSelect_smtp_m'));
			update_xSelect($('.xSelect_smtp_s'));
			$('.xSelect_phone_m').parents('.form-item').show();
			$('.xSelect_phone_s').parents('.form-item').show();
			$('.xSelect_smtp_m').parents('.form-item').show();
			$('.xSelect_smtp_s').parents('.form-item').show();
			$('#admin_select_a').select2('close');
			if(check_value=='true true'){
				return false;
			}
			check_value='true true';
			var admin_select_value=$('#admin_select_a').val();
				$.each($('#admin_select_a option[value!=0]'),function(i,item){
					if(item.getAttribute("data-text").indexOf('emailphone')<0){
						item.remove();
					}
				})
				for(var i in check_option_str){
					if(check_option_str[i]==null){
						continue;
					}
					//////console.log(i+':'+check_option_str[i]);
					if(check_option_str[i].indexOf('emailphone')<0){
						all_option_str[i]=check_option_str[i];
						// setTimeout(function() {
							$('#'+i).fadeOut(function () {
								$('#'+i).remove();
								edit_admin_num();
							});
						// }, 10);
						check_option_str[i]=null;
						continue;
					}
				}
				for(var i in all_option_str){
					if(all_option_str[i]==null){
						continue;
					}
					if(all_option_str[i].indexOf('data-text="emailphone"')>=0 && $('#admin_select_a option[value='+i+']').length==0){
						for(var j=i-1;j<all_option_str.length;j--){
							if(all_option_str[j]!=null){
								if($('#admin_select_a option[value='+j+']').length!=0){
									$('#admin_select_a option[value='+j+']').before(all_option_str[i]);
									break;
								}
							}
						}
						if(j==0){
							$('#admin_select_a').prepend(all_option_str[i]);
						}
					}
				}
				if($('#admin_select_a option[value='+admin_select_value+']').length==0){
					admin_select_value=0;
				}
				$('#admin_select_a').val(admin_select_value).trigger('change');
		}
	});
	$('#checkbox1').iCheck('check');
	$('#checkbox1').iCheck('disable');
	//编辑页面
	if (type == 1) {
		$("#ApproveStrategyName").val(approve_data.ApproveStrategyName);
		$("#ApproveStrategyName").attr("disabled", true);
		
		var ApproveType=parseInt(approve_data.ApproveType.toString(2),2);
		var text=[];
		var num_smssvr = 0;
		var num_smtp = 0;
		if(ApproveType&1){
			$('#checkbox1').iCheck('check');
		}
		if(ApproveType&2){
			$('#checkbox2').iCheck('check');
			if($.inArray('phone',text)<0){
				text.push('phone');
			}
			if(approve_data.MasterSmsSvrConfigId!=null){
				$('.xSelect_phone_m').data('value',approve_data.MasterSmsSvrConfigId);
				num_smssvr++;
			}
			if(approve_data.StandBySmsSvrConfigId!=null){
				$('.xSelect_phone_s').data('value',approve_data.StandBySmsSvrConfigId);
				num_smssvr++;
			}
		}
		
		if(ApproveType&8){
			$('#checkbox8').iCheck('check');
			text.push('email');
			if(approve_data.MasterSmtpConfigId!=null){
				$('.xSelect_smtp_m').data('value',approve_data.MasterSmtpConfigId);
				num_smtp++;
			}
			if(approve_data.StandBySmtpConfigId!=null){
				$('.xSelect_smtp_s').data('value',approve_data.StandBySmtpConfigId);
				num_smtp++;
			}
		}
		
		if(ApproveType&4){
			$('#checkbox4').iCheck('check');
			if($.inArray('phone',text)<0){
				text.push('phone');
			}
			if(approve_data.MasterSmsSvrConfigId!=null){
				$('.xSelect_phone_m').data('value',approve_data.MasterSmsSvrConfigId);
				num_smssvr++;
			}
			if(approve_data.StandBySmsSvrConfigId!=null){
				$('.xSelect_phone_s').data('value',approve_data.StandBySmsSvrConfigId);
				num_smssvr++;
			}
		}
		
		if(ApproveType&16){
			$('#checkbox16').iCheck('check');
		}
		if (num_smssvr != 0){
			update_xSelect($('.xSelect_phone_m'));
			update_xSelect($('.xSelect_phone_s'));
		}
		if (num_smtp != 0){
			update_xSelect($('.xSelect_smtp_m'));
			update_xSelect($('.xSelect_smtp_s'));
		}
		if (approve_data.UserSet != null) {
			for(var i=0;i<approve_data.UserSet.length-1;i++){
				var item=approve_data.UserSet[i];
				check_option_str[item.UserId] = all_option_str[item.UserId];
				all_option_str[item.UserId] = null;
				var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + item.UserId + '" id="' + item.UserId +'"/>');
				$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + item.UserCode + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin_a(this)"></i>');               
				$("#admin_select_a").parent().after($c);
				$("#admin_select_a").find('option[value=' + item.UserId + ']').remove();
				$("#admin_select_a").trigger('change');
			}
			if(all_option_str[approve_data.UserSet[i].UserId].indexOf('data-text="'+text.join('')+'"')<0 || (all_option_str[approve_data.UserSet[i].UserId]==undefined || all_option_str[approve_data.UserSet[i].UserId]==null)){
				var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + approve_data.UserSet[i].UserId + '" id="' + approve_data.UserSet[i].UserId +'"/>');
				$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + approve_data.UserSet[i].UserCode + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin_a(this)"></i>');
				$("#admin_select_a").parent().after($c);
				$("#admin_select_a").find('option[value=' + approve_data.UserSet[i].UserId + ']').remove();
				check_option_str[approve_data.UserSet[i].UserId] = all_option_str[approve_data.UserSet[i].UserId];
				all_option_str[approve_data.UserSet[i].UserId] = null;
				$("#admin_select_a").trigger('change');
			}else{
				$("#admin_select_a").val(approve_data.UserSet[i].UserId).trigger('change');
			}
			//$("#admin_select_a").val(approve_data.UserSet[i].UserId).trigger('change');
		}
		$("#ApproveNum").val(approve_data.ApproveNum);
		$('#ApproveNum').attr('edited',1);
		ApproveNum_old=approve_data.ApproveNum;
		all_check_old=approve_data.UserSet.length;
	}
	$("#admin_select_a").select2();
}

function edit_admin_num() {
	$('#label_list_a').find('div[value!=0]:hidden').remove();
	var len = $('#label_list_a').find('div[value!=0]').length;
	$('#admin_num').text(len);
	var ApproveNum_count = $('#ApproveNum').val();
	var num_edited = $('#ApproveNum').attr('edited')
	if(len==0){
		all_check_old=0;
		ApproveNum_old=0;
	}
	if(num_edited=='0'){
		$('#ApproveNum').val(len);
	}
	else if(num_edited=='1'){ 
		if(ApproveNum_count!='' && ApproveNum_count!='0'){	
			ApproveNum_count=parseInt(ApproveNum_count);
			if(ApproveNum_count>len){
				$('#ApproveNum').val(len);
			}	
		}
	}
}

function save_data(d) {
	var approve_item = {
		"ApproveStrategyId": 0,
		"ApproveStrategyName": "",
		"ApproveNum": 0,
		"ApproveType": 0,   
		"UserSet": [],
		"MasterSmsMConfigId": null,
		"MasterSmsMConfig": null,
		"StandBySmsMConfigId": null,
		"StandBySmsMConfig": null,
		"MasterSmsSvrConfigId": null,
		"MasterSmsSvrConfig": null,
		"StandBySmsSvrConfigId": null,
		"StandBySmsSvrConfig": null,
		"MasterSmtpConfigId": null,
		"MasterSmtpConfig": null,
		"StandBySmtpConfigId": null,
		"StandBySmtpConfig": null
	}
	var val = $("#ApproveStrategyName").val();
	//审批策略名
	if (val == "") {
		_alert(2, "审批策略", '请输入名称', $("#ApproveStrategyName"));
		return false;
	}
	if (!nameReg.test(val)) {
		_alert(1, "审批策略", '名称格式不正确', $("#ApproveStrategyName"));
		return false;
	}
	var ApproveNum = $('#ApproveNum').val();
	if (ApproveNum == "") {
		_alert(2, "审批策略", '请输入审批人数', $("#ApproveNum"));
		return false;
	}
	var numReg = /^[0-9]+$/;
	if (!numReg.test(ApproveNum)) {
		_alert(1, "审批策略", '审批人数只能输入数字', $("#ApproveNum"));
		return false;
	}
	ApproveNum = parseInt(ApproveNum);
	if (ApproveNum == 0) {
		_alert(1, "审批策略", '审批人数不能为0', $("#ApproveNum"));
		return false;
	}
	if($('#checkbox1').is(':checked')){
		approve_item.ApproveType+=1;
	}
	if($('#checkbox2').is(':checked')){
		approve_item.ApproveType+=2;
	}
	if($('#checkbox4').is(':checked')){
		approve_item.ApproveType+=4;
		var xSelect_phone_m_id=$('.xSelect_phone_m').data('value');
		var xSelect_phone_s_id=$('.xSelect_phone_s').data('value');
		approve_item.MasterSmsSvrConfigId=xSelect_phone_m_id;
		approve_item.StandBySmsSvrConfigId=xSelect_phone_s_id;
		approve_item.MasterSmsSvrConfig=$('.xSelect_phone_m .xSelect-show-text').text();
		approve_item.StandBySmsSvrConfig=$('.xSelect_phone_s .xSelect-show-text').text();
	}
	if($('#checkbox8').is(':checked')){
		approve_item.ApproveType+=8;
		var xSelect_smtp_m_id=$('.xSelect_smtp_m').data('value');
		var xSelect_smtp_s_id=$('.xSelect_smtp_s').data('value');
		approve_item.MasterSmtpConfigId=xSelect_smtp_m_id;
		approve_item.StandBySmtpConfigId=xSelect_smtp_s_id;
		approve_item.MasterSmtpConfig=$('.xSelect_smtp_m .xSelect-show-text').text();
		approve_item.StandBySmtpConfig=$('.xSelect_smtp_s .xSelect-show-text').text();
	}
	if(approve_item.ApproveType==0){
		_alert(2, "审批策略", '请选择方式');
		return false;
	}
	var $all = $("#label_list_a").find('div[value!=0]');
	var len = $all.length;
	if (len == 0) {
		_alert(2, "审批策略", '请选择审批者');
		return false;
	}
	//var id = document.frm_approve_add.a.value;
	approve_item.ApproveStrategyId = approveId;
	approve_item.ApproveStrategyName = val;
	if (ApproveNum > len) {
		ApproveNum = len;
	}
	approve_item.ApproveNum = (ApproveNum);
	approve_item.UserSet = new Array();

	for (var j = len - 1; j >= 0; j--) {
		var t_i = $all.eq(j).attr('value');
		if (t_i != '0' && t_i != '') {
			var json_a = '{"UserId":' + t_i + '}';
			approve_item.UserSet.push(JSON.parse(json_a));
		}
	}
	var msstr = aceg(JSON.stringify(approve_item),se);
	$.ajax({
		url: '/bhost/add_approve',
		type: "POST",
		async: false,
		data: { a0:se, a1: JSON.stringify(approve_item), a10:"运维管理>指令授权",m1:msstr},
		success: function (result) {
			var result = JSON.parse(result);
			if (result.Result) {
				$('.btn').blur(); parent.layer.open({
					type: 1,
					title: '审批策略',
					content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
					btn: ['确&nbsp;&nbsp;定'],
					btnAlign: 'c',
					closeBtn: false,
					skin: 'layer-custom',
					area: ['380px', '310px'],
					move: false,
					resize: false,
					yes: function (i) {
						$('.btn').blur();
						parent.layer.close(i);
						var approve_text = $('#EnableApprove').find('span').text();
						$("div[data-id=xSelect-approve]").remove();
						$('#EnableApprove').empty().data('xSelect','');
						bind_approval_xSelect();
						if ($("#EnableApprove").data('value') == "-1" || $("#EnableApprove").data('value') == undefined){
							$("#EnableApprove").data('value',result.ApproveStrategyId);
							$("#EnableApprove").find('span').text(approve_item.ApproveStrategyName);
						}else{
							$('#EnableApprove').find('span').text(approve_text);
						}
						d.close().remove();
					}
				});
			} else {
				_alert(1, "审批策略", "执行失败：" + result.ErrMsg, $("#ApproveStrategyName"));
				return false;
			}
		}
	});
}

function clear_cmdset(){
	$("#CmdSetName").val('').attr('disabled',false);
	$("#CmdSetName").next('i').attr('class','v-check');
	$("#Description_cmd").val('');
	$("#Content_cmd").val('');
	$("#Content_cmd").text('');
}

var cmdsetid;
function _editNode(obj,type){
	clear_cmdset();
	var title;
	if (type == 1){
		cmdsetid = $(obj).children('span').data('value');
		title = "指令集合";
	}else{
		cmdser_edit = null;
		cmdsetid = 0;
		title = "指令集合";
	}
	var $dialogCont = $("#cmd_suspend").show();
	
	var d = dialog({
		title:title,
		content:$dialogCont,
		id:"cmd_suspend",
		width:"800px"
	});
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	d.showModal();
	//$("#EventLevel").next('span').css("margin-left",9);
	cmdsetmain(type);
	$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
		clear_cmdset();
		cmdsetmain(type);
		//d.close().remove();
	});
	
	$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
		SaveSet(d);
	});
}

function cmdsetmain(type){
	if (manage_auth_array.indexOf(17) === -1){
		$("#cmd_suspend").find('.btn-submit').remove();
	}
	if (type == 1){
		$.ajax({
		   url:'/bhost/select_cmdset_all',
		   type:"post",
		   async:false,
		   data:{a0:se,z8:cmdsetid},
		   success:function(results){
				cmdadd = JSON.parse(results);
				var content = "";
				content = cmdadd.data[0].Content//replace(/,/g,"\n");
				$("#Content_cmd").text(content);
				$("#Content_cmd").val(content);
				$("#Description_cmd").val(cmdadd.data[0].Description);
				$("#CmdSetName").val(cmdadd.data[0].Name).attr('disabled',true);
			}
		});
	}
}

var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
function NameCheck(obj){
	var name = $(obj).val().trim();
	var $i = $(obj).next('i.v-check');
	
	if (!nameReg.test(name)){
		$i.show().attr('class','v-check v-wrong');
	}else{
		$i.show().attr('class','v-check v-right');
	}
}

function SaveSet(d){
	var CmdSetName = $("#CmdSetName").val().trim();
	var Description = $("#Description_cmd").val().trim();
	var Content = $("#Content_cmd").val().trim();
	var flag = 0;
	if (CmdSetName == ""){
		_alert(2,"指令集合","请输入名称",$("#CmdSetName"));
		return false;
	}
	if (!nameReg.test(CmdSetName)){
		_alert(1,"指令集合","名称格式不正确",$("#CmdSetName"));
		return false;
	}
	if (Content == ""){
		_alert(2,"指令集合","请输入指令",$("#Content_cmd"));
		return false;
	}

	$.ajax({
		url:'/bhost/save_cmdset',
		type:'post',
		async:false,
		data:{a0:se,z3:CmdSetName,z4:Description,z5:Content,z6:cmdsetid,z7:cmdsetid,a10:"运维管理>指令授权"},
		success:function(Result){
			data = JSON.parse(Result);
			if (data.Result == false){
				_alert(1,"指令集合","执行失败：" + data.ErrMsg,$("#CmdSetName"));
			}else{
				$('.btn').blur();
				parent.layer.open({
					type:1,
					title:"指令集合",
					content:'<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
					btn:['确&nbsp;&nbsp;定'],
					btnAlign:'c',
					closeBtn: false,
					skin:'layer-custom',
					area:['380px','310px'],
					move: false,
					resize: false,
					btn1:function(i){
						parent.layer.close(i);
						var cmd_text = $('#cmd').find('span').text();
						$("div[data-id=xSelect-cmd]").remove();
						$('#cmd').empty().data('xSelect','');
						bind_cmd_xSelect();
						if ($("#cmd").data('value') == "-1" || $("#cmd").data('value') == undefined){
							$("#cmd").data('value',data.CmdSetId);
							$("#cmd").find('span').text(CmdSetName);
							cmdset.splice(0,1,data.CmdSetId);
						}else{
							$('#cmd').find('span').text(cmd_text);
						}
						d.close().remove();
					},
					btn2:function(i){
						parent.layer.close(i);
					}
				});	
			}
		}
	});
}


</script>
</body>
</html>
