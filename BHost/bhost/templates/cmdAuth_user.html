<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Logbase运维安全管理系统</title>
	<!--script-->
	<script src="/manage/js/jquery.min.js"></script>
	<script src="/manage/js/jquery.easing.js"></script>
	<script src="/manage/js/layer.js"></script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/common_e.js"></script>
	<script src="/manage/js/select2.full.min.js"></script>
	<script src="/manage/js/icheck.min.js"></script>
	<script src="/manage/js/jquery.plugin.js"></script>
	<script src="/manage/js/jquery.datepick.js"></script>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<link rel="stylesheet" href="/manage/css/style.css">
	<link rel="stylesheet" href="/manage/css/jquery.datepick.css">

	<!--icheck-->
	<script src="/manage/js/icheck.min.js"></script>
	<script src="/manage/js/select2.full.min.js"></script>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<script type="text/javascript" src="/manage/js/dialog-plus.js"></script>
	<link rel="stylesheet" href="/manage/css/ui-dialog.css" type="text/css" />
	<link rel="stylesheet" href="/manage/css/G-style.css" type="text/css" />
	<link rel="stylesheet" href="/manage/css/new-head.css">
	<script src="/manage/js/my_scrollbar.js"></script>
</head>

<body style="overflow:hidden;" class="bg-white">
	<!---->
	<div class="rwrap">
		<!---->
		<div class="mainer">

			<div class="container">
				<div class="c-top">
					<div class="c-title">
						<!--
						<h3 onclick="show_list(1)" class="tit"><span style="width:120px">按对象授权</span><i class="icon-by-target"></i></h3>
						-->
						<div class="manual-head" style="width:123px;float:left;">
							<div class="manual-title-other title-item" id="frist" style="background-color: #ababab;">
								<span class="cmdauth_user" style="">按对象授权</span>
								<i class="cmdAuth_user_icon" style=""></i>
							</div>
						</div>
						<div class="secnav">
							<ul id="step">
								<li style="width:123px;" class="active">运维用户</li>
								<li style="width:123px;" onclick="to(2)">访问范围</li>
								<!--li>账号/协议</li-->
								<li style="width:123px;" onclick="to(3)">指令集合/响应方式</li>
							</ul>
						</div>

					</div>
				</div>

				<div class="c-cont" style="">
					<div class="c-wrap" style="padding: 10px 0 0">
						<div class="c-exp" id="c-exp">

							<div class="h-explorer">
								<div class="h-top">
									<div class="h-tit">
										<div class="form-item form-nm">
											<div class="form-tag">
												<em class="imp">*</em>授权名称：</div>
											<div class="form-c">
												<input type="text" class="form-text" style="width:160px;" maxlength="128" name="ManageAuthName" id="ManageAuthName" onblur="NameCheck(this)">
												<i class="v-check" style=" margin-top: 12px;margin-left: -22px;"></i>
												<span style="font-size: 12px;">特殊字符仅支持下划线、横杠、小数点</span>
											</div>

										</div>
									</div>
									<div class="form-tiem" style="float:right">
										<div class="form-tag" style="float: left;color: #9a9a9a;line-height: 34px;">启用授权：</div>
										<div class="form-c" style="margin-top:8px">
											<input id="Enable" type="checkbox" class="form-checkbox" name="" value="">
										</div>
									</div>
								</div>

								<div class="h-catelog h-catelog2" style="background-color: #ffffff;">
									<h5>
										<em class="imp">*</em>
										<i class="h-eicon h-eicon-u"></i>协助管理者</h5>
									<ul id="contlist">
										<li style="width:50%;">
											<select class="filter-select form-select2" name="" id="manager_select" style="width:120px" onchange="change_manager(this);">
											</select>
											<i class="ctrl add" onclick="_addmanager(this)" style="margin-left:0px;"></i>
										</li>
									</ul>
								</div>

								<div class="h-content2" style="overflow:hidden;">
									<div class="h-top" style="margin-top:-20px;    background-color: #fff;">
										<div class="filter" style="min-width:auto;">
											<div id="waitTip" class="waitTip2" style="float: right;margin-top: 7px;margin-left: -26px;"></div>
											<div class="search">
												<select name="" id="filter_select" class="filter-select">
													<option value="0">所有</option>
													<option value="1">组名</option>
													<option value="2">账号</option>
												</select>
												
												<input type="text" class="filter-text" placeholder="输入关键字" id="keyword" style="border-left:0px;padding: 0 22px 0 4px;" onkeydown="if($('#keyword').val()==''){$('#text_check1').hide();}else{$('#text_check1').show();};if (event.keyCode == 13){_addFilter(this,false);return false;} else return;" onchange="if($('#keyword').val()==''){$('#text_check1').hide();}else{$('#text_check1').show();}" onkeyup="if($('#keyword').val()==''){$('#text_check1').hide();}else{$('#text_check1').show();}" onblur="change_input(this,0);">
												
												<i class="v-check v-wrong" id="text_check1" onclick="_clear_keyword(this)" style="display:none;cursor: pointer;float: left;position: static;"></i>
												<button class="btn filter-btn" onclick="_addFilter(this,false)">
													<i class="add-filter"></i>
												</button>
												<button class="btn filter-btn" onclick="_addFilter(this,true)">
													<i class="append-filter"></i>
												</button>
											</div>
											<div class="search" id="clearFilter" style="margin: 0px 15px 0px -16px;display:none;">
												<button class="btn filter-btn" onclick="_clearFilter(this)">
													<i class="clear-filter"></i>
												</button>
											</div>
											<div class="selector" id="filterWW1" style="display: none;width: 146px;">
												<span class="ww" style="width:132px;">搜索条件</span>
												<ul style="padding-left: 0px;width: 146px;"></ul>
											</div>
										</div>
									</div>
									<div class="h-content22" id="user_module" style="overflow:auto;width:100%;margin-top:10px;">
										<h2 style="margin-left: 35px;">
											<em class="imp">*</em>用户：</h2>
										<ul id="userTree" class="hosttree" style=""></ul>
									</div>
								</div>
							</div>
						</div>
						<div class="c-exp" id="c-exp1" style="display:none">

							<div class="h-explorer">
								<div class="h-top">

									<div class="h-tit">
										<div class="form-item form-nm">
											<div style="margin-top:-1px">
												<select name="" id="typeSet" class="filter-select" style="width: 120px;    margin-top: -2px;" onchange="_typeSet(this)">
													<option value="1">对象指定</option>
													<option value="2">范围指定</option>
												</select>
											</div>
										</div>
									</div>
								</div>
								<div id="pointSet1" style="display:none;">
									<div class="h-content3" id="rangelist" style=" background-color: #ffffff;border-bottom: 1px solid #CCC;color: #9a9a9a;">
										<div class="form-tag" style="width:95px;line-height: 43px">
											<em class="imp">*</em>服务器范围：</div>
										<div class="form-c c-form-host" style="min-width: 90%;margin-left: 84px;" id="server_frame_list">
											<div class="item" style="margin-top: -10px;width:230px;margin-left: -15px;">
												<!--
												<span class="g-tsel" style="margin-left: 15px;cursor: pointer;">
													<input id="ips" type="text" style="width: 130px" class="form-text " placeholder="输入服务器范围名称" onkeyup="_autoView(this,2,1)"
													 onfocus="_autoView(this,2,1)" onblur="_hideView(1);">
												</span>
												<i class="ctrl add" style="margin-left: 1px" onclick="addserver(this)"></i>
												-->
												<div class="" id="ips" style="float:left;width: 162px;margin-left: 17px;"></div>
												<i class="ctrl add" style="margin-top: 6px" onclick="add_server_scope(this)"></i>
											</div>
										</div>
									</div>

									<div class="dialog-cont" id="server_suspend" style="display:none;max-height:500px">
										<div class="container" style="margin-top: -10px;">
											<div class="c-cont2" style="padding: 0px;">
												<div class="c-wrap" style="padding: 0px 0 0">
													<div class="c-exp" style="/*padding: 0px;*/">

														<div class="h-explorer1" style="border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-image: initial;margin: 0px auto;">
															<div class="h-top">
																<div class="form-item" style="padding: 0 0 0 21px;float:left;width:auto;margin:3px;">
																	<span class="form-tag" style="float:left;width:auto;">
																		<em class="imp">*</em>名称：</span>
																	<div class="form-c" style="float:left;padding-left:0px;">
																		<input type="text" class="form-text" id="d_n" name="d_n" style="width:160px;" maxlength="128" onblur="regCheck(this,nameReg);">
																		<i class="v-check" style="    margin: 7px 0 0 -26px;"></i>
																		<span>特殊字符仅支持下划线、横杠、小数点</span>
																	</div>
																</div>
															</div>

															<div class="h-catelog h-catelog2 h-catelog2_tmp" style="width:353px;max-height:400px;background: none;overflow-x: hidden; padding: 0;">
																<div class="h-top" style="background-color: white;">
																	<span class="form-tag" style="float:left;width:auto;padding: 4px 0px 0px 15px;">IP限制：</span>
																	<input type="checkbox" class="form-checkbox" name="" id="part1" value="" style="margin-top: 9px; float: right;position: relative;" checked="checked" >
																	<h2 style="font-size: 13px;padding: 8px 6px 0px 0px;font-weight: 100;float: right;">启用</h2>
																</div>
																<h2 style="font-size: 14px;padding: 19px 0 0 14px;font-weight: 400;">IP地址：</h2>
																<div id="ip_n1" name="ip_n1" class="form-c c-form-host" style="padding-left:22px;width:343px;min-width:300px;float: left;"
																 value="0">
																	<span class="ss ss-add" id="ip_span1" value="0" style="position:static;padding-bottom: 10px;width:180px">
																		<input type="text" class="form-text" style="width:110px;">
																		<i class="ctr ctr-add" onclick="_addIp1(this)" style="margin-left: 5px;"></i>
																	</span>
																</div>
																<h2 style="font-size: 14px;padding:0px 0 0 14px;float:left;font-weight: 400;">IP区间：</h2>
																<div id="ip_n" name="ip_n" class="form-c c-form-host" style="padding-left:22px;width:335px;min-width:300px;float: left;"
																 value="0">
																	<span class="ss ss-add" id="ip_span" value="0" style="position:static;padding-bottom: 10px;">
																		<input type="text" class="form-text" placeholder="起始IP地址" style="width:110px;">
																		<span style="vertical-align:middle;">-</span>
																		<input type="text" class="form-text" placeholder="结束IP地址" style="width:110px;">
																		<i class="ctr ctr-add" onclick="_addIp2(this);" style="margin-left: 5px;"></i>
																	</span>
																</div>
															</div>

															<div class="h-content2 h-catelog2_tmp" style="max-height:400px;">
																<div class="h-top" style="background-color: #fff;    margin-top: -22px;">
																	<div class="filter" style="float:right;min-width:auto;">
																		<div id="waitTip" class="waitTip1" style="float: right;margin-top: 7px;margin-left: -26px;"></div>
																		<div class="search">
																			<select name="server_select" id="server_select" class="filter-select">
																				<option value="all" selected>所有</option>
																				<option value="hgname">组名</option>
																				<option value="hostname">主机名</option>
																				<option value="ip">IP</option>
																			</select>

																			<input type="text" class="filter-text" placeholder="输入关键字" name="server_text" id="server_text" maxlength="128" onchange="if($('#server_text').val()==''){$('#server_text_check').hide();}else{$('#server_text_check').show();}"onkeyup="if($('#server_text').val()==''){$('#server_text_check').hide();}else{$('#server_text_check').show();}"onkeydown="if($('#server_text').val()==''){$('#server_text_check').hide();}else{$('#server_text_check').show();};if (event.keyCode == 13){_addFilter1(this,false);return false;} else return;" onblur="change_input(this,1);">
																			
																			<i class="v-check v-wrong" id="server_text_check" onclick="_clear_keyword1(this)" style="display:none;cursor: pointer;float: left;position: static;"></i>
																			<button class="btn filter-btn" onclick="_addFilter1(this,false)">
																				<i class="add-filter"></i>
																			</button>
																			<button class="btn filter-btn" onclick="_addFilter1(this,true)">
																				<i class="append-filter"></i>
																			</button>
																		</div>
																		<div class="search" id="clearFilter1" style="margin: 0px 15px 0px -16px;display:none;">
																			<button class="filter-btn" onclick="_clearFilter1(this)">
																				<i class="clear-filter"></i>
																			</button>
																		</div>
																		<div class="selector selector-multiple" id="filterWW" style="display: none;    width: 146px;">
																			<span class="ww" style="width:9.5em;">搜索条件</span>
																			<ul style="padding-left: 0px;    width: 146px;"></ul>
																		</div>
																	</div>
																</div>


																<div style="overflow: auto;width:100%;height:96%;" id="hosttree_div">
																	<h2 style="font-size: 14px;margin-top:4px;">主机：</h2>
																	<ul id="userTree1" class="hosttree" style="padding: 0 0 0 0;float: left;    margin-top: 0px;"></ul>
																</div>
															</div>
														</div>
													</div>

													<div class="clearfix"></div>
													<div class="btns" style="margin-bottom: -25px;">
														<a href="javascript:;" class="btn btn-submit btn-normal">保&nbsp;&nbsp;存</a>
														<a href="javascript:;" class="btn btn-cancel btn-normal">重&nbsp;&nbsp;置</a>
													</div>
												</div>
											</div>
										</div>
									</div>

									<div class="h-top">

										<div class="h-tit">
											<div class="form-item form-nm">
												<!--
											<div class="form-tag">选择账号、协议、连接参数</div>
											-->
												<div style="margin-top:-1px">
													<select name="" id="define_select" class="filter-select" style="width: 80px;margin-top:-2px" onchange="define_change(this);">
														<option value="1">已定义</option>
														<option value="2">自定义</option>
													</select>
												</div>
												<div id="mix_module" style="margin-top: -34px;margin-left: 85px;">
													<select name="" id="mix_select" class="filter-select" style="width: 80px;display:none;" onchange="mix_change(this);">
														<option value="1">所有</option>
														<option value="2">共有</option>
													</select>
												</div>
											</div>
										</div>
									</div>

									<div id="custom_info" style="display:none">
										<div class="h-catelog h-catelog2 h-content2_temp" style="height: 221px; width: 28.3%;background-color: #ffffff; padding: 0px;max-height:400px;overflow-x: hidden;">
											<div class="c-col2 ss" style="width:313px">

												<div>
													<span class="form-tag" style="float: none;">
														<em class="imp">*</em>账号：</span>
												</div>

												<div class="ss-cont h-content3" id="account_module" style="padding: 0;min-width:341px">
													<li class="item">
														<select class="filter-select form-select2" name="" id="account_select" style="width:120px" onchange="change_account(this);">
														</select>
														<i class="ctrl add" onclick="_addaccount(this)"></i>
													</li>
												</div>
											</div>
										</div>
										<div class="h-catelog h-catelog2 h-content2_temp" style="height: 221px; width: 71.6%;background-color: #ffffff;padding: 0px;border-right:0px;max-height:400px">
											<div class="c-col2 ss">


												<div>
													<span class="form-tag" style="float: none;">
														<em class="imp">*</em>服务：</span>
												</div>
												<div class="h-content2222" style="height: auto;width: 100%;overflow: hidden;padding: 0px;">
													<div class="c-table">


														<table cellpadding="0" cellspacing="0" style="margin-bottom:20px;">
															<thead>
																<tr>
																	<th>协议</th>
																	<th>端口</th>
																	<th>连接参数</th>
																	<th width="72"></th>
																</tr>
															</thead>

															<tbody id="service_list1" style="height:auto">

															</tbody>
															</tbody>
														</table>
														<div class="form">
															<div class="form-item form-item-100" style="width:100%">
																<div style="text-align: right;">
																	<a href="javascript:;" id="" class="btn btn-normal1" onclick="_getDialog1('add',this);">添&nbsp;&nbsp;加</a>
																	<!--<a href="javascript:;" class="btn btn-normal1" onclick="clear_server();">重&nbsp;&nbsp;置</a>-->
																</div>
															</div>
														</div>
													</div>
												</div>


												<div class="dialog-cont" id="scDCTab1" style="display:none;">
													<div class="container">
														<div class="c-cont1" style="max-height:280px;overflow:auto; min-height: 220px;">
															<div class="c-wrap" style="padding:0 0 90px;margin-top: -10px;overflow: hidden;">
																<div class="c-form c-form-host col3" style="min-width:760px;">

																	<div class="clearfix"></div>
																	<div class="c-table" style="padding: 0;margin-left: 10px;">
																		<div class="form" style="overflow: hidden;">
																			<div class="form-item" style="width:284px;;margin-left: -5px;" id="device_module">
																				<span class="form-tag">设备类型：</span>
																				<div class="form-c">
																					<select class="form-select2" name="" id="device_type" onchange="change_device_type(this);" style="width: 140px;">
																						<option value="-1">请选择</option>
																					</select>
																				</div>
																			</div>
																			<div class="form-item" style="width:284px;margin-left: -10px;" id="module_server">
																				<span class="form-tag">模板载入：</span>
																				<div class="form-c">
																					<select class="form-select form-select2" name="" id="def_server" onchange="show_def_server(this);" style="width: 140px;">
																						<option value="-1">请选择</option>
																					</select>
																				</div>
																			</div>
																			<div class="form-item" style="width: 284px;margin-left: -5px;">
																				<span class="form-tag">
																					<em class="imp">*</em>协议：</span>
																				<div class="form-c" id="ProtocolName"></div>
																				<!--
																				<div class="form-c">
																					<select class="form-select form-select2" name="" id="ProtocolName" style="width: 140px;">
																						<option value="">请选择</option>
																					</select>
																				</div>
																				-->
																			</div>
																			<div class="form-item" style="width: 284px;margin-left: -10px;">
																				<span class="form-tag">
																					<em class="imp">*</em>端口：</span>
																				<div class="form-c">
																					<input type="text" class="form-text" id="Port" maxlength="5" onkeyup="port_check(this);" style="width:108px">
																				</div>
																			</div>

																			<div class="form-item" style="width: 284px;margin-left: -5px;">
																				<span class="form-tag">连接参数：</span>
																				<div class="form-c" id="ConnParamName"></div>
																				<!--
																				<div class="form-c">
																					<select class="form-select form-select2" name="" id="ConnParamName" style="width: 140px;">
																						<option value="">请选择</option>
																					</select>
																				</div>
																				-->
																			</div>
																		</div>
																	</div>

																	<div class="btns" style="margin-bottom: -20px;">
																		<a href="javascript:;" class="btn btn-normal btn-submit">确&nbsp;&nbsp;定</a>
																		<a href="javascript:;" class="btn btn-normal" onclick="clear_serverdata();">重&nbsp;&nbsp;置</a>
																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>
												<div class="dialog-cont" id="protoDialog" style="display:none;">
													<div class="container">
														<div class="c-cont" style="min-height:200px;max-height:200px;overflow:auto;">
															<div class="c-form c-form-host" style="padding: 0 0 90px;min-width:0px;">
																<div class="clearfix"></div>
																<div class="c-table">
																	<div class="form">
																		<div class="form-item" style="width: 300px;">
																			<span class="form-tag" style="width: 72px;"><em class="imp">*</em>名称：</span>
																			<div class="form-c" style="padding-left: 0;">
																				<input type="text" class="form-text" id="Protocol_Name0" maxlength="15" style="width: 195px;" tabindex="1">
																				<i class="v-check" style=""></i>
																				<p class="form-tip" style="width: 185px;margin-left: 66px;">特殊字符仅支持下划线、横杠</p>
																			</div>
																		</div>
																		<div class="form-item" style="width: 185px;">
																			<span class="form-tag" style="width:85px;"><em class="imp">*</em>端口：</span>
																			<div class="form-c" style="padding-left: 0px;">
																				<input type="text" class="form-text" id="Port0" maxlength="5" style="width: 50px;" tabindex="1">
																				<i class="v-check" style=""></i>
																				<p class="form-tip" style="width: 78px;margin-left: 80px;">0-65535之间</p>
																			</div>
																		</div>
																		<div class="form-item" style="width: 185px;">
																			<span class="form-tag" style="width:85px;"><em class="imp">*</em>端口1：</span>
																			<div class="form-c" style="padding-left: 0px;">
																				<input type="text" class="form-text" id="Port1" maxlength="5" style="width: 50px;" tabindex="1">
																				<i class="v-check" style=""></i>
																				<p class="form-tip" style="width: 78px;margin-left: 80px;">0-65535之间</p>
																			</div>
																		</div>
																		<div class="form-item" style="width: 250px;">
																			<span class="form-tag" style="width:85px;">描述：</span>
																			<div class="form-c" style="padding-left: 0px;">
																				<input type="text" class="form-text" id="Description0" maxlength="128" style="width:170px;" tabindex="1">
																			</div>
																		</div>
																	</div>
																</div>
															</div>
														</div>
														<div class="btns" style="margin-bottom:-20px;">
															<a href="javascript:;" class="btn btn-normal btn-submit" >保&nbsp;&nbsp;存</a>
															<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
														</div>
													</div>
												</div>
												
												<div class="dialog-cont" id="connDialog" style="display:none;">
													<div class="container">
														<div class="c-cont" style="max-height:500px;">
															<div class="c-form" style="">
																<div class="form" style="padding-left:50px;">
																	<div class="form-item">
																		<span class="form-tag"><em class="imp">*</em>名称：</span>
																		<div class="form-c">
																			<input type="text" class="form-text" id="d_n_con" name="d_n_con" onblur="regCheck(this,cnameReg);" maxlength="128">
																			<i class="v-check"></i>
																			<p class="form-tip">特殊字符仅支持下划线、横杠、小数点</p>
																		</div>
																	</div>
																	<div class="form-item">
																		<span class="form-tag"><em class="imp">*</em>协议类型：</span>
																		<div class="form-c">
																			<select class="form-select form-select2" name="Protocol_con" id="Protocol_con" style="width:150px;">
																				<option value="0" selected>请选择</option>
																			</select>
																		</div>
																		<span class="form-tag" id="Protocol_port"></span>
																	</div>
																	<!-- SSH -->
																	<div id="SSH" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag">版本号：</span>
																			<div class="form-c">
																				<select class="form-select" name="ServiceName_ssh" id="ServiceName_ssh" style="width:150px;">
																					<option value="1" >1</option>
																					<option value="2" >2</option>
																				</select>
																			</div>
																		</div>
																	</div>
																	<!-- SFTP -->
																	<div id="SFTP" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag">版本号：</span>
																			<div class="form-c">
																				<select class="form-select" name="ServiceName_sftp" id="ServiceName_sftp" style="width:150px;">
																					<option value="1" >1</option>
																					<option value="2" >2</option>
																				</select>
																			</div>
																		</div>
																	</div>
																	<!--HTTP-->
																	<div id="HTTP" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag"><em class="imp">*</em>URL：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="url" name="url" maxlength="128" style="width:252px;padding-right:8px;">
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">账号元素：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="UserName" name="UserName" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">密码元素：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="UserPwd" name="UserPwd" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">提交元素：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="Submit" name="Submit" maxlength="128" style="width:252px;padding-right:8px;">
																			</div>
																		</div>
																	</div>
																	<!--HTTPs-->
																	<div id="HTTPs" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag"><em class="imp">*</em>URL：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="httpsurl" name="httpsurl" maxlength="128" style="width:252px;padding-right:8px;">
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">账号元素：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="httpsUserName" name="httpsUserName" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">密码元素：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="httpsUserPwd" name="httpsUserPwd" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">提交元素：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="httpsSubmit" name="httpsSubmit" maxlength="128" style="width:252px;padding-right:8px;">
																			</div>
																		</div>
																	</div>
																	<!--RDP-->
																	<div id="RDP" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag">访问方式：</span>
																			<div class="form-c">
																				<select class="form-select" name="rdpType" id="rdpType" style="width:150px;">
																					<option value="NORMAL" text="NORMAL">NORMAL</option>
																					<option value="CONSOLE" text="CONSOLE">CONSOLE</option>
																				</select>
																			</div>
																		</div>
																	</div>
																	<!--ORACLE-->
																	<div id="ORACLE" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag"><em class="imp">*</em>指定：</span>
																			<div class="form-c">
																				<select class="form-select" name="appoint" id="appoint" style="width:150px;">
																				<option value="0" text="请选择" selected>请选择</option>
																				<option value="SID" text="SID">SID</option>
																				<option value="SERVICE_NAME" text="SERVICE_NAME">SERVICE_NAME</option>
																			</select>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag"><em class="imp">*</em>实例名或服务名：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="s_n" name="s_n" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">连接方式：</span>
																			<div class="form-c">
																				<select class="form-select" name="conn" id="conn" style="width:150px;">
																				<option value="0" text="未指定" selected>未指定</option>
																				<option value="NORMAL" text="NORMAL">NORMAL</option>
																				<option value="SYSDBA" text="SYSDBA">SYSDBA</option>
																				<option value="SYSOPER" text="SYSOPER">SYSOPER</option>
																			</select>
																			</div>
																		</div>
																	</div>
																	<!--RADMIN-->
																	<div id="RADMIN" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag">认证方式：</span>
																			<div class="form-c">
																				<select class="form-select" name="authtype" id="authtype" style="width:150px;">
																				<option value="0" text="未指定" selected>未指定</option>
																				<option value="RADMIN" text="RADMIN">RADMIN</option>
																				<option value="Windows" text="Windows">Windows</option>
																			</select>
																			</div>
																		</div>
																	</div>
																	<!--MSSQL-->
																	<div id="MSSQL" style="display:none;">
																		<div class="form-item">
																			<span class="form-tag"><em class="imp">*</em>实例名：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="o_n" name="o_n" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																		<div class="form-item">
																			<span class="form-tag">认证方式：</span>
																			<div class="form-c">
																				<select class="form-select" name="R_authtype" id="R_authtype" style="width:150px;">
																				<option value="0" text="未指定" selected>未指定</option>
																				<option value="SQL服务器验证" text="SQL服务器验证" >SQL服务器验证</option>
																				<option value="Windows验证" text="Windows验证" >Windows验证</option>
																				<option value="Windows单一登录" text="Windows单一登录" >Windows单一登录</option>
																			</select>
																			</div>
																		</div>
																	</div>
																	<!--MYSQL &&　DB2-->
																	<div id="MY_DB2" style="display:none;">
																		<div class="form-item" style="min-height:40px;">
																			<span class="form-tag"><em class="imp">*</em>数据库名：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="sql_n" name="sql_n" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																	</div>
																	<!--
																	<div id="MY_ConnType" style="display:none;">
																		<div class="form-item" style="min-height:40px;">
																			<span class="form-tag"><em class="imp">*</em>版本号：</span>
																			<div class="form-c">
																				<select class="form-select" name="select_my" id="select_my" style="width:150px;">
																					<option value="0" text="0" selected>&lt;7.5</option>
																					<option value="1" text="1" >≥7.5</option>
																				</select>
																			</div>
																		</div>
																	</div>
																	-->
																	<div id="DB2" style="display:none;">
																		<div class="form-item" style="min-height:40px;">
																			<span class="form-tag"><em class="imp">*</em>数据库名：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="dbsql_n" name="dbsql_n" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																	</div>
																	
																	<!--SYBASE-->
																	<div id="SYBASE" style="display:none;">
																		<div class="form-item" style="min-height:40px;">
																			<span class="form-tag"><em class="imp">*</em>实例名：</span>
																			<div class="form-c">
																				<input type="text" class="form-text" id="sy_o_n" name="sy_o_n" maxlength="128" style="width:252px;padding-right:8px;">
																				<p class="form-tip">不能含有特殊字符</p>
																			</div>
																		</div>
																	</div>
																	<!---->
																</div>
															</div>
															<div class="c-form">
																<div class="btns">
																	<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
																	<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
									<div id="defined_info" style="">
										<div class="h-catelog h-catelog2 h-content2_temp" style="height: 221px; width: 30%;background-color: #ffffff; padding: 0px;border-right: 1px solid #CCC;/*overflow:hidden;*/">
											<div class="c-col2 ss">

												<div>
													<span class="form-tag" style="float: none;">
														<em class="imp">*</em>账号：</span>
													<select name="" id="a_mix_select" class="filter-select" style="width: 80px;display:none;margin-left: 16px;" onchange="a_mix_change(this);">
														<option value="1">指定</option>
														<option value="2">所有</option>
													</select>
												</div>

												<div class="ss-cont" id="account" style="padding: 0;">
													<div class="h-content222" style="height: auto;width: 100%;overflow: hidden;padding: 0px;">
														<div class="c-table tab-type2" style="padding: 0;margin-top: 10px;">
															<table cellpadding="0" cellspacing="0" style="">
																<thead>
																	<tr>
																		<th width="50">
																			<input type="checkbox" class="form-checkbox" id="check_all_a" />
																		</th>
																		<th>账号</th>

																	</tr>
																</thead>
															</table>
														</div>
														<div class="c-table tab-type2" style="padding: 0;overflow:auto;">
															<table cellpadding="0" cellspacing="0" style="">
																<tbody id="service_list_a" style="height:auto">
																</tbody>
															</table>
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="h-catelog h-catelog2 h-content2_temp" style="height: 221px; width: 69.9%;background-color: #ffffff;padding: 0px; border-right: 0px;">
											<div class="c-col2 ss">
												<div>
													<span class="form-tag" style="float: none;">
														<em class="imp">*</em>服务：</span>
													<select name="" id="s_mix_select" class="filter-select" style="width: 80px;display:none;margin-left: 16px;" onchange="s_mix_change(this);">
														<option value="1">指定</option>
														<option value="2">所有</option>
													</select>
												</div>
												<div class="h-content222" style="height: auto;width: 100%;overflow: hidden;padding: 0px;" id="service_module">
													<div class="c-table tab-type2" style="padding: 0;margin-top: 10px;">
														<table cellpadding="0" cellspacing="0" style="">
															<thead>
																<tr>
																	<th width="50">
																		<input type="checkbox" class="form-checkbox" id="check_all" />
																	</th>
																	<th>协议</th>
																	<th>端口</th>
																	<th>连接参数</th>

																</tr>
															</thead>
														</table>
													</div>
													<div class="c-table tab-type2" style="padding: 0;overflow:auto;">
														<table cellpadding="0" cellspacing="0" style="">
															<tbody id="service_list2" style="height:auto">
															</tbody>
														</table>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div id="pointSet2">
									<div class="h-content2" style="overflow: hidden;">
										<div class="h-top" style="background-color: #fff;    margin-top: -22px;">
											<div class="filter" style="float:right;min-width:auto;">
												<div id="waitTip" class="waitTip" style="float: right;margin-top: 7px;margin-left: -26px;"></div>
												<div class="search">
													<select name="" id="filtername" class="filter-select">
														<option value="0">所有</option>
														<option value="1">组名</option>
														<option value="2">主机名</option>
														<option value="3">IP</option>
														<option value="4">服务</option>
														<option value="5">账号</option>
													</select>
													<input type="text" class="filter-text" placeholder="输入关键字" name="server_text" id="server_text1" maxlength="128" style="border-left:0px;padding: 0 22px 0 4px;" onkeydown="if($('#server_text1').val()==''){$('#text_check2').hide();}else{$('#text_check2').show();};if (event.keyCode == 13){_addFilter2(this,false);return false;} else return;" onchange="if($('#server_text1').val()==''){$('#text_check2').hide();}else{$('#text_check2').show();}"onkeyup="if($('#server_text1').val()==''){$('#text_check2').hide();}else{$('#text_check2').show();}" onblur="change_input(this,2);">
													
													<i class="v-check v-wrong" id="text_check2" onclick="_clear_keyword2(this)" style="display:none;cursor: pointer;float: left;position: static;"></i>
													<button class="btn filter-btn" onclick="_addFilter2(this,false)">
														<i class="add-filter"></i>
													</button>
													<button class="btn filter-btn" onclick="_addFilter2(this,true)">
														<i class="append-filter"></i>
													</button>
												</div>
												<div class="search" id="clearFilter2" style="margin: 0px 15px 0px -16px;display:none;">
													<button class="filter-btn" onclick="_clearFilter2(this)">
														<i class="clear-filter"></i>
													</button>
												</div>
												<div class="selector selector-multiple" id="filterWW2" style="display: none;width: 146px;">
													<span class="ww" style="width:132px;">搜索条件</span>
													<ul style="padding-left: 0px;    width: 146px;"></ul>
												</div>
											</div>
										</div>

										<div style="overflow: auto;width:100%;height:94%;margin-top:10px;" id="hosttree_div1">
											<h2 style="margin-left: 30px;">
												<em class="imp">*</em>主机：</h2>
											<ul id="hostTree" class="hosttree"></ul>
										</div>
									</div>
								</div>


							</div>
						</div>


						<div class="c-exp" id="c-exp3" style="display:none">

							<div class="h-explorer">
								<div class="h-top">
									<div class="h-tit">
										<div class="form-item form-nm">
											<div class="form-tag">配置指令集合</div>
										</div>
									</div>
									<div style="float:left;    padding: 8px 0 0 28px;">
										<input type="radio" id="" value="1" name="action" style="margin-top: 5px;margin-right:10px" class="form-radio" checked> 允许用户使用以下指令集</div>
									<div style="float:left;    padding: 8px 0 0 16px;">
										<input type="radio" id="" value="2" name="action" class="form-radio"> 禁止用户使用以下指令集</div>
								</div>
								<div class="h-content3" style="padding: 0px;">
									<div class="form-item" style="width: 48%;margin-left: 36px;float: left;">
										<span class="form-tag" style="width:105px;margin-left: -8px;">手工输入指令：</span>
										<div class="form-c" style="padding-left:0">
											<textarea id="Content" class="form-textarea" name="" id="Content" cols="30" rows="10" style="height:140px;width:76%;margin-left:10px;"></textarea>
										</div>
									</div>
									<div style="margin-top: 20px;height:162px;">
										<span class="form-tip">多个指令请使用换行符分隔
											<br />
											<span class="form-tip">&lt;match&gt;通配符</span>
											<span class="form-tip">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;nmatch&gt;取非</span>
											<br/>
											<span class="form-tip">&lt;regex&gt;正则表达式匹配</span>
											<span class="form-tip">&lt;nregex&gt;取非</span>
											<br />
											<span class="form-tip">&lt;include&gt;包含匹配</span>
											<span class="form-tip">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ninclude&gt;取非</span>
											<br />
											<span class="form-tip">&lt;equ&gt;完全匹配</span>
											<br />
											<span class="form-tip">默认为包含匹配，增加如下例子的匹配方式，表示包含ls和-al，花括号需单独占一行：</span>
											<br/>
											<span class="form-tip">{</span>
											<br />
											<span class="form-tip">ls</span>
											<br />
											<span class="form-tip">-al</span>
											<br />
											<span class="form-tip">}</span>
										</span>
									</div>
									<div class="form-item" id="cmdset" style="/*border-bottom: 1px solid #CCC;*/">
										<span class="form-tag" style="width:136px; margin-top:-5px;    margin-top: -6px;">指令集合：</span>
										<div id="cmd_list" style="margin-left: 134px;">
											<div class="item" style="height: auto;padding:0px;width: 170px;height: 28px;margin-top: -5px;margin-left: 7px;">
												<div class="cmd" id="cmd"></div>
												<i style="margin-top: -46px;margin-left: 148px;" class="ctrl add" onclick="_addcmd(this)"></i>
											</div>
										</div>
									</div>
									<div class="clear" style="clear: both;border-bottom: 1px solid #CCC;"></div>
									<div class="h-top">
										<div class="h-tit">
											<div class="form-item form-nm">
												<div class="form-tag">配置响应方式</div>
											</div>
										</div>
									</div>
									<div class="form-item" style="float: left;width:522px;margin-left: 50px;padding: 20px 0px 0 0px;" id="response_check">
										<label style="padding: 10px;">
											<input type="checkbox" id="Blocke" value="2" name="response" style="margin-top: 5px;margin-right:10px" class="form-checkbox"> 阻断会话</label>
										<label style="padding: 10px;">
											<input type="checkbox" id="ignore" value="4" name="response" class="form-checkbox"> 忽略指令</label>
										<label style="padding: 10px;">
											<input type="checkbox" id="insapp" value="8" name="response" style="margin-top: 5px;margin-right:10px" class="form-checkbox">指令审批 </label>
										<span class="form-tag" style="width:6em;margin-top: -5px;">
											<em class="imp">*</em>响应方式：</span>
										<label style=" padding: 10px;">
											<input type="checkbox" id="warning_checkbox" value="1" name="" style="margin-top: 5px;margin-right:10px" class="form-checkbox">产生告警</label>
									</div>
									<div class="form-item" style="width:49%;float:left;">
										<div id="ApproveStrategy_massage" style="display:none;width: 50%;float: left;">
											<span class="form-tag" style="width:6em; margin-top:-5px;">
												<em class="imp">*</em>审批策略：</span>
											<div class="form-c" id="" style="padding-left: 86px;margin-top: -4px;">
												<div class="approve_Select" id="EnableApprove"></div>
											</div>
										</div>
										<div id="warning_massage" style="display:none;float: left;width: 50%;">
											<span class="form-tag" style="width:6em; margin-top:-5px;">
												<em class="imp">*</em>告警信息：</span>
											<div class="form-c" id="" style="padding-left: 86px;margin-top: -4px;">
												<div class="" id="EventAlarmInfoId"></div>
											</div>
										</div>
										<!--审批-->
										<div class="dialog-cont" id="EnableApprove_suspend" style="display:none;">
											<div class="container" id="add_div">
												<div class="c-cont2" style="min-height:434px;max-height:280px">
													<div class="c-form" style="padding-bottom:10px;padding:0;">
														<div class="c-form" style="padding:0;">
															<div class="form-item " style="float: left;width: 45%;padding: 20px 0px 0 85px;">
																<span class="form-tag" style="width: 50px;">
																	<em class="imp">*</em>名称：</span>
																<div class="form-c" style="padding: 0 0 0 0;">
																	<input type="text" class="form-text" id="ApproveStrategyName" name="ApproveStrategyName" onblur="regCheck(this,nameReg);"
																	 maxlength="128" style="margin-left:8px;">
																	<i class="v-check"></i>
																	<p class="form-tip" style="margin-left: 52px;">特殊字符仅支持下划线、横杠、小数点</p>
																</div>
															</div>
															<div class="form-item" style="padding-left: 500px;width: 36%;">
																<span class="form-tag" style="    width: 88px;">
																	<em class="imp">*</em>审批人数：</span>
																<div class="form-c" style="padding-left: 98px;">
																	<input edited="0" type="text" class="form-text" id="ApproveNum" name="ApproveNum" maxlength="3" style="width: 28px;float: left;text-align: center;padding: 0 5px 0 5px;"
																	 onfocus="this.select()" onkeyup="this.value = this.value.replace(/\D/g,'');$(this).attr('edited',1);">
																	<li id="" style="float: left;color: #000;margin-top: 4px;margin-left: 7px;">/</li>
																	<li id="admin_num" style="float: left;color: #000;margin-top: 5px;margin-left: 7px;">0</li>
																</div>
															</div>

															<div class="form-item " style="float: left;">
																<span class="form-tag form-tag_change" style=""><em class="imp">*</em>方式：</span>
																<div class="form-c form-c_change" style="" id="checkbox">
																	<label class="form-label" style="">
																		<span class="form-li">消息</span>
																		<input id="checkbox1" name="checkbox1" class="form-checkbox" type="checkbox" name="">
																	</label>
																	<!-- <label class="form-label" style="">
																		<input id="checkbox2" name="checkbox2" class="form-checkbox" type="checkbox" name="">
																		<li class="form-li">短信猫</li>
																	</label> -->
																	<label class="form-label" style="">
																		<span class="form-li">短信</span>
																		<input id="checkbox4" name="checkbox4" class="form-checkbox" type="checkbox" name="">
																	</label>
																	
																	<label class="form-label" style="">
																		<span class="form-li">邮件</span>
																		<input id="checkbox8" name="checkbox8" class="form-checkbox" type="checkbox" name="">
																	</label>
																	
																	<!-- <label class="form-label" style="">
																		<input id="checkbox16" name="checkbox16" class="form-checkbox" type="checkbox" name="">
																		<li class="form-li">TOKEN</li>
																	</label> -->
																	
																</div>
															</div>
															<div class="form-item" style="float: left;padding: 10px 0px;width: 382px;display: none;">
																<span class="form-tag form-tag_change" style="">短信默认：</span>
																<div class="form-c form-c_change" style="">
																	<div class="xSelect xSelect_phone_m"></div>
																</div>
															</div>
															<div class="form-item" style="float: left;padding: 10px 0px;width: auto;display: none;">
																<span class="form-tag form-tag_change" style="">短信备用：</span>
																<div class="form-c form-c_change" style="">
																	<div class="xSelect xSelect_phone_s"></div>
																</div>
															</div>
															<div class="form-item" style="float: left;padding: 10px 0px;width: 382px;display: none;">
																<span class="form-tag form-tag_change" style="">邮件默认：</span>
																<div class="form-c form-c_change" style="">
																	<div class="xSelect xSelect_smtp_m"></div>
																</div>
															</div>
															<div class="form-item" style="float: left;padding: 10px 0px;width: auto;display: none;">
																<span class="form-tag form-tag_change" style="">邮件备用：</span>
																<div class="form-c form-c_change" style="">
																	<div class="xSelect xSelect_smtp_s"></div>
																</div>
															</div>

														</div>
														<div class="form-item form-item-100" style="width: 90%;margin-left: 36px;max-height:152px;">
															<span class="form-tag" style="width: 100px;">
																<em class="imp">*</em>审批者：</span>
															<div class="h-content3" style="padding: 0 0 0 8px;max-height:114px;" name="label_list_a" id="label_list_a">
																<div class="item" style="padding-top:0px;width:195px;" id="admin_check_a" name="admin_check_a" value="0">
																	<select class="filter-select" name="admin_select_a" id="admin_select_a" style="width:160px;">
																		<option value="0" selected>请选择</option>
																	</select>
																	<i class="ctrl add" style="    margin-left: 1px;" onclick="_addadmin_a(this)"></i>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="btns" style="margin-bottom: -20px;">
												<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
												<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
											</div>
										</div>
										<!--警告-->
										<div class="dialog-cont" id="eventinfo_suspend" style="display:none;">
											<div class="container">
												<div class="c-cont" style="min-height:410px;max-height:280px">
													<div class="c-form" style="padding:0;">
														<div class="form">
															<div class="form-item" style="float: left;width: 43%;margin-left:50px;">
																<span class="form-tag" style="width:50px;">
																	<em class="imp">*</em>名称：</span>
																<div class="form-c" style="padding-left:0px;">
																	<input type="text" class="form-text" id="e_n" name="e_n" onblur="regCheck(this,nameReg);" maxlength="128" style="margin-left:8px;">
																	<i class="v-check"></i>
																	<p class="form-tip" style="margin-left:52px;">特殊字符仅支持下划线、横杠、小数点</p>
																</div>
															</div>
															<div class="form-item" style="width: 50%;float:left;">
																<span class="form-tag" style="width: 58px;padding-left: 0px;">
																	<em class="imp" id="Description_imp" style="display:none;">*</em>描述：</span>
																<div class="form-c" style="padding-left:0px;">
																	<input type="text" class="form-text" id="Description" name="Description" maxlength="1024" style="width: 183px;">
																</div>
															</div>
															<div class="form-item" style="float: left;width: 24%;margin-left:50px">
																<span class="form-tag" style="width:50px;">等级：</span>
																<div class="form-c" style="padding-left:0px;">
																	<select class="filter-select" name="EventLevel" id="EventLevel" style="width:50px;margin-left:9px;">
																		<option value="0" selected>无</option>
																		<option value="1">低</option>
																		<option value="2">中</option>
																		<option value="3">高</option>
																	</select>
																</div>
															</div>
															<div class="form-item" style="width: 29.2%;float: left;">
																<span class="form-tag" style="width: 62px;">类型：</span>
																<div class="form-c" style="padding-left: 70px;">
																	<select class="filter-select" name="EventType" id="EventType" style="width:100px;">
																		<option value="0" selected>无</option>
																		<option value="1">违规操作</option>
																		<option value="2">高危操作</option>
																		<option value="3">登录异常</option>
																	</select>
																</div>
															</div>

															<div class="form-item" style="width: 30%;float: left;">
																<span class="form-tag" style="width: 95px;">警告方式：</span>
																<div class="form-c" style="padding-left: 103px;">
																	<select class="filter-select" name="AlarmAction" id="AlarmAction" style="width:90px;">
																		<option value="0" selected>无</option>
																		<option value="1">邮件</option>
																		<!--
																		<option value="2">短信猫</option>
																		-->
																		<option value="3">短信</option>
																		<option value="4">snmp</option>
																		<option value="5">syslog</option>
																	</select>
																</div>
															</div>
															
															<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="mail1_div">
																<span class="form-tag" style="width:50px;">默认：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="mail_div1" style="margin-left: 58px;"></div>
																</div>
															</div>
															<div class="form-item" style="width: 50%;float:left;display:none;" id="mail2_div">
																<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="mail_div2" style="margin-left: 10px;"></div>
																</div>
															</div>
															
															<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="smsm1_div">
																<span class="form-tag" style="width:50px;">默认：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="smsm_div1" style="margin-left: 58px;"></div>
																</div>
															</div>
															<div class="form-item" style="width: 50%;float:left;display:none;" id="smsm2_div">
																<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="smsm_div2" style="margin-left: 10px;"></div>
																</div>
															</div>
															
															<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="smssvr1_div">
																<span class="form-tag" style="width:50px;">默认：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="smssvr_div1" style="margin-left: 58px;"></div>
																</div>
															</div>
															<div class="form-item" style="width: 50%;float:left;display:none;" id="smssvr2_div">
																<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="smssvr_div2" style="margin-left: 10px;"></div>
																</div>
															</div>
															
															<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="snmp1_div">
																<span class="form-tag" style="width:50px;">默认：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="snmp_div1" style="margin-left: 58px;"></div>
																</div>
															</div>
															<div class="form-item" style="width: 50%;float:left;display:none;" id="snmp2_div">
																<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="snmp_div2" style="margin-left: 10px;"></div>
																</div>
															</div>
															
															<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="syslog1_div">
																<span class="form-tag" style="width:50px;">默认：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="syslog_div1" style="margin-left: 58px;"></div>
																</div>
															</div>
															<div class="form-item" style="width: 50%;float:left;display:none;" id="syslog2_div">
																<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
																<div class="form-c" style="padding-left:0px;">
																	<div class="" id="syslog_div2" style="margin-left: 10px;"></div>
																</div>
															</div>
															
															<div class="form-item" style="float: left;padding: 20px 0 0px;">
																<span class="form-tag" id="AlarmReceiver_span" name="AlarmReceiver_span" style="display:none;width: 100px;float: left;">
																	<em class="imp" id="AlarmReceiver_imp">*</em>信息接收者：</span>
																<div class="h-content3" style="width: 605px;padding-left: 8px;float: left;display:none;padding-top: 0px;padding-bottom: 0px;max-height:76px;"
																 name="label_list" id="label_list">
																	<div class="item" style="padding-top:0px;width:195px;" id="admin_check" name="admin_check">
																		<select class="filter-select" name="admin_select" id="admin_select" style="width:160px;">
																			<option value="0" selected>请选择</option>
																		</select>
																		<i class="ctrl add" style="margin-left: 0px;" onclick="_addadmin(this,1)"></i>
																	</div>
																</div>
																<div class="" style="width: 84.8%;display:none;float:left;max-height:73px;margin-left:72px" id="AlarmReceiver_div" name="AlarmReceiver_div">
																	<label class="form-label" name="AlarmReceiver" id="AlarmReceiver" style="float: left;margin-left:35px;margin-top:3px;">
																		<input class="form-checkbox" type="checkbox" name="AlarmReceiver_check" id="AlarmReceiver_check">
																	</label>
																	<span style="vertical-align:middle;font-size:14px;float: left;margin-top:4px;">自定义：</span>
																	<div class="h-content3" style="padding: 0px;display:none;max-height: 76px;" id="AlarmReceiver_text" name="AlarmReceiver_text">
																		<div id="AlarmReceiver_input" name="AlarmReceiver_input" class="item" style="padding-top: 0px;width: 260px;">
																			<input type="text" class="form-text" style="width: 193px;">
																			<i class="ctrl add" onclick="_addphone_or_email(this);" style="margin-left: 0px;"></i>
																		</div>
																	</div>
																</div>
																<div class="h-content3" style="width: 605px;padding-left: 8px;float: left;display:none;padding-top: 0px;padding-bottom: 0px;max-height:76px;"
																 name="label_list1" id="label_list1">
																	<div class="item" style="padding-top:0px;width:195px;" id="admin_check1" name="admin_check1">
																		<select class="filter-select" name="admin_select1" id="admin_select1" style="width:160px;">
																			<option value="0" selected>请选择</option>
																		</select>
																		<i class="ctrl add" style="margin-left: 0px;" onclick="_addadmin(this,2)"></i>
																	</div>
																</div>
																<div class="" style="width: 84.8%;display:none;float:left;max-height:73px;margin-left:72px;" id="AlarmReceiver_div1" name="AlarmReceiver_div1">
																	<label class="form-label" name="AlarmReceiver1" id="AlarmReceiver1" style="float: left;  margin-left:35px;margin-top:3px;">
																		<input class="form-checkbox" type="checkbox" name="AlarmReceiver_check1" id="AlarmReceiver_check1">
																	</label>
																	<span style="vertical-align:middle;font-size:14px;float: left;margin-top:4px;">自定义：</span>
																	<div class="h-content3" style="padding: 0px;display:none;max-height: 76px;" id="AlarmReceiver_text1" name="AlarmReceiver_text1">
																		<div id="AlarmReceiver_input1" name="AlarmReceiver_input1" class="item" style="padding-top: 0px;width: 260px;">
																			<input type="text" class="form-text" style="width: 193px;">
																			<i class="ctrl add" onclick="_addphone_or_email(this);" style="margin-left: 0px;"></i>
																		</div>
																	</div>
																</div>
															</div>
														</div>
														
													</div>
												</div>
											</div>
											<div class="btns" style="margin-bottom: -20px;">
												<a href="javascript:;" class="btn btn-submit btn-normal">保&nbsp;&nbsp;存</a>
												<a href="javascript:;" class="btn btn-cancel btn-normal">重&nbsp;&nbsp;置</a>
											</div>
										</div>
										<!--邮件-->
										<div class="dialog-cont" id="mail_suspend" style="display:none;">
											<div class="c-cont2">
												<div class="c-form" style="padding:0;">
													<div class="form">	
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>配置名称：</span>
															<div class="form-c">
																<input id="SmtpConfigName" name="SmtpConfigName" class="form-text" maxlength="128" type="text" onblur="NameCheck(this);"><i class="v-check"></i>
																<p class="form-tip" style="width: 270px;margin-left: 70px;">特殊字符仅支持下划线、横杠、小数点</p>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>服务器地址：</span>
															<div class="form-c">
																<input id="SmtpServer" name="SmtpServer" class="form-text" type="text" style="width:238px;"  maxlength="128" onblur="IPCheck_DNS(this);"><i class="v-check"></i>
															</div>
														</div>
														
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>发送邮箱地址：</span>
															<div class="form-c">
																<input id="SenderEmail" name="SenderEmail" class="form-text" maxlength="128" type="text" onblur="EmailCheck(this);fill_text();"><i class="v-check"></i>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag">服务器账号：</span>
															<div class="form-c">
																<input id="Sender" name="Sender" class="form-text" type="text" style="width: 238px;"  maxlength="128" onblur="fill_text();"><i class="v-check"></i>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>服务器验证：</span>
															<div class="form-c" style="float:left;width:100px;padding: 4px 0 0 8px;">
																<input id="ServerVerify_off" name="ServerVerify" class="form-radio" type="radio" checked="checked">
																<span style="vertical-align:middle;font-size:14px;">否</span>
																<input id="ServerVerify_on" name="ServerVerify" class="form-radio" type="radio">
																<span style="vertical-align:middle;font-size:14px;">是</span>
															</div>
															<div class="form-c" style="float:left;padding: 0px 0 0 0;display:none;">
																<input id="SenderEmailPass" name="SenderEmailPass" class="form-text" type="password" maxlength="128">
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag">附件大小：</span>
															<div class="form-c">
																<input id="AttachMaxLimit" name="AttachMaxLimit" value="0" class="form-text" onblur="NumCheck(this);" type="text" style="width: 34px;padding: 0 3px 0px 3px;" maxlength="9">
																<span style="vertical-align:middle;font-size:14px;">M(应用于邮件报表发送)</span>
															</div>
														</div>
														
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>编码方式：</span>
															<div class="form-c">
																<select class="filter-select" id="EnCode_mail" style="width:90px;">
																	<option value="0">UTF-8</option>
																	<option value="1">GBK</option>
																</select>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>方式：</span>
															<div class="form-c">
																<select class="filter-select" id="Flag_mail" style="width:90px;">
																	<option value="2">默认</option>
																	<option value="1">备用</option>
																	<option value="0">其他</option>
																</select>
															</div>
														</div>
													</div>
												</div>
												<div class="c-form">
													<div class="btns" style="margin-bottom: -20px;">
														<a href="javascript:;" class="btn btn-normal btn-submit" >保&nbsp;&nbsp;存</a>
														<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
													</div>
												</div>
											</div>
										</div>
										<!--短信猫-->
										<div class="dialog-cont" id="smsm_suspend" style="display:none;">
											<div class="c-cont2" style="max-height:416px;">
												<div class="c-form" style="padding-bottom:10px;width: 460px;" id="smsmset">
													<div class="form">	
														<div class="sel-type1" style="float: left;width: 100%;">
															<div class="form-item" style="float:left;">
																<span class="form-tag" style="width: 90px;"><em class="imp">*</em>配置名称：</span>
																<div class="form-c" style="padding: 0 0;">
																	<input id="SmsMConfigName" name="SmsMConfigName" class="form-text" style="width:230px;" type="text" onblur="NameCheck(this);" maxlength="128"><i class="v-check"></i>
																	<p class="form-tip" style="width: 270px;margin-left: 84px;">特殊字符仅支持下划线、横杠、小数点</p>
																</div>
															</div>
															<div class="form-item" style="float:left;">
																<span class="form-tag" style="width: 90px;"><em class="imp">*</em>短信中心：</span>
																<div class="form-c" style="padding: 0 0;">
																	<input id="SmsMSender" name="SmsMSender" class="form-text" type="text" style="width:140px;"  maxlength="32" onblur="NumCheck(this)"><i class="v-check"></i>
																</div>
															</div>
															<div class="form-item" style="float:left;">
																<span class="form-tag" style="width: 93px;"><em class="imp">*</em>发送限制：</span>
																<div class="form-c" style="padding: 0 0;width: 270px;">
																	<span style="vertical-align:middle;font-size:14px;">每月</span>
																	<input id="SmsMLimit" name="SmsMLimit" value="0" class="form-text" onblur="limitCheck(this);" type="text" style="width: 34px;padding: 0 3px 0px 3px;" maxlength="9">
																	<span style="vertical-align:middle;font-size:14px;">条(0为不限制)</span>
																</div>
															</div>
															<div class="form-item" style="float:left;">
																<span class="form-tag" style="width:90px;"><em class="imp">*</em>编码方式：</span>
																<div class="form-c" style="padding:0;">
																	<select class="filter-select" id="EnCode_smsm" style="width:90px;">
																		<option value="0">UTF-8</option>
																		<option value="1">GBK</option>
																	</select>
																</div>
															</div>
															<div class="form-item" style="float:left;">
																<span class="form-tag" style="width:90px;"><em class="imp">*</em>方式：</span>
																<div class="form-c" style="padding:0;">
																	<select class="filter-select" id="Flag_smsm" style="width:90px;">
																		<option value="2">默认</option>
																		<option value="1">备用</option>
																		<option value="0">其他</option>
																	</select>
																</div>
															</div>
															<!--
															
															-->
														</div>
													</div>
												</div>
												<div class="c-form">
													<div class="btns" style="margin-bottom: -20px;">
														<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
														<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
													</div>
												</div>
											</div>
										</div>
										<!--短信网关-->
										<div class="dialog-cont" id="smssvr_suspend" style="display:none;">
											<div class="c-cont2" style="min-height:575px;">
												<div class="c-form" style="padding-bottom:10px;padding: 0;width: 700px;">
													<div class="form">	
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>配置名称：</span>
															<div class="form-c">
																<input id="SmsSvrConfigName" name="SmsSvrConfigName" style="width: 267px;" class="form-text" type="text" onblur="NameCheck(this);" maxlength="128"><i class="v-check"></i>
																<p class="form-tip" style="width: 270px;margin-left: -5px;">特殊字符仅支持下划线、横杠、小数点</p>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>数据库类型：</span>
															<div class="form-c">
																<select name="" id="SmsSvrDBType" class="type-select" style="width:299px">
																	<option value="1">ORACLE</option>
																	<option value="2">MSSQL</option>
																	<option value="3">MYSQL</option>
																	<option value="4">SYBASE</option>
																</select>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>服务器地址：</span>
															<div class="form-c">
																<input id="SmsSvrDBServerIP" name="SmsSvrDBServerIP" class="form-text" type="text" style="width: 124px;" onblur="IPCheck(this);"maxlength="32"><i class="v-check" style="margin-top: 9px;"></i>
																<span style="width: 50px;text-align: right;color: #000;line-height: 28px;"><em class="imp" style="color: #F00;font-style: normal;">*</em>端口：</span>
																<input id="SmsSvrDBPort" name="SmsSvrDBPort" class="form-text" type="text" maxlength="5" style="width: 47px;" onblur="NumCheck(this);"><i class="v-check" style="margin-top: 9px;"></i><p class="form-tip" style="width: 78px;margin-left: 216px;">0-65535之间</p>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>账号：</span>
															<div class="form-c">
																<input id="SmsSvrDBUserName" name="SmsSvrDBUserName" style="width: 267px;" class="form-text" type="text" onblur="NameCheck(this);" maxlength="128"><i class="v-check"></i>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>密码：</span>
															<div class="form-c">
																<input id="SmsSvrDBPassword" name="SmsSvrDBPassword" class="form-text" type="password" style="width: 291px;padding: 0 3px 0px 3px;" maxlength="128">
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>数据库：</span>
															<div class="form-c">
																<input id="SmsSvrDBDatabase" name="SmsSvrDBDatabase" class="form-text" type="text" maxlength="128" style="width: 267px;">
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag"><em class="imp">*</em>短信sql语句模板：</span>
															<div class="form-c">
																<input id="SmsSvrDBInsertTemp" name="SmsSvrDBInsertTemp" class="form-text" type="text" onblur="temp_check(this);" maxlength="1024" style="width: 267px;"><i class="v-check"></i>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag" style=""><em class="imp">*</em>编码方式：</span>
															<div class="form-c" style="">
																<select class="filter-select" id="EnCode_smssvr" style="width:90px;">
																	<option value="0">UTF-8</option>
																	<option value="1">GBK</option>
																</select>
															</div>
														</div>
														<div class="form-item">
															<span class="form-tag" style=""><em class="imp">*</em>方式：</span>
															<div class="form-c" style="">
																<select class="filter-select" id="Flag_smssvr" style="width:90px;">
																	<option value="2">默认</option>
																	<option value="1">备用</option>
																	<option value="0">其他</option>
																</select>
															</div>
														</div>
													</div>
												</div>
												<div class="btns" style="margin-bottom:-20px;">
													<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
													<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
												</div>
											</div>
										</div>
										<!--SNMP-->
										<div class="dialog-cont" id="snmp_suspend" style="display:none;">
											<div class="c-cont2" style="max-height: 416px;">
												<div class="c-form" style="padding-bottom:10px;padding: 0;width: 650px;" id="snmpset">
													<div class="form">	
														<div class="sel-type1" style="float: left;width: 100%;">
															<div class="form-item" style="">
																<span class="form-tag" style=""><em class="imp">*</em>配置名称：</span>
																<div class="form-c" style="">
																	<input id="SnmpConfigName" name="SnmpConfigName" class="form-text" maxlength="128" style="width:235px;" type="text" onblur="NameCheck(this);"><i class="v-check"></i>
																	<p class="form-tip" style="width: 270px;margin-left: -5px;">特殊字符仅支持下划线、横杠、小数点</p>
																</div>
															</div>
															<div class="form-item" style="">
																<span class="form-tag" style=""><em class="imp">*</em>服务器地址：</span>
																<div class="form-c" style="">
																	<input id="SnmpServerIP" name="SnmpServerIP" class="form-text" type="text" style="width:125px;"  maxlength="64" onblur="IPCheck(this);"><i class="v-check"></i>
																</div>
															</div>
															<div class="form-item" style="">
																<span class="form-tag" style=""><em class="imp">*</em>端口：</span>
																<div class="form-c" style="">
																	<input id="SnmpPort" name="SnmpPort" class="form-text" type="text" maxlength="5" onblur="PortCheck(this);" style="width: 58px;"><i class="v-check"></i>
																	<p class="form-tip" style="width: 270px;margin-left: -5px;">0-65535之间</p>
																</div>
															</div>
															<div class="form-item">
																<span class="form-tag" style=""><em class="imp">*</em>编码方式：</span>
																<div class="form-c" style="">
																	<select class="filter-select" id="EnCode_snmp" style="width:90px;">
																		<option value="0">UTF-8</option>
																		<option value="1">GBK</option>
																	</select>
																</div>
															</div>
															<div class="form-item">
																<span class="form-tag" style=""><em class="imp">*</em>方式：</span>
																<div class="form-c" style="">
																	<select class="filter-select" id="Flag_snmp" style="width:90px;">
																		<option value="2">默认</option>
																		<option value="1">备用</option>
																		<option value="0">其他</option>
																	</select>
																</div>
															</div>
															<!--
															
															-->
														</div>
													</div>
												</div>
												<div class="c-form">
													<div class="btns" style="margin-bottom:-20px;">
														<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
														<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
													</div>
												</div>
											</div>
										</div>
										<!--SYSLOG-->
										<div class="dialog-cont" id="syslog_suspend" style="display:none;">
											<div class="c-cont2" style="max-height:416px;">
												<div class="c-form" style="padding-bottom:10px;padding:0;width: 680px;" id="syslogset">
													<div class="form">	
														<div class="sel-type1" style="float: left;width: 100%;">
															<div class="form-item" style="">
																<span class="form-tag" style=""><em class="imp">*</em>配置名称：</span>
																<div class="form-c" style="">
																	<input id="SyslogConfigName" name="SyslogConfigName" maxlength="128" class="form-text" style="width:230px;" type="text" onblur="NameCheck(this);"><i class="v-check"></i>
																	<p class="form-tip" style="width: 270px;margin-left: -5px;">特殊字符仅支持下划线、横杠、小数点</p>
																</div>
															</div>
															<div class="form-item" style="">
																<span class="form-tag" style=""><em class="imp">*</em>服务器地址：</span>
																<div class="form-c" style="">
																	<input id="SyslogServerIP" name="SyslogServerIP" class="form-text" type="text" style="width:125px;"  maxlength="64" onblur="IPCheck(this);"><i class="v-check"></i>
																</div>
															</div>
															<div class="form-item" style="">
																<span class="form-tag" style=""><em class="imp">*</em>端口：</span>
																<div class="form-c" style="">
																	<input id="SyslogPort" name="SyslogPort" class="form-text" type="text" maxlength="5" onblur="PortCheck(this);" style="width: 58px;"><i class="v-check"></i>
																	<p class="form-tip" style="width: 270px;margin-left: -5px;">0-65535之间</p>
																</div>
															</div>
															<div class="form-item">
																<span class="form-tag" style=""><em class="imp">*</em>编码方式：</span>
																<div class="form-c" style="">
																	<select class="filter-select" id="EnCode_syslog" style="width:90px;">
																		<option value="0">UTF-8</option>
																		<option value="1">GBK</option>
																	</select>
																</div>
															</div>
															<div class="form-item">
																<span class="form-tag" style=""><em class="imp">*</em>方式：</span>
																<div class="form-c" style="">
																	<select class="filter-select" id="Flag_syslog" style="width:90px;">
																		<option value="2">默认</option>
																		<option value="1">备用</option>
																		<option value="0">其他</option>
																	</select>
																</div>
															</div>
															<!--
															
															-->
														</div>
													</div>
												</div>
												<div class="c-form">
													<div class="btns" style="margin-bottom:-20px;">
														<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
														<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
													</div>
												</div>
											</div>
										</div>
										
										<!--指令-->
										<div class="dialog-cont" id="cmd_suspend" style="display:none;">
											<div class="container">
												<div class="c-cont2">
													<div class="c-form" style="padding:0px;">
														<div class="form">
															<div class="form-item">
																<span class="form-tag"><em class="imp">*</em>名称：</span>
																<div class="form-c">
																	<input id="CmdSetName" type="text" class="form-text" onblur="NameCheck(this)" maxlength="128"/><i class="v-check"></i>
																	<p class="form-tip">特殊字符仅支持下划线、横杠、小数点</p>
																</div>
															</div>

															<div class="form-item">
																<span class="form-tag">描述：</span>
																<div class="form-c">
																	<input id="Description_cmd" type="text" class="form-text" maxlength="128"/><i class="v-check"></i>
																</div>
															</div>

															<div class="form-item">
																<span class="form-tag"><em class="imp">*</em>指令：</span>
																<div class="form-c">
																	<textarea id="Content_cmd" class="form-textarea" name="" id="Content" cols="30" rows="10"></textarea>
																</div>
																 <div style="float:left;margin-left:195px"><span class="form-tip">多个指令请使用换行符分隔<br /><span class="form-tip">&lt;match&gt;通>配符</span><span class="form-tip">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;nmatch&gt;取非</span><br/><span class="form-tip">&lt;regex&gt;正则表达式匹配</span><span class="form-tip">&lt;nregex&gt;取非</span><br /><span class="form-tip">&lt;include&gt;包含匹配</span><span class="form-tip">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ninclude&gt;取非</span><br /><span class="form-tip">&lt;equ&gt;完全匹配</span><br /><span class="form-tip">默认为包含匹配，增加如下例子的匹配方式，表示包含ls和-al，花括号需单独占一行：</span><br/><span class="form-tip">{</span><br /><span class="form-tip">ls</span><br /><span class="form-tip">-al</span><br /><span class="form-tip">}</span></span></div>
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="btns" style="margin-bottom: -20px;">
												<a href="javascript:;" class="btn btn-normal btn-submit" >保&nbsp;&nbsp;存</a>
												<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="clearfix"></div>
						<div class="btns add">
							<a href="javascript:;" class="btn btn-normal" onclick="next()" id="nextstep">下一步</a>
							<!--a href="javascript:;" class="btn btn-normal" onclick="cancle()">取&nbsp;&nbsp;消</a-->
						</div>
					</div>
				</div>
			</div>
			<div id="bBtn" style="z-index: 5;">
				<a href="javascript:;" class="btn" onclick="show_list(1);"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
			</div>
		</div>

	</div>
	<form action="/bhost/access_user_index" method="POST" name="frm_access">
		<input type="hidden" name="tasktype" id="tasktype" value="{{ tasktype }}" />
		<input type="hidden" name="user" id="user" value="" />
		<input type="hidden" name="page" id="page" value="{{ page }}" />
		<input type="hidden" name="id" id="id" value="{{ id }}" />
		<input type="hidden" name="name" id="name" value="{{ name }}" />
		<input type="hidden" name="type" id="type" value="{{ type }}" />
		<input type="hidden" name="z1" id="z1" value="{{manage_filter_flag}}" />
		<input type="hidden" name="z2" id="z2" value="" />
		<input type="hidden" name="us" id="us" value="" />
		<input type="hidden" name="se" id="se" value="" />
		<input type="hidden" name="a0" id="a0" value="" />
	</form>
	<!--script-->
	<script src="/manage/js/jquery.min.js"></script>
	<script src="/manage/js/jquery.easing.js"></script>
	<script src="/manage/js/layer.js"></script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/common_e.js"></script>
	<script src="/manage/js/xSelect.js"></script>
	<script src="/manage/js/base64.js"></script>
	<!--icheck-->
	<script src="/manage/js/icheck.min.js"></script>
	<style>
		.c-form-host span.ss {
			float: left;
			width: 171px;
			line-height: 28px;
			position: relative;
		}

		.h-name-son {
			display: inline-block;
		}

		.filter .selector.selector-multiple:after {
			content: '';
			display: block;
			border-color: #888 transparent transparent transparent;
			border-style: solid;
			border-width: 5px 4px 0 4px;
			height: 0;
			width: 0px;
			overflow: hidden;
			position: absolute;
			margin: 11px 0 0 9.3em;
		}

		.select2-container--open {
			z-index: 9999999;
		}

		.h-content2222 .form-item-100 .btn {
			display: inline-block;
			width: 90px;
			height: 32px;
			border: 1px solid #DDD;
			text-align: center;
			line-height: 32px;
			border-radius: 18px;
			margin: 0 10px;
			background-color: #fff;
			transition: background-color 0.4s;
			color: #7c7c7c;
		}

		.h-content2222 .form-item-100 .btn:hover {
			background-color: #8d808a;
			color: #fff;
		}

		.btns {
			background-color: rgba(255, 255, 255, 1);
		}
		.ui-dialog-body{
			padding: 20px 0 20px 0;
		}
		#mail_suspend span.form-tag{
			width: 275px;
		}
		.form-tag_change{
			width:137px;
		}
		.form-c_change{
			padding: 0;
			margin-left:144px;
		}
		.form-label {
			padding-right: 20px;
			margin-top: 5px;
		}
		.form-li {
			float: right;
			margin-top: 2px;
		}
		.h-content2 span.checkbox:not(.disabled) {
			cursor: pointer;
		}

		.h-content2 span.disabled {
			cursor: default;
		}
	</style>
	<script>
		$('.form-checkbox,.form-radio').iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		});
		$('.ss input').iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		});
	</script>

	<!--select2-->
	<script src="/manage/js/select2.full.min.js"></script>

	<script>
		$('.filter-select,.form-select,.type-select').select2({ minimumResultsForSearch: -1 });
		$('.form-select2').select2();
	</script>

	<!---->
	<script>
		function _typeSet(obj) {
			var i = $(obj).val();//1:范围指定，2:个别指定

			if (i == 1) {
				$('#pointSet2').show();
				$('#pointSet1').hide();
			} else if (i == 2) {
				$('#pointSet2').hide();
				$('#pointSet1').show();
			}

		}
		//已定义自定义
		function define_change(obj) {
			var v = $(obj).val();
			if (v == 1) { //已定义	
				$("#mix_module").show();
				$("#custom_info").hide();
				$("#rangelist").show();
				$("#defined_info").show();
				change_server();
			} else if (v == 2) { //自定义
				$("#mix_module").hide();
				$("#defined_info").hide();
				//$("#rangelist").hide();
				$("#custom_info").show();
			}
		}
		//所有共有
		var all_flag = 1;
		function mix_change(obj) {
			var v = $(obj).val();
			if (v == 1) {
				all_flag = 1;
				change_server();
			} else {
				all_flag = 0;
				change_server();
			}
		}

		function a_mix_change(obj) {
			var v = $(obj).val();
			if (v == 2) {
				//$("#service_list_a").empty();
				$("#account").hide();
			} else {
				$("#account").show();
				if ($("#mix_select").val() == 1) {
					all_flag = 1;
					change_server();
				} else {
					all_flag = 0;
					change_server();
				}
			}
		}

		function s_mix_change(obj) {
			var v = $(obj).val();
			if (v == 2) {
				$("#service_module").hide();
			} else {
				$("#service_module").show();
				if ($("#mix_select").val() == 1) {
					all_flag = 1;
					change_server();
				} else {
					all_flag = 0;
					change_server();
				}
			}
		}


		var server_set;
		//设备类型选择
		function change_device_type(obj) {
			$("#def_server").children('option').not('option:first').remove();
			$("#def_server").val('-1').trigger('change');
			$("#def_server").select2();
			bind_protocol_select();
			sel_id = -1;
			bind_conn_select();
			server_set = [];
			if ($(obj).val() != '-1') {
				$.each(device_data.data, function (i, item) {
					if (item.DeviceTypeId == $(obj).val()) {
						server_set = item.ServiceSet;
						return false;
					}
				})
				$.each(server_set, function (i, item) {
					$("#def_server").append('<option value="' + item.DeviceServiceId + '">' + item.DeviceServiceName + '</option>');
				});
				$("#def_server").select2();
			}
		}

		//模板载入
		function show_def_server(obj) {
			if ($(obj).val() != '-1') {
				$.each(server_set, function (i, item) {
					if ($(obj).val() == item.DeviceServiceId) {
						$("#Port").val(item.Port);
						$("#ProtocolName").data('value',item.ProtocolId);
						$("#ProtocolName").find('span').text(item.ProtocolName);
						sel_id = item.ProtocolId;		
						bind_conn_select();
						if (item.ConnParamId != null){
							$("#ConnParamName").data('value',item.ConnParamId);
							$("#ConnParamName").find('span').text(item.ConnParamName);
						}
						//$("#ProtocolName").val(item.ProtocolId).trigger('change');
						//$("#ConnParamName").val(item.ConnParamId).trigger('change');
					}
				})
			} else {
				$("#Port").val('');
				$("#ProtocolName").data('value','-1');
				$("#ProtocolName").find('span').text('请选择');
				sel_id = -1;		
				bind_conn_select();
				$("#ConnParamName").data('value','-1');
				$("#ConnParamName").find('span').text('请选择');
				//$("#ProtocolName").val('').trigger('change');
				//$("#ConnParamName").val('').trigger('change');
			}
		}

		var device_data;
		//获取设备类型
		function get_server() {
			$.ajax({
				url: '/bhost/get_server',
				type: 'post',
				async: false,
				data: { a0: se },
				success: function (result) {
					device_data = JSON.parse(result);
					$.each(device_data.data, function (i, item) {
						$("#device_type").append('<option value="' + item.DeviceTypeId + '">' + item.DeviceTypeName + '</option>');
					})
				}
			});
			$('#device_type').select2();
		}

		var a_data;
		//获取账号
		function get_account() {
			$.ajax({
				url: '/bhost/select_account_all',
				type: 'post',
				async: false,
				data: { a0: se, z11: -1 },
				success: function (result) {
					a_data = JSON.parse(result);
					$("#account_select").append('<option value="-1">请选择</option>');
					$.each(a_data.data, function (i, item) {
						$("#account_select").append('<option value="' + item.AccountId + '">' + item.Name + '</option>');
						a_index_all.push(item.AccountId);
					});
				}
			});
			$('#account_select').select2();
		}

		var account_arry = ['-1'];
		//选择账号
		function change_account(obj) {
			var t = $(obj).children('option:selected').val();
			if (account_arry.indexOf(t) === -1 && t != undefined) {
				account_arry.splice(0, 1, t);
			}
			if ($(obj).children('option').length == 2 && t != '-1') {
				$(obj).parent().children('i.add').click();
				$(obj).parent().hide();
			}
		}
		//添加账号
		function _addaccount(obj) {
			var add = 0;
			var name2 = $(obj).parent().children('select').children('option:selected').val();
			var t = $(obj).parent().children('select').children('option[value=' + name2 + ']').text();
			if (name2 == undefined) {
				$(obj).parent().children('select').val('-1').trigger('change');
				return false;
			}
			if (name2 == -1) {
				_alert(2, "指令授权", "请选择账号");
				return;
			}
			account_arry.splice(0, 0, '-1');
			a_index_all.splice($.inArray(parseInt(name2), a_index_all), 1);
			var $c = $(obj).parent();

			var d = $('select>option:first', $c).val();
			$c.children('select').val(d);
			var $s = $('<li class="item"><input type="text" class="form-text" id="' + name2 + '" value="' + t + '" style="width:86px;" disabled="true"><i class="ctrl del" style="margin-left: 10px;" onclick="_del_mora(this,2)"></i></li>');
			$c.children('select').find('option[value=' + name2 + ']').remove();
			$c.after($s);
		}
		//端口校正
		function port_check(obj) {
			obj.value = obj.value.replace(/\D/g, "");
		}



		var ServerIndex = -1;
		//添加服务
		function _addServer(type,obj) {
			var ServiceSet = {
				"ProtocolId": 0,
				"ProtocolName":"",
				"Port": 0,
				"ConnParamId": 0,
				"ConnParamName":""
			}
			//ProtocolId = $("#ProtocolName").val();
			var ProtocolId = $("#ProtocolName").data('value');
			var pro_name = $("#ProtocolName").find('span').text();
			if (ProtocolId == "-1" || ProtocolId == undefined) {
				_alert(2, '指令授权', "请选择协议");
				return false;
			}
			Port = $("#Port").val();
			if (Port == "") {
				_alert(2, '指令授权', "请输入端口", $("#Port"));
				return false;
			}

			if (parseInt(Port) <= 0 || parseInt(Port) >= 65535) {
				_alert(2, '指令授权', "协议端口在0~65535之间", $("#Port"));
				return false;
			}
			//ConnParamId = $("#ConnParamName").val();
			var ConnParamId = $("#ConnParamName").data('value');
			var conn_name = $("#ConnParamName").find('span').text();
			if (ConnParamId == "-1" || ConnParamId == undefined) {
				ConnParamId = null;
			}
			var n = 0;
			if (type == 'edit'){
				var edit_index = $(obj).parents('tr:eq(0)').index();
			}
			$.each(DeviceType.ServiceSet, function (i, item) {
				if (item.ProtocolId == ProtocolId && item.Port == Port && item.ConnParamId == ConnParamId && edit_index != i) {
					n = 1;
					_alert(2, "指令授权", "相同的服务已存在");
					return false;
				}
			})
			if (n) return false;
			ServiceSet.ProtocolId = parseInt(ProtocolId);
			ServiceSet.ProtocolName = pro_name;
			ServiceSet.Port = parseInt($("#Port").val());
			ServiceSet.ConnParamId = ConnParamId;
			ServiceSet.ConnParamName = conn_name;

			if (type == "add") {
				DeviceType.ServiceSet.push(ServiceSet);
				$("#service_list1").append("<tr id=\"ser_" + DeviceType.ServiceSet.length + "\"><td>" + pro_name + "</td><td>" + Port + "</td><td>" + conn_name.replace("请选择", "") + "</td><td><div class=\"tab-ctr\"><a style=\"width:8px;\" href=\"javascript:;\" class=\"edit\" onclick=\"_getDialog1('edit',this)\"></a><a style=\"width:8px;\" href=\"javascript:;\" class=\"del\" onclick=\"_delServer(this)\"></a></div></td></tr>");
			}
			else {
				DeviceType.ServiceSet[edit_index] = ServiceSet;
				$(obj).parents('tr:first').html("<td>" + pro_name + "</td><td>" + Port + "</td><td>" + conn_name.replace("请选择", "") + "</td><td><div class=\"tab-ctr\"><a style=\"width:8px;\" href=\"javascript:;\" class=\"edit\" onclick=\"_getDialog1('edit',this)\"></a><a style=\"width:8px;\" href=\"javascript:;\" class=\"del\" onclick=\"_delServer(this)\"></a></div></td></td>");

			}
			$("#service_list1 tr").bind("dblclick", function () {
				$(this).children('td:last').find('.edit').click();
			});
			clear_serverdata();
		}
		//删除服务
		function _delServer(obj) {
			$('.btn').blur();
			parent.layer.open({
				type: 1,
				title: "指令授权",
				content: '<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
				btn: ['确&nbsp;&nbsp;定', '取&nbsp;&nbsp;消'],
				btnAlign: 'c',
				closeBtn: false,
				skin: 'layer-custom',
				area: ['380px', '310px'],
				move: false,
				resize: false,
				btn1: function (i) {
					parent.layer.close(i);
					//var index = parseInt(num) - 1;
					var index = $(obj).parents('tr:eq(0)').index();
					DeviceType.ServiceSet.splice(index, 1);
					$(obj).parent().parent().parent().remove();
					clear_serverdata();
				},
				btn2: function (i) {
					parent.layer.close(i);
				}
			});
		}

		//重置数据
		function clear_serverdata() {
			$("#def_server").children('option').not('option:first').remove();
			$("#device_type").val('-1').trigger('change');
			//$("#ProtocolName").val('').trigger('change');
			bind_protocol_select();
			sel_id = -1;
			bind_conn_select();
			//ServerIndex = -1;

		}



		//编辑 服务列表数据绑定
		function _editServer(obj) {
			//var index = parseInt(num) - 1;
			//ServerIndex = index;
			var index = $(obj).parents('tr:eq(0)').index();
			bind_protocol_select();
			$("#ProtocolName").data('value',DeviceType.ServiceSet[index].ProtocolId);
			$("#ProtocolName").find('span').text(DeviceType.ServiceSet[index].ProtocolName);
			sel_id = DeviceType.ServiceSet[index].ProtocolId;
			bind_conn_select();
			if (DeviceType.ServiceSet[index].ConnParamId != null){
				$("#ConnParamName").data('value',DeviceType.ServiceSet[index].ConnParamId);
				$("#ConnParamName").find('span').text(DeviceType.ServiceSet[index].ConnParamName);
			}
			//$("#ProtocolName").val(DeviceType.ServiceSet[index].ProtocolId).trigger("change");
			//$("#ConnParamName").val(DeviceType.ServiceSet[index].ConnParamId).trigger("change");
			$("#Port").val(DeviceType.ServiceSet[index].Port);
		}

		var DeviceType = {
			"ServiceSet": [],
		}


		////服务 浮层
		function _getDialog1(type, obj) {
			$('.btn-normal1').blur();
			clear_serverdata();
			var $dialogCont = $("#scDCTab1").show();
			if (type == 'edit') {
				title = '服务';
			} else {
				title = '服务';
			}
			var d = dialog({
				title: title,
				content: $dialogCont,
				id: "scDCTab1",
				width: "600px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			if (type == 'edit') {
				$("#device_module").hide();
				$("#module_server").hide();
			}else{
				$("#device_module").show();
				$("#module_server").show();
			}
			d.showModal();
			bind_protocol_select();
			bind_conn_select();
			//get_server();
			if (type == 'edit') {
				_editServer(obj);
			}
			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				d.close().remove();
			});
			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				if (_addServer(type,obj) == false) return false;
				d.close().remove();
			})
		}

		//获取连接参数
		var connparm_list = null;
		function get_ConnParam_list(id){
			$.ajax({
				url:'/bhost/get_ConnParam_list',
				type: "post",
				async:false,
				cache:false,
				data: {a0:se,a1:id},
				success: function(Result) {
					connparm_list = JSON.parse(Result);			
				}
			});
		}

		//获取协议
		var proto_list;
		function get_protocol_list(){
			$.ajax({
				url:'/bhost/get_protocol_list',
				type: "post",
				async:false,
				cache:false,
				data: {a0:se,a1:1,a2:null,a3:null,a4:',,',a5:null},
				success: function(Result) {
					proto_list = JSON.parse(Result);		
				}
			});
		}

		function clear_protocol(){
			$("#protoDialog").find('input').val('');
			$("#Protocol_Name0").attr('disabled',false);
			
		}

		var protocol_id;
		function _editNode5(obj,type){
			clear_protocol();
			var title;
			if (type == 1) {//
				protocol_id = $(obj).children('span').data('value');
				title = "协议";
			} else if (type == 2) {
				protocol_id = 0;
				title = "协议";
			}
			var $dialogCont = $("#protoDialog").show();
			var d = dialog({
				title: title,
				content: $dialogCont,
				id: "protoDialog",
				width: "1000px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			if (manage_auth_array.indexOf(14) === -1){
				$("#protoDialog").find('.btn-submit').remove();
			}
			protocol_main(type);
			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				clear_protocol();
				protocol_main(type);
			});
			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				save_pro(d);
			})
		}
		
		function pro_check(name){
			var flag=true;
			$.ajax({
				url:'/bhost/select_name',
				type: "post",
				async:false,
				data: {a0:se,x1:name},
				success:function(result){
					data = parseInt(result);
					if (data !=0){
						flag=false;
					}
				}
			});
			return flag;
		}
		
		function save_pro(d){
			var nameReg_c = /^[\u4e00-\u9fa5a-zA-Z\d_\-]+$/;;
			var ProtocolName = $("#Protocol_Name0").val();
			var des = $("#Description0").val();
			var Port = $("#Port0").val();
			if ($("#Port1").is(":visible")){
				var Port1 = $("#Port1").val();
			}else{
				var Port1 = "0";
			}
			
			if(ProtocolName == ""){
				_alert(2,"协议","请输入名称",$("#Protocol_Name0"));	
				return false;
			}
			var len = 0;
			if (des != ""){
				for (var i = 0; i < des.length; i++) {
				   if (des.charAt(i).match(/[\u4E00-\u9FA5]/ig) != null){ //全角 
						len += 2; 
					}else{
						len += 1; 
					}
				}
				if(len >= 255){
					_alert(1,"协议","描述内容过长",$("#Description0"));
					return false;                   
				}
			}
			if(Port == ""){
				_alert(1,"协议","请输入端口",$("#Port0"));
				return false;
			}

			if(Port1 == ""){
				_alert(1,"协议","请输入端口",$("#Port1"));
				return false;
			}
			//检查输入框格式
			if(!nameReg_c.test(ProtocolName)){
				_alert(1,"协议","名称格式不正确",$("#Protocol_Name0"));
				return false;
			}
			if (protocol_id == 0){
				if(pro_check(ProtocolName)==false){
					_alert(1,"协议","相同名称已存在",$("#Protocol_Name0"));
					return false;
				}
			}
			var datalist = [];
			var dataP='{"ProtocolId":'+protocol_id+',"ProtocolName":"'+ProtocolName+'","Port":'+Port+',"Port1":'+Port1+',"Description":"'+des+'"}';
			datalist.push(dataP);
			msstr = aceg(JSON.stringify(datalist),se);
			$.ajax({
				url:'/bhost/set_protocol',
				type: "post",
				async:false,
				data: {a0:se,x1:JSON.stringify(datalist),a10:"运维管理>指令授权",m1:msstr},
				success:function(result){
					var data = JSON.parse(result);
					if (data.Result){
						$('.btn').blur();
						_alert(0,"协议","保存成功");
						var pro_text = $('#ProtocolName').find('span').text();
						$("div[data-id=xSelect-protocol]").remove();
						$('#ProtocolName').empty().data('xSelect','');
						bind_protocol_select();
						if ($("#ProtocolName").data('value') == "-1" || $("#ProtocolName").data('value') == undefined){
							$("#ProtocolName").data('value',data.ProtocolId);
							$("#ProtocolName").find('span').text(ProtocolName);
							$("#Port").val(Port);
						}else{
							$('#ProtocolName').find('span').text(pro_text);
						}
						d.close().remove();
					}else{
						_alert(1,"协议","执行失败：" + data.ErrMsg);
					}
				}
			});
		}
		
		
		function protocol_main(type){
			$("#Port1").parent().parent().hide();
			$("#Port0").on("input propertychange",function(){
				this.value = this.value.replace(/\D/g, "");
			}).on("paste",function(){return false});
			$("#Port1").on("input propertychange",function(){
				this.value = this.value.replace(/\D/g, "");
			}).on("paste",function(){return false});
			if(type == 1){
				$.ajax({
				   url:'/bhost/select_protocol',
				   type:"post",
				   async:false,
				   data:{a0:se,x1:protocol_id},
				   success:function(result){
						protdata = JSON.parse(result);
						$.each(protdata.data,function(i,item){
							if(item.ProtocolName=="PCANY")
							{
								$("#Port1").parent().parent().show();
								$("#Port1").val(item.Port1);
							}
							$("#Protocol_Name0").val(item.ProtocolName);
							$("#Port0").val(item.Port);
							$("#Description0").val(item.Description);
							$("#Protocol_Name0").attr("disabled",true);
						});
					}
				});
			}
		}

		function bind_protocol_select(){
			get_protocol_list();
			var protocol_array = [];
			$.each(proto_list.data,function(i,item){
				if (manage_auth_array.indexOf(14) != -1){
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'edit'
					};
				}else if (access_auth_array.indexOf(14) != -1){
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'check'
					};
				}else{
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':null
					};
				}
				select_data_json.value = item.ProtocolId;
				select_data_json.name = item.ProtocolName;
				protocol_array.push(select_data_json);
			});
			$('#ProtocolName').empty().data('xSelect',"");
			if (manage_auth_array.indexOf(14) != -1){
				$('#ProtocolName').xSelect({
					width: 140,
					defaultText: '请选择',
					items:protocol_array,
					module_type:'protocol',
					edit: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode5(obj,1);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								
								$(obj).parents('.xSelect-view').hide();
								_editNode5(obj,2);
							}
						}
					],
					setval:function(item,obj){
						sel_id = $(obj).find('span').data('value');		
						bind_conn_select();
						$.each(proto_list.data,function(i,item){
							if (sel_id == item.ProtocolId){
								$("#Port").val(item.Port);
								return false;
							}
						});
					}
				});
			}else{
				$('#ProtocolName').xSelect({
					width: 140,
					defaultText: '请选择',
					items:protocol_array,
					module_type:'protocol',
					check: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode5(obj,1);
					},
					setval:function(item,obj){
						sel_id = $(obj).find('span').data('value');		
						bind_conn_select();
						$.each(proto_list.data,function(i,item){
							if (sel_id == item.ProtocolId){
								$("#Port").val(item.Port);
								return false;
							}
						});
					}
				});
			}
			
		}

		var sel_id = -1;

		function bind_conn_select(){
			get_ConnParam_list(sel_id);
			var conn_array = [];
			if (connparm_list != null){
				$.each(connparm_list.data,function(i,item){
					
					if (manage_auth_array.indexOf(14) != -1){
						var select_data_json = {
							'value':1,
							'name':'admin2',
							'type':'edit'
						};
					}else if (access_auth_array.indexOf(14) != -1){
						var select_data_json = {
							'value':1,
							'name':'admin2',
							'type':'check'
						};
					}else{
						var select_data_json = {
							'value':1,
							'name':'admin2',
							'type':null
						};
					}
					select_data_json.value = item.ConnParamId;
					select_data_json.name = item.ConnParamName;
					conn_array.push(select_data_json);
				});
			}
			$('#ConnParamName').empty().data('xSelect',"");
			if (manage_auth_array.indexOf(14) != -1){
				$('#ConnParamName').xSelect({
					width: 140,
					defaultText: '请选择',
					items:conn_array,
					module_type:'conn',
					edit: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode6(obj,1);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								
								$(obj).parents('.xSelect-view').hide();
								_editNode6(obj,2);
							}
						}
					]
				});
			}else{
				$('#ConnParamName').xSelect({
					width: 140,
					defaultText: '请选择',
					items:conn_array,
					module_type:'conn',
					check: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode6(obj,1);
					}
				});
			}
			
		}
		
		function clear_conn(){
			$("#d_n_con").attr('disabled',false).val("");
			$("#d_n_con").next('i').attr('class','v-check');
			$("#connDialog").find('input').val('');
			$("#connDialog").find('select').val('0').trigger('change');
			$("#ServiceName_ssh").val('1').trigger('change');
			$("#rdpType").val('NORMAL').trigger('change');
		}
		var conn_id;
		function _editNode6(obj,type){
			clear_conn();
			var title;
			if (type == 1) {//
				conn_id = $(obj).children('span').data('value');
				title = "连接参数";
			} else if (type == 2) {
				protocol_id = 0;
				title = "连接参数";
			}
			var $dialogCont = $("#connDialog").show();
			var con_d = dialog({
				title: title,
				content: $dialogCont,
				id: "connDialog",
				width: "800px;"
			});
			con_d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			con_d.showModal();
			if (manage_auth_array.indexOf(14) === -1){
				$("#connDialog").find('.btn-submit').remove();
			}
			conn_main(type);
			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				clear_conn();
				conn_main(type);
			});
			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				connection_add(con_d);
			})
		}

		function conn_main(type){
			var ProtocolId_arr=[9,10,11,12,16,17,18];
			//协议类型下拉框
			$.ajax({
				url: "/bhost/get_protocol_list",
				type: "POST",
				async: false,
				data: { a0: se, a3: 17, a2: 1, a4: ",," },
				success: function (result) {
					var userinfo_result = JSON.parse(result);
					var userinfo_data = userinfo_result.data;
					$("#Protocol_con").empty();
					$("#Protocol_con").append('<option value="0">请选择</option>');
					$.each(userinfo_data, function (i, item) {
						if($.inArray(item.ProtocolId,ProtocolId_arr)>=0){
							return true;
						}
						$("#Protocol_con").append('<option value="' + item.ProtocolId + '" text="' + item.ProtocolName + '">' + item.ProtocolName + '</option>');
					});
				}
			});
			if (type == 1) {
				$.ajax({
					url: "/bhost/get_connection_list",
					type: "POST",
					async: false,
					data: { a0:se, a1: conn_id },
					success: function (result) {
						var connection_result = JSON.parse(result);
						if (connection_result.Result == true) {
							var connection_data = connection_result.info.data[0];
							$("#d_n_con").val(connection_data.ConnParamName);
							$("#d_n_con").attr("disabled", true);
							$("#Protocol_con").val(connection_data.ProtocolId).trigger('change');
							switch (connection_data.ProtocolName) {
								case 'RDP':
									$('#RDP').show();
									$('#rdpType').val(connection_data.ConnType).trigger('change');
									break;
								case 'SSH':
									$('#SSH').show();
									$('#ServiceName_ssh').val(connection_data.ServiceName).trigger('change');
									break;
								case 'SFTP':
									$('#SFTP').show();
									$('#ServiceName_sftp').val(connection_data.ServiceName).trigger('change');
									break;
								//HTTP(S)
								case 'HTTP(S)':
									$("#HTTP").show();
									$("#url").val(connection_data.ServiceName);
									var index=connection_data.ConnParamValue.indexOf('|');
									$("#UserName").val(connection_data.ConnParamValue.substring(0,index));
									connection_data.ConnParamValue=connection_data.ConnParamValue.substring(index+1);
									var index=connection_data.ConnParamValue.indexOf('|');
									$("#UserPwd").val(connection_data.ConnParamValue.substring(0,index));
									$("#Submit").val(connection_data.ConnParamValue.substring(index+1));
									/*
									$("#HTTP").show();
									connection_data.ConnParamValue =connection_data.ConnParamValue.split('|');
									$("#url").val(connection_data.ServiceName);
									$("#UserName").val(connection_data.ConnParamValue[0]);
									$("#UserPwd").val(connection_data.ConnParamValue[1]);
									$("#Submit").val(connection_data.ConnParamValue[2]);
									*/
									break;
								//HTTPs
								case 'HTTPS':
									$("#HTTPs").show();
									$("#httpsurl").val(connection_data.ServiceName);
									var index=connection_data.ConnParamValue.indexOf('|');
									$("#httpsUserName").val(connection_data.ConnParamValue.substring(0,index));
									connection_data.ConnParamValue=connection_data.ConnParamValue.substring(index+1);
									var index=connection_data.ConnParamValue.indexOf('|');
									$("#httpsUserPwd").val(connection_data.ConnParamValue.substring(0,index));
									$("#httpsSubmit").val(connection_data.ConnParamValue.substring(index+1));
									/*
									$("#HTTPs").show();
									connection_data.ConnParamValue = JSON.parse(connection_data.ConnParamValue);
									$("#httpsurl").val(connection_data.ServiceName);
									if (connection_data.ConnParamValue.UserPwd == null) {
										connection_data.ConnParamValue.UserPwd = "";
									}
									if (connection_data.ConnParamValue.UserName == null) {
										connection_data.ConnParamValue.UserName = "";
									}
									if (connection_data.ConnParamValue.Submit == null) {
										connection_data.ConnParamValue.Submit = "";
									}
									$("#httpsUserPwd").val(connection_data.ConnParamValue.UserPwd);
									$("#httpsUserName").val(connection_data.ConnParamValue.UserName);
									$("#httpsSubmit").val(connection_data.ConnParamValue.Submit);
									*/
									break;
								//ORACLE
								case 'ORACLE':
									//
									if (connection_data.ConnParamValue == null) {
										connection_data.ConnParamValue = 0;
									}
									//指定项必填
									$("#appoint").val(connection_data.ConnParamValue).trigger('change');
									$("#s_n").val(connection_data.ServiceName);
									if (connection_data.ConnType == null) {
										connection_data.ConnType = 0;
									}
									$("#conn").val(connection_data.ConnType).trigger('change');
									//
									$("#ORACLE").show();
									break;
								//RADMIN
								case 'RADMIN':
									//认证方式：
									if (connection_data.ConnType == null) {
										connection_data.ConnType = "0";
									}
									$("#authtype").val(connection_data.ConnType).trigger("change");
																		$("#RADMIN").show();
									break;
								//MSSQL
								case 'MSSQL':
									//
									//实例名：
									$("#o_n").val(connection_data.ServiceName);
									//认证方式：
									if (connection_data.ConnType == null) {
										connection_data.ConnType = "0";
									}
									$("#R_authtype").val(connection_data.ConnType).trigger("change");
									//
									$("#MSSQL").show();
									break;
								//MYSQL 
								case 'MYSQL':
									//
									//数据库名：
									$('#sql_n').val(connection_data.ServiceName);
									//
									$("#MY_DB2").show();
									//$('#MY_ConnType').show();
									break;
								//DB2
								case 'DB2':
									//
									//数据库名：
									$('#dbsql_n').val(connection_data.ServiceName);
									//
									$("#DB2").show();
									break;
								//SYBASE
								case 'SYBASE':
									//
									//实例名：
									$('#sy_o_n').val(connection_data.ServiceName);
									//
									$("#SYBASE").show();
									break;
							}
						} else {
							_alert(1, '连接参数', connection_result.ErrMsg);
							return false;
						}
					}
				});
			}

			$("#Protocol_con").change(function () {
				var p_id = $(this).val();
				$("#HTTP").hide();
				$("#HTTPs").hide();
				$("#ORACLE").hide();
				$("#RADMIN").hide();
				$("#MSSQL").hide();
				$("#SYBASE").hide();
				$("#MY_DB2").hide();
				$('#RDP').hide();
				$("#SSH").hide();
				$("#SFTP").hide();
				$('#MY_ConnType').hide();
				$("#DB2").hide();
				//$('#MY_ConnType').hide();
				switch ($('#Protocol_con option[value='+p_id+']').text()) {
					case "RDP":
						$('#RDP').show();
						break;
					case "SSH":
						$('#SSH').show();
						break;
					case "SFTP":
						$('#SFTP').show();
						$("#ServiceName_sftp").val('1').trigger('change');
						break;
					//HTTP(S)
					case "HTTP(S)":
						$("#HTTP").show();
						break;
					//HTTP
					case "HTTPS":
						$("#HTTPs").show();
						break;
					//ORACLE
					case "ORACLE":
						$("#ORACLE").show();
						break;
					//RADMIN
					case "RADMIN":
						$("#RADMIN").show();
						break;
					//MSSQL
					case "MSSQL":
						$("#MSSQL").show();
						break;
					//MYSQL 
					case "MYSQL":
						$("#MY_DB2").show();
						//$('#MY_ConnType').show();
						break;
					//DB2
					case "DB2":
						$("#DB2").show();
						break;
					//SYBASE
					case "SYBASE":
						$("#SYBASE").show();
						break;
				}
			});
		}

		var connection = {
			"ConnParamId": 0,
			"ConnParamName": null,
			"ProtocolId": 0,
			"ServiceName": null,
			"ConnType": null,
			"ConnParamValue": null
		};

		var cnameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
		var sp_char = /^[^@\/\'\\\"#$%&\^\*|]+$/;
		function connection_add(con_d){
			connection = {
				"ConnParamId": 0,
				"ConnParamName": null,
				"ProtocolId": 0,
				"ServiceName": null,
				"ConnType": null,
				"ConnParamValue": null
			};
			var p_id = $("#Protocol_con").val();
			var val = $("#d_n_con").val();
			var $i = $("#d_n_con").next('i.v-check');
			if (val == "") {
				_alert(2, "连接参数", '请输入名称', $("#d_n_con"));
				return false;
			}
			if (!cnameReg.test(val)) {
				_alert(1, "连接参数", '名称格式不正确', $("#d_n_con"));
				return false;
			}
			if (p_id == "0") {
				_alert(2, "连接参数", '请选择协议类型');
				return false;
			}
			connection.ConnParamName = val;
			connection.ConnParamId = parseInt(conn_id);
			switch ($('#Protocol_con option[value='+p_id+']').text()) {
				case 'RDP':
					connection.ServiceName = null;
					connection.ConnType = $('#rdpType').val();
					connection.ConnParamValue = null;
					break;
				//SSH
				case "SSH":
					var ServiceName_ssh = $('#ServiceName_ssh').val();
					connection.ServiceName = ServiceName_ssh;
					connection.ConnType = null;
					connection.ConnParamValue = null;
					break;
				case "SFTP":
					var ServiceName_ssh = $('#ServiceName_sftp').val();
					connection.ServiceName = ServiceName_ssh;
					connection.ConnType = null;
					connection.ConnParamValue = null;
					break;
				//HTTP(S)
				case "HTTP(S)":
					var url = $("#url").val();
					if (url == "") {
						_alert(2, "连接参数", "请输入URL", $("#url"));
						return false;
					}
					var UserName = $("#UserName").val();
					if (!sp_char.test(UserName) && UserName != "") {
						_alert(1, "连接参数", "账号元素格式不正确", $("#UserName"));
						//$("#UserName").val("");
						return false;
					}
					var UserPwd = $("#UserPwd").val();
					if (!sp_char.test(UserPwd) && UserPwd != "") {
						_alert(1, "连接参数", "密码元素格式不正确", $("#UserPwd"));
						//$("#UserPwd").val("");
						return false;
					}
					connection.ServiceName = url;
					connection.ConnType = null;
					var Submit = $("#Submit").val();
					var json_a = UserName + '|' + UserPwd + '|' + Submit;
					connection.ConnParamValue = json_a;
					break;
				//HTTPs
				case "HTTPS":
					var url = $("#httpsurl").val();
					if (url == "") {
						_alert(2, "连接参数", "请输入URL", $("#url"));
						return false;
					}
					var UserName = $("#httpsUserName").val();
					if (!sp_char.test(UserName) && UserName != "") {
						_alert(1, "连接参数", "账号元素格式不正确", $("#UserName"));
						//$("#UserName").val("");
						return false;
					}
					var UserPwd = $("#httpsUserPwd").val();
					if (!sp_char.test(UserPwd) && UserPwd != "") {
						_alert(1, "连接参数", "密码元素格式不正确", $("#UserPwd"));
						//$("#UserPwd").val("");
						return false;
					}
					connection.ServiceName = url;
					connection.ConnType = null;
					var Submit = $("#httpsSubmit").val();
					//Submit = '"' + Submit + '"';
					//UserName = '"' + UserName + '"';
					//UserPwd = '"' + UserPwd + '"';
					//var json_a = '{"UserName":' + UserName + ',"UserPwd":' + UserPwd + ',"Submit":' + Submit + '}';
					var json_a = UserName + '|' + UserPwd + '|' + Submit;
					connection.ConnParamValue = json_a;
					//connection.ConnParamValue = (JSON.parse(json_a));
					break;
				//ORACLE
				case "ORACLE":
					//指定项必填
					var appoint = $("#appoint").children("option:selected").val();
					if (appoint == "0") {
						_alert(2, "连接参数", "请选择指定项", $("#appoint"));
						return false;
					}
					var s_n = $("#s_n").val();
					if (s_n == "") {
						_alert(2, "连接参数", "请输入实例名或服务名", $("#s_n"));
						//$("#s_n").val("");
						return false;
					} else if (!sp_char.test(s_n)) {
						_alert(1, "连接参数", "实例名或服务名格式不正确", $("#s_n"));
						//$("#s_n").val("");
						return false;
					}
					var conn_text = $("#conn").children("option:selected").text();
					if (conn_text == "未指定") {
						conn_text = null;
					}
					var appoint_text = $("#appoint").children("option:selected").text();
										connection.ConnParamValue = appoint_text;
					connection.ServiceName = s_n;
					connection.ConnType = conn_text;
					break;
				//RADMIN
				case "RADMIN":
					//认证方式：
					var authtype = $("#authtype").children("option:selected").text();
					if (authtype == "未指定") {
						authtype = null;
					}
										connection.ServiceName = null;
					connection.ConnType = authtype;
					connection.ConnParamValue = null;
					break;
				//MSSQL
				case "MSSQL":
					//实例名：
					var o_n = $("#o_n").val();
					if (o_n == "") {
						_alert(2, "连接参数", "请输入实例名", $("#o_n"));
						//$("#o_n").val("");
						return false;
					} else if (!sp_char.test(o_n)) {
						_alert(1, "连接参数", "实例名格式不正确", $("#o_n"));
						//$("#o_n").val("");
						return false;
					}
					//认证方式：
					var R_authtype = $("#R_authtype").children("option:selected").text();
					if (R_authtype == "未指定") {
						R_authtype = null;
					}
					connection.ServiceName = o_n;
					connection.ConnType = R_authtype;
					connection.ConnParamValue = null;
					break;
				//MYSQL 
				case "MYSQL":
					//数据库名：
					var sql_n = $("#sql_n").val();
					if (sql_n == "") {
						_alert(2, "连接参数", "请输入数据库名", $("#sql_n"));
						//$('#sql_n').val("");
						return false;
					} else if (!sp_char.test(sql_n)) {
						_alert(1, '连接参数', '数据库名格式不正确', $("#sql_n"));
						//$("#sql_n").val("");
						return false;
					}
					var select_my=parseInt($('#select_my').val());
					connection.ServiceName = sql_n;
					connection.ConnType = select_my;
					connection.ConnParamValue = null;
					break;
				//DB2
				case "DB2":
					//数据库名：
					var sql_n = $("#dbsql_n").val();
					if (sql_n == "") {
						_alert(2, "连接参数", "请输入数据库名", $("#sql_n"));
						//$('#sql_n').val("");
						return false;
					} else if (!sp_char.test(sql_n)) {
						_alert(1, '连接参数', '数据库名格式不正确', $("#sql_n"));
						//$("#sql_n").val("");
						return false;
					}
					connection.ServiceName = sql_n;
					connection.ConnType = null;
					connection.ConnParamValue = null;
					break;
				//SYBASE
				case "SYBASE":
					//实例名：
					var sy_o_n = $("#sy_o_n").val();
					if (sy_o_n == "") {
						_alert(2, "连接参数", "请输入实例名", $("#sy_o_n"));
						//$('#sy_o_n').val("");
						return false;
					} else if (!sp_char.test(sy_o_n)) {
						_alert(1, '连接参数', '实例名格式不正确', $("#sy_o_n"));
						//$("#sy_o_n").val("");
						return false;
					}
					connection.ServiceName = sy_o_n;
					connection.ConnType = null;
					connection.ConnParamValue = null;
					break;
				default:
					connection.ServiceName = null;
					connection.ConnType = null;
					connection.ConnParamValue = null;
			}
			connection.ProtocolId = parseInt(p_id);
			var msstr = aceg(JSON.stringify(connection),se);
			$.ajax({
				url: '/bhost/add_connection',
				type: "POST",
				async: false,
				data: { a0: se, a1: JSON.stringify(connection), a10:"运维管理>指令授权",m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result == true) {
						$('.btn').blur();
						_alert(0,"连接参数","保存成功");
						con_d.close().remove();
						var conn_text = $('#ConnParamName').find('span').text();
						var sel_conid = $('#ConnParamName').data('value');
						$("div[data-id=xSelect-conn]").remove();
						$('#ConnParamName').empty().data('xSelect','');
						bind_conn_select();
						if (sel_conid == "-1" || sel_conid == undefined){
							var isexist = 0;
							$.each(connparm_list.data,function(i,item){
								if (item.ConnParamId == result.ConnParamId){
									$("#ConnParamName").data('value',result.ConnParamId);
									$("#ConnParamName").find('span').text(connection.ConnParamName);
									isexist = 1;
									return false;
								}
							});
							if (isexist == 0){
								$("#ConnParamName").data('value','-1');
								$("#ConnParamName").find('span').text('请选择');
							}
						}else{
							$.each(connparm_list.data,function(i,item){
								if (item.ConnParamId == sel_conid){
									$('#ConnParamName').find('span').text(conn_text);
									return false;
								}
							});
						}
					} else {
						_alert(1, "连接参数", result.ErrMsg, $("#d_n_con"));
						return false;
					}
				}
			});
		}

		var manager_arry = ['-1'];
		function change_manager(obj) {
			var t = $(obj).children('option:selected').val();
			if (manager_arry.indexOf(t) === -1 && t != undefined) {
				manager_arry.splice(0, 1, t);
			}
			if ($(obj).children('option').length == 2 && t != '-1') {
				$(obj).parent().children('i.add').click();
				$(obj).parent().hide();
			}
		}

		function _addmanager(obj) {
			var add = 0;
			var name2 = $("#manager_select").children('option:selected').val();
			var t = $(obj).parent().children('select').children('option[value=' + name2 + ']').text();
			if (name2 == undefined) {
				$(obj).parent().children('select').val('-1').trigger('change');
				return false;
			}
			if (name2 == -1) {
				_alert(2, "指令授权", "请选择协助管理者");
				return;
			}
			manager_arry.splice(0, 0, '-1');
			m_index_all.splice($.inArray(parseInt(name2), m_index_all), 1);
			var $c = $(obj).parent();
			var d = $('select>option:first', $c).val();

			$c.children('select').val(d);
			$c.children('select').find('option[value=' + name2 + ']').remove();
			var $s = $('<li class="item"><input type="text" class="form-text" id="' + name2 + '" value="' + t + '" style="width:88px;" disabled="true"><i class="ctrl del" onclick="_del_mora(this,1)"></i></li>');
			$c.after($s);
		}

		function _del_frame(obj, data, arry) {
			$(obj).children('select').children('option').remove();
			$(obj).children('select').append('<option value=\"-1\">请选择</option>');
			if (data[0].CmdSetId != undefined) {
				$.each(data, function (i1, item1) {
					$(obj).children('select').append('<option value="' + item1.CmdSetId + '">' + item1.Name + '</option>');
				});

			} else if (data[0].UserId != undefined) {
				$.each(data, function (i1, item1) {
					$(obj).children('select').append('<option value="' + item1.UserId + '">' + item1.UserCode + '</option>');
				})
			} else if (data[0].AccountId != undefined) {
				$.each(data, function (i1, item1) {
					$(obj).children('select').append('<option value="' + item1.AccountId + '">' + item1.AccountName + '</option>');
				})
			}
			$.each(arry, function (i2, item2) {
				if (item2 != '-1' && i2 != 0) {
					$(obj).children('select').children('option[value=' + item2 + ']').remove();
				}
			});
			$(obj).children('select').val(arry[0]).trigger('change');
		}

		//删除协助管理者和账号
		var m_index_all = [];
		var a_index_all = [];
		function _del_mora(obj, type) {
			var $c = $(obj).parent();
			var id = $c.children('input').attr('id');
			var t = $(obj).siblings('input').val();
			var v, data, max;
			var min = 0;
			if (type == 1) {
				max = m_index_all.length - 1;
				$("#manager_select").parent().show();
				manager_arry.splice($.inArray(id, manager_arry), 1);
				data = m_index_all;
				$p = $("#manager_select");
			} else if (type == 2) {
				max = a_index_all.length - 1;
				$("#account_select").parent().show();
				account_arry.splice($.inArray(id, account_arry), 1);
				data = a_index_all;
				$p = $("#account_select");
			} else if (type == 3) {
				max = cmd_index_all.length - 1;
				$("#cmd").parent().show();
				cmdset.splice($.inArray(id, cmdset), 1);
				data = cmd_index_all;
				$p = $("#cmd");
			}
			$c.remove();
			if (max < 0){
				var index_1 = -1;
			}else{
				var index_1 = search_i(min, max, id, data);
			}
			//var index_1 = search_i(min, max, id, data);
			index_1 = parseInt(index_1);
			if (index_1 == -1) {
				index_1 = max+1;
				$p.append('<option value="' + id + '">' + t + '</option>');
			} else if (index_1 == -2) {
				index_1 = 0;
				$p.children('option').eq(0).after('<option value="' + id + '">' + t + '</option>');
			} else {
				$p.children('option[value=' + data[index_1] + ']').before('<option value="' + id + '">' + t + '</option>');
			}

			if (type == 1) {
				m_index_all.splice(index_1, 0, parseInt(id));
			} else if (type == 2) {
				a_index_all.splice(index_1, 0, parseInt(id));
			} else if (type == 3) {
				cmd_index_all.splice(index_1, 0, parseInt(id));
			}
		}

		function search_i(min, max, id, data) {
			var mid, res;
			if (data[max] < id) {
				return -1;
			}
			if (data[min] > id) {
				return -2;
			}
			while (min <= max) {
				mid = parseInt((min + max) / 2);
				if (data[mid] > id) {
					max = mid - 1;
					res = mid;
				} else {
					min = mid + 1;
				}
			}
			return res;
		}
		function _del(obj) {
			var id = $(obj).parent().children('input').attr('id');
			var $c = $(obj).parent();
			var $p = $(obj).parent().parent().children('li:first');
			var type = $(obj).parent().parent().attr('id');
			$c.remove();
			if (type == "contlist") {
				$("#manager_select").parent().show();
				manager_arry.splice($.inArray(id, manager_arry), 1);
				_del_frame($p, mdata, manager_arry);
			} else if (type == "xx") {
				$("#cmd").parent().show();
				cmdset.splice($.inArray(id, cmdset), 1);
				_del_frame($p, cmd_data.data, cmdset);
			} else if (type == "account_module") {
				$("#account_select").parent().show();
				account_arry.splice($.inArray(id, account_arry), 1);
				_del_frame($p, a_data.data, account_arry);
			}
		}

		//过滤下拉框选择
		function filter_change(obj) {
			var name = $(obj).val();
			if (name == '0') {
				$("#keyword").hide();
				$("#filterWW1").hide();
			} else {
				$("#keyword").show();
				$("#filterWW1").show();
			}
		}
		
		String.prototype.ResetBlank=function(){
			var regEx = /\s+/g; 
			return this.replace(regEx, ' '); 
		};

		var find_use_arry = [];
		var find_use_flag = 0;
		var find_user_loading = false;
		function _addFilter(obj, type) {
			if (find_user_loading){
				_alert(2,"搜索","正在搜索中，请先等待搜索完成");
				return false; 
			}
			var v2 = $(obj).parent().children('input[type=text]').val().trim();
			var filter_name = $("#filter_select").val();
			var filter_flag = 0;
			if (v2 == ""){
				_alert(2, "搜索", "请输入关键字", $("#keyword"));
				return false;
			}
			v2 = v2.ResetBlank();
			var addfilter = "";
			var addfilter_v = "";
			var addfilter_name = "";
			if (filter_name == "0"){
				addfilter = "所有-" + v2;
				addfilter_v = v2;
				addfilter_name = "所有";
			}else if (filter_name == "1"){
				addfilter = "组名-" + v2;
				addfilter_v = addfilter;
				addfilter_name = "组名";
			}else if (filter_name == "2"){
				addfilter = "账号-" + v2;
				addfilter_v = addfilter;
				addfilter_name = "账号";
			}
			_getWait($(".waitTip2"));
			var type_value = true;
			if (type) {
				$("#filterWW1").children('ul').children('li').each(function (i, item) {
					if ($(this).children('span').text() == addfilter_v) {
						filter_flag = 1;
						return false;
					}
				})
				/*
				if (addfilter_name != "所有"){
					$("#filter_select").empty().append('<option value="0">所有</option><option value="'+filter_name+'">'+addfilter_name+'</option>');
					$("#filter_select").val(filter_name).trigger('change');
				}
				*/
				if (filter_flag == 0) {
					if (text_check1 == addfilter){
						type_value = false;
					}
					if (find_use_flag == 1) {
						//find_use_arry=[];
						find_use_arry.splice(-1, 1);
						find_use_flag = 0;
					}
					$("#keyword").val('');
					find_use_arry.push(addfilter);
					text_check1 = "";
					$("#text_check1").hide();
					$('#filterWW1>ul').append('<li style="height: 18px;"><span class="ww" data-value="'+addfilter+'">' + addfilter_v + '</span><i class="del" style="margin-top: -17px;" onclick="_delFilter(this)"></i></li>')
					selView(type_value);
					$("#keyword").blur();
				}
			} else {
				if (text_check1 == addfilter){
					type_value = false;
				}
				if (find_use_flag != 0) {
					find_use_arry.splice(-1, 1);
				}
				find_use_flag = 1;
				//_clearFilter();
				//find_use_arry=[];
				find_use_arry.push(addfilter);
				text_check1 = addfilter;
				selView(type_value);
			}
		}
		function _clearFilter(obj) {
			if (find_user_loading){
				_alert(2,"搜索","正在搜索中，请先等待搜索完成");
				return false; 
			}
			$("#filterWW1").children('ul').empty();
			$("#filterWW1").hide();
			$("#clearFilter").hide();
			find_use_flag = 0;
			$("#text_check1").hide();
			find_use_arry = [];
			//$("#filter_select").empty().append('<option value="0">所有</option><option value="1">组名</option><option value="2">账号</option>')
			selView(true);
		}
		
		function _clear_keyword(){
			$("#keyword").val("");
			$("#text_check1").hide();
			if (text_check1 != ""){
				if (find_user_loading){
					_alert(2,"搜索","正在搜索中，请先等待搜索完成");
					return false; 
				}
				text_check1 = "";
				find_use_flag = 0;
				find_use_arry.splice(-1,1);
				find_usergroup();
			}
		}
		
		function change_input(obj,type){
			if ($(obj).val() == ""){
				if (type == 0){
					if (text_check1 != ""){
						text_check1 = "";
						find_use_flag = 0;
						find_use_arry.splice(-1,1);
						selView();
					}
				}else if (type == 1){
					if (search_typeall_new != ""){
						search_typeall_new = "";
						selView1();
					}
				}else if (type == 2){
					if (server_text1_v != ""){
						server_text1_v = "";
						find_flag = 0;
						find_host_arry.splice(-1,1);
						selView2();
					}
				}
			}
		}
		
		function click_h() {
			var i_u = 0;
			index_u = 0;
			flag_ajax_true_u = true;
			$("#userTree").find('i.h-aicon.h-aicon-d').removeClass('h-aicon-d');
			$("#userTree").find('ul').hide();
			$("#userTree").find('li').hide();
			$('#userTree').find('.font-red').removeClass('font-red');
			$("#userTree").find('span.h-name-red').removeClass('h-name-red');
			path_all = [];
			old_path_all_u = [];
			push_filter_wait_u = [];
			click_u();
		}
		var mtr_u=null;
		var flag_ajax_true_u = false;
		var first_find_index_u = null;
		function click_u(){
			if(mtr_u!=null){
				mtr_u.abort();
				mtr_u=null;
			}
			flag_ajax_true_u = true;
			//$('#user_module').scrollTop(0);
			if (JSON.stringify(find_use_arry) == "[]"){
				_waitDone($(".waitTip2"));
				$('#user_module').scrollTop(0);
				tmp_list_u=null;
				first_find_index_u=null;
				$('#userTree').find('li').show();
				$('#userTree').find('ul').hide();
				$("#userTree").find('i.h-aicon.h-aicon-d').removeClass('h-aicon-d');
				$('#userTree').find('.font-red').removeClass('font-red');
				$("#userTree").find('span.h-name-red').removeClass('h-name-red');
				find_user_loading = false;
				return false;
			}
			//first_find_index_u=find_use_arry[0];
			//var a=new Array();
			//a[0]=find_host_arry[0];
			$.ajax({
				url: '/bhost/Pind_UserDirectory',
				type: "POST",
				async: true,
				data: { a0: se, z1: JSON.stringify(find_use_arry) },
				success: function (result) {
					//_getWait($(".waitTip2"));
					mtr_u=null;
					tmp_list_u=null;
					flag_ajax_true_u = false;
					$('#userTree').find('li').show();
					$('#userTree').children('li').hide();
					if (result == "None") {
						tmp_list_u = new Array();
						$("#keyword").blur();
						_waitDone($(".waitTip2"));
						_alert(0, '搜索', '无搜索结果', $("#keyword"));
						find_user_loading = false;
						return false;
					}
					tmp_list_u = JSON.parse(result);
					$.each(tmp_list_u, function (i, item) {
						if(item.Name == "admin"){
							tmp_list_u.splice(i,1);
							if(tmp_list_u.length == 0){
								$("#keyword").blur();
								find_user_loading = false;
								_waitDone($(".waitTip2"));
								_alert(0, '搜索', '无搜索结果', $("#keyword"));
							}
							return false;
						}
					})


					ajax_find_host_doing_u=true;
					/*
					if(find_use_arry.length>1){
						var new_list_arr=new Array();
						new_list_arr=tmp_list_u.filter(function (item) {
							var pass=true;
							for(var jm=0;jm<find_use_arry.length;jm++){
								var pass_one=false;
								//var search_arr=find_use_arry[jm].split(' ');
								var jm_index = find_use_arry[jm].indexOf('-');
								var search_arr = find_use_arry[jm].substr(jm_index + 1, find_use_arry[jm].length).split(' ');
								$.each(search_arr,function(i1,item1){
									if(item1!=''){
										if (find_use_arry[jm].substr(0,jm_index) == "账号"){
											if (item.Type != 2){
												return false;
											}
										}else if (find_use_arry[jm].substr(0,jm_index) == "组名"){
											if (item.Type != 1){
												return false;
											}
										}
										if(coverString(item1,item.Name)){
											pass_one=true;
											return false;
										}
									}
								});
								if(pass_one==false){
									pass=false;
									break;
								}
							}
							return pass;
						});
						if(new_list_arr.length==0){
							ajax_find_host_doing=false;
							$("#keyword").blur();
							_alert(0,'搜索','无搜索结果',$("#keyword"));
							_waitDone($(".waitTip2"));
							
							return false;
						}
					}
					*/
					if (tmp_list_u.length != 0){
						tmp_list_path_strarray_u=tmp_list_u.map(function (params) {
							return params.Path;
						});
						$(tmp_list_u).each(function(i,item){
							path_all.push(item);
						})
						flag_ajax_true_u = false;
						//开始过滤
						find_append_u();
					}else{
						find_user_loading = false;
						ajax_find_host_doing_u=false;
						$("#keyword").blur();
						_alert(0,'搜索','无搜索结果',$("#keyword"));
						_waitDone($(".waitTip2"));
					}
				}
			});
		}
		var filter_flag_append_u = false;
		function find_append_u(){
			$.each(path_all, function (i, item) {
				var Path_array = item.Path.split('/');
				var len = Path_array.length;
				for (var j = 1; j < len - 1; j++) {
					var id = Path_array[j].split(',')[1];
					$i_item = $('#nodeug-' + id).siblings('i.h-aicon');
					red_to_font($('#nodeug-' + id),2);
					if (($i_item.attr('class').indexOf('h-aicon-d')) === -1) {
						filter_flag_append_u = true;
						$i_item.trigger('click');
					}
				}
				if (item.Type == 1) {
					$('#nodeug-' + item.Id).siblings('span.h-name').addClass('h-name-red');
					red_to_font($('#nodeug-'+item.Id),2);
				} else {
					$('#nodeu-'+Path_array[len-2].split(',')[1]+'-'+item.Id).siblings('span.h-name').addClass('h-name-red');
					red_to_font($('#nodeu-'+Path_array[len-2].split(',')[1]+'-'+item.Id),2);
					//$('input[id=nodeu-' + item.Id + ']').siblings('span.h-name').addClass('h-name-red');
				}
			})
			scrollTop_check_server();
		}
		function _delFilter(obj) {
			if (find_user_loading){
				_alert(2,"搜索","正在搜索中，请先等待搜索完成");
				return false; 
			}
			var v = $(obj).parent().children('span').attr('data-value');
			$(obj).parent().remove();
			find_use_arry.splice($.inArray(v, find_use_arry), 1);
			/*
			var li_len = 0;
			var filter_v = $("#filter_select").val();
			$("#filterWW1").find('li').each(function(i,item){
				var addfilter_arry = $(item).children('span').attr('data-value').split('-');
				
				if (addfilter_arry[0] == "组名"){
					var addfilter_v = 1;
				}else if (addfilter_arry[0] == "账号"){
					var addfilter_v = 2;
				}
				if (addfilter_arry[0] != "所有"){
					$("#filter_select").empty().append('<option value="0">所有</option><option value="'+addfilter_v+'">'+addfilter_arry[0]+'</option>');
					$("#filter_select").val(filter_v).trigger('change');
					return false;
				}else{
					li_len += 1;
				}
			});
			if (li_len == $("#filterWW1").find('li').length){
				$("#filter_select").empty().append('<option value="0">所有</option><option value="1">组名</option><option value="2">账号</option>');
				$("#filter_select").val(filter_v).trigger('change');
			}
			*/
			selView(true);
		}
		
		function selView(type_value) {
			var $sel = $('#filterWW1');
			var len = $('li', $sel).length;

			if (len == 0) {
				$sel.hide();
				$("#clearFilter").hide();
			} else if (len == 1) {
				$("#filterWW1").show();
				$("#clearFilter").show();
				$('>span.ww', $sel).show();
				$sel.addClass('selector-multiple');
			} else {
				$("#filterWW1").show();
				$("#clearFilter").show();
				$('>span.ww', $sel).show();
				$sel.addClass('selector-multiple');
			}
			if (type_value){
				find_usergroup();
			}
		}

		var path_all;
		var ajax_find_host_doing_u =false;
		function find_usergroup() {
			_getWait($(".waitTip2"));
			find_user_loading = true;
			/*
			if (find_use_arry.length != 0 && $.inArray(first_find_index_u, find_use_arry) >= 0) {
				if (ajax_find_host_doing_u == false) {
					if (mtr == null) {
						_getWait($(".waitTip2"));
						//消红+展开标红
						$('#userTree').find('.font-red').removeClass('font-red');
						$('#userTree').find('span.h-name-red').removeClass('h-name-red');
						setTimeout(function () {
							red_to_no_red_and_open_to_red($('#userTree'), 0, 2);
						}, 1);
					} else {

					}
				} else {

				}
				return false;
			}
			*/
			//先清空之前的过滤信息
			click_h();
		}
		function scrollTop_check_server() {
			var i = 0;
			var index_i = 0;
			//li_red_to_no_red($('#userTree'),2);
			li_hide_while_no_red($('#userTree'),0);
			if($('#userTree').find('span.h-name-red').length==0){
				$("#keyword").blur();
				_alert(0,'搜索','无搜索结果',$("#keyword"));
				_waitDone($(".waitTip2"));
				flag_ajax_true_u = true;
				ajax_find_host_doing_u=false;
				find_user_loading = false;
				return false;
			}
			find_user_loading = false;
			$('#user_module').scrollTop($('#userTree').find('span.h-name-red').eq(0).offset().top-200);
			ajax_find_host_doing_u=false;
			flag_ajax_true_u = true;
			_waitDone($(".waitTip2"));
			old_path_all_u=new Array();
		}



		var search_typeall_r = '';
		var search_typeall_new = '';
		var find_server_loading = false;
		//加入搜索
		function _addFilter1(obj, type) {
			if(find_server_loading){
				_alert(2, "搜索", "正在搜索中，请先等待搜索完成");
				return false;
			}
			top1_s = 9007199254740991;
			var id = $(obj).parent().children('select').children('option:selected').val();
			var v1 = $(obj).parent().children('select').children('option:selected').text();
			var v2 = $(obj).parent().children('input[type=text]').val().trim();
			if (id == "all"){
				v1 = "";
			}else{
				v1 = v1 + '-';
			}
			if (v2 == '') {
				_alert(2, '搜索', '请输入关键字', $(obj).parent().children('input[type=text]'));
				return false;
			} else {
				switch (id) {
					case 'hgname':
						var Reg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
						break;
					case 'hostname':
						var Reg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
						break;
					case 'ip':
						var Reg = /^[0-9\.]*$/;
						break;
				}
				if (id != "all" && !Reg.test(v2)) {
					$(obj).parent().children('input[type=text]').blur();
					_alert(1, '搜索', '搜索条件格式不正确', $(obj).parent().children('input[type=text]'));
					return false;
				}
				if (search_typeall_r.indexOf(id + '-' + v2 + '\t') >= 0) {
					$(obj).parent().children('input[type=text]').blur();
					_alert(2, '搜索', '关键字重复', $(obj).parent().children('input[type=text]'));
					return false;
				}
				if (type) {
					var type_value=(search_typeall_new==id + '-' + v2 + '\t');
					search_typeall_r = search_typeall_r + id + '-' + v2 + '\t';
					search_typeall_new = '';
					$('#filterWW>ul').append('<li style="height: 18px;"><span style = "display:none;">' + id + '-' + v2 + '</span><span class="ww" style="width:8em">' + v1 + v2 + '</span><i class="del" style="margin-top: 2px;" onclick="_delFilter1(this);"></i></li>')
					$("#server_text").val("");
					$("#server_text_check").hide();
					/*
					switch (id) {
						case 'hgname':
							$('#server_select').children('option[value=hostname]').remove();
							$('#server_select').children('option[value=ip]').remove();
							break;
						case 'hostname':
						case 'ip':
							$('#server_select').children('option[value=hgname]').remove();
							break;
						default:
							break;
					}
					*/
					selView1(type_value);
				} else {
					search_typeall_new = id + '-' + v2 + '\t';
					find_hostgroup();
				}
			}
		}
		//删除搜索
		function _delFilter1(obj) {
			if(find_server_loading){
				_alert(2, "搜索", "正在搜索中，请先等待搜索完成");
				return false;
			}
			var id = $(obj).parent().find("span");
			var ids = $(id).eq(0).text();
			search_typeall_r = search_typeall_r.replace(ids + '\t', '');
			var server_text = $('#server_text').val().trim();
			if (server_text == '') {
				search_typeall_new = '';
			} else {
				search_typeall_new = $('#server_select').val() + '-' + server_text + '\t';
			}
			/*
			var index_i=ids.indexOf('-');
			var id_value_now=ids.substring(0,index_i);
			var hgname_num=0;
			var host_num=0;
			$.each(search_typeall_r.split('\t'),function (i,params) {
				if(params==''){
					return true;
				}			
				var index_i=params.indexOf('-');
				var id_value=params.substring(0,index_i);
				switch (id_value) {
					case 'hgname':
						hgname_num++;
						break;
					case 'hostname':
					case 'ip':
						host_num++;
						break;
					default:
						break;
				}
			});
			switch (id_value_now) {
				case 'hgname':
					if(hgname_num==0){
						$('#server_select').children('option[value=hgname]').after('<option value="ip">IP</option>');
						$('#server_select').children('option[value=hgname]').after('<option value="hostname">主机名</option>');
					}
					break;
				case 'hostname':
				case 'ip':
					if(host_num==0){
						$('#server_select').children('option[value=all]').after('<option value="hgname">组名</option>');
					}
					break;
				default:
					break;
			}
			*/
			$(obj).parent().remove();
			selView1(false);
		}
		function _clearFilter1(obj) {
			if(find_server_loading){
				_alert(2, "搜索", "正在搜索中，请先等待搜索完成");
				return false;
			}
			/*
			if($('#server_select').children('option[value=hgname]').length==0){
				$('#server_select').children('option[value=all]').after('<option value="hgname">组名</option>');
			}
			if($('#server_select').children('option[value=hostname]').length==0){
				$('#server_select').children('option[value=hgname]').after('<option value="ip">IP</option>');
				$('#server_select').children('option[value=hgname]').after('<option value="hostname">主机名</option>');
			}
			*/
			$('#clearFilter1').next().children('ul').empty();
			$('#server_text').val('');
			$('#clearFilter1').hide();
			search_typeall_new = '';
			search_typeall_r = '';
			
			selView1(false);
		}
		
		function _clear_keyword1(){
			$("#server_text").val("");
			$("#server_text_check").hide();
			if (search_typeall_new != ""){
				if(find_server_loading){
					_alert(2, "搜索", "正在搜索中，请先等待搜索完成");
					return false;
				}
				search_typeall_new = "";
				selView1(false);
			}
		}
		
		//显示搜索条件
		function selView1(type_value) {
			var $sel = $('#filterWW');
			var len = $('li', $sel).length;

			if (len == 0) {
				$sel.hide();
				$('#clearFilter1').hide();
			} else if (len == 1) {
				$("#filterWW").show();
				$('#clearFilter1').show();
				$('>span.ww', $sel).show();
				$sel.addClass('selector-multiple');
			} else {
				$("#filterWW").show();
				$('#clearFilter1').show();
				$('>span.ww', $sel).show();
				$sel.addClass('selector-multiple');
			}
			if (!type_value){
				find_hostgroup();
			}
		}
		var server_find_json = {
			"loginusercode": null,
			"hgid": 0,
			"type": null,
			"id":null,
			"istree": true,
			"hgname": "",
			"hostname": "",
			"hostip": "",
			"searchstring":'',
			"limitrow": null,
			"offsetrow": null
		}
		var ajax_find_host_doing_s=false;
		var data_array_Path = null;
		function find_hostgroup() {
			var search_typeall_all = search_typeall_r + search_typeall_new;
			find_host_arry_s = search_typeall_all.split('\t');
			for (var i = 0; i < find_host_arry_s.length; i++) {
				if (find_host_arry_s[i] == '') {
					find_host_arry_s.splice(i, 1);
					i--;
				}
			}
			_getWait($(".waitTip1"));
			/*
			$('#hosttree_div').scrollTop(0);
			if (find_host_arry_s.length != 0 && $.inArray(first_find_index_s, find_host_arry_s) >= 0) {
				if (ajax_find_host_doing_s == false) {
					if (mtr_s == null) {
						_getWait($(".waitTip1"));
						//消红+展开标红
						$('#userTree1').find('.font-red').removeClass('font-red');
						$('#userTree1').find('span.h-name-red').removeClass('h-name-red');
						setTimeout(function () {
							red_to_no_red_and_open_to_red($('#userTree1'), 0,1);
						}, 1);
					} else {
					}
				} else {
				}
				return false;
			}
			*/
			//先清空之前的过滤信息 
			click_h1_s();
		}

		function click_h1_s() {
			var i = 0;
			index = 0;
			flag_ajax_true_s = true;
			$('#userTree1').find('i.h-aicon.h-aicon-d').removeClass('h-aicon-d');
			$('#userTree1').find('ul').hide();
			$('#userTree1').find('li').hide();
			$('#userTree1').find('.font-red').removeClass('font-red');
			$("#userTree1").find('span.h-name-red').removeClass('h-name-red');
			host_path_all_s = [];
			old_path_all_s = [];
			push_filter_wait_s = [];
			click_h0_s();
		}
		var first_find_index_s=null;
		var mtr_s=null;
		var tmp_list_s = null;
		function click_h0_s() {
			server_find_json.loginusercode=usercode;
			server_find_json.type=1;
			var id_value=$('#ips').data('value');
			if(id_value==undefined || id_value==''){
				id_value=0;
			}
			server_find_json.id=parseInt(id);
			if (mtr_s != null) {
				_waitDone($(".waitTip1"));
				mtr_s.abort();
			}
			flag_ajax_true_s = true;
			//条件没有的情况 直接返回
			var search_typeall_all = search_typeall_r + search_typeall_new;
			find_host_arry_s = search_typeall_all.split('\t');
			for (var i = 0; i < find_host_arry_s.length; i++) {
				if (find_host_arry_s[i] == '') {
					find_host_arry_s.splice(i, 1);
					i--;
				}
			}
			//var search_typeall_all_pass = '\t' + search_typeall_all;
			if (search_typeall_all == "") {
				_waitDone($(".waitTip1"));
				$('#hosttree_div').scrollTop(0);
				$('#userTree1').children('li').show();
				tmp_list_s=null;
				first_find_index_s=null;
				$('#userTree1').find('li').show();
				$('#userTree1').find('ul').hide();
				$("#userTree1").find('i.h-aicon.h-aicon-d').removeClass('h-aicon-d');
				$('#userTree1').find('.font-red').removeClass('font-red');
				$("#userTree1").find('span.h-name-red').removeClass('h-name-red');
				find_server_loading=false;
				return false;
			}/*else if (search_typeall_all_pass.indexOf('\thgname') >= 0 && (search_typeall_all_pass.indexOf('\thostname') >= 0 || search_typeall_all_pass.indexOf('ip') >= 0)) {
				$("#server_text").blur();
				_alert(0, '搜索', '无搜索结果', $("#server_text"));
				_waitDone($(".waitTip1"));
				return false;
			}*/
			//first_find_index_s = find_host_arry_s[0];
			//var a = new Array();
			//a[0] = find_host_arry_s[0];
			var hgname_str = '';
			var hostname_str = '';
			var hostip_str = '';
			var searchstring_str = "";
			$.each(find_host_arry_s,function(i,item){
				var item_id = item.indexOf('-');
				switch (item.substr(0, item_id)) {
					case 'hgname':
						hgname_str += (item.substr(item_id + 1, item.length) + '\n');
						break;
					case 'hostname':
						hostname_str += (item.substr(item_id + 1, item.length) + '\n');
						break;
					case 'ip':
						hostip_str += (item.substr(item_id + 1, item.length) + '\n');
					case 'all':
						searchstring_str += (item.substr(item_id + 1, item.length) + '\n');
						break;
				}
			});
			/*
			var item = a[0];
			var item_id = item.indexOf('-');
				switch (item.substr(0, item_id)) {
					case 'hgname':
						hgname_str += (item.substr(item_id + 1, item.length) + '\n');
						break;
					case 'hostname':
						hostname_str += (item.substr(item_id + 1, item.length) + '\n');
						break;
					case 'ip':
						hostip_str += (item.substr(item_id + 1, item.length) + '\n');
						break;
					case 'all':
						searchstring_str += (item.substr(item_id + 1, item.length) + '\n');
						break;
				}
			*/
			hgname_str = hgname_str.substr(0, hgname_str.length - 1);
			hostname_str = hostname_str.substr(0, hostname_str.length - 1);
			hostip_str = hostip_str.substr(0, hostip_str.length - 1);
			searchstring_str = searchstring_str.substr(0,searchstring_str.length-1);
			server_find_json.hgname = hgname_str;
			server_find_json.hostname = hostname_str;
			server_find_json.hostip = hostip_str;
			server_find_json.searchstring = searchstring_str;

			mtr_s = $.ajax({
				url: '/bhost/find_hostgroup',
				type: "POST",
				async: true,
				data: { a0: se, a1: JSON.stringify(server_find_json) },
				success: function (result) {
					ajax_find_host_doing_s=true;
					mtr_s = null;
					tmp_list_s = null;
					var result = JSON.parse(result);
					if (result.Result) {
						tmp_list_s = result.info;
						flag_ajax_true_s = false;
						/*
						var new_list_arr = new Array();
						find_host_arry_s = (search_typeall_r + search_typeall_new).split('\t');
						
						new_list_arr = tmp_list_s.filter(function (item) {
							var pass = true;
							for (var jm = 0; jm < find_host_arry_s.length; jm++) {
								if (find_host_arry_s[jm] == '' || find_host_arry_s[jm] == undefined || find_host_arry_s[jm] == null) {
									continue;
								}
								var pass_one = false;
								var jm_index_=find_host_arry_s[jm].indexOf('-');
								var search_arr = find_host_arry_s[jm].substr(jm_index_ + 1, find_host_arry_s[jm].length).split(' ');
								$.each(search_arr, function (i1, item1) {
									if (item1 != '') {
										if(find_host_arry_s[jm].substr(0,jm_index_)=='hostname'){
											var Name=item.Name.split('\t')[0];
										}else if(find_host_arry_s[jm].substr(0,jm_index_)=='ip'){
											var Name=item.Name.split('\t')[1];
										}else{
											var Name=item.Name;
										}
										if (coverString(item1, Name)) {
											pass_one = true;
											return false;
										}
									}
								});
								if (pass_one == false) {
									pass = false;
									break;
								}
							}
							return pass;
						});
						
						if (new_list_arr.length == 0) {
							ajax_find_host_doing_s=false;
							flag_ajax_true_s = true;
							$("#server_text").blur();
							_alert(0, '搜索', '无搜索结果', $("#server_text"));
							_waitDone($(".waitTip1"));
							return false;
						}
						*/
						if (tmp_list_s.length != 0) {
							$(tmp_list_s).each(function (i, item) {
								host_path_all_s.push(item);
							})
							//开始过滤
							find_append_s();
						} else {
							flag_ajax_true_s = true;
							ajax_find_host_doing_s=false;
							$("#server_text").blur();
							_alert(0, '搜索', '无搜索结果', $("#server_text"));
							_waitDone($(".waitTip1"));//延迟5秒退出
							find_server_loading = false;
							return false;
						}
						
					} else {
						flag_ajax_true_s = true;
						ajax_find_host_doing_s=false;
						_alert(2, '搜索', "执行失败：" + result.ErrMsg);
						_waitDone($(".waitTip1"));
						find_server_loading = false;
						return false;
					}
				}
			});
		}


		function find_append_s() {
			var i = 0;
			index_f_s = 0;
			var t_do1;
			function _do1() {
				clearTimeout(t_do1);
				for (i = index_f_s; i < index_f_s + 50; i++) {
					if (flag_ajax_true_s == true) {
						t_do1 = setTimeout(function () { _do1(); }, 1);
						return false;
					}
					if (i >= host_path_all_s.length) {    //
						if (flag_ajax_true_s == true) {
							t_do1 = setTimeout(function () { _do1(); }, 1);
							return false;
						}
						if (host_path_all_s.length == 0) {
							//过滤结束 开始标红
							scrollTop_check_server1_s();
							return false;
						} else {
							index_f_s = 0;
							t_do1 = setTimeout(function () { _do1(); }, 1);
							return false;
						}
					}
					if (host_path_all_s[i].Type != 1 && host_path_all_s[i].Type != 2) {
						host_path_all_s.splice(i, 1);
						continue;
					}
					var Path_array = host_path_all_s[i].Path.split('/');
					var len = Path_array.length;
					if (len == 2) {//主机层
						//数据未完全展开 留在 host_path_all，下次继续执行
						if ($('#HGId-' + host_path_all_s[i].Id).length == 0) continue;//
						//show
						$('#HGId-' + host_path_all_s[i].Id).parent('li').show();
						$('#HGId-' + host_path_all_s[i].Id).siblings('span.h-name').addClass('h-name-red');
						red_to_font($('#HGId-' + host_path_all_s[i].Id),1);
						$('#HGId-' + host_path_all_s[i].Id).siblings('ul').find('li').show();
					} else {
						s = 0;
						for (var j = 1; j < len - 1; j++) {
							var id = Path_array[j].split(',')[1];
							if ($('#HGId-' + id).length == 0) {
								s = 1;
								break;//
							}
							if (flag_loading_s == true) {
								s = 1;
								break;
							}
							//show
							$('#HGId-' + id).parent('li').show();
							$i_item = $('#HGId-' + id).prev('i');
	
							if ($i_item.attr('class') == "h-blank") { //
								host_path_all_s.splice(i, 1);
								s = 1;
								break;//
							}
							if (push_hgid_s.indexOf(Path_array[j - 1].split(',')[1] + ':true') != -1) {
								continue;
							}
							if (push_hgid_s.indexOf(Path_array[j - 1].split(',')[1] + ':false') != -1) {
								continue;
							}
							if ($('#HGId-' + id).length > 0) {
								red_to_font($('#HGId-' + id),1);
								if (($i_item.attr('class').indexOf('h-aicon-d')) == -1) {
									filter_flag_append_s = true;
									$i_item.trigger('click');
								}
							}
						}
						if (s) continue;
						if (host_path_all_s[i].Type == 1) {
							if ($('#HGId-' + host_path_all_s[i].Id).length == 0) continue;//
							//show
							$('#HGId-' + host_path_all_s[i].Id).parent('li').show();
							$('#HGId-' + host_path_all_s[i].Id).siblings('span.h-name').addClass('h-name-red');
							red_to_font($('#HGId-' + host_path_all_s[i].Id),1);
							$('#HGId-' + host_path_all_s[i].Id).siblings('ul').find('li').show();
						} else {
							if ($('#HostId-' + Path_array[j - 1].split(',')[1] + '-' + host_path_all_s[i].Id).length == 0) continue;//
							//show
							$('#HostId-' + Path_array[j - 1].split(',')[1] + '-' + host_path_all_s[i].Id).parent('li').show();
							$('#HostId-' + Path_array[j - 1].split(',')[1] + '-' + host_path_all_s[i].Id).siblings('span.h-name').addClass('h-name-red');
							red_to_font($('#HostId-' + Path_array[j - 1].split(',')[1] + '-' + host_path_all_s[i].Id),1);
							$('#HostId-' + Path_array[j - 1].split(',')[1] + '-' + host_path_all_s[i].Id).siblings('ul').find('li').show();
						}
					}
					//数据展开后 从host_path_all删除掉，并且放在old_path_all，为标红和定位准备
					push_filter_wait_s.push(host_path_all_s[i]);
					old_path_all_s.push(host_path_all_s[i]);
					host_path_all_s.splice(i, 1);
	
				}
				index_f_s = i;
				get_msg();
				t_do1 = setTimeout(function () { _do1(); }, 1);
			}
			_do1();
		}

		var top1_s = 9007199254740991;
		function scrollTop_check_server1_s() {
			var i = 0;
			var index_i = 0;
			
			//li_red_to_no_red($('#userTree1'),1);
			li_hide_while_no_red($('#userTree1'), 0);
			if ($('#userTree1').find('span.h-name-red').length == 0) {
				$("#server_text").blur();
				_waitDone($(".waitTip1"));
				_alert(0, '搜索', '无搜索结果', $("#server_text"));
				flag_ajax_true_s = true;
				ajax_find_host_doing_s = false;
				find_server_loading = false;
				return false;
			} else {
				ajax_find_host_doing_s = false;
				flag_ajax_true_s = true;
				old_path_all_s = new Array();
				find_server_loading = false;
				$('#hosttree_div').scrollTop($('#userTree1').find('span.h-name-red').eq(0).offset().top - 200);
				_waitDone($(".waitTip1"));
				return false;
			}
		}


		var find_host_arry = [];
		var find_flag = 0;
		var server_text1_v = "";
		var find_host_loading = false;
		function _addFilter2(obj, type) {
			if (find_host_loading){
				_alert(2,"搜索","正在搜索中，请先等待搜索完成");
				return false;
			}
			var v2 = $(obj).parent().children('input[type=text]').val().trim();
			var filter_flag = 0;
			var filtername = $("#filtername").val();
			
			if (v2 == ""){
				_alert(2, "搜索", "请输入关键字", $("#server_text1"));
				return false;
			}
			v2 = v2.ResetBlank();
			var addfilter = "";
			var addfilter_v = "";
			var addfilter_name = "";
			if (filtername == '0'){
				addfilter_v = v2;
				addfilter = "所有-" + v2;
				addfilter_name = "所有";
			}else if (filtername == "1"){
				addfilter = "组名-" + v2;
				addfilter_v = addfilter;
				addfilter_name = "组名";
			}else if (filtername == "2"){
				addfilter = "主机名-" + v2;
				addfilter_v = addfilter;
				addfilter_name = "主机名";
			}else if (filtername == "3"){
				addfilter = "IP-" + v2;
				addfilter_v = addfilter;
				addfilter_name = "IP";
			}else if (filtername == "4"){
				addfilter = "服务-" + v2;
				addfilter_v = addfilter;
				addfilter_name = "服务";
			}else if (filtername == "5"){
				addfilter = "账号-" + v2;
				addfilter_v = addfilter;
				addfilter_name = "账号";
			}
			var type_value = true;
			if (type) {
				$("#filterWW2").children('ul').children('li').each(function (i, item) {
					if ($(this).children('span').text() == addfilter_v) {
						filter_flag = 1;
						return false;
					}
				});
				
				/*
				if (addfilter_name != "所有"){
					$("#filtername").empty().append('<option value="0">所有</option><option value="'+filtername+'">'+addfilter_name+'</option>');
					$("#filtername").val(filtername).trigger('change');
				}
				*/
				if (filter_flag == 0) {
					$("#server_text1").val("");
					if (server_text1_v == addfilter){
						type_value = false;
					}
					if (find_flag == 1) {
						//find_host_arry=[];
						find_host_arry.splice(-1, 1);
						find_flag = 0;
					}
					find_host_arry.push(addfilter);
					$("#text_check2").hide();
					server_text1_v = "";
					$('#filterWW2>ul').append('<li style="height: 18px;"><span class="ww" data-value="'+addfilter+'" style="width:9em">' + addfilter_v + '</span><i class="del" style="margin-top: -17px;" onclick="_delFilter2(this)"></i></li>')
					selView2(type_value);
				}
			} else {
				if (server_text1_v == addfilter){
					type_value = false;
				}
				if (find_flag != 0) {
					find_host_arry.splice(-1, 1);
				}
				find_flag = 1;
				server_text1_v = addfilter;
				//_clearFilter2();
				//find_host_arry=[];
				find_host_arry.push(addfilter);
				selView2(type_value);
			}
		}
		function _clearFilter2(obj) {
			if (find_host_loading){
				_alert(2,"搜索","正在搜索中，请先等待搜索完成");
				return false;
			}
			$("#filterWW2").children('ul').empty();
			$("#filterWW2").hide();
			$("#clearFilter2").hide();
			find_host_arry = [];
			find_flag = 0;
			$("#text_check2").hide();
			//$("#filtername").empty().append('<option value="0">所有</option><option value="1">组名</option><option value="2">主机名</option><option value="3">IP</option><option value="4">服务</option><option value="5">账号</option>');
			selView2(true);
		}

		function _delFilter2(obj) {
			if (find_host_loading){
				_alert(2,"搜索","正在搜索中，请先等待搜索完成");
				return false;
			}
			var v = $(obj).parent().children('span').attr('data-value');
			$(obj).parent().remove();
			find_host_arry.splice($.inArray(v, find_host_arry), 1);
			/*
			var li_len = 0;
			var filter_v = $("#filtername").val();
			$("#filterWW2").find('li').each(function(i,item){
				var addfilter_arry = $(item).children('span').attr('data-value').split('-');
				
				if (addfilter_arry[0] == "组名"){
					var addfilter_v = 1;
				}else if (addfilter_arry[0] == "主机名"){
					var addfilter_v = 2;
				}else if (addfilter_arry[0] == "IP"){
					var addfilter_v = 3;
				}else if (addfilter_arry[0] == "服务"){
					var addfilter_v = 4;
				}else if (addfilter_arry[0] == "账号"){
					var addfilter_v = 5;
				}
				if (addfilter_arry[0] != "所有"){
					$("#filtername").empty().append('<option value="0">所有</option><option value="'+addfilter_v+'">'+addfilter_arry[0]+'</option>');
					$("#filtername").val(filter_v).trigger('change');
					return false;
				}else{
					li_len += 1;
				}
			});
			if (li_len == $("#filterWW2").find('li').length){
				$("#filtername").empty().append('<option value="0">所有</option><option value="1">组名</option><option value="2">主机名</option><option value="3">IP</option><option value="4">服务</option><option value="5">账号</option>');
				$("#filtername").val(filter_v).trigger('change');
			}
			*/
			selView2(true);
		}
		
		function _clear_keyword2(){
			$("#server_text1").val('');
			if (server_text1_v != ""){
				if (find_host_loading){
					_alert(2,"搜索","正在搜索中，请先等待搜索完成");
					return false;
				}
				server_text1_v = "";
				find_flag = 0;
				find_host_arry.splice(-1,1);
				selView2(true);
			}
		}
		
		function selView2(type_value) {
			var $sel = $('#filterWW2');
			var len = $('li', $sel).length;

			if (len == 0) {
				$sel.hide();
				$("#clearFilter2").hide();
			} else if (len == 1) {
				$("#filterWW2").show();
				$("#clearFilter2").show();
				$('>span.ww', $sel).show();
				$sel.addClass('selector-multiple');
			} else {
				$("#filterWW2").show();
				$("#clearFilter2").show();
				$('>span.ww', $sel).show();
				$sel.addClass('selector-multiple');
			}
			if (type_value){
				find_host_group();
			}
		}

		var host_path_all = [];
		var flag_loading = false;
		var index_f = 0;
		var tmp_list = null;
		var tmp_list_path_strarray = null;
		var ajax_find_host_doing = false;
		var first_find_index = null;
		function find_host_group() {
			find_host_loading = true;
			_getWait($(".waitTip"));
			/*
			if(find_host_arry.length!=0 && $.inArray(first_find_index,find_host_arry)>=0){
				if(ajax_find_host_doing==false){
					if(mtr==null){
						_getWait($(".waitTip"));
						//消红+展开标红
						$('#hostTree').find('.font-red').removeClass('font-red');
						$('#hostTree').find('span.h-name-red').removeClass('h-name-red');
						setTimeout(function () {
							red_to_no_red_and_open_to_red($('#hostTree'),0,0);
						},1);
					}else{
						
					}
				}else{
					
				}
				return false;
			}
			*/
			//先清空之前的过滤信息
			click_h1();
		}
		function coverString(subStr, str) {
			subStr = subStr.replace(/\?/g, "\\?").replace(/\|/g, "\\|").replace(/\\/g, "\\\\").replace(/\$/g, "\\$").replace(/\(/g, "\\(").replace(/\)/g, "\\)").replace(/\*/g, "\\*").replace(/\./g, "\\.").replace(/\[/g, "\\[").replace(/\^/g, "\\^").replace(/\{/g, "\\{");
			var reg = eval("/" + subStr + "/ig");
			return reg.test(str);
		}
		function red_to_no_red_and_open_to_red(obj,num,type){
			var array1; 
			var array2;
			if (type == 2){
				array1 = tmp_list_u;
				array2 = find_use_arry;
			}else if (type == 1){
				find_host_arry_s = (search_typeall_r + search_typeall_new).split('\t');
				array1 = tmp_list_s;
				array2 = (search_typeall_r + search_typeall_new).split('\t');
			}else if (type == 0){
				array1 = tmp_list;
				array2 = find_host_arry;
			}
			if(array1==null){
				array1=new Array();
			}
			for(var i=0;i<array1.length;i++){
				var item=array1[i];
				var pass=true;
				for(var jm=0;jm<array2.length;jm++){
					var jm_index_=array2[jm].indexOf('-');
					if (type == 1){
						if (array2[jm] == '' || array2[jm] == undefined || array2[jm] == null) {
							continue;
						}
						var search_arr = array2[jm].substr(jm_index_ + 1, array2[jm].length).split(' ');
					}else{
						var search_arr = array2[jm].substr(jm_index_ + 1, array2[jm].length).split(' ');
					}
					var pass_one=false;
					$.each(search_arr,function(i1,item1){
						if(item1!=''){
							if (type == 1){
								if(array2[jm].substr(0,jm_index_)=='hostname'){
									var Name=item.Name.split('\t')[0];
									if(item.Type!=2){
										return false;
									}
								}else if(array2[jm].substr(0,jm_index_)=='ip'){
									var Name=item.Name.split('\t')[1];
									if(item.Type!=2){
										return false;
									}
								}else if(array2[jm].substr(0,jm_index_)=='hgname'){
									var Name=item.Name;
									if(item.Type!=1){
										return false;
									}
								}else{
									var Name=item.Name;
								}
							}
							if (type == 2){
								var Name=item.Name;
								
								if (array2[jm].substr(0,jm_index_) == "组名"){
									if (item.Type != 1){
										return false;
									}
								}else if (array2[jm].substr(0,jm_index_) == "账号"){
									if (item.Type != 2){
										return false;
									}
								}
							}
							if (type == 0){
								var Name=item.Name;
								
								if (array2[jm].substr(0,jm_index_) == "组名"){
									if (item.Type != 1){
										return false;
									}
								}else if (array2[jm].substr(0,jm_index_) == "主机名"){
									Name=item.Name.split('\t')[0];
									if (item.Type != 2){
										return false;
									}
								}else if (array2[jm].substr(0,jm_index_) == "IP"){
									Name=item.Name.split('\t')[1];
									if (item.Type != 2){
										return false;
									}
								}else if (array2[jm].substr(0,jm_index_) == "服务"){
									if (item.Type != 3){
										return false;
									}
								}else if (array2[jm].substr(0,jm_index_) == "账号"){
									if (item.Type != 4){
										return false;
									}
								}
							}
							if(coverString(item1,Name)){
								pass_one=true;
								return false;
							}
						}
					});
					if(pass_one==false){
						pass=false;
						break;
					}
				}
				if(pass==true){
					if (type == 2){
						open_and_make_red_u(item);
					}else if (type == 1){
						open_and_make_red_s(item);				
					}else if (type == 0){
						open_and_make_red(item);
					}
				}else{
				}
			}
			li_red_to_no_red(obj,type);
			//非红隐藏
			li_hide_while_no_red(obj,0);
			//定位
			top_to_move(obj,type);
		}
		function top_to_move(obj,type){
			var top_arr=$(obj).find('span.h-name-red');
			if(top_arr.length!=0){
				//$('#hosttree_div1').scrollTop(top_arr.eq(0).offset().top-200);
				$(obj).parent().scrollTop(top_arr.eq(0).offset().top-200);
				if (type == 0){
					_waitDone($(".waitTip"));
				}else{
					_waitDone($(".waitTip"+type));
				}
			}else{
				if (type == 0){
					var $input = $("#keyword");
				}else if (type == 1){
					var $input = $("#server_text");
				}else if (type == 2){
					var $input = $("#server_text1");
				}
				$input.blur();
				_alert(0,'搜索','无搜索结果',$input);
				if (type == 0){
					_waitDone($(".waitTip"));
				}else{
					_waitDone($(".waitTip"+type));
				}
			}
		}

		function open_and_make_red_s(item) {
			var Path_array = item.Path.split('/');
			var len = Path_array.length;
			if (len == 2) {//主机层
				//show
				$('#HGId-' + item.Id).parent('li').show();
				$('#HGId-' + item.Id).siblings('span.h-name').addClass('h-name-red');
			} else {
				if (item.Type == 3 || item.Type == 4) { //服务/账号

				} else {
					for (var j = 1; j < len - 1; j++) {
						var id = Path_array[j].split(',')[1];
						//show
						$('#HGId-' + id).parent('li').show();
						$i_item = $('#HGId-' + id).prev('i');
						if (($i_item.attr('class').indexOf('h-aicon-d')) == -1) {
							filter_flag_append = true;
							$i_item.trigger('click');
						}
					}
					if (item.Type == 1) {
						//show
						$('#HGId-' + item.Id).parent('li').show();
						$('#HGId-' + item.Id).siblings('span.h-name').addClass('h-name-red');
					} else {
						//show

						$('#HostId-' + Path_array[j - 1].split(',')[1] + '-' + item.Id).parent('li').show();

						$('#HostId-' + Path_array[j - 1].split(',')[1] + '-' + item.Id).siblings('span.h-name').addClass('h-name-red');
					}
				}
			}
		}

		function open_and_make_red(item) {
			var Path_array = item.Path.split('/');
			var len = Path_array.length;
			if (len == 2) {//主机层
				//show
				$('#nodehg-' + item.Id).parent('li').show();
				$('#nodehg-' + item.Id).siblings('span.h-name').addClass('h-name-red');
			} else {
				if (item.Type == 3 || item.Type == 4) { //服务/账号
					var s = 0;
					for (var j = 1; j < len; j++) {
						var id = Path_array[j].split(',')[1];
						if (j == len - 1) { //主机层
							//show
							$('#nodeh-' + Path_array[j - 1].split(',')[1] + '-' + id).parent('li').show();
							$i_item = $('#nodeh-' + Path_array[j - 1].split(',')[1] + '-' + id).prev('i');
							if (($i_item.attr('class').indexOf('h-aicon-d')) === -1) {
								$i_item.trigger('click');
							}
						}
						else { //主机组层
							//show
							$('#nodehg-' + id).parent('li').show();
							$i_item = $('#nodehg-' + id).prev('i');
							if (($i_item.attr('class').indexOf('h-aicon-d')) === -1) {
								filter_flag_append = true;
								$i_item.trigger('click');
							}
						}
					}
					if (s) {
						return false;
					}
					if (item.Type == 4) {
						$i_item.siblings('ul').find('input').each(function (i1, item1) {
							var checkbox_id = $(item1).attr('id');
							if (checkbox_id == undefined) {
								return true;
							}
							if (checkbox_id.indexOf('-') != -1) {
								var all_id = checkbox_id.split('-');
								if (all_id.length == 5) {
									var hg_id = all_id[1];
									var h_id = all_id[2];
									var a_id = all_id[3];
									var s_id = all_id[4];
									if (a_id == item.Id) {
										//show
										$("#nodes-" + hg_id + '-' + h_id + '-' + s_id).parent('li').show();
										var $i_item = $("#nodes-" + hg_id + '-' + h_id + '-' + s_id).prev('i');
										if (($i_item.attr('class').indexOf('h-aicon-d')) === -1) {
											filter_flag_append = true;
											$i_item.trigger('click');
										}
										//show
										$(item1).parent('li').show();
										$(item1).siblings('span.h-name').addClass('h-name-red');
									}
								}
							}
						})
					}
					else {
						var all_id = $i_item.siblings('input').attr('id').split('-');
						//show
						$("#nodes-" + all_id[1] + '-' + all_id[2] + '-' + item.Id).parent('li').show();
						$("#nodes-" + all_id[1] + '-' + all_id[2] + '-' + item.Id).siblings('span.h-name').addClass('h-name-red');
					}

				} else {
					for (var j = 1; j < len - 1; j++) {
						var id = Path_array[j].split(',')[1];
						//show
						$('#nodehg-' + id).parent('li').show();
						$i_item = $('#nodehg-' + id).prev('i');
						if (($i_item.attr('class').indexOf('h-aicon-d')) == -1) {
							filter_flag_append = true;
							$i_item.trigger('click');
						}
					}
					if (item.Type == 1) {
						//show
						$('#nodehg-' + item.Id).parent('li').show();
						$('#nodehg-' + item.Id).siblings('span.h-name').addClass('h-name-red');
					} else {
						//show
						$('#nodeh-' + Path_array[j - 1].split(',')[1] + '-' + item.Id).parent('li').show();
						$('#nodeh-' + Path_array[j - 1].split(',')[1] + '-' + item.Id).siblings('span.h-name').addClass('h-name-red');
					}
				}
			}
		}
		function open_and_make_red_u(item) {
			var Path_array = item.Path.split('/');
			var len = Path_array.length;
			for (var j = 1; j < len - 1; j++) {
				var id = Path_array[j].split(',')[1];
				$i_item = $('#nodeug-' + id).siblings('i.h-aicon');
				if (($i_item.attr('class').indexOf('h-aicon-d')) === -1) {
					filter_flag_append_u = true;
					$i_item.trigger('click');
				}
			}
			if (item.Type == 1) {
				$('#nodeug-' + item.Id).siblings('span.h-name').addClass('h-name-red');
			} else {
				$('input[id=nodeu-' + item.Id + ']').siblings('span.h-name').addClass('h-name-red');
			}
		}
		function click_h1() {
			//清空数据
			var i = 0;
			index = 0;
			flag_ajax_true = true;
			$("#hostTree").find('i.h-aicon.h-aicon-d').trigger('click');
			$('#hostTree').find('.font-red').removeClass('font-red');
			$("#hostTree").find('span.h-name-red').removeClass('h-name-red');
			host_path_all = [];
			old_path_all = [];
			push_filter_wait = [];
			click_h0();
		}
		
		
		function red_to_font(obj,type){
			var find_array; 
			if (type == 2){
				find_array = find_use_arry;
			}else if (type == 1){
				find_array = (search_typeall_r + search_typeall_new).split('\t');
			}else if (type == 0){
				find_array = find_host_arry;
			}
			$(obj).each(function(i,item){
				var span_obj=$(item).siblings('span.h-name');
				var item_name=span_obj.siblings('input').attr('data-name');
				var Type = span_obj.siblings('input').attr('id');
				var $span_son_font=$('.h-name-son',span_obj).find('font');

				if (type == 0){
					if(Type.indexOf('nodeh')<0){
						var span_son_name=item_name.toLowerCase();
					}else{
						var host_span_arr=item_name.split('\t');
						var span_son_name=(host_span_arr[0]+'('+host_span_arr[1]+')').toLowerCase();
					}
				}else if (type == 1){
					if(Type.indexOf('HostId')<0){
						var span_son_name=item_name.toLowerCase();
					}else{
						var host_span_arr=item_name.split('\t');
						var span_son_name=(host_span_arr[0]+'('+host_span_arr[1]+')').toLowerCase();
					}
				}else if (type == 2){
					var span_son_name=item_name.toLowerCase();
				}
				for(var jm=0;jm<find_array.length;jm++){
					var jm_index_ = find_array[jm].indexOf('-');
					if (type == 1){
						if (find_array[jm] == '' || find_array[jm] == undefined || find_array[jm] == null) {
							continue;
						}
						var search_arr = find_array[jm].substr(jm_index_ + 1, find_array[jm].length).split(' ');
					}else if (type == 2){
						var search_arr = find_array[jm].substr(jm_index_ + 1, find_array[jm].length).split(' ');
					}else{
						var search_arr = find_array[jm].substr(jm_index_ + 1, find_array[jm].length).split(' ');
					}
					$.each(search_arr,function(i1,item1){
						if(item1==''){
							return true;
						}
						if (type == 1){
							if (find_array[jm].substr(0, jm_index_) == 'hostname') {
								Name = item_name.split('\t')[1];
								if(Type.indexOf('HostId')<0){
									return true;
								}
							} else if (find_array[jm].substr(0, jm_index_) == 'ip') {
								Name = item_name.split('\t')[0];
								if(Type.indexOf('HostId')<0){
									return true;
								}
							} else if (find_array[jm].substr(0, jm_index_) == 'hgname'){
								Name = item_name;
								if(Type.indexOf('HGId')<0){
									return true;
								}
							}else{
								Name = item_name;
							}
						}
						if (type == 0){
							if (find_array[jm].substr(0, jm_index_) == '组名'){
								Name = item_name;
								if(Type.indexOf('nodehg')<0){
									return true;
								}
							}else if (find_array[jm].substr(0, jm_index_) == '主机名') {
								Name = item_name.split('\t')[1];
								if(Type.indexOf('nodeh')<0 || Type.indexOf('nodehg')>=0){
									return true;
								}
								/*
								if(Type.indexOf('nodeh')<0){
									return true;
								}
								*/
							} else if (find_array[jm].substr(0, jm_index_) == 'IP'){
								Name = item_name.split('\t')[0];
								if(Type.indexOf('nodeh')<0 || Type.indexOf('nodehg')>=0){
									return true;
								}
								/*
								if(Type.indexOf('nodeh')<0){
									return true;
								}
								*/
							}else if (find_array[jm].substr(0, jm_index_) == '服务'){
								Name = item_name;
								if(Type.indexOf('nodes')<0){
									return true;
								}
							}else if (find_array[jm].substr(0, jm_index_) == '账号'){
								Name = item_name;
								if(Type.indexOf('nodea')<0){
									return true;
								}
							}else{
								Name = item_name;
							}
						}
						
						if (type == 2){
							Name = item_name;
							if (find_array[jm].substr(0, jm_index_) == '组名') {
								if(Type.indexOf('nodeug')<0){
									return true;
								}
							} else if (find_array[jm].substr(0, jm_index_) == '账号') {
								if(Type.indexOf('nodeug')>=0){
									return true;
								}
								/*
								if(Type.indexOf('nodeu')<0){
									return true;
								}
								*/
							}
						}
						if(coverString(item1,Name)){
							if (type == 0 || type == 1){
								item1=item1.toLowerCase();
								if(find_array[jm].substr(0, jm_index_).toLowerCase() == '主机名'){
									var index_start=span_son_name.indexOf('(');
									var index_true=span_son_name.indexOf(item1,index_start);
									if(index_true>=0){
										for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
											$span_son_font.eq(i_red_span).addClass('font-red');
										}
									}
								}else{
									var index_true=span_son_name.indexOf(item1);
									if(index_true>=0){
										for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
											$span_son_font.eq(i_red_span).addClass('font-red');
										}
									}
								}
							}else if (type == 2){
								item1=item1.toLowerCase();
								var index_true=span_son_name.indexOf(item1);
								if(index_true>=0){
									for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
										$span_son_font.eq(i_red_span).addClass('font-red');
									}
								}
							}
						}
					});
				}
			});
		}

		var old_path_all = [];
		var filter_flag_append = false;
		var timeout = [];
		var ajax_flag = false;
		function find_append(){
			ajax_data = [];
			ajax_flag = false;
			var i = 0;
			var t_do1;
			index_f =0;
			function _do1(){
				clearTimeout(t_do1);
				for(i=index_f;i< index_f+50;i++){
					if(ajax_flag == true) {
						t_do1=setTimeout(function () {_do1();},1);
						return false;
					}
					if(flag_ajax_true == true)  {
						t_do1=setTimeout(function () {_do1();},1);
						return false;
					}
					if (i >= host_path_all.length){    //
						if(flag_ajax_true == true)  {
							t_do1=setTimeout(function () {_do1();},1);
							return false;
						}
						if (host_path_all.length == 0){
							scrollTop_check_server1();
							return false;
						}else{
							if(ajax_data.length > 0) ajax_host(); //300个检索叫条件里面的主机 都没达到50 也去执行ajax——host
							index_f = 0;
							t_do1=setTimeout(function () {_do1();},1);
							return false;
						}
					}
					var Path_array=host_path_all[i].Path.split('/');
					var len=Path_array.length;
					if (len == 2){//主机层
						if($('#nodehg-'+host_path_all[i].Id).length == 0) {
							continue;
						}//
						//show
						$('#nodehg-'+host_path_all[i].Id).parent('li').show();
						$('#nodehg-'+host_path_all[i].Id).siblings('span.h-name').addClass('h-name-red');
						red_to_font($('#nodehg-'+host_path_all[i].Id),0);
						$('#nodehg-'+host_path_all[i].Id).siblings('ul').find('li').show();
					}
					else{
						if (host_path_all[i].Type == 3 || host_path_all[i].Type == 4){ //服务/账号
							for (var j = 1; j < len; j++){
								var id=Path_array[j].split(',')[1];
								s = 0;
								if (j == len-1){ //主机层
									//数据正在展开 留在 host_path_all，下次继续执行
									if(flag_loading == true){
										s = 1;
										break;
									}
									//数据未完全展开 留在 host_path_all，下次继续执行
									if($('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+id).length == 0){
										continue;
									}
									//show
									$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+id).parent('li').show();
									red_to_font($('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+id),0);
									$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+id).addClass('show_input');
									$i_item=$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+id).prev('i');
									if($i_item.attr('class') == "h-blank"){ //
										host_path_all.splice(i,1);	
										//i--;
										s = 1;
										break;
									}
									if (push_hid.indexOf((Path_array[j-1].split(',')[1]+':'+id+':true')) != -1){
										s = 1;
										break;
									}
									if (push_hid.indexOf((Path_array[j-1].split(',')[1]+':'+id+':false')) != -1){
										s = 1;
										break;
									}
									if($('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+id).siblings('ul').children('li').length == 0){
										filter_flag_append = true;
										if(ajax_data.length >= MAX_AJAX){
											ajax_host();
											t_do1=setTimeout(function () {_do1();},1);
											return false;
										}else{
											hg_id = Path_array[j-1].split(',')[1];
											inv = ajax_data.indexOf(hg_id + ":" + id);
											if(inv < 0 ) ajax_data.push(hg_id + ":" + id); //没展开的主机 放入ajax_data			
											if(ajax_data.length >= MAX_AJAX){
												//去调用 展开的主机
												ajax_host();
												t_do1=setTimeout(function () {_do1();},1);
												return false;
											}else{
												// if(host_path_all.length <= MAX_AJAX){
												// 	ajax_host();
												// 	return false;
												// }
											}
										}
									}else{
										if(($i_item.attr('class').indexOf('h-aicon-d')) === -1){
											$i_item.trigger('click');
										}
									}
								}
								else{ //主机组层	
									if($('#nodehg-'+id).length == 0) {
										s = 1
										break;//
									}
									if(flag_loading == true){
										s =1;
										break;
									}
									// if(_initHTML_id_array.length>_initHTML_MAX){
									// 	s=1;
									// 	break;
									// }
									//show
									$('#nodehg-'+id).parent('li').show();
									red_to_font($('#nodehg-'+id),0);
									$i_item=$('#nodehg-'+id).prev('i');
									//发现主机或者组 其实下面没数据，跳过该条数据
									if($i_item.attr('class') == "h-blank"){ //
										host_path_all.splice(i,1);	
										//i--;
										s = 1;
										break;
									}
									if(($i_item.attr('class').indexOf('h-aicon-d')) === -1){
										filter_flag_append = true;
										$i_item.trigger('click');
									}
								}
							}
							if(s) continue;
							var s = 0;
							if (host_path_all[i].Type == 4){
								if(flag_loading == true) {continue;}
								var hg_id=Path_array[j-2].split(',')[1];
								var h_id=Path_array[j-1].split(',')[1];
								if ($("#nodes-"+hg_id+'-'+h_id+'-'+host_path_all[i].Parent).length == 0){
									continue;
								}
								//show
								$("#nodes-"+hg_id+'-'+h_id+'-'+host_path_all[i].Parent).parent('li').show();
								red_to_font($("#nodes-"+hg_id+'-'+h_id+'-'+host_path_all[i].Parent),0);
								var $i_item = $("#nodes-"+hg_id+'-'+h_id+'-'+host_path_all[i].Parent).prev('i');
								
								if(($i_item.attr('class').indexOf('h-aicon-d')) === -1){
									filter_flag_append = true;
									$i_item.trigger('click');
								}
								//show
								$("#nodea-"+hg_id+'-'+h_id+'-'+host_path_all[i].Id+'-'+host_path_all[i].Parent).parent('li').show();
								$("#nodea-"+hg_id+'-'+h_id+'-'+host_path_all[i].Id+'-'+host_path_all[i].Parent).siblings('span.h-name').addClass('h-name-red');
								red_to_font($("#nodea-"+hg_id+'-'+h_id+'-'+host_path_all[i].Id+'-'+host_path_all[i].Parent),0);
								$("#nodea-"+hg_id+'-'+h_id+'-'+host_path_all[i].Id+'-'+host_path_all[i].Parent).siblings('ul').find('li').show();
							}
							else{
								var all_id = $i_item.siblings('input').attr('id').split('-');
								if ($("#nodes-"+all_id[1]+'-'+all_id[2]+'-'+host_path_all[i].Id).length == 0){
									continue;
								}
								//show
								$("#nodes-"+all_id[1]+'-'+all_id[2]+'-'+host_path_all[i].Id).parent('li').show();
								$("#nodes-"+all_id[1]+'-'+all_id[2]+'-'+host_path_all[i].Id).siblings('span.h-name').addClass('h-name-red');
								red_to_font($("#nodes-"+all_id[1]+'-'+all_id[2]+'-'+host_path_all[i].Id),0);
								$("#nodes-"+all_id[1]+'-'+all_id[2]+'-'+host_path_all[i].Id).siblings('ul').find('li').show();
							}
								
						}
						else{
							s = 0;
							for(var j=1;j<len-1;j++){
								var id=Path_array[j].split(',')[1];
								if($('#nodehg-'+id).length == 0) {
									s = 1;
									break;//
								}
								if(flag_loading == true) {
									s = 1;
									break;
								}
								//show
								$('#nodehg-'+id).parent('li').show();
								$i_item=$('#nodehg-'+id).prev('i');
								
								if($i_item.attr('class') == "h-blank"){ //
									host_path_all.splice(i,1);	
									//i--;
									s = 1;
									break;//
								}
								if (push_hgid.indexOf(Path_array[j-1].split(',')[1]+':true') != -1){
									continue;
								}
								if (push_hgid.indexOf(Path_array[j-1].split(',')[1]+':false') != -1){
									continue;
								}
								if($('#nodehg-'+id).length >0){
									red_to_font($('#nodehg-'+id),0);
									if(($i_item.attr('class').indexOf('h-aicon-d')) == -1){
										filter_flag_append = true;
										$i_item.trigger('click');
									}		
								}
							}
							if(s) continue;
							if(host_path_all[i].Type==1){
								if($('#nodehg-'+host_path_all[i].Id).length == 0) continue;//
								//show
								$('#nodehg-'+host_path_all[i].Id).parent('li').show();
								$('#nodehg-'+host_path_all[i].Id).siblings('span.h-name').addClass('h-name-red');
								red_to_font($('#nodehg-'+host_path_all[i].Id),0);
								$('#nodehg-'+host_path_all[i].Id).siblings('ul').find('li').show();
							}else{
								if($('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+host_path_all[i].Id).length == 0){
									continue;
								}//
								//show
								$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+host_path_all[i].Id).parent('li').show();
								red_to_font($('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+host_path_all[i].Id),0);
								$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+host_path_all[i].Id).addClass('show_input');
								$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+host_path_all[i].Id).siblings('span.h-name').addClass('h-name-red');
								$('#nodeh-'+Path_array[j-1].split(',')[1]+'-'+host_path_all[i].Id).siblings('ul').find('li').show();
							}
						}
					}
					//数据展开后 从host_path_all删除掉，并且放在old_path_all，为标红和定位准备
					push_filter_wait.push(host_path_all[i]);
					old_path_all.push(host_path_all[i]);
					host_path_all.splice(i,1);
				}
				index_f = i;
				get_msg();	
				t_do1=setTimeout(function () {_do1();},1);
			}
			_do1();
		}
		var global_time=Date.parse(new Date())/1000;
		function get_msg(){
			var n=0;
			$.ajax({
				url: '/bhost/get_msg',
				type: "post",
				async:false,
				data: {a0:se},
				success: function(result) {
					var result=JSON.parse(result);
					global_time = Date.parse(new Date())/1000;	
					if(result.Result == false){
						if(result.info.indexOf('系统异常')>=0 || result.info.indexOf('非法访问')>=0 || result.info.indexOf('系统超时') >=0 ){
							_alert(2,'系统',result.info);
						}else{
							_alert(2,'系统',result.info);
						}
					}
					else{
					}
				}
			})
			if(n) return false;	
		}
		var flag_ajax_true = false;
		var mtr = null;
		function click_h0() {
			if (mtr != null) {
				mtr.abort();
				mtr = null;
			}
			flag_ajax_true = true;
			//条件没有的情况 直接返回
			if (JSON.stringify(find_host_arry) == "[]") {
				_waitDone($(".waitTip"));
				$('#hosttree_div1').scrollTop(0);
				tmp_list = null;
				//first_find_index = null;
				$('#hostTree').find('li').show();
				$("#hostTree").find('i.h-aicon.h-aicon-d').trigger('click');
				$('#hostTree').find('.font-red').removeClass('font-red');
				$("#hostTree").find('span.h-name-red').removeClass('h-name-red');
				find_host_loading = false;
				return false;
			}
			/*
			first_find_index = find_host_arry[0];
			var a = new Array();
			a[0] = find_host_arry[0];
			*/
			mtr = $.ajax({
				url: '/bhost/PFindHostDirectory_z',
				type: "POST",
				async: true,
				data: { a0: se, z1: JSON.stringify(find_host_arry), z2: 5, z3: editid },
				success: function (result) {
					mtr = null;
					tmp_list = null;
					flag_ajax_true = false;
					$('#hostTree').find('li').show();
					$('#hostTree').children('li').hide();
					if (result == "None") {
						tmp_list = new Array();
						$("#server_text1").blur();
						_alert(0, '搜索', '无搜索结果', $("#server_text1"));
						_waitDone($(".waitTip"));
						find_host_loading = false;
						return false;
					}
					tmp_list = JSON.parse(result);
					ajax_find_host_doing = true;
					/*
					if (find_host_arry.length > 1) {
						var new_list_arr = new Array();
						new_list_arr = tmp_list.filter(function (item) {
							var pass = true;
							for (var jm = 0; jm < find_host_arry.length; jm++) {
								var pass_one = false;
								var search_arr = find_host_arry[jm].split(' ');
								$.each(search_arr, function (i1, item1) {
									if (item1 != '') {
										if (coverString(item1, item.Name)) {
											pass_one = true;
											return false;
										}
									}
								});
								if (pass_one == false) {
									pass = false;
									break;
								}
							}
							return pass;
						});
						if (new_list_arr.length == 0) {
							ajax_find_host_doing = false;
							$("#server_text1").blur();
							_alert(0, '搜索', '无搜索结果', $("#server_text1"));
							_waitDone($(".waitTip"));
							return false;
						}
					}
					*/
					//把 过滤信息放入 host_path_all 全局变量
					if (tmp_list.length != 0) {
						tmp_list_path_strarray = tmp_list.map(function (params) {
							return params.Path;
						});
						$(tmp_list).each(function (i, item) {
							host_path_all.push(item);
						})
						flag_ajax_true = false;
						//开始过滤
						find_append();
					} else {
						ajax_find_host_doing = false;
						$("#server_text1").blur();
						_alert(0, '搜索', '无搜索结果', $("#server_text1"));
						_waitDone($(".waitTip"));
						find_host_loading = false;
					}
				}
			});
		}



		var push_filter_wait = [];
		var top1 = 9007199254740991;
		function scrollTop_check_server1(){
			var i = 0;
			var index_i = 0;
			//li_red_to_no_red($('#hostTree'),0);
			li_hide_while_no_red($('#hostTree'),0);
			if($('#hostTree').find('span.h-name-red').length==0){
				$("#server_text1").blur();
				_alert(0,'搜索','无搜索结果',$("#server_text1"));
				_waitDone($(".waitTip"));
				flag_ajax_true = true;
				ajax_find_host_doing=false;
				find_host_loading = false;
				return false;
			}
			find_host_loading = false;
			$('#hosttree_div1').scrollTop($('#hostTree').find('span.h-name-red').eq(0).offset().top-200);
			ajax_find_host_doing=false;
			flag_ajax_true = true;
			_waitDone($(".waitTip"));
			old_path_all=new Array();
		}
		function li_red_to_no_red(obj,type){
			var find_array; 
			if (type == 2){
				find_array = find_use_arry;
			}else if (type == 1){
				//find_host_arry_s = (search_typeall_r + search_typeall_new).split('\t');
				find_array = (search_typeall_r + search_typeall_new).split('\t');
			}else if (type == 0){
				find_array = find_host_arry;
			}

			var red_input=$(obj).find('span.h-name-red');
			for(var im=0;im<red_input.length;im++){
				var item=red_input.eq(im);
				var pass=true;
				var item_name=item.siblings('input').attr('data-name');
				var Name = item.siblings('input').attr('data-name');
				var Type = item.siblings('input').attr('id');
				var $span_son_font=$('.h-name-son',item).find('font');
				
				if (type == 0){
					if(Type.indexOf('nodeh')<0){
						var span_son_name=item_name.toLowerCase();
					}else{
						var host_span_arr=item_name.split('\t');
						var span_son_name=(host_span_arr[0]+'('+host_span_arr[1]+')').toLowerCase();
					}
				}else if (type == 1){
					if(Type.indexOf('HostId')<0){
						var span_son_name=item_name.toLowerCase();
					}else{
						var host_span_arr=item_name.split('\t');
						var span_son_name=(host_span_arr[0]+'('+host_span_arr[1]+')').toLowerCase();
					}
				}else if (type == 2){
					var span_son_name=item_name.toLowerCase();
				}
				for(var jm=0;jm<find_array.length;jm++){
					var jm_index_ = find_array[jm].indexOf('-');
					if (type == 1){
						if (find_array[jm] == '' || find_array[jm] == undefined || find_array[jm] == null) {
							continue;
						}
						var search_arr = find_array[jm].substr(jm_index_ + 1, find_array[jm].length).split(' ');
					}else{
						var search_arr = find_array[jm].substr(jm_index_ + 1, find_array[jm].length).split(' ');
					}
					var pass_one=false;
					$.each(search_arr,function(i1,item1){
						if (type == 1){
							if (find_array[jm].substr(0, jm_index_) == 'hostname') {
								Name = item_name.split('\t')[0];
								if(Type.indexOf('HostId')<0){
									return false;
								}
							} else if (find_array[jm].substr(0, jm_index_) == 'ip') {
								Name = item_name.split('\t')[1];
								if(Type.indexOf('HostId')<0){
									return false;
								}
							} else if (find_array[jm].substr(0, jm_index_) == 'hgname'){
								Name = item_name;
								if(Type.indexOf('HGId')<0){
									return false;
								}
							}else{
								Name = item_name;
							}
						}
						if (type == 0){
							if (find_array[jm].substr(0, jm_index_) == '组名'){
								Name = item_name;
								if(Type.indexOf('nodehg')<0){
									return false;
								}
							}else if (find_array[jm].substr(0, jm_index_) == '主机名') {
								Name = item_name.split('\t')[0];
								if(Type.indexOf('nodeh')<0){
									return false;
								}
							} else if (find_array[jm].substr(0, jm_index_) == 'IP'){
								Name = item_name.split('\t')[1];
								if(Type.indexOf('nodeh')<0){
									return false;
								}
							}else if (find_array[jm].substr(0, jm_index_) == '服务'){
								Name = item_name;
								if(Type.indexOf('nodes')<0){
									return false;
								}
							}else if (find_array[jm].substr(0, jm_index_) == '账号'){
								Name = item_name;
								if(Type.indexOf('nodea')<0){
									return false;
								}
							}else{
								Name = item_name;
							}
						}
						
						if (type == 2){
							Name = item_name;
							if (find_array[jm].substr(0, jm_index_) == '组名') {
								if(Type.indexOf('nodeug')<0){
									return false;
								}
							} else if (find_array[jm].substr(0, jm_index_) == '账号') {
								if(Type.indexOf('nodeu')<0){
									return false;
								}
							}
						}
						
						if(coverString(item1,Name)){
							if (type == 0){
								item1=item1.toLowerCase();
								if(find_array[jm].substr(0, jm_index_).toLowerCase() == '主机名'){
									var index_start=span_son_name.indexOf('(');
									var index_true=span_son_name.indexOf(item1,index_start);
									if(index_true>=0){
										for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
											$span_son_font.eq(i_red_span).addClass('font-red');
										}
									}
								}else{
									var index_true=span_son_name.indexOf(item1);
									if(index_true>=0){
										for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
											$span_son_font.eq(i_red_span).addClass('font-red');
										}
									}
								}
							}else if (type == 1){
								item1=item1.toLowerCase();
								if(find_array[jm].substr(0, jm_index_).toLowerCase() == 'hostname'){
									var index_start=span_son_name.indexOf('(');
									var index_true=span_son_name.indexOf(item1,index_start);
									if(index_true>=0){
										for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
											$span_son_font.eq(i_red_span).addClass('font-red');
										}
									}
								}else{
									var index_true=span_son_name.indexOf(item1);
									if(index_true>=0){
										for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
											$span_son_font.eq(i_red_span).addClass('font-red');
										}
									}
								}
							}else if (type == 2){
								item1=item1.toLowerCase();
								var index_true=span_son_name.indexOf(item1);
								if(index_true>=0){
									for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
										$span_son_font.eq(i_red_span).addClass('font-red');
									}
								}
							}
							pass_one=true;
							return false;
						}
					});
					if(pass_one==false){
						pass=false;
						break;
					}
				}
				if(pass==false){
					item.removeClass('h-name-red');
					$span_son_font.removeClass('font-red');
				}else{
				}
			}
		}
		function li_hide_while_no_red(obj,num){
			var li_visible=$(obj).children('li');
			for(var i=num;i<num+100;i++){
				if(i>=li_visible.length){
					break;
				}
				var item = li_visible.eq(i);
				
				var span_red_time = $(item).find('span.h-name-red').length;
				if (span_red_time == 0) {
					$(item).hide();
				}else if(span_red_time>0){
					$(item).show();
					var children_red_time=$(item).children('span.h-name-red').length;
					if(children_red_time>0 && span_red_time==1){
						$(item).children('i.h-aicon-d').removeClass('h-aicon-d');
						$(item).children('ul').hide();
						$(item).find('li').show();
					}
					else if(children_red_time>0 && span_red_time>1){
						$(item).find('li').show();
					}
					else if (children_red_time==0) {
						var $children_ul=$(item).children('ul');
						li_hide_while_no_red($children_ul,0);
					}
				}
			}
			if(i<li_visible.length){
				setTimeout(function () {li_hide_while_no_red(obj,i);},1);
			}
		}

	</script>

	<script>
		var cmdauthdata = {
			"CmdAuthId": 0,
			"CmdAuthName": "",
			"CmdAuthType": 1,//1-按用户/目标配置，2-按访问授权配置，3-按工单配置
			"Action": 1, //动作
			"AuthMode": -1,  //CmdAuthType为1时使用：1-按目标，指定账号；2-范围，共有账号；3-范围，所有账号；4-范围，自定义
			"AuthAccountId": "",//账号 
			"AuthService": null,      //授权服务(如果勾选了所有服务，则为*，否则为null)
			"Enabled": true,//是否启用
			"ResponseMode": 4,
			"SQLLimitTime": 0,
			"ApproveStrategyId": null,
			"EventAlarmInfoId": null,
			"AuthCmdSet": [],   //指令集合id                                                     
			"AdminSet": [],    //管理员
			"AuthObjectSet": {    //--CmdAuthType=1,用户和组选择
				"AuthUserSet": [],
				"AuthScope": [],  //主机/IP区间设置 
				"AuthServiceSet": [],
				"AuthObject": [],
				"DeleteAuthObject": []
			},
			"LoginUserCode": "12313"
		}

		var data = []; //节点
		var rangeid = {
			"ServerScopeSet": []
		}
		var flog = 1;
		var isto1 = 0;
		var isto = 0;
		//var ipReg = /^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])(\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])){3}$/;
		//var namecheck = /^[_\-.\n\w\u4e00-\u9fa5]*$/;
		var range_list = "";
		var cmdset = [];
		var groupdata;
		var cmdsave = 0;
		var savestep1 = {
			"name": "",
			"Enable": true,
			"admin": [],
			"ugid": [],
			"uid": []
		};
		var savestep2 = {
			"rangid": [],
			"accountid": [],
			"serverset": [],
			"AuthService": ""
		};
		var savestep3 = {
			"action": 1,
			"cmd_all": [],
			"respone": 0,
			"mode": 1,
			"woring": null,
			"approve": null,
			"woringname": "",
			"approvename": ""
		};
		var usercode;
		var se;
		var selectid = {{ selectid| safe }}
		/*
		function nameCheck(obj) {
			//var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
			var val = $(obj).val();
			var $i = $(obj).next('i.v-check');

			if (nameReg.test(val)) {
				$i.show().attr('class', 'v-check v-right');
			} else {
				$i.show().attr('class', 'v-check v-wrong');
			}
		}
		*/
		//是否存在
		function check_edit_cmdAuth(id) {
			$.ajax({
				url: '/bhost/check_edit_cmdAuth',
				type: 'post',
				async: false,
				data: { a0: se, z1: id },
				success: function (result) {
					var re_json = JSON.parse(result);
					if (re_json.data.length == 0) {
						show_list(1);
					}
				}
			});
		}
		
		var manage_auth_array = [];
		var access_auth_array = [];
		var $focusObj_c;
		$(function () {
			$("#Enable").iCheck('uncheck');
			if(document.frm_access.tasktype.value==3)
			{
			}else{
				$("#Enable").iCheck('check');
			}
			$('.xSelect').on('click', '.xSelect-show', function () {
				$focusObj_c = $(this).parents('.xSelect');
			});
			se = window.parent.document.frm.se.value;
			usercode = window.parent.document.frm.us.value;
			cmdauthdata.LoginUserCode = usercode;
			var cmd_auth_id = window.parent.document.frm.id.value;
			
			$.each(window.parent._power,function(i,item){
				if (item.Mode == 2){
					manage_auth_array.push(item.SubMenuId);
				}else{
					access_auth_array.push(item.SubMenuId);
				}
			});
			
			if (cmd_auth_id != undefined) {
				check_edit_cmdAuth(cmd_auth_id);
			}
			if (document.frm_access.tasktype.value == 3)//编辑
			{
				editid = document.frm_access.id.value;
				
				$.ajax({
					url:'/bhost/PUpdateHNodeSelectedForQuick',
					type:'post',
					async:false,
					data:{a0:se,z1:editid,z2:5},
					success:function(result){
						var data = JSON.parse(result)
						if(data.Result != true){
							_alert(1, "访问授权", "数据刷新失败");
							return false;
						}
					}
				});
			} else {
				editid = -1;
				$("#Enable").iCheck('check');
			}
			
			//服务器范围
			bind_server_xSelect();
			
			
			//事件告警信息
			bind_alarm_xSelect();
			
			//审批策略
			bind_approval_xSelect();
			
			//指令集合
			bind_cmd_xSelect();
		
			_initSize();
			_initList();
			//主机
			// get_hostdirectory(0, document.frm_access.id.value);
			// _viewHTML(hdata, '#hostTree', 0);
			get_cont_list();
			get_account();
			get_server();
			$("#part1").on('ifChecked',function(){
				$("#ip_n1").find("input").attr("disabled",false);
				$("#ip_n").find("input").attr("disabled",false);
				$("#ip_n1").find(".ctr.ctr-add").attr("onclick","_addIp1(this,2)");
				$("#ip_n").find(".ctr.ctr-add").attr("onclick","_addIp(this,2)");
			}).on('ifUnchecked',function(){
				$("#ip_n1").find("input").attr("disabled",true);
				$("#ip_n").find("input").attr("disabled",true);
				$("#ip_n1").find(".ctr.ctr-add").attr("onclick","");
				$("#ip_n").find(".ctr.ctr-add").attr("onclick","");
			})
			$("#part1").parent().attr("style","float: right; margin-top: 9px; position: relative;");
			$('#userTree,#hostTree').on('change', 'span.authtype input', function () {
				var checked = $(this).prop('checked');
				_authTypeTheme($(this));
				if (checked) {
					var $input1 = $(this).parent().parent().siblings('ul').find('span.authtype input');
					var $input2 = $(this).parent().parent().siblings('ul').find('input.zcheck');
					var $input3 = $(this).parent().parent().siblings('input.zcheck');
					//
					$input2.attr("data-loadlast", 2);
					$input3.attr("data-loadlast", 2);
					$(this).attr('data-ifselect', true);
					$input1.prop('disabled', true);
					_authTypeTheme($input1);
					$input2.prop('checked', true).prop('disabled', true);
					$(this).parent().parent().siblings('input.zcheck').prop('checked', true).next('span.checkbox').attr('class', 'checkbox checked');
					$.each($input2, function () {
						$(this).next('span.checkbox').attr('class', 'checkbox checked disabled');
					});

					_checkEvent($(this).parent().parent().siblings('input.zcheck'));
				} else {
					var $input1 = $(this).parent().parent().siblings('ul').children('li').find('span.authtype').find('input');
					var $input2 = $(this).parent().parent().siblings('ul').children('li').find('input.zcheck');
					$(this).attr('data-ifselect', false);
					$input1.prop('disabled', false);
					_checkEvent1($(this));
					authtype_click = 1;
				}
			});

			if (document.frm_access.tasktype.value == 3) {
				$("#ManageAuthName").val(savestep1.name);
				$("#ManageAuthName").attr("disabled", true);
				$.each(savestep1.admin, function (j, xitem) {
					$("#manager_select").val(xitem).trigger('change');
					if (j != savestep1.admin.length - 1) {
						$("#manager_select").parent().find('i').click();
					}
					/*
					if (j != mdata.length-1){
						$("#manager_select").parent().find('i').click();
					}
					*/
				})
				//console.log(savestep1.Enable);
				if (savestep1.Enable == true) {
					$("#Enable").iCheck('check');
				}else{
					$("#Enable").iCheck('uncheck');
				}
			} else {
				/*
				$.each(mdata, function (i, item) {
					if (item.UserCode == usercode) {
						$("#manager_select").val(item.UserId).trigger('change');
						//$("#manager_select").parent().children('i.add').click();
					}
				})*/
			}
			/*
			$.ajax({
				url: '/bhost/get_protocol_list',
				type: "post",
				async: false,
				cache: false,
				data: { a0: se, a1: 1, a2: null, a3: null, a4: ',,', a5: null },
				success: function (Result) {
					proto_list = JSON.parse(Result);
					$("#ProtocolName").empty();
					$("#ProtocolName").append("<option value=\"\" data=\"\">请选择</option>");
					$.each(proto_list.data, function (i, item) {
						$("#ProtocolName").append("<option value=\"" + item.ProtocolId + "\" data=\"" + item.Port + "\">" + item.ProtocolName + "</option>");
					})
				}
			})
			$("#ProtocolName").unbind().bind("change", function () {
				$("#Port").val($("#ProtocolName option:selected").attr("data"));
				//获取 连接参数
				$.ajax({
					url: '/bhost/get_ConnParam_list',
					type: "post",
					async: false,
					cache: false,
					data: { a0: se, a1: $(this).val() },
					success: function (Result) {
						connparm_list = JSON.parse(Result);
						$("#ConnParamName").empty();
						$("#ConnParamName").append("<option value=\"\">请选择</option>");
						$.each(connparm_list.data, function (i, item) {
							$("#ConnParamName").append("<option value=\"" + item.ConnParamId + "\" >" + item.ConnParamName + "</option>");
						})
					}
				})
			})
			*/
			$('.form-select').select2({ minimumResultsForSearch: -1 });
			//$("#ConnParamName").select2();
			//$("#ProtocolName").select2();
			$("#server_text").val("");
			/*
			$("#server_select").change(function () {
				var type = $(this).val();
				if (type == 0) {
					$("#server_text").hide();
				} else {
					$("#server_text").show();
				}
			});
			*/
			$("#server_select").val('all').trigger('change');
			/*
			$("#server_text1").val("");
			$("#server_select1").change(function () {
				var type = $(this).val();
				if (type == 0) {
					$("#server_text1").hide();
				} else {
					$("#server_text1").show();
				}
			});
			$("#server_select1").val(0).trigger('change');
			*/
			$("#check_all").on("ifClicked", function () {
				if (!$(this).prop("checked")) {
					$("#service_list2").find('input').iCheck('check');
				} else {
					$("#service_list2").find('input').iCheck('uncheck');
				}
			})
			$('.g-tsel').on('click', function () {
				var this_id = $(this).attr('id');
				var this_class = $(this).attr('class');
				if (this_class == "g-tsel") {
					$(this).children('input').focus().select();
				}
			});
			$(".cmdauth_user").on('click', function () {
				//show_list(1);
				if (document.frm_access.tasktype.value==1){
					document.frm_access.action = '/bhost/cmdAuth_show';
					document.frm_access.submit();
				}else{
					document.frm_access.z2.value=JSON.stringify(selectid);
					document.frm_access.action = '/bhost/cmdAuth_show';
					document.frm_access.submit();
				}
			})
		});
		//事件告警信息
		function bind_alarm_xSelect(){
			get_warning_all();
			var alarm_array = [];
			$.each(edata.data,function(i,item){
				if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(32) != -1){
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'edit'
					};
				}else{
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'check'
					};
				}
				select_data_json.value = item.EventAlarmInfoId;
				select_data_json.name = item.Name;
				alarm_array.push(select_data_json);
			});
			if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(32) != -1){
				$('#EventAlarmInfoId').xSelect({
					width: 192,
					defaultText: '请选择',
					items:alarm_array,
					module_type:'alarm',
					edit: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode3(obj,1);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								
								$(obj).parents('.xSelect-view').hide();
								_editNode3(obj,2);
							}
						}
					]
				});
			}else{
				$('#EventAlarmInfoId').xSelect({
					width: 192,
					defaultText: '请选择',
					items:alarm_array,
					module_type:'alarm',
					check: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode3(obj,1);
					}
				});
			}
		}
		
		//审批
		function bind_approval_xSelect(){
			get_ApproveStrategy();
			var approve_array = [];
			$.each(appdata.data,function(i,item){
				if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(32) != -1){
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'edit'
					};
				}else{
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'check'
					};
				}
				select_data_json.value = item.ApproveStrategyId;
				select_data_json.name = item.ApproveStrategyName;
				approve_array.push(select_data_json);
			});
			
			if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(32) != -1){
				var approve_Select = $('#EnableApprove').xSelect({
					width: 192,
					defaultText: '请选择',
					items:approve_array,
					module_type:'approve',
					edit: function(item,obj){
						$(obj).parents('.xSelect-view').hide();
						_editNode4(obj,1);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								$(obj).parents('.xSelect-view').hide();
								_editNode4(obj,2);
							}
						}
					]
				});
			}else{
				var approve_Select = $('#EnableApprove').xSelect({
					width: 192,
					defaultText: '请选择',
					items:approve_array,
					module_type:'approve',
					check: function(item,obj){
						$(obj).parents('.xSelect-view').hide();
						_editNode4(obj,1);
					}
				});
			}
			
		}
		//服务器范围
		function bind_server_xSelect(){
			$.ajax({
				url: '/bhost/get_ServerScope_w',
				type: 'post',
				async: false,
				data: { a0: se },
				success: function (result) {
					serdata = JSON.parse(result);
				}
			});
			s_index_all = [];
			var server_array = [];
			$.each(serdata.data,function(i,item){
				if ($("#ips").data('value') == item.ServerScopeId){
					
				}else{
					if (serverid_list.indexOf(item.ServerScopeId) > -1){
						return true;
					}
				}
				if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(18) != -1 || manage_auth_array.indexOf(20) != -1 || manage_auth_array.indexOf(21) != -1){
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'edit'
					};
				}else{
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'check'
					};
				}
				select_data_json.value = item.ServerScopeId;
				select_data_json.name = item.ServerScopeName;
				server_array.push(select_data_json);
				s_index_all.push(item.ServerScopeId);
			});
			if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(18) != -1 || manage_auth_array.indexOf(20) != -1 || manage_auth_array.indexOf(21) != -1){
				$('#ips').xSelect({
					width: 162,
					defaultText: '请选择',
					items:server_array,
					module_type:'server',
					edit: function(item,obj){
						$(obj).parents('.xSelect-view').hide();
						init_tree = 0;
						_editNode(obj,1);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								init_tree = 1;
								$(obj).parents('.xSelect-view').hide();
								_editNode(obj,2);
							}
						}
					],
					setval:function(item,obj){
						change_ser_scope(obj);
						if ($("#define_select").val() == 1 && ($("#a_mix_select").val() == 1 || $("#s_mix_select").val() ==1)){
							change_server(obj);
						}
					}
				});
			}else{
				$('#ips').xSelect({
					width: 162,
					defaultText: '请选择',
					items:server_array,
					module_type:'server',
					check: function(item,obj){	
						$(obj).parents('.xSelect-view').hide();
						init_tree = 0;
						_editNode(obj,1);
					},
					setval:function(item,obj){
						change_ser_scope(obj);
						if ($("#define_select").val() == 1 && ($("#a_mix_select").val() == 1 || $("#s_mix_select").val() ==1)){
							change_server(obj);
						}
					}
				});
			}
			
		}
		
		function bind_cmd_xSelect(){
			cmd_index_all = [0];
			var cmd_array = [];
			cmd_array.push({'value':-1,'name':"请选择",'type':null});
			$.ajax({
				url:"/bhost/get_cmd_all_x",
				type:"POST",
				async:false,
				data:{a0:se},
				success:function(result){ 
					var cmd_result = JSON.parse(result);
					$.each(cmd_result.data,function(i,item){
						if ($("#cmd").data('value') == item.CmdSetId){
					
						}else{
							if (cmdset.indexOf(item.CmdSetId) > -1){
								return true;
							}
						}
						if (manage_auth_array.indexOf(17) != -1){
							var select_data_json = {
								'value':1,
								'name':'admin2',
								'type':'edit'
							};
						}else{
							var select_data_json = {
								'value':1,
								'name':'admin2',
								'type':'check'
							};
						}
						select_data_json.value = item.CmdSetId;
						select_data_json.name = item.Name;
						cmd_array.push(select_data_json);
						cmd_index_all.push(item.CmdSetId);
					});
				}
			});
			if (manage_auth_array.indexOf(17) != -1){
				$('#cmd').xSelect({
					width: 140,
					defaultText: '请选择',
					items:cmd_array,
					module_type:'cmd',
					edit: function(item,obj){
						$(obj).parents('.xSelect-view').hide();
						_editNode2(obj,1);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								_editNode2(obj,2);
							}
						}
					],
					setval:function(item,obj){
						change_cmd(obj);
					}
				});
			}else{
				$('#cmd').xSelect({
					width: 140,
					defaultText: '请选择',
					items:cmd_array,
					module_type:'cmd',
					check: function(item,obj){
						$(obj).parents('.xSelect-view').hide();
						_editNode2(obj,1);
					},
					setval:function(item,obj){
						change_cmd(obj);
					}
				});
			}
			
		}
		
		var s_index_all = [];
		function change_ser_scope(obj){
			var t = $(obj).find('span').data('value');
			if (serverid_list.indexOf(t) === -1 && t != undefined) {
				serverid_list.splice(0, 1, t);
			}
			/*
			if ($(obj).parent('ul').children('li').length == 2 && t != '-1') {
				$('#ips').next('i.add').click();
				$('#ips').hide();
			}
			*/
		}
		$(window).resize(function () {
			_initSize();
		});

		function _initSize() {
			var h = $(window).height();
			//$('.h-catelog').height(h - 260);
			$('.h-catelog').height(h - 206);
			//$('.h-content2').height(h - 280);
			$('.h-content2').height(h - 226);
			$('.h-catelog_tmp').height(h - 304);
			//$('.ss-cont').height(h-280);
			$('.h-content2_temp').height(h - 310);
			//$('.h-content22').height(h - 300);
			$('.h-content22').height(h - 263);
			$('.h-catelog2_tmp').height(h - 289);
			$('.h-catelog.h-catelog2.h-catelog2_tmp').height(h - 269);
			var de_h1 = $("#defined_info").children(".h-catelog.h-catelog2.h-content2_temp:eq(0)").height();
			var de_h2 = $("#defined_info").children(".h-catelog.h-catelog2.h-content2_temp:eq(1)").height();
			$("#service_list_a").parents('.c-table.tab-type2').css('max-height',de_h1-109);
			$("#service_list2").parents('.c-table.tab-type2').css('max-height',de_h1-109);
		}

		var push_hgid = [];
		var push_hid = [];
		//获取host
		function get_hostdirectory(id, eid) {
			$.ajax({
				url: '/bhost/get_hostdirectory_zc',
				type: 'post',
				async: false,
				cache: false,
				data: { a0: se, z1: id, z2: eid },
				success: function (result) {
					hdata = JSON.parse(result);
					count_ajax = count_ajax + 1;
					if (editid > 0) {
						$(hdata.data.HGroup).each(function (i, item) {
							if (push_hgid.indexOf(item.HGId) < 0) {
								push_hgid.push(item.HGId + ":false");
							}
						})
					}
				}
			});
		}

		function get_host(id) {
			$.ajax({
				url: '/bhost/get_host_pwd',
				type: 'post',
				async: false,
				data: { a0: se, z1: id },
				success: function (result) {
					adata = JSON.parse(result);
				}
			});
		}

		var last_object = [];
		function _initList() {
			if (document.frm_access.tasktype.value == 3)//编辑
			{
				get_groupdirectory_id(document.frm_access.id.value, 0);
				get_all_data();
				last_object = alldata.data[0].AuthObjectSet.AuthObject == null ? [] : alldata.data[0].AuthObjectSet.AuthObject;
			}
			else {
				get_groupdirectory(0);
			}
			var data1 = groupdata;
			_viewHTML(data1, '#userTree', 1);

			$('#userTree,#hostTree').on('click', 'i.h-aicon', function () {
				var id = $(this).data('id').split('-')[1];
				var uorh = $(this).data('id').split('-')[0];
				var $u = $(this).parent().children('ul');
				if ($u.is(':hidden')) {
					$(this).addClass('h-aicon-d');
					$u.show();
					if ($u.text() == "Loading...") {
						var v = 2, d;
						var $input = $(this).siblings('span.checkbox');
						if ($(this).siblings('span.authtype').find('input').is(':checked')) {
							d = 0;
						} else {
							d = 1;
						}
						if ($input.attr('class').indexOf('disabled') > 0) {
							d = 0;
						}
						var c = $input.attr('class');
						if (c.indexOf('checked') > 0) {
							v = 1;
						} else if (c == 'checkbox') {
							v = 0;
						}
						_initHTML($u, id, v, d, uorh);
					}
				} else {
					$(this).removeClass('h-aicon-d');
					$u.hide();
				}
			})
			.on('dblclick', 'i.h-eicon,span.h-name', function () {
				var i_class_arr = $(this).siblings('i.h-aicon');
				if (i_class_arr.length == 0) {
					return false;
				}
				var id = i_class_arr.data('id').split('-')[1];
				var uorh = i_class_arr.data('id').split('-')[0];
				var $u = i_class_arr.parent().children('ul');
				if ($u.is(':hidden')) {
					i_class_arr.addClass('h-aicon-d');
					$u.show();
					if ($u.text() == "Loading...") {
						var v = 2, d;
						var $input = $(this).siblings('span.checkbox');
						if ($(this).siblings('span.authtype').find('input').is(':checked')) {
							d = 0;
						} else {
							d = 1;
						}
						if ($input.attr('class').indexOf('disabled') > 0) {
							d = 0;
						}
						var c = $input.attr('class');
						if (c.indexOf('checked') > 0) {
							v = 1;
						} else if (c == 'checkbox') {
							v = 0;
						}
						_initHTML($u, id, v, d, uorh);
					}
				} else {
					i_class_arr.removeClass('h-aicon-d');
					$u.hide();
				}
			});
		}

		function show_list(type,CmdAuthId) {
			if (document.frm_access.tasktype.value == 1) {
				document.frm_access.tasktype.value = 3;
				document.frm_access.se.value = se;
				document.frm_access.us.value = usercode;
				//document.frm_access.action = '/bhost/cmdAuth_show';
				document.frm_access.action = '/bhost/index';
				document.frm_access.submit();
			}
			else {
				if (type == 2) {
					document.frm_access.name.value = "";
					document.frm_access.type.value = "";
					if (document.frm_access.tasktype.value == 3) {
						$.ajax({
							url: '/bhost/get_index',
							type: 'post',
							async: false,
							data: { a0: se, z1: document.frm_access.id.value, z2: 10 },
							success: function (result) {
								document.frm_access.page.value = Math.ceil(parseInt(result) / MAX_PAGE);
							}
						});
					} else {
						$.ajax({
							url: '/bhost/get_index',
							type: 'post',
							async: false,
							data: { a0: se, z1: CmdAuthId, z2: 10 },
							success: function (result) {
								document.frm_access.page.value = Math.ceil(parseInt(result) / MAX_PAGE);
							}
						});
					}
				}
				document.frm_access.a0.value = se;
				document.frm_access.tasktype.value = 4;
				document.frm_access.z2.value = JSON.stringify(selectid);
				document.frm_access.action = '/bhost/cmdAuth_show';
				document.frm_access.submit();
			}
		}
		function to(page) {
			if (flog == 1) {
				if (page == 2) {
					next();
				} else if (page == 3) {
					next();
					if (isto == 1) {
						return false;
					}
					next();
				}
			} else if (flog == 2) {
				if (page == 1) {
					up();
				} else if (page == 3) {
					next();
				}
			} else {
				if (page == 2) {
					up();
				} else if (page == 1) {
					up();
					up();
					$("#upstep").remove();
				}
			}
		}
		//子节点
		var editid;
		var ajax_data = [];
		var count_ajax = 0;
		var MAX_AJAX = 50;
		function _initHTML(obj, id, v, d, uorh) {
			if (document.frm_access.tasktype.value == 3 && ($(obj).parent().parent().find(".authtype").length == 0 || $(obj).parent().parent().find(".authtype").find("input[type=checkbox]").prop('checked') == false))
			{
				get_groupdirectory_id(document.frm_access.id.value, id);
			}
			else {
				get_groupdirectory(id);
			}

			$(obj).empty();
			if (uorh == "arrHG" || uorh == "arrH") {
				if (uorh == "arrHG") {
					//过滤中 不需要 showloading
					if (filter_flag_append == true) filter_flag_append = false;
					else _showLoading();
					get_hostdirectory1(obj, id, v, d);
					return true;
				} else {
					if (filter_flag_append == true) filter_flag_append = false;
					else _showLoading();
					$.ajax({
						url: '/bhost/get_host_pwd',
						type: 'post',
						cache: false,
						async: true,
						data: { a0: se, z1: id },
						beforeSend: function (xmlHttp) {
							xmlHttp.setRequestHeader("If-Modified-Since", "0");
							xmlHttp.setRequestHeader("Cache-Control", "no-cache");
						},
						success: function (result) {
							var adata = JSON.parse(result);
							////data-loadfirst(初始的状态) 0->未选中 1->部分选中 2->全选中 
							//data-loadlast(最后保存的状态) 
							//data-ifselect(组或者主机 是否是按组授权或者 按主机授权
							var flag_change = false;
							var _loadfirst = $(obj).siblings('input.zcheck').attr("data-loadfirst");
							var _loadlast = $(obj).siblings('input.zcheck').attr("data-loadlast");
							var parents_aid = $(obj).siblings('input.zcheck').attr('id').split('-');
							var parents_id = parents_aid[2];
							var parentss_id = parents_aid[1];
							//判断 父节点是否状态改变

							var loadfirst = 0;
							var loadlast = 0;

							if (_loadfirst == _loadlast) {
								if (_loadlast == 2) {
									loadfirst = 2;
									loadlast = 2;
								} else if (_loadlast == 1) {
									flag_change = true;
								}
							} else {
								if (_loadlast == 2) {
									loadlast = 2;
								}
								if (_loadfirst == 2) {
									loadfirst = 2;
								}
							}

							$.each(adata.ServiceSet, function (i, item) {
								var $a = '';
								var class_flag = 0;
								if(item.ProtocolId == null){
									return true;
								}
								$.each(adata.AccountSet, function (i2, item2) {
									if(item2.HostAccount.AccountId == null){
										return true;
									}
									$.each(item2.HostServiceSet, function (i1, item1) {
										if (item.HostServiceId == item1.HostServiceId) {
											class_flag = 1;
											if (loadlast == 2) {
												$a = $a + '<li><i class="h-blank" /><input type="checkbox" id="nodea-' + parentss_id + '-' + parents_id + '-' + item2.HostAccount.AccountId + '-' + item1.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' checked="checked" data-name="' + item2.HostAccount.AccountName + '"><i class="h-eicon h-eicon-a2"></i><span class="h-name h-name2" style="margin-top:-6px;width:12em;" id="spana-' + parentss_id + '-' + parents_id + '-' + item2.HostAccount.AccountId + '-' + item1.HostServiceId + '">' + '<span class="h-name-son" style="">' + 
                                                    item2.HostAccount.AccountName.split('').map(function (params) {
                                                        return '<font>'+params+'</font>'    
                                                    }).join('') + 
                                                    '</span>' + '</span></li>';
											} else {
												$a = $a + '<li><i class="h-blank" /><input type="checkbox" id="nodea-' + parentss_id + '-' + parents_id + '-' + item2.HostAccount.AccountId + '-' + item1.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-name="' + item2.HostAccount.AccountName + '"><i class="h-eicon h-eicon-a2"></i><span class="h-name h-name2" style="margin-top:-6px;width:12em;" id="spana-' + parentss_id + '-' + parents_id + '-' + item2.HostAccount.AccountId + '-' + item1.HostServiceId + '">' + '<span class="h-name-son" style="">' + 
                                                    item2.HostAccount.AccountName.split('').map(function (params) {
                                                        return '<font>'+params+'</font>'    
                                                    }).join('') + 
                                                    '</span>' + '</span></li>';
											}
											return false;
										}
									})
								});
								if (class_flag == 0) {
									A_class = "h-blank";
								} else {
									A_class = "h-aicon";
								}
								if (loadlast == 2) {
									$(obj).append('<li><i class="' + A_class + '" data-id="arrS-' + item.HostServiceId + '"/><input type="checkbox" id="nodes-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' checked="checked" data-name="' + item.HostServiceName + '"><i class="h-eicon h-eicon-s2"></i><span class="h-name h-name2" id="spans-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                                        item.HostServiceName.split('').map(function (params) {
                                            return '<font>'+params+'</font>'
                                        }).join('') + 
                                        '</span>' + '</span><ul style="display:none">' + $a + '</ul></li>');
								} else {
									$(obj).append('<li><i class="' + A_class + '" data-id="arrS-' + item.HostServiceId + '"/><input type="checkbox" id="nodes-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-name="' + item.HostServiceName + '"><i class="h-eicon h-eicon-s2"></i><span class="h-name h-name2" id="spans-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                                        item.HostServiceName.split('').map(function (params) {
                                            return '<font>'+params+'</font>'    
                                        }).join('') + 
                                        '</span>' + '</span><ul style="display:none">' + $a + '</ul></li>');
								}
							});

							if (flag_change) {
								if (document.frm_access.tasktype.value == 3 && alldata.data[0].AuthObjectSet.AuthObject != null) {
									var ser_flag = 0;
									var serid_flag = 0;
									var first_serid = 1;

									alldata.data[0].AuthObjectSet.AuthObject.sort(function (a, b) {
										return a.HostServiceId - b.HostServiceId;
									});
									if (v != 0) {
										$.each(alldata.data[0].AuthObjectSet.AuthObject, function (i1, item1) {
											if (item1.HGId == parentss_id && item1.HostId == parents_id) {
												$("#nodea-" + parentss_id + '-' + parents_id + '-' + item1.AccountId + '-' + item1.HostServiceId).attr('checked', true);
												$("#nodea-" + parentss_id + '-' + parents_id + '-' + item1.AccountId + '-' + item1.HostServiceId).next('span').attr("class", "checkbox checked");
												$("#nodea-" + parentss_id + '-' + parents_id + '-' + item1.AccountId + '-' + item1.HostServiceId).attr('data-loadfirst', 2);
												$("#nodea-" + parentss_id + '-' + parents_id + '-' + item1.AccountId + '-' + item1.HostServiceId).attr('data-loadlast', 2);

												if ($("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).siblings('ul').find('input:checked').length == $("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).siblings('ul').find('input').length) {
													$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('checked', true);
													$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).next('span').attr("class", "checkbox checked");
													$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('data-loadfirst', 2);
													$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('data-loadlast', 2);
												} else {
													$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr("data-check", "2");
													$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('data-loadfirst', 1);
													$("#nodes-" + parentss_id + '-' + parents_id + '-' + item1.HostServiceId).attr('data-loadlast', 1);
												}
											}
										})
									}
								}
							}


							if (d == 0) {
								$(obj).find('input').prop('disabled', true);
								if ($(obj).siblings('span.authtype').find('input').length > 0) {
									if ($(obj).siblings('span.authtype').find('input').next('span').attr('class').indexOf('checked') != -1 || $(obj).siblings('input').prop('disabled')) {
									} else {
										$(obj).find('input').each(function () {
											$(this).attr('disabled', false);
											$(this).next('span.checkbox').removeClass('disabled');
										});
									}
								}
							}

							_checkView_host(obj);
							if(flag_save == 0){
								_closeLoading();
							}
						},
						error: function (XmlHttpRequest, textStatus, errorThrown) {

						}
					});
				}
			} 
			else {
				if (filter_flag_append_u == true) filter_flag_append_u = false;
				else _showLoading();
				$(obj).empty();
				
				$.each(groupdata.data.UGroup, function (i, item) {
					var $H = $('<li></li>');
					var $auth = '<label><input type="checkbox" name="check' + item.UGId + '">组授权</label>';
					$.each(edit_data, function (i1, item1) {
						if (item1.Id == item.UGId && item1.Type == 2) {
							$auth = '<label><input type="checkbox" name="check' + item.UGId + '" checked="checked">组授权</label>';
							return false;
						}
					})
					if (v == 1 && d == 0) {
						if (item.MemberNum == 0 && item.UserNum == 0) {
							$H.html('<i class="h-blank" data-id="arru-' + item.UGId + '" /><input type="checkbox" checked="checked" id="nodeug-' + item.UGId + '" data-check="1" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
						} else {
							$H.html('<i class="h-aicon" data-id="arru-' + item.UGId + '" /><input type="checkbox" checked="checked" id="nodeug-' + item.UGId + '" data-check="1" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
						}
					} else if (v == 1) {
						if (item.MemberNum == 0 && item.UserNum == 0) {
							$H.html('<i class="h-blank" data-id="arru-' + item.UGId + '" /><input type="checkbox" checked="checked" id="nodeug-' + item.UGId + '" data-check="2" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
						} else {
							$H.html('<i class="h-aicon" data-id="arru-' + item.UGId + '" /><input type="checkbox" checked="checked" id="nodeug-' + item.UGId + '" data-check="2" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
						}
					} else if (v == 0) {
						if (item.MemberNum == 0 && item.UserNum == 0) {
							$H.html('<i class="h-blank" data-id="arru-' + item.UGId + '" /><input type="checkbox" id="nodeug-' + item.UGId + '" data-check="0" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" >' + $auth + '</span><ul style="display:none">Loading...</ul>');
						} else {
							$H.html('<i class="h-aicon" data-id="arru-' + item.UGId + '" /><input type="checkbox" id="nodeug-' + item.UGId + '" data-check="0" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" >' + $auth + '</span><ul style="display:none">Loading...</ul>');
						}
					} else {
						if (item.Selected == 0) {
							if (item.MemberNum == 0 && item.UserNum == 0) {
								$H.html('<i class="h-blank" data-id="arru-' + item.UGId + '" /><input type="checkbox" id="nodeug-' + item.UGId + '" data-check="0" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
							} else {
								$H.html('<i class="h-aicon" data-id="arru-' + item.UGId + '" /><input type="checkbox" id="nodeug-' + item.UGId + '" data-check="0" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
							}
						} else if (item.Selected == 1) {
							if (item.MemberNum == 0 && item.UserNum == 0) {
								$H.html('<i class="h-blank" data-id="arru-' + item.UGId + '" /><input type="checkbox" id="nodeug-' + item.UGId + '" data-check="2" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
							} else {
								$H.html('<i class="h-aicon" data-id="arru-' + item.UGId + '" /><input type="checkbox" id="nodeug-' + item.UGId + '" data-check="2" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
							}
						} else {
							if (item.MemberNum == 0 && item.UserNum == 0) {
								$H.html('<i class="h-blank" data-id="arru-' + item.UGId + '" /><input type="checkbox" checked="checked" id="nodeug-' + item.UGId + '" data-check="1" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
							} else {
								$H.html('<i class="h-aicon" data-id="arru-' + item.UGId + '" /><input type="checkbox" checked="checked" id="nodeug-' + item.UGId + '" data-check="1" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
							}
						}
					}
					$(obj).append($H);
					if (editid > 0) {
						ugtreelist.push(item.UGId +':false');
					}
				});
				var parent_id = $(obj).siblings('input').attr('id').split('-')[1];
				$.each(groupdata.data.User, function (i, item) {
					if(item.UserCode == "admin") return true;
					if (v == 1 && d == 0) {
						$(obj).append('<li><i class="h-blank" /><input type="checkbox" checked="checked" id="nodeu-' +parent_id+'-'+ item.UserId + '" class="zcheck zcheck-g" data-mode="' + item.Mode + '" data-name="' + item.UserCode + '"><i class="h-eicon h-eicon-r"></i><span class="h-name" id="spanu-'+parent_id+'-' + item.UserId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UserCode.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span></li>');
					} else if (v == 1) {
						$(obj).append('<li><i class="h-blank" /><input type="checkbox" checked="checked" id="nodeu-'+parent_id+'-' + item.UserId + '" class="zcheck zcheck-g" data-mode="' + item.Mode + '" data-name="' + item.UserCode + '"><i class="h-eicon h-eicon-r"></i><span class="h-name" id="spanu-' + item.UserId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UserCode.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span></li>');
					} else if (v == 0) {
						$(obj).append('<li><i class="h-blank" /><input type="checkbox" id="nodeu-'+parent_id+'-' + item.UserId + '" class="zcheck zcheck-g" data-mode="' + item.Mode + '" data-name="' + item.UserCode + '"><i class="h-eicon h-eicon-r"></i><span class="h-name" id="spanu-'+parent_id+'-' + item.UserId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UserCode.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span></li>');
					} else {
						if (item.Selected == 0) {
							$(obj).append('<li><i class="h-blank" /><input type="checkbox" id="nodeu-'+parent_id+'-' + item.UserId + '" class="zcheck zcheck-g" data-mode="' + item.Mode + '" data-name="' + item.UserCode + '"><i class="h-eicon h-eicon-r"></i><span class="h-name" id="spanu-'+parent_id+'-' + item.UserId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UserCode.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span></li>');
						} else {
							$(obj).append('<li><i class="h-blank" /><input type="checkbox" id="nodeu-'+parent_id+'-' + item.UserId + '" class="zcheck zcheck-g" checked="checked" data-mode="' + item.Mode + '" data-name="' + item.UserCode + '"><i class="h-eicon h-eicon-r"></i><span class="h-name" id="spanu-'+parent_id+'-' + item.UserId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.UserCode.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span></li>');
						}
					}
				});
				if (d == 0) {
					$(obj).find('input').prop('disabled', true);
				}
				_checkView_user(obj);
				if(flag_save == 0){
					_closeLoading();
				}
				if(editid > 0){
					select_checkbox("UGroup");
					select_checkbox("User",parent_id);
				}
			}
		}
		var flag_save = 0;
		var _jScrollBar_array = [];
		function _jScrollBar(scid) {
			var myBar = new MyScrollBar({
				selId:scid,
				hasX:true,
				hasY:false,
				width:6,
				// enterShow:false,
			})
		}
		
		function get_hostdirectory1(obj, id, v, d) {
			flag_loading = true;
			var loading_hgid;
			$.ajax({
				url: '/bhost/get_hostdirectory_zc',
				type: 'post',
				async: true,
				data: { a0: se, z1: id, z2: editid, z3:ajax_find_host_doing?'true':'false'},
				success: function (result) {
					var hdata = JSON.parse(result);
					loading_hgid = id;
					if (editid > 0) disabled_flag = "disabled";
					else disabled_flag = "";
					var loadfirst = 0;
					var loadlast = 0;
					var parent_id = $(obj).siblings('input').attr('id').split('-')[1];
					var _p_loadfirst = $(obj).siblings('input').attr('data-loadfirst');
					var _p_loadlast = $(obj).siblings('input').attr('data-loadlast');
					var auth_type_checked = $(obj).siblings('span.authtype').find('input').prop('checked');
					if (_p_loadfirst == _p_loadlast) {
						if (_p_loadlast == 2) {
							loadfirst = 2
							loadlast = 2;
						}
					} else {
						loadlast = _p_loadlast;
					}

					if (hdata.data.HGroup == null) hdata.data.HGroup = [];
					$.each(hdata.data.HGroup, function (i, item) {
						if (item.Mode == 2) var $auth = '<label><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + '" >组授权</label>';
						else var $auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + '" >组授权</label>';
						var $H = $('<li></li>');

						if ((item.MemberNum + item.HostNum) == 0) i_class = "h-blank";
						else i_class = "h-aicon";
						//data-loadfirst(初始的状态) 0->未选中 1->部分选中 2->全选中 
						//data-loadlast(最后保存的状态)
						if (v == 1 && d == 0) {
							if (item.Mode == 2) $auth = '<label><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false disabled data-mode="' + item.Mode + '" >组授权</label>';
							else $auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + '" disabled>组授权</label>';
							$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" checked="checked" id="nodehg-' + item.HGId + '" data-check="1" class="zcheck zcheck-g" data-name="'+item.HGName+'" disabled data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' ><i class="h-eicon h-eicon-g"></i><span class="h-name" id="spanHG-' + item.HGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.HGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
						} else if (v == 1) { //v == 1 d ==1
							$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" checked="checked" id="nodehg-' + item.HGId + '" data-check="1" class="zcheck zcheck-g" data-name="'+item.HGName+'" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' ><i class="h-eicon h-eicon-g"></i><span class="h-name" id="spanHG-' + item.HGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.HGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
						} else if (v == 0) {
							$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" id="nodehg-' + item.HGId + '" data-check="0" class="zcheck zcheck-g" data-name="'+item.HGName+'" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' ><i class="h-eicon h-eicon-g"></i><span class="h-name" id="spanHG-' + item.HGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.HGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                            '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
						} else {
							$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" data-name="'+item.HGName+'" id="nodehg-' + item.HGId + '" data-check="0" class="zcheck zcheck-g" ' + disabled_flag + ' data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-ifselect=false ><i class="h-eicon h-eicon-g"></i><span class="h-name" id="spanHG-' + item.HGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + 
                            item.HGName.split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') + 
                        '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');

						}
						if (editid > 0) {
							if (auth_type_checked) {

							} else {
								if (push_hgid.indexOf(item.HGId + ":false") < 0) {
									push_hgid.push(item.HGId + ":false");
								}
							}
						}
						$(obj).append($H);
					})

					_checkView_host(obj);
					if (editid > 0) {
						var _ajax_find_host_doing = ajax_find_host_doing;
						select_checkbox("HGroup", parent_id,_ajax_find_host_doing);	 //只有编辑情况下 才需要判断 select 
					}

					if (hdata.data.Host == null) {
						hdata.data.Host = [];
						flag_loading = false;
						if(flag_save == 0){
							_closeLoading();
						}
						return false;
					}

					var i = 0;
					var index = 0;
					html_str = "";
					$.each(hdata.data.Host,function (i,item) {
						if((hdata.data.Host[i].Selected==0 && hdata.data.Host[i].Mode==0 && ajax_find_host_doing==true) || (editid<=0 && hdata.data.Host[i].Mode==0)){
							return true;
						}
						var $auth = '<label><input type="checkbox" name="check'+hdata.data.Host[i].HostId+'"  '+disabled_flag+' data-ifselect=false data-mode="'+hdata.data.Host[i].Mode+'" >主机授权</label>';
						
						if((ajax_find_host_doing==true && $(obj).siblings('span.h-name-red').length==0) || (item.Mode == 0 && item.Selected == 0)){
							var $H = $('<li style="display: none;"></li>');
						}else{
							var $H = $('<li></li>');
						}
						//var HostName_h = autoAddEllipsis(hdata.data.Host[i].HostName,'12');
						var HostName_h = hdata.data.Host[i].HostName;
						if(hdata.data.Host[i].AccountNum == 0) i_class = "h-blank";
						else i_class = "h-aicon";
						
						if(v==1 && d == 0){
							$auth = '<label><input type="checkbox" name="check'+hdata.data.Host[i].HostId+'" disabled data-ifselect=false data-mode="'+hdata.data.Host[i].Mode+'" >主机授权</label>';
							$H.html('<i class="'+i_class+'" data-id="arrH-'+hdata.data.Host[i].HostId+'" /><input type="checkbox" checked="checked" id="nodeh-'+parent_id+'-'+hdata.data.Host[i].HostId+'" data-check="1" class="zcheck zcheck-g" data-loadfirst='+loadfirst+' data-loadlast='+loadlast+'  disabled  data-ifselect=false data-mode="'+hdata.data.Host[i].Mode+'" data-name="'+hdata.data.Host[i].HostIP+'\t'+hdata.data.Host[i].HostName+'"><i class="h-eicon h-eicon-u"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+hdata.data.Host[i].HostId+'">'+'<span class="h-name-son" style="">' + 
                            (hdata.data.Host[i].HostIP+'('+HostName_h+')').split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') +
                            '</span></span><span class="authtype" style="display:inline-block">'+$auth+'</span><ul style="display:none">Loading...</ul>');
							
						}else if(v==1){
							$H.html('<i class="'+i_class+'" data-id="arrH-'+hdata.data.Host[i].HostId+'" /><input type="checkbox" checked="checked" id="nodeh-'+parent_id+'-'+hdata.data.Host[i].HostId+'" data-check="1" class="zcheck zcheck-g" data-loadfirst='+loadfirst+' data-loadlast='+loadlast+' data-ifselect=false data-mode="'+hdata.data.Host[i].Mode+'" data-name="'+hdata.data.Host[i].HostIP+'\t'+hdata.data.Host[i].HostName+'"><i class="h-eicon h-eicon-u"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+hdata.data.Host[i].HostId+'">'+'<span class="h-name-son" style="">' + 
                            (hdata.data.Host[i].HostIP+'('+HostName_h+')').split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') +
                            '</span></span><span class="authtype" style="display:inline-block">'+$auth+'</span><ul style="display:none">Loading...</ul>');
						}else if(v==0){
							$H.html('<i class="'+i_class+'" data-id="arrH-'+hdata.data.Host[i].HostId+'" /><input type="checkbox" id="nodeh-'+parent_id+'-'+hdata.data.Host[i].HostId+'" data-check="0" class="zcheck zcheck-g" data-loadfirst='+loadfirst+' data-loadlast='+loadlast+' data-ifselect=false data-mode="'+hdata.data.Host[i].Mode+'" data-name="'+hdata.data.Host[i].HostIP+'\t'+hdata.data.Host[i].HostName+'"><i class="h-eicon h-eicon-u"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+hdata.data.Host[i].HostId+'">'+'<span class="h-name-son" style="">' + 
                            (hdata.data.Host[i].HostIP+'('+HostName_h+')').split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') +
                            '</span></span><span class="authtype" style="display:inline-block">'+$auth+'</span><ul style="display:none">Loading...</ul>');
						}else{
							$H.html('<i class="'+i_class+'" data-id="arrH-'+hdata.data.Host[i].HostId+'" /><input type="checkbox" id="nodeh-'+parent_id+'-'+hdata.data.Host[i].HostId+'" data-check="0" class="zcheck zcheck-g" data-ifselect=false data-loadfirst=0 data-loadlast='+loadlast+' '+disabled_flag+' data-mode="'+hdata.data.Host[i].Mode+'" data-name="'+hdata.data.Host[i].HostIP+'\t'+hdata.data.Host[i].HostName+'"><i class="h-eicon h-eicon-u" class="zcheck"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+hdata.data.Host[i].HostId+'">'+'<span class="h-name-son" style="">' + 
                            (hdata.data.Host[i].HostIP+'('+HostName_h+')').split('').map(function (params) {
                                return '<font>'+params+'</font>'    
                            }).join('') +
                            '</span></span><span class="authtype" style="display:inline-block">'+$auth+'</span><ul style="display:none">Loading...</ul>');
							if(ajax_find_host_doing==false){
								$H.html('<i class="'+i_class+'" data-id="arrH-'+hdata.data.Host[i].HostId+'" /><input type="checkbox" id="nodeh-'+parent_id+'-'+hdata.data.Host[i].HostId+'" data-check="0" class="zcheck zcheck-g" data-ifselect=false data-loadfirst=0 data-loadlast='+loadlast+' '+disabled_flag+' data-mode="'+hdata.data.Host[i].Mode+'" data-name="'+hdata.data.Host[i].HostIP+'\t'+hdata.data.Host[i].HostName+'"><i class="h-eicon h-eicon-u" class="zcheck"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+hdata.data.Host[i].HostId+'">'+'<span class="h-name-son" style="">' + 
                                (hdata.data.Host[i].HostIP+'('+HostName_h+')').split('').map(function (params) {
                                    return '<font>'+params+'</font>'    
                                }).join('') +
                                '</span></span><span class="authtype" style="display:inline-block">'+$auth+'</span><ul style="display:none">Loading...</ul>');
							
							}
							else{
								switch(hdata.data.Host[i].Selected){
									case 0:
										$H.html('<i class="'+i_class+'" data-id="arrH-'+hdata.data.Host[i].HostId+'" /><input type="checkbox" id="nodeh-'+parent_id+'-'+hdata.data.Host[i].HostId+'" data-check="0" class="zcheck zcheck-g" data-ifselect=false data-loadfirst=0 data-loadlast='+hdata.data.Host[i].Selected+' data-mode="'+hdata.data.Host[i].Mode+'" data-name="'+hdata.data.Host[i].HostIP+'\t'+hdata.data.Host[i].HostName+'"><i class="h-eicon h-eicon-u" class="zcheck"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+hdata.data.Host[i].HostId+'">'+'<span class="h-name-son" style="">' + 
                                        (hdata.data.Host[i].HostIP+'('+HostName_h+')').split('').map(function (params) {
                                            return '<font>'+params+'</font>'    
                                        }).join('') +
                                        '</span>'+'</span><span class="authtype" style="display:inline-block">'+$auth+'</span><ul style="display:none">Loading...</ul>');
										break;
									case 1:
										$H.html('<i class="'+i_class+'" data-id="arrH-'+hdata.data.Host[i].HostId+'" /><input type="checkbox" id="nodeh-'+parent_id+'-'+hdata.data.Host[i].HostId+'" data-check="2" class="zcheck zcheck-g" data-ifselect=false data-loadfirst=1 data-loadlast='+hdata.data.Host[i].Selected+' data-mode="'+hdata.data.Host[i].Mode+'" data-name="'+hdata.data.Host[i].HostIP+'\t'+hdata.data.Host[i].HostName+'"><i class="h-eicon h-eicon-u" class="zcheck"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+hdata.data.Host[i].HostId+'">'+'<span class="h-name-son" style="">' + 
                                        (hdata.data.Host[i].HostIP+'('+HostName_h+')').split('').map(function (params) {
                                            return '<font>'+params+'</font>'    
                                        }).join('') +
                                        '</span></span><span class="authtype" style="display:inline-block">'+$auth+'</span><ul style="display:none">Loading...</ul>');
										break;
									case 2:
										$.each(last_object,function(i1,item1){
											if((item1.HostId == hdata.data.Host[i].HostId) && (item1.HGId == parseInt(parent_id)) && (item1.AccountId == null) && (item1.HostServiceId == null)){
												$auth = '<label><input type="checkbox" name="check'+hdata.data.Host[i].HostId+'" checked="checked" data-ifselect=true data-mode="'+hdata.data.Host[i].Mode+'" >主机授权</label>';
												return false;
											}
										})
										$H.html('<i class="'+i_class+'" data-id="arrH-'+hdata.data.Host[i].HostId+'" /><input type="checkbox" checked="checked" id="nodeh-'+parent_id+'-'+hdata.data.Host[i].HostId+'" data-check="1" class="zcheck zcheck-g" data-ifselect=false data-loadfirst=2 data-loadlast='+hdata.data.Host[i].Selected+' data-mode="'+hdata.data.Host[i].Mode+'" data-name="'+hdata.data.Host[i].HostIP+'\t'+hdata.data.Host[i].HostName+'"><i class="h-eicon h-eicon-u" class="zcheck"></i><span class="h-name" style="width: 16em;" id="spanh-'+parent_id+'-'+hdata.data.Host[i].HostId+'">'+'<span class="h-name-son" style="">' + 
                                        (hdata.data.Host[i].HostIP+'('+HostName_h+')').split('').map(function (params) {
                                            return '<font>'+params+'</font>'    
                                        }).join('') +
                                        '</span></span><span class="authtype" style="display:inline-block">'+$auth+'</span><ul style="display:none">Loading...</ul>');
										break;
								}
							}
							
						}
						if(editid > 0){
						
							if (auth_type_checked){
							
							}else{
								if(push_hid.indexOf(parent_id + ':' + hdata.data.Host[i].HostId + ":false") <0){
									if(ajax_find_host_doing==false){
										push_hid.push(parent_id + ':' + hdata.data.Host[i].HostId + ":false");
									}
									
								}
							}
						}
						$(obj).append($H);
						_checkView1($('#nodeh-' + parent_id + '-' + hdata.data.Host[i].HostId));
					});
					if(flag_save == 0){
						_closeLoading();
					}
					var _ajax_find_host_doing=ajax_find_host_doing;
					select_checkbox("Host",parent_id,_ajax_find_host_doing);
					flag_loading = false;
				}
			});
		}
		
		var atr = null;
		var atr_flag = 0;
		///// 绑定 主机组状态
		function select_checkbox(select_flag, pid) {
			if (select_flag == "HGroup") { //主机组 

				var i = 0;
				var index_w = 0;
				var indx = 0;
				var t_doselect;
				var c_count = 1;
				var index_a = 0;
				function _doselect() {
					index_a+=1;
					// clearTimeout(t_doselect);
					for (i = index_w; i < index_w + 200; i += 1) { //每次只加载一个 根据情况定
						if (i >= push_hgid.length) {
							if (push_hgid.length == 0) {
								clearInterval(if_select);
								return false;
							} else {
								index_w = 0;
								// i = 0;
								// t_doselect = setTimeout(function () { _doselect(); }, 1);
								return false;
							}
						}
						var PGetHNodeSelected_json = {
							"type": 5,
							"id": editid,
							"ishost": false,
							"hnodeset": new Array()
						}
						for (var m = i; m < i + 100; m++) {
							if (m >= push_hgid.length) {
								break;
							}
							var hg_id = push_hgid[m].split(":")[0];
							var falg_sec = push_hgid[m].split(":")[1];
							var $hg_pinput = $("#nodehg-" + hg_id).parent().parent().siblings('input');
							var hg_pid = 0;
							if ($hg_pinput.length != 0) {
								hg_pid = $hg_pinput.attr('id').split('-')[1];
								if (push_hgid.indexOf(hg_id + ':true') >= 0) {
									continue;
								}
								if (push_hgid.indexOf(hg_pid + ':false') >= 0) {
									continue;
								}
								if (push_hgid.indexOf(hg_pid + ':true') >= 0) {
									continue;
								}
							}
							if (falg_sec == 'false') {
								PGetHNodeSelected_json.hnodeset.push(JSON.parse('{"parentid": null,"hid": ' + hg_id + '}'));
								push_hgid[m] = hg_id + ":" + "true";
							}
						}
						if (PGetHNodeSelected_json.hnodeset.length > 0) {
							$.ajax({
								url: '/bhost/PGetHNodeSelected',
								type: 'post',
								async: true,
								data: { a0: se, z1: JSON.stringify(PGetHNodeSelected_json) },//hg_id
								success: function (result) {
									var result = JSON.parse(result);
									var data = result.info;
									$.each(data, function (i, item) {
										var _currentId = $("#nodehg-" + item.hid);
										var _span_authtype = _currentId.siblings('span.authtype');
										var mode = parseInt(_span_authtype.find('input').attr("data-mode"));
										var p_id;
										if (_currentId.parent().parent().siblings("input").length > 0)
											p_id = _currentId.parent().parent().siblings("input").attr('id').split('-')[1];
										else p_id = 0;
										var if_change_parent = false; //主机组是否改变
										var loadlast = 0;
										var _p_loadfirst = $('#nodehg-' + p_id).attr("data-loadfirst");
										var _p_loadlast = $('#nodehg-' + p_id).attr("data-loadlast");

										if (_p_loadfirst == _p_loadlast) { //没改变
										} else {
											if_change_parent = true;
											loadlast = _p_loadlast;
										}
										var gl_selected = false;
										if (item.selected == 0) {
											_currentId.next('span').attr("class", "checkbox");
											_currentId.prop('checked', false);
											_currentId.attr('data-loadfirst', item.selected);
											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);

										} else if (item.selected == 1) {
											_currentId.next('span').attr("class", "checkbox half");
											_currentId.prop('checked', false);
											_currentId.attr('data-loadfirst', item.selected);
											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);
										} else {
											_currentId.next('span').attr("class", "checkbox checked");
											_currentId.prop('checked', true);
											_currentId.attr('data-loadfirst', item.selected);
											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);

											//判断该主机组是否是 按组授权
											$.each(last_object, function (i1, item1) {
												if (item1.HGId == item.hid) {
													if (item1.AccountId == null && item1.HostId == null && item1.HostServiceId == null) {
														gl_selected = true;
														return false;
													}
												}
											})
											//
										}

										if (gl_selected) {
											_span_authtype.find('input').attr('data-ifselect', true);
											_currentId.attr('data-ifselect', true);
										} else {
											_span_authtype.find('input').attr('data-ifselect', false);
											_currentId.attr('data-ifselect', false);
										}
										//判断是否隐藏按组授权

										if (mode == 0 && item.selected == 0) { //隐藏按组授权
											_span_authtype.children('label').hide();
										} else if (mode == 0 && item.selected == 1) { //隐藏按组授权
											_span_authtype.children('label').hide();
										} else if (mode == 0 && item.selected == 2) {
											if (gl_selected) _span_authtype.children('label').show();
											else _span_authtype.children('label').hide();
										} else if (mode == 2) {
											_span_authtype.children('label').show();
										}

										//如果父节点的状态改变了
										if (if_change_parent == true) {
											if (_p_loadlast == 0) { //1-0 2-0
												_currentId.next('span').attr("class", "checkbox");
												_currentId.prop('checked', false);

												_span_authtype.find('span').attr("class", "checkbox");
												_span_authtype.find('input').prop("checked", false);

												if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == false) {
													_span_authtype.find('input').prop("disabled", false);
													_currentId.prop('disabled', false);
												}
												_currentId.attr('data-loadfirst', item.selected);
												//
												if (_p_loadfirst == 2) _currentId.attr('data-loadfirst', 2);
											} else if (_p_loadlast == 2) {	 // 0-2	 1-2							
												_currentId.prop('checked', true);

												//父节点 按组授权
												if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
													_currentId.prop('disabled', true);//input
													_currentId.next('span').attr("class", "checkbox checked disabled");
													//<<<< 
													_currentId.attr("data-loadlast", "2");
													_span_authtype.find('span').attr('class', "checkbox disabled");
													_span_authtype.find('input').prop('disabled', true);

												} else { // 1-0 1-2
													_currentId.prop('disabled', false);//input
													_currentId.next('span').attr("class", "checkbox checked");
													_currentId.attr("data-loadlast", "2");
													if (gl_selected) {
														_span_authtype.find('span').attr('class', "checkbox checked");
														_span_authtype.find('input').prop('checked', true).prop('disabled', false);
													} else {
														_span_authtype.find('input').prop('disabled', false);
														_span_authtype.find('span').attr('class', 'checkbox');
													}
												}
											}
										} else {
											//父节点 按组授权
											if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
												_currentId.prop('disabled', true);//input
												_currentId.prop('checked', true);
												_currentId.next('span').attr("class", "checkbox checked disabled");

												if (_p_loadlast == 2) {
													_currentId.attr("data-loadlast", "2");
												}

												if (gl_selected) {
													_span_authtype.find('span').attr('class', "checkbox checked disabled");
													_currentId.siblings('span.authtype').find('input').prop('checked', true).prop('disabled', true);
												} else {
													_span_authtype.find('input').prop('disabled', true);
													_span_authtype.find('span').attr('class', 'checkbox disabled');
												}
											} else {
												_currentId.attr('disabled', false);//input
												_currentId.next('span').removeClass("disabled");

												if (_p_loadlast == 2) {
													_currentId.prop('checked', true);
													_currentId.attr("data-loadlast", "2");
													_currentId.next('span').attr("class", "checkbox checked");
													_currentId.attr("data-loadfirst", "2");
												}
												if (gl_selected) {
													_span_authtype.find('span').attr('class', "checkbox checked");
													_span_authtype.find('input').prop('checked', true).prop('disabled', false);
												} else {
													_span_authtype.find('input').prop('disabled', false);
													_span_authtype.find('span').attr('class', 'checkbox');
												}
											}
										}
										if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('disabled')) {
											_currentId.prop('checked', true);
											_currentId.prop('disabled', true);//input
											_currentId.next('span').attr("class", "checkbox checked disabled");
											//<<<< 
											_span_authtype.find('span').addClass("disabled");
											_span_authtype.find('input').prop('disabled', true);
										}
										//触发change

										var ind = push_hgid.indexOf(item.hid + ":" + "true");
										if (ind != -1) {
											push_hgid.splice(ind, 1);
											i = 0;
										}
									});
									// index_w = i;
									// t_doselect = setTimeout(function () { _doselect(); }, 1);
								},
								error: function (XmlHttpRequest, textStatus, errorThrown) {
									// var ind = push_hgid.indexOf(hg_id + ":" + "true");
									// if (ind >= 0) {
									// 	push_hgid.splice(ind, 1);
									// 	push_hgid.push(hg_id + ":" + "false");
									// }
									// index_w = i;
									// t_doselect = setTimeout(function () { _doselect(); }, 1);
									return false;
								}
							})
						}
					}
					index_w = i;
				}
				// _doselect();
				var if_select = setInterval(function(){
					if (push_hgid.length == 0){  //
						clearInterval(if_select);
						return false;
					}
					var f = false;
					$.each(push_hgid,function(i1,item1){
						if(item1.split(':')[1] == "false"){
							f = true;
						}	
					})
					if(f ==false){
						clearInterval(if_select);
						return false;
						
					}
					_doselect();
					if(Date.parse(new Date())/1000 - global_time >=1)
						setTimeout("get_msg()", 100);	
				},10);
			}
			else if (select_flag == "Host") { //主机
				var i = 0;
				var index_w = 0;
				var indx = 0;
				var t_doselect1;
				var c_count = 700; 
				function _doselect1() {
					clearTimeout(t_doselect1);
					for (i = index_w; i < index_w + 20; i += 1) { //每次只加载一个 根据情况定
						if (i >= push_hid.length) {
							if (push_hid.length == 0) {
								return false;
							} else {
								index_w = 0;
								i = 0;
								t_doselect1 = setTimeout(function () { _doselect1(); }, 1);
								return false;
							}
						}
						var PGetHNodeSelected_json = {
							"type": 5,
							"id": editid,
							"ishost": true,
							"hnodeset": new Array()
						}
						for (var m = i; m < i + 5; m++) {
							if (m >= push_hid.length) {
								break;
							}
							var pid_h = push_hid[m].split(":")[0];
							var h_id = push_hid[m].split(":")[1];
							var falg_sec = push_hid[m].split(":")[2];
							if (push_hid.indexOf(pid_h + ':' + h_id + ":" + "true") >= 0) {
								continue;
							}
							if (push_hgid.indexOf(pid_h + ':false') >= 0) {
								continue;
							}
							if (push_hgid.indexOf(pid_h + ':true') >= 0) {
								continue;
							}
							if (falg_sec == 'false') {
								PGetHNodeSelected_json.hnodeset.push(JSON.parse('{"parentid": ' + pid_h + ',"hid": ' + h_id + '}'));
								push_hid[m] = pid_h + ':' + h_id + ":" + "true";
							}
						}
						if (PGetHNodeSelected_json.hnodeset.length > 0) {
							atr = $.ajax({
								url: '/bhost/PGetHNodeSelected',
								type: 'post',
								async: true,
								data: { a0: se, z1: JSON.stringify(PGetHNodeSelected_json) },//hg_id
								success: function (result) {
									var result = JSON.parse(result);
									var data = result.info;
									$.each(data, function (i, item) {
										var p_id = item.parentid;//当前组所在的父组id
										_currentId = $("#nodeh-" + p_id + '-' + item.hid);//当前id
										atr_flag = 1;
										if (_currentId.length == 0) {
											return false;
										}
										var _span_authtype = _currentId.siblings('span.authtype');//当前按组授权
										var li_currentId = _currentId.parent();
										var mode = parseInt(_span_authtype.find('input').attr("data-mode"));
										var if_change_parent = false; //主机组是否改变
										var loadlast = 0;
										var _p_loadfirst = $('#nodehg-' + p_id).attr("data-loadfirst");
										var _p_loadlast = $('#nodehg-' + p_id).attr("data-loadlast");
										if (_p_loadfirst == _p_loadlast) { //没改变

										} else {
											if_change_parent = true;
											loadlast = _p_loadlast;
										}

										//绑定 data-loadfirst状态 和 data-loadlast
										var gl_selected = false;
										if (item.selected == 0) {
											_currentId.next('span').attr("class", "checkbox");
											_currentId.prop('checked', false);
											_currentId.attr('data-loadfirst', item.selected);

											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);
										} else if (item.selected == 1) {
											_currentId.next('span').attr("class", "checkbox half");
											_currentId.prop('checked', false);
											_currentId.attr('data-loadfirst', item.selected);

											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);

										} else {
											_currentId.next('span').attr("class", "checkbox checked");
											_currentId.prop('checked', true);
											_currentId.attr('data-loadfirst', item.selected);

											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);
											//
											$.each(last_object, function (i1, item1) {
												if (item1.HostId == item.hid && item1.HGId == p_id && item1.AccountId == null && item1.HostServiceId == null) {
													gl_selected = true;
													return false;
												}
											})
										}
										//绑定是否按组授权状态
										if (gl_selected) {
											_span_authtype.find('input').attr('data-ifselect', true);
											_currentId.attr('data-ifselect', true);
										} else {
											_span_authtype.find('input').attr('data-ifselect', false);
											_currentId.attr('data-ifselect', false);
										}
										//判断是否隐藏主机 因为存在 当前用户的管理权限 加了这个
										if (tmp_list == null) {
											if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
												if (mode != 0 || item.selected != 0) {
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else {
													li_currentId.parent('li').remove();
												}
											} else {
												if (mode == 0 && item.selected == 0) { //隐藏主机
													li_currentId.hide();
												} else if (mode == 0 && item.selected == 1) { //隐藏主机
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else if (mode == 0 && item.selected == 2) {
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else if (mode == 2) {
													li_currentId.show();
												}
											}
										} else {
											li_currentId.hide();
											if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
												if (mode != 0 || item.selected != 0) {
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else {
													li_currentId.parent('li').remove();
												}
											} else {
												if (mode == 0 && item.selected == 0) { //隐藏主机
													li_currentId.parent('li').remove();
												} else if (mode == 0 && item.selected == 1) { //隐藏主机
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else if (mode == 0 && item.selected == 2) {
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else if (mode == 2) {
													li_currentId.show();
												}
											}
										}

										//查看 父节点 是否是 1、全选还是空 2、是否按组授权 勾选 / disabled
										if (if_change_parent) {
											if (_p_loadlast == 0) {
												_currentId.next('span').attr("class", "checkbox");
												_currentId.prop('checked', false);
												_span_authtype.find('span').attr("class", "checkbox");
												_span_authtype.find('input').prop("checked", false);
												if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == false) {
													_span_authtype.find('input').prop("disabled", false);
													_currentId.prop('disabled', false);
												}
												if (_p_loadfirst == 2) _currentId.attr('data-loadfirst', 2);
											} else if (_p_loadlast == 2) {
												_currentId.prop('checked', true);

												//父节点 按组授权
												if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
													_currentId.prop('disabled', true);//input
													_currentId.next('span').attr("class", "checkbox checked disabled");
													_currentId.attr("data-loadlast", "2");
													_span_authtype.find('input').prop('disabled', true);
													_span_authtype.find('span').attr('class', 'checkbox disabled');

												} else {
													_currentId.prop('disabled', false);//input
													_currentId.next('span').attr("class", "checkbox checked");
													_currentId.attr("data-loadlast", "2");
													//_span_authtype.find('input').prop('disabled',false);
													//_span_authtype.find('span').attr('class','checkbox');
													if (gl_selected) {
														_span_authtype.find('span').attr('class', "checkbox checked");
														_span_authtype.find('input').prop('checked', true).prop('disabled', false);
													} else {
														_span_authtype.find('input').prop('disabled', false);
														_span_authtype.find('span').attr('class', 'checkbox');
													}
												}
											}
										} else {
											//父节点 按组授权
											if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
												_currentId.prop('disabled', true);//input
												_currentId.next('span').attr("class", "checkbox checked disabled");
												if (_p_loadlast == 2) {
													_currentId.prop('checked', true);
													_currentId.attr("data-loadlast", "2");
												}
												if (gl_selected) {
													_span_authtype.find('span').attr('class', "checkbox checked disabled");
													_span_authtype.find('input').prop('checked', true).prop('disabled', true);
												} else {
													_span_authtype.find('input').prop('disabled', true);
													_span_authtype.find('span').attr('class', 'checkbox disabled');
												}

											} else {
												_currentId.prop('disabled', false);//input
												_currentId.next('span').removeClass("disabled");
												if (_p_loadlast == 2) {
													_currentId.prop('checked', true);
													_currentId.next('span').attr("class", "checkbox checked");
													_currentId.attr("data-loadlast", "2");
													_currentId.attr("data-loadfirst", "2");
												}
												if (gl_selected) {
													_span_authtype.find('span').attr('class', "checkbox checked");
													_span_authtype.find('input').prop('checked', true).prop('disabled', false);
												} else {
													_span_authtype.find('input').prop('disabled', false);
													_span_authtype.find('span').attr('class', 'checkbox');
												}

											}
										}
										//发现父主机组是disabled
										if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('disabled')) {
											_currentId.prop('checked', true);
											_currentId.prop('disabled', true);//input
											_currentId.next('span').attr("class", "checkbox checked disabled");
											//<<<< 
											_span_authtype.find('span').addClass("disabled");
											_span_authtype.find('input').prop('disabled', true);
										}

										var ind = push_hid.indexOf(p_id + ':' + item.hid + ":" + "true");
										if (ind != -1) {
											push_hid.splice(ind, 1);
											i = 0;
										}
									});
									// index_w = i;
									// t_doselect1 = setTimeout(function () { _doselect1(); }, 1);
								},
								error: function (XmlHttpRequest, textStatus, errorThrown) {
									// index_w = i;
									// t_doselect1 = setTimeout(function () { _doselect1(); }, 1);
									return false;
								}
							});
						}
					}
					index_w = i;
				}
				// _doselect1();
				var if_select1 = setInterval(function () {
					if (push_hid.length == 0) {  //
						clearInterval(if_select1);
						return false;
					}
						var ff = false;
						$.each(push_hid,function(i1,item1){
							if(item1.split(':')[2] == "false"){
								ff = true;
							}	
						})
						if(ff ==false){
							clearInterval(if_select1);
							return false;
							
						}

					_doselect1();
					setTimeout("get_msg()", 100);	
				}, 10);
			}
			else if(select_flag == "UGroup"){ //用户组
			var i = 0;
			var index_w = 0;
			var indx = 0;
			function _doselect() {
				for (i = index_w; i < index_w + 15; i+=5) { //每次只加载5个 根据情况定
					if (i >= ugtreelist.length) {
						if (ugtreelist.length == 0) {
							clearInterval(if_select);
							return false;
						} else {
							index_w = 0;
							return false;
						}
					}
					var PGetHNodeSelected_json={
						"type":6,
						"id":editid,
						"isuser": false,
						"unodeset": new Array()
					}
					for(var m=i;m<i+5;m++){
						if(m>=ugtreelist.length){
							break;
						}
						var uid = ugtreelist[m].split(":")[0];
						var falg_sec = ugtreelist[m].split(":")[1];
						var $hg_pinput = $("#nodeug-"+uid).parent().parent().siblings('input');
						var hg_pid = 0;
						if ($hg_pinput.length != 0){
							hg_pid = $hg_pinput.attr('id').split('-')[1];
							if(ugtreelist.indexOf(uid + ':true')>=0){
								continue;
							}
							if(ugtreelist.indexOf(hg_pid + ':false')>=0){
								continue;
							}
							if(ugtreelist.indexOf(hg_pid + ':true')>=0){
								continue;
							}
						}
						if(falg_sec == 'false'){
							PGetHNodeSelected_json.unodeset.push(JSON.parse('{"uid": '+uid+'}'));
							ugtreelist[m] = uid + ":" + "true";
						}
					}
					if(PGetHNodeSelected_json.unodeset.length>0){
						//ugtreelist[i] = hg_id + ":" + "true";
						$.ajax({
							url: '/bhost/PGetUNodeSelected',
							type: 'post',
							async: true,
							data:{a0:se,z1:JSON.stringify(PGetHNodeSelected_json)},//hg_id
							success: function (result) {
								var result = JSON.parse(result);
								var data = result.info;
								$.each(data,function (i,item) {
									var _currentId = $("#nodeug-" + item.uid);
									var _span_authtype = _currentId.siblings('span.authtype');
									var mode = parseInt(_span_authtype.find('input').attr("data-mode"));
									//
									var p_id;
									if (_currentId.parent().parent().siblings("input").length > 0)
										p_id = _currentId.parent().parent().siblings("input").attr('id').split('-')[1];
									else p_id = 0;
									var if_change_parent = false; //主机组是否改变
									var loadlast = 0;
									var gl_selected = false;
									if (item.selected == 0) {
										_currentId.next('span').attr("class", "checkbox");
										_currentId.prop('checked', false);

									} else if (item.selected == 1) {
										_currentId.next('span').attr("class", "checkbox half");
										_currentId.prop('checked', false);
									} else {
										_currentId.next('span').attr("class", "checkbox checked");
										_currentId.prop('checked', true);
										//判断该组是否是 按组授权
										$.each(last_user_set, function (i1, item1) {
											if (item1.Id == item.uid && item1.Type == 2) {
												gl_selected = true;
												return false;
											}
										})
										//
									}

									//父节点 按组授权
									if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
										_currentId.prop('disabled', true);//input
										_currentId.prop('checked', true);
										_currentId.next('span').attr("class", "checkbox checked disabled");

											if (gl_selected) {
												_span_authtype.find('span').attr('class', "checkbox checked disabled");
												_currentId.siblings('span.authtype').find('input').prop('checked', true).prop('disabled', true);
											} else {
												_span_authtype.find('input').prop('disabled', true);
												_span_authtype.find('span').attr('class', 'checkbox disabled');
											}
										} else {
											_currentId.attr('disabled', false);//input
											_currentId.next('span').removeClass("disabled");
										if (gl_selected) {
											_span_authtype.find('span').attr('class', "checkbox checked");
											_span_authtype.find('input').prop('checked', true).prop('disabled', false);
										} else {
											_span_authtype.find('input').prop('disabled', false);
											_span_authtype.find('span').attr('class', 'checkbox');
										}
									}
									if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('disabled')) {
										_currentId.prop('checked', true);
										_currentId.prop('disabled', true);//input
										_currentId.next('span').attr("class", "checkbox checked disabled");
										//<<<< 
										_span_authtype.find('span').addClass("disabled");
										_span_authtype.find('input').prop('disabled', true);
									}

									var ind = ugtreelist.indexOf(item.uid + ":" + "true");
									if (ind != -1) {
										ugtreelist.splice(ind, 1);
										i = 0;
									}
								});
							},
							error: function (XmlHttpRequest, textStatus, errorThrown) {
								var ind = ugtreelist.indexOf(uid + ":" + "true");
								if (ind >= 0) {
									ugtreelist.splice(ind, 1);
									ugtreelist.push(uid + ":" + "false");
								}
								return false;
							}
						});
					}
				}
				index_w = i;
			}
			var if_select = setInterval(function(){
				if (ugtreelist.length == 0){  //
					clearInterval(if_select);
					return false;
				}
				_doselect();	
			},10);
		}
			else if (select_flag == "User") { //用户
			$.each($("#spanUG-"+pid).siblings('ul').find("input.zcheck"),function(i,item){
				var host_id_tmp = $(item).attr('id').split('-')[2];
				$.each(utreelist,function (i1,item1) {
					if (item1.split(':')[0] == host_id_tmp) {
						_currentId = $("#nodeu-" + pid + '-' + host_id_tmp);//当前id
						//绑定 data-loadfirst状态 和 data-loadlast
						var gl_selected = false;
						var if_change_parent = false;
						_currentId.next('span').attr("class", "checkbox checked");
						_currentId.prop('checked', true);
						
						//父节点 按组授权
						if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
							_currentId.prop('disabled', true);//input
							_currentId.prop('checked', true);
							_currentId.next('span').attr("class", "checkbox checked disabled");
						} else {
							_currentId.attr('disabled', false);//input
							_currentId.next('span').removeClass("disabled");
						}
						//发现父主机组是disabled
						if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('disabled')) {
							_currentId.prop('checked', true);
							_currentId.prop('disabled', true);//input
							_currentId.next('span').attr("class", "checkbox checked disabled");
						}
					}
				});
			})
		}
		}


		///// 绑定 主机组状态
		function select_checkbox_s(select_flag, pid) {
			if (select_flag == "HGroup") { //主机组 
				var i = 0;
				var index_w = 0;
				var indx = 0;
				var t_doselect;
				var c_count = 1;
				var index_a = 0;
				function _doselect() {
					index_a+=1;
					// clearTimeout(t_doselect);
					for (i = index_w; i < index_w + 200; i += 1) { //每次只加载一个 根据情况定
						if (push_hgid_s.length == 0 && init_tree == 0) {
							init_tree = 1;
							if(flag_save == 0){
								_closeLoading();
							}
						}
						if (i >= push_hgid_s.length) {
							if (push_hgid_s.length == 0) {
								if (init_tree == 0) {
									init_tree = 1;
									_closeLoading();
								}
								clearInterval(if_select);
								return false;
							} else {
								index_w = 0;
								// t_doselect = setTimeout(function () { _doselect(); }, 1);
								return false;
							}
						}
						var PGetHNodeSelected_json = {
							"type": 1,
							"id": serverId,
							"ishost": false,
							"hnodeset": new Array()
						}
						for (var m = i; m < i + 100; m++) {
							if (m >= push_hgid_s.length) {
								break;
							}
							var hg_id = push_hgid_s[m].split(":")[0];
							var falg_sec = push_hgid_s[m].split(":")[1];
							var $hg_pinput = $("#nodehg-" + hg_id).parent().parent().siblings('input');
							var hg_pid = 0;
							if ($hg_pinput.length != 0) {
								hg_pid = $hg_pinput.attr('id').split('-')[1];
								if (push_hgid_s.indexOf(hg_id + ':true') >= 0) {
									continue;
								}
								if (push_hgid_s.indexOf(hg_pid + ':false') >= 0) {
									continue;
								}
								if (push_hgid_s.indexOf(hg_pid + ':true') >= 0) {
									continue;
								}
							}
							if (falg_sec == 'false') {
								PGetHNodeSelected_json.hnodeset.push(JSON.parse('{"parentid": null,"hid": ' + hg_id + '}'));
								push_hgid_s[m] = hg_id + ":" + "true";
							}
						}
						if (PGetHNodeSelected_json.hnodeset.length > 0) {
							$.ajax({
								url: '/bhost/PGetHNodeSelected',
								type: 'post',
								async: true,
								cache: false,
								data: { a0: se, z1: JSON.stringify(PGetHNodeSelected_json) },//hg_id
								success: function (result) {
									var result = JSON.parse(result);
									var data = result.info;
									$.each(data, function (i, item) {
										var _currentId = $("#HGId-" + item.hid);
										var _span_authtype = _currentId.siblings('span.authtype');
										var mode = parseInt(_span_authtype.find('input').attr("data-mode"));
										//
										if (_currentId.parent().parent().siblings("input").length > 0)
											p_id = _currentId.parent().parent().siblings("input").attr('id').split('-')[1];
										else p_id = 0;
										var if_change_parent = false; //主机组是否改变
										var loadlast = 0;
										var _p_loadfirst = $('#HGId-' + p_id).attr("data-loadfirst");
										var _p_loadlast = $('#HGId-' + p_id).attr("data-loadlast");

										if (_p_loadfirst == _p_loadlast) { //没改变		
										} else {
											if_change_parent = true;
											loadlast = _p_loadlast;
										}
										var gl_selected = false;
										if (item.selected == 0) {
											_currentId.next('span').attr("class", "checkbox");
											_currentId.prop('checked', false);
											_currentId.attr('data-loadfirst', item.selected);
											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);

										} else if (item.selected == 1) {
											_currentId.next('span').attr("class", "checkbox half");
											_currentId.prop('checked', false);
											_currentId.attr('data-loadfirst', item.selected);
											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);
										} else {
											_currentId.next('span').attr("class", "checkbox checked");
											_currentId.prop('checked', true);
											_currentId.attr('data-loadfirst', item.selected);
											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);

											//判断该主机组是否是 按组授权
											$.each(last_object_s, function (i1, item1) {
												if (item1.HGId == item.hid) {
													if (item1.HostId == null) {
														gl_selected = true;
														return false;
													}
												}
											})
											//
										}
										if (gl_selected) {
											_span_authtype.find('input').attr('data-ifselect', true);
											_currentId.attr('data-ifselect', true);
										} else {
											_span_authtype.find('input').attr('data-ifselect', false);
											_currentId.attr('data-ifselect', false);
										}
										//判断是否隐藏按组授权

										if (mode == 0 && item.selected == 0) { //隐藏按组授权
											_span_authtype.children('label').hide();
										} else if (mode == 0 && item.selected == 1) { //隐藏按组授权
											_span_authtype.children('label').hide();
										} else if (mode == 0 && item.selected == 2) {
											if (gl_selected) _span_authtype.children('label').show();
											else _span_authtype.children('label').hide();
										} else if (mode == 2) {
											_span_authtype.children('label').show();
										}
										//如果父节点的状态改变了
										if (if_change_parent == true) {
											if (_p_loadlast == 0) { //1-0 2-0
												_currentId.next('span').attr("class", "checkbox");
												_currentId.prop('checked', false);
												_span_authtype.find('span').attr("class", "checkbox");
												_span_authtype.find('input').prop("checked", false);
												if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == false) {
													_span_authtype.find('input').prop("disabled", false);
													_currentId.prop('disabled', false);
												}
												_currentId.attr('data-loadfirst', item.selected);
												if (_p_loadfirst == 2) _currentId.attr('data-loadfirst', 2);
											} else if (_p_loadlast == 2) {	 // 0-2	 1-2							
												_currentId.prop('checked', true);

												//父节点 按组授权
												if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
													_currentId.attr('disabled', true);//input
													_currentId.next('span').attr("class", "checkbox checked disabled");
													//<<<< 
													_currentId.attr("data-loadlast", "2");
													_span_authtype.find('span').attr('class', "checkbox disabled");
													_span_authtype.find('input').attr('checked', true).attr('disabled', true);

												} else { // 1-0 1-2
													_currentId.attr('disabled', false);//input
													_currentId.next('span').attr("class", "checkbox checked");
													_currentId.attr("data-loadlast", "2");

													if (gl_selected) {
														_span_authtype.find('span').attr('class', "checkbox checked");
														_span_authtype.find('input').prop('checked', true).prop('disabled', false);
													} else {
														_span_authtype.find('input').prop('disabled', false);
														_span_authtype.find('span').attr('class', 'checkbox');
													}
												}
											}
										} else {
											//父节点 按组授权
											if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
												_currentId.attr('disabled', true);//input
												_currentId.prop('checked', true);
												_currentId.next('span').attr("class", "checkbox checked disabled");

												if (_p_loadlast == 2) {
													_currentId.attr("data-loadlast", "2");
												}
												if (gl_selected) {
													_span_authtype.find('span').attr('class', "checkbox checked disabled");
													_currentId.siblings('span.authtype').find('input').attr('checked', true).attr('disabled', true);
												} else {
													_span_authtype.find('input').attr('disabled', true);
													_span_authtype.find('span').attr('class', 'checkbox disabled');
												}
											} else {
												_currentId.attr('disabled', false);//input
												_currentId.next('span').removeClass("disabled");
												if (_p_loadlast == 2) {
													_currentId.prop('checked', true);
													_currentId.attr("data-loadlast", "2");
													_currentId.next('span').attr("class", "checkbox checked");
													_currentId.attr("data-loadfirst", "2");
												}

												if (gl_selected) {
													_span_authtype.find('span').attr('class', "checkbox checked");
													_span_authtype.find('input').attr('checked', true).attr('disabled', false);
												} else {
													_span_authtype.find('input').attr('disabled', false);
													_span_authtype.find('span').attr('class', 'checkbox');
												}
											}
										}
										if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('disabled')) {
											_currentId.prop('checked', true);
											_currentId.prop('disabled', true);//input
											_currentId.next('span').attr("class", "checkbox checked disabled");
											//<<<< 
											_span_authtype.find('span').addClass("disabled");
											_span_authtype.find('input').prop('disabled', true);
										}
										//
										ind = push_hgid_s.indexOf(item.hid + ":" + "true");
										if (ind != -1) {
											push_hgid_s.splice(ind, 1);
											i = 0;
										}
									});
									// index_w = i;
									// t_doselect = setTimeout(function () { _doselect(); }, 1);
								},
								error: function (XmlHttpRequest, textStatus, errorThrown) {
									// ind = push_hgid_s.indexOf(hg_id + ":" + "true");
									// if (ind >= 0) {
									// 	push_hgid_s.splice(ind, 1);
									// 	push_hgid_s.push(hg_id + ":" + "false");
									// }
									// index_w = i;
									// t_doselect = setTimeout(function () { _doselect(); }, 1);
									return false;
								}
							})
						}
					}
					index_w = i;
				}
				// _doselect();
				var if_select = setInterval(function(){
					if (push_hgid_s.length == 0){  //
						if (init_tree == 0) {
							init_tree = 1;
							_closeLoading();
						}
						clearInterval(if_select);
						return false;
					}
					var f = false;
					$.each(push_hgid_s,function(i1,item1){
						if(item1.split(':')[1] == "false"){
							f = true;
						}	
					})
					if(f ==false){
						if (init_tree == 0) {
							init_tree = 1;
							_closeLoading();
						}
						clearInterval(if_select);
						return false;
						
					}
					_doselect();
					if(Date.parse(new Date())/1000 - global_time >=1)
						setTimeout("get_msg()", 100);	
				},10);
			}
			else if (select_flag == "Host") { //主机
				var i = 0;
				var index_w = 0;
				var indx = 0;
				var t_doselect1;
				var c_count = 700; 
				function _doselect1() {
					clearTimeout(t_doselect1);
					for (i = index_w; i < index_w + 20; i += 1) { //每次只加载一个 根据情况定
						if (i >= push_hid_s.length) {
							if (push_hid_s.length == 0) {
								return false;
							} else {
								index_w = 0;
								i = 0;
								t_doselect1 = setTimeout(function () { _doselect1(); }, 1);
								return false;
							}
						}
						var PGetHNodeSelected_json = {
							"type": 1,
							"id": serverId,
							"ishost": true,
							"hnodeset": new Array()
						}
						for (var m = i; m < i + 5; m++) {
							if (m >= push_hid_s.length) {
								break;
							}
							var pid_h = push_hid_s[m].split(":")[0];
							var h_id = push_hid_s[m].split(":")[1];
							var falg_sec = push_hid_s[m].split(":")[2];
							if (push_hid_s.indexOf(pid_h + ':' + h_id + ":" + "true") >= 0) {
								continue;
							}
							if (push_hid_s.indexOf(pid_h + ':false') >= 0) {
								continue;
							}
							if (push_hid_s.indexOf(pid_h + ':true') >= 0) {
								continue;
							}
							if (falg_sec == 'false') {
								PGetHNodeSelected_json.hnodeset.push(JSON.parse('{"parentid": ' + pid_h + ',"hid": ' + h_id + '}'));
								push_hid_s[m] = pid_h + ':' + h_id + ":" + "true";
							}
						}
						if (PGetHNodeSelected_json.hnodeset.length > 0) {
							atr = $.ajax({
								url: '/bhost/PGetHNodeSelected',
								type: 'post',
								async: true,
								data: { a0: se, z1: JSON.stringify(PGetHNodeSelected_json) },//hg_id
								success: function (result) {
									var result = JSON.parse(result);
									var data = result.info;
									$.each(data, function (i, item) {
										var p_id = item.parentid;//当前组所在的父组id
										_currentId = $("#HostId-" + p_id + '-' + item.hid);//当前id
										atr_flag = 1;
										if (_currentId.length == 0) {
											return false;
										}
										var _span_authtype = _currentId.siblings('span.authtype');//当前按组授权
										var li_currentId = _currentId.parent();
										var mode = parseInt(_span_authtype.find('input').attr("data-mode"));
										//
										//p_id = data.pid;//当前组所在的父组id
										var if_change_parent = false; //主机组是否改变
										var loadlast = 0;
										var _p_loadfirst = $('#HGId-' + p_id).attr("data-loadfirst");
										var _p_loadlast = $('#HGId-' + p_id).attr("data-loadlast");
										if (_p_loadfirst == _p_loadlast) { //没改变		
										} else {
											if_change_parent = true;
											loadlast = _p_loadlast;
										}

										//绑定 data-loadfirst状态 和 data-loadlast
										var gl_selected = false;
										if (item.selected == 0) {
											_currentId.next('span').attr("class", "checkbox");
											_currentId.prop('checked', false);
											_currentId.attr('data-loadfirst', item.selected);

											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);
										} else if (item.selected == 1) {
											_currentId.next('span').attr("class", "checkbox half");
											_currentId.prop('checked', false);
											_currentId.attr('data-loadfirst', item.selected);

											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);

										} else {
											_currentId.next('span').attr("class", "checkbox checked");
											_currentId.prop('checked', true);
											_currentId.attr('data-loadfirst', item.selected);

											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);
											//
											$.each(last_object_s, function (i1, item1) {
												if (item1.HostId == item.hid && item1.HGId == p_id) {
													gl_selected = true;
													return false;
												}
											})
										}
										//绑定是否按组授权状态
										if (gl_selected) {
											_span_authtype.find('input').attr('data-ifselect', true);
											_currentId.attr('data-ifselect', true);
										} else {
											_span_authtype.find('input').attr('data-ifselect', false);
											_currentId.attr('data-ifselect', false);
										}
										//判断是否隐藏主机 因为存在 当前用户的管理权限 加了这个
										if (tmp_list_s == null) {
											if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
												//li_currentId.show();
												if (mode != 0 || item.selected != 0) {
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else {
													li_currentId.parent('li').remove();
												}
											} else {
												if (mode == 0 && item.selected == 0) { //隐藏主机
													li_currentId.hide();
												} else if (mode == 0 && item.selected == 1) { //隐藏主机
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else if (mode == 0 && item.selected == 2) {
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else if (mode == 2) {
													li_currentId.show();
												}
											}
										} else {
											li_currentId.hide();
											if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
												if (mode != 0 || item.selected != 0) {
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else {
													li_currentId.parent('li').remove();
												}

											} else {
												if (mode == 0 && item.selected == 0) { //隐藏主机
													li_currentId.parent('li').remove();
												} else if (mode == 0 && item.selected == 1) { //隐藏主机
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else if (mode == 0 && item.selected == 2) {
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else if (mode == 2) {
													li_currentId.show();
												}
											}
										}

										//查看 父节点 是否是 1、全选还是空 2、是否按组授权 勾选 / disabled
										if (if_change_parent) {
											if (_p_loadlast == 0) {
												_currentId.next('span').attr("class", "checkbox");
												_currentId.prop('checked', false);
												_span_authtype.find('span').attr("class", "checkbox");
												_span_authtype.find('input').prop("checked", false);

												if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == false) {
													_span_authtype.find('input').prop("disabled", false);
													_currentId.prop('disabled', false);
												}
												if (_p_loadfirst == 2) _currentId.attr('data-loadfirst', 2);
											} else if (_p_loadlast == 2) {
												_currentId.prop('checked', true);
												//父节点 按组授权
												if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
													_currentId.attr('disabled', true);//input
													_currentId.next('span').attr("class", "checkbox checked disabled");
													_currentId.attr("data-loadlast", "2");
													_span_authtype.find('input').attr('disabled', true);
													_span_authtype.find('span').attr('class', 'checkbox disabled');

												} else {
													_currentId.attr('disabled', false);//input
													_currentId.next('span').attr("class", "checkbox checked");
													_currentId.attr("data-loadlast", "2");
													if (gl_selected) {
														_span_authtype.find('span').attr('class', "checkbox checked");
														_span_authtype.find('input').prop('checked', true).prop('disabled', false);
													} else {
														_span_authtype.find('input').prop('disabled', false);
														_span_authtype.find('span').attr('class', 'checkbox');
													}
												}
											}
										} else {
											//父节点 按组授权
											if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
												_currentId.attr('disabled', true);//input
												_currentId.prop('checked', true);
												_currentId.next('span').attr("class", "checkbox checked disabled");
												if (_p_loadlast == 2) {
													_currentId.prop('checked', true);
													_currentId.attr("data-loadlast", "2");
												}
												if (gl_selected) {
													_span_authtype.find('span').attr('class', "checkbox checked disabled");
													_span_authtype.find('input').attr('checked', true).attr('disabled', true);
												} else {
													_span_authtype.find('input').attr('disabled', true);
													_span_authtype.find('span').attr('class', 'checkbox disabled');
												}

											} else {
												_currentId.attr('disabled', false);//input
												_currentId.next('span').removeClass("disabled");
												if (_p_loadlast == 2) {
													_currentId.prop('checked', true);
													_currentId.next('span').attr("class", "checkbox checked");
													_currentId.attr("data-loadlast", "2");
													_currentId.attr("data-loadfirst", "2");
												}
												if (gl_selected) {
													_span_authtype.find('span').attr('class', "checkbox checked");
													_span_authtype.find('input').attr('checked', true).attr('disabled', false);
												} else {
													_span_authtype.find('input').attr('disabled', false);
													_span_authtype.find('span').attr('class', 'checkbox');
												}

											}
										}
										if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('disabled')) {
											_currentId.prop('checked', true);
											_currentId.prop('disabled', true);//input
											_currentId.next('span').attr("class", "checkbox checked disabled");
											//<<<< 
											_span_authtype.find('span').addClass("disabled");
											_span_authtype.find('input').prop('disabled', true);
										}
										var ind = push_hid_s.indexOf(p_id + ':'+item.hid + ":" + "true");
										if (ind != -1) {
											push_hid_s.splice(ind, 1);
											i = 0;
										}
										
									});
									// index_w = i;
									// t_doselect1 = setTimeout(function () { _doselect1(); }, 1);
								},
								error: function (XmlHttpRequest, textStatus, errorThrown) {
									// index_w = i;
									// t_doselect1 = setTimeout(function () { _doselect1(); }, 1);
									return false;
								}
							});
						}
					}
					index_w = i;
				}
				// _doselect1();
				var if_select1 = setInterval(function () {
					
					if (push_hid_s.length == 0) {  //
						clearInterval(if_select1);
						return false;
					}
					var ff = false;
					$.each(push_hid_s,function(i1,item1){
						if(item1.split(':')[2] == "false"){
							ff = true;
						}	
					})
					if(ff ==false){
						clearInterval(if_select1);
						return false;
						
					}

					_doselect1();
					setTimeout("get_msg()", 100);	
				}, 10);
			}
		}



		function _checkView1(obj) {
			_authTypeTheme($(obj).parent().find('span.authtype input'));
			$(obj).each(function () {
				var $s = $('<span class="checkbox"></span>');
				$(this).after($s);
				var v = $(this).prop('checked');
				if (v) {
					$s.addClass('checked');
				} else {
					var c = $(this).data('check');
					if (c && c == 2) {
						$s.addClass('half');
					}
				}

				var d = $(this).prop('disabled');
				if (d) {
					$s.addClass('disabled');
				}
				var span_id = $(this).siblings('span.h-name').attr('id');
				setTimeout(function () {
					if (_jScrollBar_array.indexOf(span_id) === -1){
						_jScrollBar_array.push(span_id);
						_jScrollBar(span_id);
					}
				}, 100);
			}).on('change', function () {
				var v = $(this).prop('checked');
				var $s = $(this).next('span.checkbox');
				var $u = $(this).parent().children('ul');
				var d;
				if ($(this).siblings('span.authtype').find('input').is(':checked')) {
					d = 0;
				} else {
					d = 1;
				}

				if (v) {
					$s.attr('class', 'checkbox checked');
					$('input.zcheck', $u).prop('checked', true);
					$('span.checkbox', $u).attr('class', 'checkbox checked');
					$(this).attr("data-loadlast", "2");
					$(this).siblings('ul').find('input.zcheck').attr('data-loadlast', 2);
				} else {
					$s.attr('class', 'checkbox');
					$('input.zcheck', $u).prop('checked', false).prop('disabled', false);
					$('span.checkbox', $u).attr('class', 'checkbox');
					$(this).siblings('span.authtype').find('input').prop('checked', false);
					$(this).siblings('span.authtype').find('span').attr('class', 'checkbox');
					$(this).siblings('span.authtype').find('span').trigger('change');
					//$u.find('span.authtype').find('input').iCheck('uncheck');	
					$(this).attr("data-loadlast", "0");
					$(this).siblings('ul').find('input.zcheck').attr('data-loadlast', 0);
				}
				/*
				if(d==0){
					$('span.checkbox',$u).addClass('disabled');
				}*/

				_checkEvent(this);
			});
		}


		var ugtreelist = [];
		var utreelist = [];
		function _viewHTML(data, obj, type) {
			$(obj).empty();
			if (type == 1) {
				ugtreelist = [];
				$.each(data.data.UGroup, function (i, item) {
					var $H = $('<li></li>');
					var $auth = '<label><input type="checkbox" name="check' + item.UGId + '">组授权</label>';
					$.each(edit_data, function (i1, item1) {
						if (item1.Id == item.UGId && item1.Type == 2) {
							$auth = '<label><input type="checkbox" name="check' + item.UGId + '" checked="checked">组授权</label>';
							return false;
						}
					})
					if (item.Selected == 0) {
						if (item.UGId == 1) {
							$H.html('<i class="h-aicon" data-id="arru-' + item.UGId + '" /><input type="checkbox" id="nodeug-' + item.UGId + '" data-check="0" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + item.UGName.split('').map(function (params) {
								return '<font>'+params+'</font>'    
							}).join('') + 
							'</span>' + '</span><ul style="display:none">Loading...</ul>');
						} else {
							if (item.MemberNum == 0 && item.UserNum == 0) {
								$H.html('<i class="h-blank" data-id="arru-' + item.UGId + '" /><input type="checkbox" id="nodeug-' + item.UGId + '" data-check="0" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + item.UGName.split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') + 
								'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
							} else {
								$H.html('<i class="h-aicon" data-id="arru-' + item.UGId + '" /><input type="checkbox" id="nodeug-' + item.UGId + '" data-check="0" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + item.UGName.split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') + 
								'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
							}
						}
					} else if (item.Selected == 1) {
						if (item.UGId == 1) {
							$H.html('<i class="h-aicon" data-id="arru-' + item.UGId + '" /><input type="checkbox" id="nodeug-' + item.UGId + '" data-check="2" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + item.UGName.split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') + 
								'</span>' + '</span><ul style="display:none">Loading...</ul>');
						} else {
							if (item.MemberNum == 0 && item.UserNum == 0) {
								$H.html('<i class="h-blank" data-id="arru-' + item.UGId + '" /><input type="checkbox" id="nodeug-' + item.UGId + '" data-check="2" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + item.UGName.split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') + 
								'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
							} else {
								$H.html('<i class="h-aicon" data-id="arru-' + item.UGId + '" /><input type="checkbox" id="nodeug-' + item.UGId + '" data-check="2" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + item.UGName.split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') + 
								'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
							}
						}
					} else {
						if (item.UGId == 1) {
							$H.html('<i class="h-aicon" data-id="arru-' + item.UGId + '" /><input type="checkbox" checked="checked" id="nodeug-' + item.UGId + '" data-check="1" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + item.UGName.split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') + 
								'</span>' + '</span><ul style="display:none">Loading...</ul>');
						} else {
							if (item.MemberNum == 0 && item.UserNum == 0) {
								$H.html('<i class="h-blank" data-id="arru-' + item.UGId + '" /><input type="checkbox" checked="checked" id="nodeug-' + item.UGId + '" data-check="1" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + item.UGName.split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') + 
								'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
							} else {
								$H.html('<i class="h-aicon" data-id="arru-' + item.UGId + '" /><input type="checkbox" checked="checked" id="nodeug-' + item.UGId + '" data-check="1" class="zcheck zcheck-g" data-mode="2" data-name="' + item.UGName + '"><i class="h-eicon h-eicon-s"></i><span class="h-name" id="spanUG-' + item.UGId + '" style="width: 12em;">' + '<span class="h-name-son" style="">' + item.UGName.split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') + 
								'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
							}
						}
					}
					if (editid > 0) {
						ugtreelist.push(item.UGId +':false');
					}
					$(obj).append($H);
					
				});
				_checkView_user(obj);
				if(editid > 0){
					select_checkbox("UGroup");
				}
			} 
			else {
				disabled_flag = "";
				if (editid > 0) disabled_flag = "disabled";
				var $auth = "";
				$.each(data.data.HGroup, function (i, item) {
					if (item.HGId == 1) {
						$auth = '';
					} else if (item.Mode == 2) {
						$auth = '<label><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + ' " >组授权</label>';
					} else {
						$auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + '">组授权</label>';
					}

					var $H = $('<li></li>');
					if ((item.MemberNum + item.HostNum) == 0) i_class = "h-blank";
					else i_class = "h-aicon";
					$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" id="nodehg-' + item.HGId + '" data-check="0" class="zcheck zcheck-g" ' + disabled_flag + ' data-loadfirst=0 data-loadlast=0 data-ifselect=false data-mode="2" data-name="' + item.HGName + '"><i class="h-eicon h-eicon-g" ></i><span class="h-name" id="spanHG-' + item.HGId + '" style="width: 12em;"><span class="h-name-son" style="">' + item.HGName.split('').map(function (params) {
                        return '<font>'+params+'</font>'    
                    }).join('') + 
                    '</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
					$(obj).append($H);
					
				});
				_checkView_host(obj);
				if (editid > 0) {
					select_checkbox("HGroup", 0);	 //只有编辑情况下 才需要判断 select 
				}
			}
		}

		function _checkView_user(obj) {
			_authTypeTheme($('span.authtype input', obj));

			$('input.zcheck', obj).each(function () {
				var $s = $('<span class="checkbox"></span>');
				$(this).after($s);
				var v = $(this).prop('checked');
				if (v) {
					$s.addClass('checked');
				} else {
					var c = $(this).data('check');
					if (c && c == 2) {
						$s.addClass('half');
					}
				}

				var d = $(this).prop('disabled');
				if (d) {
					$s.addClass('disabled');
				}
				var span_id = $(this).siblings('span.h-name').attr('id');
				setTimeout(function () {
					if (_jScrollBar_array.indexOf(span_id) === -1){
						_jScrollBar_array.push(span_id);
						_jScrollBar(span_id);
					}
				}, 100);
			}).on('change', function () {
				var v = $(this).prop('checked');
				var $s = $(this).next('span.checkbox');
				var $u = $(this).parent().children('ul').find('li');
				var $authInput = $(this).siblings('span.authtype').find('input');

				if (v) {
					$s.attr('class', 'checkbox checked');
					$('input.zcheck', $u).prop('checked', true);
					$('span.checkbox:first', $u).attr('class', 'checkbox checked');
					//$u.find('span.authtype').show();
					$u.each(function () {
						if ($(this).children('span.authtype').find('input').prop('checked')) {
							var $u_li = $(this).children('ul').find('li');
							$('input.zcheck', $u_li).prop('disabled', true);
							$('span.checkbox:first', $u_li).addClass('disabled');
						};
					});
				} else {
					$s.attr('class', 'checkbox');
					//$('input.zcheck',$u).prop('checked',false).prop('disabled',false);
					//$('span.checkbox:first',$u).attr('class','checkbox');
					$('input', $u).prop('checked', false).prop('disabled', false);
					$('span.checkbox', $u).attr('class', 'checkbox');

					$authInput.prop('checked', false).trigger('change');
					$(this).siblings('span.authtype').find('span').attr('class', 'checkbox');
				}

				/*
				if(d==0){
					$('span.checkbox',$u).addClass('disabled');
				}
				*/

				_checkEvent(this);
			});
		}

		function _checkView_host(obj) {
			_authTypeTheme($('span.authtype input', obj));
			$('input.zcheck', obj).each(function () {
				//$(obj).find('input.zcheck').each(function(){
				var $s = $('<span class="checkbox"></span>');
				$(this).after($s);
				var v = $(this).prop('checked');
				if (v) {
					$s.addClass('checked');
				} else {
					var c = $(this).data('check');
					if (c && c == 2) {
						$s.addClass('half');
					}
				}

				var d = $(this).prop('disabled');
				if (d) {
					$s.addClass('disabled');
				}
				var span_id = $(this).siblings('span.h-name').attr('id');
				setTimeout(function () {
					if (_jScrollBar_array.indexOf(span_id) === -1){
						_jScrollBar_array.push(span_id);
						_jScrollBar(span_id);
					}
				}, 100);
			}).on('change', function () {
				var v = $(this).prop('checked');
				var $s = $(this).next('span.checkbox');
				var $u = $(this).parent().children('ul').find('li');

				var $authInput = $(this).siblings('span.authtype').find('input');
				if (v) {
					$s.attr('class', 'checkbox checked');
					$('input.zcheck', $u).prop('checked', true);
					$('span.checkbox:first', $u).attr('class', 'checkbox checked');
					//$u.find('span.authtype').show();
					$(this).attr("data-loadlast", 2);
					$('input.zcheck', $u).attr("data-loadlast", 2);
					$u.each(function () {
						if ($(this).children('span.authtype').find('input').prop('checked')) {
							var $u_li = $(this).children('ul').find('li');
							$('input.zcheck', $u_li).prop('disabled', true);
							$('span.checkbox:first', $u_li).addClass('disabled');
						};
					});

				} else {
					$s.attr('class', 'checkbox');
					//$('input.zcheck',$u).prop('checked',false).prop('disabled',false);
					//$('span.checkbox:first',$u).attr('class','checkbox');
					$('input', $u).prop('checked', false).prop('disabled', false);
					$('span.checkbox', $u).attr('class', 'checkbox');
					$(this).attr("data-loadlast", 0);
					$('input.zcheck', $u).attr("data-loadlast", 0);

					$authInput.prop('checked', false).trigger('change');
					$(this).siblings('span.authtype').find('span').attr('class', 'checkbox');
				}
				_checkEvent(this);
			});
		}

		function _authTypeTheme(obj) {
			$.each(obj, function (i, item) {
				var $_item = $(item);
												if ($_item.parent().children('span').length == 0) {
					$_item.after('<span class="checkbox"></span>');
				}

				var $s = $_item.next('span');
				var checked = $_item.prop('checked');
				var disabled = $_item.prop('disabled');

				if (checked) {
					$s.addClass('checked');
				} else {
					$s.removeClass('checked');
				}

				if (disabled) {
					$s.addClass('disabled');
				} else {
					$s.removeClass('disabled');
				}
			})
		}


		function get_groupdirectory(id) {
			$.ajax({
				url: '/bhost/get_groupdirectory_x',
				type: 'post',
				async: false,
				data: { a0: se, a1: id },
				success: function (result) {
					groupdata = JSON.parse(result);
				}
			});
		}
		function get_groupdirectory_id(id, ugid) {
			$.ajax({
				url: '/bhost/get_groupdirectory_idx',
				type: 'post',
				async: false,
				data: { a0: se, a1: id, a2: ugid },
				success: function (result) {
					groupdata = JSON.parse(result);
				}
			});
		}
		var server_scope = [];
		var edit_data = [];
		var alldata;
		function get_all_data()//获取编辑的数据
		{
			id = document.frm_access.id.value;
			$.ajax({
				url: '/bhost/PGetCmdAuth_x',
				type: 'post',
				async: false,
				data: { a0: se, a1: id },
				success: function (result) {
					alldata = JSON.parse(result);
					
					last_u_tmp  = alldata.data[0].AuthObjectSet.AuthUserSet == null ? [] :  alldata.data[0].AuthObjectSet.AuthUserSet;
					last_user_set = [];
					$(last_u_tmp).each(function(i,item){
						if(item.Type == 2) last_user_set.push(item)
					})
					
					cmdauthdata.CmdAuthId = alldata.data[0].CmdAuthId;
					savestep1.name = alldata.data[0].CmdAuthName;
					savestep1.Enable = alldata.data[0].Enabled;
					
					if (alldata.data[0].AdminSet == null) {
						alldata.data[0].AdminSet = [];
					}
					
					$.each(alldata.data[0].AdminSet, function (i, item) {
						if(item.Type == 1){
							admin_1=item.UserCode;
							return true
						}
						savestep1.admin.push(item.AdminId);
					})
					utreelist = [];
					$.each(alldata.data[0].AuthObjectSet.AuthUserSet, function (i, item) {
						if (item.Type == 2) {
							savestep1.ugid.push(item);
						} else {
							savestep1.uid.push(item);
							utreelist.push(item.Id +':false');
						}
					})
					
					//console.log(alldata.data[0].Enabled);
					if (!alldata.data[0].Enabled){
						//console.log('uncheck');
						$("#Enable").iCheck('uncheck');
					}else{
						$("#Enable").iCheck('check');
					}
					
					edit_data = alldata.data[0].AuthObjectSet.AuthUserSet;

					server_scope = alldata.data[0].AuthObjectSet.AuthScope;
					$.each(alldata.data[0].AuthObjectSet.AuthScope, function (i, item) {
						savestep2.rangid.push(parseInt(item.ServerScopeId));
					})
					cmdauthdata.AuthMode = alldata.data[0].AuthMode;
					if (cmdauthdata.AuthMode == 2 || cmdauthdata.AuthMode == 3) {
						savestep2.accountid = alldata.data[0].AuthAccountId.split(",");
						accountid = alldata.data[0].AuthAccountId.split(",");
					} else if (cmdauthdata.AuthMode == 4) {
						account_arry = alldata.data[0].AuthAccountId.split(",");
					}

					if (alldata.data[0].AuthObjectSet.AuthServiceSet != null) {
						savestep2.serverset = alldata.data[0].AuthObjectSet.AuthServiceSet;
					} else {
						savestep2.AuthService = alldata.data[0].AuthService;
					}

					savestep3.action = alldata.data[0].Action;
					var response = alldata.data[0].ResponseMode;
					if (response == 1) {
						savestep3.mode = 0;
						savestep3.respone = 1;
						savestep3.woring = alldata.data[0].EventAlarmInfoId;
						savestep3.woringname = alldata.data[0].EventAlarmInfoName;
					} else if (response == 2) {
						savestep3.mode = 2;
						savestep3.respone = 0;
					}
					else if (response == 3) {
						savestep3.mode = 2;
						savestep3.respone = 1;
						savestep3.woring = alldata.data[0].EventAlarmInfoId;
						savestep3.woringname = alldata.data[0].EventAlarmInfoName;
					}
					else if (response == 4) {
						savestep3.mode = 4;
						savestep3.respone = 0;
					}
					else if (response == 5) {
						savestep3.mode = 4;
						savestep3.respone = 1;
						savestep3.woring = alldata.data[0].EventAlarmInfoId;
						savestep3.woringname = alldata.data[0].EventAlarmInfoName;
					}
					else if (response == 8) {
						savestep3.mode = 8;
						savestep3.respone = 0;
						savestep3.approve = alldata.data[0].ApproveStrategyId;
						savestep3.approvename = alldata.data[0].ApproveStrategyName;
					}
					else if (response == 9) {
						savestep3.mode = 8;
						savestep3.respone = 1;
						savestep3.woring = alldata.data[0].EventAlarmInfoId;
						savestep3.approve = alldata.data[0].ApproveStrategyId;
						savestep3.woringname = alldata.data[0].EventAlarmInfoName;
						savestep3.approvename = alldata.data[0].ApproveStrategyName;
					}
					$.each(alldata.data[0].AuthCmdSet, function (i, item) {
						if (item.Type == 1) {
							var set = '{"CmdSetId":' + item.CmdSetId + ',"Name":"' + item.Name + '"}';
							savestep3.cmd_all.push(JSON.parse(set));
							cmdset.push((item.CmdSetId).toString());
						} else {
							//var Content = window.decodeURIComponent(window.atob(item.Content));
							var Content = item.Content;
							$("#Content").val(Content);
						}
					});
					cmdset.reverse();
				}
			});
		}

		//选中后树的input check变化
		function _checkEvent(obj) {
			var _run = function () {
				var $li = $(obj).parent().parent().parent();
				var tagname = $li[0].tagName.toLowerCase();
				var v = $(obj).prop('checked');
				if (tagname == 'li') {
					var c1 = 0, c2 = 0;
					var len = $(obj).parent().parent().children('li').length;
					$(obj).parent().parent().children('li').each(function () {
						var c = $(this).children('span.checkbox').attr('class');
						if (c.indexOf('checked') > 0) {
							c1++;
						} else if (c.indexOf('half') > 0) {
							c2++;
						}

						if (c1 == len) {
							var span_class = $li.children('input.zcheck').prop('checked', false).siblings('span.checkbox').attr('class');
							var d_class = "";
							if (span_class.indexOf('disabled') != -1) {
								d_class = 'disabled';
							}
							var attr_class = 'checkbox checked ' + d_class;
							$li.children('input.zcheck').prop('checked', true).siblings('span.checkbox').attr('class', attr_class);
							$li.children('input.zcheck').attr("data-loadlast", 2);
						} else if (c1 == 0 && c2 == 0) {
							$li.children('input.zcheck').prop('checked', false).prop('disabled', false).siblings('span.checkbox').attr('class', 'checkbox').removeClass('disabled');
							$li.children('input.zcheck').attr("data-loadlast", 0);
							$li.children('input.zcheck').siblings('span.authtype').children('input').prop('checked', false).siblings('span.checkbox').attr('class', 'checkbox');
						} else {
							var span_class = $li.children('input.zcheck').prop('checked', false).siblings('span.checkbox').attr('class');
							var d_class = "";
							if (span_class.indexOf('disabled') != -1) {
								d_class = 'disabled';
							}
							var attr_class = 'checkbox half ' + d_class;
							$li.children('input.zcheck').prop('checked', false).siblings('span.checkbox').attr('class', attr_class);
							$li.children('input.zcheck').attr("data-loadlast", 1);
						}
					});
					_checkEvent($li.children('input.zcheck'));
				} else {
					return;
				}
			}

			_run();
		}


		function _checkEvent1(obj) {
			if ($(obj).length == 0) return false;
			var _run1 = function () {
				_input = $(obj).parent().parent().siblings('input.zcheck');

				_ul = _input.siblings('ul');
				if (_input.length > 0 && (_ul.children('li').length > 0)) {
					$inp = _ul.children('li').children('input.zcheck');
					$($inp).each(function (i, item) {
						$parent = $(item).parent().parent().siblings('span.authtype').find('input');
						v = $($parent).prop("checked");
						$spanp = $(item).siblings('span.authtype');
						//如果发现父节点还是disabled
						if ($($parent).prop("disabled") == true) v = true;
						if (v == false) {
							$(item).prop("disabled", false);
							$(item).siblings('span.checkbox').removeClass("disabled");
							$spanp.find('input').prop("disabled", false);
							$spanp.find('span').removeClass("disabled");
							if ($spanp.length == 0) {
								_checkEvent2($(item).siblings('ul').children('li').children('input.zcheck'));
							}
							else {
								if ($(item).prop('checked') == false) $spanp.find('input').prop('checked', false).next('span').removeClass('checked');
								_checkEvent1($spanp.find('input'));
							}
						} else {
							$(item).prop("checked", true).prop("disabled", true);
							$(item).siblings('span.checkbox').addClass("disabled");
							$spanp.find('input').prop("disabled", true);
							$spanp.find('span').addClass("disabled");
							if ($spanp.length == 0) _checkEvent2($(item).siblings('ul').children('li').children('input.zcheck'));
							else _checkEvent1($spanp.find('input'));

						}
					})

				} else {

					return;
				}
			}

			_run1();
		}

		function _checkEvent2(obj) {
			if (obj.length == 0) return false;
			var _run2 = function () {
				_input = $(obj).parent().parent().siblings('input.zcheck');;
				if ($(_input).prop('disabled') == true) {
					$(obj).prop("checked", true).prop("disabled", true);
					$(obj).siblings('span.checkbox').addClass("disabled");
				} else {
					$(obj).prop("disabled", false);
					$(obj).siblings('span.checkbox').removeClass("disabled");
				}
				_checkEvent2($(obj).siblings('ul').children('li').children('input.zcheck'));
			}

			_run2();
		}

		function get_ngroup_list(obj, id) {
			var loginusercode = window.parent.document.frm.us.value;
			$(obj).empty();
			$.ajax({
				url: "/bhost/get_ugroup_list",
				type: "POST",
				async: false,
				data: { a0: se, a1: loginusercode, a2: id },
				success: function (result) {
					var ugroup_result = JSON.parse(result);
					if (ugroup_result.Result == false) {
						_alert(1, "指令授权", "执行失败：" + ugroup_result.ErrMsg);
						return false;
					}
					else {
						var result = ugroup_result.info;
						result = result.data;
						Data_group = result.UGroup;
						//firstData = group_data;
						Data_user = result.User;
					}
				}

			})
			$.each(Data_group, function (i, item) {
				$(obj).append('<i class="h-aicon" data-id="' + item.UGId + '" /><input type="checkbox" id="node-' + item.UGId + '" data-check="0" data-grade="0"><i class="h-eicon h-eicon-g"></i>' + item.UGName + '<ul style="display:none">Loading...</ul>');
			})
			$.each(Data_user, function (i, item) {
				$(obj).append('<li><i class="h-blank" /><input type="checkbox" id="node-' + item.UserId + '" data-grade="0"><i class="h-eicon h-eicon-u"></i>' + item.UserName + '</li>');
			})

			$('.form-checkbox,.form-radio').iCheck({
				checkboxClass: 'icheckbox_minimal-blue',
				radioClass: 'iradio_minimal-blue',
				increaseArea: '0' // optional
			});
			$(obj).on('click', 'i.h-aicon', function () {
				var $item = $(this);
				var id = $item.data('id').split('-')[1];
				var $u = $item.parent().children('ul');
				get_ngroup_list($u, id);
				if ($u.is(':hidden')) {
					$item.addClass('h-aicon-d');
					$u.show();
				} else {
					$item.removeClass('h-aicon-d');
					$u.hide();
				}
			})
		}
		var mdata;
		var admin_1=window.parent.document.frm.us.value;
		function get_cont_list()//获取管理员
		{
			
			$.ajax({
				url: '/bhost/get_manager_z',
				type: 'post',
				async: false,
				data: { a0: se,a1:admin_1,a2:3 },
				success: function (result) {
					mdata = JSON.parse(result);
					if (mdata.Result == false) {
						_alert(1, "对象授权", "执行失败：" + mdata.info);
						return false;
					} else {
						$("#manager_select").append('<option value="-1">请选择</option>');
						$.each(mdata, function (i, item) {
							if (item.UserCode == 'admin' && item.UserCode != window.parent.document.frm.us.value){
								return true;
							}
							if (item.UserCode == admin_1){
								return true;
							}
							/*$.ajax({
								url: '/bhost/IsAllowToManageAuth',
								type: 'post',
								async: false,
								data: { a0: se, a1: item.UserId, a2: userid},
								success: function (result) {
									if(result == 1){*/
										$("#manager_select").append('<option value="' + item.UserId + '">' + item.UserCode + '</option>');
										m_index_all.push(item.UserId);
									/*}
								}
							})*/
						});
					}
				}
			});
		}

		function get_server_scope() {
			server_scope_flag = 1;
			//"AuthMode": 3,  --CmdAuthType为1时使用：1-按目标，指定账号；2-范围，共有账号；3-范围，所有账号；4-范围，自定义
			if (cmdauthdata.AuthMode == 2 || cmdauthdata.AuthMode == 3) {
				$("#typeSet").val(2).trigger('change');
				$.each(server_scope, function (i, item) {
					//$("#ips").val(item.ServerScopeName);
					$("#ips").find('span').text(item.ServerScopeName);
					$("#ips").data('value',item.ServerScopeId);
					server_id = item.ServerScopeId;
					if (i != server_scope.length - 1) {
						var $c = $('<div style="width:215px;margin-top: -10px;" class="item" id="' + item.ServerScopeId + '"/>');
						if (serverid_list.indexOf(item.ServerScopeId) === -1) {
							serverid_list.push(item.ServerScopeId);
						}
						$c.html('<input style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;width: 144px;padding: 0 8px;" typr="text" class="form-text" disabled="true" value="' + item.ServerScopeName + '"><i class="ctrl del" onclick="_delServerScope(this)"></i>');
						//$("#ips").parent().parent().after($c);
						//$("#ips").parent().parent().find('input:first').val("");
						$("#ips").parent().after($c);
						$("#ips").find('span').text('请选择');
					}
				});
				if (cmdauthdata.AuthMode == 3) {
					all_flag = 1;
				} else {
					$("#mix_select").val(2).trigger('change');
					all_flag = 0;
				}
				if (savestep2.AuthService == "*"){
					$("#s_mix_select").val(2).trigger('change');
				}else{
					if (savestep2.serverset.length != 0) {
						$.each(savestep2.serverset, function (i, item) {
							var id = item.ProtocolId + '-' + item.ConnParamId + '-' + item.Port;
							$("#" + id).iCheck('check');
							AuthServiceSet.push(id);
						});
					}
				}
				
				change_server();
				if (savestep2.accountid == "*"){
					$("#a_mix_select").val(2).trigger('change');
				}else{
					$("#a_mix_select").val(1).trigger('change');
					$.each(savestep2.accountid, function (i, item) {
						$("#ai" + item).iCheck('check');
					})
				}
				/*
				if ($.inArray('5', savestep2.accountid) != -1) {
					$("#ai5").iCheck('check');
				} else {
					$.each(savestep2.accountid, function (i, item) {
						$("#ai" + item).iCheck('check');
					})
				}
				*/
			} else if (cmdauthdata.AuthMode == 4) { //范围自定义
				$("#typeSet").val(2).trigger('change');
				$("#define_select").val(2).trigger('change');
				$.each(server_scope, function (i, item) {
					//$("#ips").val(item.ServerScopeName);
					$("#ips").find('span').text(item.ServerScopeName);
					$("#ips").data('value',item.ServerScopeId);
					server_id = item.ServerScopeId;
					if (i != server_scope.length - 1) {
						var $c = $('<div style="width:215px;margin-top: -10px;" class="item" id="' + item.ServerScopeId + '"/>');
						if (serverid_list.indexOf(item.ServerScopeId) === -1) {
							serverid_list.push(item.ServerScopeId);
						}
						$c.html('<input style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;width: 144px;padding: 0 8px;" typr="text" class="form-text" disabled="true" value="' + item.ServerScopeName + '"><i class="ctrl del" onclick="_delServerScope(this)"></i>');
						//$("#ips").parent().parent().after($c);
						//$("#ips").parent().parent().find('input:first').val("");
						$("#ips").parent().after($c);
						$("#ips").find('span').val('请选择');
					}
				});
				account_arry_temp = account_arry.slice(0);
				account_arry = [];
				
				$.each(account_arry_temp, function (i, item) {
					$("#account_select").val(item).trigger('change');
					if (i != account_arry_temp.length - 1) {
						$("#account_select").parent().find('i.add').click();
					}
				})
				bind_protocol_select();
				bind_conn_select();
				$.each(savestep2.serverset, function (i, item) {
					//$("#ProtocolName").val(item.ProtocolId).trigger('change');
					$("#ProtocolName").data('value',item.ProtocolId);
					$("#ProtocolName").find('span').text(item.ProtocolName);
					$("#Port").val(item.Port);
					if (item.ConnParamId != null) {
						//$("#ConnParamName").val(item.ConnParamId).trigger('change');
						$("#ConnParamName").data('value',item.ConnParamId);
						$("#ConnParamName").find('span').text(item.ConnParamName);
					}
					_addServer('add');
				})
			} else {//对象指定
				$("#typeSet").val(1).trigger('change');
			}
		}


		var flag_loading_host = false;
		function next() {//下一步
			var f = 0;
			if (flog == 1) {
				savedata1();
				if (savestep1.name == "") {
					_alert(2, "指令授权", "请输入授权名称", $("#ManageAuthName"));
					isto = 1;
					return false;
				}
				if (!nameReg.test(savestep1.name)) {
					_alert(1, "指令授权", "授权名称格式不正确", $("#ManageAuthName"));
					isto = 1;
					return false;
				}
				/*
				if (savestep1.admin.length == 0) {
					_alert(2, "指令授权", "请选择协助管理者");
					isto = 1;
					return false;
				}*/
				if ($("#userTree").find('span.checkbox.half,span.checkbox.checked').length == 0) {
					_alert(2, "指令授权", "请选择用户或用户组");
					return false;
				}
				if (document.frm_access.tasktype.value != 3) {
					$.ajax({
						url: "/bhost/check_name",
						type: "POST",
						async: false,
						data: { a0: se, a1: savestep1.name },
						success: function (result) {
							if (result != 0) {
								f = 1;
								_alert(1, "指令授权", "授权名称已存在", $("#ManageAuthName"));
								return false;
							}
						}
					})
				}
				if (isto1 == 1) {
					//alldata
					if ($("#typeSet").val() == 2) { //范围指定
						if (($("#ips").data('value') == undefined || $("#ips").data('value') == '-1') && $("#server_frame_list").children('div').length == 1) {
							_alert(2, "指令授权", "请选择服务器范围");
							return false;
						}
						if ($("#define_select").val() == 1) {//已定义
							if ($("#a_mix_select").val() == 1){
								if (accountid.length == 0) {
									_alert(2, "指令授权", "请选择账号");
									return false;
								}
							}
							if ($("#s_mix_select").val() == 1){
								if ($("#service_list2").find('input:checked').length == 0) {
									_alert(2, "指令授权", "请选择服务");
									return false;
								}
							}
						} else {//自定义
							if ((account_arry.length == 1 && account_arry[0] == '-1') || account_arry.length == 0) {
								_alert(2, "指令授权", "请选择账号");
								return false;
							}
							if ($("#service_list1").children('tr').length == 0) {
								_alert(2, "指令授权", "请添加服务");
								return false;
							}
						}
					} else {//对象指定
						if ($("#hostTree").find('span.checkbox.half,span.checkbox.checked').length == 0) {
							_alert(2, "指令授权", "请选择对象");
							return false;
						}
					}
					flog++;
				}
			}
			if (f == 1) {
				isto = 1;
				return false;
			}
			if (flog == 2) {
				if (isto1 == 1 && document.frm_access.tasktype.value == 3) {
					isto1 = 0;
				}
				else {
					//savedata2();
				}
				if ($("#typeSet").val() == 2) { //范围指定
					if (($("#ips").data('value') == undefined || $("#ips").data('value') == '-1') && $("#server_frame_list").children('div').length == 1) {
						_alert(2, "指令授权", "请选择服务器范围");
						return false;
					}
					if ($("#define_select").val() == 1) {//已定义
						if ($("#a_mix_select").val() == 1){
							if (accountid.length == 0) {
								_alert(2, "指令授权", "请选择账号");
								return false;
							}
						}
						if ($("#s_mix_select").val() == 1){
							if ($("#service_list2").find('input:checked').length == 0) {
								_alert(2, "指令授权", "请选择服务");
								return false;
							}
						}
					} else {//自定义
						if ((account_arry.length == 1 && account_arry[0] == '-1') || account_arry.length == 0) {
							_alert(2, "指令授权", "请选择账号");
							return false;
						}
						if ($("#service_list1").children('tr').length == 0) {
							_alert(2, "指令授权", "请添加服务");
							return false;
						}
					}
				} else {//对象指定
					if ($("#hostTree").find('span.checkbox.half,span.checkbox.checked').length == 0) {
						_alert(2, "指令授权", "请选择对象");
						return false;
					}
				}

			}
			flog++;
			if (flog == 2) {
				$('#c-exp1').show();
				$('#c-exp').hide();
				$('#c-exp3').hide();
				get_hostdirectory(0, document.frm_access.id.value);
				_viewHTML(hdata, '#hostTree', 0);
				$('#step').empty();
				$(".btns.add").prepend("<a href=\"javascript:;\" class=\"btn btn-normal\" onclick=\"up()\" id=\"upstep\">上一步</a>");
				$('#step').append('<li onclick="to(1)">运维用户</li><li class="active">访问范围</li><li style="width:146px" onclick="to(3)">指令集合/响应方式</li>');
				$("#frist").css("background-color", "rgba(222, 222, 222, 0)");
				if (server_scope_flag == 0) {
					get_server_scope();
				}
			}
			if (flog == 3) {
				$('#c-exp3').show();
				$('#c-exp1').hide();
				$('#c-exp').hide();
				$('#step').empty();
				$('#step').append('<li onclick="to(1)">运维用户</li><li onclick="to(2)">访问范围</li><li style="width:146px" class="active">指令集合/响应方式</li>');
				if (cmdsave != 1) {
					get_cmd_all();
					if (document.frm_access.tasktype.value == 3) {
						$("input:radio[name='action']").each(function () {
							if ($(this).val() == savestep3.action) {
								$(this).iCheck('check');;
							}

						})
						$("input:checkbox[name='response']").each(function () {
							if ($(this).val() == savestep3.mode) {
								$(this).iCheck('check');;
							}

						})
						if (savestep3.mode == 8) {
							//get_ApproveStrategy();
							$("#ApproveStrategy_massage").show();
							//$("#EnableApprove").val(savestep3.approvename);
							if (savestep3.approvename != null && savestep3.approve != null){
								$("#EnableApprove").find('span').text(savestep3.approvename);
								$("#EnableApprove").data('value',savestep3.approve);
							}else{
								$("#EnableApprove").find('span').text('请选择');
								$("#EnableApprove").data('value','-1');
							}
						}
						if (savestep3.respone == 1) {
							$("#warning_checkbox").iCheck("check");
							//get_warning_all();
							$("#warning_massage").show();
							//$("#EventAlarmInfoId").val(savestep3.woringname);
							if (savestep3.woringname != null && savestep3.woring != null){
								$("#EventAlarmInfoId").find('span').text(savestep3.woringname);
								$("#EventAlarmInfoId").data('value',savestep3.woring);
							}else{
								$("#EventAlarmInfoId").find('span').text('请选择');
								$("#EventAlarmInfoId").data('value','-1');
							}
						}
					}
				}
				$("#warning_checkbox,input:checkbox[name=response]").iCheck({
					checkboxClass: 'icheckbox_minimal-blue',
					radioClass: 'iradio_minimal-blue',
					increaseArea: '0' // optional
				})
				if (document.frm_access.tasktype.value != 3) {
					$("#warning_checkbox").iCheck('check');
					$("#warning_massage").show();
				}

				$("#warning_checkbox").on("ifClicked", function () {
					$(".xSelect-alarm").hide();
					$('div[data-id=xSelect-alarm]').removeClass('on');
					$(".xSelect-approve").hide();
					$('div[data-id=xSelect-approve]').removeClass('on');
					if ($(this).prop("checked") == false) {
						get_warning_all();
						$("#warning_massage").show();
					}
					else {
						var check_radio = 0;
						$('input:checkbox[name="response"]').each(function (i, item) {
							if ($(item).prop('checked') && $(item).val() != 0) {
								check_radio = 1;
								return false;
							}
						})
						if (check_radio == 0) {
							_alert(2, "指令授权", "请至少选择一种响应方式");

							setTimeout(function () {
								$("#warning_checkbox").iCheck("check");
							}, 0)

							return false;
						}
						$(this).iCheck('uncheck');
						$("#warning_massage").hide();
					}
				})

				$("#Blocke").on("ifChanged", function () {
					if (!$("#Blocke").prop("checked")) {
						if ($("#response_check").find('input:checked').length == 0) {
							_alert(2, "指令授权", "请至少选择一种响应方式");
							setTimeout(function () {
								$("#Blocke").iCheck("check");
							}, 0)
							return false;
						}
					} else {
						$("#ignore").iCheck('uncheck');
						$("#insapp").iCheck('uncheck');
					}
				});
				$("#ignore").on("ifChanged", function () {
					if (!$("#ignore").prop("checked")) {
						if ($("#response_check").find('input:checked').length == 0) {
							_alert(2, "指令授权", "请至少选择一种响应方式");
							setTimeout(function () {
								$("#ignore").iCheck("check");
							}, 0)
							return false;
						}
					} else {
						$("#Blocke").iCheck('uncheck');
						$("#insapp").iCheck('uncheck');
					}
				});
				$("#insapp").on("ifChanged", function () {
					$(".xSelect-approve").hide();
					$('div[data-id=xSelect-approve]').removeClass('on');
					$(".xSelect-alarm").hide();
					$('div[data-id=xSelect-alarm]').removeClass('on');
					if (!$("#insapp").prop("checked")) {
						if ($("#response_check").find('input:checked').length == 0) {
							_alert(2, "指令授权", "请至少选择一种响应方式");
							setTimeout(function () {
								$("#insapp").iCheck("check");
							}, 0)
							return false;
						}
						$("#ApproveStrategy_massage").hide();
					} else {
						get_ApproveStrategy();
						$("#ApproveStrategy_massage").show();
						$("#ignore").iCheck('uncheck');
						$("#Blocke").iCheck('uncheck');	
					}
				});
				/*
				$('input:checkbox[name="response"]').on("ifClicked",function(){
					var response= parseInt($(this).val());
										if ($(this).prop("checked")){
						if (!$("#warning_checkbox").prop("checked")){
														_alert(2,"指令授权","请至少选择一种响应方式");
							setTimeout(function() {
								  $(this).iCheck("check");
							}, 0)
							return false;
						}
						if(response == 8)
						{
							$("#ApproveStrategy_massage").hide();
						}
												$(this).iCheck("uncheck");
											}else{
						if(response == 8)
						{
							get_ApproveStrategy();
							$("#ApproveStrategy_massage").show();
							$("#ApproveStrategy").val(0).trigger('change');
						}
						else{
							$("#ApproveStrategy_massage").hide();
						}
						if (response == 0){
							if (!$("#warning_checkbox").prop("checked")){
								$("#warning_checkbox").iCheck("check");
								get_warning_all();
								$("#warning_massage").show();
							}						
						}
												$(this).iCheck("check");
					}
				})
				*/
				var power_flag = 0;
				$.each(window.parent._power,function(i,item){
					if (item.SubMenuName == "指令授权" && item.Mode == 1){
						power_flag = 1;
						$("#nextstep").hide();
						return false;
					}
				});
				if (power_flag == 0){
					$("#nextstep").html('保&nbsp;&nbsp;存');
				}
			}
			if (flog == 4) {
				flag_save = 1;
				savedata3();
				if (savestep3.cmd_all.length == 0) {
					_alert(2, "指令授权", "请选择指令集合或者手动输入指令", $("#Content"));
					flog--;
					return false;
				}

				if (savestep3.respone == 1 && savestep3.woring == 0) {
					if ($("#EventAlarmInfoId").data('value') == "" || $("#EventAlarmInfoId").data('value') == undefined){
						_alert(2, "指令授权", "请选择告警信息");
					} else {
						_alert(1, "指令授权", "该事件告警信息不存在");
					}
					flog--;
					return false;
				}
				if (savestep3.mode == 8 && savestep3.approve == 0) {
					if ($("#EnableApprove").data('value') == "" || $("#EnableApprove").data('value') == undefined) {
						_alert(2, "指令授权", "请选择审批策略");
					} else {
						_alert(1, "指令授权", "该审批策略不存在");
					}
					flog--;
					return false;
				}
				save_alldata();
				_showLoading();
				filter_flag_append_u = true;
				var msstr = aceg(JSON.stringify(cmdauthdata),se);
				//console.log(cmdauthdata);
				$.ajax({
					url: "/bhost/save_cmdauth_all_x",
					type: "POST",
					// async: false,
					async: true,
					data: { a0: se, a1: JSON.stringify(cmdauthdata), a2: Content_str,m1:msstr },
					success: function (result) {
						var cmdauthdata_result = JSON.parse(result);
						if (cmdauthdata_result.Result) {
							layer.open({
								type: 1,
								title: "指令授权",
								content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
								btn: '确&nbsp;&nbsp;定',
								btnAlign: 'c',
								closeBtn: false,
								skin: 'layer-custom',
								area: ['380px', '310px'],
								move: false,
								resize: false,
								btn1: function (i) {
									layer.close(i);
									_closeLoading();
									show_list(2,cmdauthdata_result.CmdAuthId);
									/*
									if(document.frm_access.tasktype.value==1)
									{
									document.frm_access.tasktype.value=0;
									document.frm_access.action = '/bhost/cmdAuth_show';
									document.frm_access.submit();
									}
									else
									{
										document.frm_access.tasktype.value=4;
										document.frm_access.action = '/bhost/cmdAuth_show';
										document.frm_access.submit();
									}
									*/
								}

							});

						}
						else {
							_alert(1, "指令授权", "执行失败：" + cmdauthdata_result.ErrMsg);
							flog--;
							flag_save = 0;
							_closeLoading();
						}
					}
				})
			}
		}

		function up()//上一步
		{
			if (flog == 3) {
				cmdsave = 1;
			}
			flog--;
			if (flog == 1) {
				$('#c-exp').show();
				$('#c-exp1').hide();
				$('#c-exp3').hide();
				$(".btns.add").children('a:first').remove();
				if (isto1 == 1 && document.frm_access.tasktype.value == 3) {
					isto1 = 0;
				}
				else {
					savedata2();
				}
				$('#step').empty();
				$('#step').append('<li  class="active">运维用户</li><li onclick="to(2)">访问范围</li><li style="width:146px" onclick="to(3)">指令集合/响应方式</li>');
			}
			if (flog == 2) {
				$('#c-exp1').show();
				$('#c-exp3').hide();
				$('#c-exp').hide();
				$('#step').empty();
				$('#step').append('<li onclick="to(1)">运维用户</li><li  class="active">访问范围</li><li style="width:146px" onclick="to(3)">指令集合/响应方式</li>');
				//get_service_range();
				//$("#server_frame_list").find('div').not('div:first').remove();
				if (server_scope_flag == 0) {
					get_server_scope();
				}
				//savedata3();
				$("#nextstep").text("下一步");
				$("#nextstep").show();
			}
			$("#manager_select").select2();
			$("#account_select").select2();
		}

		function get_account_list()//获取账号
		{
			$.ajax({
				url: "/bhost/get_account_list_xtc",
				type: "POST",
				async: false,
				data: { a0: se },
				success: function (result) {
					var account_result = JSON.parse(result);
					if (account_result.Result == false) {
						_alert(1, "指令授权", account_result.ErrMsg);
						return false;
					}
					else {
						$.each(account_result.data, function (i, item) {
							$("#account_list").append('<div class="item"><label><input type="checkbox" name="">' + item.AccountName + '</label></div>');
						})
					}
				}
			})
			$('.ss input').iCheck({
				checkboxClass: 'icheckbox_minimal-blue',
				radioClass: 'iradio_minimal-blue',
				increaseArea: '0' // optional
			});
		}
		var cmd_data;
		var cmd_index_all = [];
		function get_cmd_all()//获取指令集合
		{
			if (savestep3.cmd_all.length != 0){
				var cmd_len = savestep3.cmd_all.length;
				$.each(savestep3.cmd_all,function(i,item){
					$("#cmd").data('value',item.CmdSetId);
					$("#cmd").find('span').text(item.Name);
					if (cmd_len-1 != i){
						$("#cmd").next('i').trigger('click');
					}
				});
			}
			/*
			$.ajax({
				url: "/bhost/get_cmd_all_x",
				type: "POST",
				async: false,
				data: { a0: se },
				success: function (result) {
					var cmd_result = JSON.parse(result);
					if (cmd_result.Result == false) {
						_alert(1, "指令授权", cmd_result.ErrMsg);
						return false;
					}
					else {
						$("#cmd").parent().parent().parent().empty();
						cmd_data = cmd_result;
						$("#cmdset").append('<span class="form-tag" style="width:6em; margin-left: 50px;">指令集合：</span><div style="max-height: 77px;margin-left: 84px;overflow:auto;" id="xx"></div>');

						var cmd_len = savestep3.cmd_all.length;
						if (savestep3.cmd_all.length != 0) {
							$("#xx").append('<li class="item" style="margin-top: -10px;margin-left: 10px;"><select class="filter-select" name="" id="cmd" style="width:70%" onchange="change_cmd(this);"><option value="-1">请选择</option></select><i class="ctrl add" onclick="_addcmd(this)"></i></li>');
							$.each(cmd_result.data, function (i, xitem) {
								cmd_index_all.push(xitem.CmdSetId);
								$("#cmd").append('<option value="' + xitem.CmdSetId + '">' + xitem.Name + '</option>');
							});
							$.each(savestep3.cmd_all, function (i, item) {
								if (i != cmd_len - 1) {
									$("#cmd").find('option[value="' + item.CmdSetId + '"]').remove();
									$("#xx").append('<li class="item" style="padding: 1px 0px 11px 11px;"><input type="text" class="form-text" id="' + item.CmdSetId + '" value="' + item.Name + '" style="width:106px;height:24px" disabled="true"><i class="ctrl del" onclick="_del_mora(this,3)"></i></li>');
								} else {
									$("#cmd").val(item.CmdSetId).trigger('change');
								}
							});
							if (savestep3.cmd_all.length == cmd_result.data.length) {
								$("#cmd").parent().hide();
							}
							$("#xx").append('<div class="clearfix"></div>');
						} else {
							$("#xx").append('<li class="item" style="margin-top: -10px;margin-left: 10px;"><select class="filter-select" name="" id="cmd" style="width:70%" onchange="change_cmd(this);"><option value="-1">请选择</option></select><i class="ctrl add" onclick="_addcmd(this)"></i></li>');
							$.each(cmd_result.data, function (i, xitem) {
								cmd_index_all.push(xitem.CmdSetId);
								$("#cmd").append('<option value="' + xitem.CmdSetId + '">' + xitem.Name + '</option>');
							})
							$("#xx").append('<div class="clearfix"></div>');
						}
					}
				}
			})
			$('.filter-select,.form-select').select2({ minimumResultsForSearch: -1 });
			$("#cmd").select2();
			*/
		}

		var edata;
		function get_warning_all()//获取告警信息
		{
			$.ajax({
				url: "/bhost/get_warning_all_x",
				type: "POST",
				async: false,
				data: { a0: se },
				success: function (result) {
					edata = JSON.parse(result);
				}
			})
		}

		var appdata;
		function get_ApproveStrategy()//获取审批策略
		{
			$.ajax({
				url: "/bhost/get_ApproveStrategy_all_x",
				type: "POST",
				async: false,
				data: { a0: se },
				success: function (result) {
					appdata = JSON.parse(result);
				}
			})
		}

		function _delServerScope(obj) {
			var v = $(obj).parent().children('span').text();
			var id = $(obj).parent().attr('value');
			var $c = $(obj).parent();
			serverid_list.splice($.inArray(parseInt(id), serverid_list), 1);
			$c.remove();
			change_server();
		}

		var accountid = [];
		var serverid_list = [];
		var server_scope_flag = 0;
		function change_server() {
			if ($("#a_mix_select").val() == 2 && $("#s_mix_select").val() == 2) {//所有
				return false;
			}
			var auth_json = {
				"LoginUserCode":"",
				"HostSet": [],
				"HGroupSet": [],
				"IPAddr": [],
				"ServerScopeSet": []
			};
			var add = 0;
			auth_json.LoginUserCode = window.parent.document.frm.us.value;
			$("#service_list_a,#protocol,#param,#service_list2").empty();
			$("#check_all").iCheck('uncheck');
			$("#check_all_a").iCheck('uncheck');
			server_scope = [];
			if ($("#ips").data('value') != undefined && $("#ips").data('value') != '-1'){
				var serverset = '{"ServerScopeId":' + $("#ips").data('value') + '}';
				serverset = JSON.parse(serverset);
				auth_json.ServerScopeSet.push(serverset);
				add = 1;
				var set = '{"ServerScopeId":' + $("#ips").data('value') + ',"ServerScopeName":"' + $("#ips").find('span').text() + '"}';
				set = JSON.parse(set);
				server_scope.push(set);
			}
			$("#server_frame_list").children('div:not(:first)').each(function (i, item) {
				var id = parseInt($(item).attr('id'));
				//serverid_list.push(id);
				var name = $(item).children('input').val();
				var serverset = '{"ServerScopeId":' + id + '}';
				serverset = JSON.parse(serverset);
				auth_json.ServerScopeSet.push(serverset);
				add = 1;
				var set = '{"ServerScopeId":' + server_id + ',"ServerScopeName":"' + name + '"}';
				set = JSON.parse(set);
				server_scope.push(set);
			});
			if (add == 1) {
				var accountid_temp = [];
				var ConnParamName = "";
				var set;
				var AuthServiceSet_temp = [];
				auth_json = JSON.stringify(auth_json);
				if (all_flag == 1) {
					//$("#service_list2").append("<tr><td><input type=\"checkbox\" class=\"form-checkbox\" id=\"-1\"/></td><td>*</td><td>*</td><td>*</td></tr>");
					//$("#service_list_a").append("<tr><td><input type=\"checkbox\" class=\"form-checkbox\" id=\"ai5\"/></td><td>*</td></tr>");
					$.ajax({
						url: '/bhost/get_AccountProtocolForAuth',
						type: 'post',
						async: false,
						data: { a0: se, z1: auth_json },
						success: function (result) {
							apdata = JSON.parse(result);
						}
					});
				} else {
					$.ajax({
						url: '/bhost/Get_SameAccountProtocolForAuth',
						type: 'post',
						async: false,
						data: { a0: se, z1: auth_json },
						success: function (result) {
							if (result == "None") {
								add = 0;
							} else {
								apdata = JSON.parse(result);
							}
						}
					})
				}
				if (add == 0) {
					return false;
				}
				if ($("#a_mix_select").val() != 2) {
					var account_table = "";
					$.each(apdata.AccountSet, function (i, item) {
						if (accountid_temp.indexOf(item.AccountId) === -1) {
							accountid_temp.push(item.AccountId);
							if (item.AccountId == 5) {
								return true;
							}
							account_table = account_table + '<tr><td width="50"><input type="checkbox" class="form-checkbox" id="ai' + item.AccountId + '"/></td><td>' + item.AccountName + '</td></tr>';
						}
					});
					$("#service_list_a").append(account_table);
				}
				if ($("#s_mix_select").val() != 2) {
					var service_table = "";
					$.each(apdata.ServiceSet, function (i, item) {
						if (item.ConnParamName == null) {
							ConnParamName = "";
						} else {
							ConnParamName = item.ConnParamName;
						}
						set = item.ProtocolId + '-' + item.ConnParamId + '-' + item.Port;
						AuthServiceSet_temp.push(set);
						service_table = service_table + "<tr><td width=\"50\"><input type=\"checkbox\" class=\"form-checkbox\" id=\"" + item.ProtocolId + "-" + item.ConnParamId + "-" + item.Port + "\"/></td><td>" + item.ProtocolName + "</td><td>" + item.Port + "</td><td>" + ConnParamName + "</td></tr>";
					});
					$("#service_list2").append(service_table);
				}
				_change_app();
				$.each(accountid, function (i, item) {
					$("#ai" + item).iCheck('check');
				});
				$.each(AuthServiceSet, function (i, item) {
					$("#" + item).iCheck('check');
				})
				var isexist = 0;
				var A_C_TEMP = accountid.slice(0);
				$.each(A_C_TEMP, function (i, item) {
					$.each(accountid_temp, function (i1, item1) {
						if (item1 == item) {
							isexist = 1;
							return false;
						} else {
							isexist = 0;
						}
					});
					if (isexist == 1) {
						return true;
					} else {
						accountid.splice($.inArray(item, accountid), 1);
					}
				});
				var A_S_TEMP = AuthServiceSet.slice(0);
				$.each(A_S_TEMP, function (i, item) {
					$.each(AuthServiceSet_temp, function (i1, item1) {
						if (item1 == item) {
							isexist = 1;
							return false;
						} else {
							isexist = 0;
						}
					});
					if (isexist == 1) {
						return true;
					} else {
						//if (item != '-1'){
						AuthServiceSet.splice($.inArray(item, AuthServiceSet), 1);
						//}
					}
				});
			} else {
				accountid = [];
				AuthServiceSet = [];
			}
			if ($("#defined_info").is(':visible') && $("#a_mix_select").val() == 1) {
				var de_h = $("#defined_info").children(".h-catelog.h-catelog2.h-content2_temp:eq(0)").height();
				$("#service_list_a").parents('.c-table.tab-type2').css('max-height', de_h - 109);
			}
			if ($("#defined_info").is(':visible') && $("#s_mix_select").val() == 1) {
				var de_h = $("#defined_info").children(".h-catelog.h-catelog2.h-content2_temp:eq(1)").height();
				$("#service_list2").parents('.c-table.tab-type2').css('max-height', de_h - 109);
			}
		}

		//绑定账号协议连接参数事件
		var AuthServiceSet = [];
		function _change_app() {
			$('#account,#service_list2').find('input').iCheck({
				checkboxClass: 'icheckbox_minimal-blue',
				radioClass: 'iradio_minimal-blue',
				increaseArea: '0' // optional
			});

			$('#service_list2').find('input').on('ifChanged', function () {
				var list_len = $("#service_list2").find('input').length;
				var id = $(this).attr('id');
				if ($(this).prop("checked")) {
					if (AuthServiceSet.indexOf(id) === -1) {
						AuthServiceSet.push(id);
					}
				} else {
					AuthServiceSet.splice($.inArray(id, AuthServiceSet), 1);
				}
				if ($("#service_list2").find('input:checked').length == list_len && list_len != 0) {
					$("#check_all").iCheck('check');
				} else {
					$("#check_all").iCheck('uncheck');
				}
			});

			$('#service_list_a').find('input').on('ifChanged', function () {
				var list_len_a = $("#service_list_a").find('input').length;
				var id = $(this).attr('id').substring(2);
				if ($(this).prop("checked")) {
					if (accountid.indexOf(id) === -1) {
						accountid.push(id);
					}
				} else {
					accountid.splice($.inArray(id, accountid), 1);
				}
				if ($("#service_list_a").find('input:checked').length == list_len_a && list_len_a != 0) {
					$("#check_all_a").iCheck('check');
				} else {
					$("#check_all_a").iCheck('uncheck');
				}
			});
			$("#check_all_a").on("ifClicked", function () {
				if (!$(this).prop("checked")) {
					$("#service_list_a").find('input').iCheck('check');
				} else {
					$("#service_list_a").find('input').iCheck('uncheck');
				}
			})
			$("#service_list_a").children('tr').bind('click', function (e) {
				x = e.target;
				if (x.nodeName != 'A') {
					var input = $(this).find("input[type='checkbox']");
					if ($(input).prop('checked') == false) {
						$(input).iCheck('check');
					} else {
						$(input).iCheck('uncheck');
					}
				}
			});
			$("#service_list2").children('tr').bind('click', function (e) {
				x = e.target;
				if (x.nodeName != 'A') {
					var input = $(this).find("input[type='checkbox']");
					if ($(input).prop('checked') == false) {
						$(input).iCheck('check');
					} else {
						$(input).iCheck('uncheck');
					}
				}
			});
		}

		function savedata1()//保存第一步数据
		{
			savestep1.ugid.splice(0, savestep1.ugid.length);
			savestep1.uid.splice(0, savestep1.uid.length);
			savestep1.admin.splice(0, savestep1.admin.length);
			savestep1.name = $("#ManageAuthName").val();
			if ($("#Enable").prop('checked')) {
				savestep1.Enable = true;
			}
			else {
				savestep1.Enable = false;
			}
			$.each(manager_arry, function (i, item) {
				if (item != '-1') {
					savestep1.admin.push(parseInt(item));
				}
			});
		}

		function save_user(obj) {
			$(obj).find('span.checkbox.half,span.checkbox.checked').each(function (i, item) {
				if ($(item).prev('input').attr("class") == "check1") return true;
				var state = $(item).attr('class');
				var $u = $(item).parent().find('ul');
				if (state == "checkbox checked") {
					var id = $(item).prev('input').attr('id');
					if ($(item).parent().children('span.authtype').length != 0) {
						if ($(item).parent().children('span.authtype').find('input').prop('checked')) {
							if (id != undefined) {
								var _id = id.split('-')
								var userset = '{"Id":' + _id[1] + ',"Type":2,"IsGroupAuth":true}';
								var AuthUserSet_str = JSON.stringify(savestep1.ugid);
								if (AuthUserSet_str.indexOf(userset) === -1) {
									userset = JSON.parse(userset);
									savestep1.ugid.push(userset);
								}
							}
						} else {
							if ($(item).parent().find('ul').find('li').length > 0) { //展开过
								save_user($u);
							} else { //没展开，该组id 和 一个type，后台直接取该组下的所有用户
								if (id != undefined) {
									var _id = id.split('-')
									var userset = '{"Id":' + _id[1] + ',"Type":2,"IsGroupAuth":false}';
									var AuthUserSet_str = JSON.stringify(savestep1.ugid);
									if (AuthUserSet_str.indexOf(userset) === -1) {
										userset = JSON.parse(userset);
										savestep1.ugid.push(userset);
									}
								}
							}
						}
					} else {
						if (id != undefined) {
							var _id = id.split('-');
							if (_id[0] == "nodeu") {
								var userset = '{"Id":' + _id[2] + ',"Type":1}';
								var AuthUserSet_str = JSON.stringify(savestep1.uid);
								if (AuthUserSet_str.indexOf(userset) === -1) {
									userset = JSON.parse(userset);
									savestep1.uid.push(userset);
								}
							} else {
								var userset = '{"Id":' + _id[1] + ',"Type":2,"IsGroupAuth":false}';
								var AuthUserSet_str = JSON.stringify(savestep1.ugid);
								if (AuthUserSet_str.indexOf(userset) === -1) {
									userset = JSON.parse(userset);
									savestep1.ugid.push(userset);
								}
							}
						}
					}
				} else {
					$(item).parent().children('i.h-aicon').click();
					save_user($u);
				}
			});
		}

		function savedata2()//保存第二步数据
		{
			savestep2.rangid.splice(0, savestep2.rangid.length);
			savestep2.accountid.splice(0, savestep2.accountid.length);
			savestep2.serverset.splice(0, savestep2.serverset.length);
			
			$("#rangelist").find('div.item').not('div:first').each(function (i, item) {
				var v = $(item).attr('id');
				savestep2.rangid.push(parseInt(v));
			});
			if ($("#ips").data('value') != undefined && $("#ips").data('value') != '-1') {
				savestep2.rangid.push(parseInt($("#ips").data('value')));
			}
			
			if ($("#typeSet").val() == 1) { //范围指定
				if ($("#define_select").val() == 1) { //已定义
					if ($("#mix_select").val() == 1) { //所有
						cmdauthdata.AuthMode = 3;
					} else { //共有
						cmdauthdata.AuthMode = 2;
					}
					
					if ($("#a_mix_select").val() == 2){
						savestep2.accountid.push('*');
					}else{
						$("#service_list_a").find('input').each(function(i,item){
							var a_id = $(item).attr('id').substring(2);
							savestep2.accountid.push(parseInt(a_id));
						});
					}
					
					/*
					$('#account div.item').each(function (i, item) {
						var v = $('input[type=checkbox]', item).attr('id').substring(2);
						if ($('input[type=checkbox]', item).prop('checked')) {
							savestep2.accountid.push(parseInt(v));
						}
					})
					*/
					savestep2.serverset = AuthServiceSet;
				} else { //自定义
					cmdauthdata.AuthMode = 4;
					savestep2.accountid = account_arry;
					savestep2.serverset = DeviceType.ServiceSet;
				}
			} else { //对象指定
				cmdauthdata.AuthMode = 1;
			}
		}
		function savedata3()//保存第三步数据
		{
			savestep3.woring = 0;
			savestep3.approve = 0;
			savestep3.woringname = "";
			savestep3.approvename = "";
			savestep3.cmd_all.splice(0, savestep3.cmd_all.length);
			savestep3.action = parseInt($('input:radio[name="action"]:checked').val());
			var Content = $("#Content").val();
			if (Content != "") {
				var set = '{"CmdSetId":-1}';
				savestep3.cmd_all.push(JSON.parse(set));
			}
			var cmd_id = $("#cmd").data('value');
			var cmd_text = $("#cmd").find('span').text();
			if (cmd_id != undefined && cmd_id != '-1'){
				var set = '{"CmdSetId":'+cmd_id+',"Name":"'+cmd_text+'"}';
				savestep3.cmd_all.push(JSON.parse(set));
			}
			$("#cmd_list").children('div:not(:first)').each(function(i,item){
				var v = $(item).attr('id');
				var t = $(item).children('input').val();
				var set = '{"CmdSetId":'+v+',"Name":"'+t+'"}';
				savestep3.cmd_all.push(JSON.parse(set));
			});
			/*
			if ($('#xx').children('li:first').children('select').val() != '-1') {
				var id = $('#xx').children('li:first').children('select').val();
				var t = $("#xx").children('li:first').children('select').children('option[value=' + id + ']').text();
				var set = '{"CmdSetId":' + id + ',"Name":"' + t + '"}';
								savestep3.cmd_all.push(JSON.parse(set));
			}
						$('#xx').children('li').not('li:first').each(function (i, item) {
				v = $(item).children('input').attr('id');
				var t = $(item).children('input').val();
								var set = '{"CmdSetId":' + v + ',"Name":"' + t + '"}';
				savestep3.cmd_all.push(JSON.parse(set));
			})
			*/
			if ($("#warning_checkbox").prop('checked') == true) {
				savestep3.respone = 1;
			}
			else {
				savestep3.respone = 0;
			}
			if (savestep3.respone == 1) {
				//var event_alarm = $("#EventAlarmInfoId").val();
				var event_alarm = $("#EventAlarmInfoId").data('value');
				if (event_alarm != undefined && event_alarm != '-1'){
					savestep3.woring = $("#EventAlarmInfoId").data('value');
				}else{
					savestep3.woring = 0;
				}
				/*
				if (event_alarm != "") {
					get_warning_all();
					$.each(edata.data, function (i, item) {
						if (event_alarm == item.Name) {
							savestep3.woring = item.EventAlarmInfoId;
							return false;
						} else {
							savestep3.woring = 0;
						}
					});
				}
				*/
				//savestep3.woring=$("#warning").val();
			}
			if ($('input:checkbox[name="response"]:checked').length == 0) {
				savestep3.mode = 0;
			} else {
				savestep3.mode = parseInt($('input:checkbox[name="response"]:checked').val());
			}

			if (savestep3.mode == 8) {
				//var approval_strategy = $("#EnableApprove").val();
				var approval_strategy = $("#EnableApprove").data('value');
				if (approval_strategy != undefined && approval_strategy != '-1') {
					savestep3.approve = approval_strategy;
				}else{
					savestep3.approve = 0;
				}
				/*
				if (approval_strategy != "") {
					get_ApproveStrategy();
					$.each(appdata.data, function (i, item) {
						if (approval_strategy == item.ApproveStrategyName) {
														savestep3.approve = item.ApproveStrategyId;
							return false;
						} else {
														savestep3.approve = 0;
						}
					});
				}
				*/
				//savestep3.approve=$("#ApproveStrategy").val();
			}
		}
		function save_alldata() {
			cmdauthdata.CmdAuthName = savestep1.name;
			cmdauthdata.Action = savestep3.action;
			savestep1.ugid = [];
			savestep1.uid = [];
			save_user($("#userTree"));

			if ($("#typeSet").val() == 2) { //范围已定义
				if ($("#define_select").val() == 1) {
					if ($("#mix_select").val() == 1) {
						cmdauthdata.AuthMode = 3; //范围所有
					} else if ($("#mix_select").val() == 2) {
						cmdauthdata.AuthMode = 2; //范围共有
					}
				} else { //范围自定义
					cmdauthdata.AuthMode = 4;
				}
			} else { //对象指定
				cmdauthdata.AuthMode = 1;
			}
			cmdauthdata.AuthObjectSet.AuthScope = [];
			cmdauthdata.AuthObjectSet.AuthServiceSet = [];
			if (cmdauthdata.AuthMode == 3 || cmdauthdata.AuthMode == 2) { //范围已定义
				var account_flag = 0;
				if ($("#a_mix_select").val() == 2) {
					cmdauthdata.AuthAccountId = "*";
				} else {
					cmdauthdata.AuthAccountId = accountid.join(',');
				}
				if ($("#s_mix_select").val() == 2) {
					cmdauthdata.AuthService = '*';
				} else {
					if (AuthServiceSet.indexOf('-1') != -1) {
						cmdauthdata.AuthService = '*';
					} else {
						cmdauthdata.AuthService = null; //勾选部分服务
						$.each(AuthServiceSet, function (i, item) {
							var serverset = item.split('-');
							var set = {
								"ProtocolId": 1,
								"Port": 23,
								"ConnParamId": null
							}
							set.ProtocolId = serverset[0];
							set.Port = serverset[2];
							if (serverset[1] != "null") {
								set.ConnParamId = serverset[1];
							} else {
								set.ConnParamId = null;
							}
							cmdauthdata.AuthObjectSet.AuthServiceSet.push(set);
						})
					}
				}
				
				if ($("#ips").data('value') != undefined && $("#ips").data('value') != '-1') {
					var serverid = '{"ServerScopeId":' + $("#ips").data('value') + ',"Type":1,"HostList":null,"IPList":null}';
					serverid = JSON.parse(serverid);
					cmdauthdata.AuthObjectSet.AuthScope.push(serverid);
				}

				$('#server_frame_list').children('div:not(:first)').each(function (i, item) {
					var v = $(item).attr('id');
					var serverid = '{"ServerScopeId":' + v + ',"Type":1,"HostList":null,"IPList":null}';
					serverid = JSON.parse(serverid);
					cmdauthdata.AuthObjectSet.AuthScope.push(serverid);
				});
				
				if (document.frm_access.tasktype.value == 3 && alldata.data[0].AuthObjectSet.AuthObject != null){
					$.each(alldata.data[0].AuthObjectSet.AuthObject,function(i,item){
						if (item.AccountName != null){
							var set = '{"HGId":'+item.HGId+',"HostId":'+item.HostId+',"HostServiceId":'+item.HostServiceId+',"AccountId":'+item.AccountId+'}';
							cmdauthdata.AuthObjectSet.DeleteAuthObject.push(JSON.parse(set));
						}else if (item.HostId != null){
							var set = '{"HGId":'+item.HGId+',"HostId":'+item.HostId+'}';
							cmdauthdata.AuthObjectSet.DeleteAuthObject.push(JSON.parse(set));
						}else{
							var set = '{"HGId":'+item.HGId+'}';
							cmdauthdata.AuthObjectSet.DeleteAuthObject.push(JSON.parse(set));
						}
					});
				}
				
			} else if (cmdauthdata.AuthMode == 4) {
				if ($("#ips").data('value') != undefined && $("#ips").data('value') != '-1') {
					var serverid = '{"ServerScopeId":' + $("#ips").data('value') + ',"Type":1,"HostList":null,"IPList":null}';
					serverid = JSON.parse(serverid);
					cmdauthdata.AuthObjectSet.AuthScope.push(serverid);
				}
			
				$('#server_frame_list').children('div:not(:first)').each(function (i, item) {
					var v = $(item).attr('id');
					var serverid = '{"ServerScopeId":' + v + ',"Type":1,"HostList":null,"IPList":null}';
					serverid = JSON.parse(serverid);
					cmdauthdata.AuthObjectSet.AuthScope.push(serverid);
				});
				
				if (document.frm_access.tasktype.value == 3 && alldata.data[0].AuthObjectSet.AuthObject != null){
					$.each(alldata.data[0].AuthObjectSet.AuthObject,function(i,item){
						if (item.AccountName != null){
							var set = '{"HGId":'+item.HGId+',"HostId":'+item.HostId+',"HostServiceId":'+item.HostServiceId+',"AccountId":'+item.AccountId+'}';
							cmdauthdata.AuthObjectSet.DeleteAuthObject.push(JSON.parse(set));
						}else if (item.HostId != null){
							var set = '{"HGId":'+item.HGId+',"HostId":'+item.HostId+'}';
							cmdauthdata.AuthObjectSet.DeleteAuthObject.push(JSON.parse(set));
						}else{
							var set = '{"HGId":'+item.HGId+'}';
							cmdauthdata.AuthObjectSet.DeleteAuthObject.push(JSON.parse(set));
						}
					});
				}
				
				if (account_arry.indexOf('-1') != -1) {
					account_arry.splice(account_arry.indexOf('-1'), 1);
				}
				cmdauthdata.AuthAccountId = account_arry.join(',');
				cmdauthdata.AuthObjectSet.AuthServiceSet = DeviceType.ServiceSet;
			} else {
				cmdauthdata.AuthObjectSet.DeleteAuthObject = [];
				save_host($("#hostTree"));
			}

			cmdauthdata.Enabled = savestep1.Enable;
			cmdauthdata.ResponseMode = savestep3.respone + savestep3.mode;
			if (savestep3.mode == 8)//审批策略
			{
				cmdauthdata.ApproveStrategyId = savestep3.approve;
			}
			else {
				cmdauthdata.ApproveStrategyId = null;
			}
			if (savestep3.respone == 1)//告警信息
			{
				cmdauthdata.EventAlarmInfoId = savestep3.woring;
			}
			else {
				cmdauthdata.EventAlarmInfoId = null;
			}

			var Content = $("#Content").val();
			Content_array = [];
			cmdauthdata.AuthCmdSet = [];
			if (Content != '') {
				//Content_array = JSON.stringify(Content.split('\n'));
				Content_str = Content;
				Content = window.btoa(window.encodeURIComponent(Content));
				cmdauthdata.AuthCmdSet.push(JSON.parse("{\"CmdSetId\":0,\"Type\":2,\"Content\":\"" + Content + "\"}"));
			}
			$.each(savestep3.cmd_all, function (i, item) {//指令集合
				if (item.CmdSetId != -1) {
					cmdauthdata.AuthCmdSet.push(JSON.parse("{\"CmdSetId\":" + parseInt(item.CmdSetId) + ",\"Type\": 1,\"Content\": null}"));
				}
			})
			cmdauthdata.AdminSet = [];
			for (var admin_i = savestep1.admin.length - 1; admin_i >= 0; admin_i--) {
				if (savestep1.admin[admin_i] != '-1') {
					cmdauthdata.AdminSet.push(JSON.parse("{\"AdminId\": " + savestep1.admin[admin_i] + "}"));
				}
			}
			cmdauthdata.AuthObjectSet.AuthUserSet = [];
			$.each(savestep1.ugid, function (i, item) {//组
				cmdauthdata.AuthObjectSet.AuthUserSet.push(item);
			})
			$.each(savestep1.uid, function (i, item) {//用户
				cmdauthdata.AuthObjectSet.AuthUserSet.push(item);
			})
		}
		var Content_array = [];
		var Content_str = "";
		function save_host(obj) {
			$(obj).find('span.checkbox').each(function (i, item) {
				if ($(item).parent()[0].tagName == "LABEL") return true;
				var state = $(item).attr('class');
				var $u = $(item).next().next().next().next();
				var $i = $(item).parent().find('ul:first').children('li');
				var $_authtype = $(item).siblings('span.authtype');

				var $_input = $(item).prev('input');
				var _id = $_input.attr("id").split('-');
				var loadfirst = $_input.attr('data-loadfirst');
				var loadlast = $_input.attr('data-loadlast');

				if ($_input.prop("disabled")) return true;
				if (loadfirst != loadlast) {
					if ((loadfirst == 0 && loadlast == 2) || (loadfirst == 1 && loadlast == 2)) { //add
						if ($_authtype.length != 0) {
							if ($_authtype.find('input').length != 0) {
								if ($_authtype.find('input').prop('checked')) { //按组授权
									if (_id[0] == "nodehg") {
										if (loadfirst == 1 && loadlast == 2) {
											var set = '{"HGId":' + _id[1] + ',"HostId":null,"IsGroupAuth":true,"IsDelOld":true}';
										} else {
											var set = '{"HGId":' + _id[1] + ',"HostId":null,"IsGroupAuth":true}';
										}
										var object_str = JSON.stringify(cmdauthdata.AuthObjectSet.AuthObject);
										if (object_str.indexOf(set) === -1) {
											cmdauthdata.AuthObjectSet.AuthObject.push(JSON.parse(set));
										}
									} else {
										var HGroupId = _id[1]
										var HostId = _id[2];
										if (loadfirst == 1 && loadlast == 2) {
											var set = '{"HGId":' + HGroupId + ',"HostId":' + HostId + ',"IsGroupAuth":true,"IsDelOld":true}';
										} else {
											var set = '{"HGId":' + HGroupId + ',"HostId":' + HostId + ',"IsGroupAuth":true}';
										}
										var object_str = JSON.stringify(cmdauthdata.AuthObjectSet.AuthObject);
										if (object_str.indexOf(set) === -1) {
											cmdauthdata.AuthObjectSet.AuthObject.push(JSON.parse(set));
										}
									}
								} else {
									if ($(item).parent().parent().siblings('span.checkbox').length != 0) {
										if ($(item).parent().parent().siblings('span.checkbox').attr('class').indexOf('checked') != -1) {
											return true;
										}
									}
									if (_id[0] == "nodehg") {
										if (loadfirst == 1 && loadlast == 2) {
											var set = '{"HGId":' + _id[1] + ',"HostId":null,"IsGroupAuth":false,"IsDelOld":true}';
										} else {
											var set = '{"HGId":' + _id[1] + ',"HostId":null,"IsGroupAuth":false}';
										}

										var object_str = JSON.stringify(cmdauthdata.AuthObjectSet.AuthObject);
										if (object_str.indexOf(set) === -1) {
											cmdauthdata.AuthObjectSet.AuthObject.push(JSON.parse(set));
										}
									} else {
										var HGroupId = _id[1]
										var HostId = _id[2];
										if (loadfirst == 1 && loadlast == 2) {
											var set = '{"HGId":' + HGroupId + ',"HostId":' + HostId + ',"IsGroupAuth":false,"IsDelOld":true}';
										} else {
											var set = '{"HGId":' + HGroupId + ',"HostId":' + HostId + ',"IsGroupAuth":false}';
										}
										var object_str = JSON.stringify(cmdauthdata.AuthObjectSet.AuthObject);
										if (object_str.indexOf(set) === -1) {
											cmdauthdata.AuthObjectSet.AuthObject.push(JSON.parse(set));
										}
									}
								}
							} else {//未分组
								if (_id[0] == "nodehg") {
									if (loadfirst == 1 && loadlast == 2) {
										var set = '{"HGId":' + _id[1] + ',"HostId":null,"IsGroupAuth":false,"IsDelOld":true}';
									} else {
										var set = '{"HGId":' + _id[1] + ',"HostId":null,"IsGroupAuth":false}';
									}
									var object_str = JSON.stringify(cmdauthdata.AuthObjectSet.AuthObject);
									if (object_str.indexOf(set) === -1) {
										cmdauthdata.AuthObjectSet.AuthObject.push(JSON.parse(set));
									}
								}
							}
						} else { //服务账号
							if ($(item).parent().parent().siblings('span.checkbox').length != 0) {
								if ($(item).parent().parent().siblings('span.checkbox').attr('class').indexOf('checked') != -1) {
									return true;
								}
							}
							if (_id[0] == "nodes") {
								var HGroupId = _id[1];
								var HostId = _id[2];
								var HostServiceId = _id[3];
								$(item).siblings('ul').children('li').each(function (i1, item1) {
									var AccountId = $(item1).children('input').attr('id').split('-')[3];
									var set = '{"HGId":' + HGroupId + ',"HostId":' + HostId + ',"HostServiceId":' + HostServiceId + ',"AccountId":' + AccountId + '}';
									var object_str = JSON.stringify(cmdauthdata.AuthObjectSet.AuthObject);
									if (object_str.indexOf(set) === -1) {
										cmdauthdata.AuthObjectSet.AuthObject.push(JSON.parse(set));
									}
								})
							} else {
								var HGroupId = _id[1];
								var HostId = _id[2];
								var AccountId = _id[3];
								var HostServiceId = _id[4];
								var set = '{"HGId":' + HGroupId + ',"HostId":' + HostId + ',"HostServiceId":' + HostServiceId + ',"AccountId":' + AccountId + '}';
								var object_str = JSON.stringify(cmdauthdata.AuthObjectSet.AuthObject);
								if (object_str.indexOf(set) === -1) {
									cmdauthdata.AuthObjectSet.AuthObject.push(JSON.parse(set));
								}
							}
						}
					} else if ((loadfirst == 2 && loadlast == 0) || (loadfirst == 1 && loadlast == 0)) {
						var $p_input = $(item).parent().parent().siblings('input');
						if ($p_input.length != 0) {
							var p_loadfirst = $p_input.attr('data-loadfirst');
							var p_loadlast = $p_input.attr('data-loadlast');
							if (p_loadfirst == 2 && p_loadlast == 0) {
								return true;
							}
						}
						if (_id[0] == "nodehg") {
							var set = '{"HGId":' + _id[1] + ',"HostId":null}';
							var object_str = JSON.stringify(cmdauthdata.AuthObjectSet.DeleteAuthObject);
							if (object_str.indexOf(set) === -1) {
								cmdauthdata.AuthObjectSet.DeleteAuthObject.push(JSON.parse(set));
							}
						} else if (_id[0] == "nodeh") {
							var HGroupId = _id[1];
							var HostId = _id[2];
							var set = '{"HGId":' + HGroupId + ',"HostId":' + HostId + '}';
							var object_str = JSON.stringify(cmdauthdata.AuthObjectSet.DeleteAuthObject);
							if (object_str.indexOf(set) === -1) {
								cmdauthdata.AuthObjectSet.DeleteAuthObject.push(JSON.parse(set));
							}
						} else if (_id[0] == "nodes") {
							var HGroupId = _id[1];
							var HostId = _id[2];
							var HostServiceId = _id[3];
							$(item).siblings('ul').children('li').each(function (i1, item1) {
								var AccountId = $(item1).children('input').attr('id').split('-')[3];
								var set = '{"HGId":' + HGroupId + ',"HostId":' + HostId + ',"HostServiceId":' + HostServiceId + ',"AccountId":' + AccountId + '}';
								var object_str = JSON.stringify(cmdauthdata.AuthObjectSet.DeleteAuthObject);
								if (object_str.indexOf(set) === -1) {
									cmdauthdata.AuthObjectSet.DeleteAuthObject.push(JSON.parse(set));
								}
							});
						} else if (_id[0] == "nodea") {
							var HGroupId = _id[1];
							var HostId = _id[2];
							var AccountId = _id[3];
							var HostServiceId = _id[4];
							var set = '{"HGId":' + HGroupId + ',"HostId":' + HostId + ',"HostServiceId":' + HostServiceId + ',"AccountId":' + AccountId + '}';
							var object_str = JSON.stringify(cmdauthdata.AuthObjectSet.DeleteAuthObject);
							if (object_str.indexOf(set) === -1) {
								cmdauthdata.AuthObjectSet.DeleteAuthObject.push(JSON.parse(set));
							}
						}
					} else if (loadfirst == 2 && loadlast == 1) {
						if ($_input.attr('data-ifselect')) {
							if (_id[0] == "nodehg") {
								var set = '{"HGId":' + _id[1] + ',"HostId":null,"IsGroupAuth":false,"IsDelOld":true}';
								var object_str = JSON.stringify(cmdauthdata.AuthObjectSet.AuthObject);
								if (object_str.indexOf(set) === -1) {
									cmdauthdata.AuthObjectSet.AuthObject.push(JSON.parse(set));
								}
							} else if (_id[0] == "nodeh") {
								var HGroupId = _id[1];
								var HostId = _id[2];
								var set = '{"HGId":' + HGroupId + ',"HostId":' + HostId + ',"IsGroupAuth": false,"IsDelOld":true}';
								var object_str = JSON.stringify(cmdauthdata.AuthObjectSet.AuthObject);
								if (object_str.indexOf(set) === -1) {
									cmdauthdata.AuthObjectSet.AuthObject.push(JSON.parse(set));
								}
							}
						}
					}
				} else {
					if ($_authtype.length != 0) {
						if ($_authtype.find('input').length != 0) {
							if (($_authtype.find('input').prop('checked')) && ($_input.attr('data-ifselect') == 'false')) { //未按组——>按组授权
								if (_id[0] == 'nodehg') cmdauthdata.AuthObjectSet.AuthObject.push(JSON.parse('{"HGId": ' + _id[1] + ',"HostId": null,"IsGroupAuth": true,"IsDelOld":true}'));
								else cmdauthdata.AuthObjectSet.AuthObject.push(JSON.parse('{"HGId": ' + _id[1] + ',"HostId": ' + _id[2] + ',"IsGroupAuth": true,"IsDelOld":true}'));
							} else if (($_authtype.find('input').prop('checked') == false) && ($_input.attr('data-ifselect') == 'true')) {
								if (_id[0] == 'nodehg') {
									cmdauthdata.AuthObjectSet.AuthObject.push(JSON.parse('{"HGId": ' + _id[1] + ',"HostId": null,"IsGroupAuth": false,"IsDelOld":true}'));
								}
								else {
									cmdauthdata.AuthObjectSet.AuthObject.push(JSON.parse('{"HGId": ' + _id[1] + ',"HostId": ' + _id[2] + ',"IsGroupAuth": false,"IsDelOld":true}'));
								}
							}
						}
					}
				}
			});
		}


		function get_access()//获取访问策略
		{
			$.ajax({
				url: "/bhost/get_access_x",
				type: "POST",
				async: false,
				data: { a0: se },
				success: function (result) {
					var access_result = JSON.parse(result);
					if (access_result.Result == false) {
						_alert(1, "指令授权", "执行失败：" + access_result.ErrMsg);
						return false;
					}
					else {
						$.each(access_result.data, function (i, item) {
							$("#access").append('<option value="' + item.AccessStrategyId + '">' + item.AccessStrategyName + '</option>');
						})
					}
				}
			})
		}
		function _delcmd(obj) {//删除指令集合
			var $c = $(obj).parent();
			var v = $c.find('select:first').children('option:selected').text();
			var index = $("#xx").children('div').index($(obj).parent());
			$('.btn').blur();
			parent.layer.open({
				type: 1,
				title: '指令授权',
				content: '<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
				btn: ['确&nbsp;&nbsp;定', '取&nbsp;&nbsp;消'],
				btnAlign: 'c',
				closeBtn: false,
				skin: 'layer-custom',
				area: ['380px', '310px'],
				move: false,
				resize: false,
				btn1: function (i) {
					$c.fadeOut(function () {
						$c.remove();
						cmdset.splice(index, 1);
						var cmdset_temp = [];
						cmdset_temp = cmdset.reverse();
						cmdset = [];
						$("#cmd").children('option').remove();
						$("#cmd").append('<option value="0">请选择</option>');
						$.each(cmd_data.data, function (i, item) {
							$("#cmd").append('<option value="' + item.CmdSetId + '">' + item.Name + '</option>');
						});
						$("#cmd").parent().parent().find('div').not('div:first').remove();
						$.each(cmdset_temp, function (i, item) {
							if (item != '0') {
								$("#cmd").val(item).trigger('change');
								if (i != cmdset_temp.length - 1) {
									$("#cmd").parent().children('i.add').click();
								}
							}
						})
					});
					parent.layer.close(i);
				},
				btn2: function (i) {
					parent.layer.close(i);
				}
			});
		}

		var cmdset = ['-1'];
		function change_cmd(obj) {
			var t = $(obj).find('span').data('value');
			if (cmdset.indexOf(t) === -1 && t != undefined) {
				cmdset.splice(0, 1, t);
			}
			/*
			if ($(obj).siblings('li').length == 2 && t != '-1') {
				$(obj).parent().children('i.add').click();
				$(obj).parent().hide();
			}
			*/
		}



		function _addcmd(obj) {//添加指令集合
			var cmdset_id = $(obj).prev('div').data('value');
			var v = $(obj).prev('div').find('span').text();
			if (cmdset_id == undefined || cmdset_id == '-1') {
				_alert(2, "指令授权", "请选择指令集合");
				return false;
			}
			cmdset.splice(0,0,'-1');
			cmd_index_all.splice($.inArray(parseInt(cmdset_id),cmd_index_all),1);
			var $c = $('<div style="width:170px;margin-top: -15px;margin-left: 9px;" class="item" id="' + cmdset_id + '"/>');
			$c.html('<input style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;width: 122px;padding: 0 8px;border-radius: 2.5px;" typr="text" class="form-text" disabled="true" value="' + v + '"><i class="ctrl del" onclick="_del_scope(this,1)"></i>');
			
			$(obj).parent().after($c);
			$("#cmd").find('span').text('请选择');
			$("#cmd").data('value',-1);
			$("div[data-id=xSelect-cmd]").children('input').val('');
			$("div[data-id=xSelect-cmd]").find('span[data-value='+cmdset_id+']').parent('li').remove();
		}
		
		
		
		function check_range_list()//核对服务器ID
		{
			var a = 0;
			var range = range_list.split(",");
			$('#rangelist div.item').each(function (i, item) {
				v = $(item).children("select").children('option:selected').val();
				$.each(range, function (i, item) {
					if (v == item) {
						a = 1;
					}
				})
			})
			if (a == 1) {
				_alert(1, '指令授权', '范围重复');
				return false;
			}
		}
		function _checkCls(obj, type) {
			if (type == 1) {
				var len = $(obj).parent().parent().children('li').length;
				var n = 0;
				$(obj).parent().parent().children('li').each(function (z, zitem) {
					if ($('input[type=checkbox]', zitem).prop('checked')) {
						n++;
					}
				});

				if (n == len) {
					$(obj).parent().parent().parent().children('input[type=checkbox]').prop('checked', true).next('span.checkbox').attr('class', 'checkbox checked');
				} else {
					$(obj).parent().parent().parent().children('input[type=checkbox]').prop('checked', false).next('span.checkbox').attr('class', 'checkbox half');
				}
			} else if (type == 2) {
				var n = 0;
				$(obj).parent().siblings('li').each(function (z, zitem) {
					if ($('input[type=checkbox]', zitem).prop('checked')) {
						n++;
					}
				});

				if (n == 0) {
					$(obj).parent().parent().parent().children('input[type=checkbox]').prop('checked', false).next('span.checkbox').attr('class', 'checkbox');
				} else {
					$(obj).parent().parent().parent().children('input[type=checkbox]').prop('checked', false).next('span.checkbox').attr('class', 'checkbox half');
				}
			}
		}

		function clear_server() {
			server = {
				"ServerScopeId": 0,
				"ServerScopeName": "",
				"IsApplyToClientScope": false,
				"HostList": [],
				"IPList": {
					"IPSetId": 0,
					"Set": []
				}
			}
			
			data_array_Path = null;
			search_typeall_r = '';
			$("#ip_n1").children('span').not('span:first').remove();
			$("#ip_n").children('span').not('span:first').remove();
			$("#ip_n1").find('input:eq(0)').val('');
			$("#ip_n").find('input:eq(0)').val('');
			$("#ip_n").find('input:eq(1)').val('');
			$("#d_n").val('');
			$("#d_n").attr("disabled", false);
			$("#d_n").next('i').attr("class", 'v-check');
			$("#userTree1").empty();
			$("#server_select").val('all').trigger('change');
			$("#server_text").val('');
			$("#filterWW").children('ul').children('li').remove();
			$("#filterWW").hide();
			$("#clearFilter1").hide();
			$("#d_n").next('i').attr('class', 'v-check');
			$('#part1').iCheck('check');
		}
		var init_tree = 0;
		var last_object_s = [];
		function _editNode(obj, name) {
			clear_server();
			var title;
			if (name == 1) {
				//serverId = $(obj).parent().children('a').attr('id');
				serverId = $(obj).children('span').data('value');
				$.ajax({
					url: "/bhost/get_server_list",
					type: "POST",
					async: false,
					data: { a0: se, a1: serverId },
					success: function (result) {
						var server_result = JSON.parse(result);
						if (server_result.Result == true) {
							var server_data = server_result.info.data[0];
							//title = server_data.ServerScopeName;
							server_edit = server_data;
							last_object_s = server_data.HostList;
							title = "服务器范围";
						}
					}
				});
			} else {
				server_edit = null;
				serverId = 0;
				title = "服务器范围";
			}
			var $dialogCont = $("#server_suspend").show();

			var d = dialog({
				title: title,
				content: $dialogCont,
				id: "server_suspend",
				width: "1000px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			//$("#title:server_suspend").css("width","100px");
			$(".ui-dialog-title").css("width", "140px");
			server_main(name);

			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				if (name == 1){
					init_tree = 0;
				}else{
					init_tree = 1;
				}
				clear_server();
				server_main(name);
				//d.close().remove();
			});

			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				server_add(d);
			})
		}

		var server = {
			"ServerScopeId": 0,
			"ServerScopeName": "",
			"IsApplyToClientScope": false,
			"HostList": [],
			"EnableIPLimit":1,
			"IPList": {
				"IPSetId": 0,
				"Set": []
			}
		};
		//var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
		var ipReg = /^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])(\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])){3}$/;
		var server_edit = null;
		var type = 1;
		var serverId = 0;
		function server_main(name) {
			if (manage_auth_array.indexOf(15) === -1 && manage_auth_array.indexOf(16) === -1 && manage_auth_array.indexOf(17) === -1 && manage_auth_array.indexOf(18) === -1 && manage_auth_array.indexOf(20) === -1 && manage_auth_array.indexOf(21) === -1){
				$("#server_suspend").find('.btn-submit').remove();
			}
			if (name == 1) {
				$("#d_n").val(server_edit.ServerScopeName);
				$("#d_n").attr("disabled", true);
				server.ServerScopeId = server_edit.ServerScopeId;
				server.ServerScopeName = server_edit.ServerScopeName;
				if (server.IPList != null) {
					server.IPList.IPSetId = server_edit.IPList.IPSetId;
					if (server_edit.IPList.Set != null) {
						var IPset_group = server_edit.IPList.Set.filter(function (params) {
							return params.StartIP != params.EndIP
						});
						var IP_group = server_edit.IPList.Set.filter(function (params) {
							return params.StartIP == params.EndIP
						});
						for (var i = 0; i < IPset_group.length - 1; i++) {
							var $c = $('<span class="ss" value="' + IPset_group[i].IPSetMemberId + '" style="float: left;width: 312px;position: static;padding: 0 0 10px 0;"/>');
							$c.html('<input type="text" class="form-text" value="' + IPset_group[i].StartIP + '"  style="width:110px;">'
								+ '<span style="vertical-align:middle;padding-left: 4px;padding-right: 4px;">-</span>'
								+ '<input type="text" class="form-text" value="' + IPset_group[i].EndIP + '"  style="width:110px;">'
								+ '<i class="ctr ctr-del" style="margin-top: 5px;margin-left: -3px;" onclick="_delIp(this)"></i>');
							$("#ip_n").find("span[class='ss ss-add']").after($c);
						}
						if (IPset_group.length != 0) {
							$('#ip_n').find("span[class='ss ss-add']").attr('value', IPset_group[i].IPSetMemberId);
							var $ip_input = $('#ip_n').find("span[class='ss ss-add']").find('input');
							$ip_input.first().val(IPset_group[i].StartIP);
							$ip_input.last().val(IPset_group[i].EndIP);
						}
						for (var i = 0; i < IP_group.length - 1; i++) {
							var $c = $('<span class="ss" value="' + IP_group[i].IPSetMemberId + '" style="float: left;position: static;padding: 0 0 10px 0;"/>');
							$c.html('<input type="text" class="form-text" style="width:110px;" value="' + IP_group[i].StartIP + '" >'
								+ '<i class="ctr ctr-del" onclick="_delIp(this)" style="    margin-top: 4px;    margin-left: -3px;"></i>');
							$('#ip_n1').find("span[class='ss ss-add']").after($c);
						}
						if (IP_group.length != 0) {
							$('#ip_n1').find("span[class='ss ss-add']").attr('value', IP_group[i].IPSetMemberId);
							$('#ip_n1').find("span[class='ss ss-add']").find('input').val(IP_group[i].StartIP);
						}
					}
					/*
					$.each(server_edit.IPList.Set, function (i, item) {
						if (item.StartIP != item.EndIP) {
							var $c = $('<span class="ss" value="' + item.IPSetMemberId + '" style="float: left;width: 312px;position: static;padding: 0 0 10px 0;"/>');
							$c.html('<input type="text" class="form-text" value="' + item.StartIP + '" style="width:110px;">'
								+ '<span style="vertical-align:middle;padding-left: 4px;padding-right: 4px;">-</span>'
								+ '<input type="text" class="form-text" value="' + item.EndIP + '" style="width:110px;">'
								+ '<i class="ctr ctr-del" style="margin-top: 5px;margin-left: -3px;" onclick="_delIp(this)"></i>');
							$("#ip_n").find("span[class='ss ss-add']").after($c);
						} else {
							var $c = $('<span class="ss" value="' + item.IPSetMemberId + '" style="float: left;position: static;padding: 0 0 10px 0;"/>');
							$c.html('<input type="text" class="form-text" style="width:110px;" value="' + item.StartIP + '" >'
								+ '<i class="ctr ctr-del" onclick="_delIp(this)" style="margin-top: 4px;margin-left: -3px;"></i>');
							$('#ip_n1').find("span[class='ss ss-add']").after($c);
						}
					});
					*/
				}
				if(server_edit.EnableIPLimit == 0){
					$('#part1').iCheck('uncheck');
				}
			}
			usercode = window.parent.document.frm.us.value;
			_initList1();
			$('#userTree1').on('change', 'span.authtype input', function () {
				var checked = $(this).prop('checked');
				_authTypeTheme($(this));
				if (checked) {
					var $input1 = $(this).parent().parent().siblings('ul').find('span.authtype input');
					var $input2 = $(this).parent().parent().siblings('ul').find('input.zcheck');
					var $input3 = $(this).parent().parent().siblings('input.zcheck');
					//
					$input2.attr("data-loadlast", 2);
					$input3.attr("data-loadlast", 2);
					$(this).attr('data-ifselect', true);
					$input1.prop('disabled', true);
					_authTypeTheme($input1);
					$input2.prop('checked', true).prop('disabled', true);
					$(this).parent().parent().siblings('input.zcheck').prop('checked', true).next('span.checkbox').attr('class', 'checkbox checked');;
					$.each($input2, function () {
						$(this).next('span.checkbox').attr('class', 'checkbox checked disabled');
					});
	
					_checkEvent($(this).parent().parent().siblings('input.zcheck'));
				} else {
					var $input1 = $(this).parent().parent().siblings('ul').children('li').find('span.authtype').find('input');
					var $input2 = $(this).parent().parent().siblings('ul').children('li').find('input.zcheck');
					$(this).attr('data-ifselect', false);
					$input1.prop('disabled', false);
					//$input1.iCheck('update');
					_authTypeTheme($input1);
					//$input2.prop('disabled',false);
					//$input2.next('span.checkbox').removeClass('disabled');
					_checkEvent1($(this));
				}
			}).on('dblclick', 'i.h-eicon,span.h-name', function () {
				var i_class_arr = $(this).siblings('i.h-aicon');
				if (i_class_arr.length == 0) {
					return false;
				}
				var $item = i_class_arr;
				var id = $item.data('id').split('-')[1];
				var $u = $item.parent().children('ul');
				if ($u.is(':hidden')) {
					$item.addClass('h-aicon-d');
					$u.show();
					if ($u.children('li').length == 0) {
						var v = 2, d;
						var $input = $(this).siblings('span.checkbox');
						if ($(this).siblings('span.authtype').find('input').is(':checked')) {
							d = 0;
						} else {
							d = 1;
						}
	
						if ($input.attr('class').indexOf('disabled') > 0) {
							d = 0;
						}
						var c = $input.attr('class');
						if (c.indexOf('checked') > 0) {
							v = 1;
						} else if (c == 'checkbox') {
							v = 0;
						}
						_initHTML1($u, id, v, d);
					}
				} else {
					$item.removeClass('h-aicon-d');
					$u.hide();
				}
			});
			parent._switchBtn(0);//隐藏按钮
		}

		var host_path_all_s;
		var index_f_s = 0;
		var push_hgid_s = [];
		var push_hid_s = [];
		var hdata_s = null;
		var filter_flag_append_s = false;
		var flag_loading_s = false;
		var loading_hgid_s = 0;
		var find_host_arry_s = [];
		var find_host_flag_s = 0;
		var old_path_all_s = [];
		var push_filter_wait_s = [];
		//获取host服务器范围
		function get_hostdirectory_s() {
			$.ajax({
				url: '/bhost/get_hostdirectory',
				type: 'POST',
				async: false,
				data: { a0: se, a2: "0", a5: serverId, a6: '1' },
				success: function (result) {
					hdata_s = JSON.parse(result).info.data;
					if (serverId > 0) {
						$(hdata_s.HGroup).each(function (i, item) {
							if (push_hgid_s.indexOf(item.HGId) < 0) {
								push_hgid_s.push(item.HGId + ":false");
							}
						})
					}
				}
			})

		}
		//加载树
		function _initList1() {
			get_hostdirectory_s();
			_viewHTML1('#userTree1');
			//下拉按钮触发
			$('#userTree1').unbind();
			$('#userTree1').on('click', 'i.h-aicon', function () {
				var $item = $(this);
				var id = $item.data('id').split('-')[1];
				var $u = $item.parent().children('ul');
				if ($u.is(':hidden')) {
					$item.addClass('h-aicon-d');
					$u.show();
					if ($u.children('li').length == 0) {
						var v = 2, d;
						var $input = $(this).siblings('span.checkbox');
						if ($(this).siblings('span.authtype').find('input').is(':checked')) {
							d = 0;
						} else {
							d = 1;
						}

						if ($input.attr('class').indexOf('disabled') > 0) {
							d = 0;
						}
						var c = $input.attr('class');
						if (c.indexOf('checked') > 0) {
							v = 1;
						} else if (c == 'checkbox') {
							v = 0;
						}
						_initHTML1($u, id, v, d);
					}
				} else {
					$item.removeClass('h-aicon-d');
					$u.hide();
				}

			})

		}
		//加载下拉树
		function _initHTML1(obj, id, v, d) {
			$(obj).empty();
			//过滤中 不需要 showloading
			if (filter_flag_append_s == true)
				filter_flag_append_s = false;
			else
				_showLoading();
			flag_loading_s = true;
			var loading_hgid_s;
			$.ajax({
				url: '/bhost/get_hostdirectory',
				type: 'post',
				async: true,
				data: { a0: se, a2: id, a5: serverId, a6: '1' ,a7: ajax_find_host_doing_s ? 'true' : 'false'},
				success: function (result) {
					var hdata_s = JSON.parse(result).info.data;
					loading_hgid_s = id;
					if (serverId > 0 && ajax_find_host_doing_s == false) disabled_flag_s = "disabled";
					else disabled_flag_s = "";
					var loadfirst = 0;
					var loadlast = 0;
					var parent_id = $(obj).siblings('input').attr('id').split('-')[1];
					var _p_loadfirst = $(obj).siblings('input').attr('data-loadfirst');
					var _p_loadlast = $(obj).siblings('input').attr('data-loadlast');
					var auth_type_checked = false;
					if ($(obj).siblings('span.authtype').find('input').length != 0) {
						auth_type_checked = $(obj).siblings('span.authtype').find('input').prop('checked');
					}
					if ((_p_loadfirst == 0) && (_p_loadlast == 0)) {
					}
					if (auth_type_checked) {
						disabled_flag_s = "";
					}
					if (_p_loadfirst == _p_loadlast) {
						if (_p_loadlast == 2) {
							loadfirst = 2
							loadlast = 2;
						}
					} else {
						if (_p_loadlast == 2) {
							loadlast = 2;
						}
						if (_p_loadfirst == 2) {
							loadfirst = 2;
						}
	
					}
					
					
					if (hdata_s.HGroup == null) hdata_s.HGroup = [];
					$.each(hdata_s.HGroup, function (i, item) {
						if (item.Mode == 2) var $auth = '<label><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag_s + ' data-mode="' + item.Mode + '" >组授权</label>';
						else var $auth = '<label style="display:none"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag_s + ' data-mode="' + item.Mode + '" >组授权</label>';
						if (ajax_find_host_doing_s == true && $(obj).siblings('span.h-name-red').length == 0) {
							var $H = $('<li style="display: none;"></li>');
						} else {
							var $H = $('<li></li>');
						}
	
						if ((item.MemberNum + item.HostNum) == 0) i_class = "h-blank";
						else i_class = "h-aicon";
	
						//data-loadfirst(初始的状态) 0->未选中 1->部分选中 2->全选中 
						//data-loadlast(最后保存的状态) 
						if (v == 1 && d == 0) {
							disabled_flag_s = "disabled";
							if (item.Mode == 2) $auth = '<label><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag_s + ' data-mode="' + item.Mode + '" >组授权</label>';
							else $auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag_s + ' data-mode="' + item.Mode + '" >组授权</label>';
							$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" checked="checked" id="HGId-' + item.HGId + '" data-check="1" class="zcheck zcheck-g" ' + disabled_flag_s + ' data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-mode="2" data-name="'+item.HGName+'"><i class="h-eicon h-eicon-g"></i><span class="h-name" id="spanhgs-'+item.HGId+'" style="width:12em;">' + '<span class="h-name-son" style="">' + item.HGName.split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') + 
								'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
						} else if (v == 1) { //v == 1 d ==1
							$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" checked="checked" id="HGId-' + item.HGId + '" data-check="1" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-mode="2" data-name="'+item.HGName+'"><i class="h-eicon h-eicon-g"></i><span class="h-name" id="spanhgs-'+item.HGId+'" style="width:12em;">' + '<span class="h-name-son" style="">' + item.HGName.split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') + 
								'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
						} else if (v == 0) {
							$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" id="HGId-' + item.HGId + '" data-check="0" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-mode="2" data-name="'+item.HGName+'"><i class="h-eicon h-eicon-g"></i><span class="h-name" id="spanhgs-'+item.HGId+'" style="width:12em;">' + '<span class="h-name-son" style="">' + item.HGName.split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') + 
								'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
						} else {
							$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" id="HGId-' + item.HGId + '" data-check="0" class="zcheck zcheck-g" ' + disabled_flag_s + ' data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-ifselect=false data-mode="2" data-name="'+item.HGName+'"><i class="h-eicon h-eicon-g"></i><span class="h-name" id="spanhgs-'+item.HGId+'" style="width:12em;">' + '<span class="h-name-son" style="">' + item.HGName.split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') + 
								'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
	
						}
						if (serverId > 0) {
							if (!auth_type_checked) {
								if (push_hgid_s.indexOf(item.HGId+":false") < 0) {
									push_hgid_s.push(item.HGId + ":false");
								}
							}
						}
						$(obj).append($H);
					})
					_checkView_host(obj);
					if (serverId > 0) {
						select_checkbox_s("HGroup", parent_id);	 //只有编辑情况下 才需要判断 select 
					}
					if (hdata_s.Host == null) {
						hdata_s.Host = [];
						flag_loading_s = false;
						if(flag_save == 0){
							_closeLoading();
						}
						return false;
					}
					var i = 0;
					var index_s = 0;
					
					$.each(hdata_s.Host,function (i,item) {
						if((item.Selected==0 && item.Mode==0 && ajax_find_host_doing_s==true) || (serverId<=0 && item.Mode==0)){
							return true;
						}
						if(ajax_find_host_doing_s==true && $(obj).siblings('span.h-name-red').length==0){
							var $H = $('<li style="display: none;"></li>');
						}else{
							var $H = $('<li></li>');
						}
						// if(hdata.Host[i].AccountNum == 0) i_class = "h-blank";
						// else i_class = "h-aicon";
						i_class = "h-blank";
						//var HostName_h = autoAddEllipsis(item.HostName,'12');
						var HostName_h = item.HostName
						if (v == 1 && d == 0) {
							$H.html('<i class="' + i_class + '" data-id="arrH-' + item.HostId + '" /><input type="checkbox" checked="checked" id="HostId-' + parent_id + '-' + item.HostId + '" data-check="1" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-ifselect=false disabled data-mode="' + item.Mode + '" data-name="' + item.HostIP + '\t' + item.HostName + '"><i class="h-eicon h-eicon-u"></i><span class="h-name" id="spanhs-'+ parent_id +'-'+ item.HostId + '" style="width: 16em;">' + '<span class="h-name-son" style="">' + 
								( item.HostIP+ '(' + HostName_h  + ')').split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') +
								'</span>' + '</span><ul style="display:none">Loading...</ul>');
						} else if (v == 1) {
							$H.html('<i class="' + i_class + '" data-id="arrH-' + item.HostId + '" /><input type="checkbox" checked="checked" id="HostId-' + parent_id + '-' + item.HostId + '" data-check="1" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-ifselect=false data-mode="'+item.Mode+'" data-name="' + item.HostIP + '\t' + item.HostName + '"><i class="h-eicon h-eicon-u"></i><span class="h-name" id="spanhs-'+ parent_id +'-'+ item.HostId + '" style="width: 16em;">' + '<span class="h-name-son" style="">' + 
								( item.HostIP+ '(' + HostName_h + ')').split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') +
								'</span>' + '</span><ul style="display:none">Loading...</ul>');
						} else if (v == 0) {
							$H.html('<i class="' + i_class + '" data-id="arrH-' + item.HostId + '" /><input type="checkbox" id="HostId-' + parent_id + '-' + item.HostId + '" data-check="0" class="zcheck zcheck-g" data-ifselect=false data-mode="'+item.Mode+'" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-name="' + item.HostIP + '\t' + item.HostName + '"><i class="h-eicon h-eicon-u"></i><span class="h-name" id="spanhs-'+ parent_id +'-'+ item.HostId + '" style="width: 16em;">' + '<span class="h-name-son" style="">' + 
								( item.HostIP+ '(' + HostName_h + ')').split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') +
								'</span>' + '</span><ul style="display:none">Loading...</ul>');
						} else {
							$H.html('<i class="' + i_class + '" data-id="arrH-' + item.HostId + '" /><input type="checkbox" id="HostId-' + parent_id + '-' + item.HostId + '" data-check="0" class="zcheck zcheck-g" data-loadfirst=0 data-loadlast=' + loadlast + ' ' + disabled_flag_s + ' data-ifselect=false data-mode="'+item.Mode+'" data-name="' + item.HostIP + '\t' + item.HostName + '"><i class="h-eicon h-eicon-u" class="zcheck"></i><span class="h-name" id="spanhs-'+ parent_id +'-'+ item.HostId + '" style="width: 16em;">' + '<span class="h-name-son" style="">' + 
								( item.HostIP+ '(' + HostName_h + ')').split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') +
								'</span>' + '</span><ul style="display:none">Loading...</ul>');
						}
						if (serverId > 0) {
							if (!auth_type_checked) {
								if (push_hid_s.indexOf(parent_id + ':' + item.HostId) < 0) {
									if (ajax_find_host_doing_s == false) {
										push_hid_s.push(parent_id + ':' + item.HostId + ":false");
									}
								}
							}
						}
						$(obj).append($H);
						_checkView1($('#HostId-' + parent_id + '-' + item.HostId));
					});
					if(flag_save == 0){
						_closeLoading();
					}
					if(ajax_find_host_doing_s==false){
						select_checkbox_s("Host",parent_id);
					}
					flag_loading_s = false;
				}
			});
		}

		//根目录
		function _viewHTML1(obj) {
			if (init_tree == 0){
				_showLoading();
			}
			$.ajax({
				url: '/bhost/get_hostdirectory',
				type: 'POST',
				async: false,
				data: { a0: se, a2: "0", a5: serverId, a6: '1' },
				success: function (result) {
					hdata_s = JSON.parse(result).info.data;
					/*
					if (serverId > 0) {
						$(hdata_s.HGroup).each(function (i, item) {
							if (push_hgid_s.indexOf(item.HGId) < 0) {
								push_hgid_s.push(item.HGId + ":false");
							}
						})
					}
					*/
					$(obj).empty();
					disabled_flag_s = "";
					if (serverId > 0) disabled_flag_s = "disabled";
					$.each(hdata_s.HGroup, function (i, item) {
						if (item.Mode == 2){
							var $auth = '<label><input type="checkbox" name="check'+item.HGId+'" data-ifselect=false '+disabled_flag_s+' data-mode="'+item.Mode+' " >组授权</label>';
						}else{
							var $auth = '';
						}
						if (item.HGId==1){
							var $auth = '';
						}
						var $H = $('<li></li>');
						//data-loadfirst(初始的状态) 0->未选中 1->部分选中 2->全选中 
						//data-loadlast(最后保存的状态) 
						//data-ifselect(组或者主机 是否是按组授权或者 按主机授权)
						if ((item.MemberNum + item.HostNum) == 0) i_class = "h-blank";
						else i_class = "h-aicon";
						$H.html('<i class="' + i_class + '" data-id="arrHG-' + item.HGId + '" /><input type="checkbox" id="HGId-' + item.HGId + '" data-check="0" class="zcheck zcheck-g" ' + disabled_flag_s + ' data-loadfirst=0 data-loadlast=0 data-ifselect=false data-mode="2" data-name="' + item.HGName + '" ><i class="h-eicon h-eicon-g" ></i><span class="h-name" id="spanhgs-'+item.HGId+'" style="width:12em;">' + '<span class="h-name-son" style="">' + item.HGName.split('').map(function (params) {
								return '<font>'+params+'</font>'    
							}).join('') + 
							'</span>' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
						$(obj).append($H);
						if (serverId > 0) {
							if (push_hgid_s.indexOf(item.HGId + ":false") < 0) {
								push_hgid_s.push(item.HGId + ":false");
							}
						}
					});
					_checkView_host(obj);
					if (serverId > 0) {
						select_checkbox_s("HGroup", 0);	 //只有编辑情况下 才需要判断 select 
					}
				}
			});
		}

		//删除ip
		function _delIp(obj) {
			var $c = $(obj).parent();
			var $v = $c.find('input');
			if ($v.length == 1) {
				var input = $v.eq(0).val();
			} else {
				var input = $v.eq(0).val() + '-' + $v.eq(1).val();
			}
			$c.remove();
			/*
			$('.btn').blur();
			parent.layer.open({
				type: 1,
				title: '指令授权',
				content: '<div class="layer-alert"><i class="alert fail"></i>是否删除</div>',
				btn: ['删&nbsp;&nbsp;除', '取&nbsp;&nbsp;消'],
				btnAlign: 'c',
				closeBtn: false,
				skin: 'layer-custom',
				area: ['380px', '310px'],
				move: false,
				resize: false,
				yes: function (i) {
					$c.fadeOut(function () {
						$c.remove();
					});
					parent.layer.close(i);
				}
			});
			*/
		}
		//加入ip
		function _addIp2(obj) {
			var pass = 1;
			var v1 = $(obj).prev().val().trim();
			var v = $(obj).prev().prev().prev().val().trim();

			if (v == '') {
				_alert(2, '服务器集合', '请输入起始IP', $(obj).prev().prev().prev());
				return false;
			} else if (!ipReg.test(v) || v == '0.0.0.0' || v == '255.255.255.255') {
				_alert(1, '服务器集合', '起始IP格式不正确', $(obj).prev().prev().prev());
				return false;
			}
			if (v1 == '') {
				_alert(2, '服务器集合', '请输入结束IP', $(obj).prev());
				return false;
			} else if (!ipReg.test(v1) || v1 == '0.0.0.0' || v1 == '255.255.255.255') {
				_alert(1, '服务器集合', '结束IP格式不正确', $(obj).prev());
				return false;
			}
			if (v == v1) {
				_alert(1, '服务器集合', '起始IP不能大于等于结束IP', $(obj).prev().prev().prev());
				return false;
			}
			var v_str = v.split(".");
			var v1_str = v1.split(".");
			for (var i = 0; i < 4; i++) {
				if (parseInt(v_str[i]) > parseInt(v1_str[i])) {
					pass = 0;
					_alert(2, '服务器集合', '起始IP不能大于等于结束IP', $(obj).prev().prev().prev());
					return false;
				} else if (parseInt(v_str[i]) < parseInt(v1_str[i])) {
					break;
				}
			}
			if (pass == 0) {
				return false;
			}
			$("#ip_n").children('span:not(:first)').each(function (i1, item1) {
				var ip1_input1 = $(item1).find('input:eq(0)').val();
				var ip1_input2 = $(item1).find('input:eq(1)').val();
				if (v == ip1_input1 && v1 == ip1_input2) {
					pass = 0;
					_alert(2, "服务器集合", "相同的IP区间已存在", $(obj).prev('input:first'));
					return false;
				}
			});
			if (pass == 0) {
				return false;
			}
			var ip_id = $("#ip_span").attr("value");
			var $c = $('<span class="ss" value="' + ip_id + '" style="float: left;width: 312px;position: static;padding: 0 0 10px 0;"/>');
			$c.html('<input type="text" class="form-text" value="' + v + '" style="width:110px;">'
				+ '<span style="vertical-align:middle;padding-left: 4px;padding-right: 4px;">-</span>'
				+ '<input type="text" class="form-text" value="' + v1 + '" style="width:110px;">'
				+ '<i class="ctr ctr-del" style="margin-top: 5px;margin-left: -3px;" onclick="_delIp(this)"></i>');
			$(obj).parent().after($c);
			$(obj).prev().val("");
			$(obj).prev().prev().prev().val("").focus();
			$("#ip_span").attr("value", "0");
			//}
		}

		//加入ip
		function _addIp1(obj) {
			var pass = 1;
			var v = $(obj).prev('input').val().trim();

			if (v == '') {
				_alert(2, '服务器集合', '请输入IP', $(obj).prev('input'));
				return false;
			} else if (!ipReg.test(v) || v == '0.0.0.0' || v == '255.255.255.255') {
				_alert(1, '服务器集合', 'IP格式不正确', $(obj).prev('input'));
				return false;
			} else {
				$(">span[class='ss']", "#ip_n1").each(function () {
					ip_str = $(this).find("input").val();
					if (ip_str == v) {
						_alert(2, '服务器集合', '相同的IP已存在', $(obj).prev('input'));
						pass = 0;
						return false;
					}
				});
			}
			var ip_id = $("#ip_span1").attr("value");
			if (pass == 1) {
				var $c = $('<span class="ss" value="' + ip_id + '" style="width: 170px;float: left;position: static;padding: 0 0 10px 0;"/>');
				$c.html('<input type="text" class="form-text" style="width:110px;" value="' + v + '" >'
					+ '<i class="ctr ctr-del" onclick="_delIp(this)" style="margin-top: 4px;margin-left: -3px;"></i>');
				$(obj).parent().after($c);
				$(obj).prev('input').val("").focus();
				$("#ip_span1").attr("value", "0");
			}
		}
		function save_server_hg_host(obj, id) {
			$(">li", obj).children('input').each(function () {
				var input_id = $(this).attr('id');
				var input_str = input_id.split('-');
				var input_state = $(this).next('span.checkbox').attr('class');
				var radio_value = $(this).siblings('span.authtype').find('input');
				var $u = $(this).parent().children('ul');
				if (input_state.indexOf('checked') > 0) {
					if (radio_value.is(':checked') && input_str[1] != '1' && input_str[0] == "HGId") {
						var json_a = '{"HGId":' + input_str[1] + ',"HostId":null,"IsGroupAuth": true}';
						server.HostList.push(JSON.parse(json_a));
					} else {
						if (input_str[0] == "HGId") {
							var json_a = '{"HGId":' + input_str[1] + ',"HostId":null,"IsGroupAuth": false}';
							server.HostList.push(JSON.parse(json_a));
							if ($u.text() != "Loading..." && $u.text() != "") {
								save_server_hg_host($u, input_str[1]);
							}
						} else {
							var json_a = '{"HGId":' + id + ',"HostId":' + input_str[2] + '}';
							server.HostList.push(JSON.parse(json_a));
						}
					}
				} else if (input_state.indexOf('half') > 0) {
					if ($u.text() != "Loading..." && $u.text() != "") {
						save_server_hg_host($u, input_str[1]);
					} else {
						$.each(server_edit.HostList, function (i, item) {
														if (item.HGId == parseInt(input_str[1]) && item.HostId != null) {
								var json_a = '{"HGId":' + item.HGId + ',"HostId":' + item.HostId + '}';
								server.HostList.push(JSON.parse(json_a));
							}
						});
					}
				}
			});
		}
		//创建
		function server_add(d) {
			var ip_section = 1;
			var ip_num = 1;
			var host_group = 1;
			var pass = 1;
			var d_n = $('#d_n').val();
			if (d_n == "") {
				_alert(2, '服务器集合', '请输入名称', $('#d_n'));
				return false;
			} else if (!nameReg.test(d_n)) {
				_alert(1, '服务器集合', '名称格式不正确', $('#d_n'));
				$("#d_n").val("");
				return false;
			}
			var v2 = $("#ip_n1").find("span[class='ss ss-add']").children("input").val().trim();
			if (v2 == "" && !$('#ip_n1').find("span[class=ss]").length) {
				ip_num = 0;
			}
			var ip_n1_len = $("#ip_n1").find('input').length;
			$("#ip_n1").find('input').each(function (i, item) {
				var input1 = $(item).val();
				if (ip_num == 0) {
					return true;
				}
				if (i == 0 && ip_n1_len != 1 && input1 == "") {
					return true;
				}

				if (input1 == "") {
					pass = 0;
					_alert(2, "服务器集合", "请输入IP地址", $(item));
					return false;
				}
				if (!ipReg.test(input1) || input1 == '0.0.0.0' || input1 == '255.255.255.255') {
					pass = 0;
					_alert(1, "服务器集合", "IP格式不正确", $(item));
					return false;
				}
				$("#ip_n1").find('input').not($(item)).each(function (i1, item1) {
					if (i1 < i) {
						return true;
					}
					var input2 = $(item1).val();
					if (input2 == "") {
						pass = 0;
						_alert(2, "服务器集合", "请输入IP地址", $(item1));
						return false;
					}
					if (!ipReg.test(input2) || input2 == '0.0.0.0' || input2 == '255.255.255.255') {
						pass = 0;
						_alert(1, "服务器集合", "IP格式不正确", $(item1));
						return false;
					}
					if (input1 == input2) {
						pass = 0;
						_alert(1, "服务器集合", "相同的IP已存在", $(item));
						return false;
					}
				});
				if (pass == 0) {
					return false;
				}
			});
			if (pass == 0) {
				return false;
			}




			var v = $("#ip_n").find("span[class='ss ss-add']").children("input").val().trim();
			var v1 = $("#ip_n").find("span[class='ss ss-add']").children().next("input").val().trim();

			if (v == "" && v1 == "" && !$(">span[class='ss']", "#ip_n").length) {
				ip_section = 0;
			}
			var ip_n_len = $("#ip_n").children('span').length;
			$("#ip_n").children('span').each(function (i, item) {
				if (ip_section == 0) {
					return true;
				}
				var ip_input1 = $(item).find('input:eq(0)').val();
				var ip_input2 = $(item).find('input:eq(1)').val();
				if (i == 0 && ip_n_len != 1 && ip_input1 == "" && ip_input2 == "") {
					return true;
				}
				if (ip_input1 == '') {
					pass = 0;
					_alert(2, '服务器集合', '请输入起始IP', $(item).find('input:eq(0)'));
					return false;
				} else if (!ipReg.test(ip_input1) || ip_input1 == '0.0.0.0' || ip_input1 == '255.255.255.255') {
					pass = 0;
					_alert(1, '服务器集合', '起始IP格式不正确', $(item).find('input:eq(0)'));
					return false;
				}
				if (ip_input2 == '') {
					pass = 0;
					_alert(2, '服务器集合', '请输入结束IP', $(item).find('input:eq(1)'));
					return false;
				} else if (!ipReg.test(ip_input2) || ip_input2 == '0.0.0.0' || ip_input2 == '255.255.255.255') {
					pass = 0;
					_alert(1, '服务器集合', '结束IP格式不正确', $(item).find('input:eq(1)'));
					return false;
				}
				var r_v = _compare_ip(ip_input1, ip_input2);
				if (r_v != 3) {
					pass = 0;
					_alert(1, '服务器集合', '起始IP不能大于等于结束IP', $(item).find('input:eq(0)'));
					return false;
				}
				$("#ip_n").children('span').not($(item)).each(function (i1, item1) {
					if (i1 < i) {
						return true;
					}
					var ip1_input1 = $(item1).find('input:eq(0)').val();
					var ip1_input2 = $(item1).find('input:eq(1)').val();
					if (ip1_input1 == '') {
						pass = 0;
						_alert(2, '服务器集合', '请输入起始IP', $(item1).find('input:eq(0)'));
						return false;
					} else if (!ipReg.test(ip1_input1) || ip1_input1 == '0.0.0.0' || ip1_input1 == '255.255.255.255') {
						pass = 0;
						_alert(1, '服务器集合', '起始IP格式不正确', $(item1).find('input:eq(0)'));
						return false;
					}
					if (ip1_input2 == '') {
						pass = 0;
						_alert(2, '服务器集合', '请输入结束IP', $(item1).find('input:eq(1)'));
						return false;
					} else if (!ipReg.test(ip1_input2) || ip1_input2 == '0.0.0.0' || ip1_input2 == '255.255.255.255') {
						pass = 0;
						_alert(1, '服务器集合', '结束IP格式不正确', $(item1).find('input:eq(1)'));
						return false;
					}
					var r_v = _compare_ip(ip1_input1, ip1_input2);
					if (r_v != 3) {
						pass = 0;
						_alert(1, '服务器集合', '起始IP不能大于等于结束IP', $(item1).find('input:eq(0)'));
						return false;
					}
					if (ip_input1 == ip1_input1 && ip_input2 == ip1_input2) {
						pass = 0;
						_alert(1, "服务器集合", "相同的IP区间已存在", $(item).find('input:eq(1)'));
						return false;
					}
				});
				if (pass == 0) {
					return false;
				}
			});
			if (pass == 0) {
				return false;
			}


			server.HostList = new Array();
			save_server_hg_host($("#userTree1"), 0);
			if (server.HostList.length == 0) {
				host_group = 0;
			}
			if (host_group == 0 && ip_section == 0 && ip_num == 0 && $("#part1").prop('checked') == true) {
				_alert(2, '服务器集合', '请输入IP或选择主机', $("#ip_n1").find("span[class='ss ss-add']").children("input"));
				return false;
			}else if($("#part1").prop('checked') == false && host_group == 0){
				_alert(2, '服务器集合', '请输入IP或选择主机');
				return false;
			}
			if (pass == 1) {
				//var serverId = document.frm_server_add.serverId.value;
				server.ServerScopeId = parseInt(serverId);
				server.ServerScopeName = d_n;
				server.IPList.Set = new Array();
				var i = 1;
				var $all = $('#ip_n').find('span[class=ss]');
				var len = $all.length;
				for (var j = len - 1; j >= 0; j--) {
					var ip_id = $all.eq(j).attr("value");
					var $v = $all.eq(j).find('input');
					var input_0 = $v.eq(0).val();
					var input_1 = $v.eq(1).val();
					var json_a = '{"IPSetMemberId":' + ip_id + ',"Order":' + (i) + ',"StartIP":"' + input_0 + '","EndIP":"' + input_1 + '"}';
					server.IPList.Set.push(JSON.parse(json_a));
					i++;
				}
				if (v != "" && v1 != "") {
					ip_id = $("#ip_span").attr("value");
					var b1 = $("#ip_n").find("span[class='ss ss-add']").children("input").val().trim();
					var b2 = $("#ip_n").find("span[class='ss ss-add']").children().next("input").val().trim();
					var json_a = '{"IPSetMemberId":' + ip_id + ',"Order":' + (i) + ',"StartIP":"' + b1 + '","EndIP":"' + b2 + '"}';
					server.IPList.Set.push(JSON.parse(json_a));
					i++;
				}
				var $all = $('#ip_n1').find('span[class=ss]');
				var len = $all.length;
				for (var j = len - 1; j >= 0; j--) {
					var ip_id = $all.eq(j).attr("value");
					var ip_str = $all.eq(j).find("input").val();
					var json_a = '{"IPSetMemberId":' + ip_id + ',"Order":' + (i) + ',"StartIP":"' + ip_str + '","EndIP":"' + ip_str + '"}';
					server.IPList.Set.push(JSON.parse(json_a));
					i++;
				}

				if (v2 != "") {
					ip_id = $("#ip_span1").attr("value");
					var b1 = $("#ip_n1").find("span[class='ss ss-add']").children("input").val().trim();
					var json_a = '{"IPSetMemberId":' + ip_id + ',"Order":' + (i) + ',"StartIP":"' + b1 + '","EndIP":"' + b1 + '"}';
					server.IPList.Set.push(JSON.parse(json_a));
					i++
				}
				if($("#part1").prop('checked') == false){
					server.EnableIPLimit = 0;
				}else{
					server.EnableIPLimit = 1;
				}
				if (ip_section == 0 && ip_num == 0) {
					save_server(server, d);
					return false;
				}
				$('.btn').blur();
				server.IsApplyToClientScope = false;
				save_server(server, d);
				
			}
			//}
		}
		function save_server(server, d) {
			var msstr = aceg(JSON.stringify(server),se);
			$.ajax({
				url: '/bhost/add_server',
				type: "POST",
				async: false,
				data: { a0: se, a1: JSON.stringify(server), a4:"运维管理>指令授权",m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result == true) {
						$('.btn').blur();
						parent.layer.open({
							type: 1,
							title: '服务器集合',
							content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
							btn: ['确&nbsp;&nbsp;定'],
							btnAlign: 'c',
							closeBtn: false,
							skin: 'layer-custom',
							area: ['380px', '310px'],
							move: false,
							resize: false,
							yes: function (i) {
								parent.layer.close(i);
								d.close().remove();
								var ips_text = $('#ips').find('span').text();
								$("div[data-id=xSelect-server]").remove();
								$('#ips').empty().data('xSelect','');
								bind_server_xSelect();
								if ($("#ips").data('value') == "-1" || $("#ips").data('value') == undefined){
									if (serdata.data.find(function(x){
										return x.ServerScopeId == result.ServerScopeId;
									}) != undefined){
										$("#ips").data('value',result.ServerScopeId);
										$("#ips").find('span').text(server.ServerScopeName);
										serverid_list.splice(0, 1, result.ServerScopeId);
									}else{
										return false;
									}
								}else{
									if (serdata.data.find(function(x){
										return x.ServerScopeId == result.ServerScopeId;
									}) != undefined){
										$('#ips').find('span').text(ips_text);
									}else{
										$("#ips").data('value',-1);
										$("#ips").find('span').text('请选择');
										change_server();
										return false;
									}
								}
								
								if (server_edit == null){
									if ($("#define_select").val() == 1){
										if ($("#a_mix_select").val() == 1 || $("#s_mix_select").val() == 1){
											change_server();
										}
									}
								}else{
									var isexist_flag = 0;
									var change_flag = 0;
									if (server_edit.IPList.Set != null && server_edit.IPList.Set.length == server.IPList.Set.length){
										$.each(server_edit.IPList.Set,function(i1,item1){
											$.each(server.IPList.Set,function(i2,item2){
												if (item1.EndIP == item2.EndIP && item2.StartIP == item2.StartIP){
													isexist_flag = 0;
													return false;
												}else{
													isexist_flag = 1;
												}
											});
											if (isexist_flag == 1){
												if ($("#define_select").val() == 1){
													if ($("#a_mix_select").val() == 1 || $("#s_mix_select").val() == 1){
														change_flag = 1;
														change_server();
													}
												}
												return false;
											}
										});
									}else{
										if ($("#define_select").val() == 1){
											if ($("#a_mix_select").val() == 1 || $("#s_mix_select").val() == 1){
												change_flag = 1;
												change_server();
											}
										}
									}
									if (change_flag == 0){
										if (server_edit.HostList != null && server_edit.HostList.length == server.HostList.length){
											$.each(server_edit.HostList,function(i1,item1){
												$.each(server.HostList,function(i2,item2){
													if (item1.HostId == item2.HostId){
														isexist_flag = 0;
														return false;
													}else{
														isexist_flag = 1;
													}
												});
												if (isexist_flag == 1){
													if ($("#define_select").val() == 1){
														if ($("#a_mix_select").val() == 1 || $("#s_mix_select").val() == 1){
															change_server();
														}
													}
													return false;
												}
											});
										}else{
											if ($("#define_select").val() == 1){
												if ($("#a_mix_select").val() == 1 || $("#s_mix_select").val() == 1){
													change_server();
												}
											}
										}
									}
								}
								
								return false;
							}
						});
					} else {
						_alert(1, '服务器集合', "执行失败：" + result.ErrMsg);
						//d.close().remove();
						return false;
					}
				}
			});
		}
		/*
		function addserver(obj) {
						var v = $(obj).parent().find('input').val();
			var add = 0;
			var again_s = 0;
			if (v == "") {
				_alert(2, "指令授权", "请选择服务器范围");
				return false;
			}

			if (serdata != null) {
				var name_check = 0;
								$.each(serdata.data, function (i, item) {
					if (item.ServerScopeName == v) {
						if (server_id == item.ServerScopeId) {
							again_s = 1;
						}
						server_id = parseInt(item.ServerScopeId);
						name_check = 0;
						if (serverid_list.indexOf(server_id) === -1) {
							serverid_list.push(server_id);
						}
						return false;
					} else {
						name_check = 1;
					}
				});
				if (name_check == 1) {
					_alert(1, "指令授权", "该服务器范围不存在");
					//$(obj).parent().find('input').val(serverscope.server_name);
					$(obj).parent().find('input').val('');
					return false;
				}
			}
			var $c = $('<div style="width:215px;margin-top: -10px;" class="item" value="' + server_id + '"/>');

						if (serverid_list.indexOf(server_id) === -1) {
				serverid_list.push(server_id);
			}
						$c.html('<input style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;width: 144px;padding: 0 8px;" typr="text" class="form-text" disabled="true" value="' + v + '"><i class="ctrl del" onclick="_delServerScope(this)"></i>');
			$(obj).parent().after($c);
			$(obj).parent().find('input:first').val("");
			if (again_s == 0) {
				change_server();
			}
		}
		*/
		
		function add_server_scope(obj){
			var server_id = $(obj).prev('div').data('value');
			var v = $(obj).prev('div').find('span').text();
			if (server_id == undefined || server_id == '-1'){
				_alert(2, "指令授权", "请选择服务器范围");
				return false;
			}
			var $c = $('<div style="width:214px;margin-top: -10px;" class="item" id="' + server_id + '"/>');
			if (serverid_list.indexOf(server_id) === -1) {
				serverid_list.push(server_id);
			}
			
			serverid_list.splice(0, 0, '-1');
			s_index_all.splice($.inArray(parseInt(server_id), s_index_all), 1);
			$c.html('<input style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;width: 144px;padding: 0 8px;" typr="text" class="form-text" disabled="true" value="' + v + '"><i class="ctrl del" onclick="_del_scope(this,3)"></i>');
			$(obj).parent().after($c);
			$(obj).parent().find('input:first').val("");
			$("#ips").find('span').text('请选择');
			$("div[data-id=xSelect-server]").children('input').val('');
			$("div[data-id=xSelect-server]").find('span[data-value='+server_id+']').parent('li').remove();
			$(obj).prev('div').data('value','-1');
			//change_server();
		}
		/*
		function _del_scope(obj,type){
			var $c = $(obj).parent();
			var id = $c.attr('id');
			var t = $(obj).siblings('input').val();
			var v, data, max;
			var min = 0;
			if (type == 1){//指令集合
				max = cmd_index_all.length - 1;
				data = cmd_index_all;
				$("#cmd").show();
				cmdset.splice($.inArray(id, cmdset), 1);
				var $p = $("div[data-id=xSelect-cmd]").children('ul');
			}
			
			$c.remove();
			var index_1 = search_i(min, max, parseInt(id), data);
			index_1 = parseInt(index_1);
						if (index_1 == -1) {
				index_1 = max;
				$p.append('<li style=""><i class="edit"></i><span data-value="'+id+'" style="width:132px">'+t+'</span></li>');
			} else if (index_1 == -2) {
				index_1 = 0;
				$p.children('li').eq(0).before('<li style=""><i class="edit"></i><span data-value="'+id+'" style="width:132px">'+t+'</span></li>');
			} else {
				$p.find('span[data-value='+data[index_1]+']').parent('li').before('<li style=""><i class="edit"></i><span data-value="'+id+'" style="width:132px">'+t+'</span></li>');
			}
			data.splice(index_1, 0, parseInt(id));
		}
		*/
		function _del_scope(obj,type){
			var $c = $(obj).parent();
			var id = $c.attr('id');
			var t = $(obj).siblings('input').val();
			var v, data, max;
			var min = 0;
			/*
			if (type == 1){//时间集合
				max = t_index_all.length - 1;
				data = t_index_all;
				$("#time_frame").show();
				time_list.splice($.inArray(id, time_list), 1);
				var $p = $("div[data-id=xSelect-time]").children('ul');
			}else if (type == 2){//客户端集合
				max = c_index_all.length - 1;
				data = c_index_all;
				$("#accset").show();
				client_list.splice($.inArray(id, client_list), 1);
				var $p = $("div[data-id=xSelect-client]").children('ul');
			}else if (type == 3){//服务器范围
			*/
			if (type == 3){
				max = s_index_all.length - 1;
				data = s_index_all;
				$("#ips").show();
				serverid_list.splice($.inArray(parseInt(id), serverid_list), 1);
				var $p = $("div[data-id=xSelect-server]").children('ul');
			}else {
				max = cmd_index_all.length - 1;
				data = cmd_index_all;
				$("#cmd").show();
				cmdset.splice($.inArray(parseInt(id), cmdset), 1);
				var $p = $("div[data-id=xSelect-cmd]").children('ul');
			}
			//}
			$c.remove();
			if (max < 0){
				var index_1 = -1;
			}else{
				var index_1 = search_i(min, max, parseInt(id), data);
			}
			//var index_1 = search_i(min, max, id, data);
			index_1 = parseInt(index_1);
			if (index_1 == -1) {
				index_1 = max + 1;
				$p.append('<li style=""><i class="edit"></i><span data-value="'+id+'" style="width:132px">'+t+'</span></li>');
			} else if (index_1 == -2) {
				index_1 = 0;
				$p.children('li').eq(0).before('<li style=""><i class="edit"></i><span data-value="'+id+'" style="width:132px">'+t+'</span></li>');
			} else {
				$p.find('span[data-value='+data[index_1]+']').parent('li').before('<li style=""><i class="edit"></i><span data-value="'+id+'" style="width:132px">'+t+'</span></li>');
			}
			data.splice(index_1, 0, parseInt(id));
		}
		
		
		var $focusObj;
		var serdata;
		function _autoView(obj, i, j) {
			$(document)[0].onclick = null;
			$focusObj = $(obj);
			if (j == 1) {
				$.ajax({
					url: '/bhost/get_ServerScope_w',
					type: 'post',
					async: false,
					data: { a0: se },
					success: function (result) {
						serdata = JSON.parse(result);
					}
				});
			} else if (j == 2) {
				get_ApproveStrategy();
			} else if (j == 3) {
				get_warning_all();
			}
			var v = $.trim($(obj).val());
			var $view;
			if ($('#autoView').length == 0) {
				$('body').append('<div id="autoView" />');
			}
			$view = $('#autoView');
			var c = '';
			if (j == 1) {
				$.each(serdata.data, function (i, item) {
					var add = 0;
					$.each(serverid_list, function (i1, item1) {
						if (item.ServerScopeId == item1) {
							add = 1;
							return false;
						}
					})
					if (add == 1) {
						return true;
					}
					if (v == '') {
						//过滤范围权限
						/*
						$.ajax({
							url:'/bhost/IsSScopeDisplay',
							type:'post',
							async:false,
							data:{a0:se,z1:item.ServerScopeId},
							success:function(result){
								if (result){
									c += '<li><i class="edit" onclick="_editNode(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden;" href="javascript:;" id="'+item.ServerScopeId+'" onclick="_setVal(this,1);">'+item.ServerScopeName+'</a></li>';
								}
							}
						})
						*/
						c += '<li><i class="edit" onclick="_editNode(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden;" href="javascript:;" id="' + item.ServerScopeId + '" onclick="_setVal(this,1);">' + item.ServerScopeName + '</a></li>';
					} else {
						if (item.ServerScopeName.indexOf(v) >= 0) {
							/*
							$.ajax({
								url:'/bhost/IsSScopeDisplay',
								type:'post',
								async:false,
								data:{a0:se,z1:item.ServerScopeId},
								success:function(result){
									if (result){
										c += '<li><i class="edit" onclick="_editNode(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden;" href="javascript:;" id="'+item.ServerScopeId+'" onclick="_setVal(this,1);">'+item.ServerScopeName+'</a></li>';
									}
								}
							})
							*/
							c += '<li><i class="edit" onclick="_editNode(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden;" href="javascript:;" id="' + item.ServerScopeId + '" onclick="_setVal(this,1);">' + item.ServerScopeName + '</a></li>';
						}
					}
				});
			} else if (j == 2) {
				$.each(appdata.data, function (i, item) {
					if (v == '') {
						c += '<li><i class="edit" onclick="_editNode4(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden; href="javascript:;" id="' + item.ApproveStrategyId + '" onclick="_setVal(this,5);">' + item.ApproveStrategyName + '</a></li>';
					} else {
						if (item.ApproveStrategyName.indexOf(v) >= 0) {
							c += '<li><i class="edit" onclick="_editNode4(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden; href="javascript:;" id="' + item.ApproveStrategyId + '" onclick="_setVal(this,5);">' + item.ApproveStrategyName + '</a></li>';
						}
					}
				});
			} else if (j == 3) {
				$.each(edata.data, function (i, item) {
					if (v == '') {
						c += '<li><i class="edit" onclick="_editNode3(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden; href="javascript:;" id="' + item.EventAlarmInfoId + '" onclick="_setVal(this,4);">' + item.Name + '</a></li>';
					} else {
						if (item.Name.indexOf(v) >= 0) {
							c += '<li><i class="edit" onclick="_editNode3(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden; href="javascript:;" id="' + item.EventAlarmInfoId + '" onclick="_setVal(this,4);">' + item.Name + '</a></li>';
						}
					}
				});
			}

			if (i == 1) {
				$view.html('<ul>' + c + '</ul><div class="add2"><a href="javascript:;" onclick="_addNew(this)">创建新配置...</a></div>');
			} else if (i == 2) {
				$view.html('<ul>' + c + '</ul><div class="add2"><a href="javascript:;" id="-1" onclick="_editNode(this,2);">添加新服务器范围</a></div>');
			} else if (i == 3) {
				$view.html('<ul>' + c + '</ul><div class="add2"><a href="javascript:;" id="-1" onclick="_editNode4(this,2);">添加新审批策略</a></div>');
			} else if (i == 4) {
				$view.html('<ul>' + c + '</ul><div class="add2"><a href="javascript:;" id="-1" onclick="_editNode3(this,2);">添加新事件告警</a></div>');
			}

			var offset = $(obj).offset();
			var w = $(obj).outerWidth();
			$view.css({
				top: offset.top + 24,
				left: offset.left,
				width: w - 12
			}).show();

			$(obj).parents('.g-tsel').addClass('on');
			input_val = $(obj).val();
		}
		var input_val = "";
		var server_id = 0;
		function _setVal(t, t1) {
			var val = $(t).text();
			$($focusObj).val(val);
			$view = $('#autoView');
			$view.hide();
			if (t1 == 1) {
				server_id = parseInt($(t).attr('id'));
				if ($("#define_select").val() == 1) {
					change_server();
				}
			}
			var $item = $focusObj.parents('div.g-title').next('div.g-cont').find('div.forName');
			var $item2 = $focusObj.parent().next('input.forName');
			$item.hide();
			$item2.hide();
		}


		function _hideView(t) {

			$(document)[0].onclick = function () {
				$('#autoView').hide();
				$('.g-tsel').removeClass('on');
			}

			if ($("#new_strategy").is(":visible")) {
				$("#new_strategy").val(input_val);
				$("#strategy_select").val("");
				input_val = "";
			}
			if (t == 1) {
				change_server();
			}
		}



		//警告
		function clear_eventinfo() {
			$("#e_n").val("").attr("disabled", false);
			$("#Description").val("");
			$("#EventLevel").val(0).trigger('change');
			$("#EventType").val(0).trigger('change');
			$("#AlarmAction").val(0).trigger('change');
			$("#admin_select").empty();
			$("#admin_select1").empty();
			$("#label_list").children('div:not(:first)').remove();
			$("#label_list1").children('div:not(:first)').remove();
			$("#AlarmReceiver_text1").children('div:not(:first)').remove();
			$("#AlarmReceiver_text").children('div:not(:first)').remove();
			$("#AlarmReceiver_text1").find('input').val('');
			$("#AlarmReceiver_text").find('input').val('');
			$("#e_n").next('.v-check').attr('class', "v-check");
			$("#AlarmReceiver_check").iCheck('uncheck');
			$("#AlarmReceiver_check1").iCheck('uncheck');
			$(".xSelect-mail_div1").find('li').removeClass('active');
			$(".xSelect-mail_div2").find('li').removeClass('active');
			$("#mail_div1").data('value','-1');
			$("#mail_div2").data('value','-1');
		}

		var eventinfo_data;
		function _editNode3(obj, type) {
			clear_eventinfo();
			var title;
			if (type == 1) {
				//eventinfoId = $(obj).parent().children('a').attr('id');
				eventinfoId = $(obj).children('span').data('value');
				$.ajax({
					url: "/bhost/get_eventinfo_list",
					type: "POST",
					async: false,
					data: { a0: se, a1: eventinfoId },
					success: function (result) {
						var eventinfo_result = JSON.parse(result);
						if (eventinfo_result.Result == true) {
							eventinfo_data = eventinfo_result.info.data[0];
							title = "警告事件";
						}
					}
				});
			} else {
				eventinfo_edit = null;
				eventinfoId = 0;
				title = "警告事件";
			}
			var $dialogCont = $("#eventinfo_suspend").show();

			var d = dialog({
				title: title,
				content: $dialogCont,
				id: "eventinfo_suspend",
				width: "800px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			$("#EventLevel").next('span').css("margin-left", 9);
			eventinfomain(type);
			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				clear_eventinfo();
				eventinfomain(type);
				//d.close().remove();
			});

			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				eventinfo_add(d);
			})

		}


		var eventinfo = {
			"EventAlarmInfoId": 0,
			"Name": "",
			"EventLevel": 0,
			"EventType": 0,
			"EventDescription": null,
			"AlarmAction": 0,
			"AlarmReceiver": null,
			"UserSet": new Array(),
			"MasterConfig":0,
			"StandByConfig":0,
			"MasterConfigName":"",
			"StandByConfigName":""
		};

		var phonecheck = /^[0-9]{11}$/;
		var emailcheck = /^([a-zA-Z0-9_\.\-])+@(([a-zA-Z0-9_\-])+\.)+([a-zA-Z0-9])+$/;
		var phone_or_emailcheck = null;
		var phone_or_email = null;
		function _addphone_or_email(obj) {
			var pass = 1;
			var v = $(obj).prev('input').val().trim();
			if (v == '') {
				_alert(2, '事件警告信息', '请输入' + phone_or_email, $(obj).prev('input'));
				$(obj).prev('input').focus();
				return false;
			} else if (!phone_or_emailcheck.test(v)) {
				_alert(1, '事件警告信息', phone_or_email + '格式不正确', $(obj).prev('input'));
				$(obj).prev('input').focus();
				return false;
			} else {
				var AlarmAction = $('#AlarmAction').val();
				if (AlarmAction == '1') {
					var it = '';
				} else {
					var it = '1';
				}
				$(">div[value]", "#AlarmReceiver_text" + it).each(function () {
					ip_str = $(this).find("input").val();
					if (ip_str == v) {
						_alert(1, '事件警告信息', '相同的' + phone_or_email + '已存在', $(obj).prev('input'));
						$(obj).prev('input').focus();
						pass = 0;
						return false;
					}
				});
			}
			if (pass == 1) {
				var $c = $('<div id="" name="" class="item" style="padding-top: 0px;width: 260px;" value>');
				$c.html('<input type="text" class="form-text" style="width: 193px;" value="' + v + '" >'
					+ '<i class="ctrl del" onclick="_delphone_or_email(this)"  style="margin-top: 0px;margin-left: 4px;"></i>');
				$(obj).parent().after($c);
				$(obj).prev('input').val("");
				$(obj).prev('input').focus();
			}
		}
		function _delphone_or_email(obj) {
			var $c = $(obj).parent();
			$c.fadeOut(function () {
				$c.remove();
			});
		}
		//删除接收人
		function _deladmin(obj, type) {
			var $c = $(obj).parent();
			var m_i = $(obj).parent().attr('value');
			$c.fadeOut(function () {
				$c.remove();
				var AlarmAction = $('#AlarmAction').val();
				if (AlarmAction == '1') {
					all_option_str_1[parseInt(m_i)] = check_option_str_1[parseInt(m_i)];
					check_option_str_1[parseInt(m_i)] = null;
					$('#admin_select option[index=0]').remove();
					$.each(all_option_str_1, function (i, item) {
						if (item != null) {
							$('#admin_select').append(item);
						}
					});
					$('#admin_select').trigger('change');
				} else {
					all_option_str_2[parseInt(m_i)] = check_option_str_2[parseInt(m_i)];
					check_option_str_2[parseInt(m_i)] = null;
					$('#admin_select1 option[index=0]').remove();
					$.each(all_option_str_2, function (i, item) {
						if (item != null) {
							$('#admin_select1').append(item);
						}
					});
					$('#admin_select1').trigger('change');
				}
				$("#admin_select").select2();
				$("#admin_select1").select2();
			});
		}
		//添加接收人
		function _addadmin(obj, type) {
			var m_i = $(obj).parent().children('select').find("option:selected").val();
			var text = $(obj).parent().children('select').find("option:selected").text();
			if (m_i == "0") {
				_alert(2, '事件警告信息', '请选择接收人');
				return false;
			}
			var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + m_i + '"/>');
			if (type == 1) {
				$c.html('<input class="form-text" type="text" style="width: 128px;" value="' + text + '" disabled="true"><i style="margin-left: 4px;" class="ctrl del" onclick="_deladmin(this,1)"></i>');
			} else {
				$c.html('<input class="form-text" type="text" style="width: 128px;" value="' + text + '" disabled="true"><i style="margin-left: 4px;" class="ctrl del" onclick="_deladmin(this,2)"></i>');
			}
			$(obj).parent().after($c);
			$(obj).parent().children('select').find('option[value=' + m_i + ']').remove();
			$(obj).parent().children('select').val(0).trigger("change");
			var AlarmAction = $('#AlarmAction').val();
			if (AlarmAction == '1') {
				check_option_str_1[parseInt(m_i)] = all_option_str_1[parseInt(m_i)];
				all_option_str_1[parseInt(m_i)] = null;
			} else {
				check_option_str_2[parseInt(m_i)] = all_option_str_2[parseInt(m_i)];
				all_option_str_2[parseInt(m_i)] = null;
			}
			//输入数字
			$(".num").bind('keydown', function (e) {
				DigitInput(e);
			});
		}
		var check_option_str_1 = [];
		var check_option_str_2 = [];
		var all_option_str_1 = [];
		var all_option_str_2 = [];

		//绑定邮箱下拉框
		function bind_mail_select(){
			var mail_array1 = [0];
			var mail_array2 = [0];
			xsel_mail_id1_pre[0] = -1;
			xsel_mail_id2_pre[0] = -1;
			$.ajax({
				url:'/bhost/select_mailserver_all',
				type:'post',
				async:false,
				data:{a0:se,z1:-1},
				success:function(result){
					maildata = JSON.parse(result);
				}
			});
			var mail_array = [];
			mail_array.push({'value':-1,'name':'全局指定','type':null});
			$.each(maildata.data,function(i,item){
				if (manage_auth_array.indexOf(24) != -1){
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'edit'
					};
				}else{
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'check'
					};
				}
				select_data_json.value = item.SmtpConfigId;
				select_data_json.name = item.SmtpConfigName;
				mail_array.push(select_data_json);
				mail_array1.push(item.SmtpConfigId);
				mail_array2.push(item.SmtpConfigId);
			});
			$(".xSelect-mail_div1").remove();
			$("#mail_div1").empty().data("xSelect","");
			if (manage_auth_array.indexOf(24) != -1){
				$("#mail_div1").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:mail_array,
					module_type:"mail_div1",
					edit: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode7(obj,1,1);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								
								$(obj).parents('.xSelect-view').hide();
								_editNode7(obj,2,1);
							}
						}
					],
					setval:function(item,obj){
						var xsel_id1 = $(obj).find('span').data('value');
						change_mail_option(1,mail_array,$(".xSelect-mail_div2"),mail_array2,xsel_id1,xsel_mail_id1_pre);
					}
				});
			}else{
				$("#mail_div1").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:mail_array,
					module_type:"mail_div1",
					check: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode7(obj,1,1);
					},
					setval:function(item,obj){
						var xsel_id1 = $(obj).find('span').data('value');
						change_mail_option(1,mail_array,$(".xSelect-mail_div2"),mail_array2,xsel_id1,xsel_mail_id1_pre);
					}
				});
			}
			
			$("#mail_div1").data('value',-1);
			$(".xSelect-mail_div2").remove();
			$("#mail_div2").empty().data("xSelect","");
			
			if (manage_auth_array.indexOf(24) != -1){
				$("#mail_div2").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:mail_array,
					module_type:"mail_div2",
					edit: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode7(obj,1,2);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								
								$(obj).parents('.xSelect-view').hide();
								_editNode7(obj,2,2);
							}
						}
					],
					setval:function(item,obj){
						var xsel_id2 = $(obj).find('span').data('value');
						change_mail_option(2,mail_array,$(".xSelect-mail_div1"),mail_array1,xsel_id2,xsel_mail_id2_pre);
					}
				});
			}else{
				$("#mail_div2").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:mail_array,
					module_type:"mail_div2",
					check: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode7(obj,1,2);
					},
					setval:function(item,obj){
						var xsel_id2 = $(obj).find('span').data('value');
						change_mail_option(2,mail_array,$(".xSelect-mail_div1"),mail_array1,xsel_id2,xsel_mail_id2_pre);
					}
				});
			}
			
			$("#mail_div2").data('value',-1);
		}
		
		var xsel_mail_id1_pre = [-1];
		var xsel_mail_id2_pre = [-1];
		function change_mail_option(type,mail_array,obj,div_array,xsel_id,xsel_id_pre){
			if (xsel_id_pre[0] != -1){
				var index = $.inArray(-1, div_array);
				var name = mail_array[index].name;
				div_array[index] = xsel_id_pre[0];
				if (index == 1){
					if (manage_auth_array.indexOf(24) != -1){
						$(obj).find('span[data-value='+div_array[index+1]+']').parent().before('<li><i class="edit"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
					}else{
						$(obj).find('span[data-value='+div_array[index+1]+']').parent().before('<li><i class="check"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
					}
					//$(obj).find('span[data-value='+div_array[index+1]+']').parent().before('<li><i class="edit"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
				}else if (index <= div_array.length){
					if (manage_auth_array.indexOf(24) != -1){
						$(obj).find('span[data-value='+div_array[index-1]+']').parent().after('<li><i class="edit"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
					}else{
						$(obj).find('span[data-value='+div_array[index-1]+']').parent().after('<li><i class="check"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
					}
					//$(obj).find('span[data-value='+div_array[index-1]+']').parent().after('<li><i class="edit"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
				}
			}
			if (xsel_id != -1){
				var sel_span = $(obj).find('span[data-value='+xsel_id+']');
				sel_span.parent().remove();
				div_array.splice($.inArray(parseInt(xsel_id), div_array),1, -1);
			}
			xsel_id_pre[0] = xsel_id;
		}
		
		function clear_mail(){
			$("#mail_suspend").find('input').val('');
			$("#mail_suspend").find('i.v-check').attr('class','v-check');
			$("#SmtpConfigName").attr('disabled',false);
			$("#AttachMaxLimit").val(0);
			$("#EnCode_mail").val(0).trigger('change');
			$("#Flag_mail").val(2).trigger('change');
			//xsel_mail_id1_pre = [-1];
			//xsel_mail_id2_pre = [-1];
		}

		//邮件
		var mailset = {
			"SmtpConfigId": 0, 
			"SmtpConfigName": "邮件服务器1",  
			"SmtpServer": "10.17.251.5",
			"DNS": null,         
			"Sender": "ithelp@fqnp.com",
			"SenderEmail": "ithelp@fqnp.com",
			"AttachMaxLimit": 20,        
			"ServerVerify": true,
			"SenderEmailPass": "d106f6959747b5ac",
			"Flag":0,
			"EnCode":0
		}
		var mail_result;
		function _editNode7(obj,type,flag){
			clear_mail();
			var title;
			if (type == 1){
				//approveId = $(obj).parent().children('a').attr('id');
				mailId = $(obj).children('span').data('value');
				$.ajax({
					url: "/bhost/select_mailserver_all",
					type: "POST",
					async: false,
					data: { a0: se, z1: mailId},
					success: function (result) {
						mail_result = JSON.parse(result);
						mail_result = mail_result.data[0];	
						title = "邮件";
					}
				});
			}else{
				mailId = 0;
				title = "邮件";
			}
			
			var $dialogCont = $("#mail_suspend").show();
			
			var d = dialog({
				title:title,
				content:$dialogCont,
				id:"mail_suspend",
				width:"800px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			mail_main(type);
			$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
				clear_mail();
				mail_main(type);
				//d.close().remove();
			});
			
			$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
				mailserver_save(d,flag);
			});
			
		}

		function mail_main(type){
			if (manage_auth_array.indexOf(24) === -1){
				$("#mail_suspend").find('.btn-submit').remove();
			}
			if (type == 1){
				mailset.SmtpConfigId = mail_result.SmtpConfigId;
				$("#SmtpConfigName").val(mail_result.SmtpConfigName);
				$("#SmtpConfigName").prop("disabled",true);
				$("#SmtpServer").val(mail_result.SmtpServer);
				$("#Sender").val(mail_result.Sender);
				$("#SenderEmail").val(mail_result.SenderEmail);
				$("#AttachMaxLimit").val(mail_result.AttachMaxLimit);
				
				if (mail_result.ServerVerify){
					$("#ServerVerify_on").iCheck("check");
					$("#SenderEmailPass").parent().show();
					$("#SenderEmailPass").val(mail_result.SenderEmailPass);
				}else{
					$("#ServerVerify_off").iCheck("check");
					$("#SenderEmailPass").parent().hide();
				}
				$("#EnCode_mail").val(mail_result.EnCode).trigger('change');
				$("#Flag_mail").val(mail_result.Flag).trigger('change');
				if (mail_result.Flag == 2){
					$.ajax({
						url:'/bhost/get_mail_flag',
						type:'post',
						async:false,
						data:{a0:se},
						success:function(result){
							var mail_flag = JSON.parse(result);
							if (mail_flag.Result){
								if (mail_flag.count_mail == 2){
									$("#Flag_mail").attr('disabled',true);
								}
							}
						}
					})
				}
			}else{
				$.ajax({
					url:'/bhost/get_mail_flag',
					type:'post',
					async:false,
					data:{a0:se},
					success:function(result){
						var mail_flag = JSON.parse(result);
						if (mail_flag.Result){
							if (mail_flag.count_mail == 1){
								$("#Flag_mail").val(2).trigger('change');
								$("#Flag_mail").attr('disabled',true);
							}else if (mail_flag.def_mail == 0){
								$("#Flag_mail").val(2).trigger('change');
							}else if (mail_flag.spare_mail == 0){
								$("#Flag_mail").val(1).trigger('change');
							}else{
								$("#Flag_mail").val(0).trigger('change');
							}
						}
					}
				})
			}
			
			$("#ServerVerify_on").on("ifChanged",function(){
				if ($(this).prop("checked")){
					$("#SenderEmailPass").parent().show();
				}else{
					$("#SenderEmailPass").parent().hide();
				}
			})
		}

		var emailReg = /^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]+)+)$/;
		var ipcheck_route=/(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;
		var hostcheck1=/^(https?:\/\/)?(w{3}\.)?([a-zA-Z0-9-_.])+\.(com|cn|gov|info|us|hk|tw|cc|tv|uk|org)$/;
		var hostcheck2=/^(https?:\/\/)?((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$/;
		var nameCheck = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;

		//Email匹配
		function EmailCheck(obj){
			var email = $(obj).val().trim();
			var $i = $(obj).next('i.v-check');
			if (!emailReg.test(email)){
				$i.show().attr('class','v-check v-wrong');
			}else{
				$i.show().attr('class','v-check v-right');
			}
		}
		function IPCheck(obj){
			var ip = $(obj).val().trim();
			var $i = $(obj).next('i.v-check');
			if (!ipcheck_route.test(ip)){
				$i.show().attr('class','v-check v-wrong');
			}else{
				$i.show().attr('class','v-check v-right');
			}
		}
		function IPCheck_DNS(obj){
			var ip = $(obj).val().trim();
			var $i = $(obj).next('i.v-check');
			if (!ipcheck_route.test(ip) && (!hostcheck1.test(ip)) && (!hostcheck2.test(ip))){
				$i.show().attr('class','v-check v-wrong');
			}else{
				$i.show().attr('class','v-check v-right');
			}
		}
		function fill_text(){
			var SenderEmail = $("#SenderEmail").val();
			if (SenderEmail != "" && $("#Sender").val() == ""){
				$("#Sender").val(SenderEmail);
			}
		}

		function NumCheck(obj){
			obj.value = obj.value.replace(/\D/g,"");
			var v = obj.value.trim();
			if (v == ""){
				obj.value = '0';
			}
		}

		//保存配置
		function mailserver_save(d,flag){
			var SmtpConfigName = $("#SmtpConfigName").val();
			var SmtpServer = $("#SmtpServer").val().trim();
			var Sender = $("#Sender").val();
			var SenderEmail = $("#SenderEmail").val();
			var AttachMaxLimit = $("#AttachMaxLimit").val();
			var SenderEmailPass;
			if (SmtpConfigName == ""){
				_alert(2,"邮件","请输入名称",$("#SmtpConfigName"));
				return false;
			}else{
				if (!nameReg.test(SmtpConfigName)){
					_alert(1,"邮件","名称格式不正确",$("#SmtpConfigName"));
					return false;
				}
			}
			if (SmtpServer == ""){
				_alert(2,"邮件","请输入发送服务器",$("#SmtpServer"));
				return false;
			}else{
				if (!ipcheck_route.test(SmtpServer) && (!hostcheck1.test(SmtpServer)) && (!hostcheck2.test(SmtpServer))){
					_alert(1,"邮件","发送服务器格式不正确",$("#SmtpServer"));
					return false;
				}
			}
			if (SenderEmail == ""){
				_alert(2,"邮件","请输入发送方邮件地址",$("#SenderEmail"));
				return false;
			}else{
				if (!emailReg.test(SenderEmail)){
					_alert(1,"邮件","发送方邮件地址格式不正确",$("#SenderEmail"));
					return false;
				}
			}
			if ($("#ServerVerify_on").prop("checked")){
				if ($("#SenderEmailPass").val() == ""){
					_alert(2,"邮件","请输入服务器验证",$("#SenderEmailPass"));
					return false;
				}else{
					if($("#SenderEmailPass").val().length > 64){
						_alert(2, '邮件', "密码不能超过系统限定64位", $("#SenderEmailPass"));
						return false;
					}
					mailset.ServerVerify = true;
					mailset.SenderEmailPass = $("#SenderEmailPass").val();
				}
			}else{
				mailset.ServerVerify = false;
				mailset.SenderEmailPass = null;
			}

			mailset.SmtpConfigName = SmtpConfigName;
			mailset.SmtpServer = SmtpServer;
			mailset.DNS = null;
			mailset.Sender = Sender;
			mailset.SenderEmail = SenderEmail;
			mailset.AttachMaxLimit = AttachMaxLimit;
			mailset.Flag = parseInt($("#Flag_mail").val());
			mailset.EnCode = parseInt($("#EnCode_mail").val());
			msstr = aceg(JSON.stringify(mailset),se);
			$.ajax({
				url:'/bhost/save_mailserver',
				type:'post',
				async:false,
				data:{a0:se,z1:JSON.stringify(mailset),a10:"运维管理>指令授权",m1:msstr},
				success:function(result){
					data = JSON.parse(result);
					if (data.Result == true){
						parent.layer.open({
							type:1,
							title:"邮件",
							content:'<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
							btn:['确&nbsp;&nbsp;定'],
							btnAlign:'c',
							closeBtn: false,
							skin:'layer-custom',
							area:['380px','310px'],
							move: false,
							resize: false,
							btn1:function(i){
								$('.btn').blur();
								parent.layer.close(i);
								var mail_text1 = $('#mail_div1').find('span').text();
								var mail_text2 = $('#mail_div2').find('span').text();
								var mail_id1 = $('#mail_div1').data('value');
								var mail_id2 = $('#mail_div2').data('value');
								$("div[data-id=xSelect-mail_div1]").remove();
								$("div[data-id=xSelect-mail_div2]").remove();
								bind_mail_select();
								if (flag == 1){
									if ($("#mail_div1").data('value') == "-1" || $("#mail_div1").data('value') == undefined){
										mail_id1 = data.SmtpConfigId;
									}
								}else{
									if ($("#mail_div2").data('value') == "-1" || $("#mail_div2").data('value') == undefined){
										mail_id2 = data.SmtpConfigId;
									}
								}
								$(".xSelect-mail_div1").find('span[data-value='+mail_id1+']').click();
								$(".xSelect-mail_div2").find('span[data-value='+mail_id2+']').click();
								/*
								if (flag == 1){
									if ($("#mail_div1").data('value') == "-1" || $("#mail_div1").data('value') == undefined){
										//$("#mail_div1").data('value',data.SmtpConfigId);
										//$("#mail_div1").find('span').text(mailset.SmtpConfigName);
										$(".xSelect-mail_div1").find('span[data-value='+data.SmtpConfigId+']').click();
									}else{
										//$('#mail_div1').find('span').text(mail_text1);
										$(".xSelect-mail_div1").find('span[data-value='+mail_id1+']').click();
									}
									if (mail_id2 != undefined && mail_id2 != '-1'){
										//$("#mail_div2").data('value',mail_id2);
										//$("#mail_div2").find('span').text(mail_text2);
										$(".xSelect-mail_div2").find('span[data-value='+mail_id2+']').click();
									}
								}else{
									if ($("#mail_div2").data('value') == "-1" || $("#mail_div1").data('value') == undefined){
										//$("#mail_div2").data('value',data.SmtpConfigId);
										//$("#mail_div2").find('span').text(mailset.SmtpConfigName);
										$(".xSelect-mail_div2").find('span[data-value='+data.SmtpConfigId+']').click();
									}else{
										//$('#mail_div2').find('span').text(mail_text2);
										$(".xSelect-mail_div2").find('span[data-value='+mail_id2+']').click();
									}
									if (mail_id1 != undefined && mail_id1 != '-1'){
										//$("#mail_div1").data('value',mail_id1);
										//$("#mail_div1").find('span').text(mail_text1);
										$(".xSelect-mail_div1").find('span[data-value='+mail_id1+']').click();
									}
								}
								*/
								d.close().remove();
							},
							btn2:function(i){
								parent.layer.close(i);
							}
						});	
					}else{
						_alert(1,"邮件","执行失败：" + data.ErrMsg);
					}
				}
			});
		}
		
		//短信猫
		var xsel_smsm_id1_pre = [-1];
		var	xsel_smsm_id2_pre = [-1];
		function bind_smsm_select(){
			var smsm_array1 = [0];
			var smsm_array2 = [0];
			xsel_smsm_id1_pre[0] = -1;
			xsel_smsm_id2_pre[0] = -1;
			var smsm_data;
			$.ajax({
				url:'/bhost/select_smsm_all',
				type:'post',
				async:false,
				data:{a0:se,z1:-1},
				success:function(result){
					smsm_data = JSON.parse(result);
				}
			});
			var smsm_array = [];
			smsm_array.push({'value':-1,'name':'全局指定','type':null});
			$.each(smsm_data.data,function(i,item){
				if (manage_auth_array.indexOf(24) != -1){
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'edit'
					};
				}else{
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'check'
					};
				}
				select_data_json.value = item.SmsMConfigId;
				select_data_json.name = item.SmsMConfigName;
				smsm_array.push(select_data_json);
				smsm_array1.push(item.SmsMConfigId);
				smsm_array2.push(item.SmsMConfigId);
			});
			$(".xSelect-smsm_div1").remove();
			$("#smsm_div1").empty().data("xSelect","");
			if (manage_auth_array.indexOf(24) != -1){
				$("#smsm_div1").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:smsm_array,
					module_type:"smsm_div1",
					edit: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode8(obj,1,1);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								
								$(obj).parents('.xSelect-view').hide();
								_editNode8(obj,2,1);
							}
						}
					],
					setval:function(item,obj){
						var xsel_id1 = $(obj).find('span').data('value');
						change_mail_option(1,smsm_array,$(".xSelect-smsm_div2"),smsm_array2,xsel_id1,xsel_smsm_id1_pre);
					}
				});
			}else{
				$("#smsm_div1").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:smsm_array,
					module_type:"smsm_div1",
					check: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode8(obj,1,1);
					},
					setval:function(item,obj){
						var xsel_id1 = $(obj).find('span').data('value');
						change_mail_option(1,smsm_array,$(".xSelect-smsm_div2"),smsm_array2,xsel_id1,xsel_smsm_id1_pre);
					}
				});
			}
			
			$("#smsm_div1").data('value',-1);
			$(".xSelect-smsm_div2").remove();
			$("#smsm_div2").empty().data("xSelect","");
			if (manage_auth_array.indexOf(24) != -1){
				$("#smsm_div2").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:smsm_array,
					module_type:"smsm_div2",
					edit: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode8(obj,1,2);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								
								$(obj).parents('.xSelect-view').hide();
								_editNode8(obj,2,2);
							}
						}
					],
					setval:function(item,obj){
						var xsel_id2 = $(obj).find('span').data('value');
						change_mail_option(2,smsm_array,$(".xSelect-smsm_div1"),smsm_array1,xsel_id2,xsel_smsm_id2_pre);
					}
				});
			}else{
				$("#smsm_div2").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:smsm_array,
					module_type:"smsm_div2",
					check: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode8(obj,1,2);
					},
					setval:function(item,obj){
						var xsel_id2 = $(obj).find('span').data('value');
						change_mail_option(2,smsm_array,$(".xSelect-smsm_div1"),smsm_array1,xsel_id2,xsel_smsm_id2_pre);
					}
				});
			}
			
			$("#smsm_div2").data('value',-1);
		}

		function clear_smsm(){
			$("#smsm_suspend").find('input').val('');
			$("#SmsMConfigName").attr('disabled',false);
			$("#smsm_suspend").find('i.v-check').attr('class','v-check');
			$("#SmsMLimit").val(0);
			$("#EnCode_smsm").val(0).trigger('change');
			$("#Flag_smsm").val(2).trigger('change');
			//xsel_smsm_id1_pre = [-1];
			//xsel_smsm_id2_pre = [-1];
		}

		var smsm_result;
		function _editNode8(obj,type,flag){
			clear_smsm();
			var title;
			if (type == 1){
				//approveId = $(obj).parent().children('a').attr('id');
				smsmId = $(obj).children('span').data('value');
				$.ajax({
					url: "/bhost/select_smsm_all",
					type: "POST",
					async: false,
					data: { a0: se, z1: smsmId},
					success: function (result) {
						smsm_result = JSON.parse(result);
						smsm_result = smsm_result.data[0];	
						title = "短信猫";
					}
				});
			}else{
				smsmId = 0;
				title = "短信猫";
			}
			
			var $dialogCont = $("#smsm_suspend").show();
			
			var d = dialog({
				title:title,
				content:$dialogCont,
				id:"smsm_suspend",
				width:"800px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			smsm_main(type);
			$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
				clear_smsm();
				smsm_main(type);
				//d.close().remove();
			});
			
			$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
				smsmset_save(d,flag);
			});
		}

		var smsmset = {
			"SmsMConfigId": 0,
			"SmsMConfigName": "短信猫配置1",
			"SmsMSender": "13612345678",  
			"SmsMLimit": 0,
			"Flag":0,
			"EnCode":0
		}

		function smsm_main(type){
			if (manage_auth_array.indexOf(24) === -1){
				$("#smsm_suspend").find('.btn-submit').remove();
			}
			$("#SmsMLimit,#SmsMSender").bind('keydown', function(e){
				DigitInput(e);
			});
			if (type == 1){
				smsmset.SmsMConfigId=smsm_result.SmsMConfigId;
				$("#SmsMConfigName").val(smsm_result.SmsMConfigName);
				$("#SmsMConfigName").prop("disabled",true);
				$("#SmsMSender").val(smsm_result.SmsMSender);
				$("#SmsMLimit").val(smsm_result.SmsMLimit);
				$("#Flag_smsm").val(smsm_result.Flag).trigger('change');
				$("#EnCode_smsm").val(smsm_result.EnCode).trigger('change');
				if (smsm_result.Flag == 2){
					$.ajax({
						url:'/bhost/get_smsm_flag',
						type:'post',
						async:false,
						data:{a0:se},
						success:function(result){
							var smsm_flag = JSON.parse(result);
							if (smsm_flag.Result){
								if (smsm_flag.count_smsm == 2){
									$("#Flag_smsm").attr('disabled',true);
								}
							}
						}
					});
				}
			}else{
				smsmset.SmsMConfigId = 0;
				$.ajax({
					url:'/bhost/get_smsm_flag',
					type:'post',
					async:false,
					data:{a0:se},
					success:function(result){
						var smsm_flag = JSON.parse(result);
						if (smsm_flag.Result){
							if (smsm_flag.count_smsm == 1){
								$("#Flag_smsm").val(2).trigger('change');
								$("#Flag_smsm").attr('disabled',true);
							}else if (smsm_flag.def_smsm == 0){
								$("#Flag_smsm").val(2).trigger('change');
							}else if (smsm_flag.spare_smsm == 0){
								$("#Flag_smsm").val(1).trigger('change');
							}else{
								$("#Flag_smsm").val(0).trigger('change');
							}
						}
					}
				})
			}
		}

		//检查名称是否存在
		function check_name(name,obj){
			var add = 0;
			$.ajax({
				url:'/bhost/check_smsmconfig_name',
				type:'post',
				async:false,
				data:{a0:se,z1:name},
				success:function(result){
					if (result != "0"){
						add = 1;
						_alert(2,"短信猫","该名称已存在",$(obj));
						return false;
					}
				}
			})
			if (add == 1){
				return false;
			}else{
				return true;
			}
		}
		function limitCheck(obj){
			obj.value = obj.value.replace(/\D/g,"");
			var v = obj.value.trim();
			if (v == ""){
				obj.value = '0';
			}
		}

		//保存配置
		function smsmset_save(d,flag){
			var smsmset_list = [];
			var add = 0;
			var numCheck = /\D/;
			var isexist;
			var SmsMConfigName = $("#SmsMConfigName").val();
			var SmsMSender = $("#SmsMSender").val();
			var SmsMLimit = $("#SmsMLimit").val();
			var EnCode = $("#EnCode_smsm").val();
			var Flag =	$("#Flag_smsm").val();

			if (SmsMConfigName == ""){
				add = 1;
				_alert(2,"短信猫","请输入名称",$("#SmsMConfigName"));
				return false;
			}else{
				if (!nameCheck.test(SmsMConfigName)){
					add = 1;
					_alert(1,"短信猫","名称格式不正确",$("#SmsMConfigName"));
					return false;
				}
			}
			if (SmsMSender == ""){
				add = 1;
				_alert(2,"短信猫","请输入短信中心",$("#SmsMSender"));
				return false;
			}else{
				if (numCheck.test(SmsMSender)){
					add = 1;
					_alert(1,"短信猫","短信中心格式不正确",$("#SmsMSender"));
					return false;
				}
			}
			if (SmsMLimit == ""){
				add = 1;
				_alert(2,"短信猫","请输入发送限制",$("#SmsMLimit"));
				return false
			}else{
				if (numCheck.test(SmsMLimit)){
					add = 1;
					_alert(1,"短信猫","短信猫格式不正确",$("#SmsMLimit"));
					return false;
				}
			}
			smsmset.SmsMConfigName = SmsMConfigName;
			smsmset.SmsMSender = SmsMSender;
			smsmset.SmsMLimit = SmsMLimit;
			smsmset.EnCode = parseInt(EnCode);
			smsmset.Flag = parseInt(Flag);
			smsmset_list.push(JSON.stringify(smsmset));
			var msstr = aceg(JSON.stringify(smsmset_list),se);
			$.ajax({
				url:'/bhost/save_smsm',
				type:'post',
				async:false,
				data:{a0:se,z1:JSON.stringify(smsmset_list),m1:msstr},
				success:function(result){
					data = JSON.parse(result);
					if (data.Result == true){
						parent.layer.open({
							type:1,
							title:"短信猫",
							content:'<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
							btn:['确&nbsp;&nbsp;定'],
							btnAlign:'c',
							closeBtn: false,
							skin:'layer-custom',
							area:['380px','310px'],
							move: false,
							resize: false,
							btn1:function(i){
								parent.layer.close(i);
								$('.btn').blur();
								var smsm_text1 = $('#smsm_div1').find('span').text();
								var smsm_text2 = $('#smsm_div2').find('span').text();
								var smsm_id1 = $('#smsm_div1').data('value');
								var smsm_id2 = $('#smsm_div2').data('value');
								$("div[data-id=xSelect-smsm_div1]").remove();
								$("div[data-id=xSelect-smsm_div2]").remove();
								bind_smsm_select();
								if (flag == 1){
									if ($("#smsm_div1").data('value') == "-1" || $("#smsm_div1").data('value') == undefined){
										smsm_id1 = data.SmsMConfigId;
									}	
								}else{
									if ($("#smsm_div2").data('value') == "-1" || $("#smsm_div2").data('value') == undefined){
										smsm_id2 = data.SmsMConfigId;
									}
								}
								$(".xSelect-smsm_div1").find('span[data-value='+smsm_id1+']').click();
								$(".xSelect-smsm_div2").find('span[data-value='+smsm_id2+']').click();
								/*
								if (flag == 1){
									if ($("#smsm_div1").data('value') == "-1" || $("#smsm_div1").data('value') == undefined){
										//$("#smsm_div1").data('value',data.SmsMConfigId);
										//$("#smsm_div1").find('span').text(smsmset.SmsMConfigName);
										$(".xSelect-smsm_div1").find('span[data-value='+data.SmsMConfigId+']').click();
									}else{
										//$('#smsm_div1').find('span').text(smsm_text1);
										$(".xSelect-smsm_div1").find('span[data-value='+smsm_id1+']').click();
									}
									if (smsm_id2 != undefined && smsm_id2 != '-1'){
										//$("#smsm_div2").data('value',smsm_id2);
										//$("#smsm_div2").find('span').text(smsm_text2);
										$(".xSelect-smsm_div2").find('span[data-value='+smsm_id2+']').click();
									}
								}else{
									if ($("#smsm_div2").data('value') == "-1" || $("#smsm_div2").data('value') == undefined){
										//$("#smsm_div2").data('value',data.SmsMConfigId);
										//$("#smsm_div2").find('span').text(smsmset.SmsMConfigName);
										$(".xSelect-smsm_div2").find('span[data-value='+data.SmsMConfigId+']').click();
									}else{
										//$('#smsm_div2').find('span').text(smsm_text2);
										$(".xSelect-smsm_div2").find('span[data-value='+smsm_id2+']').click();
									}
									if (smsm_id1 != undefined && smsm_id1 != '-1'){
										//$("#smsm_div1").data('value',smsm_id1);
										//$("#smsm_div1").find('span').text(smsm_text1);
										$(".xSelect-smsm_div1").find('span[data-value='+smsm_id1+']').click();
									}
								}
								*/
								d.close().remove();
							},
							btn2:function(i){
								parent.layer.close(i);
							}
						});	
					}else{
						_alert(1,"短信猫", "执行失败：" + data.ErrMsg);
					}
				}
			});
		}

		//短信网关
		var xsel_smssvr_id1_pre = [-1];
		var xsel_smssvr_id2_pre = [-1];
		function bind_smssvr_select(){
			var smssvr_array1 = [0];
			var smssvr_array2 = [0];
			xsel_smssvr_id1_pre[0] = -1;
			xsel_smssvr_id2_pre[0] = -1;
			var smssvr_data;
			$.ajax({
				url:'/bhost/select_smssvr_all',
				type:'post',
				async:false,
				data:{a0:se,z1:-1},
				success:function(result){
					smssvr_data = JSON.parse(result);
				}
			});
			var smssvr_array = [];
			smssvr_array.push({'value':-1,'name':'全局指定','type':null});
			$.each(smssvr_data.data,function(i,item){
				if (manage_auth_array.indexOf(24) != -1){
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'edit'
					};
				}else{
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'check'
					};
				}
				select_data_json.value = item.SmsSvrConfigId;
				select_data_json.name = item.SmsSvrConfigName;
				smssvr_array.push(select_data_json);
				smssvr_array1.push(item.SmsSvrConfigId);
				smssvr_array2.push(item.SmsSvrConfigId);
			});
			$(".xSelect-smssvr_div1").remove();
			$("#smssvr_div1").empty().data("xSelect","");
			
			if (manage_auth_array.indexOf(24) != -1){
				$("#smssvr_div1").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:smssvr_array,
					module_type:"smssvr_div1",
					edit: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode9(obj,1,1);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								
								$(obj).parents('.xSelect-view').hide();
								_editNode9(obj,2,1);
							}
						}
					],
					setval:function(item,obj){
						var xsel_id1 = $(obj).find('span').data('value');
						change_mail_option(1,smssvr_array,$(".xSelect-smssvr_div2"),smssvr_array2,xsel_id1,xsel_smssvr_id1_pre);
					}
				});
			}else{
				$("#smssvr_div1").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:smssvr_array,
					module_type:"smssvr_div1",
					check: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode9(obj,1,1);
					},
					setval:function(item,obj){
						var xsel_id1 = $(obj).find('span').data('value');
						change_mail_option(1,smssvr_array,$(".xSelect-smssvr_div2"),smssvr_array2,xsel_id1,xsel_smssvr_id1_pre);
					}
				});
			}
			
			$("#smssvr_div1").data('value',-1);
			$(".xSelect-smssvr_div2").remove();
			$("#smssvr_div2").empty().data("xSelect","");
			
			if (manage_auth_array.indexOf(24) != -1){
				$("#smssvr_div2").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:smssvr_array,
					module_type:"smssvr_div2",
					edit: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode9(obj,1,2);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								
								$(obj).parents('.xSelect-view').hide();
								_editNode9(obj,2,2);
							}
						}
					],
					setval:function(item,obj){
						var xsel_id2 = $(obj).find('span').data('value');
						change_mail_option(2,smssvr_array,$(".xSelect-smssvr_div1"),smssvr_array1,xsel_id2,xsel_smssvr_id2_pre);
					}
				});
			}else{
				$("#smssvr_div2").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:smssvr_array,
					module_type:"smssvr_div2",
					check: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode9(obj,1,2);
					},
					setval:function(item,obj){
						var xsel_id2 = $(obj).find('span').data('value');
						change_mail_option(2,smssvr_array,$(".xSelect-smssvr_div1"),smssvr_array1,xsel_id2,xsel_smssvr_id2_pre);
					}
				});
			}
			
			$("#smssvr_div2").data('value',-1);
		}

		function clear_smssvr(){
			$("#smssvr_suspend").find('input').val('');
			$("#SmsSvrConfigName").attr('disabled',false);
			$("#smssvr_suspend").find('i.v-check').attr('class','v-check');
			$("#SmsSvrDBType").val(1).trigger('change');
			$("#EnCode_smssvr").val(0).trigger('change');
			$("#Flag_smssvr").val(2).trigger('change');
			//xsel_smssvr_id1_pre[0] = -1;
			//xsel_smssvr_id2_pre[0] = -1;
		}

		var smssvr_result;
		function _editNode9(obj,type,flag){
			clear_smssvr();
			var title;
			if (type == 1){
				//approveId = $(obj).parent().children('a').attr('id');
				smssvrId = $(obj).children('span').data('value');
				$.ajax({
					url: "/bhost/select_smssvr_all",
					type: "POST",
					async: false,
					data: { a0: se, z1: smssvrId},
					success: function (result) {
						smssvr_result = JSON.parse(result);
						smssvr_result = smssvr_result.data[0];	
						title = "短信网关";
					}
				});
			}else{
				smssvrId = 0;
				title = "短信网关";
			}
			
			var $dialogCont = $("#smssvr_suspend").show();
			
			var d = dialog({
				title:title,
				content:$dialogCont,
				id:"smssvr_suspend",
				width:"800px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			smssvr_main(type);
			$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
				clear_smssvr();
				smssvr_main(type);
				//d.close().remove();
			});
			
			$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
				smssvr_save(d,flag);
			});
		}

		var smssvset = {
			"SmsSvrConfigId": 0,
			"SmsSvrConfigName": "短信网关配置1",
			"SmsSvrDBType": 2, 
			"SmsSvrDBServerIP": "192.168.0.1",        
			"SmsSvrDBPort": 1433,
			"SmsSvrDBUserName": "root",       
			"SmsSvrDBPassword": "d106f6959747b5ac",
			"SmsSvrDBDatabase": "mysql",
			"SmsSvrDBInsertTemp": null,
			"Flag":0,
			"EnCode":0
		}

		function smssvr_main(type){
			if (manage_auth_array.indexOf(24) === -1){
				$("#smssvr_suspend").find('.btn-submit').remove();
			}
			$("#SmsSvrDBPort").bind('keydown', function(e){
				DigitInput(e);
			});
			if (type == 1){
				smssvset.SmsSvrConfigId = smssvr_result.SmsSvrConfigId;
				$("#SmsSvrConfigName").val(smssvr_result.SmsSvrConfigName);
				$("#SmsSvrConfigName").prop("disabled",true);
				$("#SmsSvrDBType").val(smssvr_result.SmsSvrDBType).trigger('change');
				$("#SmsSvrDBServerIP").val(smssvr_result.SmsSvrDBServerIP);
				$("#SmsSvrDBPort").val(smssvr_result.SmsSvrDBPort);
				$("#SmsSvrDBUserName").val(smssvr_result.SmsSvrDBUserName);
				$("#SmsSvrDBPassword").val(smssvr_result.SmsSvrDBPassword);
				$("#SmsSvrDBDatabase").val(smssvr_result.SmsSvrDBDatabase);
				if (smssvr_result.SmsSvrDBInsertTemp != null){
					$("#SmsSvrDBInsertTemp").val(smssvr_result.SmsSvrDBInsertTemp);
				}
				$("#Flag_smssvr").val(smssvr_result.Flag).trigger('change');
				$("#EnCode_smssvr").val(smssvr_result.EnCode).trigger('change');
				if (smssvr_result.Flag == 2){
					$.ajax({
						url:'/bhost/get_smssvr_flag',
						type:'post',
						async:false,
						data:{a0:se},
						success:function(result){
							var smssvr_flag = JSON.parse(result);
							if (smssvr_flag.Result){
								if (smssvr_flag.count_smssvr == 2){
									$("#Flag_smssvr").attr('disabled',true);
								}
							}
						}
					})
				}
			}else{
				smssvset.SmsSvrConfigId=0;
				$.ajax({
					url:'/bhost/get_smssvr_flag',
					type:'post',
					async:false,
					data:{a0:se},
					success:function(result){
						var smssvr_flag = JSON.parse(result);
						if (smssvr_flag.Result){
							if (smssvr_flag.count_smssvr == 1){
								$("#Flag_smssvr").val(2).trigger('change');
								$("#Flag_smssvr").attr('disabled',true);
							}else if (smssvr_flag.def_smssvr == 0){
								$("#Flag_smssvr").val(2).trigger('change');
							}else if (smssvr_flag.spare_smssvr == 0){
								$("#Flag_smssvr").val(1).trigger('change');
							}else{
								$("#Flag_smssvr").val(0).trigger('change');
							}
						}
					}
				})
			}
		}

		function temp_check(obj){
			var v = $(obj).val();
			var $i = $(obj).next('i.v-check');
			if (v.indexOf("%phone%") === -1 || v.indexOf("%content%") === -1){
				$i.show().attr('class','v-check v-wrong');
			}else{
				$i.show().attr('class','v-check v-right');
			}
		}

		//保存配置
		function smssvr_save(d,flag){
			var numCheck = /\D/;
			var SmsSvrConfigName = $("#SmsSvrConfigName").val();
			var SmsSvrDBType = $("#SmsSvrDBType").val();
			var SmsSvrDBServerIP = $("#SmsSvrDBServerIP").val();
			var SmsSvrDBPort = $("#SmsSvrDBPort").val();
			var SmsSvrDBUserName = $("#SmsSvrDBUserName").val();
			var SmsSvrDBPassword = $("#SmsSvrDBPassword").val();
			var SmsSvrDBDatabase = $("#SmsSvrDBDatabase").val();
			var SmsSvrDBInsertTemp = $("#SmsSvrDBInsertTemp").val();
			if (SmsSvrConfigName == ""){
				_alert(2,"短信网关","请输入名称",$("#SmsSvrConfigName"));
				return false;
			}else{
				if (!nameCheck.test(SmsSvrConfigName)){
					_alert(1,"短信网关","名称格式不正确",$("#SmsSvrConfigName"));
					return false;
				}
			}
			if (SmsSvrDBServerIP == ""){
				_alert(2,"短信网关","请输入服务器地址",$("#SmsSvrDBServerIP"));
				return false;
			}else{
				if (!ipcheck_route.test(SmsSvrDBServerIP)){
					_alert(1,"短信网关","服务器地址格式不正确",$("#SmsSvrDBServerIP"));
					return false;
				}
			}
			if (SmsSvrDBPort == ""){
				_alert(2,"短信网关","请输入端口",$("#SmsSvrDBPort"));
				return false;
			}else{
				if (numCheck.test(SmsSvrDBPort)){
					_alert(1,"短信网关","端口格式不正确",$("#SmsSvrDBPort"));
					return false;
				}
				if (parseInt(SmsSvrDBPort) > 65534){
					_alert(1,"短信网关","端口不能大于65534",$("#SmsSvrDBPort"));
					return false;
				}
				if (parseInt(SmsSvrDBPort) < 1){
					_alert(1,"短信网关","端口不能小于1",$("#SmsSvrDBPort"));
					return false;
				}
			}
			if (SmsSvrDBUserName == ""){
				_alert(2,"短信网关","请输入账号",$("#SmsSvrDBUserName"));
				return false;
			}else{
				if (!nameCheck.test(SmsSvrDBUserName)){
					_alert(1,"短信网关","账号格式不正确",$("#SmsSvrDBUserName"));
					return false;
				}
			}
			if (SmsSvrDBPassword == ""){
				_alert(2,"短信网关","请输入密码",$("#SmsSvrDBPassword"));
				return false;
			}
			if (SmsSvrDBDatabase == ""){
				_alert(2,"短信网关","请输入数据库",$("#SmsSvrDBDatabase"));
				return false;
			}
			if (SmsSvrDBInsertTemp == ""){
				_alert(2,"短信网关","请输入短信sql语句模板",$("#SmsSvrDBInsertTemp"));
				return false;
			}else{
				if (SmsSvrDBInsertTemp.indexOf("%phone%") === -1 || SmsSvrDBInsertTemp.indexOf("%content%") === -1){
					_alert(1,"短信网关","模板格式不正确",$("#SmsSvrDBInsertTemp"));
					return false;
				}
			}
			smssvset.SmsSvrConfigName = SmsSvrConfigName;
			smssvset.SmsSvrDBType = SmsSvrDBType;
			smssvset.SmsSvrDBServerIP = SmsSvrDBServerIP;
			smssvset.SmsSvrDBPort = SmsSvrDBPort;
			smssvset.SmsSvrDBUserName = SmsSvrDBUserName;
			smssvset.SmsSvrDBPassword = SmsSvrDBPassword;
			smssvset.SmsSvrDBDatabase = SmsSvrDBDatabase;
			smssvset.SmsSvrDBInsertTemp = SmsSvrDBInsertTemp;
			smssvset.Flag = parseInt($("#Flag_smssvr").val());
			smssvset.EnCode = parseInt($("#EnCode_smssvr").val());
			var msstr = aceg(JSON.stringify(smssvset),se);
			$.ajax({
				url:'/bhost/save_smssvr',
				type:'post',
				async:false,
				data:{a0:se,z1:JSON.stringify(smssvset),a10:"运维管理>指令授权",m1:msstr},
				success:function(result){
					data = JSON.parse(result);
					if (data.Result == true){
						parent.layer.open({
							type:1,
							title:"短信网关",
							content:'<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
							btn:['确&nbsp;&nbsp;定'],
							btnAlign:'c',
							closeBtn: false,
							skin:'layer-custom',
							area:['380px','310px'],
							move: false,
							resize: false,
							btn1:function(i){
								parent.layer.close(i);
								$('.btn').blur();
								var smssvr_text1 = $('#smssvr_div1').find('span').text();
								var smssvr_text2 = $('#smssvr_div2').find('span').text();
								var smssvr_id1 = $('#smssvr_div1').data('value');
								var smssvr_id2 = $('#smssvr_div2').data('value');
								$("div[data-id=xSelect-smssvr_div1]").remove();
								$("div[data-id=xSelect-smssvr_div2]").remove();
								bind_smssvr_select();
								if (flag == 1){
									if ($("#smssvr_div1").data('value') == "-1" || $("#smssvr_div1").data('value') == undefined){
										smssvr_id1 = data.SmsSvrConfigId;
									}
								}else{
									if ($("#smssvr_div2").data('value') == "-1" || $("#smssvr_div2").data('value') == undefined){
										smssvr_id2 = data.SmsSvrConfigId;
									}
								}
								$(".xSelect-smssvr_div1").find('span[data-value='+smssvr_id1+']').click();
								$(".xSelect-smssvr_div2").find('span[data-value='+smssvr_id2+']').click();
								/*
								if (flag == 1){
									if ($("#smssvr_div1").data('value') == "-1" || $("#smssvr_div1").data('value') == undefined){
										//$("#smssvr_div1").data('value',data.SmsSvrConfigId);
										//$("#smssvr_div1").find('span').text(smssvset.SmsSvrConfigName);
										$(".xSelect-smssvr_div1").find('span[data-value='+data.SmsSvrConfigId+']').click();
									}else{
										//$('#smssvr_div1').find('span').text(smssvr_text1);
										$(".xSelect-smssvr_div1").find('span[data-value='+smssvr_id1+']').click();
									}
									if (smssvr_id2 != undefined && smssvr_id2 != '-1'){
										//$("#smssvr_div2").data('value',smssvr_id2);
										//$("#smssvr_div2").find('span').text(smssvr_text2);
										$(".xSelect-smssvr_div2").find('span[data-value='+smssvr_id2+']').click();
									}
								}else{
									if ($("#smssvr_div2").data('value') == "-1" || $("#smssvr_div2").data('value') == undefined){
										//$("#smssvr_div2").data('value',data.SmsSvrConfigId);
										//$("#smssvr_div2").find('span').text(smssvset.SmsSvrConfigName);
										$(".xSelect-smssvr_div2").find('span[data-value='+data.SmsSvrConfigId+']').click();
									}else{
										//$('#smssvr_div2').find('span').text(smssvr_text2);
										$(".xSelect-smssvr_div2").find('span[data-value='+smssvr_id2+']').click();
									}
									if (smssvr_id1 != undefined && smssvr_id1 != '-1'){
										//$("#smssvr_div1").data('value',smssvr_id1);
										//$("#smssvr_div1").find('span').text(smssvr_text1);
										$(".xSelect-smssvr_div2").find('span[data-value='+smssvr_id1+']').click();
									}
								}
								*/
								d.close().remove();
							},
							btn2:function(i){
								parent.layer.close(i);
							}
						});	
					}else{
						_alert(1,"短信网关","执行失败：" + data.ErrMsg);
					}
				}
			});
		}

		//snmp
		var	xsel_snmp_id1_pre = [-1];
		var	xsel_snmp_id2_pre = [-1];
		function bind_snmp_select(){
			var snmp_array1 = [0];
			var snmp_array2 = [0];
			xsel_snmp_id1_pre[0] = -1;
			xsel_snmp_id2_pre[0] = -1;
			var snmp_data;
			$.ajax({
				url:'/bhost/select_snmp_all',
				type:'post',
				async:false,
				data:{a0:se,z1:-1},
				success:function(result){
					snmp_data = JSON.parse(result);
				}
			});
			var snmp_array = [];
			snmp_array.push({'value':-1,'name':'全局指定','type':null});
			$.each(snmp_data.data,function(i,item){
				if (manage_auth_array.indexOf(24) != -1){
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'edit'
					};
				}else{
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'check'
					};
				}
				select_data_json.value = item.SnmpConfigId;
				select_data_json.name = item.SnmpConfigName;
				snmp_array.push(select_data_json);
				snmp_array1.push(item.SnmpConfigId);
				snmp_array2.push(item.SnmpConfigId);
			});
			$(".xSelect-snmp_div1").remove();
			$("#snmp_div1").empty().data("xSelect","");
			
			if (manage_auth_array.indexOf(24) != -1){
				$("#snmp_div1").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:snmp_array,
					module_type:"snmp_div1",
					edit: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode10(obj,1,1);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								
								$(obj).parents('.xSelect-view').hide();
								_editNode10(obj,2,1);
							}
						}
					],
					setval:function(item,obj){
						var xsel_id1 = $(obj).find('span').data('value');
						change_mail_option(1,snmp_array,$(".xSelect-snmp_div2"),snmp_array2,xsel_id1,xsel_snmp_id1_pre);
					}
				});
			}else{
				$("#snmp_div1").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:snmp_array,
					module_type:"snmp_div1",
					check: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode10(obj,1,1);
					},
					setval:function(item,obj){
						var xsel_id1 = $(obj).find('span').data('value');
						change_mail_option(1,snmp_array,$(".xSelect-snmp_div2"),snmp_array2,xsel_id1,xsel_snmp_id1_pre);
					}
				});
			}
			
			$("#snmp_div1").data('value',-1);
			$(".xSelect-snmp_div2").remove();
			$("#snmp_div2").empty().data("xSelect","");
			
			if (manage_auth_array.indexOf(24) != -1){
				$("#snmp_div2").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:snmp_array,
					module_type:"snmp_div2",
					edit: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode10(obj,1,2);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								
								$(obj).parents('.xSelect-view').hide();
								_editNode10(obj,2,2);
							}
						}
					],
					setval:function(item,obj){
						var xsel_id2 = $(obj).find('span').data('value');
						change_mail_option(2,snmp_array,$(".xSelect-snmp_div1"),snmp_array1,xsel_id2,xsel_snmp_id2_pre);
					}
				});
			}else{
				$("#snmp_div2").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:snmp_array,
					module_type:"snmp_div2",
					check: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode10(obj,1,2);
					},
					setval:function(item,obj){
						var xsel_id2 = $(obj).find('span').data('value');
						change_mail_option(2,snmp_array,$(".xSelect-snmp_div1"),snmp_array1,xsel_id2,xsel_snmp_id2_pre);
					}
				});
			}
			
			$("#snmp_div2").data('value',-1);
		}

		function clear_snmp(){
			$("#snmp_suspend").find('input').val('');
			$("#SnmpConfigName").attr('disabled',false);
			$("#snmp_suspend").find('i.v-check').attr('class','v-check');
			$("#EnCode_snmp").val(0).trigger('change');
			$("#Flag_snmp").val(2).trigger('change');
			//xsel_snmp_id1_pre[0] = -1;
			//xsel_snmp_id2_pre[0] = -1;
		}

		var snmp_result;
		function _editNode10(obj,type,flag){
			clear_snmp();
			var title;
			if (type == 1){
				//approveId = $(obj).parent().children('a').attr('id');
				snmpId = $(obj).children('span').data('value');
				$.ajax({
					url: "/bhost/select_snmp_all",
					type: "POST",
					async: false,
					data: { a0: se, z1: snmpId},
					success: function (result) {
						snmp_result = JSON.parse(result);
						snmp_result = snmp_result.data[0];	
						title = "SNMP";
					}
				});
			}else{
				snmpId = 0;
				title = "SNMP";
			}
			
			var $dialogCont = $("#snmp_suspend").show();
			
			var d = dialog({
				title:title,
				content:$dialogCont,
				id:"snmp_suspend",
				width:"800px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			snmp_main(type);
			$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
				clear_snmp();
				snmp_main(type);
				//d.close().remove();
			});
			
			$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
				snmp_save(d,flag);
			});
		}

		var snmp = {
			"SnmpConfigId": 0, 
			"SnmpConfigName": "SYSLOG配置1",           
			"SnmpServerIP": "192.168.0.54",
			"SnmpPort": 514,
			"Flag":0,
			"EnCode":0
		}

		function snmp_main(type){
			if (manage_auth_array.indexOf(24) === -1){
				$("#snmp_suspend").find(".btn-submit").remove();
			}
			$("#SnmpPort").bind('keydown', function(e){
				DigitInput(e);
			});
			if (type == 1){
				snmp.SnmpConfigId = snmp_result.SnmpConfigId;
				$("#SnmpConfigName").val(snmp_result.SnmpConfigName);
				$("#SnmpConfigName").prop("disabled",true);
				$("#SnmpServerIP").val(snmp_result.SnmpServerIP);
				$("#SnmpPort").val(snmp_result.SnmpPort);
				$("#EnCode_snmp").val(snmp_result.EnCode).trigger('change');
				$("#Flag_snmp").val(snmp_result.Flag).trigger('change');
				if (snmp_result.Flag == 2){
					$.ajax({
						url:'/bhost/get_snmp_flag',
						type:'post',
						async:false,
						data:{a0:se},
						success:function(result){
							var snmp_flag = JSON.parse(result);
							if (snmp_flag.Result){
								if (snmp_flag.count_snmp == 2){
									$("#Flag_snmp").attr('disabled',true);
								}					
							}
						}
					})
				}
			}else{
				snmp.SnmpConfigId = 0;
				$.ajax({
					url:'/bhost/get_snmp_flag',
					type:'post',
					async:false,
					data:{a0:se},
					success:function(result){
						var snmp_flag = JSON.parse(result);
						if (snmp_flag.Result){
							if (snmp_flag.count_snmp == 1){
								$("#Flag_snmp").val(2).trigger('change');
								$("#Flag_snmp").attr('disabled',true);
							}else if (snmp_flag.def_snmp == 0){
								$("#Flag_snmp").val(2).trigger('change');
							}else if (snmp_flag.spare_snmp == 0){
								$("#Flag_snmp").val(1).trigger('change');
							}else{
								$("#Flag_snmp").val(0).trigger('change');
							}
						}
					}
				})
			}
		}

		function PortCheck(obj){
			var numCheck = /\D/;
			var num = $(obj).val().trim();
			var $i = $(obj).next('i.v-check');
			if (numCheck.test(num) || num == "" || parseInt(num) < 1 || parseInt(num) > 65534){	
				$i.show().attr('class','v-check v-wrong');
			}else{
				$i.show().attr('class','v-check v-right');
			}
		}
		//保存配置
		function snmp_save(d,flag){
			var numCheck = /\D/;
			var snmp_list = [];
			var isexist;
			var SnmpConfigName = $("#SnmpConfigName").val();
			var SnmpServerIP = $("#SnmpServerIP").val();
			var SnmpPort = $("#SnmpPort").val();
			var Flag = $("#Flag_snmp").val();
			var EnCode = $("#EnCode_snmp").val();
			
			if (SnmpConfigName == ""){
				_alert(2,"SNMP","请输入名称",$("#SnmpConfigName"));
				return false;
			}else{
				if (!nameCheck.test(SnmpConfigName)){
					_alert(1,"SNMP","名称格式不正确",$("#SnmpConfigName"));
					return false;
				}
			}

			if (SnmpServerIP == ""){
				_alert(2,"SNMP","请输入服务器地址",$("#SnmpServerIP"));
				return false;
			}else{
				if (!ipcheck_route.test(SnmpServerIP)){
					_alert(1,"SNMP","服务器地址格式不正确",$("#SnmpServerIP"));
					return false;
				}
			}
			if (SnmpPort == ""){
				_alert(2,"SNMP","请输入端口",$("#SnmpPort"));
				return false
			}else{
				if (numCheck.test(parseInt(SnmpPort))){
					_alert(1,"SNMP","端口格式不正确",$("#SnmpPort"));
					return false;
				}
				if (parseInt(SnmpPort) < 1){
					_alert(1,"SNMP","端口不能小于1",$("#SnmpPort"));
					return false;
				}
				if (parseInt(SnmpPort) > 65534){
					add = 1;
					_alert(1,"SNMP","端口不能大于65534",$("#SnmpPort"));
					return false;
				}
			}
			snmp.SnmpConfigName = SnmpConfigName;
			snmp.SnmpServerIP = SnmpServerIP;
			snmp.SnmpPort = parseInt(SnmpPort);
			snmp.Flag = parseInt(Flag);
			snmp.EnCode = parseInt(EnCode);
			snmp_list.push(JSON.stringify(snmp));
			var msstr = aceg(JSON.stringify(snmp_list),se);
			$.ajax({
				url:'/bhost/save_snmp',
				type:'post',
				async:false,
				data:{a0:se,z1:JSON.stringify(snmp_list),a10:"运维管理>指令授权",m1:msstr},
				success:function(result){
					data = JSON.parse(result);
					if (data.Result == true){
						parent.layer.open({
							type:1,
							title:"SNMP",
							content:'<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
							btn:['确&nbsp;&nbsp;定'],
							btnAlign:'c',
							closeBtn: false,
							skin:'layer-custom',
							area:['380px','310px'],
							move: false,
							resize: false,
							btn1:function(i){
								parent.layer.close(i);
								$('.btn').blur();
								var snmp_text1 = $('#snmp_div1').find('span').text();
								var snmp_text2 = $('#snmp_div2').find('span').text();
								var snmp_id1 = $('#snmp_div1').data('value');
								var snmp_id2 = $('#snmp_div2').data('value');
								$("div[data-id=xSelect-snmp_div1]").remove();
								$("div[data-id=xSelect-snmp_div2]").remove();
								bind_snmp_select();
								if (flag == 1){
									if ($("#snmp_div1").data('value') == "-1" || $("#snmp_div1").data('value') == undefined){
										snmp_id1 = data.SnmpConfigId;
									}
								}else{
									if ($("#snmp_div2").data('value') == "-1" || $("#snmp_div2").data('value') == undefined){
										snmp_id2 = data.SnmpConfigId;
									}
								}
								$(".xSelect-snmp_div1").find('span[data-value='+snmp_id1+']').click();
								$(".xSelect-snmp_div2").find('span[data-value='+snmp_id2+']').click();
								/*
								if (flag == 1){
									if ($("#snmp_div1").data('value') == "-1" || $("#snmp_div1").data('value') == undefined){
										//$("#snmp_div1").data('value',data.SnmpConfigId);
										//$("#snmp_div1").find('span').text(snmp.SnmpConfigName);
										$(".xSelect-snmp_div1").find('span[data-value='+data.SnmpConfigId+']').click();
									}else{
										//$('#snmp_div1').find('span').text(snmp_text1);
										$(".xSelect-snmp_div1").find('span[data-value='+snmp_id1+']').click();
									}
									if (snmp_id2 != undefined && snmp_id2 != '-1'){
										//$("#snmp_div2").data('value',snmp_id2);
										//$("#snmp_div2").find('span').text(snmp_text2);
										$(".xSelect-snmp_div2").find('span[data-value='+snmp_id2+']').click();
									}
								}else{
									if ($("#snmp_div2").data('value') == "-1" || $("#snmp_div2").data('value') == undefined){
										//$("#snmp_div2").data('value',data.SnmpConfigId);
										//$("#snmp_div2").find('span').text(snmp.SnmpConfigName);
										$(".xSelect-snmp_div2").find('span[data-value='+data.SnmpConfigId+']').click();
									}else{
										//$('#snmp_div2').find('span').text(snmp_text2);
										$(".xSelect-snmp_div2").find('span[data-value='+snmp_id2+']').click();
									}
									if (snmp_id1 != undefined && snmp_id1 != '-1'){
										//$("#snmp_div1").data('value',snmp_id1);
										//$("#snmp_div1").find('span').text(snmp_text1);
										$(".xSelect-snmp_div1").find('span[data-value='+snmp_id1+']').click();
									}
								}
								*/
								d.close().remove();
							},
							btn2:function(i){
								parent.layer.close(i);
							}
						});	
					}else{
						_alert(1,"SNMP","执行失败：" + data.ErrMsg);
					}
				}
			});
		}

		//SYSLOG
		var	xsel_syslog_id1_pre = [-1];
		var	xsel_syslog_id2_pre = [-1];
		function bind_syslog_select(){
			var syslog_array1 = [0];
			var syslog_array2 = [0];
			xsel_syslog_id1_pre[0] = -1;
			xsel_syslog_id2_pre[0] = -1;
			var syslog_data;
			$.ajax({
				url:'/bhost/select_syslog_all',
				type:'post',
				async:false,
				data:{a0:se,z1:-1},
				success:function(result){
					syslog_data = JSON.parse(result);
				}
			});
			var syslog_array = [];
			syslog_array.push({'value':-1,'name':'全局指定','type':null});
			$.each(syslog_data.data,function(i,item){
				if (manage_auth_array.indexOf(24) != -1){
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'edit'
					};
				}else{
					var select_data_json = {
						'value':1,
						'name':'admin2',
						'type':'check'
					};
				}
				select_data_json.value = item.SyslogConfigId;
				select_data_json.name = item.SyslogConfigName;
				syslog_array.push(select_data_json);
				syslog_array1.push(item.SyslogConfigId);
				syslog_array2.push(item.SyslogConfigId);
			});
			$(".xSelect-syslog_div1").remove();
			$("#syslog_div1").empty().data("xSelect","");
			
			if (manage_auth_array.indexOf(24) != -1){
				$("#syslog_div1").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:syslog_array,
					module_type:"syslog_div1",
					edit: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode11(obj,1,1);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								
								$(obj).parents('.xSelect-view').hide();
								_editNode11(obj,2,1);
							}
						}
					],
					setval:function(item,obj){
						var xsel_id1 = $(obj).find('span').data('value');
						change_mail_option(1,syslog_array,$(".xSelect-syslog_div2"),syslog_array2,xsel_id1,xsel_syslog_id1_pre);
					}
				});
			}else{
				$("#syslog_div1").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:syslog_array,
					module_type:"syslog_div1",
					check: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode11(obj,1,1);
					},
					setval:function(item,obj){
						var xsel_id1 = $(obj).find('span').data('value');
						change_mail_option(1,syslog_array,$(".xSelect-syslog_div2"),syslog_array2,xsel_id1,xsel_syslog_id1_pre);
					}
				});
			}
			
			$("#syslog_div1").data('value',-1);
			$(".xSelect-syslog_div2").remove();
			$("#syslog_div2").empty().data("xSelect","");
			
			if (manage_auth_array.indexOf(24) != -1){
				$("#syslog_div2").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:syslog_array,
					module_type:"syslog_div2",
					edit: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode11(obj,1,2);
					},
					btn:[
						{
							'name':'新增',
							'event': function(items,obj){
								
								$(obj).parents('.xSelect-view').hide();
								_editNode11(obj,2,2);
							}
						}
					],
					setval:function(item,obj){
						var xsel_id2 = $(obj).find('span').data('value');
						change_mail_option(2,syslog_array,$(".xSelect-syslog_div1"),syslog_array1,xsel_id2,xsel_syslog_id2_pre);
					}
				});
			}else{
				$("#syslog_div2").xSelect({
					width: 162,
					defaultText: '全局指定',
					items:syslog_array,
					module_type:"syslog_div2",
					check: function(item,obj){
						
						$(obj).parents('.xSelect-view').hide();
						_editNode11(obj,1,2);
					},
					setval:function(item,obj){
						var xsel_id2 = $(obj).find('span').data('value');
						change_mail_option(2,syslog_array,$(".xSelect-syslog_div1"),syslog_array1,xsel_id2,xsel_syslog_id2_pre);
					}
				});
			}
			
			$("#syslog_div2").data('value',-1);
		}

		function clear_syslog(){
			$("#syslog_suspend").find('input').val('');
			$("#SyslogConfigName").attr('disabled',false);
			$("#syslog_suspend").find('i.v-check').attr('class','v-check');
			$("#EnCode_syslog").val(0).trigger('change');
			$("#Flag_syslog").val(2).trigger('change');
			//xsel_syslog_id1_pre[0] = -1;
			//xsel_syslog_id2_pre[0] = -1;
		}

		var syslog_result;
		function _editNode11(obj,type,flag){
			clear_syslog();
			var title;
			if (type == 1){
				//approveId = $(obj).parent().children('a').attr('id');
				syslogId = $(obj).children('span').data('value');
				$.ajax({
					url: "/bhost/select_syslog_all",
					type: "POST",
					async: false,
					data: { a0: se, z1: syslogId},
					success: function (result) {
						syslog_result = JSON.parse(result);
						syslog_result = syslog_result.data[0];	
						title = "SYSLOG";
					}
				});
			}else{
				syslogId = 0;
				title = "SYSLOG";
			}
			
			var $dialogCont = $("#syslog_suspend").show();
			
			var d = dialog({
				title:title,
				content:$dialogCont,
				id:"syslog_suspend",
				width:"800px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			syslog_main(type);
			$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
				clear_syslog();
				syslog_main(type);
				//d.close().remove();
			});
			
			$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
				syslog_save(d,flag);
			});
		}

		var syslog = {
			"SyslogConfigId": 0, 
			"SyslogConfigName": "SYSLOG配置1",           
			"SyslogServerIP": "192.168.0.54",
			"SyslogPort": 514,
			"Flag":0,
			"EnCode":0
		}

		function syslog_main(type){
			if (manage_auth_array.indexOf(24) === -1){
				$("#syslog_suspend").find(".btn-submit").remove();
			}
			$("#SyslogPort").bind('keydown', function(e){
				DigitInput(e);
			});
			if (type == 1){
				syslog.SyslogConfigId = syslog_result.SyslogConfigId;
				$("#SyslogConfigName").val(syslog_result.SyslogConfigName);
				$("#SyslogConfigName").prop("disabled",true);
				$("#SyslogServerIP").val(syslog_result.SyslogServerIP);
				$("#SyslogPort").val(syslog_result.SyslogPort);
				$("#Flag_syslog").val(syslog_result.Flag).trigger('change');
				$("#EnCode_syslog").val(syslog_result.EnCode).trigger('change');
				if (syslog_result.Flag == 2){
					$.ajax({
						url:'/bhost/get_syslog_flag',
						type:'post',
						async:false,
						data:{a0:se},
						success:function(result){
							var syslog_flag = JSON.parse(result);
							if (syslog_flag.Result){
								if (syslog_flag.count_syslog == 2){
									$("#Flag_syslog").attr('disabled',true);
								}			
							}
						}
					})
				}
			}else{
				syslog.SyslogConfigId = 0;
				$.ajax({
					url:'/bhost/get_syslog_flag',
					type:'post',
					async:false,
					data:{a0:se},
					success:function(result){
						var syslog_flag = JSON.parse(result);
						if (syslog_flag.Result){
							if (syslog_flag.count_syslog == 1){
								$("#Flag_syslog").val(2).trigger('change');
								$("#Flag_syslog").attr('disabled',true);
							}else if (syslog_flag.def_syslog == 0){
								$("#Flag_syslog").val(2).trigger('change');
							}else if (syslog_flag.spare_syslog == 0){
								$("#Flag_syslog").val(1).trigger('change');
							}else{
								$("#Flag_syslog").val(0).trigger('change');
							}
						}
					}
				})
			}
		}

		function syslog_save(d,flag){
			var numCheck = /\D/;
			var syslog_list = [];
			var SyslogConfigName = $("#SyslogConfigName").val();
			var SyslogServerIP = $("#SyslogServerIP").val();
			var SyslogPort = $("#SyslogPort").val();
			var EnCode = $("#EnCode_syslog").val();
			var Flag = $("#Flag_syslog").val();
			if (SyslogConfigName == ""){
				_alert(2,"SYSLOG","请输入名称",$("#SyslogConfigName"));
				return false;
			}else{
				if (!nameCheck.test(SyslogConfigName)){
					_alert(1,"SYSLOG","名称格式不正确",$("#SyslogConfigName"));
					return false;
				}
			}

			if (SyslogServerIP == ""){
				_alert(2,"SYSLOG","请输入服务器地址",$("#SyslogServerIP"));
				return false;
			}else{
				if (!ipcheck_route.test(SyslogServerIP)){
					_alert(2,"SYSLOG","服务器地址不正确",$("#SyslogServerIP"));
					return false;
				}
			}
			if (SyslogPort == ""){
				_alert(2,"SYSLOG","请输入端口",$("#SyslogPort"));
				return false
			}else{
				if (numCheck.test(parseInt(SyslogPort))){
					_alert(1,"SYSLOG","端口不正确",$("#SyslogPort"));
					return false;
				}
				if (parseInt(parseInt(SyslogPort)) < 1){
					_alert(1,"SYSLOG","端口不能小于1",$("#SyslogPort"));
					return false;
				}
				if (parseInt(parseInt(SyslogPort)) > 65534){
					_alert(1,"SYSLOG","端口不能大于65534",$("#SyslogPort"));
					return false;
				}
			}
			syslog.SyslogConfigName = SyslogConfigName;
			syslog.SyslogServerIP = SyslogServerIP;
			syslog.SyslogPort = parseInt(SyslogPort);
			syslog.EnCode = parseInt(EnCode);
			syslog.Flag = parseInt(Flag);	
			syslog_list.push(JSON.stringify(syslog));
			var msstr = aceg(JSON.stringify(syslog_list),se);
			$.ajax({
				url:'/bhost/save_syslog',
				type:'post',
				async:false,
				data:{a0:se,z1:JSON.stringify(syslog_list),a10:"运维管理>指令授权",m1:msstr},
				success:function(result){
					data = JSON.parse(result);
					if (data.Result == true){
						parent.layer.open({
							type:1,
							title:"SYSLOG",
							content:'<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
							btn:['确&nbsp;&nbsp;定'],
							btnAlign:'c',
							closeBtn: false,
							skin:'layer-custom',
							area:['380px','310px'],
							move: false,
							resize: false,
							btn1:function(i){
								parent.layer.close(i);
								$('.btn').blur();
								var syslog_text1 = $('#syslog_div1').find('span').text();
								var syslog_text2 = $('#syslog_div2').find('span').text();
								var syslog_id1 = $('#syslog_div1').data('value');
								var syslog_id2 = $('#syslog_div2').data('value');
								$("div[data-id=xSelect-syslog_div1]").remove();
								$("div[data-id=xSelect-syslog_div2]").remove();
								bind_syslog_select();
								if (flag == 1){
									if ($("#syslog_div1").data('value') == "-1" || $("#syslog_div1").data('value') == undefined){
										syslog_id1 = data.SyslogConfigId;
									}
								}else{
									if ($("#syslog_div2").data('value') == "-1" || $("#syslog_div2").data('value') == undefined){
										syslog_id2 = data.SyslogConfigId;
									}
								}
								$(".xSelect-syslog_div1").find('span[data-value='+syslog_id1+']').click();
								$(".xSelect-syslog_div2").find('span[data-value='+syslog_id2+']').click();
								/*
								if (flag == 1){
									if ($("#syslog_div1").data('value') == "-1" || $("#syslog_div1").data('value') == undefined){
										//$("#syslog_div1").data('value',data.SyslogConfigId);
										//$("#syslog_div1").find('span').text(syslog.SyslogConfigName);
										$(".xSelect-syslog_div1").find('span[data-value='+data.SyslogConfigId+']').click();
									}else{
										//$('#syslog_div1').find('span').text(syslog_text1);
										$(".xSelect-syslog_div1").find('span[data-value='+syslog_id1+']').click();
									}
									if (syslog_id2 != undefined && syslog_id2 != '-1'){
										//$("#syslog_div2").data('value',syslog_id2);
										//$("#syslog_div2").find('span').text(syslog_text2);
										$(".xSelect-syslog_div2").find('span[data-value='+syslog_id2+']').click();
									}
								}else{
									if ($("#syslog_div2").data('value') == "-1" || $("#syslog_div2").data('value') == undefined){
										//$("#syslog_div2").data('value',data.SyslogConfigId);
										//$("#syslog_div2").find('span').text(syslog.SyslogConfigName);
										$(".xSelect-syslog_div2").find('span[data-value='+data.SyslogConfigId+']').click();
									}else{
										//$('#syslog_div2').find('span').text(syslog_text2);
										$(".xSelect-syslog_div2").find('span[data-value='+syslog_id2+']').click();
									}
									if (syslog_id1 != undefined && syslog_id1 != '-1'){
										//$("#syslog_div1").data('value',syslog_id1);
										//$("#syslog_div1").find('span').text(syslog_text1);
										$(".xSelect-syslog_div1").find('span[data-value='+syslog_id1+']').click();
									}
								}
								*/
								d.close().remove();	
							},
							btn2:function(i){
								parent.layer.close(i);
							}
						});	
					}else{
						_alert(1,"SYSLOG","执行失败：" + data.ErrMsg);
					}
				}
			});
		}
		
		
		function eventinfomain(type) {
			if (manage_auth_array.indexOf(15) === -1 && manage_auth_array.indexOf(16) === -1 && manage_auth_array.indexOf(17) === -1 && manage_auth_array.indexOf(32) === -1){
				$("#eventinfo_suspend").find('.btn-submit').remove();
			}
			$("#AlarmReceiver").on("ifChecked", function (e) {
				$("#AlarmReceiver_text").show();
				$("#AlarmReceiver_input").find('input').focus();
			});
			$("#AlarmReceiver").on("ifUnchecked", function (e) {
				$("#AlarmReceiver_text").hide();
				$("#AlarmReceiver_input").find('input').blur();
			});
			$("#AlarmReceiver1").on("ifChecked", function (e) {
				$("#AlarmReceiver_text1").show();
				$("#AlarmReceiver_input1").find('input').focus();
			});
			$("#AlarmReceiver1").on("ifUnchecked", function (e) {
				$("#AlarmReceiver_text1").hide();
				$("#AlarmReceiver_input1").find('input').blur();
			});
			$("#AlarmAction").change(function () {
				var AlarmAction_i = $(this).children("option:selected").val();
				if (AlarmAction_i == 1) {
					$("#label_list").show();
					if ($("#label_list").children('div.item').length == 1){
						$("#admin_check").show();
					}
					$('#AlarmReceiver_div').show();
					$("#label_list1").hide();
					$('#AlarmReceiver_div1').hide();
					$('#AlarmReceiver_span').show();
					phone_or_emailcheck = emailcheck;
					phone_or_email = '邮件地址';
				} else if (AlarmAction_i == 2 || AlarmAction_i == 3) {
					$("#label_list1").show();
					if ($("#label_list1").children('div.item').length == 1){
						$("#admin_check1").show();
					}
					$('#AlarmReceiver_div1').show();
					$("#label_list").hide();
					$('#AlarmReceiver_div').hide();
					$('#AlarmReceiver_span').show();
					phone_or_emailcheck = phonecheck;
					phone_or_email = '手机号码';
				} else {
					$("#label_list1").hide();
					$('#AlarmReceiver_div1').hide();
					$("#label_list").hide();
					$('#AlarmReceiver_div').hide();
					$('#AlarmReceiver_span').hide();
				}
				if (AlarmAction_i == 0) {
					$("#Description_imp").hide();
					$("#mail1_div").hide();
					$("#mail2_div").hide();
					$("#smsm1_div").hide();
					$("#smsm2_div").hide();
					$("#smssvr1_div").hide();
					$("#smssvr2_div").hide();
					$("#snmp1_div").hide();
					$("#snmp2_div").hide();
					$("#syslog1_div").hide();
					$("#syslog2_div").hide();
				} else {
					$("#Description_imp").show();
				}
				if (AlarmAction_i == 1) {
					$("#mail1_div").show();
					$("#mail2_div").show();
					$("#smsm1_div").hide();
					$("#smsm2_div").hide();
					$("#smssvr1_div").hide();
					$("#smssvr2_div").hide();
					$("#snmp1_div").hide();
					$("#snmp2_div").hide();
					$("#syslog1_div").hide();
					$("#syslog2_div").hide();
				}else if (AlarmAction_i == 2){
					$("#mail1_div").hide();
					$("#mail2_div").hide();
					$("#smsm1_div").show();
					$("#smsm2_div").show();
					$("#smssvr1_div").hide();
					$("#smssvr2_div").hide();
					$("#snmp1_div").hide();
					$("#snmp2_div").hide();
					$("#syslog1_div").hide();
					$("#syslog2_div").hide();
				}else if (AlarmAction_i == 3){
					$("#mail1_div").hide();
					$("#mail2_div").hide();
					$("#smsm1_div").hide();
					$("#smsm2_div").hide();
					$("#smssvr1_div").show();
					$("#smssvr2_div").show();
					$("#snmp1_div").hide();
					$("#snmp2_div").hide();
					$("#syslog1_div").hide();
					$("#syslog2_div").hide();
				}else if (AlarmAction_i == 4){
					$("#mail1_div").hide();
					$("#mail2_div").hide();
					$("#smsm1_div").hide();
					$("#smsm2_div").hide();
					$("#smssvr1_div").hide();
					$("#smssvr2_div").hide();
					$("#snmp1_div").show();
					$("#snmp2_div").show();
					$("#syslog1_div").hide();
					$("#syslog2_div").hide();
				}else if (AlarmAction_i == 5){
					$("#mail1_div").hide();
					$("#mail2_div").hide();
					$("#smsm1_div").hide();
					$("#smsm2_div").hide();
					$("#smssvr1_div").hide();
					$("#smssvr2_div").hide();
					$("#snmp1_div").hide();
					$("#snmp2_div").hide();
					$("#syslog1_div").show();
					$("#syslog2_div").show();
				}
			});
			$('#admin_select').on('change', function () {
				if ($('#admin_select').find('option').length == 2 && $('#admin_select option:selected').val() != '0') {
					_addadmin($('#admin_select').siblings('i'));
					$('#admin_check').hide();
				} else if ($('#admin_select').find('option').length == 1) {
					$('#admin_check').hide();
				} else {
					$('#admin_check').show();
				}
			});
			$('#admin_select1').on('change', function () {
				if ($('#admin_select1').find('option').length == 2 && $('#admin_select1 option:selected').val() != '0') {
					_addadmin($('#admin_select1').siblings('i'));
					$('#admin_check1').hide();
				} else if ($('#admin_select1').find('option').length == 1) {
					$('#admin_check1').hide();
				} else {
					$('#admin_check1').show();
				}
			});
			//用户列表
			$.ajax({
				url: "/bhost/get_user_list",
				type: "POST",
				async: false,
				data: { a0: se},
				success: function (result) {
					var userinfo_result = JSON.parse(result);
					if (userinfo_result.Result == true) {
						var userinfo_data = userinfo_result.info;
						$("#admin_select").append("<option value=\"0\">请选择</option>");
						$("#admin_select1").append("<option value=\"0\">请选择</option>");
						$.each(userinfo_data, function (i, item) {
							if(item.Email!="" && item.Email!=null){
								$("#admin_select").append("<option value=\"" + item.UserId + "\" index=\"0\">" + item.UserCode + "</option>");
								all_option_str_1[item.UserId] = "<option value=\"" + item.UserId + "\" index=\"0\">" + item.UserCode + "</option>";
							}
							if(item.MobilePhone!="" && item.MobilePhone!=null){
								$("#admin_select1").append("<option value=\"" + item.UserId + "\" index=\"0\">" + item.UserCode + "</option>");
								all_option_str_2[item.UserId] = "<option value=\"" + item.UserId + "\" index=\"0\">" + item.UserCode + "</option>";
							}
						});
					}else{
						_alert(1,'事件告警',userinfo_result.ErrMsg);
						return false;
					}
				}
			});
			bind_mail_select();
			
			//bind_smsm_select();
	
			bind_smssvr_select();
			
			bind_snmp_select();
			
			bind_syslog_select();
			$("#admin_select").select2();
			$("#admin_select1").select2();
			//编辑页面
			//var tasktype = document.frm_eventinfo_add.tasktype.value;
			//if (tasktype == "2") {
			if (type == 1) {
				$("#e_n").val(eventinfo_data.Name);
				$("#e_n").attr("disabled", true);
				$("#Description").val(eventinfo_data.EventDescription);
				$("#EventLevel").val(eventinfo_data.EventLevel).trigger("change");;
				$("#EventType").val(eventinfo_data.EventType).trigger("change");;
				$("#AlarmAction").val(eventinfo_data.AlarmAction).trigger("change");
				var $select_div1;
				var $select_div2;
				if (eventinfo_data.AlarmAction == 1){
					$select_div1 = $('.xSelect-mail_div1');
					$select_div2 = $('.xSelect-mail_div2');
				}else if (eventinfo_data.AlarmAction == 2){
					$select_div1 = $('.xSelect-smsm_div1');
					$select_div2 = $('.xSelect-smsm_div2');
				}else if (eventinfo_data.AlarmAction == 3){
					$select_div1 = $('.xSelect-smssvr_div1');
					$select_div2 = $('.xSelect-smssvr_div2');
				}else if (eventinfo_data.AlarmAction == 4){
					$select_div1 = $('.xSelect-snmp_div1');
					$select_div2 = $('.xSelect-snmp_div2');
				}else if (eventinfo_data.AlarmAction == 5){
					$select_div1 = $('.xSelect-syslog_div1');
					$select_div2 = $('.xSelect-syslog_div2');
				}
				if (eventinfo_data.MasterConfig != null){
					$select_div1.find('span[data-value='+eventinfo_data.MasterConfig+']').click();
				}
				if (eventinfo_data.StandByConfig != null){
					$select_div2.find('span[data-value='+eventinfo_data.StandByConfig+']').click();
				}
				if (eventinfo_data.AlarmAction == 1) {
					var it = '';
				} else if (eventinfo_data.AlarmAction == 2 || eventinfo_data.AlarmAction == 3) {
					var it = '1';
				}
				if (eventinfo_data.AlarmReceiver != null) {
					$("#AlarmReceiver_check" + it).iCheck('check');
					var AlarmReceiver = eventinfo_data.AlarmReceiver.split(';');
					for(var i=0;i<AlarmReceiver.length-1;i++){
						var $c = $('<div id="" name="" class="item" style="padding-top: 0px;width: 260px;" value>');
						$c.html('<input type="text" class="form-text" style="width: 193px;" value="' + AlarmReceiver[i]+ '">'
						+'<i class="ctrl del" onclick="_delphone_or_email(this)"  style="margin-top: 0px;margin-left: 4px;"></i>');
						$('#AlarmReceiver_input'+it).after($c);
					}
					$('#AlarmReceiver_input'+it).find('input').val(AlarmReceiver[i]);
				}
				if (eventinfo_data.UserSet != null) {
					for(var i=0;i<eventinfo_data.UserSet.length-1;i++){
						var item=eventinfo_data.UserSet[i];
						if (eventinfo_data.AlarmAction == 1) {
							if (all_option_str_1[item.UserId] == undefined){
								continue;
							}
							check_option_str_1[item.UserId] = all_option_str_1[item.UserId];
							all_option_str_1[item.UserId] = null;
						} else if (eventinfo_data.AlarmAction == 2 || eventinfo_data.AlarmAction == 3) {
							if (all_option_str_2[item.UserId] == undefined){
								continue;
							}
							check_option_str_2[item.UserId] = all_option_str_2[item.UserId];
							all_option_str_2[item.UserId] = null;
						}
						var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + item.UserId + '"/>');
						$c.html('<input class="form-text" type="text" style="width: 128px;" value="' + item.UserCode + '" disabled="true"><i style="margin-left: 4px;" class="ctrl del" onclick="_deladmin(this)"></i>');
						$("#admin_select" + it).parent().after($c);
						$("#admin_select" + it).find('option[value=' + item.UserId + ']').remove();
						$("#admin_select" + it).trigger('change');
					}
					if (it == '1' && all_option_str_2[eventinfo_data.UserSet[i].UserId] != undefined){
						$("#admin_select" + it).val(eventinfo_data.UserSet[i].UserId).trigger('change');
					}
					if (it != '1' && all_option_str_1[eventinfo_data.UserSet[i].UserId] != undefined){
						$("#admin_select" + it).val(eventinfo_data.UserSet[i].UserId).trigger('change');
					}
				}
			}
		}
		//创建
		function eventinfo_add(d) {
			var val = $("#e_n").val();
			var $i = $("#e_n").next('i.v-check');
			var pass = 1;
			//事件警告信息名
			if (val == "") {
				_alert(2, "事件警告信息", '请输入名称', $("#d_n"));
				return false;
			}
			if (!nameReg.test(val)) {
				_alert(1, "事件警告信息", '名称格式不正确', $("#d_n"));
				return false;
			}
			//事件描述
			var AlarmAction_i = $("#AlarmAction").children("option:selected").val();
			var Description = $("#Description").val().trim();
			if (Description == "" && AlarmAction_i != "0") {
				_alert(1, "事件警告信息", '请输入事件描述', $("#Description"));
				return false;
			}
			if (AlarmAction_i == "1") {
				var it = '';
			} else {
				var it = '1';
			}
			if (AlarmAction_i != "0"){
				//主备
				if (AlarmAction_i == "1"){
					var $select_div1 = $("#mail_div1");
					var $select_div2 = $("#mail_div2");
				}else if (AlarmAction_i == "2"){
					var $select_div1 = $("#smsm_div1");
					var $select_div2 = $("#smsm_div2");
				}else if (AlarmAction_i == "3"){
					var $select_div1 = $("#smssvr_div1");
					var $select_div2 = $("#smssvr_div2");
				}else if (AlarmAction_i == "4"){
					var $select_div1 = $("#snmp_div1");
					var $select_div2 = $("#snmp_div2");
				}else if (AlarmAction_i == "5"){
					var $select_div1 = $("#syslog_div1");
					var $select_div2 = $("#syslog_div2");
				}
				var sel_div1 = $select_div1.data('value');
				var sel_div2 = $select_div2.data('value');
				if (sel_div1 != "-1" && sel_div1 != undefined){
					eventinfo.MasterConfig = sel_div1;
					eventinfo.MasterConfigName = $select_div1.find('span').text();
				}else{
					eventinfo.MasterConfig = 0;
					eventinfo.MasterConfigName = "全局策略";
				}
				if (sel_div2 != "-1" && sel_div2 != undefined){
					eventinfo.StandByConfig = sel_div2;
					eventinfo.StandByConfigName = $select_div2.find('span').text();
				}else{
					eventinfo.StandByConfig = 0;
					eventinfo.StandByConfigName = "全局策略";
				}
			}
			//信息接受者
			if (AlarmAction_i == "1" || AlarmAction_i == "2" || AlarmAction_i == "3") {
				if ($('#label_list' + it).find('div[value]').length == 0 && !$('#AlarmReceiver_check' + it).is(':checked') && $('#admin_select' + it).val() == '0') {
					_alert(2, "事件警告信息", "请选择信息接受者");
					return false;
				}
				//手动输入
				if ($("#AlarmReceiver_check" + it).is(':checked')) {
					if ($('#AlarmReceiver_text' + it).find('div[value]').length == 0 && $('#AlarmReceiver_input' + it).find('input').val().trim() == '') {
						_alert(2, "事件警告信息", "请手动输入信息", $("#AlarmReceiver_input" + it));
						return false;
					}
					var $all = $('#AlarmReceiver_text' + it).find('div[value]');
					var len = $all.length;
					var AlarmReceiver_text = "";

					var a_len = $("#AlarmReceiver_text" + it).children('div').length;
					$("#AlarmReceiver_text" + it).children("div").each(function (i, item) {
						var input_v = $(item).find('input').val();
						if (i == 0 && a_len != 1 && input_v == "") {
							return true;
						}

						if (input_v == '') {
							pass = 0;
							_alert(1, '事件告警信息', '请输入' + phone_or_email, $(item).find('input'));
							return false;
						} else if (!phone_or_emailcheck.test(input_v)) {
							pass = 0;
							_alert(1, '事件告警信息', phone_or_email + '格式不正确', $(item).find('input'));
							return false;
						} else {
							var AlarmAction = $('#AlarmAction').val();
							if (AlarmAction == '1') {
								var it = '';
							} else {
								var it = '1';
							}
							$("#AlarmReceiver_text" + it).children("div").not($(item)).each(function (i1, item1) {
								if (i1 < i) {
									return true;
								}
								var input_v1 = $(item1).find('input').val();
								if (input_v1 == '') {
									pass = 0;
									_alert(1, '事件告警信息', '请输入' + phone_or_email, $(item1).find('input'));
									return false;
								} else if (!phone_or_emailcheck.test(input_v1)) {
									pass = 0;
									_alert(1, '事件告警信息', phone_or_email + '格式不正确', $(item1).find('input'));
									return false;
								}
								if (input_v1 == input_v) {
									pass = 0;
									_alert(1, '事件告警信息', '相同的' + phone_or_email + '已存在', $(item).find('input'));
									return false;
								}
							});
							if (pass == 0) {
								return false;
							}
						}
					});
					if (pass == 0) {
						return false;
					}


					for (var j = len - 1; j >= 0; j--) {
						var input_txt = $all.eq(j).find('input').val();
						AlarmReceiver_text = AlarmReceiver_text + input_txt + ';';
					}
					var AlarmReceiver_input = $('#AlarmReceiver_input' + it).find('input').val().trim();
					if (AlarmAction_i == "1" && AlarmReceiver_input != "") {
						if (emailcheck.test(AlarmReceiver_input)) {
							AlarmReceiver_text = AlarmReceiver_text + AlarmReceiver_input + ';';
						} else {
							_alert(1, "事件警告信息", "邮箱格式不正确", $("#AlarmReceiver_input" + it).find('input'));
							return false;
						}
					} else if ((AlarmAction_i == "2" || AlarmAction_i == "3") && AlarmReceiver_input != "") {
						if (phonecheck.test(AlarmReceiver_input)) {
							AlarmReceiver_text = AlarmReceiver_text + AlarmReceiver_input + ';';
						} else {
							_alert(1, "事件警告信息", "手机号码格式不正确", $("#AlarmReceiver_input" + it).find('input'));
							return false;
						}
					}
					AlarmReceiver_text = AlarmReceiver_text.substr(0, AlarmReceiver_text.length - 1);
					var AlarmReceiver = AlarmReceiver_text;

				}
			} else {
				var AlarmReceiver = null;
			}
			eventinfo.EventAlarmInfoId = eventinfoId;
			eventinfo.Name = val;
			eventinfo.EventLevel = parseInt($("#EventLevel").children("option:selected").val());
			eventinfo.EventType = parseInt($("#EventType").children("option:selected").val());
			if (Description == "") {
				Description = null;
			}
			eventinfo.EventDescription = Description;
			eventinfo.AlarmAction = parseInt(AlarmAction_i);
			eventinfo.AlarmReceiver = AlarmReceiver;
			eventinfo.UserSet = new Array();
			if (AlarmAction_i == "1") {
				var it = '';
			} else if (AlarmAction_i == "2" || AlarmAction_i == "3") {
				var it = '1';
			}
			var $all = $("#label_list" + it).find('div[value]');
			var len = $all.length;
			if (AlarmAction_i == "1" || AlarmAction_i == "2" || AlarmAction_i == "3") {
				for (var j = len - 1; j >= 0; j--) {
					var t_i = $all.eq(j).attr('value');
					if (t_i != '0') {
						var json_a = '{"UserId":' + t_i + '}';
						eventinfo.UserSet.push(JSON.parse(json_a));
					}
				}
			}
			var val = $('#admin_select' + it).val();
			if (val != '0') {
				var json_a = '{"UserId":' + val + '}';
				eventinfo.UserSet.push(JSON.parse(json_a));
			}
			var msstr = aceg(JSON.stringify(eventinfo),se);
			$.ajax({
				url: '/bhost/add_eventinfo',
				type: "POST",
				async: false,
				data: { a0: se, a1: JSON.stringify(eventinfo), a10:"运维管理>指令授权",m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result == true) {
						$('.btn').blur(); parent.layer.open({
							type: 1,
							title: '事件警告信息',
							content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
							btn: ['确&nbsp;&nbsp;定'],
							btnAlign: 'c',
							closeBtn: false,
							skin: 'layer-custom',
							area: ['380px', '310px'],
							move: false,
							resize: false,
							yes: function (i) {
								$('.btn').blur(); parent.layer.close(i);
								var alarm_text = $('#EventAlarmInfoId').find('span').text();
								$("div[data-id=xSelect-alarm]").remove();
								$('#EventAlarmInfoId').empty().data('xSelect','');
								bind_alarm_xSelect();
								if ($("#EventAlarmInfoId").data('value') == "-1" || $("#EventAlarmInfoId").data('value') == undefined){
									$("#EventAlarmInfoId").data('value',result.EventAlarmInfoId);
									$("#EventAlarmInfoId").find('span').text(eventinfo.Name);
								}else{
									$('#EventAlarmInfoId').find('span').text(alarm_text);
								}
								d.close().remove();
							}
						});
					} else {
						_alert(1, "事件警告信息", "执行失败：" + result.ErrMsg, $("#e_n"));
						return false;
					}
				}
			});
		}

		function clear_approve() {
			check_value = 'false false';
			all_option_str = [];
			check_option_str = [];
			$("#ApproveStrategyName").val("").attr("disabled", false);
			$("#ApproveNum").val("");
			$("#label_list_a").children('div:not(:first)').remove();
			$("#admin_select_a").empty();
			$("#admin_check_a").show();
			//$("#admin_select_a").children('option').not('option:first').remove();
			$("#ApproveStrategyName").next('.v-check').attr('class', 'v-check');
			$("#admin_num").text(0);
			$("#checkbox").find('input[type=checkbox]').iCheck('destroy');
			$("#checkbox").find('input[type=checkbox]').iCheck({
				checkboxClass: 'icheckbox_minimal-blue',
				radioClass: 'iradio_minimal-blue',
				increaseArea: '0' // optional
			});
			$("#checkbox").unbind();
			$("#checkbox").find('input[type=checkbox]').unbind();
			$("#checkbox").find('input[type=checkbox]').iCheck('uncheck');
			$('.xSelect_phone_m').data('value',0);
			$('.xSelect_phone_s').data('value',0);
			update_xSelect($('.xSelect_phone_m'));
			update_xSelect($('.xSelect_phone_s'));
			$('.xSelect_smtp_m').data('value',0);
			$('.xSelect_smtp_s').data('value',0);
			update_xSelect($('.xSelect_smtp_m'));
			update_xSelect($('.xSelect_smtp_s'));
			$("#ApproveNum").attr('edited',0);
		}

		//审批
		var approve_data;
		function _editNode4(obj, type) {
			clear_approve();
			var title;
			if (type == 1) {
				//approveId = $(obj).parent().children('a').attr('id');
				approveId = $(obj).children('span').data('value');
				$.ajax({
					url: "/bhost/get_approve_list",
					type: "POST",
					async: false,
					data: { a0: se, a1: approveId },
					success: function (result) {
						var approve_result = JSON.parse(result);
						if (approve_result.Result == true) {
							approve_data = approve_result.info.data[0];
							title = "审批策略";

						}
					}
				});
			} else {
				//approve_edit = null;
				approveId = 0;
				title = "审批策略";
			}
			var $dialogCont = $("#EnableApprove_suspend").show();

			var d = dialog({
				title: title,
				content: $dialogCont,
				id: "EnableApprove_suspend",
				width: "800px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			approvemain(type);
			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				clear_approve();
				approvemain(type);
				//d.close().remove();
			});

			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				save_data(d);
			})

		}


		var all_option_str = [];
		var check_option_str = [];
		var approve_item = {
			"ApproveStrategyId": 0,
			"ApproveStrategyName": "",
			"ApproveNum": 0,
			"ApproveType": 0,
			"UserSet": []
		}

		//删除接收人
		function _deladmin_a(obj) {
			var $c = $(obj).parent();
			var m_i = $(obj).parent().attr('value');
			all_option_str[parseInt(m_i)] = check_option_str[parseInt(m_i)];
			check_option_str[parseInt(m_i)] = null;
			for (var i = (parseInt(m_i) + 1); i < all_option_str.length; i++) {
				if (all_option_str[i] != null) {
					if ($('#admin_select_a option[value=' + i + ']').length != 0) {
						$('#admin_select_a option[value=' + i + ']').before(all_option_str[m_i]);
						break;
					}
				}
			}
			if (i == all_option_str.length) {
				$('#admin_select_a').append(all_option_str[m_i]);
			}
			$c.fadeOut(function () {
				$c.remove();
				edit_admin_num();
				$('#admin_select_a').trigger('change');
			});
			$('#admin_select_a').select2();
		}
		
		function update_xSelect($obj){
			var id_value=$obj.data('value');
			var text_value=$('.xSelect-show-text',$obj).text();
			var id=$('.xSelect-show',$obj).data('id');
			$obj.empty().data('xSelect','');
			$('.'+id).remove();
			if(id_value==undefined || id_value == 0){
				id_value=0;
				text_value='全局指定'
			}
			switch ($obj.attr('class').split(' ')[1]) {
				case 'xSelect_phone_m':
					$.ajax({
						url: "/bhost/get_smssvrconfig",
						type: "POST",
						async: false,
						data: {a0:se},
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								ftpconfig_data_all=result.info.data;
								var data = result.info;
								ftpserver = new Array();
								ftpserver[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
								$.each(data.data, function (i, item) {
									if(item.SmsSvrConfigId==0){
										return true;
									}else if(id_value==item.SmsSvrConfigId){
										text_value=item.SmsSvrConfigName;
									}
									ftpserver[item.SmsSvrConfigId] =(JSON.parse('{"value":'+item.SmsSvrConfigId+',"name":"'+item.SmsSvrConfigName+'","type":"'+(manage_auth_array.indexOf(24) != -1?'edit':'check')+'"}'));
								})
							} else {
								_alert(1, '短信网关查询', result.ErrMsg);
								return false;
							}
						}
					});
					var ftpserver1=ftpserver;
					var ftp2_id=$('.xSelect_phone_s').data('value');
					if(ftp2_id!=undefined && ftp2_id!='' && ftp2_id>0){
						delete ftpserver1[ftp2_id];
					}
					xSelect_json={
						num:'1',
						width: 168,
						defaultText: '全局指定',
						items:ftpserver1,
						edit: function(item,obj){
							$('.'+$('.xSelect_phone_m .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 3);
						},
						check: function(item,obj){
							$('.'+$('.xSelect_phone_m .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 3);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
							update_xSelect($('.xSelect_phone_s'));
						}
					};
					if(manage_auth_array.indexOf(24) != -1){
						xSelect_json.num='2';
						xSelect_json.btn.push({
							'name':'新增',
							'event': function(items,obj){
								get_dialog(items, 2, 3);
							}
						});
					}
					$obj.xSelect(xSelect_json);
					break;
				case 'xSelect_phone_s':
					$.ajax({
						url: "/bhost/get_smssvrconfig",
						type: "POST",
						async: false,
						data: {a0:se},
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								ftpconfig_data_all=result.info.data;
								var data = result.info;
								ftpserver = new Array();
								ftpserver[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
								$.each(data.data, function (i, item) {
									if(item.SmsSvrConfigId==0){
										return true;
									}else if(id_value==item.SmsSvrConfigId){
										text_value=item.SmsSvrConfigName;
									}
									ftpserver[item.SmsSvrConfigId] =(JSON.parse('{"value":'+item.SmsSvrConfigId+',"name":"'+item.SmsSvrConfigName+'","type":"'+(manage_auth_array.indexOf(24) != -1?'edit':'check')+'"}'));
								})
							} else {
								_alert(1, '短信网关查询', result.ErrMsg);
								return false;
							}
						}
					});
					var ftpserver2=ftpserver;
					var ftp1_id=$('.xSelect_phone_m').data('value');
					if(ftp1_id!=undefined && ftp1_id!='' && ftp1_id>0){
						delete ftpserver2[ftp1_id];
					}
					xSelect_json={
						num:'1',
						width: 168,
						defaultText: '全局指定',
						items:ftpserver2,
						edit: function(item,obj){
							$('.'+$('.xSelect_phone_s .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 3);
						},
						check: function(item,obj){
							$('.'+$('.xSelect_phone_s .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 3);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
							update_xSelect($('.xSelect_phone_m'));
						}
					};
					if(manage_auth_array.indexOf(24) != -1){
						xSelect_json.num='2';
						xSelect_json.btn.push({
								'name':'新增',
								'event': function(item,obj){
									get_dialog(item, 2, 3);
								}
							});
					}
					$obj.xSelect(xSelect_json);
					break;
				case 'xSelect_smtp_m':
					$.ajax({
						url: "/bhost/get_smtpconfig",
						type: "POST",
						async: false,
						data: { a0: se },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								var data = result.info;
								smtpconfig_data_all=result.info.data;
								smtpconfig=new Array();
								smtpconfig[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
								$.each(data.data, function (i, item) {
									if(item.SmtpConfigId==0){
										return true;
									}else if(id_value==item.SmtpConfigId){
										text_value=item.SmtpConfigName;
									}
									smtpconfig[item.SmtpConfigId]=(JSON.parse('{"value":'+item.SmtpConfigId+',"name":"'+item.SmtpConfigName+'","type":"'+(manage_auth_array.indexOf(24) != -1?'edit':'check')+'"}'));
								})
							} else {
								_alert(1, '邮件服务器查询', result.ErrMsg);
								return false;
							}
						}
					});
					var smtpconfig1=smtpconfig;
					var stmp2_id=$('.xSelect_smtp_s').data('value');
					if (stmp2_id!=undefined && stmp2_id!='' && stmp2_id>0) {
						delete smtpconfig1[stmp2_id];
					}
					xSelect_json={
						num:'1',
						width: 168,
						defaultText: '全局指定',
						items:smtpconfig1,
						edit: function(item,obj){
							$('.'+$('.xSelect_smtp_m .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 1);
						},
						check: function(item,obj){
							$('.'+$('.xSelect_smtp_m .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 1);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
							update_xSelect($('.xSelect_smtp_s'));
						}
					};
					if(manage_auth_array.indexOf(24) != -1){
						xSelect_json.num='2';
						xSelect_json.btn.push({
							'name':'新增',
							'event': function(items,obj){
								get_dialog(items, 2, 1);
							}
						});
					}
					$obj.xSelect(xSelect_json);
					break;
				case 'xSelect_smtp_s':
					$.ajax({
						url: "/bhost/get_smtpconfig",
						type: "POST",
						async: false,
						data: { a0:se },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								var data = result.info;
								smtpconfig_data_all=result.info.data;
								smtpconfig=new Array();
								smtpconfig[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
								$.each(data.data, function (i, item) {
									if(item.SmtpConfigId==0){
										return true;
									}else if(id_value==item.SmtpConfigId){
										text_value=item.SmtpConfigName;
									}
									smtpconfig[item.SmtpConfigId]=(JSON.parse('{"value":'+item.SmtpConfigId+',"name":"'+item.SmtpConfigName+'","type":"'+(manage_auth_array.indexOf(24) != -1?'edit':'check')+'"}'));
								})
							} else {
								_alert(1, '邮件服务器查询', result.ErrMsg);
								return false;
							}
						}
					});
					var smtpconfig2=smtpconfig;
					var smtp1_id=$('.xSelect_smtp_m').data('value');
					if(smtp1_id!=undefined && smtp1_id!='' && smtp1_id>0){
						delete smtpconfig2[smtp1_id];
						// smtpconfig2.splice(smtp1_id,1);
					}
					// for(i in smtpconfig2){
					// 	if(smtpconfig2[i]==null){
					// 	}
					// }
					xSelect_json={
						num:'1',
						width: 168,
						defaultText: '全局指定',
						items:smtpconfig2,
						edit: function(item,obj){
							$('.'+$('.xSelect_smtp_s .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 1);
						},
						check: function(item,obj){
							$('.'+$('.xSelect_smtp_s .xSelect-show').data('id')).hide();
							get_dialog(item, 1, 1);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
							update_xSelect($('.xSelect_smtp_m'));
						}
					};
					if(manage_auth_array.indexOf(24) != -1){
						xSelect_json.num='2';
						xSelect_json.btn.push({
								'name':'新增',
								'event': function(items,obj){
									get_dialog(items, 2, 1);
								}
							});
					}
					$obj.xSelect(xSelect_json);
					break;
			}
			$obj.data('value',id_value);
			$('.xSelect-show-text',$obj).text(text_value);
		}
		var smtpconfig_save = {
			"SmtpConfigId": 0,
			"SmtpConfigName": null,
			"SmtpServer": null,
			"DNS": null,
			"Sender": null,
			"SenderEmail": null,
			"AttachMaxLimit": 20,
			"ServerVerify": true,
			"SenderEmailPass": null,
			"Flag": 0,
			"EnCode": 0
		};
		var smssvrconfig_save = {
			"SmsSvrConfigId": 1,
			"SmsSvrConfigName": "短信网关配置1",
			"SmsSvrDBType": 2,
			"SmsSvrDBServerIP": "192.168.0.1",
			"SmsSvrDBPort": 1433,
			"SmsSvrDBUserName": "root",
			"SmsSvrDBPassword": "d106f6959747b5ac",
			"SmsSvrDBPassword_old": null,
			"SmsSvrDBDatabase": "mysql",
			"SmsSvrDBInsertTemp": null,
			"Flag": 0,         //--2-主，1-备，0-其它
			"EnCode": 0
		};
		
		function smtp_clear() {
			$('#mail_suspend i.v-check').attr('class', 'v-check');
			$('#SmtpConfigName').attr("disabled", false);
			$('#SmtpConfigName').val('');
			$('#SmtpConfigName').next('i.v-check').attr('class', 'v-check');
			$('#SmtpServer').val('');
			$('#Sender').val('');
			$('#SenderEmail').val('');
			$('#AttachMaxLimit').val('');
			$('#ServerVerify_off').iCheck('check');
			$('#SenderEmailPass').val('');
			
			//$('#test').iCheck('uncheck');
			//$('#test').parents('label').next('span.forCheck').hide();
			//$('#test_Master_input').val('');
			//$('#DNS_Master').val('');
			$('#EnCode_mail').val(0).trigger('change');
			var smtpconfig_data_all_Flag = smtpconfig_data_all.map(function (params) {
				return params.Flag;
			});
			if ($.inArray(2, smtpconfig_data_all_Flag) < 0) {
				$('#Flag_mail').val(2).trigger('change');
			} else if ($.inArray(1, smtpconfig_data_all_Flag) < 0) {
				$('#Flag_mail').val(1).trigger('change');
			} else {
				$('#Flag_mail').val(0).trigger('change');
			}
		}
		function smssvr_clear() {
			$('#smssvr_suspend i.v-check').attr('class', 'v-check');
			$('#SmsSvrConfigName').val('');
			$('#SmsSvrConfigName').attr("disabled", false);
			$('#SmsSvrDBType').val(1).trigger('change');
			$('#SmsSvrDBServerIP').val('');
			$('#SmsSvrDBPort').val('');
			$('#SmsSvrDBUserName').val('');
			$('#SmsSvrDBPassword').val('');
			$('#SmsSvrDBDatabase').val('');
			$('#SmsSvrDBInsertTemp').val('');
			$('#EnCode_smssvr').val(0).trigger('change');
			var smtpconfig_data_all_Flag = ftpconfig_data_all.map(function (params) {
				return params.Flag;
			});
			if ($.inArray(2, smtpconfig_data_all_Flag) < 0) {
				$('#Flag_smssvr').val(2).trigger('change');
			} else if ($.inArray(1, smtpconfig_data_all_Flag) < 0) {
				$('#Flag_smssvr').val(1).trigger('change');
			} else {
				$('#Flag_smssvr').val(0).trigger('change');
			}
		}
		function smtp_input(data) {
			smtpconfig_save.SmtpConfigId = data.SmtpConfigId;
			$('#SmtpConfigName').val(data.SmtpConfigName);
			$('#SmtpConfigName').attr("disabled", true);
			$('#SmtpServer').val(data.SmtpServer);
			$('#Sender').val(data.Sender);
			$('#SenderEmail').val(data.SenderEmail);
			$('#AttachMaxLimit').val(data.AttachMaxLimit);
			if (data.ServerVerify) {
				$('#ServerVerify_on').iCheck('check');
				$('#SenderEmailPass').val(data.SenderEmailPass);
				smtpconfig_save.SenderEmailPass = data.SenderEmailPass;
			} else {
				$('#ServerVerify_off').iCheck('check');
			}
			//$('#DNS_Master').val(data.DNS);
			//$('#test_Master').iCheck('uncheck');
			//$('#test_Master').parents('label').next('span.forCheck').hide();
			//$('#test_Master_input').val('');
			$('#EnCode_mail').val(data.EnCode).trigger('change');
			$('#Flag_mail').val(data.Flag).trigger('change');
		}
		function smssvr_input(data) {
			smssvrconfig_save.SmsSvrConfigId = data.SmsSvrConfigId;
			$('#SmsSvrConfigName').val(data.SmsSvrConfigName);
			$('#SmsSvrConfigName').attr("disabled", true);
			$('#SmsSvrDBType').val(data.SmsSvrDBType).trigger('change');
			$('#SmsSvrDBServerIP').val(data.SmsSvrDBServerIP);
			$('#SmsSvrDBPort').val(data.SmsSvrDBPort);
			$('#SmsSvrDBUserName').val(data.SmsSvrDBUserName);
			$('#SmsSvrDBPassword').val(data.SmsSvrDBPassword);
			$('#SmsSvrDBDatabase').val(data.SmsSvrDBDatabase);
			$('#SmsSvrDBInsertTemp').val(data.SmsSvrDBInsertTemp);
			$('#EnCode_smssvr').val(data.EnCode).trigger('change');
			$('#Flag_smssvr').val(data.Flag).trigger('change');
			smssvrconfig_save.SmsSvrDBPassword_old = data.SmsSvrDBPassword;
		}
		
		function get_dialog(obj, type, num) {
			var title;
			var ajax_url;
			var dialogCont_id;
			switch (num) {
				case 1:
					smtp_clear();
					title = '邮件';
					ajax_url = 'smtpconfig';
					dialogCont_id = 'mail_suspend';
					smtpconfig_save.SmtpConfigId = 0;
					smtpconfig_save.SenderEmailPass = null;
					break;
				case 3:
					smssvr_clear();
					title = '短信网关配置';
					ajax_url = 'smssvrconfig';
					dialogCont_id = 'smssvr_suspend';
					smssvrconfig_save.SmsSvrConfigId = 0;
					smssvrconfig_save.SmsSvrDBPassword_old = null;
					break;
			}
			$("#ServerVerify_on").on("ifChanged",function(){
				if ($(this).prop("checked")){
					$("#SenderEmailPass").parent().show();
				}else{
					$("#SenderEmailPass").parent().hide();
				}
			})
			if (type == 1) {
				var id = obj.value;
				$.ajax({
					url: "/bhost/get_" + ajax_url,
					type: "POST",
					async: false,
					data: { a0: se, a1: id },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							var data = result.info.data[0];
							switch (num) {
								case 1:
									smtp_input(data);
									break;
								// case 2:
								// 	smsm_input(data);
								// 	break;
								case 3:
									smssvr_input(data);
									break;
								// case 4:
								// 	snmp_input(data);
								// 	break;
								// case 5:
								// 	syslog_input(data);
								// 	break;
							}
						} else {
							_alert(1, title, result.ErrMsg);
							return false;
						}
					}
				});

			} else {
				// title_d = "创建" + title;
			}
			var $dialogCont = $("#" + dialogCont_id).show();

			var d = dialog({
				title: title,
				content: $dialogCont,
				id: dialogCont_id,
				width: "800px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				switch (num) {
					case 1:
						smtp_clear();
						break;
					// case 2:
					// 	smsm_clear();
					// 	break;
					case 3:
						smssvr_clear();
						break;
					// case 4:
					// 	snmp_clear();
					// 	break;
					// case 5:
					// 	syslog_clear();
					// 	break;
				}
				if (type == 1) {
					var id = obj.value;
					$.ajax({
						url: "/bhost/get_" + ajax_url,
						type: "POST",
						async: false,
						data: { a0: se, a1: id },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								var data = result.info.data[0];
								switch (num) {
									case 1:
										smtp_input(data);
										break;
									// case 2:
									// 	smsm_input(data);
									// 	break;
									case 3:
										smssvr_input(data);
										break;
									// case 4:
									// 	snmp_input(data);
									// 	break;
									// case 5:

									// 	syslog_input(data);
									// 	break;
								}
							} else {
								_alert(1, title, result.ErrMsg);
								return false;
							}
						}
					});
				} else {
				}
			});

			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				var pass = false;
				switch (num) {
					case 1:
						if (save_smtp_date()) {
							pass = save_smtpconfig();
						}
						break;
					// case 2:
					// 	if (save_smsm_date()) {
					// 		pass = save_smsmconfig();
					// 	}
					// 	break;
					case 3:
						if (save_smssvr_date()) {
							pass = save_smssvrconfig();
						}

						break;
					// case 4:

					// 	if (save_snmp_date()) {
					// 		pass = save_snmpconfig();
					// 	}
					// 	break;
					// case 5:
					// 	if (save_syslog_date()) {
					// 		pass = save_syslogconfig();
					// 	}
					// 	break;
				}
				if (pass) {
					$('.btn').blur(); parent.layer.open({
						type: 1,
						title: title,
						content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						yes: function (i) {
							parent.layer.close(i);
							d.close().remove();
						}
					});
				}
			})
		}

		function save_smtp_date() {
			var SmtpConfigName_Master = $("#SmtpConfigName").val();
			if (SmtpConfigName_Master == '') {
				_alert(2, '邮件', '请输入名称', $('#SmtpConfigName'));
				return false;
			} else if (!nameReg.test(SmtpConfigName_Master)) {
				_alert(1, '邮件', '名称格式不正确', $('#SmtpConfigName'));
				return false;
			}
			var SmtpServer = $('#SmtpServer').val();
			//var DNS = $('#DNS_Master').val();
			if (SmtpServer == "") {
				_alert(2, '邮件', '请输入服务器地址', $('#SmtpServer'));
				return false;
			} else if (!ipReg.test(SmtpServer) || SmtpServer == '0.0.0.0' || SmtpServer == '255.255.255.255') {
				if ((!hostcheck1.test(SmtpServer)) && (!hostcheck2.test(SmtpServer))){
					_alert(1, '邮件', '服务器地址格式不正确', $('#SmtpServer'));
					return false;
				}
			}
			/*
			if (DNS == "") {
				DNS = null;
			}
			*/
			var Sender = $('#Sender').val();
			if (Sender == "") {
				_alert(2, '邮件', '请输入服务器账号', $('#Sender'));
				return false;
			}
			var SenderEmail = $('#SenderEmail').val();
			if (SenderEmail == "") {
				_alert(2, '邮件', '请输入发送邮箱地址', $('#SenderEmail'));
				return false;
			} else if (!emailReg.test(SenderEmail)) {
				_alert(1, '邮件', '发送邮箱地址格式不正确', $('#SenderEmail'));
				return false;
			}
			var AttachMaxLimit = $('#AttachMaxLimit').val();
			if (AttachMaxLimit == "") {
				_alert(2, '邮件', '请输入附件大小', $('#AttachMaxLimit'));
				return false;
			}
			//var ServerVerify = ($('#ServerVerify').find('input[type=radio]:checked').val() == '2');
			if ($("#ServerVerify_on").prop("checked")){
				if ($("#SenderEmailPass").val() == ""){
					_alert(2,"邮件","请输入服务器验证",$("#SenderEmailPass"));
					return false;
				}else{
					if($("#SenderEmailPass").val().length > 64){
						_alert(2, '邮件', "密码不能超过系统限定64位", $("#SenderEmailPass"));
						return false;
					}
					smtpconfig_save.ServerVerify = true;
					smtpconfig_save.SenderEmailPass = $("#SenderEmailPass").val();
				}
			}else{
				smtpconfig_save.ServerVerify = false;
				smtpconfig_save.SenderEmailPass = null;
			}

			smtpconfig_save.SmtpConfigName = SmtpConfigName_Master;
			smtpconfig_save.SmtpServer = SmtpServer;
			smtpconfig_save.DNS = null;
			smtpconfig_save.Sender = Sender;
			smtpconfig_save.SenderEmail = SenderEmail;
			smtpconfig_save.AttachMaxLimit = AttachMaxLimit;
			//smtpconfig_save.ServerVerify = ServerVerify;
			//smtpconfig_save.SenderEmailPass = SenderEmailPass;
			smtpconfig_save.EnCode = parseInt($('#EnCode_mail').val());
			smtpconfig_save.Flag = parseInt($('#Flag_mail').val());
			return true;
		}
		function save_smssvr_date() {
			var numCheck = /\D/;
			var SmsSvrConfigName = $("#SmsSvrConfigName").val();
			var SmsSvrDBType = $("#SmsSvrDBType").val();
			var SmsSvrDBServerIP = $("#SmsSvrDBServerIP").val();
			var SmsSvrDBPort = $("#SmsSvrDBPort").val();
			var SmsSvrDBUserName = $("#SmsSvrDBUserName").val();
			var SmsSvrDBPassword = $("#SmsSvrDBPassword").val();
			var SmsSvrDBDatabase = $("#SmsSvrDBDatabase").val();
			var SmsSvrDBInsertTemp = $("#SmsSvrDBInsertTemp").val();
			if (SmsSvrConfigName == "") {
				_alert(2, "短信网关", "请输入名称", $("#SmsSvrConfigName"));
				return false;
			} else {
				if (!nameCheck.test(SmsSvrConfigName)) {
					_alert(1, "短信网关", "名称格式不正确", $("#SmsSvrConfigName"));
					return false;
				}
			}
			if (SmsSvrDBServerIP == "") {
				_alert(2, "短信网关", "请输入服务器地址", $("#SmsSvrDBServerIP"));
				return false;
			} else {
				if (!ipcheck_route.test(SmsSvrDBServerIP)) {
					_alert(1, "短信网关", "服务器地址格式不正确", $("#SmsSvrDBServerIP"));
					return false;
				}
			}
			if (SmsSvrDBPort == "") {
				_alert(2, "短信网关", "请输入端口", $("#SmsSvrDBPort"));
				return false;
			} else {
				if (numCheck.test(parseInt(SmsSvrDBPort))) {
					_alert(1, "短信网关", "端口格式不正确", $("#SmsSvrDBPort"));
					return false;
				}
				if (parseInt(SmsSvrDBPort) > 65534) {
					_alert(1, "短信网关", "端口不能大于65534", $("#SmsSvrDBPort"));
					return false;
				}
				if (parseInt(SmsSvrDBPort) < 1) {
					_alert(1, "短信网关", "端口不能小于1", $("#SmsSvrDBPort"));
					return false;
				}
			}
			if (SmsSvrDBUserName == "") {
				_alert(2, "短信网关", "请输入账号", $("#SmsSvrDBUserName"));
				return false;
			} else {
				if (!nameCheck.test(SmsSvrDBUserName)) {
					_alert(1, "短信网关", "账号格式不正确", $("#SmsSvrDBUserName"));
					return false;
				}
			}
			if (SmsSvrDBPassword == "") {
				_alert(2, "短信网关", "请输入密码", $("#SmsSvrDBPassword"));
				return false;
			}
			if (SmsSvrDBDatabase == "") {
				_alert(2, "短信网关", "请输入数据库", $("#SmsSvrDBDatabase"));
				return false;
			}
			if (SmsSvrDBInsertTemp == "") {
				_alert(2, "短信网关", "请输入短信sql语句模板", $("#SmsSvrDBInsertTemp"));
				return false;
			} else {
				if (SmsSvrDBInsertTemp.indexOf("%phone%") === -1 || SmsSvrDBInsertTemp.indexOf("%content%") === -1) {
					_alert(1, "短信网关", "模板格式不正确", $("#SmsSvrDBInsertTemp"));
					return false;
				}
			}
			smssvrconfig_save.SmsSvrConfigName = SmsSvrConfigName;
			smssvrconfig_save.SmsSvrDBType = SmsSvrDBType;
			smssvrconfig_save.SmsSvrDBServerIP = SmsSvrDBServerIP;
			smssvrconfig_save.SmsSvrDBPort = parseInt(SmsSvrDBPort);
			smssvrconfig_save.SmsSvrDBUserName = SmsSvrDBUserName;
			smssvrconfig_save.SmsSvrDBPassword = SmsSvrDBPassword;
			smssvrconfig_save.SmsSvrDBDatabase = SmsSvrDBDatabase;
			smssvrconfig_save.SmsSvrDBInsertTemp = SmsSvrDBInsertTemp;
			smssvrconfig_save.Flag = parseInt($("#Flag_smssvr").val());
			smssvrconfig_save.EnCode = parseInt($("#EnCode_smssvr").val());
			return true;
		}
		function save_smtpconfig() {
			var pass = true;
			if (smtpconfig_save == null) {
				return false;
			}
			msstr = aceg(JSON.stringify(smtpconfig_save),se);
			$.ajax({
				url: "/bhost/add_smtpconfig",
				type: "POST",
				async: false,
				data: { a0: se, a1: JSON.stringify(smtpconfig_save),a2:'运维管理>指令授权',m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						//刷新下拉
						var focusObj_value = $focusObj_c.data('value');
						if (focusObj_value == 0) {
							$focusObj_c.data('value',result.SmtpConfigId);
						}
						update_xSelect($('.xSelect_smtp_m'));
						update_xSelect($('.xSelect_smtp_s'));
					} else {
						if (result.ErrMsg == "同名邮件服务器配置已存在") {
							_alert(2, "邮件", result.ErrMsg, $('#SmtpConfigName_Master'));
						} else {
							_alert(2, "邮件", result.ErrMsg);
						}
						pass = false;
					}
				}
			});
			return pass;
		}
		function save_smssvrconfig() {
			var pass = true;
			if (smssvrconfig_save == null) {
				return false;
			}
			var msstr = aceg(JSON.stringify(smssvrconfig_save),se);
			$.ajax({
				url: "/bhost/add_smssvrconfig",
				type: "POST",
				async: false,
				data: { a0: se, a1: JSON.stringify(smssvrconfig_save),a10:'运维管理>指令授权' ,m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						//刷新下拉
						var focusObj_value = $focusObj_c.data('value');
						if (focusObj_value == 0) {
							$focusObj_c.data('value',result.SmsSvrConfigId);
						}
						update_xSelect($('.xSelect_phone_m'));
						update_xSelect($('.xSelect_phone_s'));
					} else {
						if (result.ErrMsg == "同名短信网关服务配置已存在") {
							_alert(2, "短信网关", result.ErrMsg, $('#SmtpConfigName'));
						} else {
							_alert(2, "短信网关", result.ErrMsg);
						}
						pass = false;
					}
				}
			});
			return pass;
		}
		
		
		//添加接收人
		function _addadmin_a(obj) {
			var m_i = $(obj).parent().children('select').find("option:selected").val();
			var text = $(obj).parent().children('select').find("option:selected").text();
			if (m_i == "0") {
				_alert(2, '审批策略', '请选择审批者');
				return false;
			}
			var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + m_i + '" id="' + m_i + '"/>');
			$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + text + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin_a(this)"></i>');
			$(obj).parent().after($c);
			$(obj).parent().children('select').find('option[value=' + m_i + ']').remove();
			$(obj).parent().children('select').val(0).trigger("change");
			check_option_str[m_i] = all_option_str[m_i];
			all_option_str[m_i] = null;
		}
		var check_value = 'false false';
		function approvemain(type) {
			if (manage_auth_array.indexOf(15) === -1 && manage_auth_array.indexOf(16) === -1 && manage_auth_array.indexOf(17) === -1 && manage_auth_array.indexOf(32) === -1){
				$("#EnableApprove_suspend").find('.btn-submit').remove();
			}
			//用户列表
			$.ajax({
				url: "/bhost/get_user_list_app",
				type: "POST",
				async: false,
				data: { a0: se,a2:6},
				success: function (result) {
					var userinfo_result = JSON.parse(result);
					if (userinfo_result.Result == true) {
						var userinfo_data = userinfo_result.info;
						$("#admin_select_a").empty().append("<option value=\"0\">请选择</option>");
						$.each(userinfo_data, function (i, item) {
							var text = '';
							if (item.Email != null && item.Email != '') {
								text += 'email';
							}
							if (item.MobilePhone != null && item.MobilePhone != '') {
								text += 'phone';
							}
							$("#admin_select_a").append("<option value=\"" + item.UserId + "\" index=\"0\" data-text=\"" + text + "\">" + item.UserCode + "</option>");
							all_option_str[item.UserId] = "<option value=\"" + item.UserId + "\" index=\"0\" data-text=\"" + text + "\">" + item.UserCode + "</option>";
						});
					} else {
						_alert(2, '审批策略', "执行失败：" + userinfo_result.ErrMsg);
						return false;
					}
				}
			});

			$('#admin_select_a').on('change', function () {
				var admin_select = $('#admin_select_a').val();
				$('#admin_check_a').attr('value', admin_select);
				if ($('#admin_select_a').find('option').length == 2 && $('#admin_select_a option:selected').val() != '0') {
					_addadmin_a($('#admin_select_a').siblings('i'));
					$('#admin_check_a').hide();
				} else if ($('#admin_select_a').find('option').length == 1) {
					$('#admin_check_a').hide();
				} else {
					$('#admin_check_a').show();
				}
				edit_admin_num();
			});
			//输入数字
			$("#ApproveNum").bind('keydown', function (e) {
				DigitInput(e);
			});

			$('#checkbox').on('ifChanged','input',function(e){
												if($('#checkbox4').is(':checked') && !$('#checkbox8').is(':checked')){
					update_xSelect($('.xSelect_phone_m'));
					update_xSelect($('.xSelect_phone_s'));
					$('.xSelect_phone_m').parents('.form-item').show();
					$('.xSelect_phone_s').parents('.form-item').show();
					$('.xSelect_smtp_m').parents('.form-item').hide();
					$('.xSelect_smtp_s').parents('.form-item').hide();
					$('#admin_select_a').select2('close');
					if(check_value=='true false'){
						return false;
					}
					check_value='true false';
					var admin_select_value=$('#admin_select_a').val();
					// setTimeout(function(){
						$.each($('#admin_select_a option[value!=0]'),function(i,item){
							if(item.getAttribute("data-text").indexOf('phone')<0){
								$(item).remove();
							}
						})
						for(var i in check_option_str){
							if(check_option_str[i]==null){
								continue;
							}
														if(check_option_str[i].indexOf('data-text="emailphone"')<0 && check_option_str[i].indexOf('data-text="phone"')<0){
								all_option_str[i]=check_option_str[i];
								// setTimeout(function() {
									$('#'+i).fadeOut(function () {
										$('#'+i).remove();
										edit_admin_num();
									});
								// }, 10);
								check_option_str[i]=null;
								continue;
							}
						}
						for(var i in all_option_str){
							if(all_option_str[i]==null){
								continue;
							}
							if((all_option_str[i].indexOf('data-text="emailphone"')>=0 || all_option_str[i].indexOf('data-text="phone"')>=0) && $('#admin_select_a option[value='+i+']').length==0){
								for(var j=i+1;j<all_option_str.length;j++){
									if(all_option_str[j]!=null){
										if($('#admin_select_a option[value='+j+']').length!=0){
											$('#admin_select_a option[value='+j+']').before(all_option_str[i]);
											break;
										}
									}
								}
								if(j==all_option_str.length){
									$('#admin_select_a').append(all_option_str[i]);
								}
							}
						}
						$('#admin_select_a').val(admin_select_value).trigger('change');
				}else if(!$('#checkbox4').is(':checked') && $('#checkbox8').is(':checked')){
					update_xSelect($('.xSelect_smtp_m'));
					update_xSelect($('.xSelect_smtp_s'));
					$('.xSelect_phone_m').parents('.form-item').hide();
					$('.xSelect_phone_s').parents('.form-item').hide();
					$('.xSelect_smtp_m').parents('.form-item').show();
					$('.xSelect_smtp_s').parents('.form-item').show();
					$('#admin_select_a').select2('close');
					if(check_value=='false true'){
						return false;
					}
					check_value='false true';
					var admin_select_value=$('#admin_select_a').val();
						$.each($('#admin_select_a option[value!=0]'),function(i,item){
							if(item.getAttribute("data-text").indexOf('email')<0){
								$(item).remove();
							}
						})
						for(var i in check_option_str){
							if(check_option_str[i]==null){
								continue;
							}
														if(check_option_str[i].indexOf('data-text="emailphone"')<0 && check_option_str[i].indexOf('data-text="email"')<0){
								all_option_str[i]=check_option_str[i];
								// setTimeout(function() {
									$('#'+i).fadeOut(function () {
										$('#'+i).remove();
										edit_admin_num();
									});
								// }, 10);
								check_option_str[i]=null;
								continue;
							}
						}
						for(var i in all_option_str){
							if(all_option_str[i]==null){
								continue;
							}
							if((all_option_str[i].indexOf('data-text="email"')>=0 || all_option_str[i].indexOf('data-text="emailphone"')>=0) && $('#admin_select_a option[value='+i+']').length==0){
								for(var j=i+1;j<all_option_str.length;j++){
									if(all_option_str[j]!=null){
										if($('#admin_select_a option[value='+j+']').length!=0){
											$('#admin_select_a option[value='+j+']').before(all_option_str[i]);
											break;
										}
									}
								}
								if(j==all_option_str.length){
									$('#admin_select_a').append(all_option_str[i]);
								}
							}
						}
						if($('#admin_select_a option[value='+admin_select_value+']').length==0){
							admin_select_value=0;
						}
						$('#admin_select_a').val(admin_select_value).trigger('change');
				}else if(!$('#checkbox4').is(':checked') && !$('#checkbox8').is(':checked')){
					$('.xSelect_phone_m').parents('.form-item').hide();
					$('.xSelect_phone_s').parents('.form-item').hide();
					$('.xSelect_smtp_m').parents('.form-item').hide();
					$('.xSelect_smtp_s').parents('.form-item').hide();
					$('#admin_select_a').select2('close');
					if(check_value=='false false'){
						return false;
					}
					check_value='false false';
					var admin_select_value=$('#admin_select_a').val();
						$('#admin_select_a option[value!=0]').remove();
						for(var i in all_option_str){
							if(all_option_str[i]==null){
								continue;
							}
							$('#admin_select_a').append(all_option_str[i]);
						}
						$('#admin_select_a').val(admin_select_value).trigger('change');
				}else if($('#checkbox4').is(':checked') && $('#checkbox8').is(':checked')){
					update_xSelect($('.xSelect_phone_m'));
					update_xSelect($('.xSelect_phone_s'));
					update_xSelect($('.xSelect_smtp_m'));
					update_xSelect($('.xSelect_smtp_s'));
					$('.xSelect_phone_m').parents('.form-item').show();
					$('.xSelect_phone_s').parents('.form-item').show();
					$('.xSelect_smtp_m').parents('.form-item').show();
					$('.xSelect_smtp_s').parents('.form-item').show();
					$('#admin_select_a').select2('close');
					if(check_value=='true true'){
						return false;
					}
					check_value='true true';
					var admin_select_value=$('#admin_select_a').val();
						$.each($('#admin_select_a option[value!=0]'),function(i,item){
							if(item.getAttribute("data-text").indexOf('emailphone')<0){
								$(item).remove();
							}
						})
						for(var i in check_option_str){
							if(check_option_str[i]==null){
								continue;
							}
														if(check_option_str[i].indexOf('emailphone')<0){
								all_option_str[i]=check_option_str[i];
								// setTimeout(function() {
									$('#'+i).fadeOut(function () {
										$('#'+i).remove();
										edit_admin_num();
									});
								// }, 10);
								check_option_str[i]=null;
								continue;
							}
						}
						for(var i in all_option_str){
							if(all_option_str[i]==null){
								continue;
							}
							if(all_option_str[i].indexOf('data-text="emailphone"')>=0 && $('#admin_select_a option[value='+i+']').length==0){
								for(var j=i-1;j<all_option_str.length;j--){
									if(all_option_str[j]!=null){
										if($('#admin_select_a option[value='+j+']').length!=0){
											$('#admin_select_a option[value='+j+']').before(all_option_str[i]);
											break;
										}
									}
								}
								if(j==0){
									$('#admin_select_a').prepend(all_option_str[i]);
								}
							}
						}
						if($('#admin_select_a option[value='+admin_select_value+']').length==0){
							admin_select_value=0;
						}
						$('#admin_select_a').val(admin_select_value).trigger('change');
				}
			});
			$('#checkbox1').iCheck('check');
			$('#checkbox1').iCheck('disable');
			//编辑页面
			if (type == 1) {
				$("#ApproveStrategyName").val(approve_data.ApproveStrategyName);
				$("#ApproveStrategyName").attr("disabled", true);
				$("#ApproveNum").val(approve_data.ApproveNum);
				var ApproveType = parseInt(approve_data.ApproveType.toString(2), 2);
				var text=[];
				var num_smssvr = 0;
				var num_smtp = 0;
				$('#ApproveNum').attr('edited',1);
				if(ApproveType&1){
					$('#checkbox1').iCheck('check');
				}
				if(ApproveType&2){
					$('#checkbox2').iCheck('check');
					if($.inArray('phone',text)<0){
						text.push('phone');
					}
					if(approve_data.MasterSmsSvrConfigId!=null){
						$('.xSelect_phone_m').data('value',approve_data.MasterSmsSvrConfigId);
						num_smssvr++;
					}
					if(approve_data.StandBySmsSvrConfigId!=null){
						$('.xSelect_phone_s').data('value',approve_data.StandBySmsSvrConfigId);
						num_smssvr++;
					}
				}
				if(ApproveType&4){
					$('#checkbox4').iCheck('check');
					if($.inArray('phone',text)<0){
						text.push('phone');
					}
					if(approve_data.MasterSmsSvrConfigId!=null){
						$('.xSelect_phone_m').data('value',approve_data.MasterSmsSvrConfigId);
						num_smssvr++;
					}
					if(approve_data.StandBySmsSvrConfigId!=null){
						$('.xSelect_phone_s').data('value',approve_data.StandBySmsSvrConfigId);
						num_smssvr++;
					}
				}
				if(ApproveType&8){
					$('#checkbox8').iCheck('check');
					text.push('email');
					if(approve_data.MasterSmtpConfigId!=null){
						$('.xSelect_smtp_m').data('value',approve_data.MasterSmtpConfigId);
						num_smtp++;
					}
					if(approve_data.StandBySmtpConfigId!=null){
						$('.xSelect_smtp_s').data('value',approve_data.StandBySmtpConfigId);
						num_smtp++;
					}
				}
				if(ApproveType&16){
					$('#checkbox16').iCheck('check');
				}
				if (num_smssvr != 0){
					update_xSelect($('.xSelect_phone_m'));
					update_xSelect($('.xSelect_phone_s'));
				}
				if (num_smtp != 0){
					update_xSelect($('.xSelect_smtp_m'));
					update_xSelect($('.xSelect_smtp_s'));
				}
				if (approve_data.UserSet != null) {
					for(var i=0;i<approve_data.UserSet.length-1;i++){
						var item=approve_data.UserSet[i];
						check_option_str[item.UserId] = all_option_str[item.UserId];
						all_option_str[item.UserId] = null;
						var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + item.UserId + '" id="' + item.UserId +'"/>');
						$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + item.UserCode + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin_a(this)"></i>');  
						$("#admin_select_a").parent().after($c);
						$("#admin_select_a").find('option[value=' + item.UserId + ']').remove();
						$("#admin_select_a").trigger('change');
					}
					if(all_option_str[approve_data.UserSet[i].UserId].indexOf('data-text="'+text.join('')+'"')<0 || (all_option_str[approve_data.UserSet[i].UserId]==undefined || all_option_str[approve_data.UserSet[i].UserId]==null)){
						var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + approve_data.UserSet[i].UserId + '" id="' + approve_data.UserSet[i].UserId +'"/>');
						$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + approve_data.UserSet[i].UserCode + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin_a(this)"></i>');
						$("#admin_select_a").parent().after($c);
						$("#admin_select_a").find('option[value=' + approve_data.UserSet[i].UserId + ']').remove();
						check_option_str[approve_data.UserSet[i].UserId] = all_option_str[approve_data.UserSet[i].UserId];
						all_option_str[approve_data.UserSet[i].UserId] = null;
						$("#admin_select_a").trigger('change');
					}else{
						$("#admin_select_a").val(approve_data.UserSet[i].UserId).trigger('change');
					}
					//$("#admin_select_a").val(approve_data.UserSet[i].UserId).trigger('change');
				}
			}
			$("#admin_select_a").select2();
		}

		function edit_admin_num() {
			$('#label_list_a').find('div[value!=0]:hidden').remove();
			var len = $('#label_list_a').find('div[value!=0]').length;
			$('#admin_num').text(len);
			var ApproveNum_count = $('#ApproveNum').val();
			var num_edited = $('#ApproveNum').attr('edited')
			if(num_edited == '0'){
				$('#ApproveNum').val(len);
			}
		}

		function save_data(d) {
			var approve_item = {
				"ApproveStrategyId": 0,
				"ApproveStrategyName": "",
				"ApproveNum": 0,
				"ApproveType": 0,   
				"UserSet": [],
				"MasterSmsMConfigId": null,
				"MasterSmsMConfig": null,
				"StandBySmsMConfigId": null,
				"StandBySmsMConfig": null,
				"MasterSmsSvrConfigId": null,
				"MasterSmsSvrConfig": null,
				"StandBySmsSvrConfigId": null,
				"StandBySmsSvrConfig": null,
				"MasterSmtpConfigId": null,
				"MasterSmtpConfig": null,
				"StandBySmtpConfigId": null,
				"StandBySmtpConfig": null
			}
			var val = $("#ApproveStrategyName").val();
			//审批策略名
			if (val == "") {
				_alert(2, "审批策略", '请输入名称', $("#ApproveStrategyName"));
				return false;
			}
			if (!nameReg.test(val)) {
				_alert(1, "审批策略", '名称格式不正确', $("#ApproveStrategyName"));
				return false;
			}
			var ApproveNum = $('#ApproveNum').val();
			if (ApproveNum == "") {
				_alert(2, "审批策略", '请输入审批人数', $("#ApproveNum"));
				return false;
			}
			var numReg = /^[0-9]+$/;
			if (!numReg.test(ApproveNum)) {
				_alert(1, "审批策略", '审批人数只能输入数字', $("#ApproveNum"));
				return false;
			}
			ApproveNum = parseInt(ApproveNum);
			if (ApproveNum == 0) {
				_alert(1, "审批策略", '审批人数不能为0', $("#ApproveNum"));
				return false;
			}
			if($('#checkbox1').is(':checked')){
				approve_item.ApproveType+=1;
			}
			if($('#checkbox2').is(':checked')){
				approve_item.ApproveType+=2;
			}
			if($('#checkbox4').is(':checked')){
				approve_item.ApproveType+=4;
				var xSelect_phone_m_id=$('.xSelect_phone_m').data('value');
				var xSelect_phone_s_id=$('.xSelect_phone_s').data('value');
				approve_item.MasterSmsSvrConfigId=xSelect_phone_m_id;
				approve_item.StandBySmsSvrConfigId=xSelect_phone_s_id;
				approve_item.MasterSmsSvrConfig=$('.xSelect_phone_m .xSelect-show-text').text();
				approve_item.StandBySmsSvrConfig=$('.xSelect_phone_s .xSelect-show-text').text();
			}
			if($('#checkbox8').is(':checked')){
				approve_item.ApproveType+=8;
				var xSelect_smtp_m_id=$('.xSelect_smtp_m').data('value');
				var xSelect_smtp_s_id=$('.xSelect_smtp_s').data('value');
				approve_item.MasterSmtpConfigId=xSelect_smtp_m_id;
				approve_item.StandBySmtpConfigId=xSelect_smtp_s_id;
				approve_item.MasterSmtpConfig=$('.xSelect_smtp_m .xSelect-show-text').text();
				approve_item.StandBySmtpConfig=$('.xSelect_smtp_s .xSelect-show-text').text();
			}
			if (approve_item.ApproveType == 0) {
				_alert(2, "审批策略", '请选择方式');
				return false;
			}
			var $all = $("#label_list_a").find('div[value!=0]');
			var len = $all.length;
			if (len == 0) {
				_alert(2, "审批策略", '请选择审批者');
				return false;
			}
			//var id = document.frm_approve_add.a.value;
			approve_item.ApproveStrategyId = approveId;
			approve_item.ApproveStrategyName = val;
			if (ApproveNum > len) {
				ApproveNum = len;
			}
			approve_item.ApproveNum = (ApproveNum);
			approve_item.UserSet = new Array();

			for (var j = len - 1; j >= 0; j--) {
				var t_i = $all.eq(j).attr('value');
				if (t_i != '0' && t_i != '') {
					var json_a = '{"UserId":' + t_i + '}';
					approve_item.UserSet.push(JSON.parse(json_a));
				}
			}
			var msstr = aceg(JSON.stringify(approve_item),se);
			$.ajax({
				url: '/bhost/add_approve',
				type: "POST",
				async: false,
				data: { a0: se, a1: JSON.stringify(approve_item), a10:"运维管理>指令授权",m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						$('.btn').blur(); parent.layer.open({
							type: 1,
							title: '审批策略',
							content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
							btn: ['确&nbsp;&nbsp;定'],
							btnAlign: 'c',
							closeBtn: false,
							skin: 'layer-custom',
							area: ['380px', '310px'],
							move: false,
							resize: false,
							yes: function (i) {
								$('.btn').blur();
								parent.layer.close(i);
								var approve_text = $('#EnableApprove').find('span').text();
								$("div[data-id=xSelect-approve]").remove();
								$('#EnableApprove').empty().data('xSelect','');
								bind_approval_xSelect();
								if ($("#EnableApprove").data('value') == "-1" || $("#EnableApprove").data('value') == undefined){
									$("#EnableApprove").data('value',result.ApproveStrategyId);
									$("#EnableApprove").find('span').text(approve_item.ApproveStrategyName);
								}else{
									$('#EnableApprove').find('span').text(approve_text);
								}
								d.close().remove();
							}
						});
					} else {
						_alert(1, "审批策略", "执行失败：" + result.ErrMsg, $("#ApproveStrategyName"));
						return false;
					}
				}
			});
		}



		/* 
		* 处理过长的字符串，截取并添加省略号 
		* 注：半角长度为1，全角长度为2 
		*  
		* pStr:字符串 
		* pLen:截取长度 
		*  
		* return: 截取后的字符串 
		*/
		function autoAddEllipsis(pStr, pLen) {

			var _ret = cutString(pStr, pLen);
			var _cutFlag = _ret.cutflag;
			var _cutStringn = _ret.cutstring;

			if ("1" == _cutFlag) {
				return _cutStringn + "...";
			} else {
				return _cutStringn;
			}
		}
		/* 
		* 取得指定长度的字符串 
		* 注：半角长度为1，全角长度为2 
		*  
		* pStr:字符串 
		* pLen:截取长度 
		*  
		* return: 截取后的字符串 
		*/
		function cutString(pStr, pLen) {

			// 原字符串长度  
			var _strLen = pStr.length;

			var _tmpCode;

			var _cutString;

			// 默认情况下，返回的字符串是原字符串的一部分  
			var _cutFlag = "1";

			var _lenCount = 0;

			var _ret = false;

			if (_strLen <= pLen / 2) {
				_cutString = pStr;
				_ret = true;
			}

			if (!_ret) {
				for (var i = 0; i < _strLen; i++) {
					if (isFull(pStr.charAt(i))) {
						_lenCount += 2;
					} else {
						_lenCount += 1;
					}

					if (_lenCount > pLen) {
						_cutString = pStr.substring(0, i);
						_ret = true;
						break;
					} else if (_lenCount == pLen) {
						_cutString = pStr.substring(0, i + 1);
						_ret = true;
						break;
					}
				}
			}

			if (!_ret) {
				_cutString = pStr;
				_ret = true;
			}

			if (_cutString.length == _strLen) {
				_cutFlag = "0";
			}

			return { "cutstring": _cutString, "cutflag": _cutFlag };
		}

		/* 
		* 判断是否为全角 
		*  
		* pChar:长度为1的字符串 
		* return: true:全角 
		*          false:半角 
		*/
		function isFull(pChar) {
			if ((pChar.charCodeAt(0) > 128)) {
				return true;
			} else {
				return false;
			}
		}

		function _compare_ip(x, y) {
			var ip1 = x.split('.');
			var ip2 = y.split('.');
			//var flag = 0;
			for (var i1 = 0; i1 < 4; i1++) {
				if (parseInt(ip1[i1]) < parseInt(ip2[i1])) {
					return 3;
				} else if (parseInt(ip1[i1]) > parseInt(ip2[i1])) {
					return 2
				} else {
					//flag++;
				}
			}
			return 1;
			/*
			if (flag == 4) {
				return 1
			}
			return 3;
			*/
		}
		function _getWait(obj) {
			if (typeof waitDonelayer != 'undefined') {
				layer.close(waitDonelayer);
			}

			$(obj).removeClass('done').show().unbind().on('mouseover', function () {
				waitlayer = layer.tips('搜索中', this, {
					tips: 1,
					time: 0,
					skin: 'waitlayer'
				});
			}).on('mouseout', function () {
				if (typeof waitlayer != 'undefined') {
					layer.close(waitlayer);
				}
			});

			// //完成
			// setTimeout(function(){
			// 	_waitDone();
			// },3000)
		}
		function _waitDone(obj) {
			if (typeof waitlayer != 'undefined') {
				layer.close(waitlayer);
			}
			$(obj).fadeOut(3000);
			if (typeof waitDonelayer != 'undefined') {
				layer.close(waitDonelayer);
			}
		}
		function AscSort(a, b) {
			a = parseInt(a.split(':')[1]);
			b = parseInt(b.split(':')[1]);
			return a - b;
		}
		function ajax_host(){
			ajax_flag = true;
			if(ajax_data.length == 0) return ;
			$.ajax({
				url:'/bhost/get_hosts',
				type:'post',
				cache:false,
				async:true,
				data:{a0:se,z1:ajax_data.join(",")},
				beforeSend :function(xmlHttp){ 
					xmlHttp.setRequestHeader("If-Modified-Since","0"); 
					xmlHttp.setRequestHeader("Cache-Control","no-cache");
				},
				success:function(result){
					if(ajax_data.length == 0) return ;
					
					results = JSON.parse(result);
					//ajax_data 排序
					ajax_data.sort(AscSort);
					$(results.info).each(function(i,item){
						var adata = item;
						hgid = ajax_data[i].split(':')[0];
						//
						//改变样式
						
						$('#nodeh-'+hgid+'-'+adata.HostId).prev('i').addClass('h-aicon-d');
						obj = $('#nodeh-'+hgid+'-'+adata.HostId).siblings('ul');
						
						$(obj).empty().show();
						var v = 2,d;
						var $input = $('#nodeh-'+hgid+'-'+adata.HostId).siblings('span.checkbox');
						if($input.length  ==0) return true;
						//d = $(this).siblings('span.authtype').find('input[type=radio]:checked').val();
						if($('#nodeh-'+hgid+'-'+adata.HostId).siblings('span.authtype').find('input').is(':checked')){
							d = 0;
						}else{
							d = 1;
						}
						if ($input.attr('class').indexOf('disabled')>0){
							d = 0;
						}
						var c = $input.attr('class');
						if(c.indexOf('checked')>0){
							v=1;
						}else if(c == 'checkbox'){
							v=0;
						}
						
						var flag_change = false;
						var _loadfirst = $(obj).siblings('input.zcheck').attr("data-loadfirst");
						var _loadlast = $(obj).siblings('input.zcheck').attr("data-loadlast");
						var parents_aid = $(obj).siblings('input.zcheck').attr('id').split('-');
						var parents_id = parents_aid[2];
						var parentss_id = parents_aid[1];
						//判断 父节点是否状态改变
						
						var loadfirst = 0;
						var loadlast = 0;
						
						if(_loadfirst == _loadlast){
							if (_loadlast == 2){
								loadfirst = 2;
								loadlast = 2;
							}else if (_loadlast == 1){
								flag_change = true;
							}
						}else{
							if (_loadlast == 2){
								loadlast = 2;
							}
							if (_loadfirst == 2){
								loadfirst = 2;
							}
							//flag_change = true;
						}
						
						$.each(adata.ServiceSet,function(i,item){
							var $a='';
							var class_flag = 0;
							if (ajax_find_host_doing == true && $(obj).siblings('span.h-name-red').length == 0) {
								var li_class_item = 'style="display: none;"';
							} else {
								var li_class_item = '';
							}
							$.each(adata.AccountSet,function(i2,item2){
								if(item2.HostAccount==null){
									return true;
								}
								$.each(item2.HostServiceSet,function(i1,item1){
									if (item.HostServiceId == item1.HostServiceId){
										class_flag = 1;
										if (loadlast == 2){
											$a = $a + '<li><i class="h-blank" /><input type="checkbox" id="nodea-'+parentss_id+'-'+parents_id+'-'+item2.HostAccount.AccountId+'-'+item1.HostServiceId+'" class="zcheck zcheck-g" data-loadfirst='+loadfirst+' data-loadlast='+loadlast+' checked="checked" data-name="'+item2.HostAccount.AccountName+'"><i class="h-eicon h-eicon-a2"></i><span class="h-name h-name2" style="margin-top:-6px;width:12em;" id="spana-' + parentss_id + '-' + parents_id + '-' + item2.HostAccount.AccountId + '-' + item1.HostServiceId + '">'+'<span class="h-name-son" style="">' + 
                                                item2.HostAccount.AccountName.split('').map(function (params) {
                                                    return '<font>'+params+'</font>'    
                                                }).join('') + 
                                                '</span>'+'</span></li>';
										}else{
											$a = $a + '<li><i class="h-blank" /><input type="checkbox" id="nodea-'+parentss_id+'-'+parents_id+'-'+item2.HostAccount.AccountId+'-'+item1.HostServiceId+'" class="zcheck zcheck-g" data-loadfirst='+loadfirst+' data-loadlast='+loadlast+' data-name="'+item2.HostAccount.AccountName+'"><i class="h-eicon h-eicon-a2"></i><span class="h-name h-name2" style="margin-top:-6px;width:12em;" id="spana-' + parentss_id + '-' + parents_id + '-' + item2.HostAccount.AccountId + '-' + item1.HostServiceId+'">'+'<span class="h-name-son" style="">' + 
                                                item2.HostAccount.AccountName.split('').map(function (params) {
                                                    return '<font>'+params+'</font>'    
                                                }).join('') + 
                                                '</span>'+'</span></li>'
										}
										
										return false;
									}
								})
							});
							if (class_flag == 0){
								A_class = "h-blank";
							}else{
								A_class = "h-aicon";
							}
							if (loadlast == 2){
								$(obj).append('<li><i class="'+A_class+'" data-id="arrS-'+item.HostServiceId+'"/><input type="checkbox" id="nodes-'+parentss_id+'-'+parents_id+'-'+item.HostServiceId+'" class="zcheck zcheck-g" data-loadfirst='+loadfirst+' data-loadlast='+loadlast+' checked="checked" data-name="'+item.HostServiceName+'\t'+item.ProtocolName+'"><i class="h-eicon h-eicon-s2"></i><span class="h-name h-name2" id="spans-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" style="width: 12em;">'+'<span class="h-name-son" style="">' + 
                                    item.HostServiceName.split('').map(function (params) {
                                        return '<font>'+params+'</font>'    
                                    }).join('') + 
                                    '</span>'+'</span><ul style="display:none">'+$a+'</ul></li>');
							}else{
								$(obj).append('<li><i class="'+A_class+'" data-id="arrS-'+item.HostServiceId+'"/><input type="checkbox" id="nodes-'+parentss_id+'-'+parents_id+'-'+item.HostServiceId+'" class="zcheck zcheck-g" data-loadfirst='+loadfirst+' data-loadlast='+loadlast+' data-name="'+item.HostServiceName+'\t'+item.ProtocolName+'"><i class="h-eicon h-eicon-s2"></i><span class="h-name h-name2" id="spans-' + parentss_id + '-' + parents_id + '-' + item.HostServiceId + '" style="width: 12em;">'+'<span class="h-name-son" style="">' + 
                                    item.HostServiceName.split('').map(function (params) {
                                        return '<font>'+params+'</font>'    
                                    }).join('') + 
                                    '</span>'+'</span><ul style="display:none">'+$a+'</ul></li>');
							}
						});
						if (flag_change){
							if (AccessAuth.AuthObject != null && edit != "None"){
								var ser_flag = 0;
								var serid_flag = 0;
								var first_serid = 1;
								if (v != 0){
									$.each(AccessAuth.AuthObject,function(i1,item1){
										if (item1.HGId == parentss_id && item1.HostId == parents_id){
											$("#nodea-"+parentss_id+'-'+parents_id+'-'+item1.AccountId+'-'+item1.HostServiceId).attr('checked',true);				
											$("#nodea-"+parentss_id+'-'+parents_id+'-'+item1.AccountId+'-'+item1.HostServiceId).next('span').attr("class","checkbox checked");
											$("#nodea-"+parentss_id+'-'+parents_id+'-'+item1.AccountId+'-'+item1.HostServiceId).attr('data-loadfirst',2);
											$("#nodea-"+parentss_id+'-'+parents_id+'-'+item1.AccountId+'-'+item1.HostServiceId).attr('data-loadlast',2);
											
											if ($("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).siblings('ul').find('input:checked').length == $("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).siblings('ul').find('input').length){
												$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).attr('checked',true);
												$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).next('span').attr("class","checkbox checked");
												$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).attr('data-loadfirst',2);
												$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).attr('data-loadlast',2);
											}else{
												$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).attr("data-check","2");
												$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).attr('data-loadfirst',1);
												$("#nodes-"+parentss_id+'-'+parents_id+'-'+item1.HostServiceId).attr('data-loadlast',1);
											}
										}
									})
								}
							}
						}
						
						
						if(d==0){
							$(obj).find('input').prop('disabled',true);
							if ($(obj).siblings('span.authtype').find('input').length > 0){
								if ($(obj).siblings('span.authtype').find('input').next('span').attr('class').indexOf('checked') != -1 || $(obj).siblings('input').prop('disabled')){
									
								}else{
									$(obj).find('input').each(function(){
										$(this).attr('disabled',false);
										$(this).next('span.checkbox').removeClass('disabled');
									});
								}
							}
						}
						
						_checkView_host(obj);
					})
					
					//50个结束 继续调用 过滤信息
					if(host_path_all.length == 0){
						scrollTop_check_server1();
					}else{
					//	//find_append();
					}
					ajax_flag = false;
					ajax_data = [];		
					return true;
				}
			})	
		}
		
		function clear_cmdset(){
			$("#CmdSetName").val('').attr('disabled',false);
			$("#CmdSetName").next('i').attr('class','v-check');
			$("#Description_cmd").val('');
			$("#Content_cmd").val('');
			$("#Content_cmd").text('');
		}

		var cmdsetid;
		function _editNode2(obj,type){
			clear_cmdset();
			var title;
			if (type == 1){
				cmdsetid = $(obj).children('span').data('value');
				title = "指令集合";
			}else{
				cmdser_edit = null;
				cmdsetid = 0;
				title = "指令集合";
			}
			var $dialogCont = $("#cmd_suspend").show();
			
			var d = dialog({
				title:title,
				content:$dialogCont,
				id:"cmd_suspend",
				width:"800px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			//$("#EventLevel").next('span').css("margin-left",9);
			cmdsetmain(type);
			$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
				clear_cmdset();
				cmdsetmain(type);
				//d.close().remove();
			});
			
			$("a.btn-submit",$dialogCont).unbind().bind("click",function(){	
				SaveSet(d);
			});
		}

		function cmdsetmain(type){
			if (manage_auth_array.indexOf(17) === -1){
				$("#cmd_suspend").find('.btn-submit').remove();
			}
			if (type == 1){
				$.ajax({
				   url:'/bhost/select_cmdset_all',
				   type:"post",
				   async:false,
				   data:{a0:se,z8:cmdsetid},
				   success:function(results){
						cmdadd = JSON.parse(results);
						var content = "";
						content = cmdadd.data[0].Content//replace(/,/g,"\n");
						$("#Content_cmd").text(content);
						$("#Content_cmd").val(content);
						$("#Description_cmd").val(cmdadd.data[0].Description);
						$("#CmdSetName").val(cmdadd.data[0].Name).attr('disabled',true);
					}
				});
			}
		}

		var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
		function NameCheck(obj){
			var name = $(obj).val().trim();
			var $i = $(obj).next('i.v-check');
			
			if (!nameReg.test(name)){
				$i.show().attr('class','v-check v-wrong');
			}else{
				$i.show().attr('class','v-check v-right');
			}
		}

		function SaveSet(d){
			var CmdSetName = $("#CmdSetName").val().trim();
			var Description = $("#Description_cmd").val().trim();
			var Content = $("#Content_cmd").val().trim();
			var flag = 0;
			if (CmdSetName == ""){
				_alert(2,"指令集合","请输入名称",$("#CmdSetName"));
				return false;
			}
			if (!nameReg.test(CmdSetName)){
				_alert(1,"指令集合","名称格式不正确",$("#CmdSetName"));
				return false;
			}
			if (Content == ""){
				_alert(2,"指令集合","请输入指令",$("#Content_cmd"));
				return false;
			}

			$.ajax({
				url:'/bhost/save_cmdset',
				type:'post',
				async:false,
				data:{a0:se,z3:CmdSetName,z4:Description,z5:Content,z6:cmdsetid,z7:cmdsetid,a10:"运维管理>指令授权"},
				success:function(Result){
					data = JSON.parse(Result);
					if (data.Result == false){
						_alert(1,"指令集合","执行失败：" + data.ErrMsg,$("#CmdSetName"));
					}else{
						$('.btn').blur();
						parent.layer.open({
							type:1,
							title:"指令集合",
							content:'<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
							btn:['确&nbsp;&nbsp;定'],
							btnAlign:'c',
							closeBtn: false,
							skin:'layer-custom',
							area:['380px','310px'],
							move: false,
							resize: false,
							btn1:function(i){
								parent.layer.close(i);
								var cmd_text = $('#cmd').find('span').text();
								$("div[data-id=xSelect-cmd]").remove();
								$('#cmd').empty().data('xSelect','');
								bind_cmd_xSelect();
								if ($("#cmd").data('value') == "-1" || $("#cmd").data('value') == undefined){
									$("#cmd").data('value',data.CmdSetId);
									$("#cmd").find('span').text(CmdSetName);
									cmdset.splice(0,1,data.CmdSetId);
								}else{
									$('#cmd').find('span').text(cmd_text);
								}
								d.close().remove();
							},
							btn2:function(i){
								parent.layer.close(i);
							}
						});	
					}
				}
			});
		}


	</script>
</body>

</html>
