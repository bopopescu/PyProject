<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8" http-equiv="X-UA-Compatible" content="IE=11;IE=10;IE=9; IE=8; IE=EDGE,chrome=1" />
	<title>manager</title>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<link rel="stylesheet" href="/manage/css/style.css">
	<link rel="stylesheet" href="/manage/css/new-head.css">
	<script>
		var userAgent = navigator.userAgent;
		var ie8 = userAgent.indexOf('Trident/4.0');

		if (ie8 != -1) {
			document.write('<script src="/manage/js/jquery-IE8.js"></' + 'script>');
		} else {
			document.write('<script src="/manage/js/jquery.min.js"></' + 'script>');
		}
	</script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/common_e.js"></script>
	<script src="/manage/js/layer.js"></script>

	<!--icheck-->
	<script src="/manage/js/icheck.min.js"></script>
	<!--select2-->
	<script src="/manage/js/select2.full.min.js"></script>
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<!--select2-->
	<script src="/manage/js/select2.full.min.js"></script>
	<script src="/manage/js/base64.js"></script>
	<script src="/manage/js/xSelect.js"></script>
	<script>
		var screenWidth = window.screen.width;
		var vmax = 10; //显示条数
		if (screenWidth <= 1440) {
			vmax = 8;
		}
	</script>
	<style>
		#protocolLink,#RightTip{top:45px;}
		.select2 {width:170px;}
		.pl-c .item input[type=password] {
			width: 160px;
			height: 26px;
			border: 1px solid #b2b2b2;
			border-radius: 5px;
			padding: 0 4px;
			/*color: #888;*/
			font-size: 12px;
		}
		.pl-c .item input[type=password]:focus {
			border-color: #000;
		}
	</style>
</head>

<body style="overflow-x:hidden;overflow-y:auto;" class="bg-white" id="scroll">

	<!---->
	<div class="mainer">
		<div class="container">
			<div class="c-top">
				<!---->
				<div class="c-cont2">
					<div class="c-wrap">
						<div class="c-table c-table2" style="min-width:850px;">
							<div class="tab-t tab-t2">
								<div class="h-route" id="hostRoute">
									<a id="route-root" class="forcoll" href="javascript:;" style="cursor:default;">收藏夹</a>
									<div class="h-path-wrap">{{fname}}</div>
								</div>


								<a class="quickgo" href="javascript:;" onclick="_quickLink(this)">
									<i></i>快速连接
								</a>

								<div class="filter">
									<div id="waitTip" class="waitTip" style="float: right; margin-top: 7px; margin-left: -26px; display: none;"></div>
									<div class="search">
										<select name="find_select" id="find_select" class="filter-select" style="height: 27px;">
											<option value="all" selected>所有</option>
											<option value="hostname">主机名</option>
											<option value="hostip">主机IP</option>
											<option value="protocolname">协议</option>
										</select>
										<div style="float:left;">
											<input type="text" class="filter-text" placeholder="输入关键字" id="keyword" style="border-left:0;padding: 0px 22px 0px 4px;"
											 onkeydown="if($('#keyword').val()==''){$('#v_clear').hide();}else{$('#v_clear').show();};if (event.keyCode == 13){_addFilter(this,false);return false;} else return;"
											 onchange="if($('#keyword').val()==''){$('#v_clear').hide();}else{$('#v_clear').show();}" onkeyup="if($('#keyword').val()==''){$('#v_clear').hide();}else{$('#v_clear').show();}"
											 onblur="change_input(this);">

											<i style="display:none;cursor: pointer;" class="v-check v-wrong" id="v_clear" onclick="_clear_keyword(this)"></i>
										</div>
										<button class="btn filter-btn" onclick="_addFilter(this,false)"><i class="add-filter"></i></button>
										<button class="btn filter-btn" onclick="_addFilter(this,true)"><i class="append-filter"></i></button>
									</div>
									<div class="search" id="clearFilter" style="margin: 0px 15px 0px -16px;display:none;">
										<button class="filter-btn" onclick="_clearFilter(this)"><i class="clear-filter"></i></button>
									</div>
									<div class="selector selector-multiple" id="filterWW" style="display: none;">
										<span class="ww">搜索条件</span>
										<ul></ul>
									</div>
								</div>
							</div>
							<!---->
							<div class="box-table box-table2">
								<table cellpadding="0" cellspacing="0">
									<thead>
										<tr>
											<th style="width:32%">主机</th>
											<th style="width:330px;">协议类型</th>
											<th style="">描述</th>
											<th width="64" style="text-align: center;">收藏</th>
										</tr>
									</thead>

									<tbody id="fList">
										<!--
												<tr>
														<td colspan="4" style="text-align: center;">Loading...</td>
												</tr>
												-->
									</tbody>
								</table>
							</div>

							<div class="tab-i tab-i2">
								<div class="il">
									每页显示<span id="page_total">8</span>条 总数：<span id="host_total">0</span>
								</div>

								<div class="ipage">
									<a href="javascript:;" class="nav2 begin" onclick="changepage(1)"><i></i></a>
									<a href="javascript:;" class="nav prev" onclick="changepage(2)"><i></i></a>
									<input type="text" style="margin-left:5px;" value="1" id="curpage" onchange="changepage(3)">/&nbsp;<span id="totalpage">1</span>
									<a href="javascript:;" class="nav next" onclick="changepage(4)"><i></i></a>
									<a href="javascript:;" class="nav2 end" onclick="changepage(5)"><i></i></a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div id="RightTip" class="RightTip_class"></div>

		<div id="protocolLink">
			<div class="pl-tit">
				<i></i><span>快速连接</span>
			</div>

			<div class="pl-c">
				<div class="item ip_div">
					<div class="label">IP：</div>
					<div class="group">
						<input type="text" name="" value="">
					</div>
				</div>
				<div class="item pro_div">
					<div class="label">协议：</div>
					<div class="group">
						<div class="pro_Select" id="pro_select_div" style="margin-left: 10px;"></div>
						<!--
						<select name="" id="pro_select" class="select2" style="width: 100px" onchange="change_pro(this);">
								<option value="1">DOWNLOAD</option>
						</select>
					-->
						&nbsp;端口：<input type="text" value="12345" style="width: 28px;padding: 0 3px;" id="port_input">
					</div>
				</div>
				<div class="item sel_user">
					<div class="label">选择用户：</div>
					<div class="group">
						<select name="" id="user_select" class="select2">
							<option value="1">WebTool(asdasfggs)</option>
						</select>
					</div>
				</div>
				<div class="item user_div">
					<div class="label">用户名：</div>
					<div class="group">
						<input type="text" name="" value="">
					</div>
				</div>

				<div class="item pwd_check_div">
					<div class="label">密码：</div>
					<div class="group">
						<label class="defined" style="width: 72px;"><input type="radio" name="linkpwd" value="1" checked>托管密码</label>
						<label class="custom" style="width: 72px;"><input type="radio" name="linkpwd" value="2">输入密码</label>

						<label class="defined div_sshkey" style="width: 72px;"><input type="radio" name="linkpwd" value="3" checked>托管密钥</label>
						<label class="custom div_sshkey" style="width: 72px;"><input type="radio" name="linkpwd" value="4">输入密钥</label>
						<input type="password" style="display:none;">
						<div class="xSelect xSelect_SSHkey" id="SSHkey_s" style="display:none;"></div>
						<!-- <input type="password" style="margin-top: 5px;display:none;"> -->
					</div>
				</div>

				<div class="item authmode_div">
					<div class="label">认证方式：</div>
					<div class="group">
						<label class="pwd_auth"><input type="radio" name="authmode" value='1' checked>密码</label>
						<label class="sshkey_auth"><input type="radio" name="authmode" value='2'>密钥</label>
					</div>
				</div>

				<div class="item pwd_div">
					<div class="label pwd">密码：</div>
					<div class="group pwd ctr" style="width: 235px;">
						<input type="password" name="" value="" style="width: 121px;">
						<a class="btn fp" href="javascript:;" style="margin-right: 65px;float: right;line-height: 26px;padding: 0 4px;"
						 onclick="findPwd(1);">搜索</a>
					</div>
					<div class="label ssh" style="display: none;">密钥：</div>
					<div class="group ssh ctr" style="display: none; width: 235px;">
						<div class="xSelect xSelect_SSHkey" id="SSHkey_s1" style="float: left; background: white;"></div>
						<a class="btn fp" href="javascript:;" style="margin-right: 65px;float: right;line-height: 26px;padding: 0 4px;"
						 onclick="findPwd(2);">搜索</a>
					</div>
				</div>
				<div class="item mfs_divall">
					<div class="group">
						<label class='mfs' style="width:20px; margin-right: 4px;"><input type="checkbox" name="" id="EnableCFG"></label>
					</div>
					<div class="label" style="text-align: left;">应用通道</div>
				</div>
				<div class="item linkmode_div">
					<div class="label">连接模式：</div>
					<div class="group">
						<label class="local_client" style="width:72px;"><input type="radio" name="linkmode">客户端</label>
						<label class="web_con" style="width:72px;"><input type="radio" name="linkmode">WEB访问</label>
						<!-- <label class="mfs" style="width:72px;"><input type="radio" name="linkmode">应用发布</label> -->
					</div>
				</div>

				<div class="item sel_linkmode">
					<div class="label">本地客户端：</div>
					<div class="group">
						<select name="" id="sel_client" class="select2" style="width:170px;" onchange="change_client(this);">
						</select>
					</div>
				</div>

				<div class="item mfs_div">
					<div class="label">客户端：</div>
					<div class="group">
						<select name="" id="sel_mfs" class="select2">
						</select>
					</div>
				</div>

				<div class="item screen_div">
					<div class="label">屏幕大小：</div>
					<div class="group">
						<select name="" id="screensize" class="select2">
							<option value="0">自适应</option>
							<option value="1">全屏</option>
							<option value="800*600">800*600</option>
							<option value="1024*768">1024*768</option>
							<option value="1280*800">1280*800</option>
							<option value="1440*900">1440*900</option>
						</select>

						<label style="width:70px;"><input type="checkbox" name="" id="EnableRDPClipboard">剪贴板</label>
						<label style="width:80px;"><input type="checkbox" name="" id="EnableRDPDiskMap">磁盘映射</label>
						<label style="width:80px;"><input type="checkbox" name="" id="ApplicationChannel">应用通道</label>
					</div>
				</div>

				<div class="item disk_map">
					<div class="label">硬盘映射：</div>
					<div class="group">
						<label style="width:35px;"><input type="checkbox" name="" id="">C:</label>
						<label style="width:35px;"><input type="checkbox" name="" id="">D:</label>
						<label style="width:35px;"><input type="checkbox" name="" id="">E:</label>
						<label style="width:35px;"><input type="checkbox" name="" id="">F:</label>
						<label style="width:35px;"><input type="checkbox" name="" id="">G:</label>
						<label style="width:35px;"><input type="checkbox" name="" id="">H:</label>
					</div>
				</div>

				<div class="item url">
					<div class="label">URL：</div>
					<div class="group">
						<select name="" id="" class="select2">
							<option value="1">https://www.baidu.com/</option>
						</select>
					</div>
				</div>

				<div class="item conn">
					<div class="label">连接参数：</div>
					<div class="group">
						<select name="" id="conn_select" class="select2">
							<option value="RADMIN">RADMIN</option>
						</select>
					</div>
				</div>

				<div class="item oracle">
					<div class="label">指定：</div>
					<div class="group">
						<select name="" id="appoint" class="select2" onchange="appoint_change(this);">
							<option value="SID">SID</option>
							<option value="SERVICE_NAME">SERVICE_NAME</option>
						</select>
					</div>
				</div>

				<div class="item oracle">
					<div class="label">实例名：</div>
					<div class="group" style="padding: 0;">
						<input type="text" name="" value="" id="oracle_input">
					</div>
				</div>

				<div class="item oracle">
					<div class="label">连接方式：</div>
					<div class="group">
						<select name="" id="oracle_auth_select" class="select2">
							<option value="NORMAL" text="NORMAL">NORMAL</option>
							<option value="SYSDBA" text="SYSDBA">SYSDBA</option>
							<option value="SYSOPER" text="SYSOPER">SYSOPER</option>
						</select>
					</div>
				</div>

				<div class="item oracle_ctl">
					<div class="label">路径：</div>
					<div class="group" style="padding: 0;">
						<input type="text" name="" value="" id="ctl_input">
					</div>
				</div>

				<div class="item radmin">
					<div class="label">认证方式：</div>
					<div class="group">
						<select name="" id="radmin_auth_select" class="select2">
							<option value="RADMIN">RADMIN</option>
							<option value="Windows">Windows</option>
						</select>
					</div>
				</div>

				<div class="item mssql">
					<div class="label">实例名：</div>
					<div class="group">
						<input type="text" name="" value="">
					</div>
				</div>
				<div class="item mssql">
					<div class="label">认证方式：</div>
					<div class="group">
						<select name="" id="mssql_auth" class="select2">
							<option value="SQL服务器验证">SQL服务器验证</option>
							<option value="Windows验证">Windows验证</option>
							<option value="Windows单一登录">Windows单一登录</option>
						</select>
					</div>
				</div>

				<div class="item mysql">
					<div class="label">数据库名：</div>
					<div class="group">
						<input type="text" name="" value="">
					</div>
				</div>
				<!--
			<div class="item mysql">
				<div class="label">版本号：</div>
				<div class="group">
					<select name="" id="mysql_version" class="select2" style="width:120px;">
						<option value="0"><7.5</option>
						<option value="1">≥7.5</option>
					</select>
				</div>
			</div>
			-->
				<div class="item http https">
					<div class="label">URL：</div>
					<div class="group">
						<input type="text" name="" value="" id="http_url">
					</div>
				</div>
				<div class="item http https">
					<div class="label">账号元素：</div>
					<div class="group">
						<input type="text" name="" value="" id="http_account">
					</div>
				</div>
				<div class="item http https">
					<div class="label">密码元素：</div>
					<div class="group">
						<input type="text" name="" value="" id="http_pwd">
					</div>
				</div>
				<div class="item http https">
					<div class="label">提交元素：</div>
					<div class="group">
						<input type="text" name="" value="" id="http_submit">
					</div>
				</div>

				<div class="item sysbase">
					<div class="label">实例名：</div>
					<div class="group">
						<input type="text" name="" value="" id="sysbase_input">
					</div>
				</div>
				<div class="item sysbase_ctl">
					<div class="label">路径：</div>
					<div class="group" style="padding: 0;">
						<input type="text" name="" value="" id="ctl_sysbase_input">
					</div>
				</div>
				<div class="item db2">
					<div class="label">数据库名：</div>
					<div class="group">
						<input type="text" name="" value="" id="db2_input">
					</div>
				</div>

				<div class="item sel_access">
					<div class="label">连接方式：</div>
					<div class="group">
						<select name="" id="access_select" class="select2">
							<option value="1">WebTool(asdasfggs)</option>
						</select>
					</div>
				</div>
				<div class="item passageway" style="display: none;">
					<div class="label">方式：</div>
					<div class="group ctr" style="width:235px;">
						<select name="" id="passageway_select" class="select2">
							<option value="1">端口访问</option>
							<option value="2">访问通道</option>
						</select>
					</div>
				</div>
				<div class="item remark" style="">
					<div class="label">访问备注：</div>
					<div class="group ctr" style="width:235px;">
						<input type="text" name="" value="" id="remark_input" style="width:121px;">
						<a class="btn" href="javascript:;" style="margin-right: 65px;float: right;line-height: 26px;padding: 0 4px;"
						 onclick="save_remark(1);">提交</a>
					</div>
				</div>
				<div class="item">
					<p class="err">工单未授权链接</p>
				</div>
			</div>

			<div class="pl-b">
				<a href="javascript:;" class="pl-btn" id="connect">连&nbsp;&nbsp;接</a>
			</div>

			<div class="pullbtn" onclick="_hideProt(this)"></div>
		</div>
	</div>

	<script>
		var isMac = function() { 
			return /macintosh|mac os x/i.test(navigator.userAgent); 
		}();
		// isMac=true;
		if (isMac){
			$('.disk_map').html('<div class="label">硬盘映射：</div>'+
			'<div class="group">'+
				'<label style="width:70px;"><input type="radio" name="macdisks" id="">所有磁盘</label>'+
				'<label style="width:70px;"><input type="radio" name="macdisks" id="">主文件夹</label>'+
				'<label style="width:70px;"><input type="radio" name="macdisks" id="">文档文件夹</label>'+
				// '<label style="width: 80px;float: none;">/path:<input type="text" name="" id="" style="margin-left: 6px;width:120px"></label>'+
			'</div>');
		}else{
			$('.disk_map').html('<div class="label">硬盘映射：</div>'+
			'<div class="group">'+
				'<label style="width:35px;"><input type="checkbox" name="" id="">C:</label>'+
				'<label style="width:35px;"><input type="checkbox" name="" id="">D:</label>'+
				'<label style="width:35px;"><input type="checkbox" name="" id="">E:</label>'+
				'<label style="width:35px;"><input type="checkbox" name="" id="">F:</label>'+
				'<label style="width:35px;"><input type="checkbox" name="" id="">G:</label>'+
				'<label style="width:35px;"><input type="checkbox" name="" id="">H:</label>'+
			'</div>');
		}
		$('.pl-c input').iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		});


		$('.pl-c .select2').select2({ minimumResultsForSearch: -1 });
		$('#find_select').select2({ minimumResultsForSearch: -1 });
	</script>

	<style>
		.xSelect-show.on-above {
			background: white;
		}

		/*.pl-c .item input[type=text] {
		width: 147px;
		}*/
		.select2-results__option[aria-selected] {
			font-size: 12px;
		}

		.pl-c .item {
			display: none;
		}

		.RightTip_class::before {
			border: 0px solid;
		}

		.filter .search .filter-text:first-child {
			border-left: 0 !important;
			border-radius: 0;
		}

		#pro_select_div div {
			width: 78px;
			float: left;
			margin-left: -10px;
			background-color: #fff;
		}

		.xSelect-show-text {
			font-size: 12px;
		}

		.xSelect-view ul li {
			padding-right: 0px;
		}

		.xSelect-view ul li span {
			padding-left: 4px;
			font-size: 12px;
		}
	</style>
	<script>
		var json_icon = {
			"Unix": "1",
			"Switchboard": "2",
			"Ruijie": "3",
			"Linux": "4",
			"Huawei": "5",
			"Host": "6",
			"Firewall": "7",
			"H3C": "8",
			"Cluster": "9",
			"Cisco": "10",
			"AS400": "11",
			"Aix": "12",
			"Network": "13",
			"Windows": "14",
			"Server": "15"
		}
		var path_array;
		var IsTunnel;
		var MapPort;
		var _permissions = 0;
		var global_data;
		var remote_data;
		var remark_need = 0;
		var client_ip_global = '';
		var document_domain = "";
		var window_location_host = "";		
		function _initSize(){
                        var h = $(window).height();
                        $('.c-cont2').height(h-37);
                }
                $(window).resize(function () {
                        _initSize();
                });
		$(function () {
			//mac_get();
                        _initSize();
			if (IEVersion() < 10 && IEVersion() > 0) {
				$('.web_con').remove();
			}

			if (document.all && !window.setTimeout.isPolyfill) {
				var __nativeST__ = window.setTimeout;
				window.setTimeout = function (vCallback, nDelay /*, argumentToPass1, argumentToPass2, etc. */) {
					var aArgs = Array.prototype.slice.call(arguments, 2);
					return __nativeST__(vCallback instanceof Function ? function () {
						vCallback.apply(null, aArgs);
					} : vCallback, nDelay);
				};
				window.setTimeout.isPolyfill = true;
			}


			$.ajax({
				url: "/bhost/PGet_LocalClient",
				type: "POST",
				async: false,
				data: { a0: se },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						path_array = result.info.data;
						client_ip_global = result.client_ip_global;
					} else {
						_alert(2, '收藏夹', result.ErrMsg);
						return false;
					}
				}
			});

			$.ajax({
				url: '/bhost/get_globalstrategy',
				type: 'post',
				async: false,
				data: { a0: se },
				success: function (result) {
					global_data = JSON.parse(result);
					IsTunnel = global_data.IsTunnel + "";
					MapPort = global_data.MapPort;
				}
			})
			$.ajax({
				url: "/bhost/RealIPGet",
				type: "POST",
				async: false,
				data: { a0: se, a1: document.domain},
				success: function (result) {
					var result = JSON.parse(result);
					if(result.result == true){
						if(result.dev_type == "gluster"){
							document_domain = result.info;
							window_location_host = result.info;
						}else{
							document_domain = document.domain;
							window_location_host = window.location.host;
						}
					}else{
						document_domain = document.domain;
						window_location_host = window.location.host;
					}
				}
			})
			$.ajax({
				url: "/bhost/PGet_UserGlobalConfig",
				type: "POST",
				async: false,
				data: { a0: se },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						remote_data = result.info;
					} else {
						_alert(2, '收藏夹', result.ErrMsg);
						return false;
					}
				}
			});

			$.each(window.parent.parent._power, function (i, item) {
				if (item.SubMenuId == 25 && item.Mode == 1) {
					_permissions = 1;
					return false;
				}
			});
			var clicktag = 0;
			$("#connect").on("click", function () {
				$("#connect").blur();
				if (clicktag == 0) {
					clicktag = 1;
					setTimeout(function () {clicktag = 0}, 1000);
				 }else return false;
				 
				$.ajax({
					url: '/bhost/get_globalstrategy',
					type: 'post',
					async: false,
					data: { a0: se },
					success: function (result) {
						global_data = JSON.parse(result);
						IsTunnel = global_data.IsTunnel + "";
						MapPort = global_data.MapPort;
					}
				})

				var ServiceName = '';
				var ConnType = '';
				//var ssh_sftp_flag = 0;
				if (quick_link == 1) {
					var hostip = $(".ip_div").find('input').val();
					var pro_name = $("#pro_select_div").find('span').text();
					var port = $("#port_input").val();
					var user = $(".user_div").find('input').val();
				} else {
					if ($("#fList").find('a.prolink.active').length != 0) {
						var tr_index = $('a.prolink.active').parents('tr:first').index();
						/*var commparamid = $("#conn_select").val();
						if(commparamid == -1){
							commparamid = null;
						}
						$.each(service_array_all[tr_index],function(i,item){
							if(item.ProtocolName == GLOBAL_ProtocolName && item.Port == GLOBAL_Port && item.ConnParamId == $("#conn_select").val()){
								var a_index = i;
							}
						})*/
						var pro_name = GLOBAL_ProtocolName;
						var port = GLOBAL_Port;
						var hostip = baseData[tr_index].HostIP;
					} else {
						//var a_index = $('a.prolink.active').index();
						var pro_name = GLOBAL_ProtocolName;
						var port = GLOBAL_Port;
						var hostip = baseData[tr_click].HostIP;
					}
					var user = $("#user_select").val();
					if (user == "*") {
						user = $(".user_div").find('input').val();
					}
				}
				$.ajax({
					url:'/bhost/DevChk',
					type:'post',
					async:false,
					data:{a0:se,a1:hostip,a2:pro_name},
					success:function(result){
						result = JSON.parse(result);
						ret1 = result.info.split(',')[0];
						bhuser1 = result.info.split(',')[1];
						type_Chk = result.type;
					}
				})
				var con1 = 0;
				if(ret1 != 0){
					con1 = 1;
					if(type_Chk == "1"){//服务器登陆限制
						_alert(1,"收藏夹","用户"+bhuser1+"已登录该主机");
						return false;
					}else{//客户端登陆限制
						parent.layer.open({
							type: 1,
							title: "收藏夹",
							content: '<div class="layer-alert"><i class="alert warning"></i>当前用户已在'+bhuser1+'上登录</div>',
							btn: ['确&nbsp;&nbsp;定'],
							btnAlign: 'c',
							closeBtn: false,
							skin: 'layer-custom',
							area: ['380px', '310px'],
							move: false,
							resize: false,
							btn1: function (i) {
								parent.parent.logout();
							}	
						})
						return false;
					}
				}
				if(con1 == 1){
					return false;
				}
				switch (pro_name) {
					case "SSH":
						ServiceName = $("#access_select").val();
						break;
					case "MYSQL":
						ServiceName = $('.mysql:eq(0)').find('input').val();
						break;
					case "MSSQL":
						ServiceName = $('.mssql:eq(0)').find('input').val();
						ConnType = $("#mssql_auth").val();
						break;
					case "ORACLE":
						ServiceName = $("#oracle_input").val();
						ConnType = $("#oracle_auth_select").val();
						break;
					case "HTTP(S)":
					case "HTTPS":
						ServiceName = $("#http_url").val();
						break;
					case "DB2":
						ServiceName = $("#db2_input").val();
						break;
					case "SYBASE":
						ServiceName = $("#sysbase_input").val();
						break;
					case "RADMIN":
						ConnType = $("#radmin_auth_select").val();
						break;
					case "RDP":
						ConnType = $("#access_select").val();
						break;	
				}

				//var ipReg = /^((?:(?:2[0-4][0-9]\.)|(?:25[0-5]\.)|(?:1[0-9][0-9]\.)|(?:[1-9][0-9]\.)|(?:[0-9]\.)){3}(?:(?:2[0-5][0-5])|(?:25[0-5])|(?:1[0-9][0-9])|(?:[1-9][0-9])|(?:[0-9])))$/;
				var ipReg = /(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;
				if (hostip == "") {
					_alert(1, "收藏夹", "IP不能为空", $(".ip_div").find('input'));
					return false;
				} else if (!ipReg.test(hostip)) {
					_alert(1, "收藏夹", "IP地址格式不正确", $(".ip_div").find('input'));
					return false;
				}
				if(($(".pwd_div").find('input').attr("disabled")== "disabled" && $(".pwd_div").find('input').val().length > 128) || ($(".pwd_div").find('input').attr("disabled")!= "disabled" && $(".pwd_div").find('input').val().length > 64)){
					_alert(1,"收藏夹","密码不能超过系统限定64位");
					return false;
				}
				remark_need = 0;
				var remark_need_flag = 0;
				if (user == "") {
					user = "-";
				}
				/*
				if (ssh_sftp_flag == 1){
					pro_name = "SSH";
				}
				*/
				$.ajax({
					url: "/bhost/Get_AuthObjectByInput",
					type: 'post',
					async: false,
					data: { a0: se, z1: hostip, z2: pro_name, z3: port, z4: user.replace(/\\/g, "\\\\"), z5: ServiceName, z6: ConnType },
					success: function (result) {
						if(result != ""){
							result1 = JSON.parse(result);
						}
						if (result == "" || result1.Result == false) {
							remark_need_flag = 1;
							$.ajax({
								url:'/bhost/delHostAccount',
								type:"post",
								async:true,
								data:{a0:se,a1:hostip,a2:pro_name,a3:user.replace(/\\/g,"\\\\")},
								success:function(result){
									var result = JSON.parse(result);
									if(result.Result != true){
										_alert(1,"收藏夹",result.ErrMsg);
									}
								}
							});
							parent.layer.open({
								type: 1,
								title: "收藏夹",
								content: '<div class="layer-alert"><i class="alert fail"></i>无权访问，如有问题请联系管理员</div>',
								btn: ['确&nbsp;&nbsp;定'],
								btnAlign: 'c',
								closeBtn: false,
								skin: 'layer-custom',
								area: ['380px', '310px'],
								move: false,
								resize: false,
								btn1: function (i) {
									parent.layer.close(i);
								}
							})
							return false;
						} else {
							var obj_json = JSON.parse(result);
							if (obj_json.action == 2) {
								remark_need_flag = 1;
							$.ajax({
								url:'/bhost/delHostAccount',
								type:"post",
								async:true,
								data:{a0:se,a1:hostip,a2:pro_name,a3:user.replace(/\\/g,"\\\\")},
								success:function(result){
									var result = JSON.parse(result);
									if(result.Result != true){
										_alert(1,"收藏夹",result.ErrMsg);
									}
								}
							});
							parent.layer.open({
								type: 1,
								title: "收藏夹",
								content: '<div class="layer-alert"><i class="alert fail"></i>无权访问，如有问题请联系管理员</div>',
								btn: ['确&nbsp;&nbsp;定'],
								btnAlign: 'c',
								closeBtn: false,
								skin: 'layer-custom',
								area: ['380px', '310px'],
								move: false,
								resize: false,
								btn1: function (i) {
									parent.layer.close(i);
								}
							})
								return false;
							}
							if (obj_json.AuthLevel != 1 && obj_json.EnableWorkOrderApprove) {
								remark_need_flag = 1;
								_alert(1, "收藏夹", "工单未授权连接");
								return false;
							}
							if ($("#ApplicationChannel").is(":visible")) {
								if (obj_json.IsAcc == 1 && !$("#ApplicationChannel").prop('checked')) {
									remark_need_flag = 1;
									_alert(1, "收藏夹", "请选择应用通道");
									return false;
								}
								if (obj_json.IsAcc == 0 && $("#ApplicationChannel").prop('checked')) {
									remark_need_flag = 1;
									_alert(1, "收藏夹", "请取消应用通道");
									return false;
								}
							}
							if (obj_json.EnableAccessInfo) {
								remark_need = 1;
							}
						}
					}
				});

				if (remark_need_flag == 1) {
					return false;
				}

				//if ((quick_link == 0 && auth_strategy != "" && auth_strategy.data.length != 0 && auth_strategy.data[0].EnableAccessInfo) || global_data.IfGiveAccessInfo){
				if (global_data.IfGiveAccessInfo || remark_need == 1) {
					if (quick_link == 1) {
						var hostip = $(".ip_div").find('input').val();
					} else {
						var hostip = prolink_ip;
					}
					get_plan(hostip);
					parent.remarkDialog_show(planmsg);
				} else {
					connect_pro();
				}
			});

			$('body').addClass('max' + vmax);
			$('#page_total').text(vmax);
			$("#RightTip").css({ "cursor": "default" });
			$("#curpage").bind('keydown', function (e) {
				DigitInput(e);
			});
			_initList();
			_initEvent();
			$("#scroll").scroll(function () {
				$(".layui-layer").removeClass("block").addClass("none")
			})
			$("#EnableRDPDiskMap").on('ifChanged', function () {
				if ($(this).prop('checked') && $("#EnableRDPDiskMap").is(":visible")) {
					//if ($('.web_con').find('input').prop('checked')){
					//	$(".disk_map").hide();
					//}else{
					$(".disk_map").show();
					//}
				} else {
					$(".disk_map").hide();
				}
			});

			get_pro_v(0);
			bind_SSHkey_xSelect();
			$(".local_client").find('input').on('ifChanged', function () {
				repeat_select();
				var pro_name;
				if ($("#pro_select_div").is(':visible')) {
					pro_name = $("#pro_select_div").find('span').text();
				} else {
					pro_name = prolink_pro;
				}
				if ($(this).prop('checked')) {
					if ($('#EnableCFG').prop('checked') == false || !$('#EnableCFG').is(":visible")) {
						$(".sel_linkmode").show();
						$(".mfs_div").hide();
						/*
						if ($("#ApplicationChannel").is(':visible') && $("#ApplicationChannel").prop('checked')){
							$(".mfs_div").show();
						}else{
							$(".mfs_div").hide();
						}
						*/
						$(".screen_div").hide();
						$('.disk_map').hide();
						$("#sel_client").empty();
						var option_str = "";
						switch (pro_name) {
							case "SSH":
							case "RLOGIN":
								var Putty_flag = 0;
								var SecureCRT_flag = 0;
								var XShell_flag = 0;
								$.each(path_array, function (i, item) {
									//if (item.ProtocolName == pro_name){
									if (item.ClientName == "Putty") {
										Putty_flag = 1;
									} else if (item.ClientName == "SecureCRT") {
										SecureCRT_flag = 1;
									} else if (item.ClientName == "XShell") {
										XShell_flag = 1;
									}
									//}
								});

								if (Putty_flag == 1) {
									option_str = option_str + '<option value="Putty">Putty</option>';
								} else {
									option_str = option_str + '<option value="Putty">Putty(未设置)</option>';
								}

								if (SecureCRT_flag == 1) {
									option_str = option_str + '<option value="SecureCRT">SecureCRT</option>';
								} else {
									option_str = option_str + '<option value="SecureCRT">SecureCRT(未设置)</option>';
								}

								if (XShell_flag == 1) {
									option_str = option_str + '<option value="XShell">XShell</option>';
								} else {
									option_str = option_str + '<option value="XShell">XShell(未设置)</option>';
								}
								//var option_str = '<option value="Putty">Putty</option><option value="SecureCRT">SecureCRT</option><option value="XShell">XShell</option>';
								$("#sel_client").append(option_str);
								break;
							case "ORACLE":
								var PLSql_flag = 0;
								var PowerBuilder_flag = 0;
								var SqlPlus_flag = 0;
								var SqlPlusW_flag = 0;
								var Toad_flag = 0;
								var sqlldr_flag = 0;
								$.each(path_array, function (i, item) {
									//if (item.ProtocolName == pro_name){
									if (item.ClientName == "PLSql") {
										PLSql_flag = 1;
									} else if (item.ClientName == "PowerBuilder") {
										PowerBuilder_flag = 1;
									} else if (item.ClientName == "SqlPlus") {
										SqlPlus_flag = 1;
									} else if (item.ClientName == "SqlPlusW") {
										SqlPlusW_flag = 1;
									} else if (item.ClientName == "Toad") {
										Toad_flag = 1;
									} else if (item.ClientName == "sqlldr") {
										sqlldr_flag = 1;
									}
									//}
								});
								if (PLSql_flag == 1) {
									option_str = option_str + '<option value="PLSql">PLSql</option>';
								} else {
									option_str = option_str + '<option value="PLSql">PLSql(未设置)</option>';
								}
								if (PowerBuilder_flag == 1) {
									option_str = option_str + '<option value="PowerBuilder">PowerBuilder</option>';
								} else {
									option_str = option_str + '<option value="PowerBuilder">PowerBuilder(未设置)</option>';
								}
								if (SqlPlus_flag == 1) {
									option_str = option_str + '<option value="SqlPlus">SqlPlus</option>';
								} else {
									option_str = option_str + '<option value="SqlPlus">SqlPlus(未设置)</option>';
								}
								if (SqlPlusW_flag == 1) {
									option_str = option_str + '<option value="SqlPlusW">SqlPlusW</option>';
								} else {
									option_str = option_str + '<option value="SqlPlusW">SqlPlusW(未设置)</option>';
								}
								if (Toad_flag == 1) {
									option_str = option_str + '<option value="Toad">Toad</option>';
								} else {
									option_str = option_str + '<option value="Toad">Toad(未设置)</option>';
								}
								if (sqlldr_flag == 1) {
									option_str = option_str + '<option value="sqlldr">sqlldr</option>';
								} else {
									option_str = option_str + '<option value="sqlldr">sqlldr(未设置)</option>';
								}

								//var option_str = '<option value="PLSql">PLSql</option><option value="PowerBuilder">PowerBuilder</option><option value="SqlPlus">SqlPlus</option><option value="SqlPlusW">SqlPlusW</option><option value="Toad">Toad</option><option value="sqlldr">sqlldr</option>';
								$("#sel_client").append(option_str);
								break;
							case "MYSQL":
								var MySql_flag = 0;
								$.each(path_array, function (i, item) {
									//if (item.ProtocolName == pro_name){
									if (item.ClientName == "MySql") {
										MySql_flag = 1;
										return false;
									}
									//}
								});
								if (MySql_flag == 1) {
									option_str = '<option value="MySql">MySql</option>';
								} else {
									option_str = '<option value="MySql">MySql(未设置)</option>';
								}
								//var option_str = '<option value="MySql">MySql</option>';
								$("#sel_client").append(option_str);
								break;
							case "TELNET":
								var Netterm_flag = 0;
								var Putty_flag = 0;
								var SecureCRT_flag = 0;
								var XShell_flag = 0;
								$.each(path_array, function (i, item) {
									//if (item.ProtocolName == pro_name){
									if (item.ClientName == "Netterm") {
										Netterm_flag = 1;
									} else if (item.ClientName == "Putty") {
										Putty_flag = 1;
									} else if (item.ClientName == "SecureCRT") {
										SecureCRT_flag = 1;
									} else if (item.ClientName == "XShell") {
										XShell_flag = 1;
									}
									//}
								});
								if (Netterm_flag == 1) {
									option_str = option_str + '<option value="Netterm">Netterm</option>';
								} else {
									option_str = option_str + '<option value="Netterm">Netterm(未设置)</option>';
								}
								if (Putty_flag == 1) {
									option_str = option_str + '<option value="Putty">Putty</option>';
								} else {
									option_str = option_str + '<option value="Putty">Putty(未设置)</option>';
								}
								if (SecureCRT_flag == 1) {
									option_str = option_str + '<option value="SecureCRT">SecureCRT</option>';
								} else {
									option_str = option_str + '<option value="SecureCRT">SecureCRT(未设置)</option>';
								}
								if (XShell_flag == 1) {
									option_str = option_str + '<option value="XShell">XShell</option>';
								} else {
									option_str = option_str + '<option value="XShell">XShell(未设置)</option>';
								}
								//var option_str = '<option value="Netterm">Netterm</option><option value="Putty">Putty</option><option value="SecureCRT">SecureCRT</option><option value="XShell">XShell</option>';
								$("#sel_client").append(option_str);
								break;
							case "FTP":
							case "SFTP":
								var FlashfXP_flag = 0;
								var LeapFtp2_flag = 0;
								var LeapFtp3_flag = 0;
								var WinSCP_flag = 0;
								var filezilla_flag = 0;
								$.each(path_array, function (i, item) {
									//if (item.ProtocolName == pro_name){
									if (item.ClientName == "FlashfXP") {
										FlashfXP_flag = 1;
									} else if (item.ClientName == "LeapFtp2.0") {
										LeapFtp2_flag = 1;
									} else if (item.ClientName == "LeapFtp3.0") {
										LeapFtp3_flag = 1;
									} else if (item.ClientName == "WinSCP") {
										WinSCP_flag = 1;
									} else if (item.ClientName == "filezilla") {
										filezilla_flag = 1;
									}
									//}
								});
								if (FlashfXP_flag == 1) {
									option_str = option_str + '<option value="FlashfXP">FlashfXP</option>';
								} else {
									option_str = option_str + '<option value="FlashfXP">FlashfXP(未设置)</option>';
								}
								if (pro_name == "FTP") {
									if (LeapFtp2_flag == 1) {
										option_str = option_str + '<option value="LeapFtp2.0">LeapFtp2.0</option>';
									} else {
										option_str = option_str + '<option value="LeapFtp2.0">LeapFtp2.0(未设置)</option>';
									}
									if (LeapFtp3_flag == 1) {
										option_str = option_str + '<option value="LeapFtp3.0">LeapFtp3.0</option>';
									} else {
										option_str = option_str + '<option value="LeapFtp3.0">LeapFtp3.0(未设置)</option>';
									}
								}
								if (WinSCP_flag == 1) {
									option_str = option_str + '<option value="WinSCP">WinSCP</option>';
								} else {
									option_str = option_str + '<option value="WinSCP">WinSCP(未设置)</option>';
								}
								if (filezilla_flag == 1) {
									option_str = option_str + '<option value="filezilla">filezilla</option>';
								} else {
									option_str = option_str + '<option value="filezilla">filezilla(未设置)</option>';
								}
								//var option_str = '<option value="FlashfXP">FlashfXP</option><option value="LeapFtp2.0">LeapFtp2.0</option><option value="LeapFtp3.0">LeapFtp3.0</option><option value="WinSCP">WinSCP</option><option value="filezilla">filezilla</option>';
								$("#sel_client").append(option_str);
								break;
							case "SYBASE":
								var PowerBuilder_flag = 0;
								var SqlAdvantage_flag = 0;
								var isqlw_flag = 0;
								$.each(path_array, function (i, item) {
									if (item.ClientName == "SqlAdvantage") {
										SqlAdvantage_flag = 1;
									}
									if (item.ClientName == "isqlw") {
										isqlw_flag = 1;
									}
									/*
									if (item.ClientName == "PowerBuilder"){
										PowerBuilder_flag = 1;
									}else if (item.ClientName == "SqlAdvantage"){
										SqlAdvantage_flag = 1;
									}
									*/
								});
								/*
								if (PowerBuilder_flag == 1){
									option_str = '<option value="PowerBuilder">PowerBuilder</option>';
								}else{
									option_str = '<option value="PowerBuilder">PowerBuilder(未设置)</option>';
								}
								*/
								if (SqlAdvantage_flag == 1) {
									option_str = option_str + '<option value="SqlAdvantage">SqlAdvantage</option>';
								} else {
									option_str = option_str + '<option value="SqlAdvantage">SqlAdvantage(未设置)</option>';
								}

								if (isqlw_flag == 1) {
									option_str = option_str + '<option value="isqlw">isqlw</option>';
								} else {
									option_str = option_str + '<option value="isqlw">isqlw(未设置)</option>';
								}

								//var option_str = '<option value="PowerBuilder">PowerBuilder</option><option value="">SqlAdvantage</option>';
								$("#sel_client").append(option_str);
								break;
							case "DB2":
								var DB2Cmd_flag = 0;
								$.each(path_array, function (i, item) {
									//if (item.ProtocolName == pro_name){
									if (item.ClientName == "DB2Cmd") {
										DB2Cmd_flag = 1;
										return false;
									}
									//}
								});
								if (DB2Cmd_flag == 1) {
									option_str = '<option value="DB2Cmd">DB2Cmd</option>';
								} else {
									option_str = '<option value="DB2Cmd">DB2Cmd(未设置)</option>';
								}
								//var option_str = '<option value="DB2Cmd">DB2Cmd</option>';
								$("#sel_client").append(option_str);
								break;
							case "RDP":
							case "VNC":
							case "X11":
								$("#sel_client").append('<option value="MSTSC">MSTSC</option>');
								$(".screen_div").show();
								if (pro_name == "X11" || pro_name == "VNC") {
									$("#EnableRDPDiskMap").parents('label:first').hide();
									$(".disk_map").hide();
								} else {
									$("#EnableRDPDiskMap").parents('label:first').show();
									if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')) {
										$(".disk_map").show();
									} else {
										$(".disk_map").hide();
									}
								}
								$("#EnableRDPClipboard").parents('label:first').show();
								break;
							default:
								;
						}
					}
				} else {
					$(".sel_linkmode").hide();
					if (pro_name == "RDP") {
						//$('.disk_map').hide();
					} else if ((pro_name == "VNC" || pro_name == "X11") && !$('#EnableCFG').prop('checked')) {
						$('#EnableRDPDiskMap').parents('label:first').hide();
						$('.disk_map').hide();
					}
				}

			});
			$(".mfs").find('input').on('ifChanged', function () {
				//$('#ApplicationChannel,input[name=linkmode]:eq(1)').on('ifChanged',function(){
				if($(".mfs").is(":visible") == false){
					return true;
				}					
				repeat_select();
				var pro_name;
				if ($("#pro_select_div").is(':visible')) {
					pro_name = $("#pro_select_div").find('span').text();
				} else {
					if ($("#fList").find('a.prolink.active').length != 0) {
						var tr_index = $('a.prolink.active').parents('tr:first').index();
						//var a_index = $('a.prolink.active').index();
						var pro_name = GLOBAL_ProtocolName;
					} else {
						//var a_index = $('a.prolink.active').index();
						var pro_name = GLOBAL_ProtocolName;
					}
				}
				if ($(this).prop('checked') && $(this).is(":visible") == true) {
					$('.web_con').show();
					var key_array = [];
					key_array.push("协议名称-" + pro_name);

					$.ajax({
						url: '/bhost/get_acc_client_list',
						type: "post",
						async: false,
						data: { a0: se, z4: "null", z5: "null", z6: JSON.stringify(key_array) },
						success: function (result) {
							var result = JSON.parse(result);
							var option_str = "";
							$.each(result.data, function (i, item) {
								option_str = option_str + '<option value="' + item.ClientName + '">' + item.ClientName + '</option>';
							});
							if (option_str == "") {
								option_str = '<option value="0">无</option>';
							}
							$("#sel_mfs").empty().append(option_str);
							$("#sel_mfs").select2();
						}
					});
					if (pro_name == "X11") {
						$("#EnableRDPDiskMap").parents('label:first').hide();
					}
					/*
					if ($(this).attr('id') != "ApplicationChannel"){
						$("#sel_linkmode").hide();
					}else{
						if (pro_name == "VNC" || pro_name == "X11"){
							$("#EnableRDPDiskMap").parents('label:first').hide();
						}
					}
					*/
					if (pro_name == "VNC") {
						$('#EnableRDPDiskMap').parents('label:first').show();
						if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')) {
							$('.disk_map').show();
						} else {
							$('.disk_map').hide();
						}
					}else{
						$(".screen_div").show();
						if ($('#EnableRDPDiskMap').is(':visible') && $('#EnableRDPDiskMap').prop('checked')) {
							$('.disk_map').show();
						} else {
							$('.disk_map').hide();
						}
					}
					$(".sel_linkmode").hide();
					$(".screen_div").show();
					$(".mfs_div").show();
					$('.web_con').show();					
				} else {
					if (pro_name != "SSH" && pro_name != "RDP" && pro_name != "TELNET" && pro_name != "VNC" && pro_name != "X11" && pro_name != "RLOGIN" && pro_name != "TN5250") {
						$('.web_con').hide();
						$(".local_client").find('input').iCheck('uncheck')
						$('.local_client').find('input').iCheck('check');
					} else {
                                        if(pro_name != "VNC" || $('.web_con').find("input").prop('checked')){
	                                                $(".sel_linkmode").hide();
	                                        }else{
	                                                $(".sel_linkmode").show();
	                                        }
					}
					$(".mfs_div").hide();
					if (pro_name == "VNC") {
						$('#EnableRDPDiskMap').parents('label:first').hide();
						$('.disk_map').hide();
					}
				}
				if (!global_data.IsTunnel) {
					if (pro_name == "SYBASE") {
						$("#passageway_select").empty().append('<option value="2">访问通道</option>');
					}else{
						$("#passageway_select").empty().append('<option value="1">端口访问</option>');
					}
					// if ($(".web_con").find('input').prop('checked')) {
					// 	$('.passageway').hide();
					// } else {
					// 	$(".passageway").show();
					// }
				}
			});

			$(".web_con").find('input').on('ifChanged', function () {
				repeat_select();
				var pro_name;
				if ($("#pro_select_div").is(':visible')) {
					pro_name = $("#pro_select_div").find('span').text();
				} else {
					pro_name = prolink_pro;
				}

				if (!global_data.IsTunnel) {
					if (pro_name == "SYBASE" && $(".local_client").find('input').prop('checked')) {
						$("#passageway_select").empty().append('<option value="2">访问通道</option>');
					} else {
						$("#passageway_select").empty().append('<option value="1">端口访问</option>');
					}
					//$(".passageway").show();
				}
				if ($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked') == true && $(".web_con").find('input').prop('checked')) {//h5访问前置机
					$(".screen_div").show();
				} else {
					$(".screen_div").show();
				}
				if ($(this).prop('checked')) {
					$(".passageway").hide();
					if(pro_name == "SSH" || pro_name == "RLOGIN" || pro_name == "TELNET"){
						$(".screen_div").hide();
					}
				}				
			})

			$("input[name=linkpwd]").on('ifChanged', function () {
				$('.item.pwd_div').show();
				repeat_select();
				var pwd_value = $(this).attr('value');
				$(this).parents('.group').prev().click();
				if ($(this).prop('checked')) {
					if (pwd_value == '2') {//输入密码
						$('.item.pwd_div').find('.pwd').show();
						$('.item.pwd_div').find('.ssh').hide();
					} else if (pwd_value == '4') {//输入密钥
						$('.item.pwd_div').find('.pwd').hide();
						$('.item.pwd_div').find('.ssh').show();
					} else if (pwd_value == '1') {//托管密码
						$('.item.pwd_div').find('.pwd').show();
						$('.item.pwd_div').find('.ssh').hide();
					} else if (pwd_value == '3') {//托管密钥
						$('.item.pwd_div').find('.pwd').hide();
						$('.item.pwd_div').find('.ssh').show();
					}
				}
			})
			$("input[name=authmode]").on('ifChanged', function () {
				var auth_value = $(this).attr('value');
				$('.label.ssh').click();
				if ($(this).prop('checked')) {
					$(".item.pwd_div").show();
					if (auth_value == '1') {
						$(".pwd").show();
						$(".ssh").hide();
					} else if (auth_value == '2') {
						$(".pwd").hide();
						$(".ssh").show();
					}
				}
			})
		});

		//绑定密钥
		var SSHkeyData;
		var SSHkey_index_all;
		var saved_sshkey;
		var saved_sshkey_cont;
		var saved_sshkey_pwd;
		var key_cont = "";
		var key_psp = "";
		var key_name = "";
		function binding_SSHkey(ip_str, server_str, account_str) {
			saved_sshkey = "";
			saved_sshkey_cont = "";
			saved_sshkey_pwd = "";
			$.ajax({
				url: '/bhost/get_sshkey_host_u',
				type: "post",
				async: false,
				cache: false,
				data: { a0: se, a1: ip_str, a2: server_str, a3: account_str },
				success: function (Result) {
					result = JSON.parse(Result)
					if (result.info == 'None') {
						SSHkeyData = "";
					} else {
						SSHkeyData = result.info;
					}
				}
			});
		}
		function bind_SSHkey_xSelect(ip_str, server_str, account_str) {
			binding_SSHkey(ip_str, server_str, account_str);
			var default_flag = false;
			var ssh_array = [];
			SSHkey_index_all = [];
			var default_id = "";
			$.each(SSHkeyData, function (i, item) {
				if (item.Type == 1) {
					var select_data_json = {
						'value': 1,
						'name': 'admin2'
					};
				} else {
					var select_data_json = {
						'value': 1,
						'name': 'admin2',
						'type': 'edit'
					};
				}
				select_data_json.value = item.SshKeyId;
				if (item.SshKeyId == default_id) {
					return true;
				}
				if (item.KeyName == "托管配置") {
					select_data_json.name = "默认";
					default_id = item.SshKeyId;
					default_flag = true;
					return false;
				} else {
					select_data_json.name = item.KeyName;
				}
				ssh_array.push(select_data_json);
				SSHkey_index_all.push(item.SshKeyId);
			});
			$("#SSHkey_s").empty().data('xSelect', '');
			$("#SSHkey_s1").empty().data('xSelect', '');
			$('#SSHkey_s').xSelect({
				width: 169,
				defaultText: '请选择',
				items: ssh_array,
				module_type: 'SSHkey_s',
				edit: function (item, obj) {
					$('.' + $('.xSelect_SSHkey .xSelect-show').data('id')).hide();
					parent._addNew3(obj, 1);
				},
				btn: [
					{
						'name': '新增',
						'event': function (items, obj) {
							parent._addNew3(obj, 0);
						}
					}
				],
				setval: function (item, obj) {
				}
			});
			if (default_flag == true) {
				btm_tmp = [];
			} else {
				btm_tmp = [{
					'name': '新增',
					'event': function (items, obj) {
						parent._addNew3(obj, 0);
					}
				}]
			}
			$('#SSHkey_s1').xSelect({
				width: SSHkey_s1_length,
				defaultText: '请选择',
				items: ssh_array,
				module_type: 'SSHkey_s1',
				edit: function (item, obj) {
					$('.' + $('.xSelect_SSHkey .xSelect-show').data('id')).hide();
					parent._addNew3(obj, 1);
				},
				btn: btm_tmp,
				setval: function (item, obj) {
				}
			});
			if (default_flag == true) {
				$("#SSHkey_s").data('value', default_id);
				$("#SSHkey_s").children().find('span').text('默认');
				$("#SSHkey_s1").data('value', default_id);
				$("#SSHkey_s1").children().find('span').text('默认');
			}
			$(".xSelect-show").css({ "background": "white" });
		}

		function repeat_select() {
			$("#screensize").select2('destroy');
			$("#sel_client").select2('destroy');
			$("#sel_mfs").select2('destroy');
			$("#screensize").select2({ minimumResultsForSearch: -1 });
			$("#sel_client").select2({ minimumResultsForSearch: -1 });
			$("#sel_mfs").select2({ minimumResultsForSearch: -1 });
			$("#screensize").next('span').css("margin-bottom", "5px");
		}

		function get_pro_v(type) {
			var pro_data = [];
			var first_v = "";
			var first_id = 0;
			$.ajax({
				url: '/bhost/get_AccessProtocol_all_z',
				type: 'post',
				async: false,
				data: { a0: se },
				success: function (result) {
					pro_result = JSON.parse(result);
					$.each(pro_result.data, function (i, item) {
						if (i == 0) {
							first_v = item.ProtocolName;
							first_id = item.ProtocolId;
						}
						var select_json = { 'value': 0, 'name': '', 'type': null };
						select_json.value = item.ProtocolId;
						select_json.name = item.ProtocolName;
						pro_data.push(select_json);
					});
					if (type == 1) {
						clear_pro = 1;
					}
				}
			});
			$("#pro_select_div").empty().data('xSelect', "");
			$("#pro_select_div").xSelect({
				width: 88,
				defaultText: first_v,
				items: pro_data,
				module_type: "pro_sel_div",
				setval: function (item, obj) {
					change_pro(obj);
				}
			});
			$("#pro_select_div").data('value', first_id);

			if (global_data.IsTunnel) {
				$(".passageway").hide();
			} else {
				if (first_v == "SYBASE" && $(".local_client").find('input').prop('checked')) {
					$("#passageway_select").empty().append('<option value="2">访问通道</option>');
				} else {
					$("#passageway_select").empty().append('<option value="1">端口访问</option>');
				}
				//$(".passageway").show();
			}
			change_pro();
		}

		function appoint_change(obj) {
			if ($(obj).val() == "SID") {
				$('.oracle:eq(1)').children('.label').text('实例名：');
			} else {
				$('.oracle:eq(1)').children('.label').text('服务名：');
			}
		}

		function connect_pro() {
			if (quick_link == 0 && auth_strategy != "" && auth_strategy.AuthLevel != 1 && auth_strategy.EnableWorkOrderApprove) {
				_alert(1, "收藏夹", "工单未授权链接");
				return false;
			}
			var HostAccessCfg = {
				"UserCode": "test3",
				"ServerIP": "192.168.0.53",
				"ProtocolName": "ORACLE",
				"SessionId": "6363408954018973473",
				"ServerUser": "ora",
				"ServerPort": 1521,
				"ServiceName": "",
				"ConnMode": "",
				"ConnParam": "",
				"ConnParamId": "",
				"ExePath": null,
				"Pwd": "945da2c4d0",
				"ClientName": "",
				"SSHType": null,
				"RDPScreen": "0",
				"RDPClipboard": null,
				"RDPDiskMap": null,
				"RDPDiskMapList": null,
				"ConnParamName": null,
				"ConnModeName": null,
				"AppRelease": null,
				"AppChannel": null,
				"ConnWay": null
			}

			if (ajax_over == 0) {
				return false;
			}
			var encrypt_pwd;
			var decrypt_pwd;
			var encrypt_flag = 0;
			var pwd_flag = 0;
			//var ssh_sftp_flag = 0;
			if (quick_link == 1) {
				var pro_name = $("#pro_select_div").find('span').text();
				var port = $("#port_input").val();
				var ip = $(".ip_div").find('input').val();
				var user = $(".user_div").find('input').val();
				var pwd = "";
				key_cont = "";
				key_psp = "";
				key_name = "";
				if ($('.pwd').is(':visible')) {
					pwd = $(".pwd_div").find('input').val();
				} else {
					if ($("#SSHkey_s1").data('value') == undefined) {
						_alert(1, "收藏夹", "请选择密钥");
						return false;
					}
					key_name = $("#SSHkey_s1").find('span').text();
					$.ajax({
						url: '/bhost/get_sshkey_u',
						type: 'post',
						async: false,
						data: { a0: se, a1: $("#SSHkey_s1").data('value') },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								if (result.info.totalrow != 0) {
									key_cont = result.info.data[0].KeyContent;
									key_psp = result.info.data[0].Password;
								} else {
									if ($("#SSHkey_s1").find('span').text() == "默认") {
										//管理员托管的秘钥有可能不是当前用户创建的 所以，上面的函数取不到秘钥的信息，要用下面的函数取
										$.ajax({
											url: '/bhost/get_sshkey_u_plus',
											type: 'post',
											async: false,
											data: { a0: se, a1: $("#SSHkey_s1").data('value') },
											success: function (result) {
												var result = JSON.parse(result);
												if (result.Result) {
													if (result.info.totalrow != 0) {
														key_cont = result.info.data[0].KeyContent;
														key_psp = result.info.data[0].Password;
													}
												}
											}
										})
									}
								}
							} else {
								_alert(1, "收藏夹", result.ErrMsg);
								return false;
							}
						}
					});
				}
				decrypt_pwd = pwd;
				if (pwd == "") {
					encrypt_pwd = pwd;
				} else {
					if (AutoPwd != pwd) {
						$.ajax({
							url: '/bhost/rc4_encrypt',
							type: 'post',
							async: false,
							data: { a0: se, z1: pwd },
							success: function (result) {
								var result = JSON.parse(result);
								if (result.Result) {
									encrypt_pwd = result.info;
								} else {
									_alert(1, "最近访问", result.info);
									return false;
								}
							}
						});
					} else {
						encrypt_pwd = pwd;
					}
				}
			} else {
				key_cont = "";
				key_name = "";
				if ($("#fList").find('a.prolink.active').length != 0) {
					var tr_index = $('a.prolink.active').parents('tr:first').index();
					//var a_index = $('a.prolink.active').index();
					var pro_name = GLOBAL_ProtocolName;
					var port = GLOBAL_Port;
					var ip = baseData[tr_index].HostIP;
				} else {
					//var a_index = $('a.prolink.active').index();
					var pro_name = GLOBAL_ProtocolName;
					var port = GLOBAL_Port;
					var ip = baseData[tr_click].HostIP;
				}
				if (anther_flag == 1) {
					var user = $(".user_div").find('input').val();
					var pwd = $(".pwd_div").find('input').val();
					if ($(".pwd_div").find('input').prop('disabled') == true) {//托管密码 不用加密
						encrypt_flag = 0;
					}else{
						encrypt_flag = 1;
					}
				} else {
					var user = $("#user_select").val();
					if ($('.label.pwd').is(':visible') == true) {//密码
						var pwd = $(".pwd_div").find('input:last').val();//未加密
						if (pwd == "") {
							pwd_flag = 1;
							encrypt_flag = 0;
						} else {
							if ($(".pwd_div").find('input').prop('disabled') == true) {//托管密码 不用加密
								encrypt_flag = 0;
							} else {
								encrypt_flag = 1;
							}
						}
						pwd_flag = 1;
					} else {//密钥
						if ($("#SSHkey_s1").data('value') == undefined) {
							_alert(1, "收藏夹", "请选择密钥");
							return false;
						}
						var key_name = $("#SSHkey_s1").find('span').text();
						$.ajax({
							url: '/bhost/get_sshkey_u',
							type: 'post',
							async: false,
							data: { a0: se, a1: $("#SSHkey_s1").data('value') },
							success: function (result) {
								var result = JSON.parse(result);
								if (result.Result) {
									if (result.info.totalrow != 0) {
										key_cont = result.info.data[0].KeyContent;
										key_psp = result.info.data[0].Password;
									} else {
										if ($("#SSHkey_s1").find('span').text() == "默认") {
											//管理员托管的秘钥有可能不是当前用户创建的 所以，上面的函数取不到秘钥的信息，要用下面的函数取
											$.ajax({
												url: '/bhost/get_sshkey_u_plus',
												type: 'post',
												async: false,
												data: { a0: se, a1: $("#SSHkey_s1").data('value') },
												success: function (result) {
													var result = JSON.parse(result);
													if (result.Result) {
														if (result.info.totalrow != 0) {
															key_cont = result.info.data[0].KeyContent;
															key_psp = result.info.data[0].Password;
														}
													}
												}
											})
										}
									}
								} else {
									_alert(1, "收藏夹", result.ErrMsg);
									return false;
								}
							}
						});
						var pwd = "";
						encrypt_flag = 1;
						pwd_flag = 0;
					}
				}

				if (encrypt_flag == 1) {
					decrypt_pwd = pwd;
					if (pwd == "") {
						encrypt_pwd = pwd;
					} else {
						$.ajax({
							url: '/bhost/rc4_encrypt',
							type: 'post',
							async: false,
							data: { a0: se, z1: pwd },
							success: function (result) {
								var result = JSON.parse(result);
								if (result.Result) {
									encrypt_pwd = result.info;
								} else {
									_alert(1, "收藏夹", result.info);
									return false;
								}
							}
						});
					}
				} else if (encrypt_flag == 0) {
					encrypt_pwd = pwd;
				}
			}

			if (user == "") {
				_alert(1, "收藏夹", "请输入用户", $(".user_div").find('input'));
				return false;
			}
			/*
			if (pwd == "" && global_data.IsTunnel){
				_alert(1,"收藏夹","请输入密码",$(".pwd_div").find('input'));
				return false;
			}
			
			if (pwd == "" && pwd_flag == 0){
				_alert(1,"收藏夹","请输入密码",$(".pwd_div").find('input'));
				return false;
			}
			*/
			if (ip == "") {
				_alert(1, "收藏夹", "请输入IP", $(".ip_div").find('input'));
				return false;
			}
			if (port == "") {
				_alert(1, "收藏夹", "请输入端口", $("#port_input"));
				return false;
			}
			if ($("#EnableRDPDiskMap").is(':visible') && $("#EnableRDPDiskMap").prop('checked')) {
				if ($('.disk_map').is(':visible') && $(".disk_map").find('input:checked').length == 0) {
					_alert(1, "收藏夹", "请选择硬盘");
					return false;
				}
			}
			HostAccessCfg.ConnParamId = ParamId;
			if ($(".local_client").find('input').prop('checked') || ($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked') && !$('.web_con').find('input').prop('checked'))) {//客户端
				var timestamp = new Date().getTime();
				var username = se + '@' + timestamp;
				var bhus = window.parent.parent.frm.us.value;
				var param_host = '{"name":"hostname","value":"127.0.0.1"}';
				if ($(".local_client").find('input').prop('checked')) {
					HostAccessCfg.ConnModeName = 'local_client';
				} if ($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked') == true) {
					HostAccessCfg.ConnModeName = 'local_client|mfs';
				}
				var json_data = {
					"BHUser": "", //堡垒机用户wen:xxx@root@192.168.0.83:22  base64加密
					"ServerUser": "",//服务器用户
					"ServerPassword": "", //rc4加密
					"BHIP": "",//堡垒机地址
					"ServerIP": "",//服务器地址
					"ServerPort": "",//服务器端口
					"ClientPath": "",//客户端全路径
					"ClientName": "",//客户端名称
					"Protocol": "",//协议名称
					"ServerName": "",//实例名、SID
					"ServerNameType": "",//实例名类型
					"ConnMode": "",//连接方式
					"title": "",
					"IsTunnel": "false",
					"MapPort": 0,
					"Port": 0,
					"screensize": "",
					"fullscreen": "true",
					"clip": "false",
					"diskmap": "false",
					"mapdisks": "",
					"AccAPP": "false",
					"RemoteApp": "false",
					"SshKeyName": "",
					"UrlIp": document_domain+ (location.port!=''?':'+location.port:''),
					"Sessid": se,
					"IfHiddenHostIP": "true"
				}
				if(HiddenFlag == true){
					json_data.IfHiddenHostIP = "true"
				}else{
					json_data.IfHiddenHostIP = "false"
				}
				var client_v = $("#sel_client").val();
				var client_text = $("#sel_client").children('option:selected').text();
				var path_input = "";
				if ($(".local_client").find('input').prop('checked') && ($(".mfs").find('input').prop('checked') == false || !$(".mfs").is(":visible"))) {//本地客户端
					if (client_text.indexOf('未设置') != -1) {
						//_alert(1,"收藏夹","该客户端路径未设置");
						parent.client_module_show(client_v);
						return false;
					} else {
						// yt 2018 0817 
						var flag_client = false;
						$.each(path_array, function (i, item) {
							if (flag_client == true) return true;
							if (item.ClientName == client_v && item.ClientPath != null) {
								path_input = item.ClientProgram;
								flag_client = true
								return false;
							}
							if (item.ClientName == client_v) {
								path_input = item.ClientProgram;
							}
						});
						//
					}
					json_data.AccAPP = "false";
					path_input = path_input.replace(/\\/g, "\\\\\\\\");
					if (($("#passageway_select").val() == 2 || IsTunnel == "true") && (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11")) {
						client_v = "";
					}
				} else {//本地mstsc 
					client_v = "";
					/*
					json_data.AccAPP = "true";
					if ($("#sel_mfs").val() == 0){
						_alert(1,"收藏夹","请选择应用发布");
						return false;
					}
					*/
				}

				if (($("#ApplicationChannel").is(':visible') && $("#ApplicationChannel").prop('checked')) || (IsAcc == 1) || ($("#EnableCFG").is(":visible") && $(".mfs").find('input').prop('checked'))) {	
					json_data.AccAPP = "true";
				}
				if($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked')){
					json_data.AccAPP = "true";
				}
				if (json_data.AccAPP == "true" && pro_name != "RDP") {
					if ($("#sel_mfs").val() == 0) {
						_alert(1, "收藏夹", "请选择应用发布");
						return false;
					}
				}

				//var path_input = $("#path_input").val();

				var cur_domain = document.domain;
				var cmd_str;
				if (IsTunnel == "false") {
					if ($("#passageway_select").val() == 1) {
						IsTunnel = 'false';
					} else {
						IsTunnel = 'true';
					}
				}
				json_data.BHUser = window.parent.parent.frm.us.value;
				json_data.IsTunnel = IsTunnel;
				json_data.MapPort = MapPort;

				if ($(".local_client").find('input').prop('checked') && (!$("#EnableCFG").is(':visible') || !$("#EnableCFG").prop('checked'))) {
					HostAccessCfg.ClientName = client_v;
				} else if (($("#EnableCFG").prop('checked') && $("#EnableCFG").is(':visible'))) {
					HostAccessCfg.ClientName = $("#sel_mfs").val();
					if(HostAccessCfg.ClientName == 0){
						HostAccessCfg.ClientName = "MSTSC";
					}					
				} else {
					HostAccessCfg.ClientName = "";
				}
				if(pro_name == "RDP" || pro_name == "X11"){
					HostAccessCfg.ClientName = 'default';
				}
				json_data.ClientName = HostAccessCfg.ClientName;

				if (pro_name == "ORACLE") {
					var connmode = $("#oracle_auth_select").val();
					var servertype = $("#appoint").val();
					var ServerName = $("#oracle_input").val();
					var bhuser = window.parent.parent.frm.us.value;
					json_data.BHUser = bhuser;
					json_data.ConnMode = connmode;
					json_data.ServerNameType = servertype;
					json_data.ServerName = ServerName;
					if (client_v == "sqlldr") {
						var ctl_input = $("#ctl_input").val();
						if (ctl_input == "") {
							_alert(1, "收藏夹", "请填写路径", $("#ctl_input"));
							return false;
						}
						json_data.title = ctl_input.replace(/\\/g, "\\\\\\\\");
						HostAccessCfg.ExePath = ctl_input;
					}
				} else if (pro_name == "DB2") {
					json_data.ServerName = $("#db2_input").val();
				} else if (pro_name == "SYBASE") {
					json_data.ServerName = $("#sysbase_input").val();
					if (client_v == "isqlw") {
						var ctl_input = $("#ctl_sysbase_input").val();
						json_data.title = ctl_input.replace(/\\/g, "\\\\\\\\");
						HostAccessCfg.ExePath = ctl_input;
					}
				} else if (pro_name == "MYSQL") {
					json_data.ServerName = $(".mysql").find('input').val();
				} else if (pro_name == "HTTP(S)" || pro_name == "HTTPS") {
					json_data.ServerName = $("#http_url").val();
					var http_account = $("#http_account").val();
					var http_pwd = $("#http_pwd").val();
					var http_submit = $("#http_submit").val();
					json_data.ConnMode = http_account + '|' + http_pwd + '|' + http_submit;
				} else if (pro_name == "RADMIN") {
					json_data.ConnMode = $("#radmin_auth_select").val();
				} else if (pro_name == "MSSQL") {
					json_data.ServerName = $(".mssql:first").find('input').val();
					json_data.ConnMode = $("#mssql_auth").val();
				} else if (pro_name == "RDP") {
					json_data.ConnMode = $("#access_select").val();

					if (IsAcc == 0) {
						json_data.ClientName = "default";
					} else if (($("#ApplicationChannel").is(":visible") && $("#ApplicationChannel").prop('checked')) || IsAcc == 1) {
						json_data.ClientName = "mstsc";
					} else {
						json_data.ClientName = "";
					}
				} else if (pro_name == "SSH") {
					json_data.ServerName = $("#access_select").val();
				}

				if (remote_data != null && remote_data.EnableRemoteApp) {
					json_data.RemoteApp = "true";
				} else {
					json_data.RemoteApp = "false";
				}
				if ($('.mfs').find('input').prop('checked') || pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11") {
					json_data.screensize = $("#screensize").val();
					json_data.clip = $("#EnableRDPClipboard").prop('checked') + '';
					if ($("#EnableRDPDiskMap").is(':visible')) {
						json_data.diskmap = $("#EnableRDPDiskMap").prop('checked') + '';
					} else {
						json_data.diskmap = "false";
					}
					var mapdisks = "";
					if (json_data.diskmap == "true") {
						$('.disk_map').find('input:checked').each(function (i, item) {
							mapdisks = mapdisks + $(item).parents('label:first').text() + '|';
						})
						if (mapdisks != "") {
							mapdisks = mapdisks.substring(0, mapdisks.length - 1);
						}
					}

					json_data.mapdisks = mapdisks;
					HostAccessCfg.RDPDiskMapList = mapdisks;
				}
				var pro_name_temp = pro_name;
				if (pro_name_temp == "SFTP") {
					pro_name_temp = "SSH";
				}
				/*
				if (ssh_sftp_flag == 1){
					pro_name_temp = "SSH";
				}
				*/
				if ($(".local_client").find('input').prop('checked') && (!$("#EnableCFG").is(':visible') || !$("#EnableCFG").prop('checked'))) {//客户端
					if (client_v == "Putty") {
						json_data.ServerPassword = "en::" + encrypt_pwd;
					} else {
						//json_data.BHUser = window.parent.parent.frm.us.value;
						json_data.ServerPort = port;
						if (pro_name != "ORACLE") {
							if (pro_name != "SYBASE") {
								if (pro_name == "DB2" || pro_name == "MYSQL") {
									json_data.ServerPassword = encrypt_pwd;
								} else {
									json_data.ServerPassword = "en::" + encrypt_pwd;
								}
							} else {
								json_data.ServerPassword = encrypt_pwd;//sybase本地客户端只能访问通道
							}
						} else {
							if (client_v == "PowerBuilder") {
								json_data.ServerPassword = "en::" + encrypt_pwd;
							} else {
								if (json_data.IsTunnel == "true") {//oracle 访问通道密加密码不用加en::
									json_data.ServerPassword = encrypt_pwd;
								} else {
									/*$.ajax({
										url:'/bhost/rc4_decrypt',
										type:'post',
										async:false,
										data:{a0:se,z1:pwd},
										success:function(result){
											var result = JSON.parse(result);
											if (result.Result){
												//pwd = result.info;
												decrypt_pwd = result.info;
											}else{
												_alert(1,"收藏夹",result.info);
												return false;
											}
										}
									});*/
									json_data.ServerPassword = encrypt_pwd;
								}
							}
						}
					}
				} else {//（前置机 本地）
					if ($("#EnableRDPClipboard").prop('checked')) {
						var RDP_Select = 1;
					} else {
						var RDP_Select = 0;
					}
					if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')) {
						var DiskMap = 1
					} else {
						var DiskMap = 0
					}
					json_data.ServerPassword = encrypt_pwd + ':' + RDP_Select + ':' + DiskMap;
					if ($('.mfs').find('input').prop('checked')) {
						pro_name_temp = "RDP";
					}
				}

				if (pro_name == "VNC" || pro_name == "X11" || pro_name == "RDP") {
					if ($("#EnableRDPClipboard").prop('checked')) {
						var RDP_Select = 1;
					} else {
						var RDP_Select = 0;
					}
					if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')) {
						var DiskMap = 1
					} else {
						var DiskMap = 0
					}
					json_data.ServerPassword = encrypt_pwd + ':' + RDP_Select + ':' + DiskMap;
				}

				if (pwd == "" || json_data.ServerPassword == "en::") {
					$.ajax({
						url: '/bhost/rc4_encrypt',
						type: 'post',
						async: false,
						data: { a0: se, z1: '-' },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								encrypt_pwd1 = result.info;
							} else {
								_alert(1, "收藏夹", result.info);
								return false;
							}
						}
					});
					json_data.ServerPassword = encrypt_pwd1;
				}
				json_data.Port = port;
				if (key_name == "默认" || key_name == " ") {
					key_name = "=";
					check_v = 3;
				} else {
					check_v = 4;
				}
				json_data.SshKeyName = key_name;
				var get_module_flag = 0;
				$.ajax({
					url: '/bhost/module_app_set_list',
					type: 'post',
					async: false,
					data: { a0: se },
					success: function (result) {
						var re_result = JSON.parse(result);
						$.each(re_result.data, function (i, item) {
							if (pro_name_temp == "SSH") {
								if (item.ApplicationName.indexOf(pro_name_temp) != -1) {
									get_module_flag = 1;
									json_data.ServerPort = item.ServicePort;
								}
							} else {
								if (item.ApplicationName.indexOf("菜单") === -1 && item.ApplicationName.indexOf(pro_name_temp) != -1) {
									param_port = '{"name":"port","value":"' + item.ServicePort + '"}';
									get_module_flag = 1;
									json_data.ServerPort = item.ServicePort;
									return false;
								}
							}
						});
						if (get_module_flag == 0) {
							$.each(re_result.data, function (i, item) {
								if (item.ApplicationName.indexOf(pro_name_temp) != -1) {
									json_data.ServerPort = item.ServicePort;
									param_port = '{"name":"port","value":"' + item.ServicePort + '"}';
									json_data.Port = item.ServicePort;
									return false;
								} else {
									param_port = '{"name":"port","value":"' + port + '"}';
									json_data.Port = item.ServicePort;
								}
							});
						}
					}
				});

				HostAccessCfg.UserCode = window.parent.parent.frm.us.value;
				HostAccessCfg.ServerIP = ip;
				/*
				if (ssh_sftp_flag == 1){
					HostAccessCfg.ProtocolName = "SSH";
				}else{
					HostAccessCfg.ProtocolName = pro_name;
				}
				*/
				HostAccessCfg.ProtocolName = pro_name;
				HostAccessCfg.SessionId = se;
				HostAccessCfg.ServerUser = user;
				HostAccessCfg.ServerPort = port;
				if (key_cont == "") {
					if ($(".authmode_div").find('input:checked').attr('value') == 2) {
						if (key_name == "") {
							key_name = "默认";
						}
						var key_pwd_tmp = "pkey\\t1\\t" + key_name;
						$.ajax({
							url: '/bhost/rc4_encrypt',
							type: 'post',
							async: false,
							data: { a0: se, z1: key_pwd_tmp },
							success: function (result) {
								var result = JSON.parse(result);
								if (result.Result) {
									key_pwd_tmp = result.info;
								} else {
									_alert(1, "收藏夹", result.info);
									return false;
								}
							}
						});
						HostAccessCfg.Pwd = key_pwd_tmp;
					} else {
						HostAccessCfg.Pwd = encrypt_pwd;
					}
				} else {
					if (check_v == 3) {
						var keytype = 1;
					} else if (check_v == 4) {
						var keytype = 2;
					} else if (check_v == 5) {
						var keytype = 2;
					}
					var key_pwd_tmp = "pkey\\t" + keytype + "\\t" + key_name;
					$.ajax({
						url: '/bhost/rc4_encrypt',
						type: 'post',
						async: false,
						data: { a0: se, z1: key_pwd_tmp },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								key_pwd_tmp = result.info;
							} else {
								_alert(1, "收藏夹", result.info);
								return false;
							}
						}
					});
					HostAccessCfg.Pwd = key_pwd_tmp;
				}
				HostAccessCfg.SSHType = $("#access_select").val();

				if ($("#ApplicationChannel").is(":visible") && $("#ApplicationChannel").prop('checked')) {
					HostAccessCfg.AppChannel = 'true';
				} else if ($("#ApplicationChannel").is(":visible") && !$("#ApplicationChannel").prop('checked')) {
					HostAccessCfg.AppChannel = 'false';
				}
				if ($("#EnableRDPClipboard").prop('checked')) {
					HostAccessCfg.RDPClipboard = true;
				} else {
					HostAccessCfg.RDPClipboard = false;
				}
				HostAccessCfg.RDPScreen = $("#screensize").val();
				if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')) {
					HostAccessCfg.RDPDiskMap = true;
				} else {
					HostAccessCfg.RDPDiskMap = false;
				}
				if (HostAccessCfg.RDPScreen == 0) {
					var nwidth = 0;
					var nheight = 0;
				} else if (HostAccessCfg.RDPScreen == 1) {
					var nwidth = 1;
					var nheight = 1;
					if (pro_name == "X11") {
						var nwidth = window.screen.width;
						var nheight = window.screen.height;
					}
				} else {
					var nwidth = HostAccessCfg.RDPScreen.split("*")[0];
					var nheight = HostAccessCfg.RDPScreen.split("*")[1];
				}

				var param_array = [];
				if (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11") {
					if (HostAccessCfg.RDPScreen != 0 && HostAccessCfg.RDPScreen != 1) {
						//var nwidth = HostAccessCfg.RDPScreen.split("*")[0];
						//var nheight = HostAccessCfg.RDPScreen.split("*")[1];
						var param_width = '{"name":"width","value":"' + nwidth + '"}';
						var param_height = '{"name":"height","value":"' + nheight + '"}';
						param_array.push(JSON.parse(param_width));
						param_array.push(JSON.parse(param_height));
					}
				}

				var param_array = [];
				var type_ver = "";
				if (get_module_flag == 1) {
					var param_username = '{"name":"username","value":"' + bhus + '@' + user.replace(/\\/g, "\\\\") + '@' + ip + ':' + port + ':' + pro_name + type_ver + '@h5"}';
				} else {
					var param_username = '{"name":"username","value":"' + bhus + '@' + user.replace(/\\/g, "\\\\") + '@' + ip + ':' + port + '@h5"}';
				}

				if (HostAccessCfg.RDPClipboard) {
					var RDP_Select = 1;
				} else {
					var RDP_Select = 0;
				}
				if (HostAccessCfg.RDPDiskMap) {
					var DiskMap = 1;
				} else {
					var DiskMap = 0;
				}
				if (pro_name == "VNC" || pro_name == "X11") {
					var param_username = '{"name":"username","value":"' + bhus + '@' + user.replace(/\\/g, "\\\\") + '@' + ip + ':' + port + ':' + pro_name + '@h5' + nwidth + '*' + nheight + '*' + RDP_Select + '*' + DiskMap + '"}';
				}
				var client_ip = window.parent.client_ip;
				var param_password = '{"name":"password","value":"' + client_ip + ':0@' + encrypt_pwd + '"}';
				/*param_array.push(JSON.parse(param_host));
				param_array.push(JSON.parse(param_port));
				param_array.push(JSON.parse(param_username));
				param_array.push(JSON.parse(param_password));*/
				// HostAccessCfg.ExePath = path_input;
				HostAccessCfg.ConnParam = json_data.ServerNameType;
				HostAccessCfg.ServiceName = json_data.ServerName;
				HostAccessCfg.ConnMode = json_data.ConnMode;

				//json_data.BHUser = window.parent.parent.frm.us.value;
				json_data.ServerUser = user;
				//json_data.ServerPassword = pwd;
				json_data.BHIP = document_domain;
				json_data.ServerIP = ip;
				//json_data.ServerPort = port;
				json_data.ClientPath = path_input;

				if ($(".local_client").find('input').prop('checked') && (!$("#EnableCFG").is(':visible') || !$("#EnableCFG").prop('checked'))) {
					HostAccessCfg.ClientName = client_v;
				} else if ($('#EnableCFG').prop('checked') && $("#EnableCFG").is(':visible')) {
					HostAccessCfg.ClientName = $("#sel_mfs").val();
					if(HostAccessCfg.ClientName == 0){
						HostAccessCfg.ClientName = "MSTSC";
					}					
				}
				if(pro_name == "RDP" || pro_name == "X11"){
					HostAccessCfg.ClientName = 'default';
				}
				//if ($("#passageway_select").is(":visible")) {
					HostAccessCfg.ConnWay = $('#passageway_select').val();
				//}
				if (pro_name == "SSH" || pro_name == "SFTP") {
					pro_name = "SSH" + $("#access_select").val();
				}
				if ($("#conn_select").is(":visible")) {
					HostAccessCfg.ConnParamName = $('#conn_select option:selected').text();
				}
				/*
				if (pro_name == "SSH" || ssh_sftp_flag == 1){
					pro_name = "SSH" + $("#access_select").val();
				}
				*/
				json_data.Protocol = pro_name;

				cmd_str = JSON.stringify(json_data);
				/*
				var evt = document.createEvent("CustomEvent");
				evt.initCustomEvent('LocalEvent', true, false, cmd_str);
				document.dispatchEvent(evt);
	
				*/
				var remark_json = {
					"PlanId": 0,
					"UserCode": "test3",
					"HostIP": "192.168.0.53",
					"HostName": "主机4Group",
					"PlanMsg": "testtt"
				}
				var remarktype = 0;
				if ($(".remark").is(":visible")) {
					save_remark(0);
					if (remark_flag == 1) {
						return false;
					}
				}
			} else if ($(".web_con").find('input').prop('checked')) {// H5（H5连前置机）
				var json_data = {
					"BHIP": "",//堡垒机地址
					"Port": "",
					"Protocol": "",//协议名称
					"screensize": "",
					"diskmap": "false",
					"mapdisks": "",
					"username": "",
					"H5Flag": 1,
					"UrlIp": document_domain+ (location.port!=''?':'+location.port:''),
					"Sessid": se,
					"IfHiddenHostIP": "true",
					"Password":"123456",
					"IsTunnel":"",
					"MapPort":""
				}
				json_data.IsTunnel = global_data.IsTunnel.toString();
				json_data.MapPort = global_data.MapPort;
				if(HiddenFlag == true){
					json_data.IfHiddenHostIP = "true"
				}else{
					json_data.IfHiddenHostIP = "false"
				}
				/*
				if (pwd == "" || pwd == null){
					_alert(1,"收藏夹","请输入密码",$(".pwd_div").find('input'));
					return false;
				}
				*/
				var bhus = window.parent.parent.frm.us.value;
				//var username = se + '@' + user + '@' + ip + ':' + port + ':' + pro_name;// + '@h5';
				var timestamp = new Date().getTime();
				var username = se + '@' + timestamp;

				var param_host = '{"name":"hostname","value":"127.0.0.1"}';
				var get_module_flag = 0;
				var param_port;


				HostAccessCfg.UserCode = bhus;
				HostAccessCfg.ServerIP = ip;
				json_data.BHIP = document_domain+ (location.port!=''?':'+location.port:'');
				HostAccessCfg.ProtocolName = pro_name;
				HostAccessCfg.SessionId = se;
				HostAccessCfg.ServerUser = user;
				HostAccessCfg.ServerPort = port;
				if (key_cont == "") {
					HostAccessCfg.Pwd = encrypt_pwd;
				} else {
					if (key_name == "默认" || key_name == " ") {
						check_v = 3;
					} else {
						check_v = 4;
					}
					if (check_v == 3) {
						var keytype = 1;
					} else if (check_v == 4) {
						var keytype = 2;
					} else if (check_v == 5) {
						var keytype = 2;
					}
					var key_pwd_tmp = "pkey\\t" + keytype + "\\t" + key_name;
					$.ajax({
						url: '/bhost/rc4_encrypt',
						type: 'post',
						async: false,
						data: { a0: se, z1: key_pwd_tmp },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								key_pwd_tmp = result.info;
							} else {
								_alert(1, "收藏夹", result.info);
								return false;
							}
						}
					});
					HostAccessCfg.Pwd = key_pwd_tmp;
				}

				if (pro_name == "ORACLE") {
					HostAccessCfg.ServiceName = $("#oracle_input").val();
					HostAccessCfg.ConnMode = $("#oracle_auth_select").val();
				} else if (pro_name == "DB2") {
					HostAccessCfg.ServiceName = $("#db2_input").val();
				} else if (pro_name == "MYSQL") {
					HostAccessCfg.ServiceName = $(".mysql").find('input').val();
				} else if (pro_name == "SYBASE") {
					HostAccessCfg.ServiceName = $("#sysbase_input").val();
				} else if (pro_name == "HTTP(S)" || pro_name == "HTTPS") {
					var http_account = $("#http_account").val();
					var http_pwd = $("#http_pwd").val();
					var http_submit = $("#http_submit").val();
					HostAccessCfg.ServiceName = $("#http_url").val();
					HostAccessCfg.ConnMode = http_account + '|' + http_pwd + '|' + http_submit;
				} else if (pro_name == "MSSQL") {
					HostAccessCfg.ServiceName = $(".mssql:first").find('input').val();
					HostAccessCfg.ConnMode = $("#mssql_auth").val();
				} else if (pro_name == "SSH") {
					HostAccessCfg.ServiceName = $("#access_select").val();
				} else if(pro_name == "RADMIN"){
					HostAccessCfg.ConnMode = $("#radmin_auth_select").val();
				} else{				
					HostAccessCfg.ConnMode = $("#access_select").val();
				}

				HostAccessCfg.SSHType = $("#access_select").val();
				HostAccessCfg.ConnModeName = 'web_con';
				if ($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked') == true) {
					HostAccessCfg.ConnModeName = 'web_con|mfs';
				}
				if ($("#EnableRDPClipboard").prop('checked')) {
					HostAccessCfg.RDPClipboard = true;
				} else {
					HostAccessCfg.RDPClipboard = false;
				}
				HostAccessCfg.RDPScreen = $("#screensize").val();
				json_data.screensize = $("#screensize").val();
				if ($("#EnableRDPDiskMap").is(':visible') && $("#EnableRDPDiskMap").prop('checked')) {
					HostAccessCfg.RDPDiskMap = true;
					var mapdisks = "";
					$('.disk_map').find('input:checked').each(function (i, item) {
						mapdisks = mapdisks + $(item).parents('label:first').text() + '|';
					})
					if (mapdisks != "") {
						mapdisks = mapdisks.substring(0, mapdisks.length - 1);
					}
					HostAccessCfg.RDPDiskMapList = mapdisks;
					json_data.diskmap = "true";
					json_data.mapdisks = mapdisks;
				} else {
					HostAccessCfg.RDPDiskMap = false;
					HostAccessCfg.RDPDiskMapList = "";
					json_data.diskmap = "false";
					json_data.mapdisks = "";
				}

				if (($("#ApplicationChannel").is(":visible") && $("#ApplicationChannel").prop('checked')) || IsAcc == 1) {
					HostAccessCfg.ClientName = "mstsc";//$("#sel_mfs").val();
				} else if (IsAcc == 0 || IsAcc == 2) {
					HostAccessCfg.ClientName = $("#sel_mfs").val();
					if($("#sel_mfs").text() == "无"){
						_alert(1,"最近访问","请选择应用发布");
						return false;
					}
					if(HostAccessCfg.ClientName == 0){
						HostAccessCfg.ClientName = "MSTSC";
					}					
				} else {
					HostAccessCfg.ClientName = "";
				}
				if(pro_name == "RDP" || pro_name == "X11" || (pro_name == "VNC" && !$("#EnableCFG").prop('checked'))){
					HostAccessCfg.ClientName = 'default';
				}
				if ($("#ApplicationChannel").is(":visible") && $("#ApplicationChannel").prop('checked')) {
					HostAccessCfg.AppChannel = 'true';
				} else if ($("#ApplicationChannel").is(":visible") && !$("#ApplicationChannel").prop('checked')) {
					HostAccessCfg.AppChannel = 'false';
				}
				//if ($("#passageway_select").is(":visible")) {
					HostAccessCfg.ConnWay = $('#passageway_select').val();
				//}
				if ($("#conn_select").is(":visible")) {
					HostAccessCfg.ConnParamName = $('#conn_select option:selected').text();
				}
				var get_rdp_mode = 0;
				$.ajax({
					url: '/bhost/module_app_set_list',
					type: 'post',
					async: false,
					data: { a0: se },
					success: function (result) {
						var re_result = JSON.parse(result);
						$.each(re_result.data, function (i, item) {
							if (item.ApplicationName.indexOf("菜单") != -1 && item.ApplicationName.indexOf(pro_name) != -1) {
								get_module_flag = 1;
								param_port = '{"name":"port","value":"' + item.ServicePort + '"}';
								json_data.Port = item.ServicePort;
								return false;
							}
						});
						if (get_module_flag == 0) {
							$.each(re_result.data, function (i, item) {
								if (item.ApplicationName.indexOf(pro_name) != -1) {
									param_port = '{"name":"port","value":"' + item.ServicePort + '"}';
									if (pro_name == 'RDP') {
										get_rdp_mode = item.Mode;
									}
									json_data.Port = item.ServicePort;
									return false;
								} else {
									param_port = '{"name":"port","value":"' + port + '"}';
									json_data.Port = item.ServicePort;
								}
							});
						}
					}
				});
				var type_ver = "";
				if (pro_name == "SSH") {
					type_ver = $("#access_select").val();
				}
				if (get_module_flag == 1) {
					var param_username = '{"name":"username","value":"' + bhus + '@' + user.replace(/\\/g, "\\\\") + '@' + ip + ':' + port + ':' + pro_name + type_ver + '@h5"}';
				} else {
					var param_username = '{"name":"username","value":"' + bhus + '@' + user.replace(/\\/g, "\\\\") + '@' + ip + ':' + port + '@h5"}';
				}

				if (HostAccessCfg.RDPScreen == 0) {
					var nwidth = 0;
					var nheight = 0;
				} else if (HostAccessCfg.RDPScreen == 1) {
					var nwidth = 1;
					var nheight = 1;
					if (pro_name == "X11") {
						var nwidth = window.screen.width;
						var nheight = window.screen.height;
					}
				} else {
					var nwidth = HostAccessCfg.RDPScreen.split("*")[0];
					var nheight = HostAccessCfg.RDPScreen.split("*")[1];
				}

				if (HostAccessCfg.RDPClipboard) {
					var RDP_Select = 1;
				} else {
					var RDP_Select = 0;
				}
				if (HostAccessCfg.RDPDiskMap) {
					var DiskMap = 1;
				} else {
					var DiskMap = 0;
				}
				if (pro_name == "VNC" || pro_name == "X11") {
					if ($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked') == true) {
						param_username = '{"name":"username","value":"' + bhus + '@' + user.replace(/\\/g, "\\\\") + '@' + ip + ':' + port + ':' + pro_name + '@h5' + nwidth + '*' + nheight + '*' + RDP_Select + '*' + DiskMap + '"}';
					} else {
						param_username = '{"name":"username","value":"' + bhus + '@' + user.replace(/\\/g, "\\\\") + '@' + ip + ':' + port + ':' + pro_name + '@h5' + nwidth + '*' + nheight + '*' + RDP_Select + '*' + DiskMap + '"}';
					}
				} else if (pro_name == "RDP") {
					if (get_rdp_mode == 1) {
						param_username = '{"name":"username","value":"' + user.replace(/\\/g, "\\\\") + '@' + ip + ':' + port + ':' + pro_name + '-' + $("#access_select").val() + '@h5' + nwidth + '*' + nheight + '*' + RDP_Select + '*' + DiskMap + '"}';
					} else {
						param_username = '{"name":"username","value":"' + bhus + '@' + user.replace(/\\/g, "\\\\") + '@' + ip + ':' + port + ':' + pro_name + '-' + $("#access_select").val() + '@h5' + nwidth + '*' + nheight + '*' + RDP_Select + '*' + DiskMap + '"}';
					}
					var param_username = '{"name":"username","value":"' + bhus + '@' + user.replace(/\\/g, "\\\\") + '@' + ip + ':' + port + ':' + pro_name + '-' + $("#access_select").val() + '@h5' + nwidth + '*' + nheight + '*' + RDP_Select + '*' + DiskMap + '"}';
				} else if ((pro_name == "SSH" || pro_name == "SFTP") && key_name != "") {
					if (key_name == " " || key_name == "默认") {
						param_username = '{"name":"username","value":"' + bhus + '@' + user + '@' + ip + ':' + port + ':' + pro_name + type_ver + '=@h5"}';
					} else {
						param_username = '{"name":"username","value":"' + bhus + '@' + user + '@' + ip + ':' + port + ':' + pro_name + type_ver + '=' + key_name + '@h5"}';
					}
				} else if ($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked') == true) {
					param_username = '{"name":"username","value":"' + bhus + '@' + user.replace(/\\/g, "\\\\") + '@' + ip + ':' + port + ':' + pro_name + '@h5' + nwidth + '*' + nheight + '*' + RDP_Select + '*' + DiskMap + '"}';
					//@h5width*height*is_need_clipboard*is_need_disc_map*sessionid*disk_mode*exepath*disc_num\tservName\tconnMode\tconnParam\texePath\t
				}
				var client_ip = window.parent.parent.client_ip;
				/*
				if((pro_name == "SSH" || pro_name == "SFTP") && ($("#SSHkey_s").is(":visible") || $("#SSHkey_s1").is(":visible"))){
					var param_password = '{"name":"password","value":"'+client_ip+':0@'+se+'"}';
				}else if((pro_name == "SSH" || pro_name == "SFTP") && $(".pwd_check_div").find('input:checked').attr('value') == 3){
						var param_password = '{"name":"password","value":"'+client_ip+':0@'+se+'"}';
				}else
				*/
				{
					if (encrypt_pwd == "") {
						encrypt_pwd = "-";
					}
					var param_password = '{"name":"password","value":"' + client_ip + ':0@' + encrypt_pwd + '"}';
				}
				var param_array = [];

				if (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11") {
					if (HostAccessCfg.RDPScreen != 0 && HostAccessCfg.RDPScreen != 1) {
						//var nwidth = HostAccessCfg.RDPScreen.split("*")[0]; 
						//var nheight = HostAccessCfg.RDPScreen.split("*")[1];
						var param_width = '{"name":"width","value":"' + nwidth + '"}';
						var param_height = '{"name":"height","value":"' + nheight + '"}';
						param_array.push(JSON.parse(param_width));
						param_array.push(JSON.parse(param_height));
					}
					if (pro_name == "X11" && HostAccessCfg.RDPScreen == 1) {
						var param_width = '{"name":"width","value":"' + nwidth + '"}';
						var param_height = '{"name":"height","value":"' + nheight + '"}';
						param_array.push(JSON.parse(param_width));
						param_array.push(JSON.parse(param_height));
					}
				}
				if (pro_name == "SSH") {
					var param_sftp = '{"name":"enable-sftp","value":"true"}';
					param_array.push(JSON.parse(param_sftp));
				}
				param_array.push(JSON.parse(param_host));
				param_array.push(JSON.parse(param_port));
				param_array.push(JSON.parse(param_username));
				param_array.push(JSON.parse(param_password));
				/*
				var url = location.href;
				url_array = url.split(":")
				var url_array1 = url_array.slice(0,2);
				var url_str = url_array1.join(":");
				*/
				var url_str = "https://" + document_domain + ':8443';
				if ($(".remark").is(":visible")) {
					save_remark(0);
					if (remark_flag == 1) {
						return false;
					}
				}
			}
			json_data.Password = JSON.parse(param_password).value;	

			check_cilent = false;
			var save_flag = 0;
			var save_flag_s = 0;//1修改了密码（秘钥）提示保存
			//0未修改 不用提示保存 18-8-13
			if (global_data.IsRemindSaveUser == 0) {//提示
				if (key_name == '=') {
					key_name_s = '默认';
				} else {
					key_name_s = key_name;
				}

				if ((key_name_s == S_PWD.sshname && S_PWD.sshname != "") || ($(".group.pwd.ctr").is(':visible') && $(".group.pwd.ctr").find('input').val() == S_PWD.enpwd && S_PWD.enpwd != "")) {
					save_flag_s = 0;
				} else {
					if (AutoPwd == "" || AutoPwd != $(".group.pwd.ctr").find('input').val()) {
						save_flag_s = 1;
					}
				}

				if (save_flag_s == 1) {
					parent.layer.open({
						type: 1,
						title: "收藏夹",
						content: '<div class="layer-alert"><i class="alert warning"></i>是否保存</div>',
						btn: ['确&nbsp;&nbsp;定', '取&nbsp;&nbsp;消'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						btn1: function (i) {
							parent.layer.close(i);
							if ($(".web_con").find('input').prop('checked')) {
								var sesstimet = (new Date()).valueOf();
								json_data['sesstimet'] = sesstimet;
								$.ajax({
									url: "/bhost/get_token_remote",
									type: "POST",
									async: false,
									data: { a0: se, z1: JSON.stringify(param_array), z2: ip, z3: pro_name, z4: username, z5: pwd, z6: url_str, z7: user, z8: JSON.stringify(HostAccessCfg), z9: 1, z10: HostAccessCfg.RDPDiskMap, z12: JSON.stringify(json_data),m1:mac },
									success: function (result) {
										var result = JSON.parse(result);
										var url_addr = 'https://' + document_domain + ':8443/bhremote/?token=' + result.authToken;
										//window.open(url_addr);
										if (HostAccessCfg.RDPDiskMap) {
											if (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11" || HostAccessCfg.RDPDiskMap == true) {
												
												if (result.Flag == 1) {
													json_data.username = result.UserName.substring(0, result.UserName.length - 1) + 2;
													window.open('https://' + window_location_host + '/bhost/test_html?se={{se}}&z1=' + JSON.stringify(json_data));
												} else {
													//window.location.href = 'bhost://cmd&' + result.CmdSet;
													get_regedit('bhost', se,'',sesstimet);
													$('#YuFrame1').remove();
													$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
													$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result.CmdSet);
													
													_showLoading_client('正在启动客户端，请稍后');
												
													var c = 0;		
													var if_ok_down_other = setInterval(function(){													
														if(check_cilent == true){
															window.open(url_addr);
															clearInterval(if_ok_down_other);
															_closeLoading_client();
															return 0;				
														}
														if(c >=10){
															clearInterval(if_ok_down_other);	
															_closeLoading_client();
															return 0;
														}			
														c = c + 1;				
													},500)
													
												}
											}
										}else{
											window.open(url_addr);
										}
									}
								});
							} else {
								var sesstimet = (new Date()).valueOf();
								var c = JSON.parse(cmd_str)
								c['sesstimet'] = ''+sesstimet;
								cmd_str =JSON.stringify(c);
								var msstr = aceg(JSON.stringify(HostAccessCfg),se);
								$.ajax({
									url: '/bhost/Save_HostAccessCfg',
									type: 'post',
									async: false,
									data: { a0: se, z1: JSON.stringify(HostAccessCfg), z2: JSON.stringify(remark_json), z3: 1, z4: cmd_str, m1:msstr,m2:mac},
									success: function (result) {
										var save_result = JSON.parse(result);
										if (save_result.Result) {
											
											if (save_result.Flag == 1) {
												window.open('https://' + window_location_host + '/bhost/test_html?se={{se}}&z1=' + cmd_str);
											} else {
												//window.location.href = 'bhost://cmd&' + save_result.CmdSet;
												get_regedit('bhost', se,'',sesstimet);
												$('#YuFrame1').remove();
												$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
												$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+save_result.CmdSet);
											}
										} else {
											_alert(1, "收藏夹", save_result.ErrMsg);
											return false;
										}
									}
								});
							}
						},
						btn2: function (i) {
							parent.layer.close(i);
							//HostAccessCfg.Pwd = null;
							if ($(".web_con").find('input').prop('checked')) {
								var sesstimet = (new Date()).valueOf();
								json_data['sesstimet'] = sesstimet;
								$.ajax({
									url: "/bhost/get_token_remote",
									type: "POST",
									async: false,
									data: { a0: se, z1: JSON.stringify(param_array), z2: ip, z3: pro_name, z4: username, z5: pwd, z6: url_str, z7: user, z8: JSON.stringify(HostAccessCfg), z9: 0, z10: HostAccessCfg.RDPDiskMap, z12: JSON.stringify(json_data),m1:mac },
									success: function (result) {
										var result = JSON.parse(result);
										var url_addr = 'https://' + document_domain + ':8443/bhremote/?token=' + result.authToken;
										//window.open(url_addr);
										if (HostAccessCfg.RDPDiskMap) {
											if (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11" || HostAccessCfg.RDPDiskMap == true) {
												
												if (result.Flag == 1) {
													json_data.username = result.UserName.substring(0, result.UserName.length - 1) + 2;
													window.open('https://' + window_location_host + '/bhost/test_html?se={{se}}&z1=' + JSON.stringify(json_data));
												} else {
													//window.location.href = 'bhost://cmd&' + result.CmdSet;
													get_regedit('bhost', se,'',sesstimet);
													$('#YuFrame1').remove();
													$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
													$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result.CmdSet);
													
													_showLoading_client('正在启动客户端，请稍后');
												
													var c = 0;		
													var if_ok_down_other = setInterval(function(){													
														if(check_cilent == true){
															window.open(url_addr);
															clearInterval(if_ok_down_other);
															_closeLoading_client();
															return 0;				
														}
														if(c >=10){
															clearInterval(if_ok_down_other);	
															_closeLoading_client();
															return 0;
														}			
														c = c + 1;				
													},500)
													
												}
											}
										}else{
											window.open(url_addr);
										}
									}
								});
							} else {
								var sesstimet = (new Date()).valueOf();
								var c = JSON.parse(cmd_str)
								c['sesstimet'] = ''+sesstimet;
								cmd_str =JSON.stringify(c);
								var msstr = aceg(JSON.stringify(HostAccessCfg),se);
								$.ajax({
									url: '/bhost/Save_HostAccessCfg',
									type: 'post',
									async: false,
									data: { a0: se, z1: JSON.stringify(HostAccessCfg), z2: JSON.stringify(remark_json), z3: 0, z4: cmd_str, m1:msstr,m2:mac},
									success: function (result) {
										var save_result = JSON.parse(result);
										if (save_result.Result) {
											
											if (save_result.Flag == 1) {
												window.open('https://' + window_location_host + '/bhost/test_html?se={{se}}&z1=' + cmd_str);
											} else {
												//window.location.href = 'bhost://cmd&' + save_result.CmdSet;
												get_regedit('bhost', se,'',sesstimet);
												$('#YuFrame1').remove();
												$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
												$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+save_result.CmdSet);
											}
										} else {
											_alert(1, "收藏夹", save_result.ErrMsg);
											return false;
										}
									}
								});
							}
						}
					})
				} else {//和不保存一样 (btn2)
					if ($(".web_con").find('input').prop('checked')) {
						var sesstimet = (new Date()).valueOf();
						json_data['sesstimet'] = sesstimet;
						$.ajax({
							url: "/bhost/get_token_remote",
							type: "POST",
							async: false,
							data: { a0: se, z1: JSON.stringify(param_array), z2: ip, z3: pro_name, z4: username, z5: pwd, z6: url_str, z7: user, z8: JSON.stringify(HostAccessCfg), z9: 0, z10: HostAccessCfg.RDPDiskMap, z12: JSON.stringify(json_data),m1:mac },
							success: function (result) {
								var result = JSON.parse(result);
								var url_addr = 'https://' + document_domain + ':8443/bhremote/?token=' + result.authToken;
								//window.open(url_addr);
								if (HostAccessCfg.RDPDiskMap) {
									if (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11" || HostAccessCfg.RDPDiskMap == true) {
										
										if (result.Flag == 1) {
											json_data.username = result.UserName.substring(0, result.UserName.length - 1) + 2;
											window.open('https://' + window_location_host + '/bhost/test_html?se={{se}}&z1=' + JSON.stringify(json_data));
										} else {
											//window.location.href = 'bhost://cmd&' + result.CmdSet;
											get_regedit('bhost', se,'',sesstimet);
											$('#YuFrame1').remove();
											$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
											$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result.CmdSet);
											_showLoading_client('正在启动客户端，请稍后');
												
											var c = 0;		
											var if_ok_down_other = setInterval(function(){													
												if(check_cilent == true){
													window.open(url_addr);
													clearInterval(if_ok_down_other);
													_closeLoading_client();
													return 0;				
												}
												if(c >=10){
													clearInterval(if_ok_down_other);	
													_closeLoading_client();
													return 0;
												}			
												c = c + 1;				
											},500)
										}
									}
								}else{
											window.open(url_addr);
										}
							}
						});
					} else {
						var sesstimet = (new Date()).valueOf();
						var c = JSON.parse(cmd_str);
						c['sesstimet'] = ''+sesstimet;
						cmd_str =JSON.stringify(c);
						var msstr = aceg(JSON.stringify(HostAccessCfg),se);
						$.ajax({
							url: '/bhost/Save_HostAccessCfg',
							type: 'post',
							async: false,
							data: { a0: se, z1: JSON.stringify(HostAccessCfg), z2: JSON.stringify(remark_json), z3: 0, z4: cmd_str, m1:msstr,m2:mac},
							success: function (result) {
								var save_result = JSON.parse(result);
								if (save_result.Result) {
									
									if (save_result.Flag == 1) {
										window.open('https://' + window_location_host + '/bhost/test_html?se={{se}}&z1=' + cmd_str);
									} else {
										//window.location.href = 'bhost://cmd&' + save_result.CmdSet;
										get_regedit('bhost', se,'',sesstimet);
										$('#YuFrame1').remove();
										$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
										$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+save_result.CmdSet);
									}
								} else {
									_alert(1, "收藏夹", save_result.ErrMsg);
									return false;
								}
							}
						});
					}
				}
			} else if (global_data.IsRemindSaveUser == 1) {
				save_flag = 1;
			} else if (global_data.IsRemindSaveUser == 2) {
				save_flag = 2;
				//HostAccessCfg.Pwd = null;
			}
			if (save_flag != 0) {
				if ($(".web_con").find('input').prop('checked')) {
					var sesstimet = (new Date()).valueOf();
					json_data['sesstimet'] = sesstimet;
					$.ajax({
						url: "/bhost/get_token_remote",
						type: "POST",
						async: false,
						data: { a0: se, z1: JSON.stringify(param_array), z2: ip, z3: pro_name, z4: username, z5: pwd, z6: url_str, z7: user, z8: JSON.stringify(HostAccessCfg), z9: save_flag, z10: HostAccessCfg.RDPDiskMap, z12: JSON.stringify(json_data),m1:mac },
						success: function (result) {
							var result = JSON.parse(result);
							var url_addr = 'https://' + document_domain + ':8443/bhremote/?token=' + result.authToken;
							//window.open(url_addr);
							if (HostAccessCfg.RDPDiskMap) {
								if (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11" || HostAccessCfg.RDPDiskMap == true) {
									
									if (result.Flag == 1) {
										json_data.username = result.UserName.substring(0, result.UserName.length - 1) + 2;
										window.open('https://' + window_location_host + '/bhost/test_html?se={{se}}&z1=' + JSON.stringify(json_data));
									} else {
										//window.location.href = 'bhost://cmd&' + result.CmdSet;
										get_regedit('bhost', se,'',sesstimet);
										$('#YuFrame1').remove();
										$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
										$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result.CmdSet);
										_showLoading_client('正在启动客户端，请稍后');
												
										var c = 0;		
										var if_ok_down_other = setInterval(function(){													
											if(check_cilent == true){
												window.open(url_addr);
												clearInterval(if_ok_down_other);
												_closeLoading_client();
												return 0;				
											}
											if(c >=10){
												clearInterval(if_ok_down_other);	
												_closeLoading_client();
												return 0;
											}			
											c = c + 1;				
										},500)
									}
								}
							}else{
											window.open(url_addr);
										}
						}
					});
				} else {
					var sesstimet = (new Date()).valueOf();
					var c = JSON.parse(cmd_str)
					c['sesstimet'] = ''+sesstimet;
					cmd_str =JSON.stringify(c);
					var msstr = aceg(JSON.stringify(HostAccessCfg),se);
					$.ajax({
						url: '/bhost/Save_HostAccessCfg',
						type: 'post',
						async: false,
						data: { a0: se, z1: JSON.stringify(HostAccessCfg), z2: JSON.stringify(remark_json), z3: save_flag, z4: cmd_str, m1:msstr,m2:mac},
						success: function (result) {
							var save_result = JSON.parse(result);
							if (save_result.Result) {
								
								if (save_result.Flag == 1) {
									window.open('https://' + window_location_host + '/bhost/test_html?se={{se}}&z1=' + cmd_str);
								} else {
									get_regedit('bhost', se,'',sesstimet);
									$('#YuFrame1').remove();
									$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
									$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+save_result.CmdSet);
								}
							} else {
								_alert(1, "收藏夹", save_result.ErrMsg);
								return false;
							}
						}
					});
				}
			}
		}

		var remark_flag = 0;
		function save_remark(type) {
			var remark_json = {
				"PlanId": 0,
				"UserCode": "test3",
				"HostIP": "192.168.0.53",
				"HostName": "主机4Group",
				"PlanMsg": "testtt"
			}

			if (quick_link == 1) {
				var ip = $(".ip_div").find('input').val();
				if (ip == "") {
					remark_flag = 1;
					_alert(1, "收藏夹", "请输入IP", $(".ip_div").find('input'));
					return false;
				}
				var HostName = ip;
				get_plan(ip);
			} else {
				if ($("#fList").find('a.prolink.active').length != 0) {
					var tr_index = $('a.prolink.active').parents('tr:first').index();
					var ip = baseData[tr_index].HostIP;
					var HostName = baseData[tr_index].HostName;
				} else {
					var ip = baseData[tr_click].HostIP;
					var HostName = baseData[tr_click].HostName;
				}
			}
			remark_json.PlanId = planid;
			remark_json.UserCode = window.parent.parent.frm.us.value;
			remark_json.HostIP = ip;
			remark_json.HostName = HostName;
			if (type == 1) {
				var remark_v = $("#remark_input").val();
				if (remark_v == "") {
					remark_flag = 1;
					_alert(1, "收藏夹", "备注不能为空", $("#remark_input"));
					return false;
				}
				remark_json.PlanMsg = remark_v;
			} else {
				var remark_v = $("#operation_content", parent.document).val();
				if (remark_v == "") {
					remark_flag = 1;
					_alert(1, "收藏夹", "备注不能为空", $("#operation_content", parent.document));
					return false;
				}
				remark_json.PlanMsg = remark_v;
			}

			//remark_json.PlanMsg = $("#operation_content",parent.document).val();

			var msstr = aceg(JSON.stringify(remark_json),se);
			$.ajax({
				url: '/bhost/save_remark',
				type: 'post',
				async: false,
				data: { a0: se, z1: JSON.stringify(remark_json), m1:msstr},
				success: function (result) {
					var remark_re = JSON.parse(result);
					if (remark_re.Result) {
						remark_flag = 0;
						_alert(0, "备注", "提交成功");
					} else {
						remark_flag = 1;
						_alert(0, "备注", "提交失败");
					}
				}
			})
		}

		var planid = 0;
		var planmsg = "";
		function get_plan(hostip) {
			$.ajax({
				url: '/bhost/get_plan',
				type: 'post',
				async: false,
				data: { a0: se, z1: hostip },
				success: function (result) {
					var plan_result = JSON.parse(result);
					if (plan_result.data.length != 0) {
						//$("#remark_input").val(plan_result.data[0].PlanMsg);
						planid = plan_result.data[0].PlanId;
						planmsg = plan_result.data[0].PlanMsg;
					} else {
						//$("#remark_input").val('');
						planmsg = "";
						planid = 0;
					}
				}
			})
		}
		var connparm_list;
		function change_pro(obj) {
			if (clear_pro == 1) {
				$("#protocolLink").find('input[type=text]').val('').prop('disabled', false);
				$("#protocolLink").find('input[type=password]').val('').prop('disabled', false);
				$("#protocolLink").find('input[type=checkbox]').iCheck('uncheck');
				$("#protocolLink").find('select').prop('disabled', false);
				$("#protocolLink").find('select').each(function () {
					$(this).children('option:first').prop('selected', true).trigger('change');
				});
				clear_pro = 0;
			}
			//clear_link();
			var flag = 0;
			var type = $("#pro_select_div").find('span').text();
			var sel_id = $("#pro_select_div").data('value');
			$(".pwd_auth").find('input').iCheck('uncheck');
			$(".pwd_auth").find('input').iCheck('check');
			$(".group.pwd.ctr").find("input").val("");
			//var type = $(obj).children('option:selected').text();
			//var sel_id = $(obj).val();
			$.each(pro_result.data, function (i, item) {
				if (sel_id == item.ProtocolId) {
					$("#port_input").val(item.Port);
				}
			});
			$('.pl-c').children('div').not(".ip_div,.user_div,.pwd_div,.pro_div,.ssh_div").hide();
			//$(".remark").show();
			if (global_data.IfGiveAccessInfo && quick_link == 1){	
				$(".remark").show();
			}else{
				$(".remark").hide();
			}
			if (global_data.IsTunnel) {
				$(".passageway").hide();
			} else {
				if (type == "SYBASE" && $(".local_client").find('input').prop('checked')) {
					$("#passageway_select").empty().append('<option value="2">访问通道</option>');
				} else {
					$("#passageway_select").empty().append('<option value="1">端口访问</option>');
				}
				//$(".passageway").show();
			}
			var acc_client_data;
			$.ajax({
				url: '/bhost/get_acc_client_list',
				type: "post",
				async: false,
				data: { a0: se, z4: "null", z5: "null", z6: '[]' },
				success: function (result) {
					acc_client_data = JSON.parse(result);
				}
			});

			//获取连接参数
			$.ajax({
				url: '/bhost/get_ConnParam_list',
				type: "post",
				async: false,
				cache: false,
				data: { a0: se, a1: sel_id },
				success: function (Result) {
					connparm_list = JSON.parse(Result);
				}
			});
			$("#ApplicationChannel").parents('label').hide();
			var default_proto = 0;
			switch (type) {
				case "OTHER":
					break;
				case "PCANY":
				case "APPROVAL":
				case "SYBASE":
				case "DB2":
				case "MSSQL":
				case "MYSQL":
				case "ORACLE":
				case "RADMIN":
					$(".pwd_div").show();
					$(".linkmode_div").show();
					$(".mfs_div").show();
					$(".screen_div").show();
					$(".mfs_divall").show();
					$(".mfs").show();
					$("#EnableCFG").iCheck('uncheck');
					//$("#EnableCFG").iCheck('check');
					$("#EnableRDPClipboard").parents('label').show();
					$("#ApplicationChannel").parents('label').hide();
					var option_str = "";
					flag = 0;
					if (type == "APPROVAL") {
						flag = 1;
						option_str = '<option value="0">无</option>';
					} else {
						$.each(acc_client_data.data, function (i, item) {
							if (item.ProtocolName == type) {
								option_str = option_str + '<option value="' + item.ClientName + '">' + item.ClientName + '</option>';
							}
						});
					}
					if (option_str == "") {
						flag = 1;
						option_str = '<option value="0">无</option>';
					}
					$("#sel_mfs").empty().append(option_str);
					if (flag == 0) {
						$("#sel_mfs").select2();
					}

					if (type == "SYBASE") {
						$(".conn").show();
						$(".sysbase").show();
						$(".local_client").show();
						$(".local_client").find('input').iCheck('uncheck');
						$(".local_client").find('input').iCheck('check');
						$(".web_con").hide();
						$(".item.mfs_div").hide();
						$(".screen_div").hide();
						$('#EnableRDPDiskMap').parents('label:first').show();
						if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')) {
							$('.disk_map').show();
						}
						bind_conn(connparm_list, type);
					} else if (type == "DB2") {
						$(".conn").show();
						$(".db2").show();
						$(".local_client").show();
						$(".local_client").find('input').iCheck('uncheck');
						$(".local_client").find('input').iCheck('check');
						$(".mfs_div").hide();
						$(".item.mfs_div").hide();
						$(".screen_div").hide();
						$(".web_con").hide();
						$('#EnableRDPDiskMap').parents('label:first').show();
						if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')) {
							$('.disk_map').show();
						}
						bind_conn(connparm_list, type);
					} else if (type == "MSSQL") {
						$(".conn").show();
						$(".mssql").show();
						$(".local_client").hide();
						$(".web_con").hide();
						$("#EnableRDPDiskMap").parents('label').show();
						if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')) {
							$('.disk_map').show();
						}
						bind_conn(connparm_list, type);
					} else if (type == "MYSQL") {
						$(".conn").show();
						$(".mysql").show();
						$(".mfs_divall").show();
						$(".mfs").show();
						$(".local_client").show();
						$(".local_client").find('input').iCheck('uncheck');
						$(".local_client").find('input').iCheck('check');
						$('.web_con').hide();
						$(".item.mfs_div").hide();
						$(".screen_div").hide();
						$("#EnableRDPDiskMap").parents('label').show();
						if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')) {
							$('.disk_map').show();
						}
						bind_conn(connparm_list, type);
					} else if (type == "RADMIN" || type == "PCANY") {
						$(".local_client").hide();
						$(".web_con").hide();
						$('#EnableRDPDiskMap').parents('label:first').show();
						if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')) {
							$('.disk_map').show();
						}
						if (type == "RADMIN") {
							$(".radmin").show();
							$(".conn").show();
							bind_conn(connparm_list, type);
						}
					} else if (type == "ORACLE") {
						$(".conn").show();
						$(".local_client").show();
						$(".local_client").find('input').iCheck('uncheck');
						$(".local_client").find('input').iCheck('check');
						$(".screen_div").hide();
						$(".web_con").hide();
						$(".oracle").show();
						$("#EnableRDPDiskMap").parents('label').show();
						if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')) {
							$('.disk_map').show();
						}
						bind_conn(connparm_list, type);
					} else {
						$(".local_client").show();
						$(".local_client").find('input').iCheck('uncheck');
						$(".local_client").find('input').iCheck('check');
						$(".web_con").hide();
					}
					//$(".mfs").find('input').iCheck('check');
					break;
				case "VNC":
					$(".pwd_div").show();
					$(".linkmode_div").show();
					$(".local_client").show();
					$(".local_client").find('input').iCheck('uncheck');
					$(".local_client").find('input').iCheck('check');
					$(".web_con").show();
					//$(".mfs").hide();
					$(".mfs_divall").show();
					$(".mfs").show();
					//$(".web_con").find('input').iCheck('uncheck');
					//$(".web_con").find('input').iCheck('check');
					$(".screen_div").show();
					$("#EnableRDPClipboard").parents('label').show();
					$("#EnableRDPDiskMap").parents('label').hide();
					$("#ApplicationChannel").parents('label').hide();
					option_str = "";
					flag = 0;
					$.each(acc_client_data.data, function (i, item) {
						if (item.ProtocolName == type) {
							option_str = option_str + '<option value="' + item.ClientName + '">' + item.ClientName + '</option>';
						}
					});
					if (option_str == "") {
						falg = 1;
						option_str = '<option value="0">无</option>';
					}
					$("#sel_mfs").empty().append(option_str);
					if (flag == 0) {
						$("#sel_mfs").select2();
					}
					break;
				case "RDP":
					$(".pwd_div").show();
					$(".sel_access").show();
					$(".linkmode_div").show();
					$(".mfs_divall").hide();
					$(".mfs").hide();
					$(".web_con").show();
					//$(".web_con").find('input').iCheck('uncheck');
					//$(".web_con").find('input').iCheck('check');
					$(".local_client").show();
					$(".local_client").find('input').iCheck('uncheck');
					$(".local_client").find('input').iCheck('check');
					$(".screen_div").show();
					$("#EnableRDPClipboard").parents('label').show();
					$("#EnableRDPDiskMap").parents('label').show();
					$("#ApplicationChannel").parents('label').show();
					$(".conn").show();
					option_str = '<option value="NORMAL" text="NORMAL">NORMAL</option><option value="CONSOLE" text="CONSOLE">CONSOLE</option>';
					$("#access_select").empty().append(option_str);
					bind_conn(connparm_list, type);
					break;
				case "FTP":
				case "SFTP":
					$('.authmode_div').show();
				case "TELNET":
				case "RLOGIN":
					$(".pwd_div").show();
					$(".linkmode_div").show();
					if (type == "FTP" || type == "SFTP") {
						$(".web_con").hide();
						//$(".local_client").find('input').iCheck('uncheck');
						//$(".local_client").find('input').iCheck('check');
						if (type == "SFTP") {
							$(".sel_access").show();
							option_str = '<option value="2">SSH2</option><option value="1">SSH1</option>';
							$("#access_select").empty().append(option_str);
						}
					} else {
						$(".web_con").show();
						//$(".web_con").find('input').iCheck('uncheck');
						//$(".web_con").find('input').iCheck('check');
					}

					$(".local_client").show();
					$(".local_client").find('input').iCheck('uncheck');
					$(".local_client").find('input').iCheck('check');
					$(".mfs_divall").hide();
					$(".mfs").hide();
					break;
				case "SSH":
					$(".pwd_div").show();
					$(".sel_access").show();
					$('.authmode_div').show();
					$(".linkmode_div").show();
					$(".mfs_divall").hide();
					$(".mfs").hide();
					$(".local_client").show();
					$(".local_client").find('input').iCheck('uncheck');
					$(".local_client").find('input').iCheck('check');
					$(".web_con").show();
					option_str = '<option value="2">SSH2</option><option value="1">SSH1</option>';
					$("#access_select").empty().append(option_str);					
					//$(".web_con").find('input').iCheck('uncheck');
					//$(".web_con").find('input').iCheck('check');
					$(".conn").show();
					bind_conn(connparm_list, type);
					break;
				case "NEW":
					break;
				case "HTTP(S)":
				case "HTTPS":
					$(".pwd_div").show();
					$(".linkmode_div").show();
					$(".web_con").hide();
					$(".local_client").hide();
					$(".mfs_divall").show();
					$(".mfs").show();
					$("#EnableCFG").iCheck('uncheck');
					//$("#EnableCFG").iCheck('check');
					$(".item.linkmode_div").hide();
					$(".screen_div").show();
					$(".mfs_div").show();
					$(".http").show();
					$(".conn").show();
					$('#EnableRDPDiskMap').parents('label:first').show();
					if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')) {
						$('.disk_map').show();
					}
					var option_str = "";
					flag = 0;
					$.each(acc_client_data.data, function (i, item) {
						if (item.ProtocolName == type) {
							flag = 1;
							option_str = option_str + '<option value="' + item.ClientName + '">' + item.ClientName + '</option>';
						}
					});
					if (option_str == "") {
						option_str = '<option value="0">无</option>';
					}
					$("#sel_mfs").empty().append(option_str);
					if (flag == 1) {
						$("#sel_mfs").select2();
					}
					bind_conn(connparm_list, type);
					break;
				case "TN5250":
					$(".pwd_div").show();
					$(".linkmode_div").show();
					$(".web_con").show();
					$(".local_client").hide();
					$(".mfs_divall").hide();
					$(".mfs").hide();
					$(".web_con").find('input').iCheck('uncheck');
					$(".web_con").find('input').iCheck('check');
					break;
				case "X11":
					$(".pwd_div").show();
					$(".linkmode_div").show();
					$(".local_client").show();
					$(".local_client").find('input').iCheck('uncheck');
					$(".local_client").find('input').iCheck('check');
					$(".mfs_divall").hide();
					$(".mfs").hide();
					$(".web_con").show();
					//$(".web_con").find('input').iCheck('uncheck');
					//$(".web_con").find('input').iCheck('check');
					$(".screen_div").show();
					$("#EnableRDPClipboard").parents('label').show();
					$("#EnableRDPDiskMap").parents('label').hide();
					$("#ApplicationChannel").parents('label').hide();
					break;
				default:
					$(".ip_div").show();
					$(".sel_user").show();
					$(".user_div").show();
					$(".pwd_div").show();
					//$(".pro_div").show();
					$(".linkmode_div").show();
					$(".local_client").show();
					$(".local_client").find('input').iCheck('uncheck');
					$(".local_client").find('input').iCheck('check');
					$(".web_con").hide();
					$(".mfs_divall").show();
					$(".mfs").show().attr('disabled',true);
					//$(".mfs").find('input').iCheck('check');
					$(".mfs_div").show();
					$(".screen_div").show();
					$("#EnableCFG").iCheck('uncheck');
					$("#EnableCFG").iCheck('check');
					$("#EnableCFG").attr('disabled',true);
					$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked disabled');
					$(".local_client").show();
					default_proto = 1;
					break;
			}
			if (quick_link == 1) {
				if(default_proto == 0){
					$("#EnableCFG").iCheck('uncheck');
				}
				$(".conn").hide();
			}
			if ($('.local_client').is(":visible") == false && $('.web_con').is(":visible") == false) {
				$("#EnableCFG").iCheck('check');
				$("#EnableCFG").attr('disabled', true);
				$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked disabled');
				$(".linkmode_div").show();
				$(".local_client").show();
				$(".web_con").show();
			} else {
				if(default_proto == 0){
					$("#EnableCFG").attr('disabled', false);
					class_tmp = $("#EnableCFG").parent().attr('class');
					if(class_tmp.indexOf('checked') == -1){
						$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue');
					}else{
						$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked');
					}
				}
			}
		}

		function clear_conn(type) {
			var id1 = $("#conn_select").val();
			var name1 = $("#conn_select").children('option:selected').text();
			var pid_tmp = $("#conn_select").children('option:selected').attr('pid');
			if (type == 1) {
				var option_str = '<option pid="0" value=\"-1\">用户填写</option><option pid="' + pid_tmp + '" value="' + id1 + '" text="' + name1 + '">' + name1 + '</option>';
			} else {
				var option_str = '<option pid="' + pid_tmp + '" value="' + id1 + '" text="' + name1 + '">' + name1 + '</option>';
			}
			$("#conn_select").empty().append(option_str);
			$("#conn_select").val(id1).trigger('change');
		}

		function bind_conn(connparm_list, pro_name) {
			var option_str = "<option pid=\"0\" value=\"-1\">用户填写</option>";
			conn_array = [];

			//if(quick_link == 0){
			$.each(connparm_list.data, function (i, item) {
				conn_array.push(item);
				option_str = option_str + '<option pid="' + item.ConnParamId + '" value="' + i + '" text="' + item.ConnParamName + '">' + item.ConnParamName + '</option>';
			});
			//}

			$("#conn_select").empty().append(option_str);
			if (option_str != "<option pid=\"0\" value=\"-1\">用户填写</option>") {
				$("#conn_select").select2();
			}
			$("#conn_select").unbind().bind('change', function () {
				var conn_index = $("#conn_select").val();
				var conn_text = $("#conn_select").children('option:selected').text();
				$("#conn_select").next().find('.select2-selection__rendered').text(conn_text).attr('title', conn_text);
				switch (pro_name) {
					case "SYBASE":
						if (conn_index == -1) {
							$("#sysbase_input").val('');
						} else {
							$("#sysbase_input").val(conn_array[conn_index].ServiceName);
						}
						break;
					case "DB2":
						if (conn_index == -1) {
							$("#db2_input").val('');
						} else {
							$("#db2_input").val(conn_array[conn_index].ServiceName);
						}
						break;
					case "MSSQL":
						if (conn_index == -1) {
							$(".mssql").find('input:first').val('');
							$("#mssql_auth").val('SQL服务器验证').trigger('change');
						} else {
							$(".mssql").find('input:first').val(conn_array[conn_index].ServiceName);
							if (conn_array[conn_index].ConnType != null) {
								$("#mssql_auth").val(conn_array[conn_index].ConnType).trigger('change');
							} else {
								$("#mssql_auth").val('SQL服务器验证').trigger('change');
							}
						}
						break;
					case "RADMIN":
						if (conn_index == -1) {
							$("#radmin_auth_select").val('RADMIN').trigger('change');
						} else {
							if (conn_array[conn_index].ConnType != null) {
								$("#radmin_auth_select").val(conn_array[conn_index].ConnType).trigger('change').attr('disabled', true);
							} else {
								$("#radmin_auth_select").val('RADMIN').trigger('change').attr('disabled', false);
							}
						}
						break;
					case "MYSQL":
						if (conn_index == -1) {
							$(".mysql").find('input:first').val('');
							$("#mysql_version").val('0').trigger('change');
						} else {
							$(".mysql").find('input:first').val(conn_array[conn_index].ServiceName);
							$("#mysql_version").val(conn_array[conn_index].ConnType).trigger('change');
						}
						break;
					case "ORACLE":
						if (conn_index == -1) {
							$("#appoint").val('SID').trigger('change');
							$("#oracle_input").val('');
							$("#oracle_auth_select").val('NORMAL').trigger('change');
							$(".oracle").find('input').attr('disabled', false);
							$("#appoint").attr('disabled', false);
							$("#oracle_auth_select").attr('disabled', false);
							$("#passageway_select").attr('disabled', false);
						} else {
							$("#appoint").val(conn_array[conn_index].ConnParamValue).trigger('change');
							$("#oracle_input").val(conn_array[conn_index].ServiceName);
							$(".oracle").find('input').attr('disabled', true);
							$("#appoint").attr('disabled', true);
							$("#passageway_select").attr('disabled', true);
							if (conn_array[conn_index].ConnType != null) {
								$("#oracle_auth_select").val(conn_array[conn_index].ConnType).trigger('change').attr('disabled', true);
							} else {
								$("#oracle_auth_select").val('NORMAL').trigger('change').attr('disabled', false);
							}
						}
						break;
					case "RDP":
						/*if (conn_index == -1) {
							$("#access_select").empty().append('<option value="NORMAL">NORMAL</option><option value="CONSOLE">CONSOLE</option>');
						} else {
							$("#access_select").empty().append('<option value="' + conn_array[conn_index].ConnType + '">' + conn_array[conn_index].ConnType + '</option>');
						}*/
						break;
					case "SSH":
						/*if (conn_index == -1) {
							$("#access_select").empty().append('<option value="2">SSH2</option><option value="1">SSH1</option>');
						} else {
							$("#access_select").empty().append('<option value="' + conn_array[conn_index].ServiceName + '">' + conn_array[conn_index].ServiceName + '</option>');
						}*/
						break;
					case "HTTP(S)":
					case "HTTPS":
						if (conn_index == -1) {
							$('.http').find('input').val('');
							$('.http').find('input').attr('disabled', false);
						} else {
							var conn_value = conn_array[conn_index].ConnParamValue.split('|');
							$('.http').find('input').attr('disabled', true);
							$("#http_url").val(conn_array[conn_index].ServiceName);
							$("#http_account").val(conn_value[0]);
							$("#http_pwd").val(conn_value[1]);
							$("#http_submit").val(conn_value[2]);
						}
						break;
					default:
						;
				}
			});
			$("#conn_select").trigger('change');
		}

		function get_msg() {
			var n = 0;
			$.ajax({
				url: '/bhost/get_msg',
				type: "post",
				async: false,
				data: { a0: se },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result == false) {
						if (result.info.indexOf('系统异常') >= 0 || result.info.indexOf('非法访问') >= 0 || result.info.indexOf('系统超时') >= 0) {
							_alert(2, '系统', result.info);
						} else {
							_alert(2, '系统', result.info);
						}
					}
					else {
					}
				}
			})
			if (n) return false;
		}

		var fid = "{{fid}}";
		var se = "{{se}}";
		var baseData;
		var service_array_all = [];
		var ajax_flag = 0;
		var ajax_num = 0;
		var HiddenFlag = true;
		function _initList() {
			window.parent.show_Loading();
			var data_json = {
				"loginusercode": "",
				"favoriteid": 0,
				"limitrow": null,
				"offsetrow": null,
				"HostIP": "",
				"HostName": "",
				"ProtocolName": "",
				"searchstring": ""
			}
			if (fid != "") {
				data_json.favoriteid = fid;
				data_json.loginusercode = window.parent.parent.document.frm.us.value;
			}
			var $tb = $('#fList').empty();
			var max_page = $("#page_total").text();
			var page = $("#curpage").val();
			data_json.limitrow = max_page;
			data_json.offsetrow = (parseInt(page) - 1) * parseInt(max_page);
			if (keyword_re.length > 0) {
				var ip = "";
				var hname = "";
				var pname = "";
				var seach_str = "";
				$.each(keyword_re, function (i, item) {
					var type = item.substring(0, 1);
					var data = item.substring(2);
					if (type == "1") {//all
						seach_str = seach_str + data + '\n';
					} else if (type == "2") {//主机名
						hname = hname + data + '\n';
					} else if (type == "3") {//主机IP
						ip = ip + data + '\n';
					} else if (type == "4") {//协议
						pname = pname + data + '\n';
					}
				});
				if (seach_str != null) {
					data_json.searchstring = seach_str.substring(0, seach_str.length - 1);
				}
				if (pname != null) {
					data_json.ProtocolName = pname.substring(0, pname.length - 1);
				}
				if (hname != null) {
					data_json.HostName = hname.substring(0, hname.length - 1);
				}
				if (ip != null) {
					data_json.HostIP = ip.substring(0, ip.length - 1);
				}
			}
			/*
			if (keyword_re.length > 1){
				data_json.searchstring = keyword_re.join('\n');
			}else if (keyword_re.length == 1){
				data_json.searchstring = keyword_re[0];
			}else{
				data_json.searchstring = "";
			}
			*/

			$.ajax({
				url: '/bhost/PGetHost_ByFavorite',
				type: 'post',
				async: true,
				data: { a0: se, z1: JSON.stringify(data_json) },
				success: function (result) {
					var host_result = JSON.parse(result);
					baseData = host_result.data;
					//var tr_str = "";
					if (host_result.data.length == 0) {
						window.parent.close_Loading();
					}
					if (host_result.data.length != 0) {
						//window.parent.show_Loading();
					} else if (keyword_re.length > 0) {
						_alert(0, "收藏夹", "无搜索结果", $("#keyword"));
					}

					ajax_flag = 0;
					ajax_num = 0;
					ajax_num = host_result.data.length;
					baseData = host_result.data
					$.each(host_result.data, function (i, item) {
						var tr_str = "";
						if (global_data.IfHiddenHostIP) {
							HiddenFlag = true;
							tr_str = tr_str + '<tr><td title="' + item.DeviceTypeIcon + '"><i class="host-type host-type' + json_icon[item.DeviceTypeIcon] + '" /><span class="forip" title="' + item.HostName + '">' + item.HostName + '</span></td><td id="type" style="padding: 0 18px;white-space: normal;">';
						} else {
							HiddenFlag = false;
							tr_str = tr_str + '<tr><td title="' + item.DeviceTypeIcon + '"><i class="host-type host-type' + json_icon[item.DeviceTypeIcon] + '" /><span title="' + item.HostIP + '" class="forip">' + item.HostIP + '</span><span title="' + item.HostName + '"> - ' + item.HostName + '</span></td><td id="type" style="padding: 0 18px;white-space: normal;">';
						}
						var Description = "";
						if (item.Description != null) {
							Description = item.Description;
						}
						tr_str = tr_str + '<td title="' + Description + '">' + Description + '</td>';
						tr_str = tr_str + '<td style="text-align:center"><a href="javascript:;" class="addFav on" onclick="_setColl(this,' + item.HGId + ',' + item.HostId + ',\'' + item.HostName + '\')" title="取消收藏"></a></td></tr>';
						$tb.append(tr_str);
						// ajax_num++;
						var $td = $("#fList").children('tr:eq(' + i + ')').children('td:eq(1)');
						var td_str = "";
						$.ajax({
							url: '/bhost/Get_AuthObjectByLevel',
							type: 'post',
							async: true,
							data: { a0: se, z1: item.HGId, z2: item.HostIP },
							success: function (result) {
								var hostservice_array = JSON.parse(result);
								service_array_all[i] = new Array();
								service_array_all[i] = hostservice_array.data.slice(0);
								var $td = $("#fList").children('tr:eq(' + i + ')').children('td:eq(1)');
								var td_str = "";
								var numi1 = 0;
								var pro_arr = [];
								var proto_arr = [];
								var td_str_arr = [];
								td_str_arr.push('<div style="max-width:364px">');
								$.each(service_array_all[i], function (i1, item1) {
									var HostServiceName = item1.ProtocolName + item1.Port;
									if ($.inArray(HostServiceName, pro_arr) < 0) {
										if (numi1 < 6) {
											var array_index = i + '-' + i1;
											if ($.inArray(item1.ProtocolName, proto_arr) < 0) {
												HostServiceName = item1.ProtocolName;
											}
											td_str_arr.push('<a style="width: 66px;text-align: center;text-overflow: ellipsis;overflow: hidden" title="' + HostServiceName + '" protocol="' + item1.ProtocolName + '" class="prolink" href="javascript:;" onclick="_getProLink(this,\'' + item.HostIP + '\',\'' + array_index + '\',' + item.HGId + ')" ondblclick="_dblclick(this,\'' + item.HostIP + '\',\'' + array_index + '\',' + item.HGId + ')">' + HostServiceName + '</a>');
											pro_arr.push(item1.ProtocolName + item1.Port);
											proto_arr.push(item1.ProtocolName);
											numi1++;
										}
										else if (numi1 == 6) {
											td_str_arr.push('<a style="margin-top: -45px;right: 20px;" class="morelink" href="javascript:;" onclick="_getAllProtocol(this,' + i + ',' + item.HGId + ')" title="全部协议">+</a></td>');
											return false;
										}
									}
								});
								td_str_arr.push('</div>');
								td_str = td_str_arr.join('');
								$td.append(td_str);
								ajax_flag++;
								if (ajax_flag == ajax_num) {
									window.parent.close_Loading();
								}
							}
						})
					});
					// window.parent.close_Loading();
					//$tb.append(tr_str);
					var page_total = $("#page_total").text();
					$("#host_total").text(host_result.totalrow);
					var totalpage = Math.ceil(parseInt(host_result.totalrow) / parseInt(page_total));
					if (totalpage < 1) {
						totalpage = 1;
					}
					$("#totalpage").text(totalpage);
					_waitDone($(".waitTip"));
					//$("#keyword").focus();
					if (_permissions == 1) {
						$(".addFav").css({ "cursor": "default" });
					}
				}
			});
		}

		var initwidth;
		function _width() {
			initwidth = $(".mainer").width();
		}

		//all protocol
		var prolayer;
		var tr_click;
		function _getAllProtocol(obj, i, hgid) {
			tr_click = i;
			var $_obj = $(obj);
			var aIndex;
			if ($_obj.siblings().hasClass("active")) {
				aIndex = $("a.active").index();
			}
			var num = $("#active").parents("tr").index();
			if (num == i) {
				aIndex = $("a.active").index();
				if ($("#ProtocolWrap").attr("aIndex") != undefined) {
					aIndex = $("#ProtocolWrap").attr("aIndex");
				}
			}

			$(".layui-layer").removeClass("none").addClass("block");
			var data = service_array_all[i];
			if ($('#ProtocolWrap').length == 0) {
				$('body').append('<div id="ProtocolWrap" />');
			}

			$('#ProtocolWrap').empty();
			var tr_index = $(obj).parents('tr').index();
			var $pw = $('#ProtocolWrap');
			//var hostip = baseData[i].HostIP;
			var pro_arr = [];
			var proto_arr = [];
			$.each(data, function (i1, item1) {
				var HostServiceName = item1.ProtocolName + item1.Port;
				if ($.inArray(HostServiceName, pro_arr) < 0) {
					var array_index = i + '-' + i1;
					var a_class = "";
					if (i1 == aIndex) {
						a_class = 'active';
					}
					if ($.inArray(item1.ProtocolName, proto_arr) < 0) {
						HostServiceName = item1.ProtocolName;
					}
					$pw.append('<a style="width: 66px;text-align: center;text-overflow: ellipsis;overflow: hidden" title="' + HostServiceName + '" class="prolink ' + a_class + '" protocol="' + item1.ProtocolName + '" href="javascript:;" onclick="_getProLink(this,\'' + baseData[i].HostIP + '\',\'' + array_index + '\',' + hgid + ')"  ondblclick="_dblclick(this,\'' + baseData[i].HostIP + '\',\'' + array_index + '\',' + hgid + ')">' + HostServiceName + '</a>');
					pro_arr.push(item1.ProtocolName + item1.Port);
					proto_arr.push(item1.ProtocolName);
				}

			});

			var offset = $(obj).parent().offset();
			var changewidth = $(".mainer").width();
			if (initwidth != changewidth) {
				$(".layui-layer").css({ "left": offset.left, "top": offset.top });
			} else if (initwidth == changewidth) {
				$(".layui-layer").css({ "left": offset.left, "top": offset.top });
			}
			prolayer = layer.open({
				type: 1,
				title: false,
				content: $pw,
				area: '340px',
				offset: [offset.top, offset.left],
				closeBtn: false,
				btn: false,
				shade: false,
				resize: false,
				move: false,
				anim: 5
			});

			$(document).unbind().on('click', function (e) {
				var $a = $(e.target);
				var $p = $a.parents('#ProtocolWrap');
				var $pl = $a.parents("#protocolLink");
				var $tr = $("tr").eq(i + 1);

				if ($p.length == 0 && $a.attr('class') != 'morelink' && $a.attr('id') != 'ProtocolWrap' && $pl.length == 0) {
					//layer.close(prolayer);
					layer.closeAll('page');
					if ($("#ProtocolWrap").children("a.prolink").hasClass("active")) {
						aIndex = $("a.active").index();
						var $moreLink = $tr.children("td#type").children("a.morelink");
						var $type = $tr.children("td#type").children("a.prolink");
						if (aIndex <= 5) {
							$("a.morelink").removeAttr("id");
							$type.eq(aIndex).addClass("active");
							$moreLink.css({ "background": "", "border-color": "", "color": "" });
						} else {
							$moreLink.css({ "background": "#3291a8", "border-color": "#3291a8", "color": "#fff" });
							$("a.morelink").removeAttr("id");
							$moreLink.attr("id", "active");
							$pw.attr("aIndex", aIndex);
						}
					}
				}
			});
		}

		//get protocal
		var auth_strategy;
		var ajax_over = 0;
		var prolink_pro;
		var anther_flag = 0;
		var prolink_ip;
		var SSHkey_s1_length = 131;
		var IsAcc = 2;
		var auth_strategy_one = "";
		var GLOBAL_ProtocolName = "";
		var GLOBAL_Port = -1;		
		var S_PWD = {
			pwd: "",
			enpwd: "",
			sshname: ""
		}
		var clickTimer = null;
		var ParamId = null;
		function _getProLink(obj, hostip, index, hgid) {
			//yt 2018 1207
			layer.closeAll('page');
			
			if(clickTimer) {
				window.clearTimeout(clickTimer);
				clickTimer = null;
			}
			clickTimer = window.setTimeout(function(){
				if (service_array_all.length == 0) return false;
				$('.group.pwd.ctr').children('input').css({ "width": "160px" });
				SSHkey_s1_length = 169;
				prolink_ip = hostip;
				quick_link = 0;
				IsAcc = 0;
				$("a.morelink").removeAttr("id");
				$moreLink = $("a.morelink");
				$moreLink.css({ "background": "", "border-color": "", "color": "" });
				//$('a.prolink').removeClass('active');
				$("#user_select").unbind();
				$("#conn_select").unbind();
				//clear_link();
				$("#protocolLink").find('input[type=text]').val('').prop('disabled', false);
				$("#protocolLink").find('input[type=password]').val('').prop('disabled', false);
				//$("#protocolLink").find('input[type=checkbox]').not("#ApplicationChannel").iCheck('uncheck');
				$("#protocolLink").find('input[type=checkbox]').iCheck('uncheck');
				$("#protocolLink").find('select').prop('disabled', false);
				$("#protocolLink").find('select').not('#user_select,#conn_select').each(function () {
					$(this).children('option:first').prop('selected', true).trigger('change');
				});
				$('.pl-c').children('div').hide();
				$(".sel_user").show();
				//$('.remark').show();
				$('.btn.fp').hide();
				get_plan(hostip);
				$("#remark_input").val(planmsg);

				var array_index = index.split('-');
				//var ssh_sftp_flag = service_array_all[array_index[0]][array_index[1]].Flag;		
				var $p = $('#protocolLink');
				var pro_name = service_array_all[array_index[0]][array_index[1]].ProtocolName;
				var pro_port = service_array_all[array_index[0]][array_index[1]].Port;
				var pro_sername = service_array_all[array_index[0]][array_index[1]].ServiceName;
				var ConnType = service_array_all[array_index[0]][array_index[1]].ConnType;
				prolink_pro = pro_name;
				GLOBAL_ProtocolName = pro_name;
				GLOBAL_Port = pro_port;
				if (global_data.IsTunnel) {
					$(".passageway").hide();
				} else {
					if (pro_name == "SYBASE" && $(".local_client").find('input').prop('checked')) {
						$("#passageway_select").empty().append('<option value="2">访问通道</option>');
					} else {
						$("#passageway_select").empty().append('<option value="1">端口访问</option>');
					}
					//$(".passageway").show();
				}

				if ($(obj).hasClass('active')) {
					//
				} else {
					// if (service_array_all[array_index[0]][array_index[1]].HostServiceName != null) {
					// 	$('.pl-tit>span', $p).text(service_array_all[array_index[0]][array_index[1]].HostServiceName);
					// } else {
					// 	$('.pl-tit>span', $p).text(pro_name);
					// }

					$('.pl-tit>span', $p).text($(obj).text());
					$('.pl-tit>i', $p).attr('class', 'icon-' + pro_name);
					$('a.prolink').removeClass('active');
					$(obj).addClass('active');
				}
				//RLOGIN OTHER PCANY RADMIN VNC RDP SYBASE MSSQL MYSQL ORACLE FTP TELNET SFTP SSH NEW HTTP(S) HTTPS DB2 TN5250 X11
				$p.addClass('show');
				var tr_index = $(obj).parents('tr').index();
				var service_str = JSON.stringify(service_array_all[array_index[0]][array_index[1]]);
				/*
				if (ssh_sftp_flag == 1){
					var sftp_set = JSON.parse(JSON.stringify(service_array_all[array_index[0]][array_index[1]]));
					sftp_set.ProtocolName = "SSH";
					service_str = JSON.stringify(sftp_set);
				}
				*/
				//取用户时传所有
				//$("#user_select").select2("destroy");
				//$('#user_select').select2({minimumResultsForSearch: -1});

				var acc_client_data;
				$.ajax({
					url: '/bhost/get_acc_client_list',
					type: "post",
					async: false,
					data: { a0: se, z4: "null", z5: "null", z6: '[]' },
					success: function (result) {
						acc_client_data = JSON.parse(result);
					}
				});

				$.ajax({
					url: '/bhost/PGet_HostAccessCfg',
					type: 'post',
					async: false,
					data: { a0: se, z1: hostip, z2: pro_name },
					success: function (result) {
						HostCfgData = JSON.parse(result);
					}
				})

				ajax_over = 0;
				$("#user_select").unbind().bind('change', function () {
					var account_name = $(this).val();
					var account_type = $(this).children('option:selected').attr('data');
					var accountname = $(this).children('option:selected').text();
					var protoname = pro_name;
					ParamId = null;
					$('.item.pwd_div').find('input').attr('disabled', false);
					S_PWD = {
						pwd: "",
						enpwd: "",
						sshname: ""
					};
					bind_SSHkey_xSelect(hostip, protoname, account_name);
					var sshKey_ = false;
					var sshKeyid = null;
					$.each(SSHkeyData, function (i, item) {
						if (item.Type == 1) {
							sshKey_ = true;
							sshKeyid = item.SshKeyId;
							if (item.KeyName == '托管配置') {
								saved_sshkey = " ";
							} else {
								saved_sshkey = item.KeyName;
							}
							saved_sshkey_cont = item.KeyContent;
							saved_sshkey_pwd = item.Password;
						}
					})
					account_name = account_name.replace(/\\/g, '\\\\');
					var account_type = $(this).children('option:selected').attr('data');
					var accountname = $(this).children('option:selected').text();
					var protoname = pro_name;
					$(".pwd_check_div").find('input:last').val('');
					$('.pwd_div').show();
					if (account_name == '*') {
						$('.user_div').show();
						$('.pwd_div').show();
						$('.pwd_check_div').hide();
						anther_flag = 1;
						auth_strategy = "";
						$.ajax({
							url: '/bhost/Get_AuthObjectByLevel',
							type: 'post',
							async: false,
							data: { a0: se, z1: hgid, z2: hostip, z3: service_str, z4: '@', z5: account_type },
							/*
								用@：函数中的账号参数不能用* 
								所以随便传一个不能作为账号名的字符来匹配，如果用任意账号名结果可能会出现多个，无法区分。
							*/
							success: function (result) {
								auth_strategy = JSON.parse(result);
								auth_strategy_one = auth_strategy.data[0];
								auth_strategy = auth_strategy_one;
								if (protoname == "SSH" || protoname == "SFTP") {
									if (auth_strategy_one.PasswordType == 3) {
										$('.item.pwd_div').find('.pwd').hide();
										$('.item.pwd_div').find('.ssh').show();
										S_PWD = {
											pwd: "",
											enpwd: "",
											sshname: ""
										}
										if (sshKeyid != null) {
											$("#SSHkey_s1").data('value', sshKeyid);
											$("#SSHkey_s1").children().find('span').text('默认');
											S_PWD.sshname = '默认';
										}
									} else {
										$('.item.pwd_div').find('.pwd').show();
										$('.item.pwd_div').find('input').val('');
										$('.item.pwd_div').find('.ssh').hide();
										S_PWD = {
											pwd: "",
											enpwd: "",
											sshname: ""
										}
										if (auth_strategy_one.PasswordType == 1) {
											S_PWD.enpwd = auth_strategy_one.Password;
											$('.item.pwd_div').find('input').val(auth_strategy_one.Password);
											$('.item.pwd_div').find('input').attr('disabled', true);
										}
									}
								} else {
									$('.item.pwd_div').find('.pwd').show();
									$('.item.pwd_div').find('input').val('');
									$('.item.pwd_div').find('.ssh').hide();
									S_PWD = {
										pwd: "",
										enpwd: "",
										sshname: ""
									}
									if (auth_strategy_one.PasswordType == 1) {
										S_PWD.enpwd = auth_strategy_one.Password;
										$('.item.pwd_div').find('input').val(auth_strategy_one.Password);
										$('.item.pwd_div').find('input').attr('disabled', true);
									}
								}
							}
						})
						//$(".item.pwd_check_div").find('label:visible').eq(0).find('input').iCheck('check');
					} 
					else {
						anther_flag = 0;
						$('.user_div').hide();
						//$('.pwd_div').show();
						$('.authmode_div').hide();
						//取策略，这里是为了取账号密码 //传所有
						$.ajax({
							url: '/bhost/Get_AuthObjectByInput',
							type: 'post',
							async: false,
							data: { a0: se, z1: hostip, z2: protoname, z3: pro_port, z4: account_name, z5: pro_sername, z6:ConnType },
							success: function (result) {
								if(auth_strategy != ""){
									auth_strategy = JSON.parse(result);
									auth_strategy_one = auth_strategy;
									IsAcc = auth_strategy_one.IsAcc;
									if (IsAcc == 2) {
										$("#ApplicationChannel").parents('label').show();
									} else {
										$("#ApplicationChannel").parents('label').hide();
									}

									if (auth_strategy_one.EnableRDPClipboard > 0) {
										$("#EnableRDPClipboard").iCheck('check');
									} else {
										$("#EnableRDPClipboard").iCheck('uncheck');
									}
									if (auth_strategy_one.PasswordType == 0) {//由用户输入
										S_PWD = {
											pwd: "",
											enpwd: "",
											sshname: ""
										}
										$('.item.pwd_div').find('.pwd').show();
										$('.item.pwd_div').find('input').val('');
										$('.item.pwd_div').find('.ssh').hide();
									} else {
										if (auth_strategy_one.Password == "" && auth_strategy_one.PasswordType != 2) {
											$('.defined').hide();
											if (auth_strategy_one.PasswordType == 3) {
												$('.item.pwd_div').find('.pwd').hide();
												$('.item.pwd_div').find('.ssh').show();
												S_PWD = {
													pwd: "",
													enpwd: "",
													sshname: ""
												}
												if (sshKeyid != null) {
													$("#SSHkey_s1").data('value', sshKeyid);
													$("#SSHkey_s1").children().find('span').text('默认');
													S_PWD.sshname = '默认';
												}
											} else {
												S_PWD = {
													pwd: "",
													enpwd: "",
													sshname: ""
												}
												$('.item.pwd_div').find('.pwd').show();
												$('.item.pwd_div').find('input').val('');
												$('.item.pwd_div').find('.ssh').hide();
											}
										} else {
											$('.item.pwd_div').find('.pwd').show();
											$('.item.pwd_div').find('input').val('');
											$('.item.pwd_div').find('.ssh').hide();
											S_PWD = {
												pwd: "",
												enpwd: "",
												sshname: ""
											}
											if (auth_strategy_one.PasswordType == 1) {
												S_PWD.enpwd = auth_strategy_one.Password;
												$('.item.pwd_div').find('input').val(auth_strategy_one.Password);
												$('.item.pwd_div').find('input').attr('disabled', true);
											}else if(auth_strategy_one.PasswordType == 2){
												S_PWD.enpwd = "";
												$('.item.pwd_div').find('input').val("");
												$('.item.pwd_div').find('input').attr('disabled', true);
											}
										}
										// if(protoname == "SSH" || protoname == "SFTP"){
										// 	$(".div_sshkey").show();
										// 	if(auth_strategy_one.PasswordType == 3){
										// 		if(sshKeyid == null){
										// 			$(".defined.div_sshkey").hide();
										// 		}else{
										// 			$("#SSHkey_s").data('value',sshKeyid);
										// 			$("#SSHkey_s").children().find('span').text('默认');
										// 			$(".defined.div_sshkey").show();
										// 		}
										// 	}else{
										// 		$(".defined.div_sshkey").hide();
										// 	}
										// }else{
										// 	$(".div_sshkey").hide();
										// }

										//$(".pwd_div").hide();
										$('.authmode_div').hide();
									}
									if (auth_strategy_one.AuthLevel != 1 && auth_strategy_one.EnableWorkOrderApprove) {
										$('.pl-c').children('div:last').show();
									}
									$(".item.pwd_check_div").find('label:visible').eq(0).find('input').iCheck('check');
									ParamId = auth_strategy.ConnParamId;
								}
							}
						});
					}
					if (global_data.IfGiveAccessInfo || auth_strategy.EnableAccessInfo){
						$(".remark").show();
					}else{
						$(".remark").hide();
					}
					//去HostCfgData找是否有上一次连接配置
					if (HostCfgData.data.length != 0) {
						$.each(HostCfgData.data, function (i, item) {
							if (item.ServerUser == account_name) {
								$.each(pro_result.data, function (i1, item1) {
									if (protoname == item1.ProtocolName) {
										sel_id = item1.ProtocolId;
									}
								});
								$.ajax({
									url: '/bhost/get_ConnParam_list',
									type: "post",
									async: false,
									cache: false,
									data: { a0: se, a1: sel_id },
									success: function (Result) {
										connparm_list1 = JSON.parse(Result);
									}
								});
								if (auth_strategy.PasswordType == 0) {
									$.ajax({
										url: "/bhost/Get_AuthObjectByInput",
										type: 'post',
										async: true,
										data: { a0: se, z1: hostip, z2: protoname, z3: pro_port, z4: account_name, z5: item.ServiceName, z6:item.ConnType },
										success: function (result) {
											if (result != "") {
												var obj_json = JSON.parse(result);
												IsAcc = obj_json.IsAcc;
												if (IsAcc == 2) {
													$("#ApplicationChannel").parents('label').show();
												} else {
													$("#ApplicationChannel").parents('label').hide();
												}
												if (obj_json.PasswordType == 0 || obj_json.PasswordType == null) {//有密码、空密码
													if (item.Pwd != "") {
														save_pwd = item.Pwd;
														$.ajax({
															url: '/bhost/rc4_decrypt',
															type: 'post',
															async: false,
															data: { a0: se, z1: save_pwd },
															success: function (result) {
																var result = JSON.parse(result.replace(/	/g, "\\t"));
																if (result.Result) {
																	save_pwd = result.info;
																	save_pwd = save_pwd.replace(/	/g, "\\t")
																} else {
																	_alert(1, "收藏夹", result.info);
																	return false;
																}
															}
														});
													} else {
														save_pwd = "";
													}
													S_PWD.pwd = save_pwd;
													$('.item.pwd_div').find('input').val(save_pwd);
												}
											}
										}
									})
								}
								$("#EnableCFG").iCheck('uncheck');
								if(item.ConnModeName != null){
									$.each(item.ConnModeName.split('|'), function (i1, item1) {
										switch (item1) {
											case 'mfs':
												$("#EnableCFG").iCheck('uncheck');
												$("#EnableCFG").iCheck('check');
												if (item.ClientName == null || item.ClientName == "MSTSC") {
													$('#sel_mfs').val($('#sel_mfs').find('option').eq(0).val()).trigger('change');
												} else {
													$('#sel_mfs').val(item.ClientName).trigger('change');
												}
												break;
											default:
												break;
										}
									})
									$.each(item.ConnModeName.split('|'), function (i1, item1) {
										switch (item1) {
											case 'web_con':
												$(".web_con").find('input').iCheck('uncheck');
												$(".web_con").find('input').iCheck('check');
												break;
											case 'local_client':
												$(".web_con").find('input').iCheck('uncheck');
												$(".local_client").find('input').iCheck('check');
												if (protoname != 'RDP' && protoname != 'VNC' && protoname != 'X11') {
													$('#sel_client').val(item.ClientName).trigger('change');
												}
												break;
										}
									})	
								}
								/*
									防止 之前版本只选了应用发布 升级之后 回显后只勾选应用发布 而没选择Client或者web
								*/
								if($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked') == true && $(".linkmode_div").is(":visible") == true){
									if($(".linkmode_div").children('.group').find('input:checked:visible').length == 0){
										$(".linkmode_div").children('.group').find('input:visible').parent().click();
									}
								}
								/*
								*/
								if($("#EnableCFG").attr('disabled') != "disabled"){
									if($('.local_client').is(":visible") == false && $('.web_con').is(":visible") == false){
										$("#EnableCFG").iCheck('check');
										$("#EnableCFG").attr('disabled',true);
										$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked disabled');
										$(".linkmode_div").show();
										$(".local_client").show();
										$(".web_con").show();
									}else{
										$("#EnableCFG").attr('disabled',false);
										class_tmp = $("#EnableCFG").parent().attr('class');
										if(class_tmp.indexOf('checked') == -1){
											$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue');
										}else{
											$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked');
										}
									}
								}
								// if (auth_strategy.ServiceName == "" || auth_strategy.ServiceName == null) {
									var type = protoname;
									switch (type) {
										case "OTHER":
											break;
										case "PCANY":
										case "APPROVAL":
										case "SYBASE":
										case "DB2":
										case "MSSQL":
										case "MYSQL":
										case "ORACLE":
										case "RADMIN":
											var option_str = "";
											flag = 0;
											if (type == "APPROVAL") {
												flag = 1;
												option_str = '<option value="0">无</option>';
											} else {
												$.each(acc_client_data.data, function (i, item) {
													if (item.ProtocolName == type) {
														option_str = option_str + '<option value="' + item.ClientName + '">' + item.ClientName + '</option>';
													}
												});
											}
											if (option_str == "") {
												flag = 1;
												option_str = '<option value="0">无</option>';
											}
											$("#sel_mfs").empty().append(option_str);
											if (flag == 0) {
												$("#sel_mfs").select2();
											}

											if (type == "SYBASE") {
												// bind_conn(connparm_list1, type);
												if (item.ConnParamName != '' && item.ConnParamName != null && item.ConnParamName != '用户填写') {
													//if (auth_strategy.ServiceName == item.ServiceName) {
														$("#conn_select").val($("#conn_select").find("option[text='" + item.ConnParamName + "']").attr('value')).trigger('change');
													//} else {
													//	$("#conn_select").val(-1).trigger('change');
													//}
													// clear_conn(1);
												} else {
													// clear_conn();
													if ($("#conn_select").find("option[value=-1]").length > 0) {
														$("#conn_select").val(-1).trigger('change');
														$("#sysbase_input").val(item.ServiceName);
													}
													// $("#conn_select").val(-1).trigger('change');
													// $("#sysbase_input").val(item.ServiceName);
												}
											}
											else if (type == "DB2") {
												// bind_conn(connparm_list1, type);
												// $("#db2_input").val(item.ServiceName);
												if (item.ConnParamName != '' && item.ConnParamName != null && item.ConnParamName != '用户填写') {
													//if (auth_strategy.ServiceName == item.ServiceName) {
														$("#conn_select").val($("#conn_select").find("option[text='" + item.ConnParamName + "']").attr('value')).trigger('change');
													//} else {
													//	$("#conn_select").val(-1).trigger('change');
													//}
													// clear_conn(1);
												} else {
													// clear_conn();
													if ($("#conn_select").find("option[value=-1]").length > 0) {
														$("#conn_select").val(-1).trigger('change');
														$("#db2_input").val(item.ServiceName);
													}
													// $("#conn_select").val(-1).trigger('change');
													// $("#db2_input").val(item.ServiceName);

												}
											}
											else if (type == "MSSQL") {
												// bind_conn(connparm_list1, type);
												// $('.mssql:first').find('input').val(item.ServiceName);
												if (item.ConnParamName != '' && item.ConnParamName != null && item.ConnParamName != '用户填写') {
													//if (auth_strategy.ServiceName == item.ServiceName) {
														$("#conn_select").val($("#conn_select").find("option[text='" + item.ConnParamName + "']").attr('value')).trigger('change');
													//} else {
													//	$("#conn_select").val(-1).trigger('change');
													//}
													// clear_conn(1);
												} else {
													// clear_conn();
													if ($("#conn_select").find("option[value=-1]").length > 0) {
														$("#conn_select").val(-1).trigger('change');
														$('.mssql:first').find('input').val(item.ServiceName);
														if(!$("#mssql_auth").prop("disabled")){
															$("#mssql_auth").val(item.ConnMode).trigger('change');
														}
													}
													// $("#conn_select").val(-1).trigger('change');
													// $('.mssql:first').find('input').val(item.ServiceName);

												}
											}
											else if (type == "MYSQL") {
												// bind_conn(connparm_list1, type);
												// $('.mysql').find('input').val(item.ServiceName);
												if (item.ConnParamName != '' && item.ConnParamName != null && item.ConnParamName != '用户填写') {
													//if (auth_strategy.ServiceName == item.ServiceName) {
														$("#conn_select").val($("#conn_select").find("option[text='" + item.ConnParamName + "']").attr('value')).trigger('change');
													//} else {
													//	$("#conn_select").val(-1).trigger('change');
													//}
													// clear_conn(1);
												} else {
													// clear_conn();
													if ($("#conn_select").find("option[value=-1]").length > 0) {
														$("#conn_select").val(-1).trigger('change');
														$('.mysql').find('input').val(item.ServiceName);
													}
													// $("#conn_select").val(-1).trigger('change');
													// $('.mysql').find('input').val(item.ServiceName);

												}
											}
											else if (type == "RADMIN" || type == "PCANY") {
												if (type == "RADMIN") {
													// bind_conn(connparm_list1, type);
													if (item.ConnParamName != '' && item.ConnParamName != null && item.ConnParamName != '用户填写') {
														//if ($("#conn_select").find("option[text='" + item.ConnParamName + "']").length != 0) {
															$("#conn_select").val($("#conn_select").find("option[text='" + item.ConnParamName + "']").attr('value')).trigger('change');
														//} else {
														//	$("#conn_select").val(-1).trigger('change');
														//}

														// clear_conn(1);
													} else {
														// clear_conn();
														if ($("#conn_select").find("option[value=-1]").length > 0) {
															$("#conn_select").val(-1).trigger('change');
															if(!$("#radmin_auth_select").prop("disabled")){
																$("#radmin_auth_select").val(item.ConnMode).trigger('change');
															}
														}
														// $("#conn_select").val(-1).trigger('change');
														// $("#radmin_auth_select").val(item.ConnMode).trigger('change');

													}
												}
											} else if (type == "ORACLE") {
												// bind_conn(connparm_list1, type);
												if (item.ConnParamName != '' && item.ConnParamName != null && item.ConnParamName != '用户填写') {
													//if (auth_strategy.ServiceName == item.ServiceName) {
														$("#conn_select").val($("#conn_select").find("option[text='" + item.ConnParamName + "']").attr('value')).trigger('change');
													//} else {
													//	$("#conn_select").val(-1).trigger('change');
													//}
													// clear_conn(1);
												} else {
													// clear_conn();
													if ($("#conn_select").find("option[value=-1]").length > 0) {
														$("#conn_select").val(-1).trigger('change');
														$("#oracle_input").val(item.ServiceName);
														$("#appoint").val(item.ConnParam).trigger('change');
														if(!$("#oracle_auth_select").prop("disabled")){
															$("#oracle_auth_select").val(item.ConnMode).trigger('change');
														}

													}
													// $("#conn_select").val(-1).trigger('change');
													// $("#oracle_input").val(item.ServiceName);
													// $("#appoint").val(item.ConnParam).trigger('change');
													// $("#oracle_auth_select").val(item.ConnMode).trigger('change');

												}
											}
											break;
										case "VNC":
											option_str = "";
											flag = 0;
											$.each(acc_client_data.data, function (i, item) {
												if (item.ProtocolName == type) {
													option_str = option_str + '<option value="' + item.ClientName + '">' + item.ClientName + '</option>';
												}
											});
											if (option_str == "") {
												falg = 1;
												option_str = '<option value="0">无</option>';
											}
											$("#sel_mfs").empty().append(option_str);
											if (flag == 0) {
												$("#sel_mfs").select2();
											}
											break;
										case "RDP":
											bind_conn(connparm_list1, type);
											if (item.ConnMode != "" && item.ConnMode != null && $("#access_select").prop("disabled") != true) {
												$("#access_select").val(item.ConnMode).trigger('change');
											}
											break;
										case "FTP":
										case "SFTP":
										case "TELNET":
										case "RLOGIN":
											if (type == "FTP" || type == "SFTP") {
												if (type == "SFTP") {
													bind_SSHkey_xSelect();
													option_str = '<option value="2">SSH2</option><option value="1">SSH1</option>';
													$("#access_select").empty().append(option_str);
													if (item.SSHType != null && item.SSHType != "") {
														$("#access_select").val(item.SSHType).trigger('change');
													}
												}
											}
											break;
										case "SSH":
											if (item.SSHType != null && item.SSHType != "" && $("#access_select").attr('disabled') != "disabled") {
												$("#access_select").val(item.SSHType).trigger('change');
											}
											break;
										case "NEW":
											break;
										case "HTTP(S)":
										case "HTTPS":
											var option_str = "";
											flag = 0;
											$.each(acc_client_data.data, function (i, item) {
												if (item.ProtocolName == type) {
													flag = 1;
													option_str = option_str + '<option value="' + item.ClientName + '">' + item.ClientName + '</option>';
												}
											});
											if (option_str == "") {
												option_str = '<option value="0">无</option>';
											}
											$("#sel_mfs").empty().append(option_str);
											if (flag == 1) {
												$("#sel_mfs").select2();
											}
											// bind_conn(connparm_list1, type);
											var ConnMode = item.ConnMode;
											if (ConnMode != null && ConnMode != "") {
												ConnMode = ConnMode.split('|');
												if (item.ConnParamName != '' && item.ConnParamName != null && item.ConnParamName != '用户填写') {
													//if (auth_strategy.ServiceName == item.ServiceName) {
														$("#conn_select").val($("#conn_select").find("option[text='" + item.ConnParamName + "']").attr('value')).trigger('change');
													//} else {
													//	$("#conn_select").val(-1).trigger('change');
													//}
													// clear_conn(1);
												} else {
													// clear_conn();
													if ($("#conn_select").find("option[value=-1]").length > 0) {
														$("#conn_select").val(-1).trigger('change');
														$("#http_url").val(item.ServiceName);
														$("#http_account").val(ConnMode[0]);
														$("#http_pwd").val(ConnMode[1]);
														$("#http_submit").val(ConnMode[2]);
													}
													// $("#conn_select").val(-1).trigger('change');
													// $("#http_url").val(item.ServiceName);
													// $("#http_account").val(ConnMode[0]);
													// $("#http_pwd").val(ConnMode[1]);
													// $("#http_submit").val(ConnMode[2]);

												}
											}
											break;
										case "TN5250":
										case "X11":
											break;
										default:

									}
								// }

								// if (item.ConnWay != '' && item.ConnWay != null) {
								// 	$('#passageway_select').val(item.ConnWay).trigger('change');
								// }
								if (item.AppChannel == "true") {
									$("#ApplicationChannel").iCheck('check');
								}
								if (item.ExePath != '' && item.ExePath != null && $("#ctl_sysbase_input").is(':visible')) {
									$("#ctl_sysbase_input").val(item.ExePath);
								} else if (item.ExePath != '' && item.ExePath != null && $("#ctl_input").is(':visible')) {
									$("#ctl_input").val(item.ExePath);
								}
								if (item.RDPScreen != "" && item.RDPScreen != null) {
									$("#screensize").val(item.RDPScreen).trigger('change');
								}
								if (item.RDPDiskMap == "true") {
									$("#EnableRDPDiskMap").iCheck('check');
								} else {
									$("#EnableRDPDiskMap").iCheck('uncheck');
								}
								if (item.RDPClipboard == "true") {
									$("#EnableRDPClipboard").iCheck('check');
								}
								var mapdisks = "";
								if (item.RDPDiskMapList != null && item.RDPDiskMapList != "") {
									mapdisks = item.RDPDiskMapList.split('|');
								}
								if (mapdisks != "") {
									$.each(mapdisks, function (i1, item1) {
										$('.disk_map').find('input').each(function (i2, item2) {
											if ($(item2).parents('label:first').text() == item1) {
												$(item2).iCheck('check');
												return false;
											}
										})
									})
								} else {
									$('.disk_map').find('input').each(function (i2, item2) {
										$(item2).iCheck('uncheck');
									})
								}
								if($("#sel_client").is(":visible") == true){
									$("#sel_client").val($("#sel_client").children("option").val()).trigger('change');
								}							
								return false;
							}
						});
					}
					if(accountname == "#"){
						$("#user_select").next().find("#select2-user_select-container").text(accountname).attr('title','单点登录账号');
					}else if(accountname == "-"){
						$("#user_select").next().find("#select2-user_select-container").text(accountname).attr('title','空账号');
					}else{
						$("#user_select").next().find("#select2-user_select-container").text(accountname).attr('title', accountname);
					}
					if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')) {
						$('.disk_map').show();
					}
					LoadFlag = 1;
				});
				var service_str_arr = [];
				var pro_name = service_array_all[array_index[0]][array_index[1]].ProtocolName;
				var pro_port = service_array_all[array_index[0]][array_index[1]].Port;
				$(service_array_all[array_index[0]]).each(function (i, item) {
					if (item.ProtocolName == pro_name && item.Port == pro_port) {
						service_str_arr.push(JSON.stringify(item));
					}
				});
				var option_str = [];
				var accountname_array = [];
				$(service_str_arr).each(function (i1, item1) {
					$.ajax({
						url: '/bhost/Get_AuthObjectByLevel',
						type: 'post',
						async: false,
						data: { a0: se, z1: hgid, z2: hostip, z3: item1 },
						success: function (result) {
							var account_array = JSON.parse(result);

							$.each(account_array.data, function (i, item) {
								var accountname = "";
								if (item.AccountName == '*') {
									accountname = "任意账号";
								} else {
									accountname = item.AccountName;
								}
								var option_str_value = '<option value="' + item.AccountName + '" data="' + item.AccountType + '">' + accountname + '</option>';
								if ($.inArray(option_str_value, option_str) < 0) {
									option_str.push(option_str_value);
									accountname_array.push(item.AccountName);
								}
								// option_str = option_str + '<option value="'+item.AccountName+'" data="'+item.AccountType+'">'+accountname+'</option>';
							});

						}
					});
				});
				$("#user_select").empty().append(option_str);
				if (HostCfgData.data.length != 0) {
					//$.each(account_array.data,function(i,item){
					if ($.inArray(HostCfgData.data[0].ServerUser, accountname_array) >= 0) {
						$("#user_select").val(HostCfgData.data[0].ServerUser).trigger('change');
					} else {
						$("#user_select").trigger('change');
					}
					//})
				} else {
					$("#user_select").trigger('change');
				}
				ajax_over = 1;
				$('.pl-c').unbind();

				$("#ApplicationChannel").parents('label').hide();
				var flag = 0;
				$("#conn_select").unbind().bind('change', function () {
					var conn_id = $("#conn_select").val();
					var conn_text = $("#conn_select").children('option:selected').text();
					$("#conn_select").next().find('.select2-selection__rendered').text(conn_text).attr('title', conn_text);
					switch (pro_name) {
						case "MSSQL":
						case "MYSQL":
							if (conn_id == -1) {
								if (pro_name == 'MSSQL') {
									$(".mssql:eq(0)").find('input').val('').attr('disabled', false);
									$("#mssql_auth").val('SQL服务器验证').trigger('change').attr('disabled', false);
								} else {
									$(".mysql:eq(0)").find('input').val('').attr('disabled', false);
								}
								break;
							}
							$(service_str_arr).each(function (i, item) {
								var item = JSON.parse(item);
								if (pro_name == 'MSSQL') {
									if (conn_text == item.ConnParamName) {
										$(".mssql:eq(0)").find('input').val(item.ServiceName).attr('disabled', true);
										if (item.ConnType != null) {
											$("#mssql_auth").val(item.ConnType).trigger('change').attr('disabled', true);
										}else{
											$("#mssql_auth").val('SQL服务器验证').trigger('change').attr('disabled', false);
										}
										return false;
									}
								} else {
									if (conn_text == item.ConnParamName) {
										$(".mysql:eq(0)").find('input').val(item.ServiceName).attr('disabled', true);
										return false;
									}
								}
							});
							break;
						case "SYBASE":
						case "DB2":
							if (conn_id == -1) {
								if (pro_name == 'SYBASE') {
									$("#sysbase_input").val('').attr('disabled', false);
								} else {
									$("#db2_input").val('').attr('disabled', false);
								}
								break;
							}
							$(service_str_arr).each(function (i, item) {
								var item = JSON.parse(item);
								if (pro_name == 'SYBASE') {
									if (conn_text == item.ConnParamName) {
										$("#sysbase_input").val(item.ServiceName).attr('disabled', true);
										return false;
									}
								} else {
									if (conn_text == item.ConnParamName) {
										$("#db2_input").val(item.ServiceName).attr('disabled', true);
										return false;
									}
								}
							});
							break;
						case "ORACLE":
							if (conn_id == -1) {
								$("#oracle_input").val('').attr('disabled', false);
								$("#appoint").val('SID').trigger('change').attr('disabled', false);
								$("#oracle_auth_select").val('NORMAL').trigger('change').attr('disabled', false);
								break;
							}
							$(service_str_arr).each(function (i, item) {
								var item = JSON.parse(item);
								if (conn_text == item.ConnParamName) {
									$("#oracle_input").val(item.ServiceName).attr('disabled', true);
									$("#appoint").val(item.ConnParamValue).trigger('change').attr('disabled', true);
									if (item.ConnType != null) {
										$("#oracle_auth_select").val(item.ConnType).trigger('change').attr('disabled', true);
									} else {
										$("#oracle_auth_select").val('NORMAL').trigger('change').attr('disabled', false);
									}
									return false;
								}
							});
							break;
						case "HTTP(S)":
						case "HTTPS":
							if (conn_id == -1) {
								$("#http_url").val('').attr('disabled', false);
								$("#http_account").val('').attr('disabled', false);
								$("#http_pwd").val('').attr('disabled', false);
								$("#http_submit").val('').attr('disabled', false);
								break;
							}
							$(service_str_arr).each(function (i, item) {
								var item = JSON.parse(item);
								if (conn_text == item.ConnParamName) {
									var ConnParamValue = item.ConnParamValue.split('|');
									$("#http_url").val(item.ServiceName).attr('disabled', true);
									$("#http_account").val(ConnParamValue[0]).attr('disabled', true);
									$("#http_pwd").val(ConnParamValue[1]).attr('disabled', true);
									$("#http_submit").val(ConnParamValue[2]).attr('disabled', true);
									return false;
								}
							});
							break;
					}
				});
				$("#EnableCFG").attr('disabled',false);
				class_tmp = $("#EnableCFG").parent().attr('class');
				if(class_tmp.indexOf('checked') == -1){
					$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue');
				}else{
					$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked');
				}
				$("#EnableRDPDiskMap").parents('label').show();
				var default_proto = 0;
				switch (pro_name) {
					case "OTHER":
						break;
					case "PCANY":
					case "APPROVAL":
						$(".linkmode_div").show();
						$(".mfs_divall").show();
						$(".mfs").show();
						$(".mfs_div").show();
						$(".screen_div").show();
						$(".mfs").find('input').iCheck('uncheck');
						$(".mfs").find('input').iCheck('check');
						$(".local_client").hide();
						$(".web_con").hide();		
						if(pro_name == "PCANY"){
							$(".linkmode_div").show();
							$("#EnableCFG").attr('disabled',true);
							$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked disabled');
						}
						var option_str = "";
						flag = 0;
						$.each(acc_client_data.data, function (i, item) {
							if (item.ProtocolName == pro_name) {
								option_str = option_str + '<option value="' + item.ClientName + '">' + item.ClientName + '</option>';
							}
						});
						if (option_str == "") {
							flag = 1;
							option_str = '<option value="0">无</option>';
						}
						$("#sel_mfs").empty().append(option_str);
						if (flag == 0) {
							$("#sel_mfs").select2();
						}
						break;
					case "RADMIN":
						$(".linkmode_div").hide();
						$(".mfs_divall").show();
						$(".mfs").show();
						$("#EnableCFG").iCheck('uncheck');
						//$("#EnableCFG").iCheck('check');
						$(".local_client").hide();
						$(".web_con").hide();
						$(".screen_div").show();
						$(".radmin").show();
						$(".mfs_div").show();
						$("#EnableCFG").attr('disabled',true);
						$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked disabled');				
						option_str = "";
						$.each(acc_client_data.data, function (i, item) {
							if (item.ProtocolName == pro_name) {
								option_str = option_str + '<option  value="' + item.ClientName + '">' + item.ClientName + '</option>';
							}
						});
						if (option_str == "") {
							option_str = '<option value="0">无</option>';
						}
						$("#sel_mfs").empty().append(option_str);
						var ConnType_arr = [];
						$(service_str_arr).each(function (i, item) {
							var item = JSON.parse(item);
							if ($.inArray(item.ConnType, ConnType_arr) < 0) {
								ConnType_arr.push(item.ConnType);
							}
						});
						if (ConnType_arr.length == 1 && ConnType_arr[0] != null) {
							$("#radmin_auth_select").val(service_array_all[array_index[0]][array_index[1]].ConnType).trigger('change');
							$("#radmin_auth_select").attr('disabled', true);
						}
						break;
					case "VNC":
						$(".linkmode_div").show();
						$(".local_client").show();
						$(".local_client").find('input').iCheck('uncheck');
						$(".local_client").find('input').iCheck('check');
						$(".web_con").show();
						// $(".web_con").find('input').iCheck('uncheck');
						// $(".web_con").find('input').iCheck('check');
						//$(".mfs").hide();
						$(".mfs_divall").show();
						$(".mfs").show();
						$(".screen_div").show();
						$("#EnableRDPDiskMap").parents('label').hide();
						$(".disk_map").hide();
						$("#EnableRDPClipboard").parents('label').show();
						$("#ApplicationChannel").parents('label').hide();
						/*
						if (IsAcc == 2){
							$("#ApplicationChannel").parents('label').show();
						}
						*/
						option_str = "";
						flag = 0;
						$.each(acc_client_data.data, function (i, item) {
							if (item.ProtocolName == pro_name) {
								option_str = option_str + '<option value="' + item.ClientName + '">' + item.ClientName + '</option>';
							}
						});
						if (option_str == "") {
							falg = 1;
							option_str = '<option value="0">无</option>';
						}
						$("#sel_mfs").empty().append(option_str);
						if (flag == 0) {
							$("#sel_mfs").select2();
						}
						break;
					case "RDP":
						$(".sel_access").show();
						$(".linkmode_div").show();
						$(".mfs_divall").hide();
						$(".mfs").hide();
						$(".web_con").show();
						// $(".web_con").find('input').iCheck('uncheck');
						// $(".web_con").find('input').iCheck('check');
						$(".local_client").show();
						$(".local_client").find('input').iCheck('uncheck');
						$(".local_client").find('input').iCheck('check');
						$(".screen_div").show();
						$("#EnableRDPClipboard").parents('label').show();
						$("#EnableRDPDiskMap").parents('label:first').show();
						if (IsAcc == 2) {
							$("#ApplicationChannel").parents('label').show();
						}
						option_str = "";
						option_str = '<option value="NORMAL" text="NORMAL">NORMAL</option><option value="CONSOLE" text="CONSOLE">CONSOLE</option>';
						$("#access_select").empty().append(option_str);
						var ConnType_arr = [];
						$(service_str_arr).each(function (i, item) {
							var item = JSON.parse(item);
							if ($.inArray(item.ConnType, ConnType_arr) < 0) {
								ConnType_arr.push(item.ConnType);
							}
						});
						if (ConnType_arr.length == 1 && ConnType_arr[0] != null) {
							$("#access_select").val(service_array_all[array_index[0]][array_index[1]].ConnType).trigger('change');
							$("#access_select").attr('disabled', true);
						}
						break;
					case "SYBASE":
					case "DB2":
						$(".linkmode_div").show();
						$(".web_con").hide();
						$(".local_client").show();
						$(".local_client").find('input').iCheck('uncheck');
						$(".local_client").find('input').iCheck('check');
						$(".mfs_divall").show();
						$(".mfs").show();
						$('.disk_map').hide();
						// $(".mfs").find('input').iCheck('check');
						$(".screen_div").hide();
						$(".mfs_div").hide();
						$(".conn").show();
						if (pro_name == "SYBASE") {
							$(".sysbase").show();
						} else {
							$(".db2").show();
						}
						var option_str = "";
						var conn_option_str = "";
						flag = 0;
						$.each(acc_client_data.data, function (i, item) {
							if (item.ProtocolName == pro_name) {
								option_str = option_str + '<option value="' + item.ClientName + '">' + item.ClientName + '</option>';
							}
						});
						var ConnParamName_arr = [];
						$(service_str_arr).each(function (i, item) {
							var item = JSON.parse(item);
							if ($.inArray(item.ConnParamName, ConnParamName_arr) < 0) {
								if (item.ConnParamName != '' && item.ConnParamName != null) {
									var cname = item.ConnParamName;
									conn_option_str = conn_option_str + '<option pid="'+item.ConnParamId+'" value="' + cname + '" text="' + cname + '">' + cname + '</option>';
								} else {
									conn_option_str = '<option pid="0" value="-1">用户填写</option>' + conn_option_str;
								}
								ConnParamName_arr.push(item.ConnParamName);
							}
						});
						if (option_str == "") {
							flag = 1;
							option_str = '<option value="0">无</option>';
						}
						$("#sel_mfs").empty().append(option_str);
						if (flag == 0) {
							$("#sel_mfs").select2();
						}
						flag = 0;
						if (conn_option_str == "") {
							conn_option_str = '<option value="-1">用户填写</option>';
							flag = 1;
						}
						$("#conn_select").empty().append(conn_option_str);
						if (flag == 0) {
							$("#conn_select").select2();
						}
						$('#conn_select').trigger('change');
						$(".mfs_divall").show();
						$(".mfs").show();					
						break;
					case "MSSQL":
					case "MYSQL":
						$(".linkmode_div").show();
						$(".web_con").hide();
						if (pro_name == "MSSQL") {
							$(".linkmode_div").hide();
							$(".local_client").hide();
							$(".mfs_divall").show();
							$(".mfs").show();
							$(".mfs").find('input').iCheck('uncheck');
							$(".mfs").find('input').iCheck('check');
							$(".screen_div").show();
							$("#EnableCFG").attr('disabled',true);
							$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked disabled');
							//$(".mfs_div").show();
						} else {
							$(".linkmode_div").show();
							$(".local_client").show();
							$(".mfs_divall").show();
							$(".mfs").show();
							$(".local_client").find('input').iCheck('uncheck');
							$(".local_client").find('input').iCheck('check');
							$(".screen_div").hide();
							//$(".mfs_div").hide();
						}
						//$(".mfs").find('input').iCheck('check');
						$(".conn").show();

						option_str = "";
						var conn_option_str = "";
						$.each(acc_client_data.data, function (i, item) {
							if (item.ProtocolName == pro_name) {
								option_str = option_str + '<option value="' + item.ClientName + '">' + item.ClientName + '</option>';
							}
						});
						var ConnParamName_arr = [];
						$(service_str_arr).each(function (i, item) {
							var item = JSON.parse(item);
							if ($.inArray(item.ConnParamName, ConnParamName_arr) < 0) {
								if (item.ConnParamName != '' && item.ConnParamName != null) {
									var cname = item.ConnParamName;
									conn_option_str = conn_option_str + '<option pid="'+item.ConnParamId+'" value="' + cname + '" text="' + cname + '">' + cname + '</option>';
								} else {
									conn_option_str = '<option pid="0" value="-1">用户填写</option>' + conn_option_str;
								}
								ConnParamName_arr.push(item.ConnParamName);
							}
						});

						flag = 0;
						if (option_str == "") {
							option_str = '<option value="0">无</option>';
							flag = 1;
						}
						$("#sel_mfs").empty().append(option_str);
						if (flag == 0) {
							$("#sel_mfs").select2();
						}
						flag = 0
						if (conn_option_str == "") {
							flag = 1;
							conn_option_str = '<option pid="0" value="-1">用户填写</option>';
						}
						$("#conn_select").empty().append(conn_option_str);
						if (flag == 0) {
							$("#conn_select").select2();
						}

						if (pro_name == "MSSQL") {
							$(".mssql").show();
						} else {
							$(".mysql").show();
						}
						$('#conn_select').trigger('change');
						break;
					case "ORACLE":
						$(".linkmode_div").show();
						$(".oracle").show();
						$(".web_con").hide();
						$(".local_client").show();
						$(".local_client").find('input').iCheck('uncheck');
						$(".local_client").find('input').iCheck('check');
						$(".mfs_divall").show();
						$(".mfs").show();
						// $(".mfs").find('input').iCheck('check');
						//$(".mfs_div").show();
						$(".conn").show();
						var option_str = "";
						var conn_option_str = "";

						$.each(acc_client_data.data, function (i, item) {
							if (item.ProtocolName == pro_name) {
								option_str = option_str + '<option value="' + item.ClientName + '">' + item.ClientName + '</option>';
							}
						});
						var ConnParamName_arr = [];
						$(service_str_arr).each(function (i, item) {
							var item = JSON.parse(item);
							if ($.inArray(item.ConnParamName, ConnParamName_arr) < 0) {
								if (item.ConnParamName != '' && item.ConnParamName != null) {
									var cname = item.ConnParamName;
									conn_option_str = conn_option_str + '<option pid="'+item.ConnParamId+'" value="' + cname + '" text="' + cname + '">' + cname + '</option>';
								} else {
									conn_option_str = '<option pid="0" value="-1">用户填写</option>' + conn_option_str;
								}
								ConnParamName_arr.push(item.ConnParamName);
							}
						});
						flag = 0;
						if (option_str == "") {
							flag = 1;
							option_str = '<option value="0">无</option>';
						}
						$("#sel_mfs").empty().append(option_str);
						if (flag == 0) {
							$("#sel_mfs").select2();
						}
						flag = 0;
						if (conn_option_str == "") {
							flag = 1;
							conn_option_str = '<option pid="0" value="-1">用户填写</option>';
						}
						$("#conn_select").empty().append(conn_option_str);
						if (flag == 0) {
							$("#conn_select").select2();
						}
						$('#conn_select').trigger('change');
						break;
					case "FTP":
					case "SFTP":
					case "TELNET":
					case "RLOGIN":
						$(".linkmode_div").show();
						$(".local_client").show();
						$(".local_client").find('input').iCheck('uncheck');
						$(".local_client").find('input').iCheck('check');
						if (pro_name == "FTP" || pro_name == "SFTP") {
							$(".web_con").hide();
							//$(".local_client").find('input').iCheck('uncheck');
							//$(".local_client").find('input').iCheck('check');
							if (pro_name == "SFTP") {
								$(".sel_access").show();
								option_str = '<option value="2">SSH2</option><option value="1">SSH1</option>';
								$("#access_select").empty().append(option_str);
								var ServiceName_arr = [];
								$(service_str_arr).each(function (i, item) {
									var item = JSON.parse(item);
									if ($.inArray(item.ServiceName, ServiceName_arr) < 0) {
										ServiceName_arr.push(item.ServiceName);
									}
								});
								if (ServiceName_arr.length == 1 && ServiceName_arr[0] != null) {
									// if (service_array_all[array_index[0]][array_index[1]].ServiceName != null){
									$("#access_select").val(service_array_all[array_index[0]][array_index[1]].ServiceName).trigger('change');
									$("#access_select").attr('disabled', true);
								}
							}
						} else {
							$(".web_con").show();
							// $(".web_con").find('input').iCheck('uncheck');
							// $(".web_con").find('input').iCheck('check');
						}
						$(".mfs_divall").hide();
						$(".mfs").hide();
						break;
					case "SSH":
						$(".sel_access").show();
						$(".linkmode_div").show();
						$(".mfs_divall").hide();
						$(".mfs").hide();
						$(".local_client").show();
						$(".local_client").find('input').iCheck('uncheck');
						$(".local_client").find('input').iCheck('check');
						$(".web_con").show();
						// $(".web_con").find('input').iCheck('uncheck');
						// $(".web_con").find('input').iCheck('check');
						option_str = "";
						option_str = '<option value="2">SSH2</option><option value="1">SSH1</option>';
						$("#access_select").empty().append(option_str);
						var ServiceName_arr = [];
						$(service_str_arr).each(function (i, item) {
							var item = JSON.parse(item);
							if ($.inArray(item.ServiceName, ServiceName_arr) < 0) {
								ServiceName_arr.push(item.ServiceName);
							}
						});
						if (ServiceName_arr.length == 1 && ServiceName_arr[0] != null) {
							// if (service_array_all[array_index[0]][array_index[1]].ServiceName != null){
							$("#access_select").val(service_array_all[array_index[0]][array_index[1]].ServiceName).trigger('change');
							$("#access_select").attr('disabled', true);
						}
						break;
					case "NEW":
						break;
					case "HTTP(S)":
					case "HTTPS":
						$(".linkmode_div").hide();
						$(".web_con").hide();
						$(".local_client").hide();
						$(".mfs_divall").show();
						$(".mfs").show();
						$(".item.linkmode_div").hide();
						$("#EnableCFG").iCheck('uncheck');
						//$("#EnableCFG").iCheck('check');
						$(".screen_div").show();
						$(".mfs_div").show();
						$(".conn").show();
						$("#EnableCFG").attr('disabled',true);
						$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked disabled');
						var option_str = "";
						var conn_option_str = "";

						$.each(acc_client_data.data, function (i, item) {
							if (item.ProtocolName == pro_name) {
								option_str = option_str + '<option value="' + item.ClientName + '">' + item.ClientName + '</option>';
							}
						});
						// var cname = service_array_all[array_index[0]][array_index[1]].ConnParamName;
						// if (cname != null){
						// 	conn_option_str = conn_option_str + '<option value="'+cname+'">'+cname+'</option>';
						// 	var ConnParamValue = service_array_all[array_index[0]][array_index[1]].ConnParamValue.split('|');
						// 	$("#http_url").val(service_array_all[array_index[0]][array_index[1]].ServiceName).attr('disabled',true);
						// 	$("#http_account").val(ConnParamValue[0]).attr('disabled',true);
						// 	$("#http_pwd").val(ConnParamValue[1]).attr('disabled',true);
						// 	$("#http_submit").val(ConnParamValue[2]).attr('disabled',true);
						// }
						var ConnParamName_arr = [];
						$(service_str_arr).each(function (i, item) {
							var item = JSON.parse(item);
							if ($.inArray(item.ConnParamName, ConnParamName_arr) < 0) {
								if (item.ConnParamName != '' && item.ConnParamName != null) {
									var cname = item.ConnParamName;
									conn_option_str = conn_option_str + '<option pid="'+item.ConnParamId+'" value="' + cname + '" text="' + cname + '">' + cname + '</option>';
								} else {
									conn_option_str = '<option pid="0" value="-1">用户填写</option>' + conn_option_str;
								}
								ConnParamName_arr.push(item.ConnParamName);
							}
						});
						flag = 0;
						if (option_str == "") {
							flag = 1;
							option_str = '<option value="0">无</option>';
						}
						$("#sel_mfs").empty().append(option_str);
						if (flag == 0) {
							$("#sel_mfs").select2();
						}
						flag = 0;
						if (conn_option_str == "") {
							flag = 1;
							conn_option_str = '<option pid="0" value="-1">用户填写</option>';
						}
						$("#conn_select").empty().append(conn_option_str);
						if (flag == 0) {
							$("#conn_select").select2();
						}
						$('#conn_select').trigger('change');
						$(".http").show();
						break;
					case "TN5250":
						$(".linkmode_div").show();
						$(".web_con").show();
						$(".web_con").find('input').iCheck('uncheck');
						$(".web_con").find('input').iCheck('check');
						$(".local_client").hide();
						$(".mfs_divall").hide();
						$(".mfs").hide();
						break;
					case "X11":
						$(".linkmode_div").show();
						$(".local_client").show();
						$(".local_client").find('input').iCheck('uncheck');
						$(".local_client").find('input').iCheck('check');
						$(".mfs_divall").hide();
						$(".mfs").hide();
						$(".web_con").show();
						// $(".web_con").find('input').iCheck('uncheck');
						// $(".web_con").find('input').iCheck('check');
						$(".screen_div").show();
						// $("#EnableRDPClipboard").parents('label').hide();
						$("#EnableRDPDiskMap").parents('label').hide();
						$("#ApplicationChannel").parents('label').hide();
						$(".disk_map").hide();
						break;
					default:
						$('.pl-c').children('div').hide();
						$(".ip_div").hide();
						$(".sel_user").show();
						$(".user_div").show();
						$(".pwd_div").show();
						//$(".pro_div").show();
						$(".linkmode_div").show();
						$(".local_client").hide();
						$(".web_con").hide();
						$(".mfs_divall").show();
						$(".mfs").show().attr('disabled',true);
						$(".mfs").find('input').iCheck('uncheck');
						$(".mfs").find('input').iCheck('check');
						$(".mfs_div").show();
						$(".screen_div").show();
						$("#EnableCFG").attr('disabled',true);
						$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked disabled');
						$(".local_client").show();
						default_proto = 1;
						break;
				}
				if($('.local_client').is(":visible") == false && $('.web_con').is(":visible") == false){
					$("#EnableCFG").iCheck('check');
					$("#EnableCFG").attr('disabled',true);
					$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked disabled');
					$(".linkmode_div").show();
					$(".local_client").show();
					$(".web_con").show();
				}else{
					if(default_proto == 0){
						$("#EnableCFG").attr('disabled',false);
						class_tmp = $("#EnableCFG").parent().attr('class');
						if(class_tmp.indexOf('checked') == -1){
							$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue');
						}else{
							$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked');
						}
					}
				}
				clickTimer1 = window.setTimeout(function(){
					if (HostCfgData.data.length != 0) {
						//$.each(account_array.data,function(i,item){
						if ($.inArray(HostCfgData.data[0].ServerUser, accountname_array) >= 0) {
							$("#user_select").val(HostCfgData.data[0].ServerUser).trigger('change');
						} else {
							$("#user_select").trigger('change');
						}
						//})
					} else {
						$("#user_select").trigger('change');
					}
				},100);
			}, 300);
		}
		var LoadFlag = 0;
		function _dblclick(obj, hostip, index, hgid){
			var time_tmp1;
			var timeoutFlag = 0;
			if(clickTimer) {
				window.clearTimeout(clickTimer);
				clickTimer = null;
			}
			_getProLink(obj, hostip, index, hgid);
			LoadFlag = 0;
			function func1() {
				if(timeoutFlag >= 10){
					_alert(2, "收藏夹", '系统超时');
					clearTimeout(time_tmp1);
					return false;
				}
				if(LoadFlag == 1){
					clearTimeout(time_tmp1);
					$("#connect").click();
				}else{
					t_get_msg3 = setTimeout(function(){
						timeoutFlag++;
						func1();
					},1000);
				}
			}
			func1();
		}

		//collection
		function _setColl(obj, hgid, hid, hname, fid) {
			if (_permissions == 1) {
				return false;
			}
			parent._setCollParent(obj, hgid, hid, hname, fid);
		}

		//
		function _addNewColl(obj) {
			var v = $.trim($(obj).prev().val());

			if (v != '') {
				var $new = $('<a href="javascript:;" class="collbtn" title="' + v + '">' + v + '</a>');
				$(obj).parent().before($new);
				$(obj).prev().val('');
			}
		}

		//
		function _initEvent() {
			$('body').on('click', '#collLayer a.collbtn', function () {
				var $this = $(this);
				if ($this.hasClass('on')) {
					$this.removeClass('on');
				} else {
					$this.addClass('on');
				}
			}).on('click', '#RightTip', function () {
				if ($('a.prolink.active').length == 1 || quick_link == 1) {
					$('#protocolLink').addClass('show');
				} else {
					//_quickLink();
				}
			});
		}

		function _hideProt(obj) {
			$('#protocolLink').removeClass('show');
			$("#RightTip").css({ "cursor": "pointer" });
		}

		function clear_link() {
			$("#protocolLink").find('input[type=text]').val('').prop('disabled', false);
			$("#protocolLink").find('input[type=password]').val('').prop('disabled', false);
			//$("#protocolLink").find('input[type=checkbox]').not("#ApplicationChannel").iCheck('uncheck').iCheck('enable');
			$("#protocolLink").find('input[type=checkbox]').iCheck('uncheck');
			$("#protocolLink").find('select').prop('disabled', false);
			$("#protocolLink").find('select').each(function () {
				$(this).children('option:first').prop('selected', true).trigger('change');
			});
		}

		//快速连接
		var quick_link = 0;
		var clear_pro = 0;
		function _quickLink() {
			$('.group.pwd.ctr').children('input').css({ "width": "121px" });
			SSHkey_s1_length = 131;
			bind_SSHkey_xSelect();
			quick_link = 1;
			ajax_over = 1;
			IsAcc = 2;
			$("#RightTip").css({ "cursor": "pointer" });
			var $p = $('#protocolLink');
			$('.pl-tit>span', $p).text('快速连接');
			$('.pl-tit>i', $p).attr('class', 'icon-quick');
			$p.addClass('show');
			$('a.prolink').removeClass('active');
			$('a.morelink').removeClass('active');
			$("a.morelink").removeAttr("id");
			$("a.morelink").css({ "background": "", "border-color": "", "color": "" });
			$("#user_select").unbind();
			$("#conn_select").unbind();
			$("#conn_select").hide();
			clear_link();
			$('.pl-c').children('div').hide();
			$('.pwd_auth').find('input').iCheck('check');
			$(".ip_div").show();
			$(".user_div").show();
			$(".pwd_div").show();
			$('.btn.fp').show();
			$(".pro_div").show();
			$(".linkmode_div").show();
			$(".local_client").hide();
			$(".web_con").hide();
			$(".mfs_divall").show();
			$(".mfs").show();
			$(".mfs").find('input').iCheck('uncheck');
			$(".mfs").find('input').iCheck('check');
			$(".mfs_div").show();
			$(".screen_div").show();
			$('.remark').show();
			get_pro_v(1);
			GLOBAL_ProtocolName = "";
			GLOBAL_Port = -1;			
		}

		function changepage(type) {
			var curpage = $("#curpage").val();
			var totalpage = $("#totalpage").text();
			if (curpage == "") {
				curpage = 1;
			}
			if (type == 1) {
				if (curpage == 1) {
					return false;
				}
				$("#curpage").val(1);
			} else if (type == 2) {
				if (curpage != 1) {
					$("#curpage").val(parseInt(curpage) - 1);
				} else {
					return false;
				}
			} else if (type == 3) { //onchange
				var numReg = /\D/;
				if (numReg.test(curpage)) {
					$("#curpage").val(1);
				} else if (parseInt(curpage) < 1 || curpage == '') {
					$("#curpage").val(1);
				} else {
					if (parseInt(curpage) > parseInt(totalpage)) {
						$("#curpage").val(totalpage);
					} else {
						$("#curpage").val(curpage);
					}
				}
			} else if (type == 4) {
				if (parseInt(curpage) != parseInt(totalpage)) {
					$("#curpage").val(parseInt(curpage) + 1);
				} else {
					return false;
				}
			} else if (type == 5) {
				if (totalpage != parseInt(curpage)) {
					$("#curpage").val(totalpage);
				} else {
					return false;
				}
			}
			curpage = $("#curpage").val();
			totalpage = $("#totalpage").val();
			if (parseInt(curpage) != parseInt(totalpage)) {
				$('#protocolLink').removeClass('show');
				if (quick_link == 1) {
					$("#RightTip").css({ "cursor": "pointer" });
				}
			}
			_initList();
		}

		//搜索
		var manage_filter_flag = 0;
		var keyword_re = [];
		var filter_v = "";
		function _addFilter(obj, type) {
			$('#protocolLink').removeClass('show');
			if (quick_link == 1) {
				$("#RightTip").css({ "cursor": "pointer" });
			}
			var keyword = $.trim($("#keyword").val());
			var add = 0;
			$("#keyword").blur();

			var filter_sel = $("#find_select").val();
			var addfilter;
			if (filter_sel == "all") {
				addfilter = keyword;
				keyword_v = "1-" + keyword;
			} else if (filter_sel == "hostname") {
				addfilter = '主机名-' + keyword;
				keyword_v = '2-' + keyword;
			} else if (filter_sel == "hostip") {
				addfilter = '主机IP-' + keyword;
				keyword_v = '3-' + keyword;
			} else {
				addfilter = '协议-' + keyword;
				keyword_v = '4-' + keyword;
			}
			if (keyword == "") {
				$("#keyword").blur();
				_alert(2, "搜索", "请输入关键字", $("#keyword"));
				return false;
			}
			$("#filterWW li").each(function (i, item) {
				var filter = $(item).find('.ww').text();
				if (filter == addfilter) {
					add = 1;
					_alert(2, "搜索", "相同的搜索条件已存在", $("#keyword"));
				}
			});
			if (type) {
				if (add != 1) {
					if (manage_filter_flag == 1) {
						keyword_re.splice(-1, 1);
						manage_filter_flag = 0;
					}
					$("#filterWW").show();
					$("#clearFilter").show();
					$("#filterWW ul").append("<li><span class=\"ww\" data-value=\"" + keyword_v + "\">" + addfilter + "</span><i class=\"del\" onclick=\"_delFilter(this)\"></i></li>");
					keyword_re.push(keyword_v);
					filter_v = "";
					$("#v_clear").hide();
				}
				$("#keyword").val('');
			} else {
				if (manage_filter_flag == 1) {
					keyword_re.splice(-1, 1);
				}
				manage_filter_flag = 1;
				keyword_re.push(keyword_v);
				filter_v = keyword_v;
			}

			$("#curpage").val(1);
			_getWait($(".waitTip"));
			_initList();
			//$("#keyword").focus();
		}

		function _clearFilter(obj) {
			$('#protocolLink').removeClass('show');
			if (quick_link == 1) {
				$("#RightTip").css({ "cursor": "pointer" });
			}
			$("#filterWW").children('ul').empty();
			$("#filterWW").hide();
			$("#clearFilter").hide();
			keyword_re = [];
			$("#keyword").val('');
			filter_v = "";
			manage_filter_flag = 0;
			$("#v_clear").hide();
			_initList();
		}

		//移除搜索条件
		function _delFilter(obj) {
			$('#protocolLink').removeClass('show');
			if (quick_link == 1) {
				$("#RightTip").css({ "cursor": "pointer" });
			}
			var filter_text = $(obj).parent().children('span').attr('data-value');
			$(obj).parent().remove();
			keyword_re.splice($.inArray(filter_text, keyword_re), 1);
			if ($("#filterWW").children("ul").children('li').length == 0) {
				$("#filterWW").hide();
				$("#clearFilter").hide();
			}
			_initList();
		}

		function _clear_keyword(obj) {
			$("#keyword").val("");
			$("#v_clear").hide();
			if (filter_v != "") {
				filter_v = "";
				manage_filter_flag = 0;
				keyword_re.splice(-1, 1);
				_initList();
			}
		}

		function change_input(obj) {
			if ($(obj).val() == "" && filter_v != "") {
				filter_v = "";
				manage_filter_flag = 0;
				keyword_re.splice(-1, 1);
				_initList();
			}
		}

		function _getWait(obj) {
			if (typeof waitDonelayer != 'undefined') {
				layer.close(waitDonelayer);
			}

			$(obj).removeClass('done').show().unbind().on('mouseover', function () {
				waitlayer = layer.tips('搜索中', this, {
					tips: 1,
					time: 0,
					skin: 'waitlayer'
				});
			}).on('mouseout', function () {
				if (typeof waitlayer != 'undefined') {
					layer.close(waitlayer);
				}
			});
		}
		function _waitDone(obj) {
			if (typeof waitlayer != 'undefined') {
				layer.close(waitlayer);
			}
			$(obj).fadeOut(3000);
			if (typeof waitDonelayer != 'undefined') {
				layer.close(waitDonelayer);
			}
		}

		function up_filter() {
			if ($('#keyword').val() != '') {
				$('#v_clear').show();
			} else {
				$('#v_clear').hide();
			};
		}

		function change_client(obj) {
			if ($(obj).val() == "sqlldr") {
				$(".oracle_ctl").show();
			} else {
				$(".oracle_ctl").hide();
			}
			if ($(obj).val() == "isqlw") {
				$(".sysbase_ctl").show();
			} else {
				$(".sysbase_ctl").hide();
			}
		}

		function save_client() {
			parent.close_dialog();
			var LocalClient_json = {
				"LocalClientId": 0,
				"ProtocolName": null,
				"ClientName": null,
				"ClientProgram": null,
				"ClientIP": null
			};
			if (quick_link == 1) {
				var pro_name = $("#pro_select_div").find('span').text();
			} else {
				if ($("#fList").find('a.prolink.active').length != 0) {
					var tr_index = $('a.prolink.active').parents('tr:first').index();
					//var a_index = $('a.prolink.active').index();
					var pro_name = GLOBAL_ProtocolName;
				} else {
					//var a_index = $('a.prolink.active').index();
					var pro_name = GLOBAL_ProtocolName;
				}
			}
			LocalClient_json.ClientName = $("#sel_client").val();
			if (pro_name == 'SFTP' || pro_name == 'FTP') {
				pro_name = 'FTP';
			}
			if (LocalClient_json.ClientName == "SecureCRT" || LocalClient_json.ClientName == "Putty" || LocalClient_json.ClientName == "XShell") {
				LocalClient_json.ProtocolName = "SSH";
			} else {
				LocalClient_json.ProtocolName = pro_name;
			}
			LocalClient_json.ClientProgram = $("#client_input", parent.document).val();
			if (LocalClient_json.ClientProgram == "") {
				_alert(1, "收藏夹", "请输入客户端路径", $("#client_input", parent.document));
				return false;
			}
			if ($("#client_input", parent.document).prev('label').find('select').val() == 1) LocalClient_json.ClientIP = client_ip_global;
			var msstr = aceg(JSON.stringify(LocalClient_json),se);
			
			$.ajax({
				url: "/bhost/PSave_LocalClient",
				type: "POST",
				async: false,
				data: { a0: se, a1: JSON.stringify(LocalClient_json),m1:msstr },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						$.ajax({
							url: "/bhost/PGet_LocalClient",
							type: "POST",
							async: false,
							data: { a0: se },
							success: function (result) {
								var result = JSON.parse(result);
								if (result.Result) {
									path_array = result.info.data;
									$(".local_client").find('input').iCheck('uncheck');
									$(".local_client").find('input').iCheck('check');
									$("#sel_client").val(LocalClient_json.ClientName).trigger('change');
									$("#connect").click();
								} else {
									_alert(2, '收藏夹', result.ErrMsg);
									return false;
								}
							}
						});
						//$(".local_client").find('input').trigger('change');
						//$("#sel_client").val(LocalClient_json.ClientName).trigger('change');
						/*
						$("#sel_client").children('option:selected').text(LocalClient_json.ClientName);
						$("#select2-sel_client-container").text(LocalClient_json.ClientName);
						$("#select2-sel_client-container").attr('title',LocalClient_json.ClientName);
						$("#connect").click();
						*/
					} else {
						_alert(2, '收藏夹', result.ErrMsg);
						pass = false;
						return false;
					}
				}
			});

		}
		//1->pwd 2->srecretkey
		var AutoPwd;
		function findPwd(type) {
			var ip_tmp = $(".ip_div").find('input').val();
			var account_tmp = $(".user_div").find('input').val();
			var protocol_tmp = $("#pro_select_div").data('value');
			var protocolName_tmp = $("#pro_select_div").find('span').text();
			var accData_tmp = null;
			var AutoPwd;
			if (ip_tmp == "") {
				_alert(2, '收藏夹', "IP不能为空");
				return false;
			}
			if (account_tmp == "") {
				_alert(2, '收藏夹', "用户名不能为空");
				return false;
			}
			bind_SSHkey_xSelect(ip_tmp, protocolName_tmp, account_tmp);
			$.ajax({
				url: '/bhost/getDetail_u',
				type: 'post',
				async: false,
				data: { a0: se, a1: ip_tmp },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						var accData = result.data.AccountSet;
						$.each(accData, function (i, item) {
							$.each(item.HostServiceSet, function (i1, item1) {
								if (item1.ProtocolId == protocol_tmp) {
									if (item.HostAccount.AccountName == account_tmp) {
										accData_tmp = item;
										return false;
									}
								}
							})
							if (accData_tmp != null) {
								return false;
							}
						})
					} else {
						_alert(2, '收藏夹', result.ErrMsg);
					}
				}
			});
			if (accData_tmp == null) {
				_alert(2, '收藏夹', "搜索无结果");
				return false;
			}
			if (type == 1) {
				if (accData_tmp.Password != "") {
					/*$.ajax({
						url:'/bhost/DeRc4',
						type:'post',
						async:false,
						data:{a0:se,a1:accData_tmp.Password},
						success:function(result){
							var result=JSON.parse(result);
							if(result.Result){
								DePwd = result.data;
							}
						}
					})*/
					DePwd = accData_tmp.Password;
					$(".group.pwd.ctr").find('input').val(DePwd);
					AutoPwd = DePwd;
				} else {
					_alert(2, '收藏夹', "搜索无结果");
					return false;
				}
			} else if (type == 2) {
				if (accData_tmp.KeyName != null) {
					var key_name_tmp = accData_tmp.KeyName;
					$.each(SSHkeyData, function (i, item) {
						if (item.Type == 1 && item.SshKeyId == accData_tmp.SshKeyId) {
							key_name_tmp = '默认';
						}
					});
					$("#SSHkey_s1").data('value', accData_tmp.SshKeyId);
					$("#SSHkey_s1").children().find('span').text(key_name_tmp);
				} else {
					_alert(2, '收藏夹', "搜索无结果");
					return false;
				}
			}
		}
		function get_win_path(obj) {
			sesstime = new Date().getTime();

			//{"Session":"1533965498777","ClientName":"xShell","BHostUrl":"https://192.168.0.167"}

			cmd_json = {
				"ClientName": "xShell",
				"Session": "" + sesstime,//
				"BHostUrl": "https://" + document.domain + (location.port!=''?':'+location.port:'')
			}
			var base64_str = '';
			var sesstimet = (new Date()).valueOf()+1;
			cmd_json['sesstimet'] = sesstimet;
			$.ajax({
				url: "/bhost/get_base64",
				type: "POST",
				async: false,
				data: { a0: se, z1: JSON.stringify(cmd_json) },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						if_html_client = result.info;
						base64_str = result.b64;
					} else {
						_alert(1, "收藏夹", result.ErrMsg);
					}
				}
			})


			//window.location.href = 'bhost://cmd&' + base64_str;
			get_regedit('bhost', se,'',sesstimet);
			$('#YuFrame1').remove();
			$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
			$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+base64_str);
			//插入数据库数据
			$.ajax({
				url: "/bhost/insert_usbkeys",
				type: "POST",
				async: false,
				data: { a0: se, z1: sesstime, t1: "find_client_path", u1: ' ', c1: ' ', a10: "收藏夹" },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
					} else {
						_alert(1, "收藏夹", result.ErrMsg);
						return false;
					}
				}
			})

			//循环获取 数据库状态
			var c = 0;

			if_ok_down = setInterval(function () {
				ret = repeat_get_path(sesstime);

				if (ret[0] == 1) {
					clearInterval(if_ok_down);
					$(obj).prev('input').val(ret[1]);
					return 0;
				}
				if (ret[0] == 2) {
					clearInterval(if_ok_down);
					_alert(1, "收藏夹", '浏览失败');
					return 0;
				}
				if (c >= 60) {
					clearInterval(if_ok_down);
				}
				c = c + 1;
			}, 500)
		}
		var cip='{{cip}}';
		function mac_get(){
			sesstime = (new Date()).valueOf();
			cmd_json ={
				"type":"bhostupdate",
				"sesstime": sesstime,//毫秒
				"UrlIp":document.domain+ (location.port!=''?':'+location.port:''),
				"sesstimet":'',
				//"UpdateExe":client_str,
				"session":sesstime,
				"BHUser":''
			}
			cmd_json['login'] =1;
			cmd_json['cip'] = cip;	
			var base64_str = '';
			var sesstimet = (new Date()).valueOf() +1;
			cmd_json['sesstimet'] = sesstimet;
			$.ajax({
				url: "/bhost/get_base64",
				type:"POST",
				async:false,		
				data:{z1:JSON.stringify(cmd_json)},
				success:function(result){
					var result=JSON.parse(result);
					if(result.Result){
						if_html_client = result.info;
						base64_str = result.b64;
					}else{
						_alert(1,"收藏夹",result.ErrMsg);
					}
				}
			})
			get_regedit_mac('bhostupdate','',uCode,sesstimet);
			$('#YuFrame1').remove();
			$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
			$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+base64_str);
		}
		var uCode=window.parent.parent.document.frm.us.value;
		var mac='';
		function get_regedit_mac(typ,se,uCode,sesstimet){
			se = se || ' ';
			uCode = uCode || ' ';
			//插入数据库数据
			$.ajax({
				url: "/bhost/insert_usbkeys",
				type:"POST",
				async:false,
				data:{a0:se,z1:sesstimet,t1:"IfUpdate",u1:' ',c1:' ',a10:""},
				success:function(result){
					var result=JSON.parse(result);
					if(result.Result){
					}else{
						_alert(1,"检查客户端",result.ErrMsg);
						return false;
					}
				}
			})
			//循环获取 数据库状态
			var c = 0;
			var if_ok_down_other = setInterval(function(){
				var  ret = repeat_get_path_other(sesstimet,se);
				var rrrt = ret[1].split(',');
				if(ret[0] == 1 && rrrt[0].toLowerCase() =='true' ){
					if(rrrt.length >1 && rrrt[1] !=''){
						mac = rrrt[1];
					}
					else mac = '';
					clearInterval(if_ok_down_other);
					if(typ =='bhostupdate') {
					}
					return 0;
				}
				if(c >=10){
					clearInterval(if_ok_down_other);
					alertError1(typ,se,uCode);
					if(typ =='bhostupdate') _closeLoading();
					return 0;
				}
				c = c + 1;
			},500)
		}
		var UpdateNoAlert = 1;
		function alertError1(type,se,uCode){
			type = type || "bhost";
			se = se || '';
			uCode = uCode || '';
			var checkg = false;
			$.ajax({
				url: '/bhost/GetNoAlert',
				type: 'post',
				async: false,
				data: { a0: se,a1:uCode},
				success: function (result) {
					var result=JSON.parse(result);
					
					if(result.Result){
						result = result.info;
						if(result == '1'){
							checkg = true;
						}
					}else{
						_alert(2,"更新客户端",result.ErrMsg);
						return false;
					}
				}
			})
			var title = '检测到当前用户没有安装最新的客户端，建议安装';
			var content ='<div class="layer-alert"><i class="alert warning"></i><span>'+title+'</span><div style="margin-top: 5px;"><input type="checkbox" class="form-checkbox" name="" id="layer_div" value="" >不再提示</div></div>';
			
			if(checkg){
				 parent.parent.layer.open({
					type:1,
					title:"运维客户端",
					content:content,
					btn:['下&nbsp;&nbsp;载', '取&nbsp;&nbsp;消'],
					btnAlign:'c',
					closeBtn: false,
					skin:'layer-custom',
					area:['380px','310px'],
					move: false,
					resize: false,
					btn1:function(i){
						parent.parent.layer.close(i);
						location.href='/bhost/download_BHostClient_exe';	
						NoAlert(se,uCode);
					},
					btn2:function(i){
						parent.parent.layer.close(i);
						NoAlert(se,uCode);
					},success: function(i){
						if(type.toLowerCase() =='bhost') $('#layer_div').parent().remove();
						else{
							$('#layer_div').iCheck({
								checkboxClass: 'icheckbox_minimal-blue',
								radioClass: 'iradio_minimal-blue',
								increaseArea: '0' // optional
							});
							$('.layer-alert .warning').css('height',"110px");
						}
					}
				});
			}else{
			}
		}
		function repeat_get_path(sesstime) {
			var st = 0;
			$.ajax({
				url: "/bhost/repeat_get_path",
				type: "POST",
				async: false,
				data: { a0: se, z1: sesstime },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						st = result.info;
						absolute_path = result.path;
					} else {
						_alert(1, "收藏夹", result.ErrMsg);
						return false;
					}
				}
			})
			return [st, absolute_path];
		}
		
		var loadLayer_client = false;
		var check_cilent = false;
		function _showLoading_client(tit){
			var t = tit || '';
			loadLayer_client =  parent.parent.layer.open({
				title:false,
				closeBtn:false,
				content:'<div id="Loading">'+tit+'</div>',
				btn:false,
				skin:'loadingbar',
				area:['250px','250px'],
				move:false,
				resize:false,
				isOutAnim: false,
				shade:[0.1,'#000']
			})
		}
		function _closeLoading_client(){
			if(loadLayer_client) parent.parent.layer.close(loadLayer_client);
		}
	</script>
</body>

</html>
