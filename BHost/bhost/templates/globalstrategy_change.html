<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>manager</title>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<link rel="stylesheet" href="/manage/css/style.css">
	<!--script-->
	<script src="/manage/js/jquery.min.js"></script>
	<script src="/manage/js/jquery.easing.js"></script>
	<script src="/manage/js/layer.js"></script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/common_e.js"></script>
	<!--icheck-->
	<script src="/manage/js/icheck.min.js"></script>
	<!--select2-->
	<script src="/manage/js/select2.full.min.js"></script>
	<script type="text/javascript" src="/manage/js/dialog-plus.js"></script>
	<link rel="stylesheet" href="/manage/css/ui-dialog.css" type="text/css" />
	<link rel="stylesheet" href="/manage/css/G-style.css" type="text/css" />
	<link rel="stylesheet" href="/manage/css/new-head.css">
	<script src="/manage/js/xSelect.js"></script>
	<script src="/manage/js/base64.js"></script>
</head>
<style>
	.btns {
        background-color: rgba(255,255,255,1);
    }
    .as {
        width: 190px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        float: left;
        margin-top: 7px;
    }

    .h-content2 .form-item {
        height: auto;
        padding: 20px 0 10px;
        min-height: 38px;
        padding: 5px 5px 5px 80px;
        width: 100%;
    }

    .h-content2 .form-tag {
        float: left;
        width: 10em;
        text-align: right;
        color: #000;
        line-height: 28px;
    }

    .h-content2 .form-c {
        padding-left: 0px;
        position: relative;
    }

    .h-content2 .form-text {
        width: 200px;
        padding-right: 8px;
    }

    .h-content2 .rzj {
        float: right;
        margin-right: 40px;
        color: #000;
        margin-top: -4px;
    }

    .h-content2 .form-tip {
        padding-left: 48px;
    }

    a.btn-normal1 {
        display: inline-block;
        width: 90px;
        height: 32px;
        border: 1px solid #DDD;
        text-align: center;
        line-height: 32px;
        border-radius: 18px;
        margin: 0 10px;
        background-color: #fff;
        transition: background-color 0.4s;
        color: #7c7c7c;
    }

    a.btn-normal1:hover {
        background-color: #8d808a;
        color: #fff;
    }

    .ui-dialog-content .c-form-host {
        min-width: 780px;
    }
    .filter .selector.selector-multiple:after {
        content: '';
        display: block;
        border-color: #888 transparent transparent transparent;
        border-style: solid;
        border-width: 5px 4px 0 4px;
        height: 0;
        width: 0;
        overflow: hidden;
        position: absolute;
        margin: 12px 0 0 9em;
    }
    .c-table {
        padding: 20px 10px;
    }

    .c-form-host.col3 .form-item {
        width: 33.3%;
    }
    .h-top {
        width: 100%;
        height: 34px;
        position: absolute;
        background-color: #e6e6e6;
        border-bottom: none;
    }
    .c-form-host.col3 .form-item-100 {
        width: 100%;
    }

    .c-form-host.col3 .form-item .form-text {
        width: 100px;
        padding-right: 8px;
    }

    .c-form-host.col3 .form-item .h-content3 {
        padding: 0;
    }

    .select2-container--open {
        z-index: 9999999;
    }

    .blank_in {
        width: 12px;
    }
    .g-tsel:after {
        border-width: 4px;
        right: 7px;
        top: 9px;
    }
    .g-tsel1:after {
        right: 11px;
    }
    .h-content2 span.checkbox:not(.disabled) {
        cursor: pointer;
    }
    .h-content2 span.disabled {
        cursor: default;
    }
</style>
<!---->
<div class="mainer">
	<div class="container" id="step1">
		<div class="c-top">
			<div class="c-title">
				<div class="manual-head">
					<div class="manual-title">
						<span id="global_reload" onclick="">全局策略</span>
						<i class="hostpwdstrategy_icon"></i>
					</div>
				</div>
			</div>
		</div>

		<div class="c-cont">
			<div class="c-wrap" style="padding: 10px 0 0">
				<div class="c-exp" style="margin: -1px auto;">

					<div class="h-explorer">
						<div class="G-top">
							<div class="G-box1"></div>
							<strong>&nbsp;安全策略</strong>
						</div>

						<div class="h-content2" style="height: auto;width: 100%;overflow: hidden;padding: 20px 0 0;">
							<div class="form-item">
								<span class="form-tag"><em class="imp">*</em>密码最小长度：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="PwdMinLen" name="PwdMinLen" maxlength="2" style="width:164px;"
									 onkeyup="dataCheck1(this);" onblur="dataCheck1(this);">
									<p class="form-tip" style="margin-left: 93px;">长度值在6到32之间</p>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">密码使用期限：</span>
								<div class="form-c">
									<label class="form-label" style="margin-top:0px;">
										<input id="IfPwdUseExpire" name="IfPwdUseExpire" class="form-checkbox" type="checkbox">

										<span style="vertical-align:middle;font-size:14px;">启用</span>

									</label>
									<label class="form-label" style="padding-left:20px;margin-top:0px;">
										<input id="PwdUseExpire" name="PwdUseExpire" class="form-text" type="text" style="width:54px;" maxlength="5"
										 onkeyup="dataCheck(this,0, 365);" onblur="dataCheck(this,0, 365);">
										<span style="vertical-align:middle;font-size:14px;">天，过期前</span>
										<input id="PwdUseExpireNotify" name="PwdUseExpireNotify" class="form-text" type="text" style="width:54px;"
										 maxlength="5" onkeyup="dataCheck1(this);" onblur="dataCheck1(this);">
										<span style="vertical-align:middle;font-size:14px;">天将自动提醒（0表示不提醒）</span>
									</label>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">密码复杂度要求：</span>
								<div class="form-c">
									<label class="form-label" style="margin-top:5px;">
										<input id="IfPwdComplex" name="IfPwdComplex" class="form-checkbox" type="checkbox">

										<span style="vertical-align:middle;font-size:14px;">启用</span>

									</label>
									<label class="form-label" style="padding-left:20px;margin-top:0px;">
										<label class="form-label">
											<input id="IfPwdIncUpperApha" name="IfPwdIncUpperApha" class="form-checkbox" type="checkbox">
											<span style="vertical-align:middle;font-size:14px;">大写字母</span>
										</label>
										<label class="form-label" style="    margin-left: 10px;">
											<input id="IfPwdIncLowerApha" name="IfPwdIncLowerApha" class="form-checkbox" type="checkbox">
											<span style="vertical-align:middle;font-size:14px;">小写字母</span>
										</label>
										<label class="form-label" style="    margin-left: 10px;">
											<input id="IfPwdIncNumber" name="IfPwdIncNumber" class="form-checkbox" type="checkbox">
											<span style="vertical-align:middle;font-size:14px;">数字</span>
										</label>
										<label class="form-label" style="    margin-left: 10px;">
											<input id="IfPwdIncSpecialChar" name="IfPwdIncSpecialChar" class="form-checkbox" type="checkbox">
											<span style="vertical-align:middle;font-size:14px;">特殊字符</span>
										</label>
									</label>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">密码安全策略：</span>
								<div class="form-c">
									<label class="form-label" style="margin-top:-1px;">
										<input id="IfPwdUnRepeat" name="IfPwdUnRepeat" class="form-checkbox" type="checkbox">

										<span style="vertical-align:middle;font-size:14px;">启用</span>

									</label>
									<label class="form-label" style="padding-left:20px;margin-top: 0px">
										<span style="vertical-align:middle;font-size:14px;">不能与前</span>
										<input id="PwdUnRepeat" name="PwdUnRepeat" class="form-text" type="text" style="width:54px;" maxlength="1"
										 onkeyup="dataCheck(this, 1, 5);" onblur="dataCheck(this,1,5);">
										<span style="vertical-align:middle;font-size:14px;">次密码重复 次数在1到5之间</span>
									</label>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">账户锁定策略：</span>
								<div class="form-c">
									<label class="form-label" style="margin-top:0px;">
										<input id="IfPwdErrorLock" name="IfPwdErrorLock" class="form-checkbox" type="checkbox">

										<span style="vertical-align:middle;font-size:14px;">启用</span>

									</label>
									<label class="form-label" style="padding-left:20px;margin-top:0px;">
										<input id="PwdErrorLockExpire" name="PwdErrorLockExpire" class="form-text" type="text" style="width:54px;"
										 maxlength="5" onkeyup="dataCheck1(this);" onblur="dataCheck1(this);">
										<span style="vertical-align:middle;font-size:14px;">分钟内连续输错</span>
										<input id="PwdErrorLockNumber" name="PwdErrorLockNumber" class="form-text" type="text" style="width:54px;"
										 maxlength="5" onkeyup="dataCheck1(this);" onblur="dataCheck1(this);">
										<span style="vertical-align:middle;font-size:14px;">次即锁定账户，锁定账户可以由管理员解锁</span>
									</label>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">账户自动解锁：</span>
								<div class="form-c">
									<label class="form-label" style="margin-top:0px;">
										<input id="IfAccountAutoUnLock" name="IfAccountAutoUnLock" class="form-checkbox" type="checkbox">

										<span style="vertical-align:middle;font-size:14px;">启用</span>

									</label>
									<label class="form-label" style="padding-left:20px;margin-top:0px;">
										<input id="AccountAutoUnLock" name="AccountAutoUnLock" class="form-text" type="text" style="width:54px;"
										 maxlength="3" onkeyup="dataCheck1(this);" onblur="dataCheck1(this);">
										<span style="vertical-align:middle;font-size:14px;">分钟后自动解锁 时限在10到120之间</span>
									</label>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">登录验证码：</span>
								<div class="form-c">
									<label class="form-label" style="margin-top:5px;">
										<input id="IfNeedCode" name="IfNeedCode" class="form-checkbox" type="checkbox" name="">
										<span style="vertical-align:middle;font-size:14px;">启用</span>
									</label>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">导出加密：</span>
								<div class="form-c">
									<label class="form-label" style="margin-top:0px;">
										<input id="DownFilePwd" name="DownFilePwd" class="form-checkbox" type="checkbox" name="">
										<span style="vertical-align:middle;font-size:14px;">启用</span>
									</label>
									<label class="form-label" style="padding-left:20px;margin-top:0px;" id="DownFilePwd_label">
										<span style="vertical-align:middle;font-size:14px;">加密密码：</span>
										<input id="DownFilePwd_value" name="DownFilePwd_value" class="form-text" type="password" style="width:162px;"
										 maxlength="128" onkeyup="" onblur="">
										<span style="vertical-align:middle;font-size:14px;padding-left: 15px;">确认密码：</span>
										<input id="DownFilePwd_value2" name="DownFilePwd_value2" class="form-text" type="password" style="width:162px;"
										 maxlength="128" onkeyup="" onblur="">
									</label>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="c-exp" style="margin-top: -1px;">
					<div class="h-explorer">
						<div class="G-top">
							<div class="G-box1"></div>
							<strong>&nbsp;运维策略</strong>
						</div>
						<div class="h-content2" style="height: auto;width: 100%;overflow: hidden;padding: 20px 0 0;">
							<div class="form-item">
								<span class="form-tag">登录限制：</span>
								<div class="form-c" style="margin-left: 100px;">
									<label class="form-label">
										<input type="checkbox" class="form-checkbox" id="LoginUniqueIP" name="LoginUniqueIP">
										<span style="vertical-align:middle;font-size:14px;">启用&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;运维用户同一时间只能从一个IP登录</span>
									</label>
								</div>
							</div>
							<div class="form-item" style="">
								<span class="form-tag">超时设置：</span>
								<div class="form-c" style="margin-left: 100px;">
									<label class="form-label" style="margin-top:0px;">
										<input id="timeout_check" name="timeout_check" class="form-checkbox" type="checkbox">
										<span style="vertical-align:middle;font-size:14px;">启用&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;会话</span>
									</label>
									<label class="form-label" style="margin-top:0px;">
										<input type="text" value="0" class="form-text" id="ConnectTimeOut" name="ConnectTimeOut" onblur="NumCheck(this);"
										 style="width:24px;padding:0 3px 0 3px">
										<span style="vertical-align:middle;font-size:14px;">分钟没操作就断开连接</span>
									</label>
								</div>
							</div>
							<div class="form-item" style="">
								<span class="form-tag">映射端口：</span>
								<div class="form-c" style="margin-left: 100px;">
									<input type="text" value="0" class="form-text" id="MapPort" name="MapPort" onblur="NumCheck(this);" style="width:64px;padding:0 5px 0 5px">
									<p class="form-tip" style="padding-left:42px;">0-65535之间</p>
								</div>
							</div>
							<div class="form-item" style="">
								<span class="form-tag">运维访问通道：</span>
								<div class="form-c" style="margin-left: 100px;">
									<label class="form-label">
										<input id="IsTunnel" name="IsTunnel" class="form-checkbox" type="checkbox">
										<span style="vertical-align:middle;font-size:14px;">启用&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;所有协议统一使用运维访问通道模式访问</span>
									</label>
								</div>
							</div>
							<div class="form-item" style="">
								<span class="form-tag">文件传输记录：</span>
								<div class="form-c" style="margin-left: 100px;">
									<label class="form-label" style="margin-top:0px;">
										<input id="FileRecordOpened" name="FileRecordOpened" class="form-checkbox" type="checkbox">
										<span style="vertical-align:middle;font-size:14px;">启用&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;文件记录 磁盘限额</span>
									</label>
									<label class="form-label" style="margin-top:0px;">
										<input id="FileRecordDiskLimit" name="FileRecordDiskLimit" onblur="NumCheck(this);" value="0" class="form-text"
										 type="text" style="width:24px;padding:0 3px 0 3px;">
										<span style="vertical-align:middle;font-size:14px;">GB</span>
									</label>
								</div>
							</div>
							<div class="form-item" style="">
								<span class="form-tag">隐藏主机IP：</span>
								<div class="form-c" style="margin-left: 100px;">
									<label class="form-label">
										<input id="IfHiddenHostIP" name="IfHiddenHostIP" class="form-checkbox" type="checkbox">
										<span style="vertical-align:middle;font-size:14px;">启用&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;隐藏运维用户主机列表IP</span>
									</label>
								</div>
							</div>

							<div class="form-item" style="">
								<span class="form-tag">账号密码保存：</span>
								<div class="form-c" style="margin-left: 100px;">
									<label class="form-label" style="margin-top:0px;">
										<select class="filter-select" id="IsRemindSaveUser" style="width: 84px;">
											<option value="0">提示</option>
											<option value="1">保存</option>
											<option value="2">不保存</option>
										</select>
									</label>
								</div>
							</div>

							<div class="form-item" style="">
								<span class="form-tag">应用发布访问控制：</span>
								<div class="form-c" style="margin-left: 100px;">
									<label class="form-label">
										<input id="AccControlOpened" name="AccControlOpened" class="form-checkbox" type="checkbox">
										<span style="vertical-align:middle;font-size:14px;">启用&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;应用发布不允许访问除目标主机外的其他IP</span>
									</label>
								</div>
							</div>
							<div class="form-item" style="">
								<span class="form-tag">SYSLOG发送：</span>
								<div class="form-c" style="margin-left: 100px;">
									<label class="form-label">
										<input id="SyslogOpened" name="SyslogOpened" class="form-checkbox" type="checkbox">
										<span class="" style="vertical-align:middle;font-size:14px;">启用&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将运维日志通过SYSLOG外发</span>
									</label>
								</div>
							</div>

							<div class="form-item" style="">
								<span class="form-tag">登录审批：</span>
								<div class="form-c" style="float:left;">
									<label class="form-label">
										<input id="EnableApprove_check" name="" class="form-checkbox" type="checkbox">
										<span style="vertical-align:middle;font-size:14px;">启用</span>
									</label>
								</div>
								<div class="form-c" id="Approve_select" style="float:left;display:none;padding-left: 15px;">
									<div class="item">
										<div class="approve_Select" id="EnableApprove" style="margin-left: 10px;"></div>
									</div>
								</div>
							</div>

							<div class="form-item" style="">
								<span class="form-tag">访问备注：</span>
								<div class="form-c" style="margin-left: 100px;">
									<label class="form-label">
										<input id="IfGiveAccessInfo" name="IfGiveAccessInfo" class="form-checkbox" type="checkbox">
										<span style="vertical-align:middle;font-size:14px;">启用</span>
									</label>
								</div>
							</div>
							<div class="form-item" style="">
								<span class="form-tag">协同登录：</span>
								<div class="form-c" style="margin-left: 100px;">
									<label class="form-label">
										<input id="IfForceAidance" name="IfForceAidance" class="form-checkbox" type="checkbox">
										<span style="vertical-align:middle;font-size:14px;">启用</span>
									</label>
								</div>
							</div>

							<div class="form-item" style="">
								<span class="form-tag">登录告警：</span>
								<div class="form-c" style="float:left;">
									<label class="form-label" style="margin-top:0px;">
										<select class="filter-select" id="EnableAlarm" onchange="change_alarm(this);" style="width: 115px;">
											<option value="0">不告警</option>
											<option value="1">异常登录告警</option>
											<option value="2">登录告警</option>
											<option value="3">全部告警</option>
										</select>
									</label>
								</div>
								<div class="form-c" id="Alarm_select" style="float:left;display:none;padding-left: 15px;">
									<div class="item" style="">
										<div class="" id="EventAlarmInfoId" style="margin-left: 10px;"></div>
									</div>
								</div>
							</div>
							<div class="form-item" style="">
								<span class="form-tag">指定应用发布：</span>
								<div class="form-c" style="float:left;">
									<label class="form-label">
										<input id="AccIPEnable" name="" class="form-checkbox" type="checkbox">
										<span style="vertical-align:middle;font-size:14px;">启用</span>
									</label>
								</div>
								<div class="form-c" id="AccIP_select_div" style="float:left;display:none;padding-left: 15px;width: 800px;">
									<div class="form-c" style="width:265px;padding: 0;float: left;margin-bottom:10px;">
										<div class="accIP_type" style="float:left;">
											<select class="filter-select" name="accIP_type" id="accIP_type" style="width:80px;border-bottom-right-radius: 0px;border-top-right-radius: 0px;float:left;"
											tabindex="-1" aria-hidden="false" onchange="change_acc_type(this);">
												<option value="1">内置</option>
												<option value="2" selected>外置</option>
											</select>
										</div>
										<div class="in_ip" style="float:left;margin-left: -1px;display:none;">
											<select class="filter-select" name="in_ip" id="in_ip" style="width:138px;border-bottom-right-radius: 0px;border-top-right-radius: 0px;float:left;"
											tabindex="-1" aria-hidden="false">
												<option value="1">1</option>
												<option value="2">2</option>
												<option value="1">3</option>
												<option value="2">4</option>
												<option value="1">5</option>
												<option value="2">6</option>
												<option value="1">7</option>
												<option value="2">8</option>
												<option value="1">9</option>
												<option value="2">10</option>
												<option value="1">11</option>
												<option value="2">12</option>
												<option value="1">13</option>
												<option value="2">14</option>
												<option value="1">15</option>
												<option value="2">16</option>
												<option value="1">17</option>
												<option value="2">18</option>
												<option value="1">19</option>
												<option value="2">20</option>
											</select>
										</div>
										<div class="form-c" id="accIP" style="border-top-right-radius: 5px;float:left;padding:0px;border-bottom-right-radius: 5px;"></div>
										<a href="javascript:;" class="ctrl add" id="add4" style="display: inline;display: inline;float: left;width: 15px;height: 15px;overflow: hidden;background: url(/manage/images/icon-ctr.png) no-repeat 0 0;background-position: 0 -15px;margin: 6px 0 0 10px;" onclick="_addaccIP(this);" style=""></a>
									</div>
								</div>
							</div>

							<!--告警-->
							<div class="dialog-cont" id="eventinfo_suspend" style="display:none;">
								<div class="container">
									<div class="c-cont2" style="min-height:410px;max-height:280px">
										<div class="c-form" style="padding: 0 0 0 0;">
											<div class="form">
												<div class="form-item" style="float: left;width: 43%;margin-left:50px;">
													<span class="form-tag" style="width:50px;"><em class="imp">*</em>名称：</span>
													<div class="form-c" style="padding-left:0px;">
														<input type="text" class="form-text" id="d_n" name="d_n" onblur="regCheck(this,nameReg);" maxlength="128"
														 style="margin-left:8px;"><i class="v-check"></i>
														<p class="form-tip" style="margin-left:52px;">特殊字符仅支持下划线、横杠、小数点</p>
													</div>
												</div>
												<div class="form-item" style="width: 50%;float:left;">
													<span class="form-tag" style="width: 58px;padding-left: 0px;"><em class="imp" id="Description_imp" style="display:none;">*</em>描述：</span>
													<div class="form-c" style="padding-left:0px;">
														<input type="text" class="form-text" id="Description" name="Description" maxlength="1024" style="width: 183px;">
													</div>
												</div>
												<div class="form-item" style="float: left;width: 24%;margin-left:50px">
													<span class="form-tag" style="width:50px;">等级：</span>
													<div class="form-c" style="padding-left:0px;">
														<select class="filter-select" name="EventLevel" id="EventLevel" style="width:50px;margin-left:9px;">
															<option value="0" selected>无</option>
															<option value="1">低</option>
															<option value="2">中</option>
															<option value="3">高</option>
														</select>
													</div>
												</div>
												<div class="form-item" style="width: 29.2%;float: left;">
													<span class="form-tag" style="width: 62px;">类型：</span>
													<div class="form-c" style="padding-left: 70px;">
														<select class="filter-select" name="EventType" id="EventType" style="width:100px;">
															<option value="0" selected>无</option>
															<option value="1">违规操作</option>
															<option value="2">高危操作</option>
															<option value="3">登录异常</option>
														</select>
													</div>
												</div>

												<div class="form-item" style="width: 30%;float: left;">
													<span class="form-tag" style="width: 95px;">告警方式：</span>
													<div class="form-c" style="padding-left: 103px;">
														<select class="filter-select" name="AlarmAction" id="AlarmAction" style="width:90px;">
															<option value="0" selected>无</option>
															<option value="1">邮件</option>
															<!--
															<option value="2" >短信猫</option>
															-->
															<option value="3">短信</option>
															<option value="4">snmp</option>
															<option value="5">syslog</option>
														</select>
													</div>
												</div>

												<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="mail1_div">
													<span class="form-tag" style="width:50px;">默认：</span>
													<div class="form-c" style="padding-left:0px;">
														<div class="" id="mail_div1" style="margin-left: 58px;"></div>
														<!--
														<input type="text" class="form-text" id="mail_input1" name="mail_input1" maxlength="128" style="margin-left:8px;"><i class="v-check"></i>
														-->
													</div>
												</div>
												<div class="form-item" style="width: 50%;float:left;display:none;" id="mail2_div">
													<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
													<div class="form-c" style="padding-left:0px;">
														<div class="" id="mail_div2" style="margin-left: 10px;"></div>
														<!--
														<input type="text" class="form-text" id="mail_input2" name="mail_input2" maxlength="1024" style="width: 183px;">
														-->
													</div>
												</div>

												<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="smsm1_div">
													<span class="form-tag" style="width:50px;">默认：</span>
													<div class="form-c" style="padding-left:0px;">
														<div class="" id="smsm_div1" style="margin-left: 58px;"></div>
													</div>
												</div>
												<div class="form-item" style="width: 50%;float:left;display:none;" id="smsm2_div">
													<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
													<div class="form-c" style="padding-left:0px;">
														<div class="" id="smsm_div2" style="margin-left: 10px;"></div>
													</div>
												</div>

												<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="smssvr1_div">
													<span class="form-tag" style="width:50px;">默认：</span>
													<div class="form-c" style="padding-left:0px;">
														<div class="" id="smssvr_div1" style="margin-left: 58px;"></div>
													</div>
												</div>
												<div class="form-item" style="width: 50%;float:left;display:none;" id="smssvr2_div">
													<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
													<div class="form-c" style="padding-left:0px;">
														<div class="" id="smssvr_div2" style="margin-left: 10px;"></div>
													</div>
												</div>

												<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="snmp1_div">
													<span class="form-tag" style="width:50px;">默认：</span>
													<div class="form-c" style="padding-left:0px;">
														<div class="" id="snmp_div1" style="margin-left: 58px;"></div>
													</div>
												</div>
												<div class="form-item" style="width: 50%;float:left;display:none;" id="snmp2_div">
													<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
													<div class="form-c" style="padding-left:0px;">
														<div class="" id="snmp_div2" style="margin-left: 10px;"></div>
													</div>
												</div>

												<div class="form-item" style="float: left;width: 43%;margin-left:50px;display:none;" id="syslog1_div">
													<span class="form-tag" style="width:50px;">默认：</span>
													<div class="form-c" style="padding-left:0px;">
														<div class="" id="syslog_div1" style="margin-left: 58px;"></div>
													</div>
												</div>
												<div class="form-item" style="width: 50%;float:left;display:none;" id="syslog2_div">
													<span class="form-tag" style="width: 58px;padding-left: 0px;">备用：</span>
													<div class="form-c" style="padding-left:0px;">
														<div class="" id="syslog_div2" style="margin-left: 10px;"></div>
													</div>
												</div>

												<div class="form-item" style="float: left;padding: 20px 0 0px;">
													<span class="form-tag" id="AlarmReceiver_span" name="AlarmReceiver_span" style="display:none;width: 100px;float: left;"><em
														 class="imp" id="AlarmReceiver_imp">*</em>信息接收者：</span>
													<div class="h-content3" style="width: 605px;padding-left: 8px;float: left;display:none;padding-top: 0px;padding-bottom: 0px;max-height:76px;"
													 name="label_list" id="label_list">
														<div class="item" style="padding-top:0px;width:195px;" id="admin_check" name="admin_check">
															<select class="filter-select" name="admin_select" id="admin_select" style="width:160px;">
																<option value="0" selected>请选择</option>
															</select>
															<i class="ctrl add" style="margin-left: 0px;" onclick="_addadmin(this,1)"></i>
														</div>
													</div>
													<div class="" style="width: 84.8%;display:none;float:left;max-height:73px;margin-left:72px" id="AlarmReceiver_div"
													 name="AlarmReceiver_div">
														<label class="form-label" name="AlarmReceiver" id="AlarmReceiver" style="float: left;margin-left: 35px;margin-top: 3px;">
															<input class="form-checkbox" type="checkbox" name="AlarmReceiver_check" id="AlarmReceiver_check">
														</label>
														<span style="vertical-align:middle;font-size:14px;float: left;margin-top: 4px;">自定义：</span>
														<div class="h-content3" style="padding: 0px;display:none;max-height: 76px;" id="AlarmReceiver_text" name="AlarmReceiver_text">
															<div id="AlarmReceiver_input" name="AlarmReceiver_input" class="item" style="padding-top: 0px;width: 260px;">
																<input type="text" class="form-text" style="width: 193px;">
																<i class="ctrl add" onclick="_addphone_or_email(this);" style="margin-left: 0px;"></i>
															</div>
														</div>
													</div>
													<div class="h-content3" style="width: 605px;padding-left: 8px;float: left;display:none;padding-top: 0px;padding-bottom: 0px;max-height:76px;"
													 name="label_list1" id="label_list1">
														<div class="item" style="padding-top:0px;width:195px;" id="admin_check1" name="admin_check1">
															<select class="filter-select" name="admin_select1" id="admin_select1" style="width:160px;">
																<option value="0" selected>请选择</option>
															</select>
															<i class="ctrl add" style="margin-left: 0px;" onclick="_addadmin(this,2)"></i>
														</div>
													</div>
													<div class="" style="width: 84.8%;display:none;float:left;max-height:73px;margin-left:72px;" id="AlarmReceiver_div1"
													 name="AlarmReceiver_div1">
														<label class="form-label" name="AlarmReceiver1" id="AlarmReceiver1" style="float: left;margin-left: 35px;margin-top: 3px;">
															<input class="form-checkbox" type="checkbox" name="AlarmReceiver_check1" id="AlarmReceiver_check1">
														</label>
														<span style="vertical-align:middle;font-size:14px;float: left;margin-top: 4px;">自定义：</span>
														<div class="h-content3" style="padding: 0px;display:none;max-height: 76px;" id="AlarmReceiver_text1" name="AlarmReceiver_text1">
															<div id="AlarmReceiver_input1" name="AlarmReceiver_input1" class="item" style="padding-top: 0px;width: 260px;">
																<input type="text" class="form-text" style="width: 193px;">
																<i class="ctrl add" onclick="_addphone_or_email(this);" style="margin-left: 0px;"></i>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="btns" style="margin-bottom:-20px;">
									<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
									<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
								</div>
							</div>
							<!--邮件-->
							<div class="dialog-cont" id="mail_suspend" style="display:none;">
								<div class="c-cont2">
									<div class="c-form" style="padding:0;">
										<div class="form">
											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>配置名称：</span>
												<div class="form-c">
													<input id="SmtpConfigName" name="SmtpConfigName" class="form-text" maxlength="128" type="text" onblur="NameCheck(this);"><i
													 class="v-check"></i>
													<p class="form-tip" style="width: 270px;margin-left: 70px;">特殊字符仅支持下划线、横杠、小数点</p>
												</div>
											</div>
											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>服务器地址：</span>
												<div class="form-c">
													<input id="SmtpServer" name="SmtpServer" class="form-text" type="text" style="width:238px;" maxlength="128"
													 onblur="IPCheck_DNS(this);"><i class="v-check"></i>
												</div>
											</div>
											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>发送邮箱地址：</span>
												<div class="form-c">
													<input id="SenderEmail" name="SenderEmail" class="form-text" maxlength="128" type="text" onblur="EmailCheck(this);fill_text();"><i
													 class="v-check"></i>
												</div>
											</div>

											<div class="form-item">
												<span class="form-tag">服务器账号：</span>
												<div class="form-c">
													<input id="Sender" name="Sender" class="form-text" type="text" style="width: 238px;" maxlength="128"
													 onblur="fill_text();"><i class="v-check"></i>
												</div>
											</div>

											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>服务器验证：</span>
												<div class="form-c" style="float:left;width:100px;padding: 4px 0 0 8px;">
													<input id="ServerVerify_off" name="ServerVerify" class="form-radio" type="radio" checked="checked">
													<span style="vertical-align:middle;font-size:14px;">否</span>
													<input id="ServerVerify_on" name="ServerVerify" class="form-radio" type="radio">
													<span style="vertical-align:middle;font-size:14px;">是</span>
												</div>
												<div class="form-c" style="float:left;padding: 0px 0 0 0;display:none;">
													<input id="SenderEmailPass" name="SenderEmailPass" class="form-text" type="password">
												</div>
											</div>

											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>附件大小：</span>
												<div class="form-c">
													<input id="AttachMaxLimit" name="AttachMaxLimit" value="0" class="form-text" onblur="NumCheck(this);" type="text"
													 style="width: 34px;padding: 0 3px 0px 3px;" maxlength="5">
													<span style="vertical-align:middle;font-size:14px;">M(应用于邮件报表发送)</span>
												</div>
											</div>

											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>编码方式：</span>
												<div class="form-c">
													<select class="filter-select" id="EnCode_mail" style="width:90px;">
														<option value="0">UTF-8</option>
														<option value="1">GBK</option>
													</select>
												</div>
											</div>
											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>方式：</span>
												<div class="form-c">
													<select class="filter-select" id="Flag_mail" style="width:90px;">
														<option value="2">默认</option>
														<option value="1">备用</option>
														<option value="0">其他</option>
													</select>
												</div>
											</div>
										</div>
									</div>
									<div class="c-form">
										<div class="btns" style="margin-bottom: -20px;">
											<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
											<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
										</div>
									</div>
								</div>
							</div>
							<!--短信猫-->
							<div class="dialog-cont" id="smsm_suspend" style="display:none;">
								<div class="c-cont2" style="max-height:416px;">
									<div class="c-form" style="padding-bottom:10px;width: 500px;" id="smsmset">
										<div class="form">
											<div class="sel-type1" style="float: left;width: 100%;">
												<div class="form-item" style="float:left;">
													<span class="form-tag" style="width: 90px;"><em class="imp">*</em>配置名称：</span>
													<div class="form-c" style="padding: 0 0;">
														<input id="SmsMConfigName" name="SmsMConfigName" class="form-text" style="width:230px;" type="text"
														 onblur="NameCheck(this);" maxlength="128"><i class="v-check"></i>
														<p class="form-tip" style="width: 270px;margin-left: 84px;">特殊字符仅支持下划线、横杠、小数点</p>
													</div>
												</div>
												<div class="form-item" style="float:left;">
													<span class="form-tag" style="width: 90px;"><em class="imp">*</em>短信中心：</span>
													<div class="form-c" style="padding: 0 0;">
														<input id="SmsMSender" name="SmsMSender" class="form-text" type="text" style="width:140px;" maxlength="30"
														 onblur="NumCheck(this)"><i class="v-check"></i>
													</div>
												</div>
												<div class="form-item" style="float:left;">
													<span class="form-tag" style="width: 93px;"><em class="imp">*</em>发送限制：</span>
													<div class="form-c" style="padding: 0 0;width: 270px;">
														<span style="vertical-align:middle;font-size:14px;">每月</span>
														<input id="SmsMLimit" name="SmsMLimit" value="0" class="form-text" onblur="limitCheck(this);" type="text"
														 style="width: 34px;padding: 0 3px 0px 3px;" maxlength="9">
														<span style="vertical-align:middle;font-size:14px;">条(0为不限制)</span>
													</div>
												</div>
												<div class="form-item" style="float:left;">
													<span class="form-tag" style="width:90px;"><em class="imp">*</em>编码方式：</span>
													<div class="form-c" style="padding:0;">
														<select class="filter-select" id="EnCode_smsm" style="width:90px;">
															<option value="0">UTF-8</option>
															<option value="1">GBK</option>
														</select>
													</div>
												</div>
												<div class="form-item" style="float:left;">
													<span class="form-tag" style="width:90px;"><em class="imp">*</em>方式：</span>
													<div class="form-c" style="padding:0;">
														<select class="filter-select" id="Flag_smsm" style="width:90px;">
															<option value="2">默认</option>
															<option value="1">备用</option>
															<option value="0">其他</option>
														</select>
													</div>
												</div>
												<!--
												
												-->
											</div>
										</div>
									</div>
									<div class="c-form">
										<div class="btns" style="margin-bottom: -20px;">
											<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
											<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
										</div>
									</div>
								</div>
							</div>
							<!--短信网关-->
							<div class="dialog-cont" id="smssvr_suspend" style="display:none;">
								<div class="c-cont2" style="min-height:575px;">
									<div class="c-form" style="padding-bottom:10px;padding: 0 0 0 50px;">
										<div class="form">
											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>配置名称：</span>
												<div class="form-c">
													<input id="SmsSvrConfigName" name="SmsSvrConfigName" style="width: 267px;" class="form-text" type="text"
													 onblur="NameCheck(this);" maxlength="128"><i class="v-check"></i>
													<p class="form-tip" style="width: 270px;margin-left: -5px;">特殊字符仅支持下划线、横杠、小数点</p>
												</div>
											</div>
											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>数据库类型：</span>
												<div class="form-c">
													<select name="" id="SmsSvrDBType" class="type-select" style="width:299px">
														<option value="1">ORACLE</option>
														<option value="2">MSSQL</option>
														<option value="3">MYSQL</option>
														<option value="4">SYBASE</option>
													</select>
												</div>
											</div>
											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>服务器地址：</span>
												<div class="form-c">
													<input id="SmsSvrDBServerIP" name="SmsSvrDBServerIP" class="form-text" type="text" style="width: 124px;"
													 onblur="IPCheck(this);"><i class="v-check" style="margin-top: 9px;"></i>
													<span style="width: 50px;text-align: right;color: #000;line-height: 28px;"><em class="imp" style="color: #F00;font-style: normal;">*</em>端口：</span>
													<input id="SmsSvrDBPort" name="SmsSvrDBPort" class="form-text" type="text" maxlength="5" style="width: 47px;"
													 onblur="NumCheck(this);"><i class="v-check" style="margin-top: 9px;"></i>
													<p class="form-tip" style="width: 78px;margin-left: 216px;">0-65535之间</p>
												</div>
											</div>
											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>账号：</span>
												<div class="form-c">
													<input id="SmsSvrDBUserName" name="SmsSvrDBUserName" style="width: 267px;" class="form-text" type="text"
													 onblur="NameCheck(this);" maxlength="128"><i class="v-check"></i>
												</div>
											</div>
											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>密码：</span>
												<div class="form-c">
													<input id="SmsSvrDBPassword" name="SmsSvrDBPassword" class="form-text" type="password" style="width: 291px;padding: 0 3px 0px 3px;"
													 maxlength="128">
												</div>
											</div>
											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>数据库：</span>
												<div class="form-c">
													<input id="SmsSvrDBDatabase" name="SmsSvrDBDatabase" class="form-text" type="text" maxlength="128" style="width: 267px;">
												</div>
											</div>
											<div class="form-item">
												<span class="form-tag"><em class="imp">*</em>短信sql语句模板：</span>
												<div class="form-c">
													<input id="SmsSvrDBInsertTemp" name="SmsSvrDBInsertTemp" class="form-text" type="text" onblur="temp_check(this);"
													 maxlength="1024" style="width: 267px;"><i class="v-check"></i>
												</div>
											</div>
											<div class="form-item">
												<span class="form-tag" style=""><em class="imp">*</em>编码方式：</span>
												<div class="form-c" style="">
													<select class="filter-select" id="EnCode_smssvr" style="width:90px;">
														<option value="0">UTF-8</option>
														<option value="1">GBK</option>
													</select>
												</div>
											</div>
											<div class="form-item">
												<span class="form-tag" style=""><em class="imp">*</em>方式：</span>
												<div class="form-c" style="">
													<select class="filter-select" id="Flag_smssvr" style="width:90px;">
														<option value="2">默认</option>
														<option value="1">备用</option>
														<option value="0">其他</option>
													</select>
												</div>
											</div>
										</div>
									</div>
									<div class="btns" style="margin-bottom:-20px;">
										<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
										<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
									</div>
								</div>
							</div>
							<!--SNMP-->
							<div class="dialog-cont" id="snmp_suspend" style="display:none;">
								<div class="c-cont2" style="max-height: 416px;">
									<div class="c-form" style="padding-bottom:10px;padding: 10px 0 0 70px;" id="snmpset">
										<div class="form">
											<div class="sel-type1" style="float: left;width: 100%;">
												<div class="form-item" style="">
													<span class="form-tag" style=""><em class="imp">*</em>配置名称：</span>
													<div class="form-c" style="">
														<input id="SnmpConfigName" name="SnmpConfigName" class="form-text" maxlength="128" style="width:235px;"
														 type="text" onblur="NameCheck(this);"><i class="v-check"></i>
														<p class="form-tip" style="width: 270px;margin-left: -5px;">特殊字符仅支持下划线、横杠、小数点</p>
													</div>
												</div>
												<div class="form-item" style="">
													<span class="form-tag" style=""><em class="imp">*</em>服务器地址：</span>
													<div class="form-c" style="">
														<input id="SnmpServerIP" name="SnmpServerIP" class="form-text" type="text" style="width:125px;" maxlength="64"
														 onblur="IPCheck(this);"><i class="v-check"></i>
													</div>
												</div>
												<div class="form-item" style="">
													<span class="form-tag" style=""><em class="imp">*</em>端口：</span>
													<div class="form-c" style="">
														<input id="SnmpPort" name="SnmpPort" class="form-text" type="text" maxlength="5" onblur="PortCheck(this);"
														 style="width: 58px;"><i class="v-check"></i>
														<p class="form-tip" style="width: 270px;margin-left: -5px;">0-65535之间</p>
													</div>
												</div>
												<div class="form-item">
													<span class="form-tag" style=""><em class="imp">*</em>编码方式：</span>
													<div class="form-c" style="">
														<select class="filter-select" id="EnCode_snmp" style="width:90px;">
															<option value="0">UTF-8</option>
															<option value="1">GBK</option>
														</select>
													</div>
												</div>
												<div class="form-item">
													<span class="form-tag" style=""><em class="imp">*</em>方式：</span>
													<div class="form-c" style="">
														<select class="filter-select" id="Flag_snmp" style="width:90px;">
															<option value="2">默认</option>
															<option value="1">备用</option>
															<option value="0">其他</option>
														</select>
													</div>
												</div>
												<!--
												
												-->
											</div>
										</div>
									</div>
									<div class="c-form">
										<div class="btns" style="margin-bottom:-20px;">
											<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
											<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
										</div>
									</div>
								</div>
							</div>
							<!--SYSLOG-->
							<div class="dialog-cont" id="syslog_suspend" style="display:none;">
								<div class="c-cont2" style="max-height:416px;">
									<div class="c-form" style="padding-bottom:10px;padding:10px 0 0 50px;" id="syslogset">
										<div class="form">
											<div class="sel-type1" style="float: left;width: 100%;">
												<div class="form-item" style="">
													<span class="form-tag" style=""><em class="imp">*</em>配置名称：</span>
													<div class="form-c" style="">
														<input id="SyslogConfigName" name="SyslogConfigName" maxlength="128" class="form-text" style="width:230px;"
														 type="text" onblur="NameCheck(this);"><i class="v-check"></i>
														<p class="form-tip" style="width: 270px;margin-left: -5px;">特殊字符仅支持下划线、横杠、小数点</p>
													</div>
												</div>
												<div class="form-item" style="">
													<span class="form-tag" style=""><em class="imp">*</em>服务器地址：</span>
													<div class="form-c" style="">
														<input id="SyslogServerIP" name="SyslogServerIP" class="form-text" type="text" style="width:125px;"
														 maxlength="64" onblur="IPCheck(this);"><i class="v-check"></i>
													</div>
												</div>
												<div class="form-item" style="">
													<span class="form-tag" style=""><em class="imp">*</em>端口：</span>
													<div class="form-c" style="">
														<input id="SyslogPort" name="SyslogPort" class="form-text" type="text" maxlength="5" onblur="PortCheck(this);"
														 style="width: 58px;"><i class="v-check"></i>
														<p class="form-tip" style="width: 270px;margin-left: -5px;">0-65535之间</p>
													</div>
												</div>
												<div class="form-item">
													<span class="form-tag" style=""><em class="imp">*</em>编码方式：</span>
													<div class="form-c" style="">
														<select class="filter-select" id="EnCode_syslog" style="width:90px;">
															<option value="0">UTF-8</option>
															<option value="1">GBK</option>
														</select>
													</div>
												</div>
												<div class="form-item">
													<span class="form-tag" style=""><em class="imp">*</em>方式：</span>
													<div class="form-c" style="">
														<select class="filter-select" id="Flag_syslog" style="width:90px;">
															<option value="2">默认</option>
															<option value="1">备用</option>
															<option value="0">其他</option>
														</select>
													</div>
												</div>
												<!--
												
												-->
											</div>
										</div>
									</div>
									<div class="c-form">
										<div class="btns" style="margin-bottom:-20px;">
											<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
											<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
										</div>
									</div>
								</div>
							</div>
							<!--审批-->
							<div class="dialog-cont" id="EnableApprove_suspend" style="display:none;">
								<div class="container" id="add_div">
									<div class="c-cont2" style="min-height:434px;max-height:280px">
										<div class="c-form" style="padding-bottom:10px;padding:0;">
											<div class="c-form" style="padding:0;">
												<div class="form-item " style="float: left;width: 45%;padding: 20px 0px 0 85px;">
													<span class="form-tag" style="width: 50px;"><em class="imp">*</em>名称：</span>
													<div class="form-c" style="padding: 0 0 0 0;">
														<input type="text" class="form-text" id="ApproveStrategyName" name="ApproveStrategyName" onblur="regCheck(this,nameReg);"
														 maxlength="128" style="margin-left:8px;"><i class="v-check"></i>
														<p class="form-tip" style="margin-left: 52px;">特殊字符仅支持下划线、横杠、小数点</p>
													</div>
												</div>
												<div class="form-item" style="padding-left: 500px;width: 36%;">
													<span class="form-tag" style="    width: 88px;"><em class="imp">*</em>审批人数：</span>
													<div class="form-c" style="padding-left: 98px;">
														<input edited="0" type="text" class="form-text" id="ApproveNum" name="ApproveNum" maxlength="3" style="width: 28px;float: left;text-align: right;"
														 onfocus="this.select()" onkeyup="this.value = this.value.replace(/\D/g,'');$(this).attr('edited',1);">
														<li id="" style="float: left;color: #000;margin-top: 4px;margin-left: 7px;">/</li>
														<li id="admin_num" style="float: left;color: #000;margin-top: 5px;margin-left: 7px;">0</li>
													</div>
												</div>

												<div class="form-item " style="float: left;">
													<span class="form-tag form-tag_change" style=""><em class="imp">*</em>方式：</span>
													<div class="form-c form-c_change" style="" id="checkbox">
														<label class="form-label" style="padding-right: 20px;">
															<span class="form-li">消息</span>
															<input id="checkbox1" name="checkbox1" class="form-checkbox" type="checkbox" name="">
														</label>
														<!-- <label class="form-label" style="">
															<input id="checkbox2" name="checkbox2" class="form-checkbox" type="checkbox" name="">
															<li class="form-li">短信猫</li>
														</label> -->
														<label class="form-label" style="padding-right: 20px;">
															<span class="form-li">短信</span>
															<input id="checkbox4" name="checkbox4" class="form-checkbox" type="checkbox" name="">
														</label>

														<label class="form-label" style="padding-right: 20px;">
															<span class="form-li">邮件</span>
															<input id="checkbox8" name="checkbox8" class="form-checkbox" type="checkbox" name="">
														</label>

														<!-- <label class="form-label" style="">
															<input id="checkbox16" name="checkbox16" class="form-checkbox" type="checkbox" name="">
															<li class="form-li">TOKEN</li>
														</label> -->

													</div>
												</div>
												<div class="form-item" style="float: left;padding: 10px 0px;width: 382px;display: none;">
													<span class="form-tag form-tag_change" style="">短信默认：</span>
													<div class="form-c form-c_change" style="">
														<div class="xSelect xSelect_phone_m"></div>
													</div>
												</div>
												<div class="form-item" style="float: left;padding: 10px 0px;width: auto;display: none;">
													<span class="form-tag form-tag_change" style="">短信备用：</span>
													<div class="form-c form-c_change" style="">
														<div class="xSelect xSelect_phone_s"></div>
													</div>
												</div>
												<div class="form-item" style="float: left;padding: 10px 0px;width: 382px;display: none;">
													<span class="form-tag form-tag_change" style="">邮件默认：</span>
													<div class="form-c form-c_change" style="">
														<div class="xSelect xSelect_smtp_m"></div>
													</div>
												</div>
												<div class="form-item" style="float: left;padding: 10px 0px;width: auto;display: none;">
													<span class="form-tag form-tag_change" style="">邮件备用：</span>
													<div class="form-c form-c_change" style="">
														<div class="xSelect xSelect_smtp_s"></div>
													</div>
												</div>

											</div>
											<div class="form-item form-item-100" style="width: 90%;margin-left: 36px;max-height:152px;">
												<span class="form-tag" style="width: 100px;"><em class="imp">*</em>审批者：</span>
												<div class="h-content3" style="padding: 0 0 0 8px;max-height:114px;" name="label_list_a" id="label_list_a">
													<div class="item" style="padding-top:0px;width:195px;" id="admin_check_a" name="admin_check_a" value="0">
														<select class="filter-select" name="admin_select_a" id="admin_select_a" style="width:160px;">
															<option value="0" selected>请选择</option>
														</select>
														<i class="ctrl add" style="    margin-left: 1px;" onclick="_addadmin_a(this)"></i>
													</div>
												</div>
											</div>
										</div>
									</div>
									<div class="btns" style="margin-bottom: -20px;">
										<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
										<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
									</div>
								</div>
							</div>
							<!-- 前置机IP添加浮层 -->
							<div class="dialog-cont" id="ConnIPDialog" style="display:none;">
								<div class="container">
									<div class="c-cont" style="min-height:200px;max-height:200px;overflow:auto;">
										<div class="c-form c-form-host" style="padding: 0 0 90px;">
											<div class="clearfix"></div>
											<div class="c-table">
												<div class="form">
													<div class="form-item" style="width: 25%;">
														<span class="form-tag" style=""><em class="imp">*</em>IP：</span>
														<div class="form-c" style="">
															<input type="text" class="form-text" id="accip_input" maxlength="15" style="" tabindex="1">
														</div>
													</div>
												</div>
												<div class="btns" style="padding: 10px 0 10px;">
													<a href="javascript:;" class="btn btn-normal btn-submit s-hide" >保&nbsp;&nbsp;存</a>
													<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		{%if 32 in manage_power_id%}
		<div class="btns">
			<a href="javascript:;" class="btn btn-normal" onclick="save_alldata();">保&nbsp;&nbsp;存</a>
		</div>
		{%else%}
		<div class="btns" style="height:67px;">

		</div>
		{%endif%}

	</div>



	<div id="bBtn" style="position: fixed;z-index:5;">
		<a href="javascript:;" class="btn" style="float: right;" onclick="back();"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
	</div>
</div>
<form action="/bhost/globalstrategy_show" method="POST" name="frm_access">
	<input type="hidden" name="z1" id="z1" value="" />
	<input type="hidden" name="z2" id="z2" value="" />
	<input type="hidden" name="tasktype" id="tasktype" value="" />
	<input type="hidden" name="us" value="" />
	<input type="hidden" name="se" value="" />
	<input type="hidden" name="a0" value="" />
</form>

<style>
	.select2-results .select2-results__options .select2-results__option{
		font-size: 14px;
	}
	.in_ip span.select2-selection{
		border-bottom-left-radius: 0px;
		border-top-left-radius: 0px;
	}
	.accIP_type span.select2-selection {
		border-bottom-right-radius: 0px;
	    border-top-right-radius: 0px;
	}
	/*
	.xSelect-view ul {
		max-height:120px;
	}
	*/
	.ui-dialog-body {
		padding: 20px 0 20px 0;
	}

	#mail_suspend span.form-tag {
		width: 275px;
	}

	.form-tag_change {
		width: 137px;
	}

	.form-c_change {
		padding: 0;
		margin-left: 144px;
	}

	.form-label {
		/*padding-right: 20px;*/
		padding-right: 0px;
		margin-top: 5px;
	}

	.form-li {
		float: right;
		margin-top: 2px;
	}

	#select2-EnableAlarm-results {
		font-size: 14px;
	}
	#accIP .xSelect-show {
		/*border-bottom-right-radius: 5px;
		border-top-right-radius: 5px;*/
		border-bottom-left-radius: 0px;
		border-top-left-radius: 0px;
		margin-left: -1px;
	}
	#AccIP_select_div .form-c:hover a.del{
		display: inline-block !important;
	}
</style>

<script>
	$('.form-checkbox,.form-radio').iCheck({
		checkboxClass: 'icheckbox_minimal-blue',
		radioClass: 'iradio_minimal-blue',
		increaseArea: '0' // optional
	});
	$(".tag").css("width", "270px");
	$(".form-select").css("width", "100px");
	$(".form-select1").css("width", "175px");
	$('.form-select').select2({ minimumResultsForSearch: -1 });
	$('.form-select1').select2({ minimumResultsForSearch: -1 });
	$('.filter-select,.type-select').select2({ minimumResultsForSearch: -1 });


	var se;
	var _if_disable = '2';
	var flag = 0;
	var numberReg = /\D/;
	var aselectid = [];
	var bselectid = [];
	var GlobalStrategy = {
		"GlobalStrategyId": 1,
		"LoginUniqueIP": false,
		"ConnectTimeOut": 0,
		"IfGiveAccessInfo": false,
		"IfHiddenHostIP": false,
		"FileRecordOpened": false,
		"FileRecordDiskLimit": null,
		"AccControlOpened": false,
		"SyslogOpened": false,
		"IsRemindSaveUser": 2,
		"IfForceAidance": false,
		"IsTunnel": false,
		"EnableApprove": false,
		"ApproveStrategyId": null,
		"ApproveStrategyName": null,
		"EnableAlarm": 0,
		"EventAlarmInfoId": null,
		"EventAlarmInfoName": null,
		"MapPort": 12
	};
	var DownFilePwd_old = null;
	function save_alldata() {
		var pwd_re = pwdstrategy_update();
		if (pwd_re == false) {
			return false;
		}
		var globs_re = save();
		if (globs_re == false) {
			return false;
		}
		msstr1 = aceg(JSON.stringify(GlobalStrategy),se);
		msstr2 = aceg(JSON.stringify(pwdstrategy),se);
		$.ajax({
			url: '/bhost/save_globalstrategy',
			type: 'post',
			async: false,
			data: { a0: se, z1: JSON.stringify(GlobalStrategy), z2: JSON.stringify(pwdstrategy),m1: msstr1,m2:msstr2},
			success: function (result) {
				data = JSON.parse(result);
				if (data.Result == true) {
					layer.open({
						type: 1,
						title: "全局策略",
						content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						btn1: function (i) {
							layer.close(i);
							document.frm_access.action = '/bhost/globalstrategy_show';
							document.frm_access.submit();
						},
						btn2: function (i) {
							layer.close(i);
						}
					});
				} else {
					_alert(1, "全局策略", "执行失败：" + data.ErrMsg);
				}
			}
		});
	}

	var manage_auth_array = [];
	var access_auth_array = [];
	var $focusObj_c;
	var accIP_list;
	var in_ip_list = [];
	var manager_arry=[-1];
	function get_accIP(){
		//获取accIP
		$.ajax({
			url:'/bhost/get_accIP',
			type: "post",
			async:false,
			cache:false,
			data: {a0: se},
			success: function(Result) {
				accIP_list = JSON.parse(Result);
			}
		});
		if (accIP_list.hasOwnProperty("Result")){
			_alert(2,'全局策略',accIP_list.ErrMsg);
			return false;
		}
	}
	function bind_accip_select(){
		if (get_accIP()==false){
			return true;
		};
		var accip_array = [{
				'value':-1,
				'name':'请选择'
			}];
		acc_index_all = [];
		$.each(accIP_list.data,function(i,item){
			if (manager_arry.indexOf(item.AccIPId) > 0){
				return true;
			}
			if(_if_disable == '2'){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':'delete'
				};
			}else{
				var select_data_json = {
					'value':1,
					'name':'admin2'
				};
			}
			if (item.IsBuildin){
				return true;
			}
			acc_index_all.push(item.AccIPId);
			select_data_json.value = item.AccIPId;
			select_data_json.name = item.AccIP;
			accip_array.push(select_data_json);	
		});
		$('#accIP').empty().data('xSelect',"");
		$('div.xSelect-accIP').remove();
		if(_if_disable == '2'){
			$('#accIP').xSelect({
				width: 138,
				defaultText: '请选择',
				items:accip_array,
				module_type:'accIP',
				delete:function(item,obj){
					$('.xSelect-accIP').hide();
					layer.open({
						type:1,
						title:"删除应用发布",
						content:'<div class="layer-alert"><i class="alert warning"></i>确定删除</div>',
						btn:['确&nbsp;&nbsp;定','取&nbsp;&nbsp;消'],
						btnAlign:'c',
						closeBtn: false,
						skin:'layer-custom',
						area:['380px','310px'],
						move: false,
						resize: false,
						btn1:function(i){
							layer.close(i);
							del_accip(obj);
						}
					});
					$(document)[0].onclick = null;
				},
				btn:[
					{
						'name':'新增',
						'event': function(items,obj){
							_editaccIP(obj);
						}
					}
				]
			});
			$("#accIP").data('value','-1');
		}else{
			$('#accIP').xSelect({
				width: 138,
				defaultText: '请选择',
				items:accip_array,
				module_type:'accIP',
				delete:function(item,obj){
					del_accip(obj);
				}
			});
			$("#accIP").data('value','-1');
		}
	}
	function del_accip(obj){

		var id = $(obj).find('span').data('value');
		var sel_id = $("#accIP").data('value');
		var sel_text = $("#accIP").find('span').text();
		var accip_str = $(obj).find('span').text();
		$(document)[0].onclick = null;
		$.ajax({
			url:'/bhost/del_acc_ip',
			type:'post',
			async:false,
			data:{a0: se,a1:id,a10:"运维管理>全局策略"},
			success:function(result){
				var result = JSON.parse(result);
				if (result.Result == true){
					// $(obj).remove();
					bind_accip_select();
					if (id == sel_id){
						$("#accIP").data('value','-1');
						$("#accIP").find('span').text('请选择');
					}else{
						$("#accIP").data('value',sel_id);
						$("#accIP").find('span').text(sel_text);
					}
					return;
				}else{
					_alert(1, "全局策略",result.ErrMsg);
					return;
				}
			}
		})
	}	
	function _editaccIP(){
		$("#accip_input").val('');
		var hostIPReg = /(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;

		var $dialogCont = $("#ConnIPDialog").show();
		var title = '应用发布IP';
		var d = dialog({
			title:title,
			content:$dialogCont,
			id:"ConnIPDialog",
			width:"780px"
		});
		d.addEventListener('close', function () {
			$dialogCont.appendTo("body").hide();
		});
		d.showModal();
		$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
			$("#accip_input").val('');
		});
		$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
			var acc_ip = $("#accip_input").val();
			if(acc_ip == ""){
				_alert(2, title, '请输入应用发布IP');
				return false;
			}else{
				if (!hostIPReg.test(acc_ip)) {
					_alert(1, title, "应用发布IP格式不正确");
					return false;
				};
			}
			var flag_1 = 0;
			$.each(accIP_list.data,function(i,item){
				if(item.AccIP == acc_ip){
					_alert(1, title, '相同的应用发布IP已存在');
					flag_1 = 1;
					return false;
				}
			})
			if(flag_1 == 1){
				return false;
			}
			save_accip(acc_ip,d);
		});
	}
	//保存应用发布IP
	function save_accip(ip,obj){
		var jsondata = {
			"AccIPId": 0,
			"AccIP": ""
		}
		jsondata.AccIP = ip;
		var msstr = aceg(JSON.stringify(jsondata),se); 
		$.ajax({
			url:'/bhost/save_acc_ip',
			type:"POST",
			async:false,
			data:{a0: se,a1: JSON.stringify(jsondata),a10:"运维管理>全局策略",m1:msstr},
			//contentType: 'application/json',
			success: function(Result) {
				var data = JSON.parse(Result);
				if(data.Result){
					var result_id = data.AccIPId
					_alert(0,"应用发布IP","保存成功");
					obj.close().remove();
					var accIP_text = $("#accIP").find('span').text();
					var accIP_Id = $("#accIP").data('value');
					bind_accip_select();
					if (accIP_Id == "-1" || accIP_Id == undefined){
						$("#accIP").data('value',result_id);
						$("#accIP").find('span').text(ip);
					}else{
						$("#accIP").find('span').text(accIP_text);
						$("#accIP").data('value',accIP_Id);
					}
					return false;
				}else{
					_alert(1,"应用发布",data.ErrMsg);
					return false;
				}
			}
		})
	}
	function _addaccIP(obj){
		var accip_id = $(obj).prev('div').data('value');
		var v = $(obj).prev('div').find('span').text();
		var $c = $(obj).parent().clone();
		if (accip_id == undefined || accip_id == '-1'){
			_alert(2, "全局策略", "请选择应用发布");
			return false;
		}
		accip_id = parseInt(accip_id);
		if (manager_arry.indexOf(accip_id) === -1) {
			manager_arry.push(accip_id);
		}
		$c.find('select').attr('disabled',true);
		$c.find('span.select2-selection--single').css("background-color","rgb(235, 235, 228)");
		$c.find('a').after('<a class="ctrl del" style="float: left;width: 15px;height: 15px;overflow: hidden;background: url(/manage/images/icon-ctr.png) no-repeat 0 0;margin: 6px 0 0 10px;display: none;background-position: 0 0;cursor: pointer;" onclick="_delIP(this)"></a>').remove();
		$c.find('.form-c').css("background-color","rgb(235, 235, 228)");
		$c.find('.form-c').data('value',accip_id);
		$c.find('select').attr('id',"");
		$c.find('.xSelect-show').attr('data-id','').css('border-bottom-left-radius',"0px").css('border-top-left-radius',"0px").css('margin-left',"-1px");
		$c.find('.form-c').attr('id',"");
		$(obj).parent().after($c);
		bind_accip_select();
		$(obj).prev().find('span').text('请选择');
		$(obj).prev().data('value',-1);
	}
	function _delIP(obj){
		var $c = $(obj).prev();
		var id = $c.data('value');
		var t = $(obj).prev().find('span').text();
		manager_arry.splice($.inArray(id, manager_arry), 1);
		$(obj).parent().remove();
		var accIP_text = $("#accIP").find('span').text();
		var accIP_Id = $("#accIP").data('value');
		//console.log(accIP_Id+':'+accIP_text);
		bind_accip_select();
		if (accIP_Id == "-1" || accIP_Id == undefined){
			
		}else{
			$("#accIP").find('span').text(accIP_text);
			$("#accIP").data('value',accIP_Id);
		}
	}
	$(function () {
		se = window.parent.document.frm.se.value;
		$.ajax({
			url:'/bhost/get_accIP',
			type: "post",
			async:false,
			cache:false,
			data: {a0: se},
			success: function(Result) {
				accIP_list = JSON.parse(Result);
			}
		});
		if (accIP_list.hasOwnProperty("Result")){
			_alert(1,'全局策略',accIP_list.ErrMsg);
			return true;
		}else{
			var option_str = '<option value="-1">请选择</option>';
			$.each(accIP_list.data,function(i,item){
				if (item.IsBuildin){
					in_ip_list.push(item);
					option_str = option_str + '<option value="'+item.AccIPId+'">'+item.AccIPId+'</option>';
				}
			});
			$("#in_ip").empty().append(option_str);
		};
		bind_accip_select();
		$('.xSelect').on('click', '.xSelect-show', function () {
			$focusObj_c = $(this).parents('.xSelect');
		});
		$.each(window.parent._power, function (i, item) {
			if (item.Mode == 2) {
				manage_auth_array.push(item.SubMenuId);
			} else {
				access_auth_array.push(item.SubMenuId);
			}
		});
		$("#global_reload").on("click", function () {
			//parent.reload();
			document.frm_access.action = '/bhost/globalstrategy_show';
			document.frm_access.submit();
		});
		/*
		$("#user_set").on("click",function(){
			document.frm_access.action = '/bhost/pwdstrategy_change_show';
			document.frm_access.submit();
		});
		*/
		parent._switchBtn(1);
		document.frm_access.a0.value = se;
		$("#ConnectTimeOut,#FileRecordDiskLimit").bind('keydown', function (e) {
			DigitInput(e);
		});
		$("#timeout_check").on("ifChanged", function () {
			if ($("#timeout_check").prop("checked")) {
				$("#ConnectTimeOut").attr("disabled", false);
			} else {
				$("#ConnectTimeOut").attr("disabled", true);
			}
		});
		$("#FileRecordOpened").on("ifChanged", function () {
			if ($("#FileRecordOpened").prop("checked")) {
				$("#FileRecordDiskLimit").attr("disabled", false);
			} else {
				$("#FileRecordDiskLimit").attr("disabled", true);
			}
		});

		$("#EnableApprove_check").on("ifChanged", function () {
			if ($("#EnableApprove_check").prop("checked")) {
				$("#Approve_select").show();
			} else {
				$("#Approve_select").hide();
				$(".xSelect-approve").hide();
				$("div[data-id=xSelect-approve]").removeClass('on');
			}
		});

		$("#AccIPEnable").on("ifChanged", function () {
			if ($("#AccIPEnable").prop("checked")) {
				$("#AccIP_select_div").show();
			} else {
				$("#AccIP_select_div").hide();
			}
		});
		//事件告警信息
		bind_alarm_xSelect();

		//审批策略
		bind_approval_xSelect();


		//$("#step1").children('.c-cont').height($(window).height()-87);
		binding_globalstrategy();
		$('.g-tsel').on('click', function () {
			var this_id = $(this).attr('id');
			var this_class = $(this).attr('class');
			if (this_class == "g-tsel") {
				$(this).children('input').focus().select();
			}
		});
		initsize();
	});
	function change_acc_type(obj){
		if ($(obj).val() == 1){
			$(obj).parent().next().show();
			$(obj).parent().next().next().hide();
			$(obj).parent().next().next().next().hide();
			$(obj).siblings('a').hide();
		}else{
			$(obj).parent().next().hide()
			$(obj).parent().next().next().show();
			$(obj).parent().next().next().next().show();
			$(obj).siblings('a').show();
		}
	}
	function change_alarm(obj) {
		if ($(obj).val() != '0') {
			$("#Alarm_select").show();
		} else {
			$("#Alarm_select").hide();
			$(".xSelect-alarm").hide();
			$("div[data-id=xSelect-alarm]").removeClass('on');
		}
	}

	function bind_alarm_xSelect() {
		$.ajax({
			url: '/bhost/get_eventalarminfo',
			type: 'post',
			async: false,
			data: { a0: se, z1: -1 },
			success: function (result) {
				eventdata = JSON.parse(result);
			}
		});
		var alarm_array = [];
		$.each(eventdata.data, function (i, item) {
			if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(32) != -1) {
				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'edit'
				};
			} else {

				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'check'
				};
			}

			select_data_json.value = item.EventAlarmInfoId;
			select_data_json.name = item.Name;
			alarm_array.push(select_data_json);
		});
		$('#EventAlarmInfoId').empty().data("xSelect", "");

		if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(32) != -1) {
			$('#EventAlarmInfoId').xSelect({
				width: 162,
				num: "2",
				defaultText: '请选择',
				items: alarm_array,
				module_type: 'alarm',
				edit: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode(obj, 1);
				},
				btn: [
					{
						'name': '新增',
						'event': function (items, obj) {
							$(obj).parents('.xSelect-view').hide();
							_editNode(obj, 2);
						}
					}
				],
				setval: function (item, obj) {
					GlobalStrategy.EventAlarmInfoId = $(obj).find('span').data('value');
				}
			});
		} else {
			$('#EventAlarmInfoId').xSelect({
				width: 162,
				defaultText: '请选择',
				items: alarm_array,
				module_type: 'alarm',
				check: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode(obj, 1);
				},
				setval: function (item, obj) {
					GlobalStrategy.EventAlarmInfoId = $(obj).find('span').data('value');
				}
			});
		}

	}

	function bind_approval_xSelect() {
		$.ajax({
			url: '/bhost/get_approve_personnel',
			type: 'post',
			async: false,
			data: { a0: se, z1: -1 },
			success: function (result) {
				appdata = JSON.parse(result);
			}
		});
		var approve_array = [];
		$.each(appdata.data, function (i, item) {
			if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(32) != -1) {
				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'edit'
				};
			} else {
				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'check'
				};
			}

			select_data_json.value = item.ApproveStrategyId;
			select_data_json.name = item.ApproveStrategyName;
			approve_array.push(select_data_json);
		});
		$('#EnableApprove').empty().data('xSelect', "");

		if (manage_auth_array.indexOf(15) != -1 || manage_auth_array.indexOf(16) != -1 || manage_auth_array.indexOf(17) != -1 || manage_auth_array.indexOf(32) != -1) {
			$('#EnableApprove').xSelect({
				width: 162,
				defaultText: '请选择',
				items: approve_array,
				module_type: 'approve',
				edit: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode1(obj, 1);
				},
				btn: [
					{
						'name': '新增',
						'event': function (items, obj) {
							$(obj).parents('.xSelect-view').hide();
							_editNode1(obj, 2);
						}
					}
				],
				setval: function (item, obj) {
					GlobalStrategy.ApproveStrategyId = $(obj).find('span').data('value');
					GlobalStrategy.ApproveStrategyName = $(obj).find('span').text();
				}
			});
		} else {
			$('#EnableApprove').xSelect({
				width: 162,
				defaultText: '请选择',
				items: approve_array,
				module_type: 'approve',
				check: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode1(obj, 1);
				},
				setval: function (item, obj) {
					GlobalStrategy.ApproveStrategyId = $(obj).find('span').data('value');
					GlobalStrategy.ApproveStrategyName = $(obj).find('span').text();
				}
			});
		}

	}

	function initsize() {
		var w = $(window).width();
		if (w < 900) {
			$(".form-item-luo").css("margin-left", 0);
		} else {
			$(".form-item-luo").css("margin-left", "200px");
		}
		$("#step1").children('.c-cont').height($(window).height() - 103);
		//$("#step1").children('.c-cont').height($(window).height()-87);
	}

	$(window).resize(function () {
		var w = $(window).width();
		if (w < 900) {
			$(".form-item-luo").css("margin-left", 0);
		} else {
			$(".form-item-luo").css("margin-left", "200px");
		}
		$("#step1").children('.c-cont').height($(window).height() - 103);
	});

	function binding_asname() {
		$.ajax({
			url: '/bhost/get_approve_personnel',
			type: 'post',
			async: false,
			data: { a0: se, z1: -1 },
			success: function (result) {
				data = JSON.parse(result);
				$.each(data.data, function (i, item) {
					$("#asname_select").append("<option value=\"" + item.ApproveStrategyId + "\">" + item.ApproveStrategyName + "</option>");
				});
			}
		});
	}

	function binding_personnel() {
		$.ajax({
			url: '/bhost/get_personnel',
			type: "post",
			async: false,
			data: { a0: se },
			success: function (result) {
				data = JSON.parse(result);
				$.each(data, function (i, item) {
					$("#personnel").append("<div style=\"float:left;width:180px;\"><label class=\"form-label\" style=\"line-height:26px;\"><input id=\"a-" + item.UserId + "\" class=\"form-checkbox\" type=\"checkbox\"><span style=\"vertical-align:middle;font-size:16px;\">" + item.UserCode + "</span></label></div>");

					$("#approve_personnel").append("<div style=\"float:left;width:180px;\"><label class=\"form-label\" style=\"line-height:26px;\"><input id=\"b-" + item.UserId + "\" class=\"form-checkbox\" type=\"checkbox\"><span style=\"vertical-align:middle;font-size:16px;\">" + item.UserCode + "</span></label></div>");
				});
				$("#personnel").append("<div style=\"float:left;width:180px;\"><label class=\"form-label\" style=\"line-height:26px;\"><input id=\"AlarmReceiver\" class=\"form-checkbox\" type=\"checkbox\"><span style=\"vertical-align:middle;font-size:16px;\">手动输入:</span><input id=\"Receiver_text\" type=\"text\" class=\"form-text\" style=\"width:135px\"><p class=\"form-tip\">分号分隔多个</p></label></div>");
				$('.form-checkbox,.form-radio').iCheck({
					checkboxClass: 'icheckbox_minimal-blue',
					radioClass: 'iradio_minimal-blue',
					increaseArea: '0' // optional
				});

			}
		});
	}

	function binding_eventalarminfo() {
		$.ajax({
			url: '/bhost/get_eventalarminfo',
			type: 'post',
			async: false,
			data: { a0: se, z1: -1 },
			success: function (result) {
				data = JSON.parse(result);
				$.each(data.data, function (i, item) {
					$("#name_select").append("<option value=\"" + item.EventAlarmInfoId + "\">" + item.Name + "</option>");
				});
			}
		});
	}

	function binding_globalstrategy() {
		$.ajax({
			url: '/bhost/get_globalstrategy',
			type: 'post',
			async: false,
			data: { a0: se },
			success: function (result) {
				data = JSON.parse(result);
				GlobalStrategy.GlobalStrategyId = data.GlobalStrategyId;
				$("#MapPort").val(data.MapPort);
				if (data.LoginUniqueIP) {
					$("#LoginUniqueIP").iCheck("check");
				}
				if (data.ConnectTimeOut != 0) {
					$("#timeout_check").iCheck("check");
					$("#ConnectTimeOut").val(data.ConnectTimeOut);
					$("#ConnectTimeOut").attr("disabled", false);
				} else {
					$("#timeout_check").iCheck("uncheck");
					$("#ConnectTimeOut").val(data.ConnectTimeOut);
					$("#ConnectTimeOut").attr("disabled", true);
				}

				if (data.IfGiveAccessInfo) {
					$("#IfGiveAccessInfo").iCheck("check");
				}
				if (data.FileRecordOpened) {
					$("#FileRecordOpened").iCheck("check");
					$("#FileRecordDiskLimit").val(data.FileRecordDiskLimit);
				} else {
					$("#FileRecordDiskLimit").attr("disabled", true);
				}
				if (data.IfHiddenHostIP) {
					$("#IfHiddenHostIP").iCheck("check");
				}
				if (data.AccControlOpened) {
					$("#AccControlOpened").iCheck("check");
				}

				if (data.IsRemindSaveUser == 0) {
					$("#IsRemindSaveUser").val(0).trigger('change');
				} else if (data.IsRemindSaveUser == 1) {
					$("#IsRemindSaveUser").val(1).trigger('change');
				} else if (data.IsRemindSaveUser == 2) {
					$("#IsRemindSaveUser").val(2).trigger('change');
				}

				if (data.IfForceAidance) {
					$("#IfForceAidance").iCheck("check");
				}
				if (data.IsTunnel) {
					$("#IsTunnel").iCheck("check");
				}
				if (data.SyslogOpened) {
					$("#SyslogOpened").iCheck("check");
				}
				$("#EnableAlarm").val(data.EnableAlarm).trigger('change');
				if (data.EventAlarmInfoId != null) {
					$("#EventAlarmInfoId").find('span').text(data.EventAlarmInfoName);
					$("#EventAlarmInfoId").data('value', data.EventAlarmInfoId);
					GlobalStrategy.EventAlarmInfoId = data.EventAlarmInfoId;
					GlobalStrategy.EventAlarmInfoName = data.EventAlarmInfoName;
				}
				if (data.EnableApprove) {
					$("#EnableApprove_check").iCheck('check');
					//$("#EnableApprove").val(data.ApproveStrategyName);
				}
				if (data.ApproveStrategyId != null) {
					$("#EnableApprove").find('span').text(data.ApproveStrategyName);
					$("#EnableApprove").data('value', data.ApproveStrategyId);
					GlobalStrategy.ApproveStrategyId = data.ApproveStrategyId;
					GlobalStrategy.ApproveStrategyName = data.ApproveStrategyName;
				}
				if(data.AccIPSet==null){
					$("#AccIPEnable").iCheck('uncheck');
				}else{
					$("#AccIPEnable").iCheck('check');
					for (var i1 = data.AccIPSet.length-1; i1 >=0; i1--){
						var item1=data.AccIPSet[i1]
						if (i1 != 0){
							if (item1.IsBuildin==true){
								$('#accIP_type').val(1).trigger('change')
								$("#in_ip").val(item1.AccIPId).trigger('change');
							}else{
								$('#accIP_type').val(2).trigger('change')
								$("#accIP").data('value',item1.AccIPId);
								$("#accIP").find('span').text(item1.AccIP);
							}
							$('#add4').click();
						}else{
							if (item1.IsBuildin==true){
								$('#accIP_type').val(1).trigger('change')
								$("#in_ip").val(item1.AccIPId).trigger('change');
							}else{
								$('#accIP_type').val(2).trigger('change')
								$("#accIP").data('value',item1.AccIPId);
								$("#accIP").find('span').text(item1.AccIP);
							}
						}
					}
				}
			}
		});
	}

	function save() {
		GlobalStrategy = {
			"GlobalStrategyId": 1,
			"LoginUniqueIP": false,
			"ConnectTimeOut": 0,
			"IfGiveAccessInfo": false,
			"IfHiddenHostIP": false,
			"FileRecordOpened": false,
			"FileRecordDiskLimit": null,
			"AccControlOpened": false,
			"SyslogOpened": false,
			"IsRemindSaveUser": 2,
			"IfForceAidance": false,
			"IsTunnel": false,
			"EnableApprove": false,
			"ApproveStrategyId": null,
			"ApproveStrategyName": null,
			"EnableAlarm": 0,
			"EventAlarmInfoId": null,
			"EventAlarmInfoName": null,
			"MapPort": 123,
			"AccIPSet":null
		};
		var ConnectTimeOut = $("#ConnectTimeOut").val().trim();
		if ($("#timeout_check").prop("checked")) {
			if (ConnectTimeOut == 0) {
				_alert(1, "全局策略", "超时时间不能为0", $("#ConnectTimeOut"));
				return false;
			}
			GlobalStrategy.ConnectTimeOut = parseInt($("#ConnectTimeOut").val().trim());
		} else {
			GlobalStrategy.ConnectTimeOut = 0;
		}
		var FileRecordDiskLimit = $("#FileRecordDiskLimit").val().trim();
		if ($("#FileRecordOpened").prop("checked")) {
			if (FileRecordDiskLimit == "0") {
				_alert(1, "全局策略", "文件磁盘限额不能为0");
				return false;
			}
			/*
			else if(FileRecordDiskLimit>91){
				_alert(1,"全局策略","文件磁盘限额最大值不能超过91GB",$("#FileRecordDiskLimit"));
							return false;
			}
			*/
			GlobalStrategy.FileRecordOpened = true;
			GlobalStrategy.FileRecordDiskLimit = FileRecordDiskLimit;
		}
		if ($("#LoginUniqueIP").prop("checked")) {
			GlobalStrategy.LoginUniqueIP = true;
		}
		if ($("#IfGiveAccessInfo").prop("checked")) {
			GlobalStrategy.IfGiveAccessInfo = true;
		}
		if ($("#IfHiddenHostIP").prop("checked")) {
			GlobalStrategy.IfHiddenHostIP = true;
		}
		if ($("#AccControlOpened").prop("checked")) {
			GlobalStrategy.AccControlOpened = true;
		}

		GlobalStrategy.IsRemindSaveUser = parseInt($("#IsRemindSaveUser").val());

		if ($("#IfForceAidance").prop("checked")) {
			GlobalStrategy.IfForceAidance = true;
		}
		if ($("#IsTunnel").prop("checked")) {
			GlobalStrategy.IsTunnel = true;
		}
		var MapPort = $("#MapPort").val();
		if (MapPort == "") {
			_alert(1, "全局策略", "请填写映射端口", $("#MapPort"));
			return false;
		} else {
			var numCheck = /\D/;
			if (numCheck.test(MapPort)) {
				_alert(1, "全局策略", "端口格式错误", $("#MapPort"));
				return false;
			}
			if (parseInt(MapPort) < 1 || parseInt(MapPort) > 65534) {
				_alert(1, "全局策略", "请输入正确的端口", $("#MapPort"));
				return false;
			}
		}
		GlobalStrategy.MapPort = parseInt(MapPort);

		if ($("#SyslogOpened").prop("checked")) {
			GlobalStrategy.SyslogOpened = true;
		}

		GlobalStrategy.EnableAlarm = $("#EnableAlarm").val();
		if (GlobalStrategy.EnableAlarm != 0) {
			GlobalStrategy.EventAlarmInfoId = $("#EventAlarmInfoId").data('value');
			GlobalStrategy.EventAlarmInfoName = $("#EventAlarmInfoId").find('span').text();
			if (GlobalStrategy.EventAlarmInfoId == null || GlobalStrategy.EventAlarmInfoId == undefined || GlobalStrategy.EventAlarmInfoId == '-1') {
				_alert(2, "全局策略", "请选择告警事件");
				return false;
			}
		} else {
			GlobalStrategy.EventAlarmInfoId = null;
		}
		if ($("#EnableApprove_check").prop("checked")) {
			GlobalStrategy.ApproveStrategyId = $("#EnableApprove").data('value');
			GlobalStrategy.ApproveStrategyName = $("#EnableApprove").find('span').text();
			if (GlobalStrategy.ApproveStrategyId == null || GlobalStrategy.ApproveStrategyId == undefined || GlobalStrategy.ApproveStrategyId == '-1') {
				_alert(2, "全局策略", "请选择审批策略");
				return false;
			}
			GlobalStrategy.EnableApprove = true;
		} else {
			GlobalStrategy.ApproveStrategyId = null;
			GlobalStrategy.EnableApprove = false;
		}
		if($("#AccIPEnable").prop("checked")){
			GlobalStrategy.AccIPSet=new Array();
			$('#AccIP_select_div').children('.form-c').each(function(i,item){
				if (i==0){
					var acc_type=$('#accIP_type').val();
					var acc_ip='';
					if (acc_type==1){
						var acc_id=$('#in_ip').val();
					}else{
						var acc_id=$('#accIP').data('value');
						acc_ip=$('#accIP').find('span').text();
					}
					if (acc_id==-1){
						return true;
					}else{
						GlobalStrategy.AccIPSet.push({"AccIPId": parseInt(acc_id),"AccIP":acc_ip});
					}
				}else{
					var acc_id=$(item).children('.form-c').data('value');
					var acc_ip=$(item).children('.form-c').find('span').text();
					GlobalStrategy.AccIPSet.push({"AccIPId": parseInt(acc_id),"AccIP":acc_ip});
				}
			});
			if(GlobalStrategy.AccIPSet.length==0){
				_alert(2, "全局策略", "请选择应用发布");
				return false;
			}
		}
		//console.log(GlobalStrategy.AccIPSet);
		return true;
	}

	function back() {
		document.frm_access.tasktype.value = 3;
		document.frm_access.se.value = se;
		document.frm_access.us.value = window.parent.document.frm.us.value;
		document.frm_access.action = '/bhost/index';
		document.frm_access.submit();
	}




	var $focusObj;
	function _autoView(obj, j) {
		$(document)[0].onclick = null;
		$focusObj = $(obj);
		var eventdata;
		var appdata;
		if (j == 1) {
			$.ajax({
				url: '/bhost/get_eventalarminfo',
				type: 'post',
				async: false,
				data: { a0: se, z1: -1 },
				success: function (result) {
					eventdata = JSON.parse(result);
				}
			});
		} else {
			$.ajax({
				url: '/bhost/get_approve_personnel',
				type: 'post',
				async: false,
				data: { a0: se, z1: -1 },
				success: function (result) {
					appdata = JSON.parse(result);
				}
			});
		}

		var v = $.trim($(obj).val());
		var $view;
		if ($('#autoView').length == 0) {
			$('body').append('<div id="autoView" />');
		}
		$view = $('#autoView');
		var c = '';
		if (j == 1) {
			$.each(eventdata.data, function (i, item) {
				if (v == '') {
					c += '<li><i class="edit" onclick="_editNode(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden;" href="javascript:;" id="' + item.EventAlarmInfoId + '" onclick="_setVal(this,1);">' + item.Name + '</a></li>';
				} else {
					if (item.Name.indexOf(v) >= 0) {
						c += '<li><i class="edit" onclick="_editNode(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden;" href="javascript:;" id="' + item.EventAlarmInfoId + '" onclick="_setVal(this,1);">' + item.Name + '</a></li>';
					}
				}
			});
		} else {
			$.each(appdata.data, function (i, item) {
				if (v == '') {
					c += '<li><i class="edit" onclick="_editNode1(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden; href="javascript:;" id="' + item.ApproveStrategyId + '" onclick="_setVal(this,2);">' + item.ApproveStrategyName + '</a></li>';
				} else {
					if (item.ApproveStrategyName.indexOf(v) >= 0) {
						c += '<li><i class="edit" onclick="_editNode1(this,1)" /><a style="white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;overflow: hidden; href="javascript:;" id="' + item.ApproveStrategyId + '" onclick="_setVal(this,2);">' + item.ApproveStrategyName + '</a></li>';
					}
				}
			});
		}
		if (j == 1) {
			$view.html('<ul>' + c + '</ul><div class="add2"><a href="javascript:;" id="-1" onclick="_editNode(this,2);">添加新事件告警</a></div>');
		} else {
			$view.html('<ul>' + c + '</ul><div class="add2"><a href="javascript:;" id="-1" onclick="_editNode1(this,2);">添加新审批策略</a></div>');
		}

		var offset = $(obj).offset();
		var w = $(obj).outerWidth();
		$view.css({
			top: offset.top + 24,
			left: offset.left,
			width: w - 12
		}).show();

		$(obj).parents('.g-tsel').addClass('on');
	}
	var input_val1 = "";
	var input_val2 = "";

	function _setVal(t, t1) {
		var val = $(t).text();
		$($focusObj).val(val);
		$view = $('#autoView');
		$view.hide();
		if (t1 == 1) {
			GlobalStrategy.EventAlarmInfoId = parseInt($(t).attr('id'));
		} else {
			GlobalStrategy.ApproveStrategyId = parseInt($(t).attr('id'));
		}

		var $item = $focusObj.parents('div.g-title').next('div.g-cont').find('div.forName');
		var $item2 = $focusObj.parent().next('input.forName');
		$item.hide();
		$item2.hide();
	}

	function _addNew(obj) {
		$focusObj.val('');
		var $item = $focusObj.parents('div.g-title').next('div.g-cont').find('div.forName');
		$item.show().find('input[type=text]').focus();

		_hideView();
	}

	function _hideView() {
		$(document)[0].onclick = function () {
			$('#autoView').hide();
			$('.g-tsel').removeClass('on');
		}
	}

	function clear_eventinfo() {
		$("#eventinfo_suspend").find('input[type=text]').val('');
		$("#d_n").attr("disabled", false);
		$("#d_n").next('.v-check').attr('class', "v-check");
		$("#eventinfo_suspend").find('input[type=checkbox]').iCheck('uncheck');
		$("#eventinfo_suspend").find('select').val(0).trigger('change');
		$("#admin_select").empty();
		$("#admin_select1").empty();
		$("#label_list").children('div:not(:first)').remove();
		$("#label_list1").children('div:not(:first)').remove();
		$("#AlarmReceiver_text").children('div:not(:first)').remove();
		$("#AlarmReceiver_text1").children('div:not(:first)').remove();
		$(".xSelect-mail_div1").find('li').removeClass('active');
		$(".xSelect-mail_div2").find('li').removeClass('active');
		$("#mail_div1").data('value', '-1');
		$("#mail_div2").data('value', '-1');
		$(".xSelect-smsm_div1").find('li').removeClass('active');
		$(".xSelect-smsm_div2").find('li').removeClass('active');
		$("#smsm_div1").data('value', '-1');
		$("#smsm_div2").data('value', '-1');
		$(".xSelect-smssvr_div1").find('li').removeClass('active');
		$(".xSelect-smssvr_div2").find('li').removeClass('active');
		$("#smssvr_div1").data('value', '-1');
		$("#smssvr_div2").data('value', '-1');
		$(".xSelect-snmp_div1").find('li').removeClass('active');
		$(".xSelect-snmp_div2").find('li').removeClass('active');
		$("#snmp_div1").data('value', '-1');
		$("#snmp_div2").data('value', '-1');
		$(".xSelect-syslog_div1").find('li').removeClass('active');
		$(".xSelect-syslog_div2").find('li').removeClass('active');
		$("#syslog_div1").data('value', '-1');
		$("#syslog_div2").data('value', '-1');
		$("#mail1_div").hide();
		$("#mail2_div").hide();
		$("#smsm1_div").hide();
		$("#smsm2_div").hide();
		$("#smssvr1_div").hide();
		$("#smssvr2_div").hide();
		$("#snmp1_div").hide();
		$("#snmp2_div").hide();
		$("#syslog1_div").hide();
		$("#syslog2_div").hide();
	}

	var d = null;
	var eventinfo_data;
	function _editNode(obj, type) {
		clear_eventinfo();
		var title;
		if (type == 1) {
			//eventinfoId = $(obj).parent().children('a').attr('id');
			eventinfoId = $(obj).children('span').data('value');
			$.ajax({
				url: "/bhost/get_eventinfo_list",
				type: "POST",
				async: false,
				data: { a0: se, a1: eventinfoId },
				success: function (result) {
					var eventinfo_result = JSON.parse(result);
					if (eventinfo_result.Result == true) {
						eventinfo_data = eventinfo_result.info.data[0];
						title = "告警事件";
						//eventinfo_edit = eventinfo_data;
					}
				}
			});
		} else {
			eventinfo_edit = null;
			eventinfoId = 0;
			title = "事件告警";
		}
		var $dialogCont = $("#eventinfo_suspend").show();

		var d = dialog({
			title: title,
			content: $dialogCont,
			id: "eventinfo_suspend",
			width: "800px"
		});
		d.addEventListener('close', function () {
			$dialogCont.appendTo("body").hide();
		});
		d.showModal();
		//$(".ui-dialog-title").css("width","120px");
		//server_main(name);
		$("#EventLevel").next('span').css("margin-left", 9);
		if (manage_auth_array.indexOf(15) === -1 && manage_auth_array.indexOf(16) === -1 && manage_auth_array.indexOf(17) === -1 && manage_auth_array.indexOf(32) === -1) {
			$("#eventinfo_suspend").find('.btn-submit').remove();
		}
		eventinfomain(type);
		$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
			clear_eventinfo();
			eventinfomain(type);
			//d.close().remove();
		});

		$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
			eventinfo_add(d);
		});

	}


	var eventinfo = {
		"EventAlarmInfoId": 0,
		"Name": "",
		"EventLevel": 0,
		"EventType": 0,
		"EventDescription": null,
		"AlarmAction": 0,
		"AlarmReceiver": null,
		"UserSet": new Array(),
		"MasterConfig": 0,
		"StandByConfig": 0,
		"MasterConfigName": "",
		"StandByConfigName": ""
	};
	var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
	var ipReg = /^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])(\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])){3}$/;
	var phonecheck = /^[0-9]{11}$/;
	var emailcheck = /^([a-zA-Z0-9_\.\-])+@(([a-zA-Z0-9_\-])+\.)+([a-zA-Z0-9])+$/;
	var phone_or_emailcheck = null;
	var phone_or_email = null;
	var ip_all_str = "";
	function _addphone_or_email(obj) {
		var pass = 1;
		var v = $(obj).prev('input').val().trim();
		if (v == '') {
			_alert(1, '事件告警信息', phone_or_email + '不能为空', $(obj).prev('input'));
			$(obj).prev('input').focus();
			return false;
		} else if (!phone_or_emailcheck.test(v)) {
			_alert(1, '事件告警信息', phone_or_email + '格式不正确', $(obj).prev('input'));
			$(obj).prev('input').focus();
			return false;
		} else {
			var AlarmAction = $('#AlarmAction').val();
			if (AlarmAction == '1') {
				var it = '';
			} else {
				var it = '1';
			}
			$(">div[value]", "#AlarmReceiver_text" + it).each(function () {
				ip_str = $(this).find("input").val();
				if (ip_str == v) {
					_alert(1, '事件告警信息', phone_or_email + '重复', $(obj).prev('input'));
					$(obj).prev('input').focus();
					pass = 0;
					return false;
				}
			});
		}
		if (pass == 1) {
			var $c = $('<div id="" name="" class="item" style="padding-top: 0px;width: 260px;" value>');
			$c.html('<input type="text" class="form-text" style="width: 193px;" value="' + v + '">'
				+ '<i class="ctrl del" onclick="_delphone_or_email(this)"  style="margin-top: 0px;margin-left: 4px;"></i>');
			$(obj).parent().after($c);
			$(obj).prev('input').val("");
			$(obj).prev('input').focus();
		}
	}
	function _delphone_or_email(obj) {
		var $c = $(obj).parent();
		$c.fadeOut(function () {
			$c.remove();
		});
	}
	//删除接收人
	function _deladmin(obj, type) {
		var $c = $(obj).parent();
		var m_i = $(obj).parent().attr('value');
		$c.fadeOut(function () {
			$c.remove();
			var AlarmAction = $('#AlarmAction').val();
			if (AlarmAction == '1') {
				all_option_str_1[parseInt(m_i)] = check_option_str_1[parseInt(m_i)];
				check_option_str_1[parseInt(m_i)] = null;
				$('#admin_select option[index=0]').remove();
				$.each(all_option_str_1, function (i, item) {
					if (item != null) {
						$('#admin_select').append(item);
					}
				});
				$('#admin_select').trigger('change');
			} else {
				all_option_str_2[parseInt(m_i)] = check_option_str_2[parseInt(m_i)];
				check_option_str_2[parseInt(m_i)] = null;
				$('#admin_select1 option[index=0]').remove();
				$.each(all_option_str_2, function (i, item) {
					if (item != null) {
						$('#admin_select1').append(item);
					}
				});
				$('#admin_select1').trigger('change');
			}
			/*
			if (type == 1){
				var h1 = $("#label_list").height();
				if (h1 < 68){
					$("#AlarmReceiver_div").css("margin-top",38);
				}
			}else{
				var h1 = $("#label_list1").height();
				if (h1 < 68){
					$("#AlarmReceiver_div1").css("margin-top",38);
				}
			}
			*/
		});
	}
	//添加接收人
	function _addadmin(obj, type) {
		var m_i = $(obj).parent().children('select').find("option:selected").val();
		var text = $(obj).parent().children('select').find("option:selected").text();
		if (m_i == "0") {
			_alert(2, '事件告警信息', '请选择接收人');
			return false;
		}
		var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + m_i + '"/>');
		if (type == 1) {
			$c.html('<input class="form-text" type="text" style="width: 128px;" value="' + text + '" disabled="true"><i style="margin-left: 4px;" class="ctrl del" onclick="_deladmin(this,1)"></i>');
		} else {
			$c.html('<input class="form-text" type="text" style="width: 128px;" value="' + text + '" disabled="true"><i style="margin-left: 4px;" class="ctrl del" onclick="_deladmin(this,2)"></i>');
		}
		$(obj).parent().after($c);
		$(obj).parent().children('select').find('option[value=' + m_i + ']').remove();
		$(obj).parent().children('select').val(0).trigger("change");
		var AlarmAction = $('#AlarmAction').val();
		if (AlarmAction == '1') {
			check_option_str_1[parseInt(m_i)] = all_option_str_1[parseInt(m_i)];
			all_option_str_1[parseInt(m_i)] = null;
		} else {
			check_option_str_2[parseInt(m_i)] = all_option_str_2[parseInt(m_i)];
			all_option_str_2[parseInt(m_i)] = null;
		}
		//输入数字
		$(".num").bind('keydown', function (e) {
			DigitInput(e);
		});
	}
	var check_option_str_1 = [];
	var check_option_str_2 = [];
	var all_option_str_1 = [];
	var all_option_str_2 = [];

	//绑定邮箱下拉框
	function bind_mail_select() {
		var mail_array1 = [0];
		var mail_array2 = [0];
		xsel_mail_id1_pre[0] = -1;
		xsel_mail_id2_pre[0] = -1;
		$.ajax({
			url: '/bhost/select_mailserver_all',
			type: 'post',
			async: false,
			data: { a0: se, z1: -1 },
			success: function (result) {
				maildata = JSON.parse(result);
			}
		});
		var mail_array = [];
		mail_array.push({ 'value': -1, 'name': '全局指定', 'type': null });
		$.each(maildata.data, function (i, item) {
			if (manage_auth_array.indexOf(24) != -1) {
				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'edit'
				};
			} else {
				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'check'
				};
			}
			/*
			if (manage_auth_array.indexOf(24) != -1){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':'edit'
				};
			}else if (access_auth_array.indexOf(24) != -1){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':'check'
				};
			}else{
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':null
				};
			}
			*/
			select_data_json.value = item.SmtpConfigId;
			select_data_json.name = item.SmtpConfigName;
			mail_array.push(select_data_json);
			mail_array1.push(item.SmtpConfigId);
			mail_array2.push(item.SmtpConfigId);
		});
		$(".xSelect-mail_div1").remove();
		$("#mail_div1").empty().data("xSelect", "");
		if (manage_auth_array.indexOf(24) != -1) {
			$("#mail_div1").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: mail_array,
				module_type: "mail_div1",
				edit: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode2(obj, 1, 1);
				},
				btn: [
					{
						'name': '新增',
						'event': function (items, obj) {
							$(obj).parents('.xSelect-view').hide();
							_editNode2(obj, 2, 1);
						}
					}
				],
				setval: function (item, obj) {
					var xsel_id1 = $(obj).find('span').data('value');
					change_mail_option(1, mail_array, $(".xSelect-mail_div2"), mail_array2, xsel_id1, xsel_mail_id1_pre);
				}
			});
		} else {
			$("#mail_div1").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: mail_array,
				module_type: "mail_div1",
				check: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode2(obj, 1, 1);
				},
				setval: function (item, obj) {
					var xsel_id1 = $(obj).find('span').data('value');
					change_mail_option(1, mail_array, $(".xSelect-mail_div2"), mail_array2, xsel_id1, xsel_mail_id1_pre);
				}
			});
		}

		$("#mail_div1").data('value', -1);
		$(".xSelect-mail_div2").remove();
		$("#mail_div2").empty().data("xSelect", "");

		if (manage_auth_array.indexOf(24) != -1) {
			$("#mail_div2").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: mail_array,
				module_type: "mail_div2",
				edit: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode2(obj, 1, 2);
				},
				btn: [
					{
						'name': '新增',
						'event': function (items, obj) {
							$(obj).parents('.xSelect-view').hide();
							_editNode2(obj, 2, 2);
						}
					}
				],
				setval: function (item, obj) {
					var xsel_id2 = $(obj).find('span').data('value');
					change_mail_option(2, mail_array, $(".xSelect-mail_div1"), mail_array1, xsel_id2, xsel_mail_id2_pre);
				}
			});
		} else {
			$("#mail_div2").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: mail_array,
				module_type: "mail_div2",
				check: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode2(obj, 1, 2);
				},
				setval: function (item, obj) {
					var xsel_id2 = $(obj).find('span').data('value');
					change_mail_option(2, mail_array, $(".xSelect-mail_div1"), mail_array1, xsel_id2, xsel_mail_id2_pre);
				}
			});
		}

		$("#mail_div2").data('value', -1);
	}
	var xsel_mail_id1_pre = [-1];
	var xsel_mail_id2_pre = [-1];
	function change_mail_option(type, mail_array, obj, div_array, xsel_id, xsel_id_pre) {
		if (xsel_id_pre[0] != -1) {
			var index = $.inArray(-1, div_array);
			var name = mail_array[index].name;
			div_array[index] = xsel_id_pre[0];
			if (index == 1) {
				if (manage_auth_array.indexOf(24) != -1) {
					$(obj).find('span[data-value=' + div_array[index + 1] + ']').parent().before('<li><i class="edit"></i><span data-value="' + xsel_id_pre[0] + '" style="" title="' + name + '">' + name + '</span></li>');
				} else {
					$(obj).find('span[data-value=' + div_array[index + 1] + ']').parent().before('<li><i class="check"></i><span data-value="' + xsel_id_pre[0] + '" style="" title="' + name + '">' + name + '</span></li>');
				}
				//$(obj).find('span[data-value='+div_array[index+1]+']').parent().before('<li><i class="edit"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
			} else if (index <= div_array.length) {
				if (manage_auth_array.indexOf(24) != -1) {
					$(obj).find('span[data-value=' + div_array[index - 1] + ']').parent().after('<li><i class="edit"></i><span data-value="' + xsel_id_pre[0] + '" style="" title="' + name + '">' + name + '</span></li>');
				} else {
					$(obj).find('span[data-value=' + div_array[index - 1] + ']').parent().after('<li><i class="check"></i><span data-value="' + xsel_id_pre[0] + '" style="" title="' + name + '">' + name + '</span></li>');
				}
				//$(obj).find('span[data-value='+div_array[index-1]+']').parent().after('<li><i class="edit"></i><span data-value="'+xsel_id_pre[0]+'" style="" title="'+name+'">'+name+'</span></li>');
			}
		}
		if (xsel_id != -1) {
			var sel_span = $(obj).find('span[data-value=' + xsel_id + ']');
			sel_span.parent().remove();
			div_array.splice($.inArray(parseInt(xsel_id), div_array), 1, -1);
		}
		xsel_id_pre[0] = xsel_id;
	}

	function clear_mail() {
		$("#mail_suspend").find('input').val('');
		$("#SmtpConfigName").attr('disabled', false);
		$("#mail_suspend").find('i.v-check').attr('class', 'v-check');
		$("#AttachMaxLimit").val(0);
		$("#EnCode_mail").val(0).trigger('change');
		$("#Flag_mail").val(2).trigger('change');
		$("#ServerVerify_off").iCheck('check');
		xsel_mail_id1_pre = [-1];
		xsel_mail_id2_pre = [-1];
	}

	//邮件
	var mailset = {
		"SmtpConfigId": 0,
		"SmtpConfigName": "邮件服务器1",
		"SmtpServer": "10.17.251.5",
		"DNS": null,
		"Sender": "ithelp@fqnp.com",
		"SenderEmail": "ithelp@fqnp.com",
		"AttachMaxLimit": 20,
		"ServerVerify": true,
		"SenderEmailPass": "d106f6959747b5ac",
		"Flag": 0,
		"EnCode": 0
	}
	var mail_result;
	function _editNode2(obj, type, flag) {
		clear_mail();
		var title;
		if (type == 1) {
			//approveId = $(obj).parent().children('a').attr('id');
			mailId = $(obj).children('span').data('value');
			$.ajax({
				url: "/bhost/select_mailserver_all",
				type: "POST",
				async: false,
				data: { a0: se, z1: mailId },
				success: function (result) {
					mail_result = JSON.parse(result);
					mail_result = mail_result.data[0];
					title = "邮件";
				}
			});
		} else {
			mailId = 0;
			title = "邮件";
		}

		var $dialogCont = $("#mail_suspend").show();

		var d = dialog({
			title: title,
			content: $dialogCont,
			id: "mail_suspend",
			width: "800px"
		});
		d.addEventListener('close', function () {
			$dialogCont.appendTo("body").hide();
		});
		d.showModal();
		mail_main(type);
		$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
			clear_mail();
			mail_main(type);
			//d.close().remove();
		});

		$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
			mailserver_save(d, flag);
		});

	}

	function mail_main(type) {
		if (manage_auth_array.indexOf(24) === -1) {
			$("#mail_suspend").find('.btn-submit').remove();
		}
		if (type == 1) {
			mailset.SmtpConfigId = mail_result.SmtpConfigId;
			$("#SmtpConfigName").val(mail_result.SmtpConfigName);
			$("#SmtpConfigName").prop("disabled", true);
			$("#SmtpServer").val(mail_result.SmtpServer);
			$("#Sender").val(mail_result.Sender);
			$("#SenderEmail").val(mail_result.SenderEmail);
			$("#AttachMaxLimit").val(mail_result.AttachMaxLimit);
			if (mail_result.ServerVerify) {
				$("#ServerVerify_on").iCheck("check");
				$("#SenderEmailPass").parent().show();
				$("#SenderEmailPass").val(mail_result.SenderEmailPass);
			} else {
				$("#ServerVerify_off").iCheck("check");
				$("#SenderEmailPass").parent().hide();
			}
			$("#EnCode_mail").val(mail_result.EnCode).trigger('change');
			$("#Flag_mail").val(mail_result.Flag).trigger('change');
			if (mail_result.Flag == 2) {
				$.ajax({
					url: '/bhost/get_mail_flag',
					type: 'post',
					async: false,
					data: { a0: se },
					success: function (result) {
						var mail_flag = JSON.parse(result);
						if (mail_flag.Result) {
							if (mail_flag.count_mail == 2) {
								$("#Flag_mail").attr('disabled', true);
							}
						}
					}
				})
			}
		} else {
			$.ajax({
				url: '/bhost/get_mail_flag',
				type: 'post',
				async: false,
				data: { a0: se },
				success: function (result) {
					var mail_flag = JSON.parse(result);
					if (mail_flag.Result) {
						if (mail_flag.count_mail == 1) {
							$("#Flag_mail").val(2).trigger('change');
							$("#Flag_mail").attr('disabled', true);
						} else if (mail_flag.def_mail == 0) {
							$("#Flag_mail").val(2).trigger('change');
						} else if (mail_flag.spare_mail == 0) {
							$("#Flag_mail").val(1).trigger('change');
						} else {
							$("#Flag_mail").val(0).trigger('change');
						}
					}
				}
			})
		}

		$("#ServerVerify_on").on("ifChanged", function () {
			if ($(this).prop("checked")) {
				$("#SenderEmailPass").parent().show();
			} else {
				$("#SenderEmailPass").parent().hide();
			}
		})
	}

	var emailReg = /^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]+)+)$/;
	var ipcheck_route = /(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;
	var hostcheck1=/^(https?:\/\/)?(w{3}\.)?([a-zA-Z0-9-_.])+\.(com|cn|gov|info|us|hk|tw|cc|tv|uk|org)$/;
	var hostcheck2=/^(https?:\/\/)?((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$/;
	var nameCheck = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;

	//Email匹配
	function EmailCheck(obj) {
		var email = $(obj).val().trim();
		var $i = $(obj).next('i.v-check');
		if (!emailReg.test(email)) {
			$i.show().attr('class', 'v-check v-wrong');
		} else {
			$i.show().attr('class', 'v-check v-right');
		}
	}
	function IPCheck(obj) {
		var ip = $(obj).val().trim();
		var $i = $(obj).next('i.v-check');
		if (!ipcheck_route.test(ip)) {
			$i.show().attr('class', 'v-check v-wrong');
		} else {
			$i.show().attr('class', 'v-check v-right');
		}
	}
	function IPCheck_DNS(obj){
		var ip = $(obj).val().trim();
		var $i = $(obj).next('i.v-check');
		if (!ipcheck_route.test(ip) && (!hostcheck1.test(ip)) && (!hostcheck2.test(ip))){
			$i.show().attr('class','v-check v-wrong');
		}else{
			$i.show().attr('class','v-check v-right');
		}
	}	
	function NameCheck(obj) {
		var Name = $(obj).val();
		var $i = $(obj).next('i.v-check');
		if (!nameCheck.test(Name)) {
			$i.show().attr('class', 'v-check v-wrong');
		} else {
			$i.show().attr('class', 'v-check v-right');
		}
	}
	function fill_text() {
		var SenderEmail = $("#SenderEmail").val();
		if (SenderEmail != "" && $("#Sender").val() == "") {
			$("#Sender").val(SenderEmail);
		}
	}

	function NumCheck(obj) {
		obj.value = obj.value.replace(/\D/g, "");
		var v = obj.value.trim();
		if (v == "") {
			obj.value = '0';
		}
	}

	//保存配置
	function mailserver_save(d, flag) {
		var SmtpConfigName = $("#SmtpConfigName").val();
		var SmtpServer = $("#SmtpServer").val().trim();
		var Sender = $("#Sender").val();
		var SenderEmail = $("#SenderEmail").val();
		var AttachMaxLimit = $("#AttachMaxLimit").val();
		var SenderEmailPass;
		if (SmtpConfigName == "") {
			_alert(2, "邮件", "请输入名称", $("#SmtpConfigName"));
			return false;
		} else {
			if (!nameCheck.test(SmtpConfigName)) {
				_alert(1, "邮件", "名称格式不正确", $("#SmtpConfigName"));
				return false;
			}
		}
		if (SmtpServer == "") {
			_alert(2, "邮件", "请输入发送服务器", $("#SmtpServer"));
			return false;
		} else {
			if (!ipcheck_route.test(SmtpServer) && (!hostcheck1.test(SmtpServer)) && (!hostcheck2.test(SmtpServer))){
				_alert(1, "邮件", "发送服务器格式不正确", $("#SmtpServer"));
				return false;
			}
		}
		if (SenderEmail == "") {
			_alert(2, "邮件", "请输入发送方邮件地址", $("#SenderEmail"));
			return false;
		} else {
			if (!emailReg.test(SenderEmail)) {
				_alert(1, "邮件", "发送方邮件地址格式不正确", $("#SenderEmail"));
				return false;
			}
		}
		if ($("#ServerVerify_on").prop("checked")) {
			if ($("#SenderEmailPass").val() == "") {
				_alert(2, "邮件", "请输入服务器验证", $("#SenderEmailPass"));
				return false;
			} else {
				if($("#SenderEmailPass").val().length > 64){
					_alert(2, '邮件', "密码不能超过系统限定64位", $("#SenderEmailPass"));
					return false;
				}
				mailset.ServerVerify = true;
				mailset.SenderEmailPass = $("#SenderEmailPass").val();
			}
		} else {
			mailset.ServerVerify = false;
			mailset.SenderEmailPass = null;
		}

		mailset.SmtpConfigName = SmtpConfigName;
		mailset.SmtpServer = SmtpServer;
		mailset.DNS = null;
		mailset.Sender = Sender;
		mailset.SenderEmail = SenderEmail;
		mailset.AttachMaxLimit = AttachMaxLimit;
		mailset.Flag = parseInt($("#Flag_mail").val());
		mailset.EnCode = parseInt($("#EnCode_mail").val());
		msstr = aceg(JSON.stringify(mailset),se);
		$.ajax({
			url: '/bhost/save_mailserver',
			type: 'post',
			async: false,
			data: { a0: se, z1: JSON.stringify(mailset), m1:msstr, a10:"运维管理>全局策略"},
			success: function (result) {
				data = JSON.parse(result);
				if (data.Result == true) {
					parent.layer.open({
						type: 1,
						title: "邮件",
						content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						btn1: function (i) {
							$('.btn').blur();
							parent.layer.close(i);
							var mail_text1 = $('#mail_div1').find('span').text();
							var mail_text2 = $('#mail_div2').find('span').text();
							var mail_id1 = $('#mail_div1').data('value');
							var mail_id2 = $('#mail_div2').data('value');
							$("div[data-id=xSelect-mail_div1]").remove();
							$("div[data-id=xSelect-mail_div2]").remove();
							bind_mail_select();
							if (flag == 1) {
								if ($("#mail_div1").data('value') == "-1" || $("#mail_div1").data('value') == undefined) {
									mail_id1 = data.SmtpConfigId;
								}
							} else {
								if ($("#mail_div2").data('value') == "-1" || $("#mail_div2").data('value') == undefined) {
									mail_id2 = data.SmtpConfigId;
								}
							}
							$(".xSelect-mail_div1").find('span[data-value=' + mail_id1 + ']').click();
							$(".xSelect-mail_div2").find('span[data-value=' + mail_id2 + ']').click();
							/*
							if (flag == 1){
								if ($("#mail_div1").data('value') == "-1" || $("#mail_div1").data('value') == undefined){
									//$("#mail_div1").data('value',data.SmtpConfigId);
									//$("#mail_div1").find('span').text(mailset.SmtpConfigName);
									$(".xSelect-mail_div1").find('span[data-value='+data.SmtpConfigId+']').click();
								}else{
									//$('#mail_div1').find('span').text(mail_text1);
									$(".xSelect-mail_div1").find('span[data-value='+mail_id1+']').click();
								}
								if (mail_id2 != undefined && mail_id2 != '-1'){
									//$("#mail_div2").data('value',mail_id2);
									//$("#mail_div2").find('span').text(mail_text2);
									$(".xSelect-mail_div2").find('span[data-value='+mail_id2+']').click();
								}
							}else{
								if ($("#mail_div2").data('value') == "-1" || $("#mail_div2").data('value') == undefined){
									//$("#mail_div2").data('value',data.SmtpConfigId);
									//$("#mail_div2").find('span').text(mailset.SmtpConfigName);
									$(".xSelect-mail_div2").find('span[data-value='+data.SmtpConfigId+']').click();
								}else{
									//$('#mail_div2').find('span').text(mail_text2);
									$(".xSelect-mail_div2").find('span[data-value='+mail_id2+']').click();
								}
								if (mail_id1 != undefined && mail_id1 != '-1'){
									//$("#mail_div1").data('value',mail_id1);
									//$("#mail_div1").find('span').text(mail_text1);
									$(".xSelect-mail_div1").find('span[data-value='+mail_id1+']').click();
								}
							}
							*/
							d.close().remove();
						},
						btn2: function (i) {
							parent.layer.close(i);
						}
					});
				} else {
					_alert(1, "邮件", "执行失败：" + data.ErrMsg);
				}
			}
		});
	}

	//短信猫
	var xsel_smsm_id1_pre = [-1];
	var xsel_smsm_id2_pre = [-1];
	function bind_smsm_select() {
		var smsm_array1 = [0];
		var smsm_array2 = [0];
		xsel_smsm_id1_pre[0] = -1;
		xsel_smsm_id2_pre[0] = -1;
		var smsm_data;
		$.ajax({
			url: '/bhost/select_smsm_all',
			type: 'post',
			async: false,
			data: { a0: se, z1: -1 },
			success: function (result) {
				smsm_data = JSON.parse(result);
			}
		});
		var smsm_array = [];
		smsm_array.push({ 'value': -1, 'name': '全局指定', 'type': null });
		$.each(smsm_data.data, function (i, item) {
			if (manage_auth_array.indexOf(24) != -1) {
				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'edit'
				};
			} else {
				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'check'
				};
			}
			/*
			if (manage_auth_array.indexOf(24) != -1){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':'edit'
				};
			}else if (access_auth_array.indexOf(24) != -1){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':'check'
				};
			}else{
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':null
				};
			}
			*/
			select_data_json.value = item.SmsMConfigId;
			select_data_json.name = item.SmsMConfigName;
			smsm_array.push(select_data_json);
			smsm_array1.push(item.SmsMConfigId);
			smsm_array2.push(item.SmsMConfigId);
		});
		$(".xSelect-smsm_div1").remove();
		$("#smsm_div1").empty().data("xSelect", "");

		if (manage_auth_array.indexOf(24) != -1) {
			$("#smsm_div1").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: smsm_array,
				module_type: "smsm_div1",
				edit: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode3(obj, 1, 1);
				},
				btn: [
					{
						'name': '新增',
						'event': function (items, obj) {
							$(obj).parents('.xSelect-view').hide();
							_editNode3(obj, 2, 1);
						}
					}
				],
				setval: function (item, obj) {
					var xsel_id1 = $(obj).find('span').data('value');
					change_mail_option(1, smsm_array, $(".xSelect-smsm_div2"), smsm_array2, xsel_id1, xsel_smsm_id1_pre);
				}
			});
		} else {
			$("#smsm_div1").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: smsm_array,
				module_type: "smsm_div1",
				check: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode3(obj, 1, 1);
				},
				setval: function (item, obj) {
					var xsel_id1 = $(obj).find('span').data('value');
					change_mail_option(1, smsm_array, $(".xSelect-smsm_div2"), smsm_array2, xsel_id1, xsel_smsm_id1_pre);
				}
			});
		}

		$("#smsm_div1").data('value', -1);
		$(".xSelect-smsm_div2").remove();
		$("#smsm_div2").empty().data("xSelect", "");

		if (manage_auth_array.indexOf(24) != -1) {
			$("#smsm_div2").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: smsm_array,
				module_type: "smsm_div2",
				edit: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode3(obj, 1, 2);
				},
				btn: [
					{
						'name': '新增',
						'event': function (items, obj) {
							$(obj).parents('.xSelect-view').hide();
							_editNode3(obj, 2, 2);
						}
					}
				],
				setval: function (item, obj) {
					var xsel_id2 = $(obj).find('span').data('value');
					change_mail_option(2, smsm_array, $(".xSelect-smsm_div1"), smsm_array1, xsel_id2, xsel_smsm_id2_pre);
				}
			});
		} else {
			$("#smsm_div2").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: smsm_array,
				module_type: "smsm_div2",
				check: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode3(obj, 1, 2);
				},
				setval: function (item, obj) {
					var xsel_id2 = $(obj).find('span').data('value');
					change_mail_option(2, smsm_array, $(".xSelect-smsm_div1"), smsm_array1, xsel_id2, xsel_smsm_id2_pre);
				}
			});
		}

		$("#smsm_div2").data('value', -1);
	}

	function clear_smsm() {
		$("#smsm_suspend").find('input').val('');
		$("#SmsMConfigName").attr('disabled', false);
		$("#smsm_suspend").find('i.v-check').attr('class', 'v-check');
		$("#SmsMLimit").val(0);
		$("#EnCode_smsm").val(0).trigger('change');
		$("#Flag_smsm").val(2).trigger('change');
		xsel_smsm_id1_pre = [-1];
		xsel_smsm_id2_pre = [-1];
	}

	var smsm_result;
	function _editNode3(obj, type, flag) {
		clear_smsm();
		var title;
		if (type == 1) {
			//approveId = $(obj).parent().children('a').attr('id');
			smsmId = $(obj).children('span').data('value');
			$.ajax({
				url: "/bhost/select_smsm_all",
				type: "POST",
				async: false,
				data: { a0: se, z1: smsmId },
				success: function (result) {
					smsm_result = JSON.parse(result);
					smsm_result = smsm_result.data[0];
					title = "短信猫";
				}
			});
		} else {
			smsmId = 0;
			title = "短信猫";
		}

		var $dialogCont = $("#smsm_suspend").show();

		var d = dialog({
			title: title,
			content: $dialogCont,
			id: "smsm_suspend",
			width: "800px"
		});
		d.addEventListener('close', function () {
			$dialogCont.appendTo("body").hide();
		});
		d.showModal();
		smsm_main(type);
		$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
			clear_smsm();
			smsm_main(type);
			//d.close().remove();
		});

		$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
			smsmset_save(d, flag);
		});
	}

	var smsmset = {
		"SmsMConfigId": 0,
		"SmsMConfigName": "短信猫配置1",
		"SmsMSender": "13612345678",
		"SmsMLimit": 0,
		"Flag": 0,
		"EnCode": 0
	}

	function smsm_main(type) {
		if (manage_auth_array.indexOf(24) === -1) {
			$("#smsm_suspend").find('.btn-submit').remove();
		}
		$("#SmsMLimit,#SmsMSender").bind('keydown', function (e) {
			DigitInput(e);
		});
		if (type == 1) {
			smsmset.SmsMConfigId = smsm_result.SmsMConfigId;
			$("#SmsMConfigName").val(smsm_result.SmsMConfigName);
			$("#SmsMConfigName").prop("disabled", true);
			$("#SmsMSender").val(smsm_result.SmsMSender);
			$("#SmsMLimit").val(smsm_result.SmsMLimit);
			$("#Flag_smsm").val(smsm_result.Flag).trigger('change');
			$("#EnCode_smsm").val(smsm_result.EnCode).trigger('change');
			if (smsm_result.Flag == 2) {
				$.ajax({
					url: '/bhost/get_smsm_flag',
					type: 'post',
					async: false,
					data: { a0: se },
					success: function (result) {
						var smsm_flag = JSON.parse(result);
						if (smsm_flag.Result) {
							if (smsm_flag.count_smsm == 2) {
								$("#Flag_smsm").attr('disabled', true);
							}
						}
					}
				});
			}
		} else {
			smsmset.SmsMConfigId = 0;
			$.ajax({
				url: '/bhost/get_smsm_flag',
				type: 'post',
				async: false,
				data: { a0: se },
				success: function (result) {
					var smsm_flag = JSON.parse(result);
					if (smsm_flag.Result) {
						if (smsm_flag.count_smsm == 1) {
							$("#Flag_smsm").val(2).trigger('change');
							$("#Flag_smsm").attr('disabled', true);
						} else if (smsm_flag.def_smsm == 0) {
							$("#Flag_smsm").val(2).trigger('change');
						} else if (smsm_flag.spare_smsm == 0) {
							$("#Flag_smsm").val(1).trigger('change');
						} else {
							$("#Flag_smsm").val(0).trigger('change');
						}
					}
				}
			})
		}
	}

	//检查名称是否存在
	function check_name(name, obj) {
		var add = 0;
		$.ajax({
			url: '/bhost/check_smsmconfig_name',
			type: 'post',
			async: false,
			data: { a0: se, z1: name },
			success: function (result) {
				if (result != "0") {
					add = 1;
					_alert(2, "短信猫", "该名称已存在", $(obj));
					return false;
				}
			}
		})
		if (add == 1) {
			return false;
		} else {
			return true;
		}
	}
	function limitCheck(obj) {
		obj.value = obj.value.replace(/\D/g, "");
		var v = obj.value.trim();
		if (v == "") {
			obj.value = '0';
		}
	}

	//保存配置
	function smsmset_save(d, flag) {
		var smsmset_list = [];
		var add = 0;
		var numCheck = /\D/;
		var isexist;
		var SmsMConfigName = $("#SmsMConfigName").val();
		var SmsMSender = $("#SmsMSender").val();
		var SmsMLimit = $("#SmsMLimit").val();
		var EnCode = $("#EnCode_smsm").val();
		var Flag = $("#Flag_smsm").val();

		if (SmsMConfigName == "") {
			add = 1;
			_alert(2, "短信猫", "请输入名称", $("#SmsMConfigName"));
			return false;
		} else {
			if (!nameCheck.test(SmsMConfigName)) {
				add = 1;
				_alert(1, "短信猫", "名称格式不正确", $("#SmsMConfigName"));
				return false;
			}
		}
		if (SmsMSender == "") {
			add = 1;
			_alert(2, "短信猫", "请输入短信中心", $("#SmsMSender"));
			return false;
		} else {
			if (numCheck.test(SmsMSender)) {
				add = 1;
				_alert(1, "短信猫", "短信中心格式不正确", $("#SmsMSender"));
				return false;
			}
		}
		if (SmsMLimit == "") {
			add = 1;
			_alert(2, "短信猫", "请输入发送限制", $("#SmsMLimit"));
			return false
		} else {
			if (numCheck.test(SmsMLimit)) {
				add = 1;
				_alert(1, "短信猫", "短信猫格式不正确", $("#SmsMLimit"));
				return false;
			}
		}
		smsmset.SmsMConfigName = SmsMConfigName;
		smsmset.SmsMSender = SmsMSender;
		smsmset.SmsMLimit = SmsMLimit;
		smsmset.EnCode = parseInt(EnCode);
		smsmset.Flag = parseInt(Flag);
		smsmset_list.push(JSON.stringify(smsmset));
		$('.btn').blur();
		var msstr = aceg(JSON.stringify(smsmset_list),se);
		$.ajax({
			url: '/bhost/save_smsm',
			type: 'post',
			async: false,
			data: { a0: se, z1: JSON.stringify(smsmset_list), m1:msstr},
			success: function (result) {
				data = JSON.parse(result);
				if (data.Result == true) {
					parent.layer.open({
						type: 1,
						title: "短信猫",
						content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						btn1: function (i) {
							parent.layer.close(i);
							var smsm_text1 = $('#smsm_div1').find('span').text();
							var smsm_text2 = $('#smsm_div2').find('span').text();
							var smsm_id1 = $('#smsm_div1').data('value');
							var smsm_id2 = $('#smsm_div2').data('value');
							$("div[data-id=xSelect-smsm_div1]").remove();
							$("div[data-id=xSelect-smsm_div2]").remove();
							bind_smsm_select();
							if (flag == 1) {
								if ($("#smsm_div1").data('value') == "-1" || $("#smsm_div1").data('value') == undefined) {
									smsm_id1 = data.SmsMConfigId;
								}
							} else {
								if ($("#smsm_div2").data('value') == "-1" || $("#smsm_div2").data('value') == undefined) {
									smsm_id2 = data.SmsMConfigId;
								}
							}
							$(".xSelect-smsm_div1").find('span[data-value=' + smsm_id1 + ']').click();
							$(".xSelect-smsm_div2").find('span[data-value=' + smsm_id2 + ']').click();
							/*
							if (flag == 1){
								if ($("#smsm_div1").data('value') == "-1" || $("#smsm_div1").data('value') == undefined){
									//$("#smsm_div1").data('value',data.SmsMConfigId);
									//$("#smsm_div1").find('span').text(smsmset.SmsMConfigName);
									$("#xSelect-smsm_div1").find('span[data-value='+data.SmsMConfigId+']').click();
								}else{
									//$('#smsm_div1').find('span').text(smsm_text1);
									$("#xSelect-smsm_div1").find('span[data-value='+smsm_id1+']').click();
								}
								if (smsm_id2 != undefined && smsm_id2 != '-1'){
									//$("#smsm_div2").data('value',smsm_id2);
									//$("#smsm_div2").find('span').text(smsm_text2);
									$("#xSelect-smsm_div2").find('span[data-value='+smsm_id2+']').click();
								}
							}else{
								if ($("#smsm_div2").data('value') == "-1" || $("#smsm_div2").data('value') == undefined){
									//$("#smsm_div2").data('value',data.SmsMConfigId);
									//$("#smsm_div2").find('span').text(smsmset.SmsMConfigName);
									$("#xSelect-smsm_div2").find('span[data-value='+data.SmsMConfigId+']').click();
								}else{
									//$('#smsm_div2').find('span').text(smsm_text2);
									$("#xSelect-smsm_div2").find('span[data-value='+smsm_id2+']').click();
								}
								if (smsm_id1 != undefined && smsm_id1 != '-1'){
									//$("#smsm_div1").data('value',smsm_id1);
									//$("#smsm_div1").find('span').text(smsm_text1);
									$("#xSelect-smsm_div1").find('span[data-value='+smsm_id1+']').click();
								}
							}
							*/
							d.close().remove();
						},
						btn2: function (i) {
							parent.layer.close(i);
						}
					});
				} else {
					_alert(1, "短信猫", "执行失败：" + data.ErrMsg);
				}
			}
		});
	}

	//短信网关
	var xsel_smssvr_id1_pre = [-1];
	var xsel_smssvr_id2_pre = [-1];
	function bind_smssvr_select() {
		var smssvr_array1 = [0];
		var smssvr_array2 = [0];
		xsel_smssvr_id1_pre[0] = -1;
		xsel_smssvr_id2_pre[0] = -1;
		var smssvr_data;
		$.ajax({
			url: '/bhost/select_smssvr_all',
			type: 'post',
			async: false,
			data: { a0: se, z1: -1 },
			success: function (result) {
				smssvr_data = JSON.parse(result);
			}
		});
		var smssvr_array = [];
		smssvr_array.push({ 'value': -1, 'name': '全局指定', 'type': null });
		$.each(smssvr_data.data, function (i, item) {
			if (manage_auth_array.indexOf(24) != -1) {
				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'edit'
				};
			} else {
				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'check'
				};
			}
			/*
			if (manage_auth_array.indexOf(24) != -1){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':'edit'
				};
			}else if (access_auth_array.indexOf(24) != -1){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':'check'
				};
			}else{
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':null
				};
			}
			*/
			select_data_json.value = item.SmsSvrConfigId;
			select_data_json.name = item.SmsSvrConfigName;
			smssvr_array.push(select_data_json);
			smssvr_array1.push(item.SmsSvrConfigId);
			smssvr_array2.push(item.SmsSvrConfigId);
		});
		$(".xSelect-smssvr_div1").remove();
		$("#smssvr_div1").empty().data("xSelect", "");

		if (manage_auth_array.indexOf(24) != -1) {
			$("#smssvr_div1").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: smssvr_array,
				module_type: "smssvr_div1",
				edit: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode4(obj, 1, 1);
				},
				btn: [
					{
						'name': '新增',
						'event': function (items, obj) {
							$(obj).parents('.xSelect-view').hide();
							_editNode4(obj, 2, 1);
						}
					}
				],
				setval: function (item, obj) {
					var xsel_id1 = $(obj).find('span').data('value');
					change_mail_option(1, smssvr_array, $(".xSelect-smssvr_div2"), smssvr_array2, xsel_id1, xsel_smssvr_id1_pre);
				}
			});
		} else {
			$("#smssvr_div1").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: smssvr_array,
				module_type: "smssvr_div1",
				check: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode4(obj, 1, 1);
				},
				setval: function (item, obj) {
					var xsel_id1 = $(obj).find('span').data('value');
					change_mail_option(1, smssvr_array, $(".xSelect-smssvr_div2"), smssvr_array2, xsel_id1, xsel_smssvr_id1_pre);
				}
			});
		}

		$("#smssvr_div1").data('value', -1);
		$(".xSelect-smssvr_div2").remove();
		$("#smssvr_div2").empty().data("xSelect", "");

		if (manage_auth_array.indexOf(24) != -1) {
			$("#smssvr_div2").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: smssvr_array,
				module_type: "smssvr_div2",
				edit: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode4(obj, 1, 2);
				},
				btn: [
					{
						'name': '新增',
						'event': function (items, obj) {
							$(obj).parents('.xSelect-view').hide();
							_editNode4(obj, 2, 2);
						}
					}
				],
				setval: function (item, obj) {
					var xsel_id2 = $(obj).find('span').data('value');
					change_mail_option(2, smssvr_array, $(".xSelect-smssvr_div1"), smssvr_array1, xsel_id2, xsel_smssvr_id2_pre);
				}
			});
		} else {
			$("#smssvr_div2").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: smssvr_array,
				module_type: "smssvr_div2",
				check: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode4(obj, 1, 2);
				},
				setval: function (item, obj) {
					var xsel_id2 = $(obj).find('span').data('value');
					change_mail_option(2, smssvr_array, $(".xSelect-smssvr_div1"), smssvr_array1, xsel_id2, xsel_smssvr_id2_pre);
				}
			});
		}

		$("#smssvr_div2").data('value', -1);
	}

	function clear_smssvr() {
		$("#smssvr_suspend").find('input').val('');
		$("#SmsSvrConfigName").attr('disabled', false);
		$("#smssvr_suspend").find('i.v-check').attr('class', 'v-check');
		$("#SmsSvrDBType").val(1).trigger('change');
		$("#EnCode_smssvr").val(0).trigger('change');
		$("#Flag_smssvr").val(2).trigger('change');
		xsel_smssvr_id1_pre[0] = -1;
		xsel_smssvr_id2_pre[0] = -1;
	}

	var smssvr_result;
	function _editNode4(obj, type, flag) {
		clear_smssvr();
		var title;
		if (type == 1) {
			//approveId = $(obj).parent().children('a').attr('id');
			smssvrId = $(obj).children('span').data('value');
			$.ajax({
				url: "/bhost/select_smssvr_all",
				type: "POST",
				async: false,
				data: { a0: se, z1: smssvrId },
				success: function (result) {
					smssvr_result = JSON.parse(result);
					smssvr_result = smssvr_result.data[0];
					title = "短信网关";
				}
			});
		} else {
			smssvrId = 0;
			title = "短信网关";
		}

		var $dialogCont = $("#smssvr_suspend").show();

		var d = dialog({
			title: title,
			content: $dialogCont,
			id: "smssvr_suspend",
			width: "800px"
		});
		d.addEventListener('close', function () {
			$dialogCont.appendTo("body").hide();
		});
		d.showModal();
		smssvr_main(type);
		$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
			clear_smssvr();
			smssvr_main(type);
			//d.close().remove();
		});

		$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
			smssvr_save(d, flag);
		});
	}

	var smssvset = {
		"SmsSvrConfigId": 0,
		"SmsSvrConfigName": "短信网关配置1",
		"SmsSvrDBType": 2,
		"SmsSvrDBServerIP": "192.168.0.1",
		"SmsSvrDBPort": 1433,
		"SmsSvrDBUserName": "root",
		"SmsSvrDBPassword": "d106f6959747b5ac",
		"SmsSvrDBDatabase": "mysql",
		"SmsSvrDBInsertTemp": null,
		"Flag": 0,
		"EnCode": 0
	}

	function smssvr_main(type) {
		if (manage_auth_array.indexOf(24) === -1) {
			$("#smssvr_suspend").find('.btn-submit').remove();
		}
		$("#SmsSvrDBPort").bind('keydown', function (e) {
			DigitInput(e);
		});
		if (type == 1) {
			smssvset.SmsSvrConfigId = smssvr_result.SmsSvrConfigId;
			$("#SmsSvrConfigName").val(smssvr_result.SmsSvrConfigName);
			$("#SmsSvrConfigName").prop("disabled", true);
			$("#SmsSvrDBType").val(smssvr_result.SmsSvrDBType).trigger('change');
			$("#SmsSvrDBServerIP").val(smssvr_result.SmsSvrDBServerIP);
			$("#SmsSvrDBPort").val(smssvr_result.SmsSvrDBPort);
			$("#SmsSvrDBUserName").val(smssvr_result.SmsSvrDBUserName);
			$("#SmsSvrDBPassword").val(smssvr_result.SmsSvrDBPassword);
			$("#SmsSvrDBDatabase").val(smssvr_result.SmsSvrDBDatabase);
			if (smssvr_result.SmsSvrDBInsertTemp != null) {
				$("#SmsSvrDBInsertTemp").val(smssvr_result.SmsSvrDBInsertTemp);
			}
			$("#Flag_smssvr").val(smssvr_result.Flag).trigger('change');
			$("#EnCode_smssvr").val(smssvr_result.EnCode).trigger('change');
			if (smssvr_result.Flag == 2) {
				$.ajax({
					url: '/bhost/get_smssvr_flag',
					type: 'post',
					async: false,
					data: { a0: se },
					success: function (result) {
						var smssvr_flag = JSON.parse(result);
						if (smssvr_flag.Result) {
							if (smssvr_flag.count_smssvr == 2) {
								$("#Flag_smssvr").attr('disabled', true);
							}
						}
					}
				})
			}
		} else {
			smssvset.SmsSvrConfigId = 0;
			$.ajax({
				url: '/bhost/get_smssvr_flag',
				type: 'post',
				async: false,
				data: { a0: se },
				success: function (result) {
					var smssvr_flag = JSON.parse(result);
					if (smssvr_flag.Result) {
						if (smssvr_flag.count_smssvr == 1) {
							$("#Flag_smssvr").val(2).trigger('change');
							$("#Flag_smssvr").attr('disabled', true);
						} else if (smssvr_flag.def_smssvr == 0) {
							$("#Flag_smssvr").val(2).trigger('change');
						} else if (smssvr_flag.spare_smssvr == 0) {
							$("#Flag_smssvr").val(1).trigger('change');
						} else {
							$("#Flag_smssvr").val(0).trigger('change');
						}
					}
				}
			})
		}
	}

	function temp_check(obj) {
		var v = $(obj).val();
		var $i = $(obj).next('i.v-check');
		if (v.indexOf("%phone%") === -1 || v.indexOf("%content%") === -1) {
			$i.show().attr('class', 'v-check v-wrong');
		} else {
			$i.show().attr('class', 'v-check v-right');
		}
	}

	//保存配置
	function smssvr_save(d, flag) {
		var numCheck = /\D/;
		var SmsSvrConfigName = $("#SmsSvrConfigName").val();
		var SmsSvrDBType = $("#SmsSvrDBType").val();
		var SmsSvrDBServerIP = $("#SmsSvrDBServerIP").val();
		var SmsSvrDBPort = $("#SmsSvrDBPort").val();
		var SmsSvrDBUserName = $("#SmsSvrDBUserName").val();
		var SmsSvrDBPassword = $("#SmsSvrDBPassword").val();
		var SmsSvrDBDatabase = $("#SmsSvrDBDatabase").val();
		var SmsSvrDBInsertTemp = $("#SmsSvrDBInsertTemp").val();
		if (SmsSvrConfigName == "") {
			_alert(2, "短信网关", "请输入名称", $("#SmsSvrConfigName"));
			return false;
		} else {
			if (!nameCheck.test(SmsSvrConfigName)) {
				_alert(1, "短信网关", "名称格式不正确", $("#SmsSvrConfigName"));
				return false;
			}
		}
		if (SmsSvrDBServerIP == "") {
			_alert(2, "短信网关", "请输入服务器地址", $("#SmsSvrDBServerIP"));
			return false;
		} else {
			if (!ipcheck_route.test(SmsSvrDBServerIP)) {
				_alert(1, "短信网关", "服务器地址格式不正确", $("#SmsSvrDBServerIP"));
				return false;
			}
		}
		if (SmsSvrDBPort == "") {
			_alert(2, "短信网关", "请输入端口", $("#SmsSvrDBPort"));
			return false;
		} else {
			if (numCheck.test(SmsSvrDBPort)) {
				_alert(1, "短信网关", "端口格式不正确", $("#SmsSvrDBPort"));
				return false;
			}
			if (parseInt(SmsSvrDBPort) > 65534) {
				_alert(1, "短信网关", "端口不能大于65534", $("#SmsSvrDBPort"));
				return false;
			}
			if (parseInt(SmsSvrDBPort) < 1) {
				_alert(1, "短信网关", "端口不能小于1", $("#SmsSvrDBPort"));
				return false;
			}
		}
		if (SmsSvrDBUserName == "") {
			_alert(2, "短信网关", "请输入账号", $("#SmsSvrDBUserName"));
			return false;
		} else {
			if (!nameCheck.test(SmsSvrDBUserName)) {
				_alert(1, "短信网关", "账号格式不正确", $("#SmsSvrDBUserName"));
				return false;
			}
		}
		if (SmsSvrDBPassword == "") {
			_alert(2, "短信网关", "请输入密码", $("#SmsSvrDBPassword"));
			return false;
		}
		if (SmsSvrDBDatabase == "") {
			_alert(2, "短信网关", "请输入数据库", $("#SmsSvrDBDatabase"));
			return false;
		}
		if (SmsSvrDBInsertTemp == "") {
			_alert(2, "短信网关", "请输入短信sql语句模板", $("#SmsSvrDBInsertTemp"));
			return false;
		} else {
			if (SmsSvrDBInsertTemp.indexOf("%phone%") === -1 || SmsSvrDBInsertTemp.indexOf("%content%") === -1) {
				_alert(1, "短信网关", "模板格式不正确", $("#SmsSvrDBInsertTemp"));
				return false;
			}
		}
		smssvset.SmsSvrConfigName = SmsSvrConfigName;
		smssvset.SmsSvrDBType = SmsSvrDBType;
		smssvset.SmsSvrDBServerIP = SmsSvrDBServerIP;
		smssvset.SmsSvrDBPort = SmsSvrDBPort;
		smssvset.SmsSvrDBUserName = SmsSvrDBUserName;
		smssvset.SmsSvrDBPassword = SmsSvrDBPassword;
		smssvset.SmsSvrDBDatabase = SmsSvrDBDatabase;
		smssvset.SmsSvrDBInsertTemp = SmsSvrDBInsertTemp;
		smssvset.Flag = parseInt($("#Flag_smssvr").val());
		smssvset.EnCode = parseInt($("#EnCode_smssvr").val());
		var msstr = aceg(JSON.stringify(smssvset),se);
		$.ajax({
			url: '/bhost/save_smssvr',
			type: 'post',
			async: false,
			data: { a0: se, z1: JSON.stringify(smssvset), m1:msstr},
			success: function (result) {
				data = JSON.parse(result);
				if (data.Result == true) {
					parent.layer.open({
						type: 1,
						title: "短信网关",
						content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						btn1: function (i) {
							parent.layer.close(i);
							$('.btn').blur();
							var smssvr_text1 = $('#smssvr_div1').find('span').text();
							var smssvr_text2 = $('#smssvr_div2').find('span').text();
							var smssvr_id1 = $('#smssvr_div1').data('value');
							var smssvr_id2 = $('#smssvr_div2').data('value');
							$("div[data-id=xSelect-smssvr_div1]").remove();
							$("div[data-id=xSelect-smssvr_div2]").remove();
							bind_smssvr_select();
							if (flag == 1) {
								if ($("#smssvr_div1").data('value') == "-1" || $("#smssvr_div1").data('value') == undefined) {
									smssvr_id1 = data.SmsSvrConfigId;
								}
							} else {
								if ($("#smssvr_div2").data('value') == "-1" || $("#smssvr_div2").data('value') == undefined) {
									smssvr_id2 = data.SmsSvrConfigId;
								}
							}
							$(".xSelect-smssvr_div1").find('span[data-value=' + smssvr_id1 + ']').click();
							$(".xSelect-smssvr_div2").find('span[data-value=' + smssvr_id2 + ']').click();
							/*
							if (flag == 1){
								if ($("#smssvr_div1").data('value') == "-1" || $("#smssvr_div1").data('value') == undefined){
									//$("#smssvr_div1").data('value',data.SmsSvrConfigId);
									//$("#smssvr_div1").find('span').text(smssvset.SmsSvrConfigName);
									$(".xSelect-smssvr_div1").find('span[data-value='+data.SmsSvrConfigId+']').click();
								}else{
									//$('#smssvr_div1').find('span').text(smssvr_text1);
									$(".xSelect-smssvr_div1").find('span[data-value='+smssvr_id1+']').click();
								}
								if (smssvr_id2 != undefined && smssvr_id2 != '-1'){
									//$("#smssvr_div2").data('value',smssvr_id2);
									//$("#smssvr_div2").find('span').text(smssvr_text2);
									$(".xSelect-smssvr_div2").find('span[data-value='+smssvr_id2+']').click();
								}
							}else{
								if ($("#smssvr_div2").data('value') == "-1" || $("#smssvr_div2").data('value') == undefined){
									//$("#smssvr_div2").data('value',data.SmsSvrConfigId);
									//$("#smssvr_div2").find('span').text(smssvset.SmsSvrConfigName);
									$(".xSelect-smssvr_div2").find('span[data-value='+data.SmsSvrConfigId+']').click();
								}else{
									//$('#smssvr_div2').find('span').text(smssvr_text2);
									$(".xSelect-smssvr_div2").find('span[data-value='+smssvr_id2+']').click();
								}
								if (smssvr_id1 != undefined && smssvr_id1 != '-1'){
									//$("#smssvr_div1").data('value',smssvr_id1);
									//$("#smssvr_div1").find('span').text(smssvr_text1);
									$(".xSelect-smssvr_div2").find('span[data-value='+smssvr_id1+']').click();
								}
							}
							*/
							d.close().remove();
						},
						btn2: function (i) {
							parent.layer.close(i);
						}
					});
				} else {
					_alert(1, "短信网关", "执行失败：" + data.ErrMsg);
				}
			}
		});
	}

	//snmp
	var xsel_snmp_id1_pre = [-1];
	var xsel_snmp_id2_pre = [-1];
	function bind_snmp_select() {
		var snmp_array1 = [0];
		var snmp_array2 = [0];
		xsel_snmp_id1_pre[0] = -1;
		xsel_snmp_id2_pre[0] = -1;
		var snmp_data;
		$.ajax({
			url: '/bhost/select_snmp_all',
			type: 'post',
			async: false,
			data: { a0: se, z1: -1 },
			success: function (result) {
				snmp_data = JSON.parse(result);
			}
		});
		var snmp_array = [];
		snmp_array.push({ 'value': -1, 'name': '全局指定', 'type': null });
		$.each(snmp_data.data, function (i, item) {
			if (manage_auth_array.indexOf(24) != -1) {
				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'edit'
				};
			} else {
				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'check'
				};
			}
			/*
			if (manage_auth_array.indexOf(24) != -1){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':'edit'
				};
			}else if (access_auth_array.indexOf(24) != -1){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':'check'
				};
			}else{
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':null
				};
			}
			*/
			select_data_json.value = item.SnmpConfigId;
			select_data_json.name = item.SnmpConfigName;
			snmp_array.push(select_data_json);
			snmp_array1.push(item.SnmpConfigId);
			snmp_array2.push(item.SnmpConfigId);
		});
		$(".xSelect-snmp_div1").remove();
		$("#snmp_div1").empty().data("xSelect", "");

		if (manage_auth_array.indexOf(24) != -1) {
			$("#snmp_div1").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: snmp_array,
				module_type: "snmp_div1",
				edit: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode5(obj, 1, 1);
				},
				btn: [
					{
						'name': '新增',
						'event': function (items, obj) {
							$(obj).parents('.xSelect-view').hide();
							_editNode5(obj, 2, 1);
						}
					}
				],
				setval: function (item, obj) {
					var xsel_id1 = $(obj).find('span').data('value');
					change_mail_option(1, snmp_array, $(".xSelect-snmp_div2"), snmp_array2, xsel_id1, xsel_snmp_id1_pre);
				}
			});
		} else {
			$("#snmp_div1").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: snmp_array,
				module_type: "snmp_div1",
				check: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode5(obj, 1, 1);
				},
				setval: function (item, obj) {
					var xsel_id1 = $(obj).find('span').data('value');
					change_mail_option(1, snmp_array, $(".xSelect-snmp_div2"), snmp_array2, xsel_id1, xsel_snmp_id1_pre);
				}
			});
		}

		$("#snmp_div1").data('value', -1);
		$(".xSelect-snmp_div2").remove();
		$("#snmp_div2").empty().data("xSelect", "");

		if (manage_auth_array.indexOf(24) != -1) {
			$("#snmp_div2").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: snmp_array,
				module_type: "snmp_div2",
				edit: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode5(obj, 1, 2);
				},
				btn: [
					{
						'name': '新增',
						'event': function (items, obj) {
							$(obj).parents('.xSelect-view').hide();
							_editNode5(obj, 2, 2);
						}
					}
				],
				setval: function (item, obj) {
					var xsel_id2 = $(obj).find('span').data('value');
					change_mail_option(2, snmp_array, $(".xSelect-snmp_div1"), snmp_array1, xsel_id2, xsel_snmp_id2_pre);
				}
			});
		} else {
			$("#snmp_div2").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: snmp_array,
				module_type: "snmp_div2",
				check: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode5(obj, 1, 2);
				},
				setval: function (item, obj) {
					var xsel_id2 = $(obj).find('span').data('value');
					change_mail_option(2, snmp_array, $(".xSelect-snmp_div1"), snmp_array1, xsel_id2, xsel_snmp_id2_pre);
				}
			});
		}

		$("#snmp_div2").data('value', -1);
	}

	function clear_snmp() {
		$("#snmp_suspend").find('input').val('');
		$("#SnmpConfigName").attr('disabled', false);
		$("#snmp_suspend").find('i.v-check').attr('class', 'v-check');
		$("#EnCode_snmp").val(0).trigger('change');
		$("#Flag_snmp").val(2).trigger('change');
		xsel_snmp_id1_pre[0] = -1;
		xsel_snmp_id2_pre[0] = -1;
	}

	var snmp_result;
	function _editNode5(obj, type, flag) {
		clear_snmp();
		var title;
		if (type == 1) {
			//approveId = $(obj).parent().children('a').attr('id');
			snmpId = $(obj).children('span').data('value');
			$.ajax({
				url: "/bhost/select_snmp_all",
				type: "POST",
				async: false,
				data: { a0: se, z1: snmpId },
				success: function (result) {
					snmp_result = JSON.parse(result);
					snmp_result = snmp_result.data[0];
					title = "SNMP";
				}
			});
		} else {
			snmpId = 0;
			title = "SNMP";
		}

		var $dialogCont = $("#snmp_suspend").show();

		var d = dialog({
			title: title,
			content: $dialogCont,
			id: "snmp_suspend",
			width: "800px"
		});
		d.addEventListener('close', function () {
			$dialogCont.appendTo("body").hide();
		});
		d.showModal();
		snmp_main(type);
		$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
			clear_snmp();
			snmp_main(type);
			//d.close().remove();
		});

		$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
			snmp_save(d, flag);
		});
	}

	var snmp = {
		"SnmpConfigId": 0,
		"SnmpConfigName": "SYSLOG配置1",
		"SnmpServerIP": "192.168.0.54",
		"SnmpPort": 514,
		"Flag": 0,
		"EnCode": 0
	}

	function snmp_main(type) {
		if (manage_auth_array.indexOf(24) === -1) {
			$("#snmp_suspend").find(".btn-submit").remove();
		}
		$("#SnmpPort").bind('keydown', function (e) {
			DigitInput(e);
		});
		if (type == 1) {
			snmp.SnmpConfigId = snmp_result.SnmpConfigId;
			$("#SnmpConfigName").val(snmp_result.SnmpConfigName);
			$("#SnmpConfigName").prop("disabled", true);
			$("#SnmpServerIP").val(snmp_result.SnmpServerIP);
			$("#SnmpPort").val(snmp_result.SnmpPort);
			$("#EnCode_snmp").val(snmp_result.EnCode).trigger('change');
			$("#Flag_snmp").val(snmp_result.Flag).trigger('change');
			if (snmp_result.Flag == 2) {
				$.ajax({
					url: '/bhost/get_snmp_flag',
					type: 'post',
					async: false,
					data: { a0: se },
					success: function (result) {
						var snmp_flag = JSON.parse(result);
						if (snmp_flag.Result) {
							if (snmp_flag.count_snmp == 2) {
								$("#Flag_snmp").attr('disabled', true);
							}
						}
					}
				})
			}
		} else {
			snmp.SnmpConfigId = 0;
			$.ajax({
				url: '/bhost/get_snmp_flag',
				type: 'post',
				async: false,
				data: { a0: se },
				success: function (result) {
					var snmp_flag = JSON.parse(result);
					if (snmp_flag.Result) {
						if (snmp_flag.count_snmp == 1) {
							$("#Flag_snmp").val(2).trigger('change');
							$("#Flag_snmp").attr('disabled', true);
						} else if (snmp_flag.def_snmp == 0) {
							$("#Flag_snmp").val(2).trigger('change');
						} else if (snmp_flag.spare_snmp == 0) {
							$("#Flag_snmp").val(1).trigger('change');
						} else {
							$("#Flag_snmp").val(0).trigger('change');
						}
					}
				}
			})
		}
	}

	function PortCheck(obj) {
		var numCheck = /\D/;
		var num = $(obj).val().trim();
		var $i = $(obj).next('i.v-check');
		if (numCheck.test(num) || num == "" || parseInt(num) < 1 || parseInt(num) > 65534) {
			$i.show().attr('class', 'v-check v-wrong');
		} else {
			$i.show().attr('class', 'v-check v-right');
		}
	}
	//保存配置
	function snmp_save(d, flag) {
		var numCheck = /\D/;
		var snmp_list = [];
		var isexist;
		var SnmpConfigName = $("#SnmpConfigName").val();
		var SnmpServerIP = $("#SnmpServerIP").val();
		var SnmpPort = $("#SnmpPort").val();
		var Flag = $("#Flag_snmp").val();
		var EnCode = $("#EnCode_snmp").val();

		if (SnmpConfigName == "") {
			_alert(2, "SNMP", "请输入名称", $("#SnmpConfigName"));
			return false;
		} else {
			if (!nameCheck.test(SnmpConfigName)) {
				_alert(1, "SNMP", "名称格式不正确", $("#SnmpConfigName"));
				return false;
			}
		}

		if (SnmpServerIP == "") {
			_alert(2, "SNMP", "请输入服务器地址", $("#SnmpServerIP"));
			return false;
		} else {
			if (!ipcheck_route.test(SnmpServerIP)) {
				_alert(1, "SNMP", "服务器地址格式不正确", $("#SnmpServerIP"));
				return false;
			}
		}
		if (SnmpPort == "") {
			_alert(2, "SNMP", "请输入端口", $("#SnmpPort"));
			return false
		} else {
			if (numCheck.test(parseInt(SnmpPort))) {
				_alert(1, "SNMP", "端口格式不正确", $("#SnmpPort"));
				return false;
			}
			if (parseInt(SnmpPort) < 1) {
				_alert(1, "SNMP", "端口不能小于1", $("#SnmpPort"));
				return false;
			}
			if (parseInt(SnmpPort) > 65534) {
				add = 1;
				_alert(1, "SNMP", "端口不能大于65534", $("#SnmpPort"));
				return false;
			}
		}
		snmp.SnmpConfigName = SnmpConfigName;
		snmp.SnmpServerIP = SnmpServerIP;
		snmp.SnmpPort = parseInt(SnmpPort);
		snmp.Flag = parseInt(Flag);
		snmp.EnCode = parseInt(EnCode);
		snmp_list.push(JSON.stringify(snmp));
		var msstr = aceg(JSON.stringify(snmp_list),se);
		$.ajax({
			url: '/bhost/save_snmp',
			type: 'post',
			async: false,
			data: { a0: se, z1: JSON.stringify(snmp_list), m1:msstr},
			success: function (result) {
				data = JSON.parse(result);
				if (data.Result == true) {
					parent.layer.open({
						type: 1,
						title: "SNMP",
						content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						btn1: function (i) {
							parent.layer.close(i);
							$('.btn').blur();
							var snmp_text1 = $('#snmp_div1').find('span').text();
							var snmp_text2 = $('#snmp_div2').find('span').text();
							var snmp_id1 = $('#snmp_div1').data('value');
							var snmp_id2 = $('#snmp_div2').data('value');
							$("div[data-id=xSelect-snmp_div1]").remove();
							$("div[data-id=xSelect-snmp_div2]").remove();
							bind_snmp_select();
							if (flag == 1) {
								if ($("#snmp_div1").data('value') == "-1" || $("#snmp_div1").data('value') == undefined) {
									snmp_id1 = data.SnmpConfigId;
								}
							} else {
								if ($("#snmp_div2").data('value') == "-1" || $("#snmp_div2").data('value') == undefined) {
									snmp_id2 = data.SnmpConfigId;
								}
							}
							$(".xSelect-snmp_div1").find('span[data-value=' + snmp_id1 + ']').click();
							$(".xSelect-snmp_div2").find('span[data-value=' + snmp_id2 + ']').click();
							/*
							if (flag == 1){
								if ($("#snmp_div1").data('value') == "-1" || $("#snmp_div1").data('value') == undefined){
									//$("#snmp_div1").data('value',data.SnmpConfigId);
									//$("#snmp_div1").find('span').text(snmp.SnmpConfigName);
									$(".xSelect-snmp_div1").find('span[data-value='+data.SnmpConfigId+']').click();
								}else{
									//$('#snmp_div1').find('span').text(snmp_text1);
									$(".xSelect-snmp_div1").find('span[data-value='+snmp_id1+']').click();
								}
								if (snmp_id2 != undefined && snmp_id2 != '-1'){
									//$("#snmp_div2").data('value',snmp_id2);
									//$("#snmp_div2").find('span').text(snmp_text2);
									$(".xSelect-snmp_div2").find('span[data-value='+snmp_id2+']').click();
								}
							}else{
								if ($("#snmp_div2").data('value') == "-1" || $("#snmp_div2").data('value') == undefined){
									//$("#snmp_div2").data('value',data.SnmpConfigId);
									//$("#snmp_div2").find('span').text(snmp.SnmpConfigName);
									$(".xSelect-snmp_div2").find('span[data-value='+data.SnmpConfigId+']').click();
								}else{
									//$('#snmp_div2').find('span').text(snmp_text2);
									$(".xSelect-snmp_div2").find('span[data-value='+snmp_id2+']').click();
								}
								if (snmp_id1 != undefined && snmp_id1 != '-1'){
									//$("#snmp_div1").data('value',snmp_id1);
									//$("#snmp_div1").find('span').text(snmp_text1);
									$(".xSelect-snmp_div1").find('span[data-value='+snmp_id1+']').click();
								}
							}
							*/
							d.close().remove();
						},
						btn2: function (i) {
							parent.layer.close(i);
						}
					});
				} else {
					_alert(1, "SNMP", "执行失败：" + data.ErrMsg);
				}
			}
		});
	}

	//SYSLOG
	var xsel_syslog_id1_pre = [-1];
	var xsel_syslog_id2_pre = [-1];
	function bind_syslog_select() {
		var syslog_array1 = [0];
		var syslog_array2 = [0];
		xsel_syslog_id1_pre[0] = -1;
		xsel_syslog_id2_pre[0] = -1;
		var syslog_data;
		$.ajax({
			url: '/bhost/select_syslog_all',
			type: 'post',
			async: false,
			data: { a0: se, z1: -1 },
			success: function (result) {
				syslog_data = JSON.parse(result);
			}
		});
		var syslog_array = [];
		syslog_array.push({ 'value': -1, 'name': '全局指定', 'type': null });
		$.each(syslog_data.data, function (i, item) {
			if (manage_auth_array.indexOf(24) != -1) {
				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'edit'
				};
			} else {
				var select_data_json = {
					'value': 1,
					'name': 'admin2',
					'type': 'check'
				};
			}
			/*
			if (manage_auth_array.indexOf(24) != -1){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':'edit'
				};
			}else if (access_auth_array.indexOf(24) != -1){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':'check'
				};
			}else{
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':null
				};
			}
			*/
			select_data_json.value = item.SyslogConfigId;
			select_data_json.name = item.SyslogConfigName;
			syslog_array.push(select_data_json);
			syslog_array1.push(item.SyslogConfigId);
			syslog_array2.push(item.SyslogConfigId);
		});
		$(".xSelect-syslog_div1").remove();
		$("#syslog_div1").empty().data("xSelect", "");

		if (manage_auth_array.indexOf(24) != -1) {
			$("#syslog_div1").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: syslog_array,
				module_type: "syslog_div1",
				edit: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode6(obj, 1, 1);
				},
				btn: [
					{
						'name': '新增',
						'event': function (items, obj) {
							$(obj).parents('.xSelect-view').hide();
							_editNode6(obj, 2, 1);
						}
					}
				],
				setval: function (item, obj) {
					var xsel_id1 = $(obj).find('span').data('value');
					change_mail_option(1, syslog_array, $(".xSelect-syslog_div2"), syslog_array2, xsel_id1, xsel_syslog_id1_pre);
				}
			});
		} else {
			$("#syslog_div1").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: syslog_array,
				module_type: "syslog_div1",
				check: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode6(obj, 1, 1);
				},
				setval: function (item, obj) {
					var xsel_id1 = $(obj).find('span').data('value');
					change_mail_option(1, syslog_array, $(".xSelect-syslog_div2"), syslog_array2, xsel_id1, xsel_syslog_id1_pre);
				}
			});
		}

		$("#syslog_div1").data('value', -1);
		$(".xSelect-syslog_div2").remove();
		$("#syslog_div2").empty().data("xSelect", "");

		if (manage_auth_array.indexOf(24) != -1) {
			$("#syslog_div2").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: syslog_array,
				module_type: "syslog_div2",
				edit: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode6(obj, 1, 2);
				},
				btn: [
					{
						'name': '新增',
						'event': function (items, obj) {
							$(obj).parents('.xSelect-view').hide();
							_editNode6(obj, 2, 2);
						}
					}
				],
				setval: function (item, obj) {
					var xsel_id2 = $(obj).find('span').data('value');
					change_mail_option(2, syslog_array, $(".xSelect-syslog_div1"), syslog_array1, xsel_id2, xsel_syslog_id2_pre);
				}
			});
		} else {
			$("#syslog_div2").xSelect({
				width: 162,
				defaultText: '全局指定',
				items: syslog_array,
				module_type: "syslog_div2",
				check: function (item, obj) {
					$(obj).parents('.xSelect-view').hide();
					_editNode6(obj, 1, 2);
				},
				setval: function (item, obj) {
					var xsel_id2 = $(obj).find('span').data('value');
					change_mail_option(2, syslog_array, $(".xSelect-syslog_div1"), syslog_array1, xsel_id2, xsel_syslog_id2_pre);
				}
			});
		}

		$("#syslog_div2").data('value', -1);
	}

	function clear_syslog() {
		$("#syslog_suspend").find('input').val('');
		$("#SyslogConfigName").attr('disabled', false);
		$("#syslog_suspend").find('i.v-check').attr('class', 'v-check');
		$("#EnCode_syslog").val(0).trigger('change');
		$("#Flag_syslog").val(2).trigger('change');
		xsel_syslog_id1_pre[0] = -1;
		xsel_syslog_id2_pre[0] = -1;
	}

	var syslog_result;
	function _editNode6(obj, type, flag) {
		clear_syslog();
		var title;
		if (type == 1) {
			//approveId = $(obj).parent().children('a').attr('id');
			syslogId = $(obj).children('span').data('value');
			$.ajax({
				url: "/bhost/select_syslog_all",
				type: "POST",
				async: false,
				data: { a0: se, z1: syslogId },
				success: function (result) {
					syslog_result = JSON.parse(result);
					syslog_result = syslog_result.data[0];
					title = "SYSLOG";
				}
			});
		} else {
			syslogId = 0;
			title = "SYSLOG";
		}

		var $dialogCont = $("#syslog_suspend").show();

		var d = dialog({
			title: title,
			content: $dialogCont,
			id: "syslog_suspend",
			width: "800px"
		});
		d.addEventListener('close', function () {
			$dialogCont.appendTo("body").hide();
		});
		d.showModal();
		syslog_main(type);
		$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
			clear_syslog();
			syslog_main(type);
			//d.close().remove();
		});

		$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
			syslog_save(d, flag);
		});
	}

	var syslog = {
		"SyslogConfigId": 0,
		"SyslogConfigName": "SYSLOG配置1",
		"SyslogServerIP": "192.168.0.54",
		"SyslogPort": 514,
		"Flag": 0,
		"EnCode": 0
	}

	function syslog_main(type) {
		if (manage_auth_array.indexOf(24) === -1) {
			$("#syslog_suspend").find(".btn-submit").remove();
		}
		$("#SyslogPort").bind('keydown', function (e) {
			DigitInput(e);
		});
		if (type == 1) {
			syslog.SyslogConfigId = syslog_result.SyslogConfigId;
			$("#SyslogConfigName").val(syslog_result.SyslogConfigName);
			$("#SyslogConfigName").prop("disabled", true);
			$("#SyslogServerIP").val(syslog_result.SyslogServerIP);
			$("#SyslogPort").val(syslog_result.SyslogPort);
			$("#Flag_syslog").val(syslog_result.Flag).trigger('change');
			$("#EnCode_syslog").val(syslog_result.EnCode).trigger('change');
			if (syslog_result.Flag == 2) {
				$.ajax({
					url: '/bhost/get_syslog_flag',
					type: 'post',
					async: false,
					data: { a0: se },
					success: function (result) {
						var syslog_flag = JSON.parse(result);
						if (syslog_flag.Result) {
							if (syslog_flag.count_syslog == 2) {
								$("#Flag_syslog").attr('disabled', true);
							}
						}
					}
				})
			}
		} else {
			syslog.SyslogConfigId = 0;
			$.ajax({
				url: '/bhost/get_syslog_flag',
				type: 'post',
				async: false,
				data: { a0: se },
				success: function (result) {
					var syslog_flag = JSON.parse(result);
					if (syslog_flag.Result) {
						if (syslog_flag.count_syslog == 1) {
							$("#Flag_syslog").val(2).trigger('change');
							$("#Flag_syslog").attr('disabled', true);
						} else if (syslog_flag.def_syslog == 0) {
							$("#Flag_syslog").val(2).trigger('change');
						} else if (syslog_flag.spare_syslog == 0) {
							$("#Flag_syslog").val(1).trigger('change');
						} else {
							$("#Flag_syslog").val(0).trigger('change');
						}
					}
				}
			})
		}
	}

	function syslog_save(d, flag) {
		var numCheck = /\D/;
		var syslog_list = [];
		var SyslogConfigName = $("#SyslogConfigName").val();
		var SyslogServerIP = $("#SyslogServerIP").val();
		var SyslogPort = $("#SyslogPort").val();
		var EnCode = $("#EnCode_syslog").val();
		var Flag = $("#Flag_syslog").val();
		if (SyslogConfigName == "") {
			_alert(2, "SYSLOG", "请输入名称", $("#SyslogConfigName"));
			return false;
		} else {
			if (!nameCheck.test(SyslogConfigName)) {
				_alert(1, "SYSLOG", "名称格式不正确", $("#SyslogConfigName"));
				return false;
			}
		}

		if (SyslogServerIP == "") {
			_alert(2, "SYSLOG", "请输入服务器地址", $("#SyslogServerIP"));
			return false;
		} else {
			if (!ipcheck_route.test(SyslogServerIP)) {
				_alert(2, "SYSLOG", "服务器地址不正确", $("#SyslogServerIP"));
				return false;
			}
		}
		if (SyslogPort == "") {
			_alert(2, "SYSLOG", "请输入端口", $("#SyslogPort"));
			return false
		} else {
			if (numCheck.test(parseInt(SyslogPort))) {
				_alert(1, "SYSLOG", "端口不正确", $("#SyslogPort"));
				return false;
			}
			if (parseInt(parseInt(SyslogPort)) < 1) {
				_alert(1, "SYSLOG", "端口不能小于1", $("#SyslogPort"));
				return false;
			}
			if (parseInt(parseInt(SyslogPort)) > 65534) {
				_alert(1, "SYSLOG", "端口不能大于65534", $("#SyslogPort"));
				return false;
			}
		}
		syslog.SyslogConfigName = SyslogConfigName;
		syslog.SyslogServerIP = SyslogServerIP;
		syslog.SyslogPort = parseInt(SyslogPort);
		syslog.EnCode = parseInt(EnCode);
		syslog.Flag = parseInt(Flag);
		syslog_list.push(JSON.stringify(syslog));
		var msstr = aceg(JSON.stringify(syslog_list),se);
		$.ajax({
			url: '/bhost/save_syslog',
			type: 'post',
			async: false,
			data: { a0: se, z1: JSON.stringify(syslog_list),m1:msstr },
			success: function (result) {
				data = JSON.parse(result);
				if (data.Result == true) {
					parent.layer.open({
						type: 1,
						title: "SYSLOG",
						content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						btn1: function (i) {
							parent.layer.close(i);
							$('.btn').blur();
							var syslog_text1 = $('#syslog_div1').find('span').text();
							var syslog_text2 = $('#syslog_div2').find('span').text();
							var syslog_id1 = $('#syslog_div1').data('value');
							var syslog_id2 = $('#syslog_div2').data('value');
							$("div[data-id=xSelect-syslog_div1]").remove();
							$("div[data-id=xSelect-syslog_div2]").remove();
							bind_syslog_select();
							if (flag == 1) {
								if ($("#syslog_div1").data('value') == "-1" || $("#syslog_div1").data('value') == undefined) {
									syslog_id1 = data.SyslogConfigId;
								}
							} else {
								if ($("#syslog_div2").data('value') == "-1" || $("#syslog_div2").data('value') == undefined) {
									syslog_id2 = data.SyslogConfigId;
								}
							}
							$(".xSelect-syslog_div1").find('span[data-value=' + syslog_id1 + ']').click();
							$(".xSelect-syslog_div2").find('span[data-value=' + syslog_id2 + ']').click();
							/*
							if (flag == 1){
								if ($("#syslog_div1").data('value') == "-1" || $("#syslog_div1").data('value') == undefined){
									//$("#syslog_div1").data('value',data.SyslogConfigId);
									//$("#syslog_div1").find('span').text(syslog.SyslogConfigName);
									$(".xSelect-syslog_div1").find('span[data-value='+data.SyslogConfigId+']').click();
								}else{
									//$('#syslog_div1').find('span').text(syslog_text1);
									$(".xSelect-syslog_div1").find('span[data-value='+syslog_id1+']').click();
								}
								if (syslog_id2 != undefined && syslog_id2 != '-1'){
									//$("#syslog_div2").data('value',syslog_id2);
									//$("#syslog_div2").find('span').text(syslog_text2);
									$(".xSelect-syslog_div2").find('span[data-value='+syslog_id2+']').click();
								}
							}else{
								if ($("#syslog_div2").data('value') == "-1" || $("#syslog_div2").data('value') == undefined){
									//$("#syslog_div2").data('value',data.SyslogConfigId);
									//$("#syslog_div2").find('span').text(syslog.SyslogConfigName);
									$(".xSelect-syslog_div2").find('span[data-value='+data.SyslogConfigId+']').click();
								}else{
									//$('#syslog_div2').find('span').text(syslog_text2);
									$(".xSelect-syslog_div2").find('span[data-value='+syslog_id2+']').click();
								}
								if (syslog_id1 != undefined && syslog_id1 != '-1'){
									//$("#syslog_div1").data('value',syslog_id1);
									//$("#syslog_div1").find('span').text(syslog_text1);
									$(".xSelect-syslog_div1").find('span[data-value='+syslog_id1+']').click();
								}
							}
							*/
							d.close().remove();
						},
						btn2: function (i) {
							parent.layer.close(i);
						}
					});
				} else {
					_alert(1, "SYSLOG", "执行失败：" + data.ErrMsg);
				}
			}
		});
	}

	//事件告警main
	function eventinfomain(type) {
		$("#AlarmReceiver").on("ifChecked", function (e) {
			$("#AlarmReceiver_text").show();
			$("#AlarmReceiver_input").find('input').focus();
		});
		$("#AlarmReceiver").on("ifUnchecked", function (e) {
			$("#AlarmReceiver_text").hide();
			$("#AlarmReceiver_input").find('input').blur();
		});
		$("#AlarmReceiver1").on("ifChecked", function (e) {
			$("#AlarmReceiver_text1").show();
			$("#AlarmReceiver_input1").find('input').focus();
		});
		$("#AlarmReceiver1").on("ifUnchecked", function (e) {
			$("#AlarmReceiver_text1").hide();
			$("#AlarmReceiver_input1").find('input').blur();
		});
		$("#AlarmAction").change(function () {
			var AlarmAction_i = $(this).children("option:selected").val();
			if (AlarmAction_i == 1) {//邮件
				$("#label_list").show();
				if ($("#label_list").children('div.item').length == 1) {
					$("#admin_check").show();
				}
				$('#AlarmReceiver_div').show();
				$("#label_list1").hide();
				$('#AlarmReceiver_div1').hide();
				$('#AlarmReceiver_span').show();
				phone_or_emailcheck = emailcheck;
				phone_or_email = '邮件地址';
			} else if (AlarmAction_i == 2 || AlarmAction_i == 3) {//2：短信猫，3：短信网关
				$("#label_list1").show();
				if ($("#label_list1").children('div.item').length == 1) {
					$("#admin_check1").show();
				}
				$('#AlarmReceiver_div1').show();
				$("#label_list").hide();
				$('#AlarmReceiver_div').hide();
				$('#AlarmReceiver_span').show();
				phone_or_emailcheck = phonecheck;
				phone_or_email = '手机号码';
			} else {
				$("#label_list1").hide();
				$('#AlarmReceiver_div1').hide();
				$("#label_list").hide();
				$('#AlarmReceiver_div').hide();
				$('#AlarmReceiver_span').hide();
			}
			if (AlarmAction_i == 0) {
				$("#Description_imp").hide();
				$("#mail1_div").hide();
				$("#mail2_div").hide();
				$("#smsm1_div").hide();
				$("#smsm2_div").hide();
				$("#smssvr1_div").hide();
				$("#smssvr2_div").hide();
				$("#snmp1_div").hide();
				$("#snmp2_div").hide();
				$("#syslog1_div").hide();
				$("#syslog2_div").hide();
			} else {
				$("#Description_imp").show();
			}
			if (AlarmAction_i == 1) {
				$("#mail1_div").show();
				$("#mail2_div").show();
				$("#smsm1_div").hide();
				$("#smsm2_div").hide();
				$("#smssvr1_div").hide();
				$("#smssvr2_div").hide();
				$("#snmp1_div").hide();
				$("#snmp2_div").hide();
				$("#syslog1_div").hide();
				$("#syslog2_div").hide();
			} else if (AlarmAction_i == 2) {
				$("#mail1_div").hide();
				$("#mail2_div").hide();
				$("#smsm1_div").show();
				$("#smsm2_div").show();
				$("#smssvr1_div").hide();
				$("#smssvr2_div").hide();
				$("#snmp1_div").hide();
				$("#snmp2_div").hide();
				$("#syslog1_div").hide();
				$("#syslog2_div").hide();
			} else if (AlarmAction_i == 3) {
				$("#mail1_div").hide();
				$("#mail2_div").hide();
				$("#smsm1_div").hide();
				$("#smsm2_div").hide();
				$("#smssvr1_div").show();
				$("#smssvr2_div").show();
				$("#snmp1_div").hide();
				$("#snmp2_div").hide();
				$("#syslog1_div").hide();
				$("#syslog2_div").hide();
			} else if (AlarmAction_i == 4) {
				$("#mail1_div").hide();
				$("#mail2_div").hide();
				$("#smsm1_div").hide();
				$("#smsm2_div").hide();
				$("#smssvr1_div").hide();
				$("#smssvr2_div").hide();
				$("#snmp1_div").show();
				$("#snmp2_div").show();
				$("#syslog1_div").hide();
				$("#syslog2_div").hide();
			} else if (AlarmAction_i == 5) {
				$("#mail1_div").hide();
				$("#mail2_div").hide();
				$("#smsm1_div").hide();
				$("#smsm2_div").hide();
				$("#smssvr1_div").hide();
				$("#smssvr2_div").hide();
				$("#snmp1_div").hide();
				$("#snmp2_div").hide();
				$("#syslog1_div").show();
				$("#syslog2_div").show();
			}
		});
		$('#admin_select').on('change', function () {
			if ($('#admin_select').find('option').length == 2 && $('#admin_select option:selected').val() != '0') {
				_addadmin($('#admin_select').siblings('i'));
				$('#admin_check').hide();
			} else if ($('#admin_select').find('option').length == 1) {
				$('#admin_check').hide();
			} else {
				$('#admin_check').show();
			}
		});
		$('#admin_select1').on('change', function () {
			if ($('#admin_select1').find('option').length == 2 && $('#admin_select1 option:selected').val() != '0') {
				_addadmin($('#admin_select1').siblings('i'));
				$('#admin_check1').hide();
			} else if ($('#admin_select1').find('option').length == 1) {
				$('#admin_check1').hide();
			} else {
				$('#admin_check1').show();
			}
		});
		//用户列表
		$.ajax({
			url: "/bhost/get_user_list",
			type: "POST",
			async: false,
			data: { a0: se, userid: null },
			success: function (result) {
				var userinfo_result = JSON.parse(result);
				if (userinfo_result.Result == true) {
					var userinfo_data = userinfo_result.info;
					$("#admin_select").append('<option value="0" selected>请选择</option>');
					$("#admin_select1").append('<option value="0" selected>请选择</option>');
					$.each(userinfo_data, function (i, item) {
						if (item.Email != "" && item.Email != null) {
							$("#admin_select").append("<option value=\"" + item.UserId + "\" index=\"0\">" + item.UserCode + "</option>");
							all_option_str_1[item.UserId] = "<option value=\"" + item.UserId + "\" index=\"0\">" + item.UserCode + "</option>";
						}
						if (item.MobilePhone != "" && item.MobilePhone != null) {
							$("#admin_select1").append("<option value=\"" + item.UserId + "\" index=\"0\">" + item.UserCode + "</option>");
							all_option_str_2[item.UserId] = "<option value=\"" + item.UserId + "\" index=\"0\">" + item.UserCode + "</option>";
						}
					});
				} else {
					_alert(1, '事件告警信息', "执行失败：" + userinfo_result.ErrMsg);
					return false;
				}
			}
		});

		bind_mail_select();

		//bind_smsm_select();

		bind_smssvr_select();

		bind_snmp_select();

		bind_syslog_select();
		//编辑页面
		//var tasktype = document.frm_eventinfo_add.tasktype.value;
		//if (tasktype == "2") {
		if (type == 1) {
			$("#d_n").val(eventinfo_data.Name);
			$("#d_n").attr("disabled", true);
			$("#Description").val(eventinfo_data.EventDescription);
			$("#EventLevel").val(eventinfo_data.EventLevel).trigger("change");
			$("#EventType").val(eventinfo_data.EventType).trigger("change");
			$("#AlarmAction").val(eventinfo_data.AlarmAction).trigger("change");
			var $select_div1;
			var $select_div2;
			if (eventinfo_data.AlarmAction == 1) {
				$select_div1 = $('.xSelect-mail_div1');
				$select_div2 = $('.xSelect-mail_div2');
			} else if (eventinfo_data.AlarmAction == 2) {
				$select_div1 = $('.xSelect-smsm_div1');
				$select_div2 = $('.xSelect-smsm_div2');
			} else if (eventinfo_data.AlarmAction == 3) {
				$select_div1 = $('.xSelect-smssvr_div1');
				$select_div2 = $('.xSelect-smssvr_div2');
			} else if (eventinfo_data.AlarmAction == 4) {
				$select_div1 = $('.xSelect-snmp_div1');
				$select_div2 = $('.xSelect-snmp_div2');
			} else if (eventinfo_data.AlarmAction == 5) {
				$select_div1 = $('.xSelect-syslog_div1');
				$select_div2 = $('.xSelect-syslog_div2');
			}
			if (eventinfo_data.MasterConfig != null) {
				$select_div1.find('span[data-value=' + eventinfo_data.MasterConfig + ']').click();
			}
			if (eventinfo_data.StandByConfig != null) {
				$select_div2.find('span[data-value=' + eventinfo_data.StandByConfig + ']').click();
			}
			if (eventinfo_data.AlarmAction == 1) {
				var it = '';
			} else if (eventinfo_data.AlarmAction == 2 || eventinfo_data.AlarmAction == 3) {
				var it = '1';
			}
			if (eventinfo_data.AlarmReceiver != null) {
				$("#AlarmReceiver_check" + it).iCheck('check');
				var AlarmReceiver = eventinfo_data.AlarmReceiver.split(';');
				for (var i = 0; i < AlarmReceiver.length - 1; i++) {
					var $c = $('<div id="" name="" class="item" style="padding-top: 0px;width: 260px;" value>');
					$c.html('<input type="text" class="form-text" style="width: 193px;" value="' + AlarmReceiver[i] + '" >'
						+ '<i class="ctrl del" onclick="_delphone_or_email(this)"  style="margin-top: 0px;margin-left: 4px;"></i>');
					$('#AlarmReceiver_input' + it).after($c);
				}
				$('#AlarmReceiver_input' + it).find('input').val(AlarmReceiver[i]);
			}
			if (eventinfo_data.UserSet != null) {
				for (var i = 0; i < eventinfo_data.UserSet.length - 1; i++) {
					var item = eventinfo_data.UserSet[i];
					if (eventinfo_data.AlarmAction == 1) {
						if (all_option_str_1[item.UserId] == undefined) {
							continue;
						}
						check_option_str_1[item.UserId] = all_option_str_1[item.UserId];
						all_option_str_1[item.UserId] = null;
					} else if (eventinfo_data.AlarmAction == 2 || eventinfo_data.AlarmAction == 3) {
						if (all_option_str_2[item.UserId] == undefined) {
							continue;
						}
						check_option_str_2[item.UserId] = all_option_str_2[item.UserId];
						all_option_str_2[item.UserId] = null;
					}
					var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + item.UserId + '"/>');
					$c.html('<input class="form-text form-text2" type="text" style="width: 128px;" value="' + item.UserCode + '" disabled="true"><i style="margin-left: 4px;" class="ctrl del" onclick="_deladmin(this)"></i>');
					$("#admin_select" + it).parent().after($c);
					$("#admin_select" + it).find('option[value=' + item.UserId + ']').remove();
					$("#admin_select" + it).trigger('change');
				}
				if (it == '1' && all_option_str_2[eventinfo_data.UserSet[i].UserId] != undefined) {
					$("#admin_select" + it).val(eventinfo_data.UserSet[i].UserId).trigger('change');
				}
				if (it != '1' && all_option_str_1[eventinfo_data.UserSet[i].UserId] != undefined) {
					$("#admin_select" + it).val(eventinfo_data.UserSet[i].UserId).trigger('change');
				}
			}
		}
		$("#admin_select").select2();
		$("#admin_select1").select2();
	}
	//创建
	function eventinfo_add(d) {
		var val = $("#d_n").val();
		var $i = $("#d_n").next('i.v-check');
		var pass = 1;
		//事件告警信息名
		if (val == "") {
			_alert(1, "事件告警信息", '名称不能为空', $("#d_n"));
			//$("#d_n").val("");
			return false;
		}
		if (!nameReg.test(val)) {
			_alert(1, "事件告警信息", '名称格式不正确', $("#d_n"));
			//$("#d_n").val("");
			return false;
		}
		//事件描述
		var AlarmAction_i = $("#AlarmAction").children("option:selected").val();
		var Description = $("#Description").val().trim();
		if (Description == "" && AlarmAction_i != "0") {
			_alert(1, "事件告警信息", '事件描述不能为空', $("#Description"));
			return false;
		}
		if (AlarmAction_i == "1") {
			var it = '';
		} else {
			var it = '1';
		}

		//主备
		if (AlarmAction_i == "1") {
			var $select_div1 = $("#mail_div1");
			var $select_div2 = $("#mail_div2");
		} else if (AlarmAction_i == "2") {
			var $select_div1 = $("#smsm_div1");
			var $select_div2 = $("#smsm_div2");
		} else if (AlarmAction_i == "3") {
			var $select_div1 = $("#smssvr_div1");
			var $select_div2 = $("#smssvr_div2");
		} else if (AlarmAction_i == "4") {
			var $select_div1 = $("#snmp_div1");
			var $select_div2 = $("#snmp_div2");
		} else if (AlarmAction_i == "5") {
			var $select_div1 = $("#syslog_div1");
			var $select_div2 = $("#syslog_div2");
		}
		if (AlarmAction_i != "0") {
			var sel_div1 = $select_div1.data('value');
			var sel_div2 = $select_div2.data('value');
			if (sel_div1 != "-1" && sel_div1 != undefined) {
				eventinfo.MasterConfig = sel_div1;
				eventinfo.MasterConfigName = $select_div1.find('span').text();
			} else {
				eventinfo.MasterConfig = 0;
				eventinfo.MasterConfigName = "全局策略";
			}
			if (sel_div2 != "-1" && sel_div2 != undefined) {
				eventinfo.StandByConfig = sel_div2;
				eventinfo.MasterConfigName = $select_div2.find('span').text();
			} else {
				eventinfo.StandByConfig = 0;
				eventinfo.MasterConfigName = "全局策略";
			}
		}


		//信息接受者
		if (AlarmAction_i == "1" || AlarmAction_i == "2" || AlarmAction_i == "3") {
			if ($('#label_list' + it).find('div[value]').length == 0 && !$('#AlarmReceiver_check' + it).is(':checked') && $('#admin_select' + it).val() == '0') {
				_alert(2, "事件告警信息", "请选择信息接受者");
				return false;
			}
			//手动输入
			if ($("#AlarmReceiver_check" + it).is(':checked')) {
				if ($('#AlarmReceiver_text' + it).find('div[value]').length == 0 && $('#AlarmReceiver_input' + it).find('input').val().trim() == '') {
					_alert(2, "事件告警信息", "请手动输入信息", $("#AlarmReceiver_input" + it));
					return false;
				}
				var $all = $('#AlarmReceiver_text' + it).find('div[value]');
				var len = $all.length;
				var AlarmReceiver_text = "";

				var a_len = $("#AlarmReceiver_text" + it).children('div').length;
				$("#AlarmReceiver_text" + it).children("div").each(function (i, item) {
					var input_v = $(item).find('input').val();
					if (i == 0 && a_len != 1 && input_v == "") {
						return true;
					}

					if (input_v == '') {
						pass = 0;
						_alert(2, '事件告警信息', '请输入' + phone_or_email, $(item).find('input'));
						return false;
					} else if (!phone_or_emailcheck.test(input_v)) {
						pass = 0;
						_alert(1, '事件告警信息', phone_or_email + '格式不正确', $(item).find('input'));
						return false;
					} else {
						var AlarmAction = $('#AlarmAction').val();
						if (AlarmAction == '1') {
							var it = '';
						} else {
							var it = '1';
						}
						$("#AlarmReceiver_text" + it).children("div").not($(item)).each(function (i1, item1) {
							if (i1 < i) {
								return true;
							}
							var input_v1 = $(item1).find('input').val();
							if (input_v1 == '') {
								pass = 0;
								_alert(2, '事件告警信息', '请输入' + phone_or_email, $(item1).find('input'));
								return false;
							} else if (!phone_or_emailcheck.test(input_v1)) {
								pass = 0;
								_alert(1, '事件告警信息', phone_or_email + '格式不正确', $(item1).find('input'));
								return false;
							}
							if (input_v1 == input_v) {
								pass = 0;
								_alert(1, '事件告警信息', '相同的' + phone_or_email + '已存在', $(item).find('input'));
								return false;
							}
						});
						if (pass == 0) {
							return false;
						}
					}
				});
				if (pass == 0) {
					return false;
				}

				for (var j = len - 1; j >= 0; j--) {
					var input_txt = $all.eq(j).find('input').val();
					AlarmReceiver_text = AlarmReceiver_text + input_txt + ';';
				}
				var AlarmReceiver_input = $('#AlarmReceiver_input' + it).find('input').val().trim();
				if (AlarmAction_i == "1" && AlarmReceiver_input != "") {
					if (emailcheck.test(AlarmReceiver_input)) {
						AlarmReceiver_text = AlarmReceiver_text + AlarmReceiver_input + ';';
					} else {
						_alert(1, "事件告警信息", "邮箱格式不正确", $("#AlarmReceiver_input" + it).find('input'));
						return false;
					}
				} else if ((AlarmAction_i == "2" || AlarmAction_i == "3") && AlarmReceiver_input != "") {
					if (phonecheck.test(AlarmReceiver_input)) {
						AlarmReceiver_text = AlarmReceiver_text + AlarmReceiver_input + ';';
					} else {
						_alert(1, "事件告警信息", "手机号码格式不正确", $("#AlarmReceiver_input" + it).find('input'));
						return false;
					}
				}
				AlarmReceiver_text = AlarmReceiver_text.substr(0, AlarmReceiver_text.length - 1);
				var AlarmReceiver = AlarmReceiver_text;

			}
		} else {
			var AlarmReceiver = null;
		}
		eventinfo.EventAlarmInfoId = eventinfoId;
		eventinfo.Name = val;
		eventinfo.EventLevel = parseInt($("#EventLevel").children("option:selected").val());
		eventinfo.EventType = parseInt($("#EventType").children("option:selected").val());
		if (Description == "") {
			Description = null;
		}
		eventinfo.EventDescription = Description;
		eventinfo.AlarmAction = parseInt(AlarmAction_i);
		eventinfo.AlarmReceiver = AlarmReceiver;
		eventinfo.UserSet = new Array();
		if (AlarmAction_i == "1") {
			var it = '';
		} else if (AlarmAction_i == "2" || AlarmAction_i == "3") {
			var it = '1';
		}
		var $all = $("#label_list" + it).find('div[value]');
		var len = $all.length;
		if (AlarmAction_i == "1" || AlarmAction_i == "2" || AlarmAction_i == "3") {
			for (var j = len - 1; j >= 0; j--) {
				var t_i = $all.eq(j).attr('value');
				if (t_i != '0') {
					var json_a = '{"UserId":' + t_i + '}';
					eventinfo.UserSet.push(JSON.parse(json_a));
				}
			}
		}
		var val = $('#admin_select' + it).val();
		if (val != '0') {
			var json_a = '{"UserId":' + val + '}';
			eventinfo.UserSet.push(JSON.parse(json_a));
		}
		var msstr = aceg(JSON.stringify(eventinfo),se);
		$.ajax({
			url: '/bhost/add_eventinfo',
			type: "POST",
			async: false,
			data: { a0: se, a1: JSON.stringify(eventinfo),m1:msstr },
			success: function (result) {
				var result = JSON.parse(result);
				if (result.Result == true) {
					$('.btn').blur(); parent.layer.open({
						type: 1,
						title: '事件告警信息',
						content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						yes: function (i) {
							$('.btn').blur(); parent.layer.close(i);
							var alarm_text = $('#EventAlarmInfoId').find('span').text();
							$("div[data-id=xSelect-alarm]").remove();
							$('#EventAlarmInfoId').empty().data('xSelect', '');
							bind_alarm_xSelect();
							if ($("#EventAlarmInfoId").data('value') == "-1" || $("#EventAlarmInfoId").data('value') == undefined) {
								$("#EventAlarmInfoId").data('value', result.EventAlarmInfoId);
								$("#EventAlarmInfoId").find('span').text(eventinfo.Name);
							} else {
								$('#EventAlarmInfoId').find('span').text(alarm_text);
							}
							d.close().remove();
						}
					});
				} else {
					_alert(1, "事件告警信息", "执行失败：" + result.ErrMsg, $("#d_n"));
					return false;
				}
			}
		});
	}


	function clear_approve() {
		check_value = 'false false';
		all_option_str = [];
		check_option_str = [];
		$("#ApproveStrategyName").val("").attr("disabled", false);
		$("#ApproveNum").val("");
		$("#admin_select_a").empty();
		$("#admin_check_a").show();
		$("#label_list_a").children('div').not('div:first').remove();
		$("#ApproveStrategyName").next('.v-check').attr('class', 'v-check');
		$("#admin_num").text(0);
		$("#checkbox").find('input[type=checkbox]').iCheck('destroy');
		$("#checkbox").find('input[type=checkbox]').iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		});
		$("#checkbox").unbind();
		$("#checkbox").find('input[type=checkbox]').unbind();
		$("#checkbox").find('input[type=checkbox]').iCheck('uncheck');
		$("#ApproveNum").attr('edited', 0);
	}


	//审批
	var approve_data;
	function _editNode1(obj, type) {
		clear_approve();
		var title;
		if (type == 1) {
			//approveId = $(obj).parent().children('a').attr('id');
			approveId = $(obj).children('span').data('value');
			$.ajax({
				url: "/bhost/get_approve_list",
				type: "POST",
				async: false,
				data: { a0: se, a1: approveId },
				success: function (result) {
					var approve_result = JSON.parse(result);
					if (approve_result.Result == true) {
						approve_data = approve_result.info.data[0];
						title = "审批策略";
					}
				}
			});
		} else {
			//approve_edit = null;
			approveId = 0;
			title = "审批策略";
		}

		var $dialogCont = $("#EnableApprove_suspend").show();

		var d = dialog({
			title: title,
			content: $dialogCont,
			id: "EnableApprove_suspend",
			width: "800px"
		});
		d.addEventListener('close', function () {
			$dialogCont.appendTo("body").hide();
		});
		d.showModal();

		if (manage_auth_array.indexOf(15) === -1 && manage_auth_array.indexOf(16) === -1 && manage_auth_array.indexOf(17) === -1 && manage_auth_array.indexOf(32) === -1) {
			$("#EnableApprove_suspend").find('.btn-submit').remove();
		}

		approvemain(type);
		$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
			clear_approve();
			approvemain(type);
			//d.close().remove();
		});

		$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
			save_data(d);
		});

	}


	var all_option_str = [];
	var all_option_str_copy = [];
	var check_option_str = [];
	var no_email_option_str = [];
	var no_phone_option_str = [];
	var approve_item = {
		"ApproveStrategyId": 0,
		"ApproveStrategyName": "",
		"ApproveNum": 0,
		"ApproveType": 0,
		"UserSet": []
	}

	//删除接收人
	function _deladmin_a(obj) {
		var $c = $(obj).parent();
		var m_i = $(obj).parent().attr('value');
		all_option_str[parseInt(m_i)] = check_option_str[parseInt(m_i)];
		check_option_str[parseInt(m_i)] = null;
		for (var i = (parseInt(m_i) + 1); i < all_option_str.length; i++) {
			if (all_option_str[i] != null) {
				if ($('#admin_select_a option[value=' + i + ']').length != 0) {
					$('#admin_select_a option[value=' + i + ']').before(all_option_str[m_i]);
					break;
				}
			}
		}
		if (i == all_option_str.length) {
			$('#admin_select_a').append(all_option_str[m_i]);
		}

		$c.fadeOut(function () {
			$c.remove();
			edit_admin_num();
			$('#admin_select_a').trigger('change');
		});

	}

	function update_xSelect($obj) {
		var id_value = $obj.data('value');
		var text_value = $('.xSelect-show-text', $obj).text();
		var id = $('.xSelect-show', $obj).data('id');
		$obj.empty().data('xSelect', '');
		$('.' + id).remove();
		if (id_value == undefined || id_value == 0) {
			id_value = 0;
			text_value = '全局指定'
		}
		switch ($obj.attr('class').split(' ')[1]) {
			case 'xSelect_phone_m':
				$.ajax({
					url: "/bhost/get_smssvrconfig",
					type: "POST",
					async: false,
					data: { a0: se },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							ftpconfig_data_all = result.info.data;
							var data = result.info;
							ftpserver = new Array();
							ftpserver[0] = (JSON.parse('{"value":0,"name":"全局指定","type":null}'));
							$.each(data.data, function (i, item) {
								if (item.SmsSvrConfigId == 0) {
									return true;
								} else if (id_value == item.SmsSvrConfigId) {
									text_value = item.SmsSvrConfigName;
								}
								ftpserver[item.SmsSvrConfigId] = (JSON.parse('{"value":' + item.SmsSvrConfigId + ',"name":"' + item.SmsSvrConfigName + '","type":"' + (manage_auth_array.indexOf(24) != -1 ? 'edit' : 'check') + '"}'));
							})
						} else {
							_alert(1, '短信网关查询', result.ErrMsg);
							return false;
						}
					}
				});
				var ftpserver1 = ftpserver;
				var ftp2_id = $('.xSelect_phone_s').data('value');
				if (ftp2_id != undefined && ftp2_id != '' && ftp2_id > 0) {
					delete ftpserver1[ftp2_id];
				}
				xSelect_json = {
					num: '1',
					width: 168,
					defaultText: '全局指定',
					items: ftpserver1,
					edit: function (item, obj) {
						$('.' + $('.xSelect_phone_m .xSelect-show').data('id')).hide();
						get_dialog(item, 1, 3);
					},
					check: function (item, obj) {
						$('.' + $('.xSelect_phone_m .xSelect-show').data('id')).hide();
						get_dialog(item, 1, 3);
					},
					delete: function (item, obj) {
					},
					btn: [

					],
					setval: function (item, obj) {
						update_xSelect($('.xSelect_phone_s'));
					}
				};
				if (manage_auth_array.indexOf(24) != -1) {
					xSelect_json.num = '2';
					xSelect_json.btn.push({
						'name': '新增',
						'event': function (items, obj) {
							get_dialog(items, 2, 3);
						}
					});
				}
				$obj.xSelect(xSelect_json);
				break;
			case 'xSelect_phone_s':
				$.ajax({
					url: "/bhost/get_smssvrconfig",
					type: "POST",
					async: false,
					data: { a0: se },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							ftpconfig_data_all = result.info.data;
							var data = result.info;
							ftpserver = new Array();
							ftpserver[0] = (JSON.parse('{"value":0,"name":"全局指定","type":null}'));
							$.each(data.data, function (i, item) {
								if (item.SmsSvrConfigId == 0) {
									return true;
								} else if (id_value == item.SmsSvrConfigId) {
									text_value = item.SmsSvrConfigName;
								}
								ftpserver[item.SmsSvrConfigId] = (JSON.parse('{"value":' + item.SmsSvrConfigId + ',"name":"' + item.SmsSvrConfigName + '","type":"' + (manage_auth_array.indexOf(24) != -1 ? 'edit' : 'check') + '"}'));
							})
						} else {
							_alert(1, '短信网关查询', result.ErrMsg);
							return false;
						}
					}
				});
				var ftpserver2 = ftpserver;
				var ftp1_id = $('.xSelect_phone_m').data('value');
				if (ftp1_id != undefined && ftp1_id != '' && ftp1_id > 0) {
					delete ftpserver2[ftp1_id];
				}
				xSelect_json = {
					num: '1',
					width: 168,
					defaultText: '全局指定',
					items: ftpserver2,
					edit: function (item, obj) {
						$('.' + $('.xSelect_phone_s .xSelect-show').data('id')).hide();
						get_dialog(item, 1, 3);
					},
					check: function (item, obj) {
						$('.' + $('.xSelect_phone_s .xSelect-show').data('id')).hide();
						get_dialog(item, 1, 3);
					},
					delete: function (item, obj) {
					},
					btn: [

					],
					setval: function (item, obj) {
						update_xSelect($('.xSelect_phone_m'));
					}
				};
				if (manage_auth_array.indexOf(24) != -1) {
					xSelect_json.num = '2';
					xSelect_json.btn.push({
						'name': '新增',
						'event': function (items, obj) {
							get_dialog(items, 2, 3);
						}
					});
				}
				$obj.xSelect(xSelect_json);
				break;
			case 'xSelect_smtp_m':
				$.ajax({
					url: "/bhost/get_smtpconfig",
					type: "POST",
					async: false,
					data: { a0: se },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							var data = result.info;
							smtpconfig_data_all = result.info.data;
							smtpconfig = new Array();
							smtpconfig[0] = (JSON.parse('{"value":0,"name":"全局指定","type":null}'));
							$.each(data.data, function (i, item) {
								if (item.SmtpConfigId == 0) {
									return true;
								} else if (id_value == item.SmtpConfigId) {
									text_value = item.SmtpConfigName;
								}
								smtpconfig[item.SmtpConfigId] = (JSON.parse('{"value":' + item.SmtpConfigId + ',"name":"' + item.SmtpConfigName + '","type":"' + (manage_auth_array.indexOf(24) != -1 ? 'edit' : 'check') + '"}'));
							})
						} else {
							_alert(1, '邮件服务器查询', result.ErrMsg);
							return false;
						}
					}
				});
				var smtpconfig1 = smtpconfig;
				var stmp2_id = $('.xSelect_smtp_s').data('value');
				if (stmp2_id != undefined && stmp2_id != '' && stmp2_id > 0) {
					delete smtpconfig1[stmp2_id];
				}
				xSelect_json = {
					num: '1',
					width: 168,
					defaultText: '全局指定',
					items: smtpconfig1,
					edit: function (item, obj) {
						$('.' + $('.xSelect_smtp_m .xSelect-show').data('id')).hide();
						get_dialog(item, 1, 1);
					},
					check: function (item, obj) {
						$('.' + $('.xSelect_smtp_m .xSelect-show').data('id')).hide();
						get_dialog(item, 1, 1);
					},
					delete: function (item, obj) {
					},
					btn: [

					],
					setval: function (item, obj) {
						update_xSelect($('.xSelect_smtp_s'));
					}
				};
				if (manage_auth_array.indexOf(24) != -1) {
					xSelect_json.num = '2';
					xSelect_json.btn.push({
						'name': '新增',
						'event': function (items, obj) {
							get_dialog(items, 2, 1);
						}
					});
				}
				$obj.xSelect(xSelect_json);
				break;
			case 'xSelect_smtp_s':
				$.ajax({
					url: "/bhost/get_smtpconfig",
					type: "POST",
					async: false,
					data: { a0: se },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							var data = result.info;
							smtpconfig_data_all = result.info.data;
							smtpconfig = new Array();
							smtpconfig[0] = (JSON.parse('{"value":0,"name":"全局指定","type":null}'));
							$.each(data.data, function (i, item) {
								if (item.SmtpConfigId == 0) {
									return true;
								} else if (id_value == item.SmtpConfigId) {
									text_value = item.SmtpConfigName;
								}
								smtpconfig[item.SmtpConfigId] = (JSON.parse('{"value":' + item.SmtpConfigId + ',"name":"' + item.SmtpConfigName + '","type":"' + (manage_auth_array.indexOf(24) != -1 ? 'edit' : 'check') + '"}'));
							})
						} else {
							_alert(1, '邮件服务器查询', result.ErrMsg);
							return false;
						}
					}
				});
				var smtpconfig2 = smtpconfig;
				var smtp1_id = $('.xSelect_smtp_m').data('value');
				if (smtp1_id != undefined && smtp1_id != '' && smtp1_id > 0) {
					delete smtpconfig2[smtp1_id];
					// smtpconfig2.splice(smtp1_id,1);
				}
				// for(i in smtpconfig2){
				// 	if(smtpconfig2[i]==null){
				// 	}
				// }
				xSelect_json = {
					num: '1',
					width: 168,
					defaultText: '全局指定',
					items: smtpconfig2,
					edit: function (item, obj) {
						$('.' + $('.xSelect_smtp_s .xSelect-show').data('id')).hide();
						get_dialog(item, 1, 1);
					},
					check: function (item, obj) {
						$('.' + $('.xSelect_smtp_s .xSelect-show').data('id')).hide();
						get_dialog(item, 1, 1);
					},
					delete: function (item, obj) {
					},
					btn: [

					],
					setval: function (item, obj) {
						update_xSelect($('.xSelect_smtp_m'));
					}
				};
				if (manage_auth_array.indexOf(24) != -1) {
					xSelect_json.num = '2';
					xSelect_json.btn.push({
						'name': '新增',
						'event': function (items, obj) {
							get_dialog(items, 2, 1);
						}
					});
				}
				$obj.xSelect(xSelect_json);
				break;
		}
		$obj.data('value', id_value);
		$('.xSelect-show-text', $obj).text(text_value);
	}
	var smtpconfig_save = {
		"SmtpConfigId": 0,
		"SmtpConfigName": null,
		"SmtpServer": null,
		"DNS": null,
		"Sender": null,
		"SenderEmail": null,
		"AttachMaxLimit": 20,
		"ServerVerify": true,
		"SenderEmailPass": null,
		"Flag": 0,
		"EnCode": 0
	};
	var smssvrconfig_save = {
		"SmsSvrConfigId": 1,
		"SmsSvrConfigName": "短信网关配置1",
		"SmsSvrDBType": 2,
		"SmsSvrDBServerIP": "192.168.0.1",
		"SmsSvrDBPort": 1433,
		"SmsSvrDBUserName": "root",
		"SmsSvrDBPassword": "d106f6959747b5ac",
		"SmsSvrDBPassword_old": null,
		"SmsSvrDBDatabase": "mysql",
		"SmsSvrDBInsertTemp": null,
		"Flag": 0,         //--2-主，1-备，0-其它
		"EnCode": 0
	};

	function smtp_clear() {
		$('#mail_suspend i.v-check').attr('class', 'v-check');
		$('#SmtpConfigName').attr("disabled", false);
		$('#SmtpConfigName').val('');
		$('#SmtpConfigName').next('i.v-check').attr('class', 'v-check');
		$('#SmtpServer').val('');
		$('#Sender').val('');
		$('#SenderEmail').val('');
		$('#AttachMaxLimit').val('');
		$('#ServerVerify_off').iCheck('check');
		$('#SenderEmailPass').val('');

		//$('#test').iCheck('uncheck');
		//$('#test').parents('label').next('span.forCheck').hide();
		//$('#test_Master_input').val('');
		//$('#DNS_Master').val('');
		$('#EnCode_mail').val(0).trigger('change');
		var smtpconfig_data_all_Flag = smtpconfig_data_all.map(function (params) {
			return params.Flag;
		});
		if ($.inArray(2, smtpconfig_data_all_Flag) < 0) {
			$('#Flag_mail').val(2).trigger('change');
		} else if ($.inArray(1, smtpconfig_data_all_Flag) < 0) {
			$('#Flag_mail').val(1).trigger('change');
		} else {
			$('#Flag_mail').val(0).trigger('change');
		}
	}
	function smssvr_clear() {
		$('#smssvr_suspend i.v-check').attr('class', 'v-check');
		$('#SmsSvrConfigName').val('');
		$('#SmsSvrConfigName').attr("disabled", false);
		$('#SmsSvrDBType').val(1).trigger('change');
		$('#SmsSvrDBServerIP').val('');
		$('#SmsSvrDBPort').val('');
		$('#SmsSvrDBUserName').val('');
		$('#SmsSvrDBPassword').val('');
		$('#SmsSvrDBDatabase').val('');
		$('#SmsSvrDBInsertTemp').val('');
		$('#EnCode_smssvr').val(0).trigger('change');
		var smtpconfig_data_all_Flag = ftpconfig_data_all.map(function (params) {
			return params.Flag;
		});
		if ($.inArray(2, smtpconfig_data_all_Flag) < 0) {
			$('#Flag_smssvr').val(2).trigger('change');
		} else if ($.inArray(1, smtpconfig_data_all_Flag) < 0) {
			$('#Flag_smssvr').val(1).trigger('change');
		} else {
			$('#Flag_smssvr').val(0).trigger('change');
		}
	}
	function smtp_input(data) {
		smtpconfig_save.SmtpConfigId = data.SmtpConfigId;
		$('#SmtpConfigName').val(data.SmtpConfigName);
		$('#SmtpConfigName').attr("disabled", true);
		$('#SmtpServer').val(data.SmtpServer);
		$('#Sender').val(data.Sender);
		$('#SenderEmail').val(data.SenderEmail);
		$('#AttachMaxLimit').val(data.AttachMaxLimit);
		if (data.ServerVerify) {
			$('#ServerVerify_on').iCheck('check');
			$('#SenderEmailPass').val(data.SenderEmailPass);
			smtpconfig_save.SenderEmailPass = data.SenderEmailPass;
		} else {
			$('#ServerVerify_off').iCheck('check');
		}
		//$('#DNS_Master').val(data.DNS);
		//$('#test_Master').iCheck('uncheck');
		//$('#test_Master').parents('label').next('span.forCheck').hide();
		//$('#test_Master_input').val('');
		$('#EnCode_mail').val(data.EnCode).trigger('change');
		$('#Flag_mail').val(data.Flag).trigger('change');
	}
	function smssvr_input(data) {
		smssvrconfig_save.SmsSvrConfigId = data.SmsSvrConfigId;
		$('#SmsSvrConfigName').val(data.SmsSvrConfigName);
		$('#SmsSvrConfigName').attr("disabled", true);
		$('#SmsSvrDBType').val(data.SmsSvrDBType).trigger('change');
		$('#SmsSvrDBServerIP').val(data.SmsSvrDBServerIP);
		$('#SmsSvrDBPort').val(data.SmsSvrDBPort);
		$('#SmsSvrDBUserName').val(data.SmsSvrDBUserName);
		$('#SmsSvrDBPassword').val(data.SmsSvrDBPassword);
		$('#SmsSvrDBDatabase').val(data.SmsSvrDBDatabase);
		$('#SmsSvrDBInsertTemp').val(data.SmsSvrDBInsertTemp);
		$('#EnCode_smssvr').val(data.EnCode).trigger('change');
		$('#Flag_smssvr').val(data.Flag).trigger('change');
		smssvrconfig_save.SmsSvrDBPassword_old = data.SmsSvrDBPassword;
	}

	function get_dialog(obj, type, num) {
		var title;
		var ajax_url;
		var dialogCont_id;
		switch (num) {
			case 1:
				smtp_clear();
				title = '邮件';
				ajax_url = 'smtpconfig';
				dialogCont_id = 'mail_suspend';
				smtpconfig_save.SmtpConfigId = 0;
				smtpconfig_save.SenderEmailPass = null;
				break;
			case 3:
				smssvr_clear();
				title = '短信网关配置';
				ajax_url = 'smssvrconfig';
				dialogCont_id = 'smssvr_suspend';
				smssvrconfig_save.SmsSvrConfigId = 0;
				smssvrconfig_save.SmsSvrDBPassword_old = null;
				break;
		}
		$("#ServerVerify_on").on("ifChanged", function () {
			if ($(this).prop("checked")) {
				$("#SenderEmailPass").parent().show();
			} else {
				$("#SenderEmailPass").parent().hide();
			}
		})
		if (type == 1) {
			var id = obj.value;
			$.ajax({
				url: "/bhost/get_" + ajax_url,
				type: "POST",
				async: false,
				data: { a0: se, a1: id },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						var data = result.info.data[0];
						switch (num) {
							case 1:
								smtp_input(data);
								break;
							// case 2:
							// 	smsm_input(data);
							// 	break;
							case 3:
								smssvr_input(data);
								break;
							// case 4:
							// 	snmp_input(data);
							// 	break;
							// case 5:
							// 	syslog_input(data);
							// 	break;
						}
					} else {
						_alert(1, title, result.ErrMsg);
						return false;
					}
				}
			});

		} else {
			// title_d = "创建" + title;
		}
		var $dialogCont = $("#" + dialogCont_id).show();

		var d = dialog({
			title: title,
			content: $dialogCont,
			id: dialogCont_id,
			width: "800px"
		});
		d.addEventListener('close', function () {
			$dialogCont.appendTo("body").hide();
		});
		d.showModal();
		$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
			switch (num) {
				case 1:
					smtp_clear();
					break;
				// case 2:
				// 	smsm_clear();
				// 	break;
				case 3:
					smssvr_clear();
					break;
				// case 4:
				// 	snmp_clear();
				// 	break;
				// case 5:
				// 	syslog_clear();
				// 	break;
			}
			if (type == 1) {
				var id = obj.value;
				$.ajax({
					url: "/bhost/get_" + ajax_url,
					type: "POST",
					async: false,
					data: { a0: se, a1: id },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							var data = result.info.data[0];
							switch (num) {
								case 1:
									smtp_input(data);
									break;
								// case 2:
								// 	smsm_input(data);
								// 	break;
								case 3:
									smssvr_input(data);
									break;
								// case 4:
								// 	snmp_input(data);
								// 	break;
								// case 5:

								// 	syslog_input(data);
								// 	break;
							}
						} else {
							_alert(1, title, result.ErrMsg);
							return false;
						}
					}
				});
			} else {
			}
		});

		$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
			var pass = false;
			switch (num) {
				case 1:
					if (save_smtp_date()) {
						pass = save_smtpconfig();
					}
					break;
				// case 2:
				// 	if (save_smsm_date()) {
				// 		pass = save_smsmconfig();
				// 	}
				// 	break;
				case 3:
					if (save_smssvr_date()) {
						pass = save_smssvrconfig();
					}

					break;
				// case 4:

				// 	if (save_snmp_date()) {
				// 		pass = save_snmpconfig();
				// 	}
				// 	break;
				// case 5:
				// 	if (save_syslog_date()) {
				// 		pass = save_syslogconfig();
				// 	}
				// 	break;
			}
			if (pass) {
				$('.btn').blur(); parent.layer.open({
					type: 1,
					title: title,
					content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
					btn: ['确&nbsp;&nbsp;定'],
					btnAlign: 'c',
					closeBtn: false,
					skin: 'layer-custom',
					area: ['380px', '310px'],
					move: false,
					resize: false,
					yes: function (i) {
						parent.layer.close(i);
						d.close().remove();
					}
				});
			}
		})
	}
	var ipReg = /^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])(\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])){3}$/;
	function save_smtp_date() {
		var SmtpConfigName_Master = $("#SmtpConfigName").val();
		if (SmtpConfigName_Master == '') {
			_alert(2, '邮件', '请输入名称', $('#SmtpConfigName'));
			return false;
		} else if (!nameReg.test(SmtpConfigName_Master)) {
			_alert(1, '邮件', '名称格式不正确', $('#SmtpConfigName'));
			return false;
		}
		var SmtpServer = $('#SmtpServer').val();
		//var DNS = $('#DNS_Master').val();
		if (SmtpServer == "") {
			_alert(2, '邮件', '请输入服务器地址', $('#SmtpServer'));
			return false;
		} else if (!ipReg.test(SmtpServer) && (!hostcheck1.test(SmtpServer)) && (!hostcheck2.test(SmtpServer))){
			_alert(1, '邮件', '服务器地址格式不正确', $('#SmtpServer'));
			return false;
		}
		/*
		if (DNS == "") {
			DNS = null;
		}
		*/
		var Sender = $('#Sender').val();
		if (Sender == "") {
			_alert(2, '邮件', '请输入服务器账号', $('#Sender'));
			return false;
		}
		var SenderEmail = $('#SenderEmail').val();
		if (SenderEmail == "") {
			_alert(2, '邮件', '请输入发送邮箱地址', $('#SenderEmail'));
			return false;
		} else if (!emailReg.test(SenderEmail)) {
			_alert(1, '邮件', '发送邮箱地址格式不正确', $('#SenderEmail'));
			return false;
		}
		var AttachMaxLimit = $('#AttachMaxLimit').val();
		if (AttachMaxLimit == "") {
			_alert(2, '邮件', '请输入附件大小', $('#AttachMaxLimit'));
			return false;
		}
		//var ServerVerify = ($('#ServerVerify').find('input[type=radio]:checked').val() == '2');
		if ($("#ServerVerify_on").prop("checked")) {
			if ($("#SenderEmailPass").val() == "") {
				_alert(2, "邮件", "请输入服务器验证", $("#SenderEmailPass"));
				return false;
			} else {
				if($("#SenderEmailPass").val().length > 64){
					_alert(2, '邮件', "密码不能超过系统限定64位", $("#SenderEmailPass"));
					return false;
				}
				smtpconfig_save.ServerVerify = true;
				smtpconfig_save.SenderEmailPass = $("#SenderEmailPass").val();
			}
		} else {
			smtpconfig_save.ServerVerify = false;
			smtpconfig_save.SenderEmailPass = null;
		}

		smtpconfig_save.SmtpConfigName = SmtpConfigName_Master;
		smtpconfig_save.SmtpServer = SmtpServer;
		smtpconfig_save.DNS = null;
		smtpconfig_save.Sender = Sender;
		smtpconfig_save.SenderEmail = SenderEmail;
		smtpconfig_save.AttachMaxLimit = AttachMaxLimit;
		//smtpconfig_save.ServerVerify = ServerVerify;
		//smtpconfig_save.SenderEmailPass = SenderEmailPass;
		smtpconfig_save.EnCode = parseInt($('#EnCode_mail').val());
		smtpconfig_save.Flag = parseInt($('#Flag_mail').val());
		return true;
	}
	function save_smssvr_date() {
		var numCheck = /\D/;
		var SmsSvrConfigName = $("#SmsSvrConfigName").val();
		var SmsSvrDBType = $("#SmsSvrDBType").val();
		var SmsSvrDBServerIP = $("#SmsSvrDBServerIP").val();
		var SmsSvrDBPort = $("#SmsSvrDBPort").val();
		var SmsSvrDBUserName = $("#SmsSvrDBUserName").val();
		var SmsSvrDBPassword = $("#SmsSvrDBPassword").val();
		var SmsSvrDBDatabase = $("#SmsSvrDBDatabase").val();
		var SmsSvrDBInsertTemp = $("#SmsSvrDBInsertTemp").val();
		if (SmsSvrConfigName == "") {
			_alert(2, "短信网关", "请输入名称", $("#SmsSvrConfigName"));
			return false;
		} else {
			if (!nameCheck.test(SmsSvrConfigName)) {
				_alert(1, "短信网关", "名称格式不正确", $("#SmsSvrConfigName"));
				return false;
			}
		}
		if (SmsSvrDBServerIP == "") {
			_alert(2, "短信网关", "请输入服务器地址", $("#SmsSvrDBServerIP"));
			return false;
		} else {
			if (!ipcheck_route.test(SmsSvrDBServerIP)) {
				_alert(1, "短信网关", "服务器地址格式不正确", $("#SmsSvrDBServerIP"));
				return false;
			}
		}
		if (SmsSvrDBPort == "") {
			_alert(2, "短信网关", "请输入端口", $("#SmsSvrDBPort"));
			return false;
		} else {
			if (numCheck.test(parseInt(SmsSvrDBPort))) {
				_alert(1, "短信网关", "端口格式不正确", $("#SmsSvrDBPort"));
				return false;
			}
			if (parseInt(SmsSvrDBPort) > 65534) {
				_alert(1, "短信网关", "端口不能大于65534", $("#SmsSvrDBPort"));
				return false;
			}
			if (parseInt(SmsSvrDBPort) < 1) {
				_alert(1, "短信网关", "端口不能小于1", $("#SmsSvrDBPort"));
				return false;
			}
		}
		if (SmsSvrDBUserName == "") {
			_alert(2, "短信网关", "请输入账号", $("#SmsSvrDBUserName"));
			return false;
		} else {
			if (!nameCheck.test(SmsSvrDBUserName)) {
				_alert(1, "短信网关", "账号格式不正确", $("#SmsSvrDBUserName"));
				return false;
			}
		}
		if (SmsSvrDBPassword == "") {
			_alert(2, "短信网关", "请输入密码", $("#SmsSvrDBPassword"));
			return false;
		}
		if (SmsSvrDBDatabase == "") {
			_alert(2, "短信网关", "请输入数据库", $("#SmsSvrDBDatabase"));
			return false;
		}
		if (SmsSvrDBInsertTemp == "") {
			_alert(2, "短信网关", "请输入短信sql语句模板", $("#SmsSvrDBInsertTemp"));
			return false;
		} else {
			if (SmsSvrDBInsertTemp.indexOf("%phone%") === -1 || SmsSvrDBInsertTemp.indexOf("%content%") === -1) {
				_alert(1, "短信网关", "模板格式不正确", $("#SmsSvrDBInsertTemp"));
				return false;
			}
		}
		smssvrconfig_save.SmsSvrConfigName = SmsSvrConfigName;
		smssvrconfig_save.SmsSvrDBType = SmsSvrDBType;
		smssvrconfig_save.SmsSvrDBServerIP = SmsSvrDBServerIP;
		smssvrconfig_save.SmsSvrDBPort = parseInt(SmsSvrDBPort);
		smssvrconfig_save.SmsSvrDBUserName = SmsSvrDBUserName;
		smssvrconfig_save.SmsSvrDBPassword = SmsSvrDBPassword;
		smssvrconfig_save.SmsSvrDBDatabase = SmsSvrDBDatabase;
		smssvrconfig_save.SmsSvrDBInsertTemp = SmsSvrDBInsertTemp;
		smssvrconfig_save.Flag = parseInt($("#Flag_smssvr").val());
		smssvrconfig_save.EnCode = parseInt($("#EnCode_smssvr").val());
		return true;
	}
	function save_smtpconfig() {
		var pass = true;
		if (smtpconfig_save == null) {
			return false;
		}
		msstr = aceg(JSON.stringify(smtpconfig_save),se);
		$.ajax({
			url: "/bhost/add_smtpconfig",
			type: "POST",
			async: false,
			data: { a0: se, a1: JSON.stringify(smtpconfig_save), a2: '运维管理>全局策略',m1:msstr},
			success: function (result) {
				var result = JSON.parse(result);
				if (result.Result) {
					//刷新下拉
					var focusObj_value = $focusObj_c.data('value');
					if (focusObj_value == 0) {
						$focusObj_c.data('value', result.SmtpConfigId);
					}
					update_xSelect($('.xSelect_smtp_m'));
					update_xSelect($('.xSelect_smtp_s'));
				} else {
					if (result.ErrMsg == "同名邮件服务器配置已存在") {
						_alert(2, "邮件", result.ErrMsg, $('#SmtpConfigName_Master'));
					} else {
						_alert(2, "邮件", result.ErrMsg);
					}
					pass = false;
				}
			}
		});
		return pass;
	}
	function save_smssvrconfig() {
		var pass = true;
		if (smssvrconfig_save == null) {
			return false;
		}
		var msstr = aceg(JSON.stringify(smssvrconfig_save),se);
		$.ajax({
			url: "/bhost/add_smssvrconfig",
			type: "POST",
			async: false,
			data: { a0: se, a1: JSON.stringify(smssvrconfig_save), a10: '运维管理>全局策略' ,m1:msstr},
			success: function (result) {
				var result = JSON.parse(result);
				if (result.Result) {
					//刷新下拉
					var focusObj_value = $focusObj_c.data('value');
					if (focusObj_value == 0) {
						$focusObj_c.data('value', result.SmsSvrConfigId);
					}
					update_xSelect($('.xSelect_phone_m'));
					update_xSelect($('.xSelect_phone_s'));
				} else {
					if (result.ErrMsg == "同名短信网关服务配置已存在") {
						_alert(2, "短信网关", result.ErrMsg, $('#SmtpConfigName'));
					} else {
						_alert(2, "短信网关", result.ErrMsg);
					}
					pass = false;
				}
			}
		});
		return pass;
	}

	//添加接收人
	function _addadmin_a(obj) {
		var m_i = $(obj).parent().children('select').find("option:selected").val();
		var text = $(obj).parent().children('select').find("option:selected").text();
		if (m_i == "0") {
			_alert(2, '审批策略', '请选择审批者');
			return false;
		}
		var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + m_i + '" id="' + m_i + '"/>');
		$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + text + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin_a(this)"></i>');
		//$c.html('<input class="form-text" type="text" style="width: 128px;" value="' + text + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin_a(this)"></i>');
		$(obj).parent().after($c);
		$(obj).parent().children('select').find('option[value=' + m_i + ']').remove();
		$(obj).parent().children('select').val(0).trigger("change");
		check_option_str[m_i] = all_option_str[m_i];
		all_option_str[m_i] = null;
	}
	var check_value = 'false false';
	var adc = 0;
	function approvemain(type) {
		//用户列表
		$.ajax({
			url: "/bhost/get_user_list_app",
			type: "POST",
			async: false,
			data: { a0: se, a2: 6 },
			success: function (result) {
				var userinfo_result = JSON.parse(result);
				if (userinfo_result.Result == true) {
					var userinfo_data = userinfo_result.info;
					$("#admin_select_a").empty().append("<option value=\"0\">请选择</option>");
					$.each(userinfo_data, function (i, item) {
						var text = '';
						if (item.Email != null && item.Email != '') {
							text += 'email';
						}
						if (item.MobilePhone != null && item.MobilePhone != '') {
							text += 'phone';
						}
						$("#admin_select_a").append("<option value=\"" + item.UserId + "\" index=\"0\" data-text=\"" + text + "\">" + item.UserCode + "</option>");
						all_option_str[item.UserId] = "<option value=\"" + item.UserId + "\" index=\"0\" data-text=\"" + text + "\">" + item.UserCode + "</option>";
					});
					//$("#admin_select_a").select2();
				} else {
					_alert(2, '审批策略', "执行失败：" + userinfo_result.ErrMsg);
				}
			}
		});
		$('#admin_select_a').on('change', function () {
			var admin_select = $('#admin_select_a').val();
			$('#admin_check_a').attr('value', admin_select);
			if ($('#admin_select_a').find('option').length == 2 && $('#admin_select_a option:selected').val() != '0') {
				_addadmin_a($('#admin_select_a').siblings('i'));
				$('#admin_check_a').hide();
			} else if ($('#admin_select_a').find('option').length == 1) {
				$('#admin_check_a').hide();
			} else {
				$('#admin_check_a').show();
			}
			edit_admin_num();
		});
		//输入数字
		$("#ApproveNum").bind('keydown', function (e) {
			DigitInput(e);
		});
		$('#checkbox').on('ifChanged', 'input', function (e) {
			if ($('#checkbox4').is(':checked') && !$('#checkbox8').is(':checked')) {
				update_xSelect($('.xSelect_phone_m'));
				update_xSelect($('.xSelect_phone_s'));
				$('.xSelect_phone_m').parents('.form-item').show();
				$('.xSelect_phone_s').parents('.form-item').show();
				$('.xSelect_smtp_m').parents('.form-item').hide();
				$('.xSelect_smtp_s').parents('.form-item').hide();
				$('#admin_select_a').select2('close');
				if (check_value == 'true false') {
					return false;
				}
				check_value = 'true false';
				var admin_select_value = $('#admin_select_a').val();
				// setTimeout(function(){
				$.each($('#admin_select_a option[value!=0]'), function (i, item) {
					if (item.getAttribute("data-text").indexOf('phone') < 0) {
						item.remove();
					}
				})
				for (var i in check_option_str) {
					if (check_option_str[i] == null) {
						continue;
					}
					if (check_option_str[i].indexOf('data-text="emailphone"') < 0 && check_option_str[i].indexOf('data-text="phone"') < 0) {
						all_option_str[i] = check_option_str[i];
						// setTimeout(function() {
						$('#' + i).fadeOut(function () {
							$('#' + i).remove();
							edit_admin_num();
						});
						// }, 10);
						check_option_str[i] = null;
						continue;
					}
				}
				for (var i in all_option_str) {
					if (all_option_str[i] == null) {
						continue;
					}
					if ((all_option_str[i].indexOf('data-text="emailphone"') >= 0 || all_option_str[i].indexOf('data-text="phone"') >= 0) && $('#admin_select_a option[value=' + i + ']').length == 0) {
						for (var j = i + 1; j < all_option_str.length; j++) {
							if (all_option_str[j] != null) {
								if ($('#admin_select_a option[value=' + j + ']').length != 0) {
									$('#admin_select_a option[value=' + j + ']').before(all_option_str[i]);
									break;
								}
							}
						}
						if (j == all_option_str.length) {
							$('#admin_select_a').append(all_option_str[i]);
						}
					}
				}
				if ($('#admin_select_a option[value=' + admin_select_value + ']').length == 0) {
					admin_select_value = 0;
				}
				$('#admin_select_a').val(admin_select_value).trigger('change');
				// },1);

			} else if (!$('#checkbox4').is(':checked') && $('#checkbox8').is(':checked')) {
				update_xSelect($('.xSelect_smtp_m'));
				update_xSelect($('.xSelect_smtp_s'));
				$('.xSelect_phone_m').parents('.form-item').hide();
				$('.xSelect_phone_s').parents('.form-item').hide();
				$('.xSelect_smtp_m').parents('.form-item').show();
				$('.xSelect_smtp_s').parents('.form-item').show();
				$('#admin_select_a').select2('close');
				if (check_value == 'false true') {
					return false;
				}
				check_value = 'false true';
				var admin_select_value = $('#admin_select_a').val();
				$.each($('#admin_select_a option[value!=0]'), function (i, item) {
					if (item.getAttribute("data-text").indexOf('email') < 0) {
						$(item).remove();
					}
				})
				for (var i in check_option_str) {
					if (check_option_str[i] == null) {
						continue;
					}
					if (check_option_str[i].indexOf('data-text="emailphone"') < 0 && check_option_str[i].indexOf('data-text="email"') < 0) {
						all_option_str[i] = check_option_str[i];
						// setTimeout(function() {
						$('#' + i).fadeOut(function () {
							$('#' + i).remove();
							edit_admin_num();
						});
						// }, 10);
						check_option_str[i] = null;
						continue;
					}
				}
				for (var i in all_option_str) {
					if (all_option_str[i] == null) {
						continue;
					}
					if ((all_option_str[i].indexOf('data-text="email"') >= 0 || all_option_str[i].indexOf('data-text="emailphone"') >= 0) && $('#admin_select_a option[value=' + i + ']').length == 0) {
						for (var j = i + 1; j < all_option_str.length; j++) {
							if (all_option_str[j] != null) {
								if ($('#admin_select_a option[value=' + j + ']').length != 0) {
									$('#admin_select_a option[value=' + j + ']').before(all_option_str[i]);
									break;
								}
							}
						}
						if (j == all_option_str.length) {
							$('#admin_select_a').append(all_option_str[i]);
						}
					}
				}
				if ($('#admin_select_a option[value=' + admin_select_value + ']').length == 0) {
					admin_select_value = 0;
				}
				$('#admin_select_a').val(admin_select_value).trigger('change');
				// },1)

			} else if (!$('#checkbox4').is(':checked') && !$('#checkbox8').is(':checked')) {
				$('.xSelect_phone_m').parents('.form-item').hide();
				$('.xSelect_phone_s').parents('.form-item').hide();
				$('.xSelect_smtp_m').parents('.form-item').hide();
				$('.xSelect_smtp_s').parents('.form-item').hide();
				$('#admin_select_a').select2('close');
				if (check_value == 'false false') {
					return false;
				}
				check_value = 'false false';
				var admin_select_value = $('#admin_select_a').val();
				$('#admin_select_a option[value!=0]').remove();
				for (var i in all_option_str) {
					if (all_option_str[i] == null) {
						continue;
					}
					$('#admin_select_a').append(all_option_str[i]);
				}
				$('#admin_select_a').val(admin_select_value).trigger('change');
			} else if ($('#checkbox4').is(':checked') && $('#checkbox8').is(':checked')) {
				update_xSelect($('.xSelect_phone_m'));
				update_xSelect($('.xSelect_phone_s'));
				update_xSelect($('.xSelect_smtp_m'));
				update_xSelect($('.xSelect_smtp_s'));
				$('.xSelect_phone_m').parents('.form-item').show();
				$('.xSelect_phone_s').parents('.form-item').show();
				$('.xSelect_smtp_m').parents('.form-item').show();
				$('.xSelect_smtp_s').parents('.form-item').show();
				$('#admin_select_a').select2('close');
				if (check_value == 'true true') {
					return false;
				}
				check_value = 'true true';
				var admin_select_value = $('#admin_select_a').val();
				$.each($('#admin_select_a option[value!=0]'), function (i, item) {
					if (item.getAttribute("data-text").indexOf('emailphone') < 0) {
						$(item).remove();
					}
				})
				for (var i in check_option_str) {
					if (check_option_str[i] == null) {
						continue;
					}
					if (check_option_str[i].indexOf('emailphone') < 0) {
						all_option_str[i] = check_option_str[i];
						// setTimeout(function() {
						$('#' + i).fadeOut(function () {
							$('#' + i).remove();
							edit_admin_num();
						});
						// }, 10);
						check_option_str[i] = null;
						continue;
					}
				}
				for (var i in all_option_str) {
					if (all_option_str[i] == null) {
						continue;
					}
					if (all_option_str[i].indexOf('emailphone') >= 0 && $('#admin_select_a option[value=' + i + ']').length == 0) {
						for (var j = i - 1; j < all_option_str.length; j--) {
							if (all_option_str[j] != null) {
								if ($('#admin_select_a option[value=' + j + ']').length != 0) {
									$('#admin_select_a option[value=' + j + ']').before(all_option_str[i]);
									break;
								}
							}
						}
						if (j == 0) {
							$('#admin_select_a').prepend(all_option_str[i]);
						}
					}
				}
				if ($('#admin_select_a option[value=' + admin_select_value + ']').length == 0) {
					admin_select_value = 0;
				}
				$('#admin_select_a').val(admin_select_value).trigger('change');
			}
		});
		$('#checkbox1').iCheck('check');
		$('#checkbox1').iCheck('disable');
		//编辑页面
		if (type == 1) {
			$("#ApproveStrategyName").val(approve_data.ApproveStrategyName);
			$("#ApproveStrategyName").attr("disabled", true);
			$("#ApproveNum").val(approve_data.ApproveNum);
			var ApproveType = parseInt(approve_data.ApproveType.toString(2), 2);
			var text = [];
			var num_smssvr = 0;
			var num_smtp = 0;
			$('#ApproveNum').attr('edited', 1);
			if (ApproveType & 1) {
				$('#checkbox1').iCheck('check');
			}
			if (ApproveType & 2) {
				$('#checkbox2').iCheck('check');
				if ($.inArray('phone', text) < 0) {
					text.push('phone');
				}
				if (approve_data.MasterSmsSvrConfigId != null) {
					$('.xSelect_phone_m').data('value', approve_data.MasterSmsSvrConfigId);
					num_smssvr++;
				}
				if (approve_data.StandBySmsSvrConfigId != null) {
					$('.xSelect_phone_s').data('value', approve_data.StandBySmsSvrConfigId);
					num_smssvr++;
				}
			}
			if (ApproveType & 4) {
				$('#checkbox4').iCheck('check');
				if ($.inArray('phone', text) < 0) {
					text.push('phone');
				}
				if (approve_data.MasterSmsSvrConfigId != null) {
					$('.xSelect_phone_m').data('value', approve_data.MasterSmsSvrConfigId);
					num_smssvr++;
				}
				if (approve_data.StandBySmsSvrConfigId != null) {
					$('.xSelect_phone_s').data('value', approve_data.StandBySmsSvrConfigId);
					num_smssvr++;
				}
			}
			if (ApproveType & 8) {
				$('#checkbox8').iCheck('check');
				text.push('email');
				if (approve_data.MasterSmtpConfigId != null) {
					$('.xSelect_smtp_m').data('value', approve_data.MasterSmtpConfigId);
					num_smtp++;
				}
				if (approve_data.StandBySmtpConfigId != null) {
					$('.xSelect_smtp_s').data('value', approve_data.StandBySmtpConfigId);
					num_smtp++;
				}
			}
			if (ApproveType & 16) {
				$('#checkbox16').iCheck('check');
			}
			if (num_smssvr != 0) {
				update_xSelect($('.xSelect_phone_m'));
				update_xSelect($('.xSelect_phone_s'));
			}
			if (num_smtp != 0) {
				update_xSelect($('.xSelect_smtp_m'));
				update_xSelect($('.xSelect_smtp_s'));
			}
			if (approve_data.UserSet != null) {
				for (var i = 0; i < approve_data.UserSet.length - 1; i++) {
					var item = approve_data.UserSet[i];
					check_option_str[item.UserId] = all_option_str[item.UserId];
					all_option_str[item.UserId] = null;

					var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + item.UserId + '" id="' + item.UserId + '"/>');
					$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + item.UserCode + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin_a(this)"></i>');
					$("#admin_select_a").parent().after($c);
					$("#admin_select_a").find('option[value=' + item.UserId + ']').remove();
					$("#admin_select_a").trigger('change');
				}
				if (all_option_str[approve_data.UserSet[i].UserId].indexOf('data-text="' + text.join('') + '"') < 0 || (all_option_str[approve_data.UserSet[i].UserId] == undefined || all_option_str[approve_data.UserSet[i].UserId] == null)) {
					var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + approve_data.UserSet[i].UserId + '" id="' + approve_data.UserSet[i].UserId + '"/>');
					$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + approve_data.UserSet[i].UserCode + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin_a(this)"></i>');
					$("#admin_select_a").parent().after($c);
					$("#admin_select_a").find('option[value=' + approve_data.UserSet[i].UserId + ']').remove();
					check_option_str[approve_data.UserSet[i].UserId] = all_option_str[approve_data.UserSet[i].UserId];
					all_option_str[approve_data.UserSet[i].UserId] = null;
					$("#admin_select_a").trigger('change');
				} else {
					$("#admin_select_a").val(approve_data.UserSet[i].UserId).trigger('change');
				}
			}
			/*
			if (approve_data.UserSet != null) {
				$('#admin_num').text(approve_data.UserSet.length);
				for(var i=0;i<approve_data.UserSet.length-1;i++){
					var item=approve_data.UserSet[i];
					check_option_str[item.UserId] = all_option_str[item.UserId];
					all_option_str[item.UserId] = null;
					var text='';
					if(item.Email!=null && item.Email!=''){
						text+='email';
					}
					if(item.MobilePhone!=null && item.MobilePhone!=''){
						text+='phone';
					}	
					var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + item.UserId + '" id="' + item.UserId +'"/>');
					$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + item.UserCode + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin_a(this)"></i>');
					$("#admin_select_a").parent().after($c);
					$("#admin_select_a").find('option[value=' + item.UserId + ']').remove();
					$("#admin_select_a").trigger('change');
				}
				if(all_option_str[approve_data.UserSet[i].UserId].indexOf('data-text="'+text+'"')<0 || (all_option_str[approve_data.UserSet[i].UserId]==undefined || all_option_str[approve_data.UserSet[i].UserId]==null)){
					var $c = $('<div class="item" style="padding-top:0px;width:195px;" value="' + approve_data.UserSet[i].UserId + '" id="' + approve_data.UserSet[i].UserId +'"/>');
					$c.html('<input class="form-text" type="text" style="width: 142px;padding-right:8px;" value="' + approve_data.UserSet[i].UserCode + '" disabled="true"><i style="    " class="ctrl del" onclick="_deladmin_a(this)"></i>');
					$("#admin_select_a").parent().after($c);
					$("#admin_select_a").find('option[value=' + approve_data.UserSet[i].UserId + ']').remove();
					$("#admin_select_a").trigger('change');
				}else{
					$("#admin_select_a").val(approve_data.UserSet[i].UserId).trigger('change');
				}
				//$("#admin_select_a").val(approve_data.UserSet[i].UserId).trigger('change');
			}
			*/
		}
	}

	function edit_admin_num() {
		$('#label_list_a').find('div[value!=0]:hidden').remove();
		var len = $('#label_list_a').find('div[value!=0]').length;
		$('#admin_num').text(len);
		var ApproveNum_count = $('#ApproveNum').val();
		var num_edited = $('#ApproveNum').attr('edited')
		if (num_edited == '0') {
			$('#ApproveNum').val(len);
		}
	}

	function save_data(d) {
		var approve_item = {
			"ApproveStrategyId": 0,
			"ApproveStrategyName": "",
			"ApproveNum": 0,
			"ApproveType": 0,
			"UserSet": [],
			"MasterSmsMConfigId": null,
			"MasterSmsMConfig": null,
			"StandBySmsMConfigId": null,
			"StandBySmsMConfig": null,
			"MasterSmsSvrConfigId": null,
			"MasterSmsSvrConfig": null,
			"StandBySmsSvrConfigId": null,
			"StandBySmsSvrConfig": null,
			"MasterSmtpConfigId": null,
			"MasterSmtpConfig": null,
			"StandBySmtpConfigId": null,
			"StandBySmtpConfig": null
		}
		obj = document.getElementById("admin_select_a");
		var val = $("#ApproveStrategyName").val();
		//审批策略名
		if (val == "") {
			_alert(1, "审批策略", '名称不能为空', $("#ApproveStrategyName"));
			return false;
		}
		if (!nameReg.test(val)) {
			_alert(1, "审批策略", '名称格式不正确', $("#ApproveStrategyName"));
			return false;
		}
		var ApproveNum = $('#ApproveNum').val();
		if (ApproveNum == "") {
			_alert(1, "审批策略", '审批人数不能为空', $("#ApproveNum"));
			return false;
		}
		var numReg = /^[0-9]+$/;
		if (!numReg.test(ApproveNum)) {
			_alert(1, "审批策略", '审批人数只能输入数字', $("#ApproveNum"));
			return false;
		}
		ApproveNum = parseInt(ApproveNum);
		if (ApproveNum == 0) {
			_alert(1, "审批策略", '审批人数不能为0', $("#ApproveNum"));
			return false;
		}
		approve_item.ApproveType = 0;
		if ($('#checkbox1').is(':checked')) {
			approve_item.ApproveType += 1;
		}
		if ($('#checkbox2').is(':checked')) {
			approve_item.ApproveType += 2;
		}
		if ($('#checkbox4').is(':checked')) {
			approve_item.ApproveType += 4;
			var xSelect_phone_m_id = $('.xSelect_phone_m').data('value');
			var xSelect_phone_s_id = $('.xSelect_phone_s').data('value');
			approve_item.MasterSmsSvrConfigId = xSelect_phone_m_id;
			approve_item.StandBySmsSvrConfigId = xSelect_phone_s_id;
			approve_item.MasterSmsSvrConfig = $('.xSelect_phone_m .xSelect-show-text').text();
			approve_item.StandBySmsSvrConfig = $('.xSelect_phone_s .xSelect-show-text').text();
		}
		if ($('#checkbox8').is(':checked')) {
			approve_item.ApproveType += 8;
			var xSelect_smtp_m_id = $('.xSelect_smtp_m').data('value');
			var xSelect_smtp_s_id = $('.xSelect_smtp_s').data('value');
			approve_item.MasterSmtpConfigId = xSelect_smtp_m_id;
			approve_item.StandBySmtpConfigId = xSelect_smtp_s_id;
			approve_item.MasterSmtpConfig = $('.xSelect_smtp_m .xSelect-show-text').text();
			approve_item.StandBySmtpConfig = $('.xSelect_smtp_s .xSelect-show-text').text();
		}
		if (approve_item.ApproveType == 0) {
			_alert(2, "审批策略", '请选择方式');
			return false;
		}
		var $all = $("#label_list_a").find('div[value!=0]');
		var len = $all.length;
		if (len == 0) {
			_alert(2, "审批策略", '请选择审批者');
			return false;
		}
		//var id = document.frm_approve_add.a.value;
		approve_item.ApproveStrategyId = approveId;
		approve_item.ApproveStrategyName = val;
		if (ApproveNum > len) {
			ApproveNum = len;
		}
		approve_item.ApproveNum = (ApproveNum);
		approve_item.UserSet = new Array();

		for (var j = len - 1; j >= 0; j--) {
			var t_i = $all.eq(j).attr('value');
			if (t_i != '0' && t_i != '') {
				var json_a = '{"UserId":' + t_i + '}';
				approve_item.UserSet.push(JSON.parse(json_a));
			}
		}
		var msstr = aceg(JSON.stringify(approve_item),se);
		$.ajax({
			url: '/bhost/add_approve',
			type: "POST",
			async: false,
			data: { a0: se, a1: JSON.stringify(approve_item) ,m1:msstr},
			success: function (result) {
				var result = JSON.parse(result);
				if (result.Result) {
					$('.btn').blur(); parent.layer.open({
						type: 1,
						title: '审批策略',
						content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						yes: function (i) {
							$('.btn').blur();
							parent.layer.close(i);
							var approve_text = $('#EnableApprove').find('span').text();
							$("div[data-id=xSelect-approve]").remove();
							$('#EnableApprove').empty().data('xSelect', '');
							bind_approval_xSelect();
							if ($("#EnableApprove").data('value') == "-1" || $("#EnableApprove").data('value') == undefined) {
								$("#EnableApprove").data('value', result.ApproveStrategyId);
								$("#EnableApprove").find('span').text(approve_item.ApproveStrategyName);
							} else {
								$('#EnableApprove').find('span').text(approve_text);
							}
							d.close().remove();
						}
					});
				} else {
					_alert(1, "审批策略", "执行失败：" + result.ErrMsg, $("#ApproveStrategyName"));
					return false;
				}
			}
		});
	}

	//安全策略
	var min_t = 300;
	var max_t = 86400;
	var pwdstrategy = {
		"PwdStrategyId": 1,
		"PwdMinLen": 8,
		"IfPwdUseExpire": true,
		"PwdUseExpire": 100,
		"PwdUseExpireNotify": 0,
		"IfPwdComplex": false,
		"IfPwdIncUpperApha": false,
		"IfPwdIncLowerApha": true,
		"IfPwdIncNumber": true,
		"IfPwdIncSpecialChar": true,
		"IfPwdUnRepeat": false,
		"PwdUnRepeat": 3,
		"IfPwdErrorLock": false,
		"PwdErrorLockExpire": 5,
		"PwdErrorLockNumber": 5,
		"IfAccountAutoUnLock": false,
		"AccountAutoUnLock": 10,
		"IfNeedCode": false
		// "DownFilePwd":null
	};

	$(function () {
		parent._switchBtn(1);//显示按钮
		//输入数字
		$("#PwdMinLen,#PwdUseExpire,#PwdUseExpireNotify,#PwdUnRepeat,#PwdErrorLockExpire,#PwdErrorLockNumber,#AccountAutoUnLock,#web_t,#client_t").bind('keydown', function (e) {
			DigitInput(e);
		});
		//密码使用期限：
		$("#IfPwdUseExpire").on("ifChecked", function (e) {
			$("#PwdUseExpire").removeAttr("disabled");
			$("#PwdUseExpireNotify").removeAttr("disabled");
		});
		$("#IfPwdUseExpire").on("ifUnchecked", function (e) {
			$("#PwdUseExpire").attr("disabled", true);
			$("#PwdUseExpireNotify").attr("disabled", true);
		});
		//密码复杂度要求：
		$("#IfPwdComplex").on("ifChecked", function (e) {
			$("#IfPwdIncUpperApha").removeAttr("disabled");
			$("#IfPwdIncLowerApha").removeAttr("disabled");
			$("#IfPwdIncNumber").removeAttr("disabled");
			$("#IfPwdIncSpecialChar").removeAttr("disabled");
			$('#IfPwdIncUpperApha,#IfPwdIncLowerApha,#IfPwdIncNumber,#IfPwdIncSpecialChar').iCheck({
				checkboxClass: 'icheckbox_minimal-blue',
				radioClass: 'iradio_minimal-blue',
				increaseArea: '0' // optional
			});
		});
		$("#IfPwdComplex").on("ifUnchecked", function (e) {
			$("#IfPwdIncUpperApha").attr("disabled", true);
			$("#IfPwdIncLowerApha").attr("disabled", true);
			$("#IfPwdIncNumber").attr("disabled", true);
			$("#IfPwdIncSpecialChar").attr("disabled", true);
			$('#IfPwdIncUpperApha,#IfPwdIncLowerApha,#IfPwdIncNumber,#IfPwdIncSpecialChar').iCheck({
				checkboxClass: 'icheckbox_minimal-blue',
				radioClass: 'iradio_minimal-blue',
				increaseArea: '0' // optional
			});
		});
		//密码安全策略：
		$("#IfPwdUnRepeat").on("ifChecked", function (e) {
			$("#PwdUnRepeat").removeAttr("disabled");
		});
		$("#IfPwdUnRepeat").on("ifUnchecked", function (e) {
			$("#PwdUnRepeat").attr("disabled", true);
		});
		//账户锁定策略：
		$("#IfPwdErrorLock").on("ifChecked", function (e) {
			$("#PwdErrorLockExpire").removeAttr("disabled");
			$("#PwdErrorLockNumber").removeAttr("disabled");
		});
		$("#IfPwdErrorLock").on("ifUnchecked", function (e) {
			$("#PwdErrorLockExpire").attr("disabled", true);
			$("#PwdErrorLockNumber").attr("disabled", true);
		});
		//账户自动解锁：
		$("#IfAccountAutoUnLock").on("ifChecked", function (e) {
			$("#AccountAutoUnLock").removeAttr("disabled");
		});
		$("#IfAccountAutoUnLock").on("ifUnchecked", function (e) {
			$("#AccountAutoUnLock").attr("disabled", true);
		});
		//导出加密
		$("#DownFilePwd").on("ifChecked", function (e) {
			$("#DownFilePwd_value").removeAttr("disabled");
			$("#DownFilePwd_value2").removeAttr("disabled");
		}).on("ifUnchecked", function (e) {
			$("#DownFilePwd_value").attr("disabled", true);
			$("#DownFilePwd_value2").attr("disabled", true);
		});
		$.ajax({
			url: "/bhost/get_pwdstrategy",
			type: "POST",
			async: false,
			data: { a0: se },
			success: function (result) {
				var pwdstrategy_result = JSON.parse(result);
				if (pwdstrategy_result.Result == true) {
					var pwdstrategy_data = pwdstrategy_result.info;
					//长度
					$("#PwdMinLen").val(pwdstrategy_data.PwdMinLen);
					$("#PwdUseExpire").val(pwdstrategy_data.PwdUseExpire);
					$("#PwdUseExpireNotify").val(pwdstrategy_data.PwdUseExpireNotify);
					//密码使用期限：
					if (pwdstrategy_data.IfPwdUseExpire) {
						$("#IfPwdUseExpire").iCheck('check');
						$("#PwdUseExpire").removeAttr("disabled");
						$("#PwdUseExpireNotify").removeAttr("disabled");

					} else {
						$("#IfPwdUseExpire").iCheck('uncheck');
						$("#PwdUseExpire").attr("disabled", true);
						$("#PwdUseExpireNotify").attr("disabled", true);
					}
					//大写
					if (pwdstrategy_data.IfPwdIncUpperApha) {
						$("#IfPwdIncUpperApha").iCheck('check');
					} else {
						$("#IfPwdIncUpperApha").iCheck('uncheck');
					}
					//小写
					if (pwdstrategy_data.IfPwdIncLowerApha) {
						$("#IfPwdIncLowerApha").iCheck('check');
					} else {
						$("#IfPwdIncLowerApha").iCheck('uncheck');
					}
					//数字
					if (pwdstrategy_data.IfPwdIncNumber) {
						$("#IfPwdIncNumber").iCheck('check');
					} else {
						$("#IfPwdIncNumber").iCheck('uncheck');
					}
					//特殊字符
					if (pwdstrategy_data.IfPwdIncSpecialChar) {
						$("#IfPwdIncSpecialChar").iCheck('check');
					} else {
						$("#IfPwdIncSpecialChar").iCheck('uncheck');
					}
					//密码复杂度要求：
					if (pwdstrategy_data.IfPwdComplex) {
						$("#IfPwdComplex").iCheck('check');
						$("#IfPwdIncUpperApha").removeAttr("disabled");
						$("#IfPwdIncLowerApha").removeAttr("disabled");
						$("#IfPwdIncNumber").removeAttr("disabled");
						$("#IfPwdIncSpecialChar").removeAttr("disabled");
						$('#IfPwdIncUpperApha,#IfPwdIncLowerApha,#IfPwdIncNumber,#IfPwdIncSpecialChar').iCheck({
							checkboxClass: 'icheckbox_minimal-blue',
							radioClass: 'iradio_minimal-blue',
							increaseArea: '0' // optional
						});
					} else {
						$("#IfPwdComplex").iCheck('uncheck');
						$("#IfPwdIncUpperApha").attr("disabled", true);
						$("#IfPwdIncLowerApha").attr("disabled", true);
						$("#IfPwdIncNumber").attr("disabled", true);
						$("#IfPwdIncSpecialChar").attr("disabled", true);
						$('#IfPwdIncUpperApha,#IfPwdIncLowerApha,#IfPwdIncNumber,#IfPwdIncSpecialChar').iCheck({
							checkboxClass: 'icheckbox_minimal-blue',
							radioClass: 'iradio_minimal-blue',
							increaseArea: '0' // optional
						});
					}
					$("#PwdUnRepeat").val(pwdstrategy_data.PwdUnRepeat);
					//密码安全策略：
					if (pwdstrategy_data.IfPwdUnRepeat) {
						$("#IfPwdUnRepeat").iCheck('check');
						$("#PwdUnRepeat").removeAttr("disabled");
					} else {
						$("#IfPwdUnRepeat").iCheck('uncheck');
						$("#PwdUnRepeat").attr("disabled", true);
					}
					$("#PwdErrorLockExpire").val(pwdstrategy_data.PwdErrorLockExpire);
					$("#PwdErrorLockNumber").val(pwdstrategy_data.PwdErrorLockNumber);
					//账户锁定策略：
					if (pwdstrategy_data.IfPwdErrorLock) {
						$("#IfPwdErrorLock").iCheck('check');
						$("#PwdErrorLockExpire").removeAttr("disabled");
						$("#PwdErrorLockNumber").removeAttr("disabled");
					} else {
						$("#IfPwdErrorLock").iCheck('uncheck');
						$("#PwdErrorLockExpire").attr("disabled", true);
						$("#PwdErrorLockNumber").attr("disabled", true);
					}
					$("#AccountAutoUnLock").val(pwdstrategy_data.AccountAutoUnLock);
					//账户自动解锁：
					if (pwdstrategy_data.IfAccountAutoUnLock) {
						$("#IfAccountAutoUnLock").iCheck('check');
						$("#AccountAutoUnLock").removeAttr("disabled");
					} else {
						$("#IfAccountAutoUnLock").iCheck('uncheck');
						$("#AccountAutoUnLock").attr("disabled", true);
					}
					//登录验证码：
					if (pwdstrategy_data.IfNeedCode) {
						$("#IfNeedCode").iCheck('check');
					} else {
						$("#IfNeedCode").iCheck('uncheck');
					}

				} else {
					_alert(1, "全局策略", "执行失败：" + pwdstrategy_data.ErrMsg);
				}
			}
		});
		$.ajax({
			url: "/bhost/get_encodepwd",
			type: "POST",
			async: false,
			data: { a0: se, t1: 1 },
			success: function (result) {
				var result = JSON.parse(result);
				if (result.Result) {
					if (!result.ifopen) {
						DownFilePwd_old = result.ifopen;
						$('#DownFilePwd').iCheck('uncheck');
						$('#DownFilePwd_value').val('');
						$('#DownFilePwd_value').attr("disabled", true);
						$('#DownFilePwd_value2').val('');
						$('#DownFilePwd_value2').attr("disabled", true);
					} else {
						DownFilePwd_old = result.ifopen;
						$('#DownFilePwd').iCheck('check');
						// $('#DownFilePwd_value').val(result.info);
						$('#DownFilePwd_value').removeAttr("disabled");
						// $('#DownFilePwd_value2').val(result.info);
						$('#DownFilePwd_value2').removeAttr("disabled");
					}
				}

			}
		});
	});
	//检查数字范围
	function dataCheck(obj, min, max) {
		obj.value = obj.value.replace(/\D/g, "");
		if (min) {
			if (parseInt(obj.value, 10) < parseInt(min, 10)) obj.value = min;
		}
		if (max) {
			if (parseInt(obj.value, 10) > parseInt(max, 10)) obj.value = max;
		}
	}
	//检查数字范围
	function dataCheck1(obj, min, max) {
		obj.value = obj.value.replace(/\D/g, "");
	}
	//pwdstrategy_update
	function pwdstrategy_update() {
		//长度
		var pass = 1;
		var PwdMinLen = $("#PwdMinLen").val();
		if (PwdMinLen == "") {
			_alert(2, "全局策略", "请输入密码最小长度", $("#PwdMinLen"));
			$("#PwdMinLen").val('6');
			return false;
		} else if (parseInt(PwdMinLen) > 32) {
			//_alert(1,"用户设置","密码最小长度不符合要求");
			$("#PwdMinLen").val('32');
			PwdMinLen = 32;
		} else if (parseInt(PwdMinLen) < 6) {
			//_alert(1,"用户设置","密码最小长度不符合要求");
			$("#PwdMinLen").val('6');
			PwdMinLen = 6;
		}
		if ($('#IfPwdComplex').is(':checked')) {
			var i = 0;
			if ($('#IfPwdIncUpperApha').is(':checked')) i++;
			if ($('#IfPwdIncLowerApha').is(':checked')) i++;
			if ($('#IfPwdIncNumber').is(':checked')) i++;
			if ($('#IfPwdIncSpecialChar').is(':checked')) i++;
			if (i == 0) {
				_alert(2, '全局策略', '请选择密码复杂度选项');
				return false;
			}
		}
		var PwdUseExpire = $("#PwdUseExpire").val();
		if (PwdUseExpire == "") {
			if ($("#IfPwdUseExpire").is(':checked')) {
				_alert(2, "全局策略", "请输入天数", $("#PwdUseExpire"));
				$("#PwdUseExpire").val('100');
				return false;
			} else {
				$("#PwdUseExpire").val('100');
				PwdUseExpire = 100;
			}
		}
		var PwdUseExpireNotify = $("#PwdUseExpireNotify").val();
		if (PwdUseExpireNotify == "") {
			if ($("#IfPwdUseExpire").is(':checked')) {
				_alert(2, "全局策略", "请输入提醒天数", $("#PwdUseExpireNotify"));
				$("#PwdUseExpireNotify").val('0');
				return false;
			} else {
				$("#PwdUseExpireNotify").val('0');
				PwdUseExpireNotify = 0;
			}

		}
		if (parseInt(PwdUseExpireNotify) > parseInt(PwdUseExpire)) {
			_alert(1, "全局策略", "过期自动提醒时间不能大于总时间");
			$("#PwdUseExpireNotify").val('0');
			$("#PwdUseExpire").val('100');
			return false;
		}
		var PwdUnRepeat = $("#PwdUnRepeat").val();
		if (PwdUnRepeat == "") {
			if ($('#IfPwdUnRepeat').is(':checked')) {
				_alert(2, "全局策略", "请输入重复次数", $("#PwdUnRepeat"));
				$("#PwdUnRepeat").val('3');
				return false;
			} else {
				$("#PwdUnRepeat").val('3');
				PwdUnRepeat = 3;
			}

		}
		var PwdErrorLockExpire = $("#PwdErrorLockExpire").val();
		if (PwdErrorLockExpire == "") {
			if ($("#IfPwdErrorLock").is(":checked")) {
				_alert(2, "全局策略", "请输入限制时间", $("#PwdErrorLockExpire"));
				$("#PwdErrorLockExpire").val('5');
				return false;
			} else {
				$("#PwdErrorLockExpire").val('5');
				PwdErrorLockExpire = 5;
			}

		}
		var PwdErrorLockNumber = $("#PwdErrorLockNumber").val();
		if (PwdErrorLockNumber == "") {
			if ($("#IfPwdErrorLock").is(":checked")) {
				_alert(2, "全局策略", "请输入输错次数", $("#PwdErrorLockNumber"));
				$("#PwdErrorLockNumber").val('5');
				return false;
			} else {
				$("#PwdErrorLockNumber").val('5');
				PwdErrorLockNumber = 5;
			}

		}
		var AccountAutoUnLock = $('#AccountAutoUnLock').val();
		if (AccountAutoUnLock == "") {
			if ($('#IfAccountAutoUnLock').is(':checked')) {
				_alert(2, "全局策略", "请输入时间", $('#AccountAutoUnLock'));
				$('#AccountAutoUnLock').val('10');
				return false;
			} else {
				$('#AccountAutoUnLock').val('10');
				AccountAutoUnLock = 10;
			}

		}

		if (parseInt(AccountAutoUnLock) > 120) {
			$("#AccountAutoUnLock").val('120');
			AccountAutoUnLock = 120;
		}
		if (parseInt(AccountAutoUnLock) < 10) {
			$("#AccountAutoUnLock").val('10');
			AccountAutoUnLock = 10;
		}
		//密码使用期限：
		var IfPwdUseExpire = $("#IfPwdUseExpire").is(':checked');
		//密码复杂度要求：
		var IfPwdComplex = $("#IfPwdComplex").is(':checked');
		var IfPwdIncUpperApha = $("#IfPwdIncUpperApha").is(':checked');
		var IfPwdIncLowerApha = $("#IfPwdIncLowerApha").is(':checked');
		var IfPwdIncNumber = $("#IfPwdIncNumber").is(':checked');
		var IfPwdIncSpecialChar = $("#IfPwdIncSpecialChar").is(':checked');

		//密码安全策略：
		var IfPwdUnRepeat = $("#IfPwdUnRepeat").is(':checked');
		//账户锁定策略：
		var IfPwdErrorLock = $("#IfPwdErrorLock").is(':checked');
		//账户自动解锁：
		var IfAccountAutoUnLock = $("#IfAccountAutoUnLock").is(':checked');
		//登录验证码：
		var IfNeedCode = $("#IfNeedCode").is(':checked');
		if ($("#DownFilePwd").is(':checked')) {
			var ifopen = 1;
			var DownFilePwd = $('#DownFilePwd_value').val();
			var DownFilePwd2 = $('#DownFilePwd_value2').val();
			if (DownFilePwd == '' && !DownFilePwd_old) {
				_alert(2, "全局策略", "加密密码不能为空", $('#DownFilePwd_value'));
				return false;
			}
			if (DownFilePwd != DownFilePwd2) {
				_alert(2, "全局策略", "两次密码不相同", $('#DownFilePwd_value2'));
				return false;
			}
		} else {
			var ifopen = 0;
			var DownFilePwd = '';
		}

		pwdstrategy.PwdMinLen = parseInt(PwdMinLen);
		pwdstrategy.IfPwdUseExpire = IfPwdUseExpire;
		pwdstrategy.PwdUseExpire = parseInt(PwdUseExpire);
		pwdstrategy.PwdUseExpireNotify = parseInt(PwdUseExpireNotify);
		pwdstrategy.IfPwdComplex = IfPwdComplex;
		pwdstrategy.IfPwdIncUpperApha = IfPwdIncUpperApha;
		pwdstrategy.IfPwdIncLowerApha = IfPwdIncLowerApha;
		pwdstrategy.IfPwdIncNumber = IfPwdIncNumber;
		pwdstrategy.IfPwdIncSpecialChar = IfPwdIncSpecialChar;
		pwdstrategy.IfPwdUnRepeat = IfPwdUnRepeat;
		pwdstrategy.PwdUnRepeat = parseInt(PwdUnRepeat);
		pwdstrategy.IfPwdErrorLock = IfPwdErrorLock;
		pwdstrategy.PwdErrorLockExpire = parseInt(PwdErrorLockExpire);
		pwdstrategy.PwdErrorLockNumber = parseInt(PwdErrorLockNumber);
		pwdstrategy.IfAccountAutoUnLock = IfAccountAutoUnLock;
		pwdstrategy.AccountAutoUnLock = parseInt(AccountAutoUnLock);
		pwdstrategy.IfNeedCode = IfNeedCode;
		var pass = true;
		$.ajax({
			url: '/bhost/encodepwd',
			type: "POST",
			async: false,
			data: { a0: se, p1: DownFilePwd, t1: 1, i1: ifopen },
			success: function (result) {
				var result = JSON.parse(result);
				if (result.Result) {
					pass = true;
				} else {
					_alert(1, "全局策略", result.ErrMsg);
					pass = false;
				}
			}
		});
		// pwdstrategy.DownFilePwd=DownFilePwd;
		return pass;
		/*
		$.ajax({
			url: '/bhost/add_pwdstrategy',
			type: "POST",
			async:false,
			data: {a0:se,a1:JSON.stringify(pwdstrategy)},
			success: function(result) {
				var result = JSON.parse(result);
				if(result.Result == true){
					
				}else{
					_alert(1,"用户设置",result.ErrMsg);
					pass=0;
					return false;
				}
			}
		});
		*/
		/*
		if(pass==1){
			$('.btn').blur();parent.layer.open({
				type:1,
				title: '用户设置',
				content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
				btn:['确&nbsp;&nbsp;定'],
				btnAlign:'c',
				closeBtn: false,
				skin:'layer-custom',
				area:['380px','310px'],
				move: false,
				resize: false,
				yes:function(i){
					parent.layer.close(i);
				}
			});	
		}
		*/
	}

</script>
