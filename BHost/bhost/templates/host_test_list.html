<!DOCTYPE html>
<!--111-->
<html>

<head>
	<meta charset="UTF-8">
	<title>manager</title>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">

	<link rel="stylesheet" href="/manage/css/style.css">
	<!--script-->
	<script src="/manage/js/jquery.min.js"></script>
	<script src="/manage/js/jquery.easing.js"></script>
	<script src="/manage/js/layer.js"></script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/common_e.js"></script>

	<!--icheck-->
	<script src="/manage/js/icheck.min.js"></script>
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<!--select2-->
	<script src="/manage/js/select2.full.min.js"></script>
	<link rel="stylesheet" href="/manage/css/new-head.css">

</head>
<style>
	.filter-select2 + .select2-container--default >.selection > .select2-selection--single{
		border-bottom-left-radius: 0;
		border-top-left-radius: 0;
		margin-left: -1px;
	}
	.filter-select2 + .select2-container--default{
		display: none;
	}
	#importPage{
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: #f3f3f3;
		overflow: auto;
	}
	.apItem .label.succ:before{
		content: '';
		float: left;
		/*width: 8px;
		height: 4px;
		background-color: green;*/
		width: 20px;
		height:20px;
		margin: 3px 14px 0 14px;
		background: url(/manage/images/cmd_succ.png) no-repeat 0 0;
	}
	.apItem .label.fail:before{
		content: '';
		float: left;
		/*width: 8px;
		height: 4px;
		background-color: red;*/
		width: 20px;
		height:20px;
		margin: 3px 14px 0 14px;
		background: url(/manage/images/cmd_fail.png) no-repeat 0 0;
	}
</style>
<script>
	var perm={{perm}};
	if (perm==0) parent.$('#nav-s1 a.active').click();
</script>
<body style="overflow:hidden;" class="bg-white">
	<div class="rwrap" id="one">
		<div class="c-top">
			<div class="manual-head">
				<div class="manual-title title-item" style="color: rgb(121, 121, 121);background: rgb(222, 222, 222)">
					<span id="host_manage">主机管理</span>
					<i style="display: none;"></i>
				</div>
				<div class="manual-title-other title-item" id="frist">
					<span id="reload"> 连接测试</span>
					<i class="hosttest_icon"></i>
				</div>
				<div class="manual-title-other title-item" style="color: rgb(121, 121, 121);background: rgb(222, 222, 222)">
					<span id="find_host"> 发现主机</span>
					<i style="display: none;"></i>
				</div>
			</div>
		</div>
		<div class="mainer" name="host_test" id="host_test">
			<div class="container">
				<div class="c-cont">
					<div class="c-wrap">
						<div class="c-table r-list">
							<div class="tab-t">
								<div class="ctr">
									<a id="host_test_1" href="javascript:;" class="btn btn-default" onclick="host_test_add();">创建</a>
									<a id="host_test_2" href="javascript:;" class="btn btn-default" onclick="delete_list();">删除</a>
									<a id="host_test_3" href="javascript:;" class="btn btn-default" onclick="click_all_list();">全选</a>
									<a id="host_test_4" href="javascript:;" class="btn btn-default" onclick="host_test_page(0);clear_all();">刷新</a>
								</div>
								<script>
									if(perm==1){
										$('#host_test_1').remove();
										$('#host_test_2').remove();
										$('#host_test_3').remove();
									}
								</script>
								<div class="filter">
									<div class="search">
										<select name="host_test_select" id="host_test_select" class="filter-select">
											<option value="all" selected>所有</option>
											<option value="Name">名称</option>
											<option value="Period">周期</option>
											<option value="Execution">立即执行</option>
											<option value="Status">执行结果</option>
											<option value="Enabled">状态</option>
										</select>

										<input type="text" style="/*display:none;*/padding-right: 22px;"
										class="filter-text" placeholder="输入关键字" name="host_test_text"
										id="host_test_text" maxlength="128"
										onchange="if($('#host_test_text').val()==''){$('#host_test_text_check').hide();}else{$('#host_test_text_check').show();}"
										onkeyup="if($('#host_test_text').val()==''){$('#host_test_text_check').hide();}else{$('#host_test_text_check').show();}"
										onblur="if($('#host_test_text').val()=='' && search_typeall_new!=''){search_typeall_new='';_addFilter(this,false,1);}"
										onkeydown="if($('#host_test_text').val()==''){$('#host_test_text_check').hide();}else{$('#host_test_text_check').show();}; if (event.keyCode == 13){_addFilter(this,false);return false;} else return; ">
										<i class="v-check v-wrong" id="host_test_text_check"
										onclick="_clearFilter(this,1)"
										style="display:none;cursor: pointer;float: left;position: static;"></i>
										<select name="PeriodType" id="PeriodType" style="width: 60px;" class="filter-select filter-select2">
											<option value="1" selected>天</option>
											<option value="2">分钟</option>
										</select>
										<select name="Enabled" id="Enabled" style="width: 60px;" class="filter-select filter-select2">
											<option value="true" selected>启用</option>
											<option value="false">停用</option>
										</select>
										<select name="Execution" id="Execution" style="width: 60px;" class="filter-select filter-select2">
											<option value="true" selected>是</option>
											<option value="false">否</option>
										</select>
										<select name="Status" id="Status" style="" class="filter-select filter-select2">
											<option value="0" selected>未执行</option>
											<option value="1">正在执行</option>
											<option value="2">执行完成</option>
										</select>
										<button class="btn filter-btn" onclick="_addFilter(this,false);"><i class="add-filter"></i></button>
										<button class="btn filter-btn" onclick="_addFilter(this,true)"><i class="append-filter"></i></button>
									</div>
									<div class="search" id="clearFilter" style="margin: 0px 15px 0px -16px;display:none;">
										<button class="filter-btn" onclick="_clearFilter(this)"><i class="clear-filter"></i></button>
									</div>
									<div class="selector selector-multiple" id="filterWW" style="display:none;">
										<span class="ww">搜索条件</span>
										<ul>
										</ul>
									</div>
								</div>
							</div>
							<div class="box-table">
								<table cellpadding="0" cellspacing="0">
									<thead>
										<tr>
											<th width="50"><input type="checkbox" class="form-checkbox" id="check_one_page" /></th>
											<th>名称</th>
											<th width="150">开始时间</th>
											<th width="150">上次执行时间</th>
											<th>周期</th>
											<th>立即执行</th>
											<th>最新执行结果</th>
											<th style="width:30px;">状态</th>
											<th id="host_test_list_th" width="105"></th>
										</tr>
									</thead>
									<script>
										if(perm==1){
											$('#check_one_page').parent().hide();
											$('#host_test_list_th').attr('width','55');
										}
									</script>
									<tbody name="host_test_list" id="host_test_list">
									</tbody>
								</table>
							</div>
							<div class="tab-i">
								<div class="il">
									每页显示<span id="page_nums">10</span>条 总数：<span id="host_test_total">0</span><span> 选中：</span><span class="sum">0</span>
								</div>
								<script>
									if(perm==1){
										$('#host_test_total').next('span').remove();
										$('#host_test_total').next('span').remove();
									}
								</script>
								<div class="ipage">
									<a href="javascript:;" class="nav2 begin" id="host_test_begin" onclick="host_test_page(0.1);"><i></i></a>
									<a href="javascript:;" class="nav prev" id="host_test_prev" onclick="host_test_page(-1);"><i></i></a>
									<input type="text" id="host_test_page" value="1" onchange="showMsg();" onblur="showMsg();">/&nbsp;<span id="host_test_pages">1</span>
									<a href="javascript:;" class="nav next" id="host_test_next" onclick="host_test_page(1);"><i></i></a>
									<a href="javascript:;" class="nav2 end" id="host_test_end" onclick="host_test_page(0.9);"><i></i></a>
								</div>
							</div>
						</div>

						<div class="clearfix"></div>
						<!--
						<div class="btns">
							<a href="javascript:;" class="btn btn-normal" onclick="save_host_test();">返&nbsp;&nbsp;回</a>
						</div>
						-->
						<div id="bBtn" style="z-index: 5;position:fixed">
							<a href="javascript:;" class="btn" onclick="save_host_test();"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<div class="rwrap" id="two" style="display:none;">
		<div class="manual-head">
			<div class="manual-title">
				<span onclick="refresh_ConnectTask();"> 测试任务</span>
				<i class="htesttask_icon"></i>
			</div>
		</div>
		<div class="mainer" name="ConnectTask" id="ConnectTask">
			<div class="container">
				<div class="c-cont">
					<div class="c-wrap">
						<div class="c-table r-list">
							<div class="tab-t">
								<div class="ctr">
									<a href="javascript:;" class="btn btn-default" onclick="ConnectTask_page(0);ConnectTask_clear_all();">刷新</a>
								</div>
								<div class="filter">
									<div class="search">
										<select name="ConnectTask_select" id="ConnectTask_select" class="filter-select">
											<option value="all" selected>所有</option>
											<option value="Name">名称</option>
											<option value="Status">状态</option>
										</select>

										<input type="text" style="/*display:none;*/padding-right: 22px;"
										class="filter-text" placeholder="输入关键字"
										name="ConnectTask_text" id="ConnectTask_text"
										maxlength="128"
										onchange="if($('#ConnectTask_text').val()==''){$('#ConnectTask_text_check').hide();}else{$('#ConnectTask_text_check').show();}"
										onkeyup="if($('#ConnectTask_text').val()==''){$('#ConnectTask_text_check').hide();}else{$('#ConnectTask_text_check').show();}"
										onblur="if($('#ConnectTask_text').val()=='' && ConnectTasksearch_typeall_new!=''){ConnectTasksearch_typeall_new='';ConnectTask_addFilter(this,false,1);}"
										onkeydown="if($('#ConnectTask_text').val()==''){$('#ConnectTask_text_check').hide();}else{$('#ConnectTask_text_check').show();}; if (event.keyCode == 13){ConnectTask_addFilter(this,false);return false;} else return; ">
										<i class="v-check v-wrong" id="ConnectTask_text_check"
										onclick="ConnectTask_ConnectTaskclearFilter(this,1)"
										style="display:none;cursor: pointer;float: left;position: static;"></i>
										<select name="ConnectTask_Status" id="ConnectTask_Status" style="" class="filter-select filter-select2">
											<option value="0" selected>未执行</option>
											<option value="1">正在执行</option>
											<option value="2">执行完成</option>
										</select>
										<button class="btn filter-btn" onclick="ConnectTask_addFilter(this,false);"><i class="add-filter"></i></button>
										<button class="btn filter-btn" onclick="ConnectTask_addFilter(this,true)"><i class="append-filter"></i></button>
									</div>
									<div class="search" id="ConnectTaskclearFilter" style="margin: 0px 15px 0px -16px;display:none;">
										<button class="filter-btn" onclick="ConnectTask_ConnectTaskclearFilter(this)"><i class="clear-filter"></i></button>
									</div>
									<div class="selector selector-multiple" id="ConnectTaskfilterWW" style="display:none;">
										<span class="ww">搜索条件</span>
										<ul>
										</ul>
									</div>
								</div>
							</div>
							<div class="box-table">
								<table cellpadding="0" cellspacing="0">
									<thead>
										<tr>
											<th>计划名称</th>
											<th width="150">开始时间</th>
											<th width="150">结束时间</th>
											<th>总数</th>
											<th>成功总数</th>
											<th>登录失败</th>
											<th>连接失败</th>
											<th>状态</th>
											<th id="ConnectTask_list_th" width="55"></th>
										</tr>
									</thead>
									<script>
										if(perm==1){
											$('#ConnectTask_list_th').attr('width','25');
										}
									</script>
									<tbody name="ConnectTask_list" id="ConnectTask_list">
									</tbody>
								</table>
							</div>
							<div class="tab-i">
								<div class="il">
									每页显示<span id="ConnectTaskpage_nums">10</span>条 总数：<span id="ConnectTask_total">0</span>
								</div>

								<div class="ipage">
									<a href="javascript:;" class="nav2 begin" id="ConnectTask_begin" onclick="ConnectTask_page(0.1);"><i></i></a>
									<a href="javascript:;" class="nav prev" id="ConnectTask_prev" onclick="ConnectTask_page(-1);"><i></i></a>
									<input type="text" id="ConnectTask_page" value="1" onchange="ConnectTaskshowMsg();" onblur="ConnectTaskshowMsg();">/&nbsp;<span id="ConnectTask_pages">1</span>
									<a href="javascript:;" class="nav next" id="ConnectTask_next" onclick="ConnectTask_page(1);"><i></i></a>
									<a href="javascript:;" class="nav2 end" id="ConnectTask_end" onclick="ConnectTask_page(0.9);"><i></i></a>
								</div>
							</div>
						</div>

						<div class="clearfix"></div>
						<!--
						<div class="btns">
							<a href="javascript:;" class="btn btn-normal" onclick="save_ConnectTask();">返&nbsp;&nbsp;回</a>
						</div>
						-->
						<div id="bBtn" style="z-index: 5;    position: fixed;">
							<a href="javascript:;" class="btn" onclick="save_ConnectTask();"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<!--导入信息详情-->
	<div id="importPage" style="display: none;">
		<div class="ap-top" id="">
			<div class="ctrl">
				<a href="javascript:;" style="border-radius: 14px;" class="re" onclick="refresh_ConnectTaskDetails();"><i style="margin: 3px auto;margin-left: 8px;"></i></a>
				<!--<a href="javascript:;" class="close" onclick="save_ConnectTaskDetails()"><i></i></a>-->
			</div>
			<div class="types">
				<label><input type="checkbox" name="" id="fail_con_box" class="form-checkbox" >失败的测试</label>
			</div>
		</div>
		<div class="apWrap">
			<div class="title">
				<h2>测试详情</h2>
			</div>
			<div class="top">
				<div class="mm mm1">
					总数：<span class="span_s">11</span> 成功：<span class="span_s">11</span> 登录失败：<span class="span_s">11</span> 连接失败：<span class="span_s">11</span>
				</div>
			</div>
			<div class="clearfix"></div>
			<div id="apArea1" style="height:auto;">
				<div class="apSort"></div>
			</div>
			
			<div id="aploadTip1">正在加载</div>
		</div>
		<div id="bBtn" style="position: fixed;z-index:5;">
                	<a href="javascript:;" class="btn" style="float: right;" onclick="save_ConnectTaskDetails()"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
        	</div>
	</div>
	<div class="rwrap" id="three" style="display:none;">
		<div class="manual-head">
			<div class="manual-title">
				<span onclick="refresh_ConnectTaskDetails();">测试结果</span>
				<i class="htestresult_icon"></i>
			</div>
		</div>
		<div class="mainer" name="ConnectTaskDetails" id="ConnectTaskDetails">
			<div class="container">
				<div class="c-cont">
					<div class="c-wrap">
						<div class="c-table r-list">
							<div class="tab-t">
								<div class="ctr">
									<a href="javascript:;" class="btn btn-default" onclick="ConnectTaskDetails_click_all_list();">全选</a>
									<a href="javascript:;" class="btn btn-default" onclick="down_all(0);">下载</a>
									<a href="javascript:;" class="btn btn-default" onclick="ConnectTaskDetails_page(0);ConnectTaskDetails_clear_all();">刷新</a>
								</div>
								<div class="filter">
									<div class="search">
										<select name="ConnectTaskDetails_select" id="ConnectTaskDetails_select" class="filter-select">
											<option value="all" selected>所有</option>
											<option value="hostip">主机IP</option>
											<option value="hostname">主机名</option>
											<option value="protocolname">协议</option>
											<option value="accountname">账号</option>
											<option value="Status">状态</option>
										</select>

										<input type="text" style="/*display:none;*/padding-right: 22px;" 
										class="filter-text" placeholder="输入关键字" 
										name="ConnectTaskDetails_text" id="ConnectTaskDetails_text"
										maxlength="128" 
										onchange="if($('#ConnectTaskDetails_text').val()==''){$('#ConnectTaskDetails_text_check').hide();}else{$('#ConnectTaskDetails_text_check').show();}"
										onkeyup="if($('#ConnectTaskDetails_text').val()==''){$('#ConnectTaskDetails_text_check').hide();}else{$('#ConnectTaskDetails_text_check').show();}"
										onblur="if($('#ConnectTaskDetails_text').val()=='' && ConnectTaskDetailssearch_typeall_new!=''){ConnectTaskDetailssearch_typeall_new='';ConnectTaskDetails_addFilter(this,false,1);}"
										onkeydown="if($('#ConnectTaskDetails_text').val()==''){$('#ConnectTaskDetails_text_check').hide();}else{$('#ConnectTaskDetails_text_check').show();}; if (event.keyCode == 13){ConnectTaskDetails_addFilter(this,false);return false;} else return; ">
										<i class="v-check v-wrong" id="ConnectTaskDetails_text_check" 
										onclick="ConnectTaskDetails_ConnectTaskDetailsclearFilter(this,1)" 
										style="display:none;cursor: pointer;float: left;position: static;"></i>
										<select name="ConnectTaskDetails_Status" id="ConnectTaskDetails_Status" style="" class="filter-select filter-select2">
											<option value="0" selected>未执行</option>
											<option value="1">正在执行</option>
											<option value="2">测试成功</option>
											<option value="3">连接失败</option>
											<option value="4">登录失败</option>
										</select>
										<button class="btn filter-btn" onclick="ConnectTaskDetails_addFilter(this,false);"><i class="add-filter"></i></button>
										<button class="btn filter-btn" onclick="ConnectTaskDetails_addFilter(this,true)"><i class="append-filter"></i></button>
									</div>
									<div class="search" id="ConnectTaskDetailsclearFilter" style="margin: 0px 15px 0px -16px;display:none;">
										<button class="filter-btn" onclick="ConnectTaskDetails_ConnectTaskDetailsclearFilter(this)"><i class="clear-filter"></i></button>
									</div>
									<div class="selector selector-multiple" id="ConnectTaskDetailsfilterWW" style="display:none;">
										<span class="ww">搜索条件</span>
										<ul>
										</ul>
									</div>
								</div>
							</div>
							<div class="box-table">
								<table cellpadding="0" cellspacing="0">
									<thead>
										<tr>
											<th width="50"><input type="checkbox" class="form-checkbox" id="ConnectTaskDetails_check_one_page" /></th>
											<th style="width:150px;">开始时间</th>
											<th style="width:150px;">结束时间</th>
											<th style='width:110px;'>主机IP</th>
											<th>主机名</th>
											<th>协议</th>
											<th>端口</th>
											<th>账号</th>
											<th>状态</th>
											<th style="width:25px;"></th>
										</tr>
									</thead>

									<tbody name="ConnectTaskDetails_list" id="ConnectTaskDetails_list">
									</tbody>
								</table>
							</div>
							<div class="tab-i">
								<div class="il">
									每页显示<span id="ConnectTaskDetailspage_nums">10</span>条 总数：<span id="ConnectTaskDetails_total">0</span><span>  选中：</span><span class="sum">0</span>
								</div>

								<div class="ipage">
									<a href="javascript:;" class="nav2 begin" id="ConnectTaskDetails_begin" onclick="ConnectTaskDetails_page(0.1);"><i></i></a>
									<a href="javascript:;" class="nav prev" id="ConnectTaskDetails_prev" onclick="ConnectTaskDetails_page(-1);"><i></i></a>
									<input type="text" id="ConnectTaskDetails_page" value="1" onchange="ConnectTaskDetailsshowMsg();" onblur="ConnectTaskDetailsshowMsg();">/&nbsp;<span id="ConnectTaskDetails_pages">1</span>
									<a href="javascript:;" class="nav next" id="ConnectTaskDetails_next" onclick="ConnectTaskDetails_page(1);"><i></i></a>
									<a href="javascript:;" class="nav2 end" id="ConnectTaskDetails_end" onclick="ConnectTaskDetails_page(0.9);"><i></i></a>
								</div>
							</div>
						</div>

						<div class="clearfix"></div>
						<!--
						<div class="btns">
							<a href="javascript:;" class="btn btn-normal" onclick="save_ConnectTaskDetails();">返&nbsp;&nbsp;回</a>
						</div>
						-->
						<div id="bBtn" style="z-index: 5;position:fixed">
							<a href="javascript:;" class="btn" onclick="save_ConnectTaskDetails();"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<form action="/bhost/get_host_test_list" method="POST" name="frm_host_test" id="frm_host_test">
		<input type="hidden" name="tasktype" id="tasktype" value="{{tasktype}}" />
		<!--创建 编辑 列表-->
		<input type="hidden" name="a" id="a" value="{{a}}" />
		<!--需要查询id-->
		<input type="hidden" name="c" id="c" value="{{c}}" /
		<!--页码-->
		<input type="hidden" name="d" id="d" value="{{d}}" />
		<!--search_typeall-->
		<input type="hidden" name="e" id="e" value="{{e}}" />
		<!--search_typeall_new-->
		<input type="hidden" name="se" id="se" value="{{se}}" />

	</form>
	<style>
		.c-table {
			min-width:1177px;
		}
	</style>
	<script>
		$('.form-checkbox,.form-radio').iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		});
		$('#host_test_select').parents('div.search').hide();
		$('.filter-select').select2({ minimumResultsForSearch: -1 });
		$('#host_test_select').on('change',function () {
			var host_test_select=$('#host_test_select').val();
			switch (host_test_select) {
				case 'Period':
					$('#PeriodType').next('.select2').show();
					$('#host_test_text').val('');
					$('#host_test_text_check').hide();
					$('#host_test_text').show();
					$('#host_test_text').css('width','72px');
					$('#Enabled').next('.select2').hide();
					$('#Execution').next('.select2').hide();
					$('#Status').next('.select2').hide();
					break;
				case 'Execution':
					$('#PeriodType').next('.select2').hide();
					$('#host_test_text').hide();
					$('#Enabled').next('.select2').hide();
					$('#Execution').next('.select2').show();
					$('#Status').next('.select2').hide();
					break;
				case 'Status':
					$('#PeriodType').next('.select2').hide();
					$('#host_test_text').hide();
					$('#Enabled').next('.select2').hide();
					$('#Execution').next('.select2').hide();
					$('#Status').next('.select2').show();
					break;
				case 'Enabled':
					$('#PeriodType').next('.select2').hide();
					$('#host_test_text').hide();
					$('#Enabled').next('.select2').show();
					$('#Execution').next('.select2').hide();
					$('#Status').next('.select2').hide();
					break;
				default:
					$('#PeriodType').next('.select2').hide();
					$('#host_test_text').show();
					$('#host_test_text').css('width','8em');
					$('#Enabled').next('.select2').hide();
					$('#Execution').next('.select2').hide();
					$('#Status').next('.select2').hide();
					break;
			}
		});
		$('#host_test_select').val('all').trigger('change');
		$('#host_test_select').parents('div.search').show();
		//-任务
		$('#ConnectTask_select').on('change',function () {
			var ConnectTask_select=$('#ConnectTask_select').val();
			switch (ConnectTask_select) {
				case 'Status':
					$('#ConnectTask_text').hide();
					$('#ConnectTask_Status').next('.select2').show();
					break;
				default:
					$('#ConnectTask_text').show();
					$('#ConnectTask_text').css('width','8em');
					$('#ConnectTask_Status').next('.select2').hide();
					break;
			}
		});
		$('#ConnectTask_select').val('all').trigger('change');
		//详情
		$('#ConnectTaskDetails_select').on('change',function () {
			var ConnectTaskDetails_select=$('#ConnectTaskDetails_select').val();
			switch (ConnectTaskDetails_select) {
				case 'Status':
					$('#ConnectTaskDetails_text').hide();
					$('#ConnectTaskDetails_Status').next('.select2').show();
					break;
				default:
					$('#ConnectTaskDetails_text').show();
					$('#ConnectTaskDetails_text').css('width','8em');
					$('#ConnectTaskDetails_Status').next('.select2').hide();
					break;
			}
		});
		$('#ConnectTaskDetails_select').val('all').trigger('change');
	</script>

	<script type="text/javascript">
		var delect_str = new Array();
		var check_num = 0;
		var total_all_r = 0;
		//总数
		var fenye_r = 0;
		var host_test_array = null;
		//总页码
		var search_typeall_r = document.frm_host_test.d.value;
		//关键字
		function save_host_test() {
			document.frm_host_test.tasktype.value = 3;
			document.frm_host_test.action = '/bhost/index';
			document.frm_host_test.submit();
		}
		$('#allPage').scroll(function() {
			var wh = $('#allPage').height(),
				vh = $('#apArea').height(),
				st = $('#allPage').scrollTop();

			if (wh + st >= vh) {
				_addData();
			}
		})

		$('#importPage').scroll(function() {
			var wh = $('#importPage').height(),
				vh = $('#apArea1').height(),
				st = $('#importPage').scrollTop();

			if (wh + st >= vh) {
				_addData1(0);
			}
		})
		$(function () {
			$('#fail_con_box').on('ifChecked',function(){
				$('#apArea1').empty();
				page=0;
				get_conn_taskdetails_search='Status-34\t';
				_initLoadData1();
			}).on('ifUnchecked',function(){
				$('#apArea1').empty();
				page=0;
				get_conn_taskdetails_search='';
				_initLoadData1();
			});
			//主机管理(页面顶部) onclick事件处理函数
			$("#host_manage").on("click", function () {
				document.frm_host_test.tasktype.value = 1;

				document.frm_host_test.action = '/bhost/host_manage';
				document.frm_host_test.submit();
			});
			
			//警告(页面顶部) onclick事件处理函数
			$("#reload").on("click", function () {
				//重新载入当前页面
				document.frm_host_test.tasktype.value = 3;
				document.frm_host_test.action = '/bhost/host_test_trust';
				document.frm_host_test.c.value = 1;
				document.frm_host_test.d.value = '';
				document.frm_host_test.e.value = ':';
				document.frm_host_test.submit();
			});
			//发现主机(页面顶部) onclick事件处理函数
			$("#find_host").on("click", function () {
				document.frm_host_test.tasktype.value = 1;
				document.frm_host_test.action = '/bhost/f_host_show';
				document.frm_host_test.submit();
			});
			document.frm_host_test.se.value = window.parent.document.frm.se.value;
			if (search_typeall_r != "") {
				var v1 = "";
				var id = "";
				var str_new = "";
				var search_typeall_str = search_typeall_r.split('\t');
				//////console.log(search_typeall_str);
				$.each(search_typeall_str, function (i, item) {
					if (item == "") {
						return false;
					}
					var index_item=item.indexOf('-');
					var str_sea=new Array();
					str_sea[0] = item.substring(0,index_item);
					str_sea[1]=item.substring(index_item+1);
					v1 = $('#host_test_select').find('option[value=' + str_sea[0] + ']').text();
					//////console.log('v1' + v1);
					id=item;
					switch (str_sea[0]) {
						case 'Execution':
						case 'Status':
						case 'Enabled':
						case 'Period':
							$('#host_test_select option[value='+str_sea[0]+']').remove();
							break;
					}
					str_sea[0] = v1;
					str_new = str_sea.join('-');
					//////console.log("str_new" + str_new + "---id" + id);
					$('#filterWW>ul').append('<li><span style = "display:none">' + id + '</span><span class="ww">' + str_new + '</span><i class="del" onclick="_delFilter(this);"></i></li>');
					selView();
				});
			}
			var search_typeall_select=document.frm_host_test.e.value.substr(document.frm_host_test.e.value.indexOf(':')+1,document.frm_host_test.e.value.length-1);
			if(search_typeall_select!=''){
				var array=new Array();
				array[0]=search_typeall_select.substr(0,search_typeall_select.indexOf('-'));
				array[1]=search_typeall_select.substr(search_typeall_select.indexOf('-')+1,search_typeall_select.length);
				//////console.log(array);
				$('#host_test_select').val(array[0]).trigger('change');
				switch (array[0]) {
					case 'Period':
						var value_array=array[1].split('\t');
						$('#host_test_text').val(value_array[0]).trigger('change');
						$('#PeriodType').val(value_array[1]).trigger('change');
						break;
					case 'Execution':
					case 'Status':
					case 'Enabled':
						$('#'+array[0]).val(array[1]).trigger('change');
						break;
					default:
						$('#host_test_text').val(array[1]).trigger('change');
						break;
				}
			}
			//输入数字
			$("#host_test_page").bind('keydown', function (e) {
				DigitInput(e);
			});
			//页码显示
			$("#page_nums").val(MAX_PAGE);
			//list show
			show_host_test_list();
			parent._switchBtn(1);//显示按钮
			//tr双击事件
			$("#host_test_list").on('dblclick', 'tr', function (e) {
				x = e.target;
				var id = $(this).find("td");
				if (x.nodeName != 'A' && x.nodeName != 'INS') {
					if (id.find('a[id=edit]').length==0){
						return false;
					}
					var id = $(this).find("td");
					var edit_item = $(id).eq(1).text();
					document.frm_host_test.a.value = edit_item;
					document.frm_host_test.tasktype.value = 2;
					document.frm_host_test.d.value = search_typeall_r;
					var select_id=$('#host_test_select').val();
					var select_value=null;
					switch (select_id) {
						case 'Period':
							select_value=$('#host_test_text').val()+'\t'+$('#PeriodType').val();
							break;
						case 'Execution':
							select_value=$('#Execution').val();
							break;
						case 'Status':
							select_value=$('#Status').val();
							break;
						case 'Enabled':
							select_value=$('#Enabled').val();
							break;
						default:
							select_value=$('#host_test_text').val();
							break;
					}
					document.frm_host_test.e.value = search_typeall_new+":"+select_id+'-'+select_value;
					document.frm_host_test.action = '/bhost/host_test_trust';
					document.frm_host_test.submit();
				}
			}).on("click", "tr", function (e) {
				x = e.target;
				//删除按钮
				if (x.id == 'del') {
					var id = $(this).find("td");
					var input = $(this).find("input");
					$('.btn').blur(); parent.layer.open({
						type: 1,
						title: '连接测试',
						content: '<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
						btn: ['删&nbsp;&nbsp;除', '取&nbsp;&nbsp;消'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						yes: function (i) {
							parent.layer.close(i);
							var delete_item = $(id).eq(1).text();
							// $(input).iCheck('uncheck');
							delete_fun(delete_item+'\t'+$(id).eq(2).text());
						}
					});
				}
				//编辑按钮
				if (x.id == 'edit') {
					var id = $(this).find("td");
					var edit_item = $(id).eq(1).text();
					document.frm_host_test.a.value = edit_item;
					document.frm_host_test.tasktype.value = 2;
					document.frm_host_test.d.value = search_typeall_r;
					var select_id=$('#host_test_select').val();
					var select_value=null;
					switch (select_id) {
						case 'Period':
							select_value=$('#host_test_text').val()+'\t'+$('#PeriodType').val();
							break;
						case 'Execution':
							select_value=$('#Execution').val();
							break;
						case 'Status':
							select_value=$('#Status').val();
							break;
						case 'Enabled':
							select_value=$('#Enabled').val();
							break;
						default:
							select_value=$('#host_test_text').val();
							break;
					}
					document.frm_host_test.e.value = search_typeall_new+":"+select_id+'-'+select_value;
					document.frm_host_test.action = '/bhost/host_test_trust';
					document.frm_host_test.submit();
				}
				//任务按钮
				if (x.id == 'icon7') {
					var id = $(this).find("td");
					ConnectTaskId = $(id).eq(1).text();
					ConnectTasksearch_typeall_r = '';
					ConnectTasksearch_typeall_new='';
					ConnectTaskpaging=1;
					$('#one').hide();
					$('#two').show();
					$('#three').hide();
					$('#importPage').hide();
					$('#ConnectTaskfilterWW ul').empty();
					ConnectTaskselView();
					if($('#ConnectTask_select option[value=Status]').length==0){
						$('#ConnectTask_select').append('<option value="Status">状态</option>');
					}
					$('#ConnectTask_text').val('');
					$('#ConnectTask_text_check').hide();
					$('#ConnectTask_select').val('all').trigger('change');
					$(this).trigger('click');
					//list show
					show_ConnectTask_list();
				}
				//停用
				if (x.id == 'stop_icon') {
					var id = $(this).find("td");
					var plan_id = $(id).eq(1).text();
					$.ajax({
						url: "/bhost/stop_connectplan",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val(), a1: plan_id,a2: $(id).eq(2).text() },
						success: function (result) {
							var result=JSON.parse(result);
							if(result.Result){
								if(result.info){
									host_test_page(0);
								}else{
									_alert(1,'连接测试','停用失败');
									return false;
								}
							}else{
								_alert(1,'连接测试',result.ErrMsg);
								return false;
							}
						}
					});
				}
				//启用
				if (x.id == 'start_icon') {
					var id = $(this).find("td");
					var plan_id = $(id).eq(1).text();
					$.ajax({
						url: "/bhost/start_connectplan",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val(), a1: plan_id,a2: $(id).eq(2).text() },
						success: function (result) {
							var result=JSON.parse(result);
							if(result.Result){
								if(result.info){
									host_test_page(0);
								}else{
									_alert(1,'连接测试','启用失败');
									return false;
								}
							}else{
								_alert(1,'连接测试',result.ErrMsg);
								return false;
							}
						}
					});
				}
			});
			$('#check_one_page').on(' ifClicked', function (e) {
				if (!$('#check_one_page').is(':checked')) {
					$("#host_test_list tr").children("td.in").children("div").children("input").iCheck('check');
				} else {
					$("#host_test_list tr").children("td.in").children("div").children("input").iCheck('uncheck');
				}

			});
			$("#host_test_list").on("ifChecked", function (e) {
				check_num++;
				$('#host_test_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(check_num);
				if ($("#host_test_list tr").children("td.in").children("div").children("input:checked").length == $("#host_test_list tr").length) {
					$('#check_one_page').iCheck('check');
				}
			}).on("ifUnchecked", function (e) {
				check_num--;
				$('#host_test_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(check_num);
				$('#check_one_page').iCheck('uncheck');
			});
		})
		var ConnectTaskId=null;
		//显示创建页面
		function host_test_add() {
			document.frm_host_test.tasktype.value = 1;
			document.frm_host_test.a.value = 0;
			document.frm_host_test.action = '/bhost/host_test_trust';
			document.frm_host_test.d.value = search_typeall_r;
			var select_id=$('#host_test_select').val();
			var select_value=null;
			switch (select_id) {
				case 'Period':
					select_value=$('#host_test_text').val()+'\t'+$('#PeriodType').val();
					break;
				case 'Execution':
					select_value=$('#Execution').val();
					break;
				case 'Status':
					select_value=$('#Status').val();
					break;
				case 'Enabled':
					select_value=$('#Enabled').val();
					break;
				default:
					select_value=$('#host_test_text').val();
					break;
			}
			document.frm_host_test.e.value = search_typeall_new+":"+select_id+'-'+select_value;
			// document.frm_host_test.e.value = search_typeall_new+":"+$('#host_test_select').val()+'-'+$('#host_test_text').val();
			document.frm_host_test.submit();
		}
		//刷新
		function clear_all() {
			$("#host_test_list tr").children("td.in").children("div").children("input").iCheck('uncheck');
			delect_str = new Array();
			check_num = 0;
			$('#host_test_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(check_num);
		}
		function update_array() {
			var host_testId = document.frm_host_test.a.value;
			var search_typeall = search_typeall_r + search_typeall_new;
			$.ajax({
				url: "/bhost/get_connect_plan",
				type: "POST",
				async: true,
				data: { a0: $("input[name=se]").val(), a2: search_typeall, a1: host_testId },
				success: function (result) {
					var host_test_result = JSON.parse(result);
					if (host_test_result.Result) {
						var host_test_data = host_test_result.info;
						var delect_str_old=delect_str;
						delect_str=new Array();
						host_test_array = host_test_data.data.map(function (item) {
							if($.inArray(item.BatchConnectPlanId+'\t'+item.BatchConnectPlanName,delect_str_old)>=0){
								delect_str.push(item.BatchConnectPlanId+'\t'+item.BatchConnectPlanName);
							}
							return item.BatchConnectPlanId+'\t'+item.BatchConnectPlanName;
						});
					} else {
						_alert(1, '连接测试', host_test_result.ErrMsg);
						return false;
					}
				}
			});
		}
		var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
		String.prototype.ResetBlank=function(){
			var regEx = /\s+/g; 
			return this.replace(regEx, ' '); 
		};
		function _addFilter(obj, type,type_num) {
			var id = $(obj).parent().children('select').eq(0).children('option:selected').val();
			var v1 = $(obj).parent().children('select').eq(0).children('option:selected').text();
			var v2 = $(obj).parent().children('input[type=text]').val().trim();
			
			if (id=='all'){
				v1='';
			}else{
				v1=v1+'-';
			}
			if(id=='Period'){
				if (v2=='' && type_num!=1){
					$(obj).parent().children('input[type=text]').blur();
                                	_alert(2, '关键字输入', '请输入关键字', $(obj).parent().children('input[type=text]'));
                                	return false;		
				}else if(isNaN(v2) && type_num!=1){
					$(obj).parent().children('input[type=text]').blur();
                                        _alert(1, '关键字输入', '关键字格式不正确', $(obj).parent().children('input[type=text]'));
                                        return false;		
				}
			}
			switch (id) {
				case 'Period':
					var v3 = $('#PeriodType').children('option:selected').text();
					v2=v2+v3;
					break;
				case 'Execution':
					var v3 = $('#Execution').children('option:selected').text();
					v2=v3;
					break;
				case 'Status':
					var v3 = $('#Status').children('option:selected').text();
					v2=v3;
					break;
				case 'Enabled':
					var v3 = $('#Enabled').children('option:selected').text();
					v2=v3;
					break;
			}
			v2=v2.ResetBlank();
			if (v2 == '' && type_num!=1) {
				$(obj).parent().children('input[type=text]').blur();
				_alert(2, '关键字输入', '请输入关键字', $(obj).parent().children('input[type=text]'));
				return false;
			} 
			// else 
			{
				switch (id) {
					case 'Name':
						var Reg=/^[\u4e00-\u9fa5a-zA-Z\d_\-\.\s]+$/;
						break;
					case 'Period':
						var Reg=/^[\u4e00-\u9fa5\d\s]+$/;
						break;
					case 'Execution':
						var Reg=/^[\u4e00-\u9fa5\s]+$/;
						break;
					case 'Status':
						var Reg=/^[\u4e00-\u9fa5\s]+$/;
						break;
					case 'Enabled':
						var Reg=/^[\u4e00-\u9fa5\s]+$/;
						break;
				} 
				if (id != 'all' && id!='Period' && id!='Status' && id!='Enabled' && id!='Execution' && !Reg.test(v2) && type_num!=1) {
					$(obj).parent().children('input[type=text]').blur();
					_alert(1, '关键字输入', '关键字格式不正确', $(obj).parent().children('input[type=text]'));
					return false;
				}
				if (search_typeall_r.indexOf(id + '-' + v2 + '\t') >= 0 && type_num!=1) {
					$(obj).parent().children('input[type=text]').blur();
					_alert(2, '关键字输入', '关键字重复', $(obj).parent().children('input[type=text]'));
					return false;
				}
				
				if (type) {
					search_typeall_r = search_typeall_r + id + '-' + v2 + '\t';
					search_typeall_new = '';
					$('#filterWW>ul').append('<li><span style = "display:none">' + id + '-' + v2 + '</span><span class="ww">' + v1 + v2 + '</span><i class="del" onclick="_delFilter(this);"></i></li>')
					$("#host_test_text").val('');
					$('#host_test_text_check').hide();
					switch (id) {
						case 'Period':
							$('#host_test_select option[value=Period]').remove();
							$('#host_test_select').val('all').trigger('change');
							$('#PeriodType').val('1').trigger('change');
							break;
						case 'Execution':
							$('#host_test_select option[value=Execution]').remove();
							$('#host_test_select').val('all').trigger('change');
							$('#Execution').val('true').trigger('change');
							break;
						case 'Status':
							$('#host_test_select option[value=Status]').remove();
							$('#host_test_select').val('all').trigger('change');
							$('#Status').val('0').trigger('change');
							break;
						case 'Enabled':
							$('#host_test_select option[value=Enabled]').remove();
							$('#host_test_select').val('all').trigger('change');
							$('#Enabled').val('true').trigger('change');
							break;
					} 
					selView();
				} else {
					if(type_num!=1)search_typeall_new = id + '-' + v2 + '\t';
				}
			}
			$("#host_test_list tr").children("td.in").children("div").children("input").iCheck('uncheck');

			delect_str = new Array();
			host_test_page(0.1);
			check_num = 0;
			$('#host_test_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(check_num);
		}
		var search_typeall_new = document.frm_host_test.e.value.substr(0,document.frm_host_test.e.value.indexOf(':'));
		function _delFilter(obj) {
			var id = $(obj).parent().find("span");
			var ids = $(id).eq(0).text();
			search_typeall_r = search_typeall_r.replace(ids + '\t', '');
			var host_test_text = $('#host_test_text').val().trim();
			var index_i=ids.indexOf('-');
			var id_value_now=ids.substring(0,index_i);
			switch (id_value_now) {
				case 'Period':
					if($('#host_test_select option[value=Name]').length>0){
						$('#host_test_select option[value=Name]').after('<option value="Period">周期</option>');
					}
					break;
				case 'Execution':
					if($('#host_test_select option[value=Period]').length>0){
						$('#host_test_select option[value=Period]').after('<option value="Execution">立即执行</option>');
					}
					else if($('#host_test_select option[value=Name]').length>0){
						$('#host_test_select option[value=Name]').after('<option value="Execution">立即执行</option>');
					}
					break;
				case 'Status':
					if($('#host_test_select option[value=Execution]').length>0){
						$('#host_test_select option[value=Execution]').after('<option value="Status">执行结果</option>');
					}
					else if($('#host_test_select option[value=Period]').length>0){
						$('#host_test_select option[value=Period]').after('<option value="Status">执行结果</option>');
					}
					else if($('#host_test_select option[value=Name]').length>0){
						$('#host_test_select option[value=Name]').after('<option value="Status">执行结果</option>');
					}
					break;
				case 'Enabled':
					if($('#host_test_select option[value=Status]').length>0){
						$('#host_test_select option[value=Status]').after('<option value="Enabled">状态</option>');
					}
					else if($('#host_test_select option[value=Execution]').length>0){
						$('#host_test_select option[value=Execution]').after('<option value="Enabled">状态</option>');
					}
					else if($('#host_test_select option[value=Period]').length>0){
						$('#host_test_select option[value=Period]').after('<option value="Enabled">状态</option>');
					}
					else if($('#host_test_select option[value=Name]').length>0){
						$('#host_test_select option[value=Name]').after('<option value="Enabled">状态</option>');
					}
					break;
			}
			$(obj).parent().remove();
			selView();
			$("#host_test_list tr").children("td.in").children("div").children("input").iCheck('uncheck');

			delect_str = new Array();
			//////console.log('host_test_page');
			host_test_page(0.1);
			check_num = 0;
			$('#host_test_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(check_num);
		}
		function _clearFilter(obj,num) {
			if(num==1){
			$('#host_test_text').val('');
			$('#host_test_text_check').hide();
			search_typeall_new = '';
			$("#host_test_list tr").children("td.in").children("div").children("input").iCheck('uncheck');
			delect_str = new Array();
			host_test_page(0.1);
			check_num = 0;
			$('#host_test_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(check_num);
				return;
			}
			$('#clearFilter').next().children('ul').empty();
			$('#host_test_text').val('');
			$('#host_test_text_check').hide();
			search_typeall_new = '';
			search_typeall_r = '';
			$('#clearFilter').hide();
			selView();
			$("#host_test_list tr").children("td.in").children("div").children("input").iCheck('uncheck');
			if($('#host_test_select option[value=Period]').length==0){
				$('#host_test_select option[value=Name]').after('<option value="Period">周期</option>');
			}
			if($('#host_test_select option[value=Execution]').length==0){
				$('#host_test_select option[value=Period]').after('<option value="Execution">立即执行</option>');
			}
			if($('#host_test_select option[value=Status]').length==0){
				$('#host_test_select option[value=Execution]').after('<option value="Status">执行结果</option>');
			}
			if($('#host_test_select option[value=Enabled]').length==0){
				$('#host_test_select option[value=Status]').after('<option value="Enabled">状态</option>');
			}
			delect_str = new Array();
			host_test_page(0.1);
			check_num = 0;
			$('#host_test_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(check_num);
		}
		function selView() {
			var $sel = $('#filterWW');
			var len = $('li', $sel).length;
			if (len == 0) {
				$sel.hide();
				$('#clearFilter').hide();
			} else {
				$("#filterWW").show();
				$('#clearFilter').show();
				$('>span.ww', $sel).show();
				$sel.addClass('selector-multiple');
			}
		}
		//选中字段存储
		function delect_save() {
			$(">tr", "#host_test_list").each(function () {
				var input = $(this).find("input[type='checkbox']");
				var delect_item = $(">td", this).eq(1).text()+'\t'+$(">td", this).eq(2).text();
				var index=$.inArray(delect_item,delect_str);
				if ($(input).is(':checked')) {
					if ( index< 0) {
						delect_str.push(delect_item);
					}
				} else {
					if (index >= 0) {
						delect_str.splice(val, 1);
					}
				}
			});
		}
		//check显示
		function check_show() {
			$(">tr", "#host_test_list").each(function () {
				var input = $(this).find("input[type='checkbox']");
				//////console.log('check_show' );
				//////console.log(delect_str);
				var check_id = $(">td", this).eq(1).text()+'\t'+$(">td", this).eq(2).text();
				//////console.log('check_id'+check_id);
				//////console.log($.inArray(check_id,delect_str));
				if($.inArray(check_id,delect_str)>=0){
					$(input).iCheck('check');
				}
			});
		}
		//input回车触发事件
		function showMsg() {
			delect_save();
			var cur = $("#host_test_page").val();
			cur=cur.replace(/\D/g, "");
			if(cur=='' || parseInt(cur) < 1){
				cur=1;
			}else if (parseInt(cur)>fenye_r) {
				cur=fenye_r;
			}
			if(parseInt(cur)==parseInt(document.frm_host_test.c.value)){
				$("#host_test_page").val(cur);
				return false;
			}
			document.frm_host_test.c.value = cur;
			show_host_test_list();
		}
		//以每页显示数显示列表函数
		function show_host_test_list() {
			update_array();
			var paging = document.frm_host_test.c.value;
			var page_num = MAX_PAGE;
			var host_testId = document.frm_host_test.a.value;
			var search_typeall = search_typeall_r + search_typeall_new;
			$.ajax({
				url: "/bhost/get_connect_plan",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a4: page_num, a3: paging, a2: search_typeall, a1: host_testId },
				success: function (result) {
					var host_test_result = JSON.parse(result);
					if (host_test_result.Result == true) {
						var host_test_data = host_test_result.info;
						var total_all = host_test_data.totalrow;
						if (total_all % MAX_PAGE == 0) {
							fenye_r = parseInt(total_all / MAX_PAGE);
						} else {
							fenye_r = parseInt(total_all / MAX_PAGE) + 1;
						}
						if (host_test_data.data == "" && paging != "1") {
							host_test_page(0.9);
						} else {
							//total = 0;
							total_all_r = total_all;
							if (total_all) {
								$("#host_test_list").empty();
								$.each(host_test_data.data, function (i, item) {
									//if (total<page_num){
									//total++;//
									switch (item.Status) {
										case 0: item.Status = '未执行'; break;
										case 1: item.Status = '正在执行'; break;
										case 2: item.Status = '执行完成'; break;
										default: break;
									}
									var a_class=item.Enabled == true ? 'stop_icon' : 'start_icon';
									$("#host_test_list").append("<tr>" +
										"<td "+(perm==1?'style = \"display:none\"':'')+" class=\"in\"><input type=\"checkbox\" class=\"input_checkbox\" /></td>" +
										"<td style = \"display:none\">" + item.BatchConnectPlanId + "</td>" +
										"<td "+(perm==1?'style = \"border-left: 1px solid #FFF;\"':'')+" title='" + (item.BatchConnectPlanName == null ? '' : item.BatchConnectPlanName) + "'>" + (item.BatchConnectPlanName == null ? '' : item.BatchConnectPlanName) + "</td>" +
										"<td title='" + (item.StartTime == null ? '' : item.StartTime) + "'>" + (item.StartTime == null ? '' : item.StartTime) + "</td>" +
										"<td title='"+(item.LastExecuteTime == null ? '' : item.LastExecuteTime)+"'>" + (item.LastExecuteTime == null ? '' : item.LastExecuteTime) + "</td>" +
										"<td title='"+(item.PeriodValue == null ? '' : item.PeriodValue) + (item.PeriodType == 1 ? '天' : (item.PeriodType == 2?'分钟':''))+"'>" + (item.PeriodValue == null ? '' : item.PeriodValue) + (item.PeriodType == 1 ? '天' : (item.PeriodType == 2?'分钟':'')) + "</td>" +
										"<td title='"+(item.Execution == true ? '是' : '否')+"'>" + (item.Execution == true ? '是' : '否') + "</td>" +
										"<td title='"+item.Status+"'>" + item.Status + "</td>" +
										"<td title='"+(item.Enabled == true ? '启用' : '停用')+"'>" + (item.Enabled == true ? '启用' : '停用') + "</td>" +
										"<td><div class=\"tab-ctr\">"+
										"<a href=\"javascript:;\" class=\""+(perm==2?"edit":'search_result')+" "+(item.Enabled == true && perm==2 ? 'disabled' : '')+"\" id=\""+(item.Enabled == true && perm==2 ? '' : 'edit')+"\" title='"+(perm==2?'编辑':'查看')+"'></a>"+
										(perm==2?"<a href=\"javascript:;\" class=\""+a_class+"\" id=\""+a_class+"\" title=\""+(item.Enabled == true ? '停用' : '启用')+"\"></a>":'')+
										"<a href=\"javascript:;\" class=\"icon7\" id=\"icon7\" title=\"测试任务\"></a>"+(perm==2?"<a href=\"javascript:;\" class=\"del\" id=\"del\" title='删除'>":"")+"</div></td></tr>");
								})
								// tabArr();
								$(".input_checkbox", "#host_test_list").iCheck({
									checkboxClass: 'icheckbox_minimal-blue',
									radioClass: 'iradio_minimal-blue',
									increaseArea: '0' // optional
								});
								$("#host_test_total").text(total_all);

								if (paging >= fenye_r) {
									paging = fenye_r;
								}
								document.frm_host_test.c.value = paging;
								document.getElementById("host_test_page").value = paging;
								$("#host_test_pages").text(fenye_r);
								$('#check_one_page').iCheck('uncheck');
								$("#host_test_list tr").children("td.in").children("div").children("input").iCheck('uncheck');
								check_show();
								check_num = delect_str.length;
								$('#host_test_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(check_num);
							} else {
								$('#check_one_page').iCheck('uncheck');
								$('#host_test_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(0);
								$("#host_test_list tr").children("td.in").children("div").children("input").iCheck('uncheck');
								$("#host_test_list").empty();
								$("#host_test_total").text(total_all);
								$("#host_test_pages").text(1);
								document.frm_host_test.c.value = 1;
								fenye_r = 1;
								document.getElementById("host_test_page").value = 1;
							}
						}
					} else {
						_alert(1, "连接测试", host_test_result.ErrMsg);
						$('#check_one_page').iCheck('uncheck');
						$("#host_test_list tr").children("td.in").children("div").children("input").iCheck('uncheck');
						$('#host_test_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(0);
						$("#host_test_total").text(0);
						$("#host_test_pages").text(1);
						document.frm_host_test.c.value = 1;
						fenye_r = 1;
						document.getElementById("host_test_page").value = 1;
						return false;
					}
				}
			});

		}
		//分页 and 刷新
		function host_test_page(num) {
			var paging = parseInt(document.frm_host_test.c.value) + num;
			if (paging == 0 || paging == fenye_r + 1) {
				return false;
			}
			delect_save();
			var host_test_list_s = [];
			if (num == 0.1) {
				paging = 1;
			} else if (num == 0.9) {
				paging = fenye_r;
			}
			$('#host_test_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(0);
			document.getElementById("host_test_page").value = paging;
			document.frm_host_test.c.value = paging;
			show_host_test_list();
		}
		//全选按钮
		function click_all_list() {
			if(host_test_array.length==delect_str.length){
				delect_str=new Array();
			}else{
				delect_str=host_test_array;
			}
			show_host_test_list();
		}
		//删除函数
		function delete_fun(delect_str_item) {
			$.ajax({
				url: '/bhost/del_conn_plan',
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a1: delect_str_item },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result == true) {
						host_test_page(0);
						if(result.fail_num!=0){
							if (result.success_num!=0)
								_alert(0,"连接测试","成功："+result.success_num+'，失败：'+result.fail_num);
							else
								if ((result.fail_num+success_num)==1)
									_alert(1,"连接测试",result.ErrMsg);
								else
									_alert(0,"连接测试",'失败：'+result.fail_num);
						}else{
							_alert(0,"连接测试","删除成功");
						}
						// _alert(0, "连接测试", "删除成功");
					} else {
						host_test_page(0);
						_alert(1, "连接测试", result.ErrMsg);
						return false;
					}
				}
			});
		}
		//删除按钮
		function delete_list() {
			delect_save();
			if (delect_str.length == 0) {
				_alert(2, "连接测试", "请选择要删除的数据");
				return false;
			}
			//利用对话框返回的值 （true 或者 false）
			$('.btn').blur(); parent.layer.open({
				type: 1,
				title: '连接测试',
				content: '<div class="layer-alert"><i class="alert warning"></i>是否批量删除</div>',
				btn: ['删&nbsp;&nbsp;除', '取&nbsp;&nbsp;消'],
				btnAlign: 'c',
				closeBtn: false,
				skin: 'layer-custom',
				area: ['380px', '310px'],
				move: false,
				resize: false,
				yes: function (i) {
					parent.layer.close(i);
					delete_fun(delect_str.join(','));
					delect_str = new Array();
					check_num = 0;
					$('#host_test_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(check_num);
				}
			});
		}

	</script>
	<script type="text/javascript">
		var ConnectTasktotal_all_r = 0;
		//总数
		var ConnectTaskfenye_r = 0;
		var ConnectTask_array = null;
		//总页码
		var ConnectTasksearch_typeall_r = '';
		//关键字
		function save_ConnectTask() {
			$('#two').hide();
			show_host_test_list();
			$('#one').show();
			$('#three').hide();
			$('#importPage').hide();

		}
		function refresh_ConnectTask(){
			ConnectTasksearch_typeall_r = '';
			ConnectTasksearch_typeall_new='';
			ConnectTaskpaging=1;
			$('#one').hide();
			$('#two').show();
			$('#three').hide();
			$('#importPage').hide();
			$('#ConnectTaskfilterWW ul').empty();
			$('#ConnectTask_text').val('');
			$('#ConnectTask_text_check').hide();
			$('#ConnectTask_select').val('all').trigger('change');
			$(this).trigger('click');
			//list show
			show_ConnectTask_list();
		}
		function refresh_ConnectTaskDetails(){
			ConnectTaskDetailssearch_typeall_r = '';
			ConnectTaskDetailssearch_typeall_new='';
			ConnectTaskDetailspaging=1;
			$('#one').hide();
			$('#two').hide();
			$('#three').hide();
			$('#importPage').show();
			$('#apArea1').empty();
			page=0;
			_initLoadData1();
			return 0;
			$('#ConnectTaskDetailsfilterWW ul').empty();
			$('#ConnectTaskDetails_text').val('');
			$('#ConnectTaskDetails_text_check').hide();
			$('#ConnectTaskDetails_select').val('all').trigger('change');
			$(this).trigger('click');
			//list show
			show_ConnectTaskDetails_list();
		}
		var get_conn_taskdetails_search='';
		function get_import_deatil(id,limitrow,offsetrow){
			$.ajax({
				url:'/bhost/get_conn_taskdetails',
				type:'post',
				async:false,
				data:{a0:$("input[name=se]").val(),a2:get_conn_taskdetails_search,a1:ConnectTaskDetailsId,a4:limitrow,a3:offsetrow},
				// data: { a0: $("input[name=se]").val(), a4: page_num, a3: paging, a2: search_typeall, a1: ConnectTaskDetailsId },
				success:function(result){
					import_list_detail = JSON.parse(result).info;
				}
			});
		}
		function get_data_i(type_add){
			if($("#apArea1").find('.apSort').length==0){
				$("#apArea1").append('<div class="apSort"></div>');
			}
			$('#aploadTip1').show();
			var Status;
			var html = '';
			var npage = 0;
			
			var page_i = -1;
			var page_re = 0;
			if (import_list_detail.data.length == 0){
			}
			$.each(import_list_detail.data,function(i,item){
				html='';
				switch (item.Status) {
					case 0: item.Status = '未执行'; break;
					case 1: item.Status = '正在执行'; break;
					case 2: item.Status = '测试成功'; break;
					case 3: item.Status = '连接失败'; break;
					case 4: item.Status = '登录失败'; break;
				}
				if(item.Status=='测试成功'){
					html += '<div class="apItem"><div class="label succ" style="width:210px">' +"主机:"+ item.HostIP + '</div><div class="cc" style="padding-left: 210px;"><table cellpadding="0" cellspacing="0"><tbody>';
				}else{
					html += '<div class="apItem"><div class="label fail" style="width:210px;">'+"主机:"+ item.HostIP + '</div><div class="cc" style="padding-left: 210px;"><table cellpadding="0" cellspacing="0"><tbody>';
				}
				html += '<tr><td style="width:153px;">协议：<span class="a">'+item.ProtocolName+'</td><td width="168px">端口：<span class="a">' + item.Port + '</td><td width="153px">账号：<span class="a">' + item.AccountName + '</td><td width="140" style="text-align:center;" title="'+item.Status+'">' + item.Status + '</td></tr>';
				html += '</tbody></table></div></div>';
				$("#apArea1").find('.apSort:last').append(html);
			});
			html = '</div><div class="ap-pc"> 共' + import_list_detail.totalrow + '条</div>';
			$("#apArea1").find('.ap-pc:last').remove();
			$('#apArea1').append(html);
			var maxPage = Math.floor(import_list_detail.totalrow / 10);
			var task_page = page - 1,
				num = 10;
			var pnum = (task_page * num + 1) + '-' + (task_page + 1) * num;
			if((task_page + 1) * num > import_list_detail.totalrow){
				pnum = (task_page * num + 1) + '-' + import_list_detail.totalrow;
			}

			if (task_page >= maxPage) {
				$('#aploadTip1').html('已全部加载').show();
				return;
			} else if (task_page < maxPage) {
				$('#aploadTip1').hide();
			}
			if(type_add<1){
				type_add++;
				_addData1(type_add);
			}
		}
		function _addData1(type_add) {
			if ($('#aploadTip1').is(':visible')) {
				return;
			}
			page++;
			get_import_deatil(ConnectTaskDetailsId,10,page);
			get_data_i(type_add);
		}
		var row_len=0;
		var page=0;
		function _initLoadData1() {
			
			var h1 = $('#importPage').height();
			var h2 = $('#apArea1').height();
			var add = function() {
				if (h1 - 203 > h2) {
					page++;
					get_import_deatil(ConnectTaskDetailsId,10,page);
					get_data_i(0);
					h2 = $('#apArea1').height();
				}else{
					clearInterval(if_select1);
					return false;
				}
			}
			var if_select1 = setInterval(function(){
				if (row_len < 10){
					clearInterval(if_select1);
					return false;
				}
				if (row_len == 10 && import_list_detail.totalrow == 10){
					clearInterval(if_select1);
					return false;
				}
				add();	
			},1000);
			
			add();
		}
		var import_list_detail;
		$(function () {
			//输入数字
			$("#ConnectTask_page").bind('keydown', function (e) {
				DigitInput(e);
			});
			//页码显示
			$("#ConnectTaskpage_nums").val(MAX_PAGE);
			//tr双击事件
			$("#ConnectTask_list").on('dblclick','tr',function(e){
				return false;
				var id = $(this).find("td");
				// console.log( $(id).eq(8).text());
				if($(id).eq(8).text()=='未执行'){
					_alert(2,'测试任务','该任务未执行');
					return false;
				}else if($(id).eq(8).text()=='正在执行'){
					_alert(2,'测试任务','该任务正在执行中');
					return false;
				}else if($(id).eq(8).text()!='执行完成'){
					_alert(1,'测试任务','该任务发生错误');
					return false;
				}
				ConnectTaskDetailsId = $(id).eq(1).text();
				ConnectTaskDetailssearch_typeall_r = '';
				ConnectTaskDetailssearch_typeall_new='';
				ConnectTaskDetailspaging=1;
				$('#one').hide();
				$('#two').hide();
				$('#three').hide();
				$('#importPage').show();
				$('#apArea1').empty();
				var span_s_arr= $('#importPage .mm.mm1 .span_s');
				span_s_arr.eq(0).text($(id).eq(4).text());
				span_s_arr.eq(1).text($(id).eq(5).text());
				span_s_arr.eq(2).text($(id).eq(6).text());
				span_s_arr.eq(3).text($(id).eq(7).text());
				$("#fail_con_box").iCheck('uncheck');
				page=0;
				get_conn_taskdetails_search='';
				_initLoadData1();
				return false;
				$('#ConnectTaskDetailsfilterWW ul').empty();
				$('#ConnectTaskDetails_text').val('');
				$('#ConnectTaskDetails_text_check').hide();
				$('#ConnectTaskDetails_select').val('all').trigger('change');
				$(this).trigger('click');
				//list show
				show_ConnectTaskDetails_list();
			}) .on("click", "tr", function (e) {
				x = e.target;
				if (x.id == 'icon5') {
					var id = $(this).find("td");
					// console.log( $(id).eq(8).text());
					if($(id).eq(8).text()=='未执行'){
						_alert(2,'测试任务','该任务未执行');
						return false;
					}else if($(id).eq(8).text()=='正在执行'){
						_alert(2,'测试任务','该任务正在执行中');
						return false;
					}else if($(id).eq(8).text()!='执行完成'){
						_alert(1,'测试任务','该任务发生错误');
						return false;
					}

					ConnectTaskDetailsId = $(id).eq(1).text();
					ConnectTaskDetailssearch_typeall_r = '';
					ConnectTaskDetailssearch_typeall_new='';
					ConnectTaskDetailspaging=1;
					$('#one').hide();
					$('#two').hide();
					$('#three').hide();
					$('#importPage').show();
					$('#apArea1').empty();
					$("#fail_con_box").iCheck('uncheck');
					var span_s_arr= $('#importPage .mm.mm1 .span_s');
					span_s_arr.eq(0).text($(id).eq(4).text());
					span_s_arr.eq(1).text($(id).eq(5).text());
					span_s_arr.eq(2).text($(id).eq(6).text());
					span_s_arr.eq(3).text($(id).eq(7).text());
					page=0;
					get_conn_taskdetails_search='';
					_initLoadData1();
					return false;
					$('#ConnectTaskDetailsfilterWW ul').empty();
					ConnectTaskDetailsselView();
					$('#ConnectTaskDetails_text').val('');
					if($('#ConnectTaskDetails_select option[value=Status]').length==0){
						$('#ConnectTaskDetails_select').append('<option value="Status">状态</option>');
					}
					$('#ConnectTaskDetails_select').val('all').trigger('change');
					$('#ConnectTaskDetails_text_check').hide();
					$(this).trigger('click');
					//list show
					show_ConnectTaskDetails_list();
				}
				//二次测试按钮
				if (x.id == 'second_do') {
					var task_id=$(this).find("td").eq(1).text();
					$.ajax({
						url: "/bhost/start_connecttask",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val(), a1: task_id,a2:$(this).find("td").eq(0).text() },
						success: function (result) {
							var result=JSON.parse(result);
							if(result.Result){
								if(result.info){
									ConnectTask_page(0);
								}else{
									_alert(1,'测试任务','二次测试失败');
									return false;
								}
							}else{
								_alert(1,'测试任务',result.ErrMsg);
								return false;
							}
						}
					});
				}
			});

		})
		//刷新
		function ConnectTask_clear_all() {
		}
		function ConnectTask_addFilter(obj, type,type_num) {
			var id = $(obj).parent().children('select').eq(0).children('option:selected').val();
			// <option value="all" selected>所有</option>
			// <option value="Name">名称</option>
			// <option value="Status">状态</option>
			var v1 = $(obj).parent().children('select').eq(0).children('option:selected').text();
			var v2 = $(obj).parent().children('input[type=text]').val().trim();
			if (id=='all'){
				v1='';
			}else{
				v1=v1+'-';
			}
			switch (id) {
				case 'Status':
					var v3 = $('#ConnectTask_Status').children('option:selected').text();
					v2=v3;
					break;
			}
			v2=v2.ResetBlank();
			if (v2 == '' && type_num!=1) {
				$(obj).parent().children('input[type=text]').blur();
				_alert(2, '搜索', '请输入关键字', $(obj).parent().children('input[type=text]'));
				return false;
			}
			//  else 
			{
				switch (id) {
					case 'Name':
						var Reg=/^[\u4e00-\u9fa5a-zA-Z\d_\-\.\s]+$/;
						break;
					case 'Status':
						var Reg=/^[\u4e00-\u9fa5\s]+$/;
						break;
				} 
				if (id != 'all' && !Reg.test(v2) && type_num!=1) {
					$(obj).parent().children('input[type=text]').blur();
					_alert(1, '搜索', '关键字格式不正确', $(obj).parent().children('input[type=text]'));
					return false;
				}
				if (ConnectTasksearch_typeall_r.indexOf(id + '-' + v2 + '\t') >= 0  && type_num!=1) {
					$(obj).parent().children('input[type=text]').blur();
					_alert(2, '搜索', '关键字重复', $(obj).parent().children('input[type=text]'));
					return false;
				}

				if (type) {
					ConnectTasksearch_typeall_r = ConnectTasksearch_typeall_r + id + '-' + v2 + '\t';
					ConnectTasksearch_typeall_new = '';
					$('#ConnectTaskfilterWW>ul').append('<li><span style = "display:none">' + id + '-' + v2 + '</span><span class="ww">' + v1  + v2 + '</span><i class="del" onclick="ConnectTask_delFilter(this);"></i></li>')
					$("#ConnectTask_text").val('');
					$('#ConnectTask_text_check').hide();
					switch (id) {
						case 'Status':
							$('#ConnectTask_select option[value=Status]').remove();
							$('#ConnectTask_select').val('all').trigger('change');
							$('#ConnectTask_Status').val('0').trigger('change');
							break;
					} 
					ConnectTaskselView();
				} else {
					if(type_num!=1) ConnectTasksearch_typeall_new = id + '-' + v2 + '\t';
				}
			}
			ConnectTask_page(0.1);
		}
		var ConnectTasksearch_typeall_new = '';
		function ConnectTask_delFilter(obj) {
			var id = $(obj).parent().find("span");
			var ids = $(id).eq(0).text();
			ConnectTasksearch_typeall_r = ConnectTasksearch_typeall_r.replace(ids + '\t', '');
			var ConnectTask_text = $('#ConnectTask_text').val().trim();
			var index_i=ids.indexOf('-');
			var id_value_now=ids.substring(0,index_i);
			switch (id_value_now) {
				case 'Status':
					$('#ConnectTask_select').append('<option value="Status">状态</option>');
					break;
			}
			$(obj).parent().remove();
			ConnectTaskselView();
			ConnectTask_page(0.1);
		}
		function ConnectTask_ConnectTaskclearFilter(obj,num) {
			if(num==1){
			$('#ConnectTask_text').val('');
			$('#ConnectTask_text_check').hide();
			ConnectTasksearch_typeall_new = '';
			ConnectTask_page(0.1);
			return;				
			}
			if($('#ConnectTask_select option[value=Status]').length==0){
				$('#ConnectTask_select').append('<option value="Status">状态</option>');
			}
			$('#ConnectTaskclearFilter').next().children('ul').empty();
			$('#ConnectTask_text').val('');
			$('#ConnectTask_text_check').hide();
			ConnectTasksearch_typeall_new = '';
			ConnectTasksearch_typeall_r = '';
			$('#ConnectTaskclearFilter').hide();
			ConnectTaskselView();
			ConnectTask_page(0.1);
		}
		function ConnectTaskselView() {
			var $sel = $('#ConnectTaskfilterWW');
			var len = $('li', $sel).length;
			if (len == 0) {
				$sel.hide();
				$('#ConnectTaskclearFilter').hide();
			} else {
				$("#ConnectTaskfilterWW").show();
				$('#ConnectTaskclearFilter').show();
				$('>span.ww', $sel).show();
				$sel.addClass('selector-multiple');
			}
		}
		//input回车触发事件
		function ConnectTaskshowMsg() {
			var cur = $("#ConnectTask_page").val();
			cur=cur.replace(/\D/g, "");
			if(cur=='' || parseInt(cur) < 1){
				cur=1;
			}else if (parseInt(cur)>ConnectTaskfenye_r) {
				cur=ConnectTaskfenye_r;
			}
			if (parseInt(cur) ==parseInt(ConnectTaskfenye_r)) {
				$("#ConnectTask_page").val(cur);
				return false;
			}
			ConnectTaskpaging = cur;
			show_ConnectTask_list();
		}
		var ConnectTaskpaging=1
		//以每页显示数显示列表函数
		function show_ConnectTask_list() {
			var paging=ConnectTaskpaging
			var page_num = MAX_PAGE;
			var search_typeall = ConnectTasksearch_typeall_r + ConnectTasksearch_typeall_new;
			$.ajax({
				url: "/bhost/get_conn_task",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a4: page_num, a3: paging, a2: search_typeall, a1: ConnectTaskId },
				success: function (result) {
					var ConnectTask_result = JSON.parse(result);
					// var has_finish=false;
					if (ConnectTask_result.Result == true) {
						var ConnectTask_data = ConnectTask_result.info;
						var total_all = ConnectTask_data.totalrow;
						if (total_all % MAX_PAGE == 0) {
							ConnectTaskfenye_r = parseInt(total_all / MAX_PAGE);
						} else {
							ConnectTaskfenye_r = parseInt(total_all / MAX_PAGE) + 1;
						}
						if (ConnectTask_data.data == "" && paging != "1") {
							ConnectTask_page(0.9);
						} else {
							//total = 0;
							ConnectTasktotal_all_r = total_all;
							if (total_all) {
								$("#ConnectTask_list").empty();
								$.each(ConnectTask_data.data, function (i, item) {
									switch (item.Status) {
										case 0: item.Status = '未执行'; break;
										case 1: item.Status = '正在执行'; break;
										case 2: item.Status = '执行完成'; break;
										default: break;
									}
									item.LoginFailCount=item.LoginFailCount||0;
									item.ConnectFailCount=item.ConnectFailCount||0;
									item.BatchConnectPlanName =item.BatchConnectPlanName||'';
									item.StartTime=item.StartTime||'';
									item.EndTime=item.EndTime||'';
									item.TotalCount=item.TotalCount||0;
									item.SuccCount=item.SuccCount||0;
									$("#ConnectTask_list").append("<tr>" +
										"<td title='" +item.BatchConnectPlanName + "'>" + item.BatchConnectPlanName + "</td>" +
										"<td style = \"display:none\">" + item.BatchConnectTaskId + "</td>" +
										"<td title='" + item.StartTime + "'>" + item.StartTime + "</td>" +
										"<td title='" +item.EndTime + "'>" + item.EndTime + "</td>" +
										"<td title='"+item.TotalCount+"'>" +  item.TotalCount + "</td>" +
										"<td title='"+item.SuccCount+"'>" + item.SuccCount + "</td>" +
										"<td title='"+item.LoginFailCount+"'>" + item.LoginFailCount + "</td>" +
										"<td title='"+item.ConnectFailCount+"'>" + item.ConnectFailCount + "</td>" +
										"<td title='"+item.Status+"'>" + item.Status + "</td>" +
										"<td><div class=\"tab-ctr\">"+
										"<a href=\"javascript:;\" class=\"icon5\" id=\"icon5\" title='测试结果'></a>"+
										(perm==2?'<a href="javascript:;" class="second_do '+((item.Status=='执行完成' && (item.ConnectFailCount>0 || item.LoginFailCount>0))?'':'disabled')+'" id="'+((item.Status=='执行完成' && (item.ConnectFailCount>0 || item.LoginFailCount>0))?'second_do':'')+'" title="二次测试"></a>':'')+
										"</div>"+
										"</td></tr>");
								});
								$(".input_checkbox", "#ConnectTask_list").iCheck({
									checkboxClass: 'icheckbox_minimal-blue',
									radioClass: 'iradio_minimal-blue',
									increaseArea: '0' // optional
								});
								$("#ConnectTask_total").text(total_all);

								if (paging >= ConnectTaskfenye_r) {
									paging = ConnectTaskfenye_r;
								}
								ConnectTaskpaging = paging;
								document.getElementById("ConnectTask_page").value = paging;
								$("#ConnectTask_pages").text(ConnectTaskfenye_r);
								// $('#ConnectTask_list').prev('thead').find('th').last().css('width',has_finish?'50px':'25px');
								// //////console.log(has_finish?'50px;':'25px;');
							} else {
								$("#ConnectTask_list").empty();
								$("#ConnectTask_total").text(total_all);
								$("#ConnectTask_pages").text(1);
								ConnectTaskpaging = 1;
								ConnectTaskfenye_r = 1;
								document.getElementById("ConnectTask_page").value = 1;
								// $('#ConnectTask_list').prev('thead').find('th').last().css('width',has_finish?'50px':'25px');
								// //////console.log(has_finish?'50px;':'25px;');
							}
						}
					} else {
						_alert(1, "测试任务", ConnectTask_result.ErrMsg);
						$("#ConnectTask_total").text(0);
						$("#ConnectTask_pages").text(1);
						ConnectTaskpaging = 1;
						ConnectTaskfenye_r = 1;
						document.getElementById("ConnectTask_page").value = 1;
						// $('#ConnectTask_list').prev('thead').find('th').last().css('width',has_finish?'50px':'25px');
						// //////console.log(has_finish?'50px;':'25px;');
						return false;
					}
				}
			});

		}
		//分页 and 刷新
		function ConnectTask_page(num) {
			var paging = parseInt(ConnectTaskpaging) + num;
			if (paging == 0 || paging == ConnectTaskfenye_r + 1) {
				return false;
			}
			var ConnectTask_list_s = [];
			if (num == 0.1) {
				paging = 1;
			} else if (num == 0.9) {
				paging = ConnectTaskfenye_r;
			}
			document.getElementById("ConnectTask_page").value = paging;
			ConnectTaskpaging = paging;
			show_ConnectTask_list();
		}

	</script>

    <script type="text/javascript">
		var ConnectTaskDetailstotal_all_r = 0;
		//总数
		var ConnectTaskDetailsfenye_r = 0;
		var ConnectTaskDetails_array = null;
		//总页码
		var ConnectTaskDetailssearch_typeall_r = '';
		//关键字
		function save_ConnectTaskDetails() {
			$('#two').show();
			$('#one').hide();
			$('#three').hide();
			$('#importPage').hide();
			show_ConnectTask_list();
		}
		$(function () {
			//输入数字
			$("#ConnectTaskDetails_page").bind('keydown', function (e) {
				DigitInput(e);
			});
			//页码显示
			$("#ConnectTaskDetailspage_nums").val(MAX_PAGE);
			//tr双击事件
			$("#ConnectTaskDetails_list").on("click", "tr", function (e) {
				x = e.target;
				//下载
				if (x.id == 'icon6') {
					var id=$(this).find("td");
					var edit_item=$(id).eq(2).text();
					down_all(1,edit_item);
				}
			});
			$('#ConnectTaskDetails_check_one_page').on(' ifClicked',function(e){
				if(!$('#ConnectTaskDetails_check_one_page').is(':checked')){
					$("#ConnectTaskDetails_list tr input").iCheck('check');
				}else{
					$("#ConnectTaskDetails_list tr input").iCheck('uncheck');
				}
				
			});
			$("#ConnectTaskDetails_list").on("ifChecked",function(e){
				ConnectTaskDetails_check_num++;
				$('#ConnectTaskDetails_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(ConnectTaskDetails_check_num);
				if($("#ConnectTaskDetails_list tr input:checked").length==$("#ConnectTaskDetails_list tr").length){
					$('#ConnectTaskDetails_check_one_page').iCheck('check');
				}
			}).on("ifUnchecked",function(e){
				ConnectTaskDetails_check_num--;
				$('#ConnectTaskDetails_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(ConnectTaskDetails_check_num);
				$('#ConnectTaskDetails_check_one_page').iCheck('uncheck');	
			});
		})
		//刷新
		function ConnectTaskDetails_clear_all() {
			$("#ConnectTaskDetails_list tr input").iCheck('uncheck');
			ConnectTaskDetails_delect_str=new Array();
			ConnectTaskDetails_check_num=0;
			$('#ConnectTaskDetails_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(ConnectTaskDetails_check_num);
		}
		function ConnectTaskDetails_addFilter(obj, type,type_num) {
			var id = $(obj).parent().children('select').eq(0).children('option:selected').val();
			var v1 = $(obj).parent().children('select').eq(0).children('option:selected').text();
			var v2 = $(obj).parent().children('input[type=text]').val().trim();
			if(id=='all'){
				v1='';
			}else{
				v1=v1+'-';
			}
			switch (id) {
				case 'Status':
					var v3=$('#ConnectTaskDetails_Status option:selected').text();
					v2=v3;
					break;
			}
			v2=v2.ResetBlank();
			if (v2 == '' && type_num!=1) {
				$(obj).parent().children('input[type=text]').blur();
				_alert(2, '搜索', '请输入关键字', $(obj).parent().children('input[type=text]'));
				return false;
			} 
			// else 
			{
				switch (id) {
					case 'hostip':
						// var Reg=/^((?:(?:2[0-4][0-9]\.)|(?:25[0-5]\.)|(?:1[0-9][0-9]\.)|(?:[1-9][0-9]\.)|(?:[0-9]\.)){3}(?:(?:2[0-5][0-5])|(?:25[0-5])|(?:1[0-9][0-9])|(?:[1-9][0-9])|(?:[0-9])))$/;
						var Reg=/^[\d\.\s]+$/;
						break;
					case 'hostname':
						var Reg=/^[\u4e00-\u9fa5a-zA-Z\d_\-\.\s]+$/;
						break;
					case 'protocolname':
						var Reg=/^[a-zA-Z\d\-_\s]+$/;
						break;
					case 'accountname':
						var Reg=/^[\u4e00-\u9fa5a-zA-Z\d_\-\.\s]+$/;
						break;
					case 'Status':
						var Reg=/^[\u4e00-\u9fa5\s]+$/;
						break;
				} 
				if (id != 'all' && !Reg.test(v2) && type_num!=1) {
					$(obj).parent().children('input[type=text]').blur();
					_alert(1, '搜索', '关键字格式不正确', $(obj).parent().children('input[type=text]'));
					return false;
				}
				if (ConnectTaskDetailssearch_typeall_r.indexOf(id + '-' + v2 + '\t') >= 0 && type_num!=1)  {
					$(obj).parent().children('input[type=text]').blur();
					_alert(2, '搜索', '关键字重复', $(obj).parent().children('input[type=text]'));
					return false;
				}

				if (type) {
					ConnectTaskDetailssearch_typeall_r = ConnectTaskDetailssearch_typeall_r + id + '-' + v2 + '\t';
					ConnectTaskDetailssearch_typeall_new = '';
					$('#ConnectTaskDetailsfilterWW>ul').append('<li><span style = "display:none">' + id + '-' + v2 + '</span><span class="ww">' + v1 + v2 + '</span><i class="del" onclick="ConnectTaskDetails_delFilter(this);"></i></li>')
					$("#ConnectTaskDetails_text").val('');
					$('#ConnectTaskDetails_text_check').hide();
					switch (id) {
						case 'Status':
							$('#ConnectTaskDetails_select option[value=Status]').remove();
							$('#ConnectTaskDetails_select').val('all').trigger('change');
							$('#ConnectTaskDetails_Status').val('0').trigger('change');
							break;
					}
					ConnectTaskDetailsselView();
				} else {
					if(type_num!=1)ConnectTaskDetailssearch_typeall_new = id + '-' + v2 + '\t';
				}
			}
			ConnectTaskDetails_page(0.1);
		}
		var ConnectTaskDetails_check_num=0;
		var ConnectTaskDetailssearch_typeall_new = '';
		function ConnectTaskDetails_delFilter(obj) {
			var id = $(obj).parent().find("span");
			var ids = $(id).eq(0).text();
			ConnectTaskDetailssearch_typeall_r = ConnectTaskDetailssearch_typeall_r.replace(ids + '\t', '');
			var ConnectTaskDetails_text = $('#ConnectTaskDetails_text').val().trim();
			var index_ids=ids.indexOf('-');
			switch (ids.substring(0,index_ids)) {
				case 'Status':
					$('#ConnectTaskDetails_select').append('<option value="Status">状态</option>');
					break;
			}
			$(obj).parent().remove();
			ConnectTaskDetailsselView();
			ConnectTaskDetails_page(0.1);
		}
		function ConnectTaskDetails_ConnectTaskDetailsclearFilter(obj,num) {
			if(num==1){
				ConnectTaskDetailssearch_typeall_new = '';
				$('#ConnectTaskDetails_text').val('');
				$('#ConnectTaskDetails_text_check').hide();
				ConnectTaskDetails_page(0.1);
				return;
			}
			if($('#ConnectTaskDetails_select option[value=Status]').length==0){
				$('#ConnectTaskDetails_select').append('<option value="Status">状态</option>');
			}
			$('#ConnectTaskDetailsclearFilter').next().children('ul').empty();
			$('#ConnectTaskDetails_text').val('');
			$('#ConnectTaskDetails_text_check').hide();
			ConnectTaskDetailssearch_typeall_new = '';
			ConnectTaskDetailssearch_typeall_r = '';
			$('#ConnectTaskDetailsclearFilter').hide();
			ConnectTaskDetailsselView();
			ConnectTaskDetails_page(0.1);
		}
		function ConnectTaskDetailsselView() {
			var $sel = $('#ConnectTaskDetailsfilterWW');
			var len = $('li', $sel).length;
			if (len == 0) {
				$sel.hide();
				$('#ConnectTaskDetailsclearFilter').hide();
			} else {
				$("#ConnectTaskDetailsfilterWW").show();
				$('#ConnectTaskDetailsclearFilter').show();
				$('>span.ww', $sel).show();
				$sel.addClass('selector-multiple');
			}
		}
		function ConnectTaskDetails_delect_save() {
			$(">tr","#ConnectTaskDetails_list").each(function(){
				var input  = $(this).find("input[type='checkbox']");
				var delect_item=$(">td",this).eq(2).text();
				var index=$.inArray(delect_item,ConnectTaskDetails_delect_str);
				if($(input).is(':checked')){
					if(index<0){
						ConnectTaskDetails_delect_str.push(delect_item);
					}
				}else{
					if(index>=0){
						ConnectTaskDetails_delect_str.splice(index,1);
					}
				}
			});
		}
		//input回车触发事件
		function ConnectTaskDetailsshowMsg() {
			ConnectTaskDetails_delect_save();
			var cur = $("#ConnectTaskDetails_page").val();
			cur=cur.replace(/\D/g, "");
			if(cur=='' || parseInt(cur) < 1){
				cur=1;
			}else if (parseInt(cur)>ConnectTaskDetailsfenye_r) {
				cur=ConnectTaskDetailsfenye_r;
			}
			////////console.log(cur);
			if (parseInt(cur) ==parseInt(ConnectTaskDetailspaging)) {
				$("#ConnectTaskDetails_page").val(cur);
				return false;
			}
			ConnectTaskDetailspaging = cur;
			show_ConnectTaskDetails_list();
		}
		var ConnectTaskDetailspaging=1
		var ConnectTaskDetailsId=0;
		var ConnectTaskDetails_delect_str=new Array();
		var ConnectTaskDetails_array=null;
		function update_array_detail(){
			var search_typeall = ConnectTaskDetailssearch_typeall_r + ConnectTaskDetailssearch_typeall_new;
			$.ajax({
				url: "/bhost/get_conn_taskdetails",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a2: search_typeall, a1: ConnectTaskDetailsId },
				success: function (result) {
					var ConnectTaskDetails_result = JSON.parse(result);
					if (ConnectTaskDetails_result.Result == true) {
						var ConnectTaskDetails_data = ConnectTaskDetails_result.info;
						var ConnectTaskDetails_delect_str_old=ConnectTaskDetails_delect_str;
						ConnectTaskDetails_delect_str=new Array();
						ConnectTaskDetails_array = ConnectTaskDetails_data.data.map(function (item) {
							if($.inArray(item.BatchConnectTaskDetailId+'',ConnectTaskDetails_delect_str_old)>=0){
								ConnectTaskDetails_delect_str.push(item.BatchConnectTaskDetailId+'');
							}
							return item.BatchConnectTaskDetailId+'';
						});
					} else {
						_alert(1, "测试结果", ConnectTaskDetails_result.ErrMsg);
						return false;
					}
				}
			});

		}
		function down_all(num,id_value){
			ConnectTaskDetails_delect_save();
			if(num==0){
				id_value_str=ConnectTaskDetails_delect_str.join(',');
			}else{
				id_value_str=id_value;
			}
			var search_typeall = ConnectTaskDetailssearch_typeall_r + ConnectTaskDetailssearch_typeall_new;
			$.ajax({
				url: "/bhost/get_details_data",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a2: search_typeall, a1: ConnectTaskDetailsId,a3:id_value_str },
				success: function (result) {
					var ConnectTaskDetails_result = JSON.parse(result);
					if (ConnectTaskDetails_result.Result == true) {
						var ConnectTaskDetails_data = ConnectTaskDetails_result.info;
						var data = [['主机名称','主机IP','账号（账户名）','协议','端口','状态']];
						$.each(ConnectTaskDetails_data,function (i,item) {
							$.each(item.detail_data,function (i1,item1) {
								if(i1==0){
									data.push(
										[
											item.HostName,
											item.HostIP,
											item1.AccountName,
											item1.ProtocolName,
											item1.Port,
											item1.Status
										]
									);
								}else{
									data.push(
										[
											'',
											'',
											item1.AccountName,
											item1.ProtocolName,
											item1.Port,
											item1.Status
										]
									);
								}
							});
						});
						// var csvContent = "data:text/csv;charset=utf-8,\ufeff";
						var csvContent = "\ufeff";
						// if (window.navigator.msSaveOrOpenBlob) {
						// 	csvContent = "\ufeff";
						// }
						data.forEach(function(infoArray, index){
							//////console.log(infoArray);
							//////console.log(index);
							dataString = infoArray.join(",");
							//////console.log(dataString);
							csvContent += index < data.length ? dataString+ "\n" : dataString;
							//////console.log(csvContent);
						});
						var blob = new Blob([decodeURIComponent(encodeURI(csvContent))],{
							type: "text/csv;charset=utf-8;"
						});
						if (window.navigator.msSaveOrOpenBlob) {
							// if browser is IE
							
							navigator.msSaveBlob(blob, 'linktest.csv');
						}else{
							// var blob = new Blob([decodeURIComponent(encodeURI(csvContent))],{
							// 	type: "text/csv;charset=utf-8;"
							// });
							// var encodedUri = encodeURI(csvContent);
							var link = document.createElement("a");
							// link.setAttribute("href", encodedUri);
							link.setAttribute("href", URL.createObjectURL(blob));
							link.setAttribute("download", "linktest.csv");
							document.body.appendChild(link);
							link.click();
							document.body.removeChild(link);
						}
					} else {
						_alert(1, "测试结果", ConnectTaskDetails_result.ErrMsg);
						return false;
					}
				}
			});
		}
		//以每页显示数显示列表函数
		function show_ConnectTaskDetails_list() {
			update_array_detail();
			var paging=ConnectTaskDetailspaging
			var page_num = MAX_PAGE;
			var search_typeall = ConnectTaskDetailssearch_typeall_r + ConnectTaskDetailssearch_typeall_new;
			$.ajax({
				url: "/bhost/get_conn_taskdetails",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a4: page_num, a3: paging, a2: search_typeall, a1: ConnectTaskDetailsId },
				success: function (result) {
					var ConnectTaskDetails_result = JSON.parse(result);
					if (ConnectTaskDetails_result.Result == true) {
						var ConnectTaskDetails_data = ConnectTaskDetails_result.info;
						var total_all = ConnectTaskDetails_data.totalrow;
						if (total_all % MAX_PAGE == 0) {
							ConnectTaskDetailsfenye_r = parseInt(total_all / MAX_PAGE);
						} else {
							ConnectTaskDetailsfenye_r = parseInt(total_all / MAX_PAGE) + 1;
						}
						if (ConnectTaskDetails_data.data == "" && paging != "1") {
							ConnectTaskDetails_page(0.9);
						} else {
							//total = 0;
							ConnectTaskDetailstotal_all_r = total_all;
							if (total_all) {
								$("#ConnectTaskDetails_list").empty();
								$.each(ConnectTaskDetails_data.data, function (i, item) {
									//if (total<page_num){
									//total++;//
									switch (item.Status) {
										case 0: item.Status = '未执行'; break;
										case 1: item.Status = '正在执行'; break;
										case 2: item.Status = '测试成功'; break;
										case 3: item.Status = '连接失败'; break;
										case 4: item.Status = '登录失败'; break;
										default: break;
									}
									$("#ConnectTaskDetails_list").append("<tr>" +
										"<td class=\"in\"><input type=\"checkbox\" class=\"input_checkbox\" /></td>"+
										"<td title='" + (item.StartTime == null ? '' : item.StartTime) + "'>" + (item.StartTime == null ? '' : item.StartTime) + "</td>" +
										"<td style = \"display:none\">" + item.BatchConnectTaskDetailId + "</td>" +
										"<td title='" + (item.EndTime == null ? '' : item.EndTime) + "'>" + (item.EndTime == null ? '' : item.EndTime) + "</td>" +
										"<td title='"+(item.HostIP == null ? '' : item.HostIP)+"'>" + (item.HostIP == null ? '' : item.HostIP) + "</td>" +
										"<td title='"+(item.HostName == null ? '' : item.HostName)+"'>" +  (item.HostName == null ? '' : item.HostName) + "</td>" +
										"<td title='"+(item.ProtocolName == null ? '' : item.ProtocolName)+"'>" + (item.ProtocolName == null ? '' : item.ProtocolName) + "</td>" +
										"<td title='"+(item.Port == null ? '' : item.Port)+"'>" + (item.Port == null ? '' : item.Port) + "</td>" +
										"<td title='"+(item.AccountName == null ? '' : item.AccountName)+"'>" + (item.AccountName == null ? '' : item.AccountName) + "</td>" +
										"<td title='"+item.Status+"'>" + item.Status + "</td>" +
										"<td><div class=\"tab-ctr\">"+
										"<a href=\"javascript:;\" class=\"icon6\" id=\"icon6\" title='下载' style=\"\"></a>"+
										"</div></td>"+
										"</tr>");
									//}
								})

								tabArr();
								$(".input_checkbox", "#ConnectTaskDetails_list").iCheck({
									checkboxClass: 'icheckbox_minimal-blue',
									radioClass: 'iradio_minimal-blue',
									increaseArea: '0' // optional
								});
								$("#ConnectTaskDetails_total").text(total_all);

								if (paging >= ConnectTaskDetailsfenye_r) {
									paging = ConnectTaskDetailsfenye_r;
								}
								ConnectTaskDetailspaging = paging;
								document.getElementById("ConnectTaskDetails_page").value = paging;
								$("#ConnectTaskDetails_pages").text(ConnectTaskDetailsfenye_r);
								// $('#ConnectTaskDetails_list').prev('thead').find('th').last().css('width','25px');
								$('#ConnectTaskDetails_check_one_page').iCheck('uncheck');	
								$("#ConnectTaskDetails_list tr input").iCheck('uncheck');
								ConnectTaskDetails_check_show();
								////////console.log(paging);
								ConnectTaskDetails_check_num=ConnectTaskDetails_delect_str.length;
								$('#ConnectTaskDetails_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(ConnectTaskDetails_check_num);
							} else {
								$("#ConnectTaskDetails_list").empty();
								$('#ConnectTaskDetails_check_one_page').iCheck('uncheck');	
								$("#ConnectTaskDetails_list tr input").iCheck('uncheck');
								$('#ConnectTaskDetails_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(0);
								$("#ConnectTaskDetails_total").text(total_all);
								$("#ConnectTaskDetails_pages").text(1);
								ConnectTaskDetailspaging = 1;
								ConnectTaskDetailsfenye_r = 1;
								document.getElementById("ConnectTaskDetails_page").value = 1;
								// $('#ConnectTaskDetails_list').prev('thead').find('th').last().css('width','25px');
							}
						}
					} else {
						_alert(1, "测试结果", ConnectTaskDetails_result.ErrMsg);
						$('#ConnectTaskDetails_check_one_page').iCheck('uncheck');	
						$("#ConnectTaskDetails_list tr input").iCheck('uncheck');
						$('#ConnectTaskDetails_list').parents("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(0);
						$("#ConnectTaskDetails_total").text(0);
						$("#ConnectTaskDetails_pages").text(1);
						ConnectTaskDetailspaging = 1;
						ConnectTaskDetailsfenye_r = 1;
						document.getElementById("ConnectTaskDetails_page").value = 1;
						// $('#ConnectTaskDetails_list').prev('thead').find('th').last().css('width','25px');
						return false;
					}
				}
			});

		}
		function ConnectTaskDetails_check_show() {
			//////console.log('ConnectTaskDetails_check_show');
			//////console.log(ConnectTaskDetails_delect_str);
			$(">tr","#ConnectTaskDetails_list").each(function(){
				var input  = $(this).find("input[type='checkbox']");
				var check_id=$(">td",this).eq(2).text();
				if($.inArray(check_id,ConnectTaskDetails_delect_str)>=0){
					$(this).find("input[type='checkbox']").iCheck('check');
				}
			});
		}
		//全选按钮
		function ConnectTaskDetails_click_all_list(){
			ConnectTaskDetails_delect_save();
			if(ConnectTaskDetails_delect_str.length==ConnectTaskDetails_array.length){
				ConnectTaskDetails_delect_str=new Array();
			}else{
				ConnectTaskDetails_delect_str=ConnectTaskDetails_array;
			}
			show_ConnectTaskDetails_list();
		}
		//分页 and 刷新
		function ConnectTaskDetails_page(num) {
			var paging = parseInt(ConnectTaskDetailspaging) + num;
			if (paging == 0 || paging == ConnectTaskDetailsfenye_r + 1) {
				return false;
			}
			ConnectTaskDetails_delect_save();
			var ConnectTaskDetails_list_s = [];
			if (num == 0.1) {
				paging = 1;
			} else if (num == 0.9) {
				paging = ConnectTaskDetailsfenye_r;
			}
			document.getElementById("ConnectTaskDetails_page").value = paging;
			ConnectTaskDetailspaging = paging;
			show_ConnectTaskDetails_list();
		}

	</script>
</body>

</html>
