<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>manager</title>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<link rel="stylesheet" href="/manage/css/style.css">
	<link rel="stylesheet" href="/manage/css/new-head.css">
	<!--script-->
	<script src="/manage/js/jquery.min.js"></script>
	<script src="/manage/js/jquery.easing.js"></script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/layer.js"></script>
	<script src="/manage/js/select2.full.min.js"></script>
	<script src="/manage/js/jquery.plugin.js"></script>
	<script src="/manage/js/jquery.datepick.js"></script>
	<script src="/manage/js/icheck.min.js"></script>
	<script src="/manage/js/common_e.js"></script>
	<script type="text/javascript" src="/manage/js/dialog-plus.js"></script>
	<link rel="stylesheet" href="/manage/css/ui-dialog.css" type="text/css" />
</head>
<script>
	var perm={{perm}};
	if (perm==0) parent.$('#nav-s1 a.active').click();
	var perm_1={{perm_1}};
	var perm_2={{perm_2}};
	var perm_3={{perm_3}};
</script>
<body style="overflow:hidden;" class="bg-white">
	<!---->
	<div class="rwrap">
		<!---->
		<div class="mainer" name="manageauth" id="manageauth" >
			
			<div class="container container3">
				<div class="c-top">
					<div class="manual-head">
						<div id="manageauth_1" class="manual-title-other title-item" style="color: rgb(121, 121, 121);background: rgb(222, 222, 222)">
							<span onclick="fw_z()">访问授权</span>
							<i style="display: none;"></i>
						</div>
						<div id="manageauth_2" class="manual-title-other title-item" style="color: rgb(121, 121, 121);">
							<span onclick="manage_work();"> 工单授权</span>
							<i style="display: none;"></i>
						</div>
						<div id="manageauth_3" class="manual-title-other title-item" style="color: rgb(121, 121, 121);">
							<span onclick="cmd_auth();"> 指令授权</span>
							<i style="display: none;"></i>
						</div>
						<div id="manageauth_4" class="manual-title-other title-item" id="frist">
							<span onclick="manage_add();"> 管理授权</span>
							<i class="manage_icon"></i>
						</div>
					</div>
				</div>
				<script>
					if (perm_1==0) $('#manageauth_1').remove();
					if (perm_2==0) $('#manageauth_2').remove();
					if (perm_3==0) $('#manageauth_3').remove();
					if(perm_1==0 && perm_2==0 && perm_3==0) {
						$('#manageauth_4').attr('class','manual-title');
						$('#manageauth_4').attr('id','');
					}else{
						$('#manageauth_4').attr('id','frist');
					}
				</script>
				<div class="c-cont">
					<div class="c-wrap" style="padding: 0px 0px 28px;">
						<div class="c-table">
							<div class="tab-t">
								<div class="ctr" style="width: 288px;">
									<a id='ctr_1' href="javascript:;" class="btn btn-default" onclick="manageauth_add();">创建</a>
									<a id='ctr_2' href="javascript:;" class="btn btn-default" onclick="delete_list();">删除</a>
									<a id='ctr_3' href="javascript:;" class="btn btn-default" onclick="click_all_list();">全选</a>
									<a href="javascript:;" class="btn btn-default" onclick="manageauth_page(0);clear_all();">刷新</a>
								</div>
								<script>
									if(perm==1){
										$('#ctr_1').remove();
										$('#ctr_2').remove();
										$('#ctr_3').remove();
										$('#ctr_4').remove();
									}
								</script>
								<div class="filter">
									<div class="search">
										<select name="manageauth_select" id="manageauth_select" class="filter-select">
											<option value="all" selected>所有</option>
											<option value="ManageAuthName">名称</option>
											<option value="user">用户</option>
											<option value="userGroup">用户组</option>
											<option value="ClientScopeName">客户端登录</option>
											<option value="ServerScopeName">服务器管理</option>
										</select>

										<input type="text"  class="filter-text" placeholder="输入关键字" 
										name="manageauth_text" id="manageauth_text" maxlength="128" 
										onchange="if($('#manageauth_text').val()==''){$('#manageauth_text_check').hide();}else{$('#manageauth_text_check').show();}"
										onkeyup="if($('#manageauth_text').val()==''){$('#manageauth_text_check').hide();}else{$('#manageauth_text_check').show();}"
										onblur="if($('#manageauth_text').val()=='' && search_typeall_new!=''){search_typeall_new='';_addFilter(this,false,1);}"
										onkeydown="if($('#manageauth_text').val()==''){$('#manageauth_text_check').hide();}else{$('#manageauth_text_check').show();}; if (event.keyCode == 13){_addFilter(this,false);return false;} else return; " 
										style="/*display:none;*/padding-right: 22px;">
										<i class="v-check v-wrong" id="manageauth_text_check" 
										onclick="_clearFilter(this,1)" 
										style="display:none;cursor: pointer;float: left;position: static;"></i>
										<button class="btn filter-btn" onclick="_addFilter(this,false);"><i class="add-filter"></i></button>
										<button class="btn filter-btn" onclick="_addFilter(this,true)"><i class="append-filter"></i></button>
									</div>
									<div class="search" id="clearFilter" style="margin: 0px 15px 0px -16px;display:none;">
										<button class="filter-btn" onclick="_clearFilter(this)"><i class="clear-filter"></i></button>
									</div>
									<div class="selector selector-multiple" id="filterWW" style="display:none;">
										<span class="ww">搜索条件</span>
										<ul></ul>
									</div>
								</div>
							</div>
							<div class="box-table">
								<table cellpadding="0" cellspacing="0">
									<thead>
										<tr>
											<th width="50"><input type="checkbox" class="form-checkbox" id="check_one_page"/></th>
											<th width="200">名称</th>
											<th>用户</th>
											<th>用户组</th>
											<th>客户端登录</th>
											<th>服务器管理</th>
											<th id="manageauth_list_th" width="55"></th>
										</tr>
									</thead>
									<script>
										if(perm==1){ 
											$('#check_one_page').parent().hide();
											$('#manageauth_list_th').attr('width','25');
										}
									</script>
									<tbody name="manageauth_list" id="manageauth_list">
									</tbody>
								</table>
							</div>
							<div class="tab-i">
								<div class="il">
									每页显示<span id="page_nums">10</span>条 总数：<span id = "manageauth_total">0</span><span>  选中：</span><span class="sum">0</span>
								</div>
								<script>
									if(perm==1){
										$('#manageauth_total').next('span').remove();
										$('#manageauth_total').next('span').remove();
										$('#importUser').remove();
									}
								</script>
								<div class="ipage">
									<a href="javascript:;" class="nav2 begin" id="manageauth_begin" onclick="manageauth_page(0.1);"><i></i></a>
									<a href="javascript:;" class="nav prev" id="manageauth_prev" onclick="manageauth_page(-1);"><i></i></a>
									<input type="text" id = "manageauth_page" value="1" onchange="showMsg();" onblur="showMsg();">/&nbsp;<span id = "manageauth_pages">1</span>
									<a href="javascript:;" class="nav next" id="manageauth_next" onclick="manageauth_page(1);"><i></i></a>
									<a href="javascript:;" class="nav2 end" id="manageauth_end" onclick="manageauth_page(0.9);"><i></i></a>
								</div>
							</div>
						</div>
						
						<div class="clearfix"></div>
						<div class="btns">
							<a href="javascript:;" class="btn btn-normal" id="importUser" onclick="_import_user(1);">导&nbsp;&nbsp;入</a>
							<a href="javascript:;" class="btn btn-normal" onclick="_export_user(2);">导&nbsp;&nbsp;出</a>
						</div>
						<script>
							if(perm==1){
								$('#importUser').remove();
							}
						</script>
						<div id="bBtn" style="position: fixed;z-index:5;">
							<a href="javascript:;" class="btn" style="float: right;" onclick="back();"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
						</div>
					</div>
				</div>
			</div>
			<!--导入信息详情-->
			<div class="container6">
				<div id="importPage" style="display: none;">
					<div class="ap-top" id="">
						<div class="ctrl">
							<a href="javascript:;" class="re" onclick="_reloadDetail(2)" style="border-radius: 14px;"><i style="margin: 3px auto;margin-left: 8px;"></i></a>
							<!--<a href="javascript:;" class="close" onclick="_closeDetail(2)"><i></i></a>-->
						</div>
						<div class="types">
							<label>
								<input type="checkbox" name="" id="fail_IP_box" class="form-checkbox" >失败的管理授权</label>
						</div>
					</div>
					<div class="apWrap">
						<div class="title">
							<h2>导入详情</h2>
						</div>
						<div class="top">
							<div class="mm mm1">
								总数：<span>11</span> 成功：<span>11</span> 失败：<span>11</span>
							</div>
						</div>
						<div class="clearfix"></div>
						<div id="apArea1" style="height:auto;">
						</div>
						<div id="aploadTip1">正在加载</div>
					</div>
					<div id="bBtn" style="position: fixed;z-index:5;">
                				<a href="javascript:;" class="btn" style="float: right;" onclick="_closeDetail(2)"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
        				</div>
				</div>
			</div>
			<!--管理授权导入-->
			<div class="dialog-cont" id="scDCTab2_import" style="display:none;">
				<div class="fsel" style="margin-left: 0;">
					<ul><li><a class="active" href="javascript:;" id="task_import" onclick="set_tab(this,1);">管理授权导入</a></li>
						<li><a href="javascript:;" id="task_list_tab" onclick="set_tab(this,2);">任务列表</a></li>
					</ul>
				</div>
				<div class="container5">
					<div id="import_module" class="c-cont" style="min-height:400px;max-height:400px;overflow:hidden;">
						<div class="c-form" style="padding-bottom:10px;padding-left:50px;">
							<div class="tab-t c-form">
								<span class="form-tag">下载模板：</span>
								<div class="ctr" style="margin-left:6px;">
									<a class="btn" href="javascript:;" style="" onclick="_export_user(1);">下载</a>
								</div>
							</div>
							<div class="c-form" style="">
								<form id="uploadForm">
								<!--form action="/bhost/import_data" method="POST" name="frm1" enctype="multipart/form-data">
									<input type="hidden" name="z1" value="" />-->
									<div class="form-item tab-t">
										<span class="form-tag"><em class="imp">*</em>选择文件：</span>
										<div class="form-c ctr" style="width:300px;padding:0 0 0 7px;">
											<div class="item" style="float: left;width:67%">
												<input id="file_v" name="file_v" class="form-text" type="text" style="float: left;width: 220px;">
												<input id="file_change" name="file_change" class="form-text" type="text" onclick="browes();" onchange="/*filetip(this);*/" style="float: left;opacity: 0;margin-top: -28px;cursor: pointer;">
												<input id="file_change1" name="file_change1" class="form-text" type="file" onchange="filetip(this);" style="float: left;opacity: 0;margin-top: -28px;cursor: pointer;display: none;">
											</div>
											<div class="item" style="float: left;width:33%">
												<a class="btn" href="javascript:;" style="margin-left: 70px;height: 26px;width:33px;" onclick="browes();">浏览</a>
											</div>
											<p class="form-tip" id="" style="margin-top: 28px;width: 243px;height: 32px;">特殊字符仅支持下划线、横杠、小数点</p>
										</div>
									</div>
								</form>
							</div>
							<!-- <div class="c-form">
								<span class="form-tag">审核：</span>
								<div style="width: 215px;margin-left: 200px;margin-top: 4px;">
									<input class="form-checkbox" id="pending_box" type="checkbox"/>
									<span class="tip" style="color: #b2b2b2;">导入前对主机进行连接测试</span>
								</div>
							</div> -->
							<div class="c-form">
								<span class="form-tag">覆盖：</span>
								<div style="width: 215px;margin-left: 200px;margin-top: 4px;">
									<input class="form-checkbox" id="cover_box1" type="checkbox"/>
									<span class="tip" style="color: #b2b2b2;">覆盖相同名称的管理授权</span>
								</div>
							</div>
							<div class="btns" style="">
								<a href="javascript:;" class="btn btn-normal btn-submit" >确&nbsp;&nbsp;定</a>
								<!-- <a href="javascript:;" class="btn btn-normal btn-cancel" >取&nbsp;&nbsp;消</a> -->
							</div>
						</div>
					</div>
				
					<div id="details_module" class="c-cont" style="min-height:400px;max-height:400px;overflow:hidden;display:none;">
						<div class="c-form" style="padding:0;width: auto;">
							<div class="c-wrap" style="padding:0;">
							<div class="c-table r-list" style="padding:0;">
								<div class="tab-t">
									<div class="ctr">
										<a href="javascript:;" class="btn btn-default" onclick="select_all()">全选</a>
										<a href="javascript:;" class="btn btn-default" onclick="del_hosttask_more()">删除</a>
										<a href="javascript:;" class="btn btn-default" onclick="fresh_task_list()">刷新</a>
									</div>
								</div>
								<div class="box-table" style="overflow: hidden;">
									<table cellpadding="0" cellspacing="0" id="usertask_list">
										<thead>
											<tr>		
												<th width="50"><input type="checkbox" class="form-checkbox" id="check_task_page"/></th>
												<th>名称</th>
												<th>成功数</th>
												<th>失败数</th>
												<th>状态</th>
												<th>错误信息</th>
												<th width="50"></th>
											</tr>
										</thead>
										<tbody>
											
										</tbody>
									</table>
								</div>
								<div class="tab-i">
									<div class="il">
										每页显示<span id="page_total">10</span>条 总数<span id = "task_total">25</span>  选中：<span id = "select_total">0</span>
									</div>

									<div class="ipage">
										<a href="javascript:;" class="nav2 begin" onclick="turn_page(1);"><i></i></a>
										<a href="javascript:;" class="nav prev" onclick="turn_page(2)"><i></i></a>
										<input type="text" value="1" id="curpage" onchange="turn_page(5)">/ <span id = "totalpage">25</span>
										<a href="javascript:;" class="nav next" onclick="turn_page(3)"><i></i></a>
										<a href="javascript:;" class="nav2 end" onclick="turn_page(4)"><i></i></a>
									</div>
								</div>
							</div>
							
							<div class="clearfix"></div>
							<!--
							<div class="btns" style="/*padding: 20px 0 0px;*/">
								<a href="javascript:;" class="btn btn-normal btn-submit" >确&nbsp;&nbsp;定</a>
								<a href="javascript:;" class="btn btn-normal btn-cancel" >取&nbsp;&nbsp;消</a>
							</div>
							-->
						</div>
					</div>
					</div>
				</div>
				<form action="/bhost/import_data" method="POST" name="frm1" enctype="multipart/form-data">
					<input type="hidden" name="z1"  value="" />
					<input type="hidden" name="a0"  value="" />
					<input type="hidden" name="a1"  value="" />
					<input type="hidden" name="a99"  value="" />
				</form>

			</div>
		</div>
		
	</div>
	<!-- 导出方式 浮层-->
	<div class="dialog-cont s-hide" id="export_type" style="display:none;">
		<div class="container">
			<div id="export_module" class="c-cont" style="min-height:350px;max-height:300px;overflow:hidden;">
				<div class="c-form" style="padding-bottom:10px;padding-left:50px;">
					<span>方式：</span>
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="all_check" value="all" name="exportType_radio" checked="checked"/>所有
					</label>
					<!-- <label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="resource_check" value="resource" name="exportType_radio"/>资源
					</label>
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="acc_check" value="acc" name="exportType_radio"/>访问
					</label>
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="work_check" value="work" name="exportType_radio"/>工单
					</label>
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="cmd_check" value="cmd" name="exportType_radio"/>指令
					</label>
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="manage_check" value="manage" name="exportType_radio"/>管理
					</label> -->
				</div>
				<div class="c-form" style="padding-bottom:10px;padding-left:50px;padding-top: 5px;">
					<span style="padding-right: 46px;"></span>
					<!-- <label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="all_check" value="all" name="exportType_radio" checked="checked"/>所有
					</label> -->
					<label class="form-label" style="width: 60px;" id="">
						<input type="checkbox" class="form-checkbox" id="resource_check" value="resource" name="exportType_radio"/>资源
					</label>
					<label class="form-label" style="width: 60px;" id="check_1">
						<input type="checkbox" class="form-checkbox" id="acc_check" value="acc" name="exportType_radio"/>访问
					</label>
					<label class="form-label" style="width: 60px;" id="check_2">
						<input type="checkbox" class="form-checkbox" id="work_check" value="work" name="exportType_radio"/>工单
					</label>
					<label class="form-label" style="width: 60px;" id="check_3">
						<input type="checkbox" class="form-checkbox" id="cmd_check" value="cmd" name="exportType_radio"/>指令
					</label>
					<label class="form-label" style="width: 60px;">
						<input type="checkbox" class="form-checkbox" id="manage_check" value="manage" name="exportType_radio"/>管理
					</label>
				</div>
				<script>
					if (perm_1==0) $('#check_1').remove();
					if (perm_2==0) $('#check_2').remove();
					if (perm_3==0) $('#check_3').remove();
				</script>
				<div class="c-form" style="padding-bottom:10px;padding-left:50px;">
					<span>格式：</span>
					<label class="form-label" style="width: 60px;">
						<input type="radio" class="form-radio" value=0 name="exportType_radio2" checked="checked"/>CSV
					</label>
					<label class="form-label" style="width: 60px;">
						<input type="radio" class="form-radio" value=1 name="exportType_radio2"/>XLS
					</label>
					<!--<label class="form-label" style="width: 60px;">
						<input type="radio" class="form-radio" value=2 name="exportType_radio2"/>XLSX
					</label>-->
				</div>
			</div>
			<div class="btns" style="/*padding: 20px 0 0px;*/">
				<a href="javascript:;" class="btn btn-normal btn-submit" >确&nbsp;&nbsp;定</a>
			</div>
		</div>
	</div>
	<form action="/bhost/manage_auth_add" method="POST" name="frm_manageauth" id="frm_manageauth">
			<input type="hidden" name="tasktype" id = "tasktype" value="3" />
			<!--创建 编辑 列表-->
			<input type="hidden" name="z1" id = "z1" value="{{z1}}" />
			<!--manageauthId-->
			<input type="hidden" name="z3" id = "z3" value="{{z3}}" />
			<!--manageauthId-->
			<input type="hidden" name="z4" id = "z4" value="{{z4}}" />
			<!--manageauthId-->
			<input type="hidden" name="z5" id = "z5" value="{{z5}}" />
			<input type="hidden" name="z6" id = "z6" value="{{z6}}" />
			<!--manageauthId-->
			<input type="hidden" name="manageauthId" id = "manageauthId" value="0" />
			<!--manageauthId-->
			<input type="hidden" name="paging" id = "paging" value="{{paging}}" />
			<!--页码-->
			<input type="hidden" name="us" id="us" value = "{{user}}"/>
			<input type="hidden" name="user" id="user" value = "{{user}}"/>
			<input type="hidden" name="search_typeall" id = "search_typeall" value="{{search_typeall}}" />
			<input type="hidden" name="e" id = "e" value="{{e}}" />
			<input type="hidden" name="se" id = "" value="{{se}}" />
			<input type="hidden" name="a0" id = "" value="{{se}}" />
			<!--search_typeall-->
	</form>

<style>
	.fsel {
		position: fixed;
		margin: -67px 0 0 -20px;
		width: 580px;
		height: 45px;
		background: #FFF;
	}
	.fsel ul li {
		float: left;
	}

	.fsel ul li a.active {
		border-top: 5px solid #4cb2d0;
		border-right: 1px solid #DDD;
		border-left: 1px solid #DDD;
		line-height: 41px;
		border-bottom: 1px solid #FFF;
	}
	.fsel ul li a {
		float: left;
		padding: 0 32px;
		line-height: 45px;
		font-size: 18px;
		color: #000;
	}
	.ui-dialog-body{
		padding: 20px 0 0 0;
	}
	#importPage{
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: #f3f3f3;
		overflow: auto;
	}
	.apItem .label.succ:before{
		content: '';
		float: left;
		width: 20px;
		height: 20px;
		margin: 3px 14px 0 14px;
		background: url(/manage/images/user_succ.png) no-repeat 0 0;
	}
	.apItem .label.fail:before{
		content: '';
		float: left;
		width: 20px;
		height: 20px;
		margin: 3px 14px 0 14px;
		background: url(/manage/images/user_fail.png) no-repeat 0 0;
	}
	.apItem {
		width: 50%;
		padding: 5px 0;
		overflow: hidden;
		transition: background-color 0.4s;
		float: left;
	}
	#usertask_list .tab-ctr {
		display: none !important;
	}
	#usertask_list tr:hover td div.tab-ctr {
		display: block !important;
	}	
</style>
<script>
	$('.form-checkbox,.form-radio').iCheck({
		checkboxClass: 'icheckbox_minimal-blue',
	    radioClass: 'iradio_minimal-blue',
	    increaseArea: '0' // optional
	});
$('.filter-select').select2({minimumResultsForSearch: -1});
</script>
<!---->
<script>
var usercode="";
var delect_str = new Array();
var check_num=0;
var fenye_r=0;
var manageauth_array=null;
//总页码
var search_typeall_r=document.frm_manageauth.search_typeall.value;
//关键字
$(function(){
	// $('#manageauth_text').show();
	// $('#manageauth_text').hide();
	// $("#manageauth_select").change(function(){
	// 	var type = $(this).val();
	// 	if(type == 0){
	// 		$("#manageauth_text").hide();
	// 		$('#filterWW').hide();
	// 		$('#clearFilter').hide();
	// 	}else{
	// 		$("#manageauth_text").show();
	// 		if($('#filterWW ul li').length){
	// 			$('#filterWW').show();
	// 			$('#clearFilter').show();
	// 		}
	// 	}
	// });
	usercode=window.parent.document.frm.us.value;
	////////console.log("function"+document.frm_manageauth.paging.value);
	if(search_typeall_r!=""){
		var v1="";
		var id="";
		var str_new="";
		var search_typeall_str=search_typeall_r.split('\t');
		////////console.log(search_typeall_str);
		$.each(search_typeall_str,function(i,item){
			if(item==""){
				return false;
			}
			var str_sea=item.split("-");
			v1=$('#manageauth_select').find('option[value='+str_sea[0]+']').text();
			////////console.log('v1'+v1);
			id=item;
			str_sea[0]=v1;
			str_new=str_sea.join('-');
			////////console.log("str_new"+str_new+"---id"+id);
			$('#filterWW>ul').append('<li><span style = "display:none">'+id+'</span><span class="ww">'+str_new+'</span><i class="del" onclick="_delFilter(this);"></i></li>');
			selView();
		});
	}
	var search_typeall_select=document.frm_manageauth.e.value.substr(document.frm_manageauth.e.value.indexOf(':')+1,document.frm_manageauth.e.value.length-1);
	if(search_typeall_select!=''){
		var array=new Array();
		array[0]=search_typeall_select.substr(0,search_typeall_select.indexOf('-'));
		array[1]=search_typeall_select.substr(search_typeall_select.indexOf('-')+1,search_typeall_select.length);
		////////console.log(array);
		$('#manageauth_select').val(array[0]).trigger('change');
		$('#manageauth_text').val(array[1]);
		if(array[1]!=''){
			$('#manageauth_text_check').show();
		}
	}
	//输入数字
	$('#manageauth_page').bind('keydown', function(e){
		DigitInput(e);
	});
	//页码显示
	$("#page_nums").val(MAX_PAGE);
	//list show
	show_manageauth_list();
	//tr双击事件
	$("#manageauth_list").on('dblclick','tr',function(e){
		x=e.target;
		if(x.nodeName !='A' && x.nodeName !='INS'){
			var id=$(this).find("td");
			var edit_item=$(id).eq(1).text();
			document.frm_manageauth.manageauthId.value=edit_item;
			document.frm_manageauth.tasktype.value=2;
			document.frm_manageauth.e.value=search_typeall_new+':'+$('#manageauth_select').val()+'-'+$('#manageauth_text').val();	
			document.frm_manageauth.search_typeall.value=search_typeall_r;	
			document.frm_manageauth.action = '/bhost/manage_auth_add';
			document.frm_manageauth.submit();
		}
	}).on("click", "tr", function (e){  
		x=e.target;
		//删除按钮
		if(x.id == 'del'){
			var id=$(this).find("td");
			var input  = $(this).find("input"); 
			$('.btn').blur();parent.layer.open({
				type:1,
				title: ' 管理授权',
				content: '<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
				btn:['删&nbsp;&nbsp;除','取&nbsp;&nbsp;消'],
				btnAlign:'c',
				closeBtn: false,
				skin:'layer-custom',
				area:['380px','310px'],
				move: false,
				resize: false,
				yes:function(i){
					parent.layer.close(i);
					var delete_item=$(id).eq(1).text();			
					// $(input).iCheck('uncheck');
					delete_fun(delete_item+'\t'+$(id).eq(2).text());
				}
			});
		}
		//编辑按钮
		if(x.id == 'edit'){
			var id=$(this).find("td");
			var edit_item=$(id).eq(1).text();
			document.frm_manageauth.manageauthId.value=edit_item;
			document.frm_manageauth.tasktype.value=2;
			document.frm_manageauth.search_typeall.value=search_typeall_r;	
			document.frm_manageauth.e.value=search_typeall_new+':'+$('#manageauth_select').val()+'-'+$('#manageauth_text').val();	
			document.frm_manageauth.action = '/bhost/manage_auth_add';
			document.frm_manageauth.submit();
		}
	});
	$('#check_one_page').on(' ifClicked',function(e){
		if(!$('#check_one_page').is(':checked')){
			$("table tbody tr input").iCheck('check');
		}else{
			$("table tbody tr input").iCheck('uncheck');
		}
		
	});
	$("#manageauth_list").on("ifChecked",function(e){
		check_num++;
		$("span.sum").text(check_num);		
		if($("table tbody tr input:checked").length==$("table tbody tr").length){
			$('#check_one_page').iCheck('check');
		}
	}).on("ifUnchecked",function(e){
		check_num--;
		$("span.sum").text(check_num);	
		$('#check_one_page').iCheck('uncheck');	
	});
});
function manage_add(){
	document.frm_manageauth.tasktype.value=3;
	document.frm_manageauth.user.value = window.parent.document.frm.us.value;
	document.frm_manageauth.action = '/bhost/manage_auth_add';
	document.frm_manageauth.paging.value =1;
	document.frm_manageauth.search_typeall.value ='';
	document.frm_manageauth.e.value =':'
	document.frm_manageauth.submit();
}
function back(){
	document.frm_manageauth.tasktype.value = 3;
	document.frm_manageauth.action = '/bhost/index';
	document.frm_manageauth.submit();
}
//显示创建页面
function manageauth_add(){
	document.frm_manageauth.tasktype.value=1;
	document.frm_manageauth.manageauthId.value=0;
	document.frm_manageauth.e.value=search_typeall_new+':'+$('#manageauth_select').val()+'-'+$('#manageauth_text').val();	
	document.frm_manageauth.action = '/bhost/manage_auth_add';
	document.frm_manageauth.search_typeall.value=search_typeall_r;	
	document.frm_manageauth.submit();
}
//刷新
function clear_all(){
	$("table tbody tr input").iCheck('uncheck');
	delect_str=new Array();
	check_num=0;
	$("span.sum").text(check_num);
}
var search_typeall_new=document.frm_manageauth.e.value.substr(0,document.frm_manageauth.e.value.indexOf(':'));
function update_array(){
	var search_typeall=search_typeall_r+search_typeall_new;
	var manageauthId=document.frm_manageauth.manageauthId.value;
	$.ajax({
		url: "/bhost/get_manageauth_list",
		type:"POST",
		async:true,
		data:{a0:$("input[name=se]").val(),a2:search_typeall,a1:manageauthId},
		success:function(result){
			var manageauth_result = JSON.parse(result);
			if (manageauth_result.Result){
				var manageauth_data = manageauth_result.info;
				var delect_str_old=delect_str;
				delect_str=new Array();
				manageauth_array=manageauth_data.data.map(function (params) {
					if($.inArray(params.ManageAuthId+'\t'+params.ManageAuthName,delect_str_old)>=0){
						delect_str.push(params.ManageAuthId+'\t'+params.ManageAuthName);
					}
					return params.ManageAuthId+'\t'+params.ManageAuthName;
				});
			}else{
				_alert(1,' 管理授权',manageauth_result.ErrMsg);
				return false;
			}
		}
	});
}
String.prototype.ResetBlank=function(){
		var regEx = /\s+/g; 
		return this.replace(regEx, ' '); 
	};
function _addFilter(obj,type,type_num){
	var id = $(obj).parent().children('select').children('option:selected').val();
	var v1 = $(obj).parent().children('select').children('option:selected').text();
	var v2 = $(obj).parent().children('input[type=text]').val().trim();
	if(id=='all'){
		v1='';
	}else{
		v1=v1+'-';
	}
	v2=v2.ResetBlank();
	if(v2 == '' && type_num!=1){
		$(obj).parent().children('input[type=text]').blur();
		_alert(2,'搜索','请输入关键字',$(obj).parent().children('input[type=text]'));
		return false;
	}
	// else
	{
		switch (id) {
			case 'ManageAuthName':
				var Reg=/^[\u4e00-\u9fa5a-zA-Z\d_\-\.\s]+$/;
				break;
			case 'user':
				var Reg=/^[a-zA-Z\d_\-\.\s]+$/;
				break;
			case 'userGroup':
				var Reg=/^[\u4e00-\u9fa5a-zA-Z\d_\-\.\s]+$/;
				break;
			case 'ClientScopeName':
				var Reg=/^[\u4e00-\u9fa5a-zA-Z\d_\-\.\s]+$/;
				break;
			case 'ServerScopeName':
				var Reg=/^[\u4e00-\u9fa5a-zA-Z\d_\-\.\s]+$/;
				break;
		} 
		if(id!='all' && !Reg.test(v2) && type_num!=1){
			$(obj).parent().children('input[type=text]').blur();
			_alert(1, '搜索', '关键字格式不正确', $(obj).parent().children('input[type=text]'));
			return false;
		}
		if(search_typeall_r.indexOf(id+'-'+v2+'\t')>=0 && type_num!=1){
			$(obj).parent().children('input[type=text]').blur();
			_alert(2,'关键字输入','相同的关键字已存在', $(obj).parent().children('input[type=text]'));
			return false;
		}
		if(type){
			search_typeall_r=search_typeall_r+id+'-'+v2+'\t';
			search_typeall_new='';
			$(obj).parent().children('input[type=text]').val('');
			$('#filterWW>ul').append('<li><span style = "display:none;">'+id+'-'+v2+'</span><span class="ww">'+v1+v2+'</span><i class="del" onclick="_delFilter(this);"></i></li>')
			$('#manageauth_text_check').hide();
			selView();
		}else{
			if(type_num!=1) search_typeall_new=id+'-'+v2+'\t';
		}
		$("table tbody tr input").iCheck('uncheck');
		delect_str=new Array();
		manageauth_page(0.1);
		check_num=0;
		$("span.sum").text(check_num);
	}
	
}
function _clearFilter(obj,num){
	if(num==1){
	$('#manageauth_text').val('');
	$('#manageauth_text_check').hide();
	search_typeall_new='';
	$("table tbody tr input").iCheck('uncheck');
		delect_str=new Array();
		manageauth_page(0.1);
		check_num=0;
		$("span.sum").text(check_num);
		return;
	}
	$('#clearFilter').next().children('ul').empty();
	$('#manageauth_text').val('');
	$('#manageauth_text_check').hide();
	$('#clearFilter').hide();
	search_typeall_new='';
	search_typeall_r='';
	selView();
	$("table tbody tr input").iCheck('uncheck');
		delect_str=new Array();
		manageauth_page(0.1);
		check_num=0;
		$("span.sum").text(check_num);
}
function selView(){
	var $sel = $('#filterWW');
	var len = $('li',$sel).length;

	if(len == 0){
		$sel.hide();
		$('#clearFilter').hide();
	}else{
		$("#filterWW").show();
		$('#clearFilter').show();
		$('>span.ww',$sel).show();
		$sel.addClass('selector-multiple');
	}
}
function _delFilter(obj){
	var id = $(obj).parent().find("span");
	var ids=$(id).eq(0).text();
	search_typeall_r = search_typeall_r.replace(ids+'\t','');
	var manageauth_text=$('#manageauth_text').val().trim();
	if(manageauth_text==''){
		search_typeall_new=='';
	}else{
		search_typeall_new=$('#manageauth_select').val()+'-' +manageauth_text+'\t';
	}
	$(obj).parent().remove();
	selView();
	$("table tbody tr input").iCheck('uncheck');
		delect_str=new Array();
		manageauth_page(0.1);
		check_num=0;
		$("span.sum").text(check_num);
}
//选中字段存储
function delect_save(){
	$(">tr","#manageauth_list").each(function(){
		var input  = $(this).find("input[type='checkbox']");
		var delect_item=$(">td",this).eq(1).text()+'\t'+$(">td",this).eq(2).text();
		var index=$.inArray(delect_item,delect_str);
		if($(input).is(':checked')){
			if(index<0){
				delect_str.push(delect_item);
			}
		}else{
			if(index>=0){
				delect_str.splice(index,1);
			}
		}
	});
}
function cmd_auth(){
	document.frm_manageauth.tasktype.value=0;
	document.frm_manageauth.z1.value=0;
	document.frm_manageauth.action = '/bhost/auth_manage_xtc';
	document.frm_manageauth.submit();
}
function fw_z()
{
	document.frm_manageauth.z3.value=2;
	document.frm_manageauth.z4.value="[]";
	document.frm_manageauth.z5.value=0;
	document.frm_manageauth.z6.value="[]";
	document.frm_manageauth.action = '/bhost/show_manage_accessauth';
	document.frm_manageauth.submit();
}
//check显示
function check_show(){
	$(">tr","#manageauth_list").each(function(){
		var input  = $(this).find("input[type='checkbox']");
		var check_id=$(">td",this).eq(1).text()+'\t'+$(">td",this).eq(2).text();
		if($.inArray(check_id,delect_str)>=0){
			$(this).find("input[type='checkbox']").iCheck('check');
		}
	});
}
//input回车触发事件
function showMsg(){
	delect_save();
	var cur = $("#manageauth_page").val();
	cur=cur.replace(/\D/g, "");
	if(cur=='' || parseInt(cur) < 1){
		cur=1;
	}else if (parseInt(cur)>fenye_r) {
		cur=fenye_r;
	}
	//////////console.log(cur);
	if (parseInt(cur) ==parseInt(document.frm_manageauth.paging.value)){
		$("#manageauth_page").val(cur);
		return false;
	}
	document.frm_manageauth.paging.value=cur;
	show_manageauth_list();
}
//以每页显示数显示列表函数
function show_manageauth_list(){
	update_array();
	var paging = document.frm_manageauth.paging.value;
	//////////console.log("paging"+paging);
	var page_num = MAX_PAGE;
	var manageauthId=document.frm_manageauth.manageauthId.value;
	var search_typeall=search_typeall_r+search_typeall_new;
	$.ajax({
		url: "/bhost/get_manageauth_list",
		type:"POST",
		async:false,
		data:{a0:$("input[name=se]").val(),a4:page_num,a3:paging,a2:search_typeall,a1:manageauthId},
		success:function(result){
			var manageauth_result = JSON.parse(result);
			if (manageauth_result.Result==true){
				var manageauth_data = manageauth_result.info;
				var total_all = manageauth_data.totalrow;
				if(total_all%MAX_PAGE==0){
					fenye_r=parseInt(total_all/MAX_PAGE);
				}else{
					fenye_r=parseInt(total_all/MAX_PAGE)+1;
				}
				if(manageauth_data.data=="" && paging!="1"){
					manageauth_page(0.9);
				}else{
					if(total_all){
						$("#manageauth_list").empty();
						$.each(manageauth_data.data,function(i,item){
								if(item.ManageAuthName==null){
									item.ManageAuthName="";
								}
								switch(item.ManageScopeMode){
									case 1:
										item.ManageScopeMode="只读";
										break;
									case 2:
										item.ManageScopeMode="可写";
										break;
								}
								var client_str = "";
								$.each(item.CScopeSet,function(i1,item1){
									if(item1.ClientScopeName!=null){
										client_str = client_str+item1.ClientScopeName+"，";
									}
								});
								client_str=client_str.substr(0,client_str.length-1);
								var server_str = "";
								$.each(item.MScopeSet,function(i1,item1){
									
									if(item1.ServerScopeName!=null){
										server_str = server_str+item1.ServerScopeName+"，";
									}
								});
								server_str=server_str.substr(0,server_str.length-1);
								var ugroup="";
								var user="";
								$.each(item.UserSet,function(i1,item1){
									if(item1.Type==1){
										user=user+item1.Name+'，';
									}else{
										ugroup=ugroup+'['+item1.Name+']，';
									}
								});
								ugroup=ugroup.substr(0,ugroup.length-1);
								user=user.substr(0,user.length-1);
								// float_str = (client_str==''?'':"<p>客户端范围："+HTMLEncode(client_str)+"</p>")+
								// (server_str==''?'':"<p>服务器范围："+HTMLEncode(server_str)+"</p>");
								$("#manageauth_list").append("<tr>"+
								"<td "+(perm==1?'style = \"display:none\"':'')+" class=\"in\"><input type=\"checkbox\" class=\"input_checkbox\" /></td>"+
								"<td style = \"display:none\">"+item.ManageAuthId+"</td>"+
								"<td "+(perm==1?'style = \"border-left: 1px solid #FFF; \"':'')+" title='"+item.ManageAuthName+"'>"+item.ManageAuthName+"</td>"+
								// "<td>"+item.ManageScopeMode+"</td>"+
								"<td title='"+user+"'>"+user+"</td>"+
								"<td title='"+ugroup+"'>"+ugroup+"</td>"+
								"<td title='"+client_str+"'>"+client_str+"</td>"+
								"<td title='"+server_str+"'>"+server_str+"</td>"+
								"<td><div class=\"tab-ctr\">"+
								"<a href=\"javascript:;\" class=\""+(perm==2?'edit':'search_result')+"\" id=\"edit\" title='"+(perm==2?'编辑':'查看')+"'></a>"+
								(perm==2?"<a href=\"javascript:;\" class=\"del\" id=\"del\" title='删除'></a></div>":"")+
								// (float_str!=''?"<div class=\"tab-moreinfo\">"+float_str+"</div>":'')+
								"</td></tr>");
						});
						// tabArr();
						$(".input_checkbox","#manageauth_list").iCheck({
							checkboxClass: 'icheckbox_minimal-blue',
							radioClass: 'iradio_minimal-blue',
							increaseArea: '0' // optional
						});
						$("#manageauth_total").text(total_all);
						if(paging>=fenye_r){
							paging=fenye_r;
						}
						document.frm_manageauth.paging.value=paging;
						document.getElementById("manageauth_page").value=paging;
						$("#manageauth_pages").text(fenye_r);
						$('#check_one_page').iCheck('uncheck');	
						$("table tbody tr input").iCheck('uncheck');
						check_show();
						//////////console.log(paging);
						check_num=delect_str.length;
						$("span.sum").text(check_num);
					}else{
						$("span.sum").text(0);
						$('#check_one_page').iCheck('uncheck');	
						$("table tbody tr input").iCheck('uncheck');
						$("#manageauth_list").empty();
						$("#manageauth_total").text(total_all);
						$("#manageauth_pages").text(1);
						document.frm_manageauth.paging.value=1;fenye_r=1;
						document.getElementById("manageauth_page").value=1;
					}	
				}
			}else{
				_alert(1,"管理授权",manageauth_result.ErrMsg);
				$('#check_one_page').iCheck('uncheck');	
				$("table tbody tr input").iCheck('uncheck');
				$("span.sum").text(0);
				$("#manageauth_total").text(0);
				$("#manageauth_pages").text(1);
				document.frm_manageauth.paging.value=1;fenye_r=1;
				document.getElementById("manageauth_page").value=1;
				return false;
			}
		}
		
	});
	
	//////////console.log(paging);
	//////////console.log('ajax end');
}
// <!-- //显示列表 -->
// <!-- $(document).ready(function(){ -->
// 	<!-- //以下3行用来回显默认每页10条 -->
// 	<!-- $("#page_nums option:eq(10)").prop("selected",true); -->
	
// <!-- }) -->
//分页 and 刷新
function manageauth_page(num){
	//////////console.log("manageauth_page1:num"+num);
	var paging=parseInt(document.frm_manageauth.paging.value)+num;
	//////////console.log("manageauth_page"+paging);
	if(paging==0 || paging==fenye_r+1){
		return false;
	}
	delect_save();
	var manageauth_list_s = [];
	
	if (num == 0.1){
		paging = 1;
	}else if(num == 0.9){
		paging=fenye_r;
	}
	$("span.sum").text(0);
	document.getElementById("manageauth_page").value=paging;
	document.frm_manageauth.paging.value=paging;
	show_manageauth_list();
}
//全选按钮
function click_all_list(){
	delect_save();
	if(delect_str.length==manageauth_array.length){
		delect_str=new Array();
	}else{
		delect_str=manageauth_array;
	}
	show_manageauth_list();
}
//删除函数
function delete_fun(delect_str_1){
	$.ajax({
		url: '/bhost/del_manageauth',
		type: "POST",
		async:false,
		data: {a0:$("input[name=se]").val(),a1:delect_str_1},
		success: function(result) {
			var result = JSON.parse(result);
			if(result.Result == true){
				manageauth_page(0);
				// _alert(0,"管理授权","删除成功");
				if(result.fail_num!=0){
					if (result.success_num!=0)
						_alert(0,"管理授权","成功："+result.success_num+'，失败：'+result.fail_num);
					else
						if ((result.fail_num+success_num)==1)
							_alert(1,"管理授权",result.ErrMsg);
						else
							_alert(0,"管理授权",'失败：'+result.fail_num);
				}else{
					_alert(0,"管理授权","删除成功");
				}
			}else{
				manageauth_page(0);
				_alert(1,"管理授权",result.ErrMsg);
				return false;
			}	
		}
	});
}
//删除按钮
function delete_list(){
	delect_save();
	if(delect_str.length == 0){
		_alert(2,"管理授权","请选择要删除的数据");
		return false;
	}
	//利用对话框返回的值 （true 或者 false） 
	$('.btn').blur();parent.layer.open({
		type:1,
		title: ' 管理授权',
		content: '<div class="layer-alert"><i class="alert warning"></i>是否批量删除</div>',
		btn:['删&nbsp;&nbsp;除','取&nbsp;&nbsp;消'],
		btnAlign:'c',
		closeBtn: false,
		skin:'layer-custom',
		area:['380px','310px'],
		move: false,
		resize: false,
		yes:function(i){
			parent.layer.close(i);
			delete_fun(delect_str.join(',')); 
			delect_str=new Array();
			check_num=0;
			$("span.sum").text(check_num);
		}
	});
}
function manage_work(){
	document.frm_manageauth.z1.value=1;
	document.frm_manageauth.z3.value=2;
	document.frm_manageauth.z4.value="[]";
	document.frm_manageauth.z5.value=0;
	document.frm_manageauth.z6.value="[]";
	document.frm_manageauth.action = '/bhost/show_manage_workorder';
	document.frm_manageauth.submit();
}

</script>
<script>
function _closeDetail(type) {
	if (type == 1){
		$('#allPage').hide();
	}else{
		$('#importPage').hide();
	}
	$(".container3").show();
	_import_user(1);
	$("#task_list_tab").click();
}

function _reloadDetail(type) {
	$('#apArea1').empty();
	$('#aploadTip1').html('正在加载').hide();
	page = 0;
	ppage = 0;
	append_flag = 0;
	row_len = 0;
	hostip = "";
	remain_page = 0;
	page_flag = 0;
	same_page = 0;
	_initLoadData1();
}

function get_task_data(){
	$.ajax({  
		url:'/bhost/get_manage_auth_task_data',
		type:"post",
		async:false,
		data:{a0:$("input[name=se]").val(),a1:'null',a2:'null'},
		success:function(result){
			var result = JSON.parse(result);
			$.each(result.data,function(i,item){
				selectid.push(item.AuthImportTaskId);
			});
		}
	});
}

//全选任务
function select_all(){
	selectid=[];
	var select_total = $("#select_total").text();
	var task_total = $("#task_total").text();
	if (parseInt(select_total) == parseInt(task_total)){
		$("#usertask_list").find('input').iCheck('uncheck');
	}else{
		get_task_data();
		$("#usertask_list tbody input[type='checkbox']").each(function(){
			if (!$(this).prop("disabled")){
				$(this).iCheck('check');   
			}
		})      
	}
	$("#select_total").text(selectid.length);
}

//刷新任务
function fresh_task_list(){
	get_usertask_list();
	selectid = [];
	$("#details_module input[type='checkbox']").each(function(){	
		$(this).iCheck('uncheck');
	});
	$("#select_total").text(0);
}

function delete_usertask(type,id){
	////////////console.log("id:"+id);
	$.ajax({
		url:'/bhost/del_manage_auth_task',
		type:'post',
		async:false,
		data:{a0:$("input[name=se]").val(),a1:id},
		success:function(result){
			del_result = JSON.parse(result);
			if (del_result.Result){
				_alert(0,"管理授权","删除成功");
				$('div.tab-moreinfo-on').hide();
				return false;
			}else{
				_alert(1,"管理授权",del_result.ErrMsg);
				return false;
			}
		}
	})
}

function del_usertask_r(id){
	$('.btn').blur();
	parent.layer.open({
		type:1,
		title:"管理授权",
		content:'<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
		btn:['确&nbsp;&nbsp;定','取&nbsp;&nbsp;消'],
		btnAlign:'c',
		closeBtn: false,
		skin:'layer-custom',
		area:['380px','310px'],
		move: false,
		resize: false,
		btn1:function(i){
			parent.layer.close(i);
			delete_usertask(0,id);
			for (var i = 0; i < selectid.length; i++){      
				if (selectid[i] == parseInt(id)){
					num = $("#select_total").text();
					num = parseInt(num)-1;
					$("#select_total").text(num);
					selectid.splice($.inArray(parseInt(id),selectid),1);
					break;
				}
        	}
			get_usertask_list();
		},
		btn2:function(i){
			parent.layer.close(i);
		}
	});
}
//批量删除
function del_hosttask_more(){
	if (selectid.length == 0){
		_alert(2,"管理授权","请选择要删除的数据");
		return;
	}
	$('.btn').blur();
	parent.layer.open({
		type:1,
		title:"管理授权",
		content:'<div class="layer-alert"><i class="alert warning"></i>是否批量删除</div>',
		btn:['确定','取消'],
		btnAlign:'c',
		closeBtn: false,
		skin:'layer-custom',
		area:['380px','310px'],
		move: false,
		resize: false,
		btn1:function(i){
			parent.layer.close(i);
			selectid_str = selectid.toString();
			delete_usertask(1,selectid_str);
			selectid=[];
			get_usertask_list();
		},
		btn2:function(i){
			parent.layer.close(i);
		}
	});
}

function filetip(obj){
	////////////console.log("aaaaaaaaaaa");
	var c=$(obj).val();
	////////////console.log(c)
	c = c.split("\\");
	var b = c[c.length-1];
	////////////console.log(b);
	$('#file_v').val(b);
}
var setinterval=null;
function browes(){
	if(use_BH=='0'){
		$("#file_change1").click();
		return 0;
	}
	var referrer_arr=document.referrer.toString().split('/');
	referrer_arr.pop();
	var referrer=referrer_arr.join('/');
	var sesstimet = (new Date()).valueOf();
	var json_download = {
			"Type": "Upload",
			"Url": referrer,
			"Path": "/usr/storage/.system/upload/",
			"Filename": sesstimet+'',
			"Session": $("input[name=se]").val(),
			"sesstimet":sesstimet+''
	}
	var if_html_client = false;
	var base64_str = '';
	$.ajax({
			url: "/bhost/get_base64",
			type:"POST",
			async:false,
			data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(json_download)},
			success:function(result){
					var result=JSON.parse(result);
					if(result.Result){
							if_html_client = result.info;
							base64_str = result.b64;
					}else{
							_alert(1,"授权导出",result.ErrMsg); 
					}
			}
	})
	if(if_html_client) window.open('https://'+document.domain+':'+location.port+'/bhost/test_html?se='+window.parent.document.frm.se.value+'&z1='+JSON.stringify(json_download));
	else{
		get_regedit('bhost', window.parent.document.frm.se.value,'',sesstimet);
		$('#YuFrame1').remove();
		$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
		$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+base64_str);
	}
	clearInterval(setinterval);
	setinterval=setInterval(function(){
		$.ajax({
			url: "/bhost/find_item_sql",
			type:"POST",
			async:false,
			data:{a0:window.parent.document.frm.se.value,a1:sesstimet},
			success:function(result){
				var result=JSON.parse(result);
				if(result.Result){
					if(result.info==null){

					}else{
						var info_arr=result.info.split('/');
						if(info_arr.length>1){
							$('#file_v').val(info_arr.pop());
							$('#file_change').val('/usr/storage/.system/upload/'+sesstimet);
						}else{
							if(result.info=='NULL'){
								$('#file_v').val('');
								$('#file_change').val('');
							}else{
								$('#file_v').val(result.info);
								$('#file_change').val('/usr/storage/.system/upload/'+sesstimet);
							}
						}
						
						clearInterval(setinterval);
					}
				}
			}
		});
	}, 3000);
}

var task_list_detail;
function _initLoadData() {
	var h1 = $('#allPage').height();
	var h2 = $('#apArea').height();
	var add = function() {
		if (h1 - 203 > h2){
			page++;
			get_data(page,10);
			h2 = $('#apArea').height();
		}else{
			clearInterval(if_select);
			return false;
		}
	}

	var if_select = setInterval(function(){
		if (h1 - 203 <= h2 || task_list_detail.totalrow <= 10){
			clearInterval(if_select);
			return false;
		}
		add();	
	},1000);

	add();
}

var keyword_re=[];//搜索条件
var selectid = [];
function get_usertask_list(){
	var MAX_PAGE = 5;
	var cur = $("#curpage").val();
	$.ajax({
		url:'/bhost/get_manage_auth_task_data',
		type:'post',
		async:false,
		data:{a0:$("input[name=se]").val(),a1:cur,a2:MAX_PAGE},
		success:function(result){
			task_list = JSON.parse(result);
			$("#usertask_list tbody").empty();
			var Status = "";
			var succcount;
			var FailCount;
			var ErrorLog;
			$.each(task_list.data,function(i,item){
				if(item.Type !=4 ) return true;
				if(item.Status == 0){
					Status = "正在执行";
				}else if(item.Status == 1){
					Status = "执行完成";
				}else if(item.Status == 2){
					Status = "执行失败";
				}
				if (item.SuccCount == null){
					SuccCount = "";
				}else{
					SuccCount = item.SuccCount;
				}
				if (item.FailCount == null){
					FailCount = "";
				}else{
					FailCount = item.FailCount;
				}
				if (item.ErrorLog == null){
					ErrorLog = "";
				}else{
					ErrorLog = item.ErrorLog;
				}
				var HostCount = parseInt(SuccCount) + parseInt(FailCount);
				float_str = "<p>错误信息："+ErrorLog+"</p>";
				$("#usertask_list tbody").append('<tr><td width="50"><input type="checkbox" class="form-checkbox" value="'+item.AuthImportTaskId+'"/></td><td title="'+item.AuthImportTaskName+'">'+item.AuthImportTaskName+'</td><td title="'+SuccCount+'">'+SuccCount+'</td><td title="'+FailCount+'">'+FailCount+'</td><td title="'+Status+'">'+Status+'</td><td title="'+ErrorLog+'">'+ErrorLog+'</td><td width="50"><div class=\"tab-ctr\"><a href="javascript:;" class="icon7" id="edit" title="导入详情" data="'+item.AuthImportTaskName+'" data1="'+item.Status+'"onclick="task_detail(this,'+item.AuthImportTaskId+');"></a><a href=\"javascript:;\" class=\"del\" id=\"del\" title="删除任务" onclick=\"del_usertask_r('+item.AuthImportTaskId+')\"></a></div><div class="tab-moreinfo">'+float_str+'</div></td></tr>');
			});
			$('.form-checkbox,.form-radio').iCheck({
				checkboxClass: 'icheckbox_minimal-blue',
				radioClass: 'iradio_minimal-blue',
				increaseArea: '0' 
			});
		}
	});
	tabArr1();
	$("#task_total").text(task_list.totalrow);
	totalpage = Math.ceil(parseInt(task_list.totalrow)/MAX_PAGE);
	if (totalpage < 1){
		totalpage = 1;
	}
	$("#totalpage").text(totalpage.toString());
	$("#page_total").text(MAX_PAGE);
	//<tr>中选择按钮进行设置
	$('#check_task_page').iCheck('uncheck');
	var check_page_flag = 0;
	$("#usertask_list tbody input[type='checkbox']").each(function(){
		if ($.inArray(parseInt(this.value), selectid) != -1){					
			$(this).iCheck('check');
			check_page_flag++;
		}
	});
	if (check_page_flag == $("#usertask_list tbody input[type='checkbox']").length && check_page_flag != 0){
		$('#check_task_page').iCheck('check');
	}
	if (parseInt(cur) > totalpage){
		$("#curpage").val(totalpage);
		get_usertask_list();
	}
	var flag_id = 0;
	num = selectid.length;
	$("#select_total").text(num);
	$("#usertask_list tbody input[type='checkbox']").on("ifChanged",function(){
		if ($(this).is(":checked")){
			num = $("#select_total").text();   
			num++;
			if (selectid.indexOf(parseInt(this.value)) == -1){
				selectid.push(parseInt(this.value))	
			}
			$("#select_total").text(num);
		}else{
			num = $("#select_total").text();
			num--;
			selectid.splice($.inArray(parseInt(this.value),selectid),1);
			$("#select_total").text(num);   
		}
		var check_num = 0;
		$("#usertask_list tbody input[type='checkbox']").each(function(){
			if (!$(this).prop("disabled")){
				check_num++;
			}
		}) 
		if ($("#usertask_list tbody").find('input[type=checkbox]:checked').length == check_num){
			$('#check_task_page').iCheck('check');
		}else{
			$('#check_task_page').iCheck('uncheck');
		}
	});
	$('#check_task_page').on('ifClicked',function(e){
		if(!$('#check_task_page').prop('checked')){
			$("#usertask_list tbody input[type='checkbox']").each(function(){
				$(this).iCheck('check');   
			}) 
		}else{
			$("#usertask_list").children('tbody').find('input[type=checkbox]').iCheck('uncheck');
		}
	});	
}
//切换导入/任务
function set_tab(obj,type){
	if (type == 1){
		$("#import_module").show();
		$("#details_module").hide();
	}else if(type == 2){
		$("#details_module").show();
		$("#import_module").hide();
	}
	$(obj).addClass("active").parent().siblings().children().removeClass("active");
	if (type == 2){
		clearInterval(if_ok);
		get_usertask_list();
		repeat_execute = function(){
			if_ok = setInterval(function(){
				get_usertask_list();
			},5000)}
		repeat_execute();
	}else{
		clearInterval(if_ok);
	}
	var w = $(window).width();
	
}

var d;
var if_ok;
var if_ok_down;
var host_task_id;
var MAX_PAGE_T = 5;
function task_detail(obj,id){
	var filename = $(obj).attr('data');
	status = $(obj).attr('data1');
	var host_count = $(obj).attr('data2');
	var acct_count = $(obj).attr('data3');
	$("#hosttask_list_detail tbody").empty();
	$("#cover_box").iCheck('uncheck');
	$("#import_host_list_detail tbody").empty();
	$(".tab-moreinfo.tab-moreinfo-on").remove();
	$('#apArea').empty();
	$('#apArea1').empty();
	page = 0;
	ppage = 0;
	append_flag = 0;
	row_len = 0;
	remain_page = 0;
	page_flag = 0;
	same_page = 0;
	keyword_t = null;
	if (status == 0){
		_alert(2,"管理授权","该任务正在导入中");
		return false;
	}
	if (status == 2){//导入中断
		_alert(1,"管理授权","该任务发生错误");
		return false;
	}
	d.close().remove();
	var succ_flag = $(obj).parents('tr:first').children('td:eq(2)').text();
	var fail_flag = $(obj).parents('tr:first').children('td:eq(3)').text();
	clearInterval(if_ok);
	if (status == 1){//导入完成
		$("#fail_IP_box").iCheck('uncheck');
		$(".mm.mm1").children('span').eq(0).text(parseInt(succ_flag)+parseInt(fail_flag));
		$(".mm.mm1").children('span').eq(1).text(succ_flag);
		$(".mm.mm1").children('span').eq(2).text(fail_flag);
		host_task_IP_id = id;
		_initLoadData1();
		$("#fail_IP_box").on('ifChanged',function(){//仅显示导入失败的用户信息
			if ($(this).prop("checked")){
				keyword_t = 1;
			}else{
				keyword_t = null;
			}
			$('#apArea1').empty();
			page = 0;
			ppage = 0;
			append_flag = 0;
			row_len = 0;
			remain_page = 0;
			page_flag = 0;
			same_page = 0;
			_initLoadData1();
		});
		$(".container3").hide();
		$('#importPage').show();
	}
}

function _initLoadData1() {
	var h1 = $('#importPage').height();
	var h2 = $('#apArea1').height();
	var add = function() {
		////////console.log("add");
		////////console.log("h1:"+h1);
		////////console.log("h2:"+h2);
		if (h1 - 203 > h2) {
			page++;
			var offsetrow = (page-1)*10;
			get_import_detail_user(host_task_IP_id,10,offsetrow);
			get_data_i(0);
			h2 = $('#apArea1').height();
		}else{
			clearInterval(if_select1);
			return false;
		}
	}
	var if_select1 = setInterval(function(){
		if (row_len < 10){
			clearInterval(if_select1);
			return false;
		}
		if (row_len == 10 && import_list_detail.totalrow == 10){
			clearInterval(if_select1);
			return false;
		}
		add();	
	},1000);
	
	add();
}
function get_data_i(type_add){
	$('#aploadTip1').show();
	var html = '<div class="apSort">';
	var Status;
	var append_a = append_flag % 10
	if (append_a == 0){
		;
	}else{
		html = '';
	}
	var npage = 0;
	
	var page_i = -1;
	var page_re = 0;
	////////console.log(import_list_detail);
	if (import_list_detail.data.length == 0){
		return false;
	}
	$.each(import_list_detail.data,function(i,item){
		//var host_v = JSON.parse(item.UserInfo);
		////////console.log("AuthName:"+item.AuthName);
		if (item.Status == 0){
			Status = "成功";
			html += '<div class="apItem"><div class="label managesucc" title="'+item.AuthName+'" style="width:50%;     white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">' + item.AuthName + '</div><div class="cc" style="padding-left: 50%;"><table cellpadding="0" cellspacing="0"><tbody><tr><td style="width:153px;">' + Status + '<span class="a"></span></td></tr>';
		}else if (item.Status == 1){
			Status = "失败：" + item.ErrorLog;
			html += '<div class="apItem"><div class="label managefail" title="'+item.AuthName+'" style="width:50%;     white-space: nowrap;overflow: hidden;text-overflow: ellipsis; text-overflow: ellipsis;">' + item.AuthName + '</div><div class="cc" style="padding-left: 50%;"><table cellpadding="0" cellspacing="0"><tbody><tr><td style="width:153px;">' + Status + '<span class="a"></span></td></tr>';
		}
		row_len += 1;
		append_a += 1;
		if (append_a % 10 == 0 && i != 0){			
			html += '</tbody></table></div></div>';
			if (append_flag % 10 != 0){
				$("#apArea1").find('.apSort:last').append(html);
				append_flag = 0;
				if (page_flag == 1){
					html = '</div><div class="ap-pc">' + ppage +'-' + ppage + ' / 共' + import_list_detail.totalrow + '条</div>';
				}else{
					if (page_flag == 0){
						html = '</div><div class="ap-pc">' + (ppage + 1) +'-' +(ppage + 10) + ' / 共' + import_list_detail.totalrow + '条</div>';
					}else{
						html = '</div><div class="ap-pc">' + ppage +'-' +(ppage + 10) + ' / 共' + import_list_detail.totalrow + '条</div>';
					}
					ppage = ppage + 10;
				}
				$("#apArea1").find('.ap-pc:last').remove();
				$('#apArea1').append(html);
				page_i = i;
				remain_page = 0;
			}else{
				if (page_flag == 1){
					html += '</div><div class="ap-pc">' + ppage +'-' + ppage + ' / 共' + import_list_detail.totalrow + '条</div>';
				}else{
					if (page_flag == 0){
						html += '</div><div class="ap-pc">' + (ppage + 1) +'-' +(ppage + 10) + ' / 共' + import_list_detail.totalrow + '条</div>';
					}else{ //等于2
						html += '</div><div class="ap-pc">' + ppage +'-' +(ppage + 10) + ' / 共' + import_list_detail.totalrow + '条</div>';
						same_page = 0;
					}
					ppage = ppage + 10;
				}
				$('#apArea1').append(html);
				page_i = i;
				remain_page = 0;

			}
			if (i == import_list_detail.data.length-1){
				html = "";
			}else{
				html = '<div class="apSort">';
			}
			////////////console.log("html3:"+html);
			same_page = 0;
		}

		if (append_a % 10 != 0){
			html += '</tbody></table></div></div>';
		}
		npage = i + 1;
		npage = i + 1;
	});
	////////////console.log("----------------------------");
	////////console.log(append_a);
	////////console.log(html)
	if (append_a % 10 != 0){
		if (append_flag % 10 != 0){
			$("#apArea1").find('.apSort:last').append(html);
			if (page_flag == 1){
				html = '</div><div class="ap-pc">' + ppage +'-' + ppage + ' / 共' + import_list_detail.totalrow + '条</div>';
			}else{
				if (page_flag == 0){
					html = '</div><div class="ap-pc">' + (ppage + 1) +'-' + import_list_detail.totalrow + ' / 共' + import_list_detail.totalrow + '条</div>';
				}else{
					html = '</div><div class="ap-pc">' + ppage +'-' + import_list_detail.totalrow + ' / 共' + import_list_detail.totalrow + '条</div>';
				}
			}
			//html = '</div><div class="ap-pc">' + (ppage + 1) + '-' + import_list_detail.totalrow + ' / 共' + import_list_detail.totalrow + '条</div>';
			$("#apArea1").find('.ap-pc:last').remove();
			$('#apArea1').append(html);
			////////console.log("NOT the first append");
		}else{
			if (page_flag == 1){
				html += '</div><div class="ap-pc">' + ppage +'-' + ppage + ' / 共' + import_list_detail.totalrow + '条</div>';
			}else{
				if (page_flag == 0){
					html += '</div><div class="ap-pc">' + (ppage + 1) +'-' + import_list_detail.totalrow + ' / 共' + import_list_detail.totalrow + '条</div>';
				}else{ //等于2
					html += '</div><div class="ap-pc">' + ppage +'-' + import_list_detail.totalrow + ' / 共' + import_list_detail.totalrow + '条</div>';
					same_page = 0;
				}
			}
			////////console.log("the first append");
			$('#apArea1').append(html);
		}
	}
	
	append_flag = append_a;

	remain_page = npage - page_re;
	var maxPage = Math.floor(import_list_detail.totalrow / 10);

	var task_page = page - 1,
		num = 10;
	var pnum = (task_page * num + 1) + '-' + (task_page + 1) * num;
	if((task_page + 1) * num > import_list_detail.totalrow){
		pnum = (task_page * num + 1) + '-' + import_list_detail.totalrow;
	}
	
	/*
	html += '</div><div class="ap-pc">' + pnum + ' / 共' + import_list_detail.totalrow + '条</div>';
	*/
	////////////console.log("---------------------");
	////////////console.log("htmlzzzzzz:"+html);
	if (task_page >= maxPage) {
		$('#aploadTip1').html('已全部加载').show();
		return;
	} else if (task_page < maxPage) {
		$('#aploadTip1').hide();
	}
	if(type_add<2){
		type_add++;
		_addData1(type_add);
	}
}
var append_flag = 0;
var ppage = 0;
var row_len = 0;
var remain_page = 0;
var page_flag = 0;
var same_page = 0;

var page = 0;

$('#importPage').scroll(function() {
	var wh = $('#importPage').height(),
		vh = $('#apArea1').height(),
		st = $('#importPage').scrollTop();

	if (wh + st >= vh) {
		_addData1(0);
	}
})

function _addData1(type_add) {
	if ($('#aploadTip1').is(':visible')) {
		return;
	}
	page++;
	var offsetrow = (page-1)*10;
	get_import_detail_user(host_task_IP_id,10,offsetrow);
	get_data_i(type_add);
}

//获取导入完成的详细信息
var import_list_detail;
var keyword_t;
function get_import_detail_user(id,limitrow,offsetrow){
	$.ajax({
		url:'/bhost/get_import_detail_manage_auth',
		type:'post',
		async:false,
		data:{'a0':$("input[name=se]").val(),'a1':id,'a2':keyword_t,a3:limitrow,a4:offsetrow},
		success:function(result){
			import_list_detail = JSON.parse(result);
			//import_list_detail.data.sort(import_list_detail);
		}
	});
}
function _import_user(type){
	$("#file_v").val('');
	$("#file_change").val('');$("#file_change1").val('');
	$("#pending_box").iCheck('uncheck');
	$("#cover_box1").iCheck('uncheck');
	var $dialogCont = $("#scDCTab2_import").show();
	d = dialog({
		title:"管理授权",
		content:$dialogCont,
		id:"scDCTab2_import",
		width:"850px"
	});
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
		if (if_ok == null){
		}else{
			clearInterval(if_ok);
		}
	});
	d.showModal();
	if (type == 1){
		$("#import_module").show();
		$("#details_module").hide();
		$("#task_import").addClass("active").parent().siblings().children().removeClass("active");
		
	}
	$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
		d.close().remove();
	});
	$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
		if ($("#details_module").is(':visible')){
			d.close().remove();
			return false;
		}
		var cover_flag = 0;
		var pending_flag = 0;
		if ($("#file_v").val() == ""){
			_alert(2,"管理授权","请选择文件");
			return false;
		}
		var file_v = $("#file_v").val();
		var fileReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
		if (!fileReg.test(file_v)){
			_alert(1,"管理授权","导入文件名称格式不正确");
			return false;
		}
		var len4=file_v.substr(file_v.length-4).toLowerCase();
		var len5=file_v.substr(file_v.length-5).toLowerCase();
		if ( len4!= ".csv" && len4!='.xls' && len5!='.xlsx'){
				_alert(1,"授权导入","导入文件格式不正确，只支持.CSV、.XLS、.XLSX格式文件");
				return false;
		}
		var file_name = file_v.substring(0,file_v.length-4);

		var file_exist = 0;
		var formData_f = new FormData($("#uploadForm")[0]);
		formData_f.append('a0',$("input[name=se]").val());
		////////console.log(formData_f);
		$.ajax({
			url:'/bhost/isexist_import_manage_auth',
			type:'post',
			data:formData_f,
			async: false,  
			cache: false,
			contentType: false,
			processData: false,
			success:function(result){
				////////////console.log("result:"+result);
				var is_r = JSON.parse(result);
				if (is_r.Result){
					file_exist = 0;
				}else{
					file_exist = 1;
					_alert(2,"管理授权","该任务已存在");
					return false;
				}	
			}
		});
		if (file_exist == 1){
			return false;
		}		
		if ($("#cover_box1").prop('checked')){
			cover_flag = 1;
		}else{
			cover_flag = 0;
		}
		var formData = new FormData($("#uploadForm")[0]);
		formData.append('a1',cover_flag);
		formData.append('a0',$("input[name=se]").val());
		formData.append('a99',use_BH);

		$.ajax({
			url:'/bhost/import_data_manage_auth',
			type: 'POST',
			data: formData,  
			async: false,  
			cache: false,
			contentType: false,  
			processData: false,  
			success: function (result) {
				$("#file_v").val('');
				$("#file_change").val('');$("#file_change1").val('');
				$("#cover_box1").iCheck('uncheck');
				$.ajax({
					url:'/bhost/get_manage_auth_task_data',
					type:'post',
					async:false,
					data:{a0:$("input[name=se]").val(),a1:1,a2:5},
					success:function(result){
						var task_list_data = JSON.parse(result);
						var totalpage = Math.ceil(parseInt(task_list_data.totalrow)/MAX_PAGE_T);
						if (totalpage < 1){
							totalpage = 1;
						}
						//$("#curpage").val(totalpage);
						$("#curpage").val(1);
						set_tab($("#task_list_tab"),2);
					}
				});
				set_tab($("#task_list_tab"),2);
			}
		});
	});
}
var format=0;
function _export_user(type){
	if (type == 1){
		_export();
	}else{
		var $dialogCont = $("#export_type").show();	
		title="导出";
		var d = dialog({
			title:title,
			content:$dialogCont,
			id:"export_type",
			width:"700px",
		});
		d.addEventListener('close', function () {
			$dialogCont.appendTo("body").hide();
		});
		$('#all_check').unbind().on('ifChecked',function(){
			resource_check=$('#resource_check').is(':checked');
			acc_check=$('#acc_check').is(':checked');
			work_check=$('#work_check').is(':checked');
			manage_check=$('#manage_check').is(':checked');
			cmd_check=$('#cmd_check').is(':checked');
			if(!resource_check || !acc_check || !work_check || !cmd_check || !manage_check){
				$('#acc_check').iCheck('check');
				$('#resource_check').iCheck('check');
				$('#work_check').iCheck('check');
				$('#cmd_check').iCheck('check');
				$('#manage_check').iCheck('check');
			}
			
		}).on('ifUnchecked',function(){
			resource_check=$('#resource_check').is(':checked');
			acc_check=$('#acc_check').is(':checked');
			work_check=$('#work_check').is(':checked');
			manage_check=$('#manage_check').is(':checked');
			cmd_check=$('#cmd_check').is(':checked');
			if(resource_check && acc_check && work_check && manage_check && cmd_check){
				$('#acc_check').iCheck('uncheck');
				$('#resource_check').iCheck('uncheck');
				$('#work_check').iCheck('uncheck');
				$('#cmd_check').iCheck('uncheck');
				$('#manage_check').iCheck('uncheck');
			}
		});
		$('#resource_check').unbind().on('ifChecked',function(){
			if ($('#resource_check').is(':checked') && $('#acc_check').is(':checked') && $('#work_check').is(':checked') && $('#cmd_check').is(':checked') && $('#manage_check').is(':checked')){
				$('#all_check').iCheck('check');
			}
		}).on('ifUnchecked',function(){
			$('#all_check').iCheck('uncheck');
		});
		$('#acc_check').unbind().on('ifChecked',function(){
			if ($('#resource_check').is(':checked') && $('#acc_check').is(':checked') && $('#work_check').is(':checked') && $('#cmd_check').is(':checked') && $('#manage_check').is(':checked')){
				$('#all_check').iCheck('check');
			}
		}).on('ifUnchecked',function(){
			$('#all_check').iCheck('uncheck');
			
		});
		$('#work_check').unbind().on('ifChecked',function(){
			if ($('#resource_check').is(':checked') && $('#acc_check').is(':checked') && $('#work_check').is(':checked') && $('#cmd_check').is(':checked') && $('#manage_check').is(':checked')){
				$('#all_check').iCheck('check');
			}
		}).on('ifUnchecked',function(){
			$('#all_check').iCheck('uncheck');
		});
		$('#cmd_check').unbind().on('ifChecked',function(){
			if ($('#resource_check').is(':checked') && $('#acc_check').is(':checked') && $('#work_check').is(':checked') && $('#cmd_check').is(':checked') && $('#manage_check').is(':checked')){
				$('#all_check').iCheck('check');
			}
		}).on('ifUnchecked',function(){
			$('#all_check').iCheck('uncheck');
		});
		$('#manage_check').unbind().on('ifChecked',function(){
			if ($('#resource_check').is(':checked') && $('#acc_check').is(':checked') && $('#work_check').is(':checked') && $('#cmd_check').is(':checked') && $('#manage_check').is(':checked')){
				$('#all_check').iCheck('check');
			}
		}).on('ifUnchecked',function(){
			$('#all_check').iCheck('uncheck');
		});
		$('#all_check').iCheck('uncheck');
		$('#acc_check').iCheck('uncheck');
		$('#resource_check').iCheck('check');
		$('#work_check').iCheck('uncheck');
		$('#cmd_check').iCheck('uncheck');
		$('#manage_check').iCheck('check');
		$('input[name=exportType_radio2][value=0]').iCheck('check');
		d.showModal();
		$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
			d.close().remove();
			parent.layer.open({
				type: 1,
				title: '管理授权',
				content: '<div class="layer-alert"><i class="alert warning"></i>是否导出</div>',
				btn:['确&nbsp;&nbsp;定','取&nbsp;&nbsp;消'],
				btnAlign:'c',
				closeBtn: false,
				skin:'layer-custom',
				area:['380px','310px'],
				move: false,
				resize: false,
				btn1:function(i){
					var exportType=[];
					format=$("#export_type").find("input[name=exportType_radio2]:checked").val();
					if($('#resource_check').is(':checked')){
						exportType.push('resource');
					}
					if($('#acc_check').is(':checked')){
						exportType.push('acc');
					}
					if($('#work_check').is(':checked')){
						exportType.push('work');
					}
					if($('#cmd_check').is(':checked')){
						exportType.push('cmd');
					}
					if($('#manage_check').is(':checked')){
						exportType.push('manage');
					}
					// if($('#all_check').is(':checked')){
					// 	exportType.push('all');
					// }
					exportType=exportType.join(',');
					parent.layer.close(i);
					$.ajax({
						url:'/bhost/export_data_manage_auth',
						type:'post',
						async:false,
						data:{a0:$("input[name=se]").val(),z2:exportType,z3:format},
						success:function(result){
							var result_arr=result.split(':');
							if (result.split(':')[0]=='true'){
								var file_name=result.split(':')[1]
							}else{
								var result=JSON.parse(result);
								if(!result.Result){
									_alert(1,"授权导出",result.info);
									return false;
								}
							}
							_showLoading();
							if_ok_down = setInterval(function(format){
								get_down_ok(file_name);
							},5000)
						}
					});				
				},
				btn2:function(i){
					parent.layer.close(i);
				}
			})
		});
	}
}
function _export(){
	var data = [
		['*客户端集合名称','IP地址','IP区间','MAC地址','MAC区间'],
		['特殊字符仅支持下划线、横杠、小数点','IP地址格式','IP地址-IP地址','MAC地址格式','MAC地址-MAC地址'],
		// ['','','','',''],
		// ['','','','',''],
		['*服务器集合名称','是否启用IP限制','IP地址','IP区间','主机组'],
		['特殊字符仅支持下划线、横杠、小数点','启用/不启用（默认：启用）','IP地址格式','IP地址-IP地址','主机组路径'],
		// ['','','','',''],
		// ['','','','',''],
		['*管理授权名称','用户/用户组','客户端登陆','服务器管理'],
		['特殊字符仅支持下划线、横杠、小数点','用户 或者 用户组','客户端集合名称','服务器集合名称'],
	]; 
	var csvContent = "data:text/csv;charset=utf-8,\ufeff";
	if (window.navigator.msSaveOrOpenBlob) {
		csvContent = "\ufeff";
	}
	data.forEach(function(infoArray, index){
		dataString = infoArray.join(",");
		csvContent += index < data.length ? dataString+ "\n" : dataString;
	});
	if (window.navigator.msSaveOrOpenBlob) {
		// if browser is IE
		var blob = new Blob([decodeURIComponent(encodeURI(csvContent))],{
		    type: "text/csv;charset=utf-8;"
		});
		navigator.msSaveBlob(blob, '管理授权导入模板.csv');
	}else{
		var encodedUri = encodeURI(csvContent);
		var link = document.createElement("a");
		link.setAttribute("href", encodedUri);
		link.setAttribute("download", "管理授权导入模板.csv");
		document.body.appendChild(link);
		link.click();
		document.body.removeChild(link);
	}
}
var use_BH=window.parent.parent.document.frm.use_BH.value;
function get_down_ok(file_name){
	$.ajax({
		url:'/bhost/get_down_ok_manage_auth',
		type:'post',
		async:false,
		data:{a0:$("input[name=se]").val(),a1:format,a2:file_name},
		success:function(result){
			var down_result = JSON.parse(result);
			if (down_result.Result){
				clearInterval(if_ok_down);
				if (down_result.ErrMsg != "None"){
					_alert(1,"管理授权",down_result.ErrMsg);
					return false;
				}
				_closeLoading();
				if(use_BH=='0'){
					document.frm1.action='/bhost/download_file_user_manage_auth';
					document.frm1.a0.value = $("input[name=se]").val();
					document.frm1.a1.value = down_result.file_name;
					document.frm1.z1.value = format;
					document.frm1.a99.value = use_BH;
					document.frm1.submit();
					return 0;
				}
				$.ajax({
					url:'/bhost/download_file_user_manage_auth',
					type:'post',
					async:false,
					data:{a0:$("input[name=se]").val(),z1:format,a99:use_BH,a1:down_result.file_name},
					success:function(result){
						var result=JSON.parse(result);
						if(result.Result){
							var sesstimet = (new Date()).valueOf();
							var referrer_arr=document.referrer.toString().split('/');
							referrer_arr.pop();
							var referrer=referrer_arr.join('/');
							var json_download = {
									"Type": "Download",
									"Url": referrer,
									"Path": result.path,
									"Filename": result.filename,
									"Session": $("input[name=se]").val(),
									"sesstimet":sesstimet,
									"Filenewname": result.filenewname
							}
							//console.log(json_download);
							var if_html_client = false;
							var base64_str = '';
							$.ajax({
									url: "/bhost/get_base64",
									type:"POST",
									async:false,
									data:{a0:$("input[name=se]").val(),z1:JSON.stringify(json_download)},
									success:function(result){
											var result=JSON.parse(result);
											if(result.Result){
													if_html_client = result.info;
													base64_str = result.b64;
											}else{
													_alert(1,"授权导出",result.ErrMsg); 
											}
									}
							})
							if(if_html_client) window.open('https://'+document.domain+':'+location.port+'/bhost/test_html?se='+window.parent.document.frm.se.value+'&z1='+JSON.stringify(json_download));
							else{
								get_regedit('bhost', window.parent.document.frm.se.value,'',sesstimet);
								$('#YuFrame1').remove();
								$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
								$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+base64_str);
							}
						}
					}
				});
				/*
				$.ajax({
			                url:'/bhost/del_manageAuth_file',
			                type:'post',
			                async:false,
			                data:{a0:$("input[name=se]").val(),a1:format},
			                success:function(result){}
				})
				*/
			}
		}
	});
}
//弹窗列表绑定
function tabArr1(){
	$('table').unbind();
	var tout,tin;
	var $cloneItem;
	var z = false;
	////////////console.log("asdadad");

	$('#usertask_list').on('mouseover','tbody>tr',function(){
		document.onclick = null;
	}).on('mouseout','tbody>tr',function(){
		document.onclick = function(){
			$('div.tab-moreinfo-on').hide();
			$('tr.on').removeClass('on');
		}
	}).on('click','tbody>tr',function(e){		
		x=e.target;
		if(x.id=='del'){
			return false;
		}
		if(x.id=='edit'){
			return false;
		}
		document.onclick = null;

		var $this = $(this);

			var $tr = $this;

			var oset = $tr.offset();
			var trc = $tr.attr('class');
			if(trc && trc.indexOf('on') >=0 ){
				$('div.tab-moreinfo-on').hide();
				$('div.tab-moreinfo-on').remove();
				$('tr.on').removeClass('on');
				return;
			}

			$('div.tab-moreinfo-on').hide();
			$('tr.on').removeClass('on');
			$tr.addClass('on');
			
			var $box = $this.parents('div.box-table');
			var boxh = $box.outerHeight(), boxo = $box.offset();

			var $item = $this.children('td:last').children('div.tab-moreinfo');
			var ih = $item.outerHeight(),th = $tr.outerHeight();
			$cloneItem = $item.clone().addClass('tab-moreinfo-on').appendTo('body');
			if(boxh < oset.top-boxo.top + ih + th - 40 ){
				$cloneItem.css({
					top:oset.top - ih,
					left:oset.left,
					width:$tr.outerWidth() - 1,
					opacity:0,
					display:'block'
				}).stop().animate({
					opacity:1
				});
			}else{
				$cloneItem.css({
					top:oset.top + $tr.outerHeight() + 1,
					left:oset.left,
					width:$tr.outerWidth() - 1,
					opacity:0,
					display:'block'
				}).stop().animate({
					opacity:1
				});
			}
			//$cloneItem.prev('div').remove();
			z_v = $cloneItem.prev('div').css('z-index');
			$cloneItem.css('z-index',z_v+1);
	});
	$('.box-table,body,.c-cont2,.c-cont').on('scroll',function(){
		$('div.tab-moreinfo-on').remove();
		$('tr.on').removeClass('on');
	})
	
	var len = $('.tab-ctr:first').children('a').length;
	$('#usertask_list>thead>tr>th:last').width(len*26);
}

//任务列表翻页
function turn_page(type){
	switch (type){
		case 1: //首页
			$("#curpage").val(1);
			break;
		case 2://上一页
			var cur = $("#curpage").val();
			if (cur == '1'){
				return false;
			}else{
				$("#curpage").val((parseInt(cur)-1));	
			}
			break;
		case 3://下一页
			var cur = $("#curpage").val();
			var total = $("#totalpage").text();
			////////////console.log("cur")
			if (cur == total){
				return false;
			}else {
				$("#curpage").val((parseInt(cur)+1));
			}
			break;
		case 4:
			$("#curpage").val($("#totalpage").text());
			break;
		case 5:
			var cur = $("#curpage").val();
			var numReg = /\D/;
			if (numReg.test(cur) || parseInt(cur) < 1 || cur == ''){
				$("#curpage").val(1);
			}
			break;
		default:
			;
	}
	get_usertask_list();
}

</script>

</body>
</html>
