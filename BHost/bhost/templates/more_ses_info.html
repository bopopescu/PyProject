{% extends "index.html" %} {% block head %}
<!--icheck-->
	<script src="/manage/js/common_e.js"></script>
{% endblock %} {% block main %}
	<div class="c-top">
		<div class="manual-head" id="ses_title">
			<div class="manual-title-other title-item" id="frist" style="display: none">
				<span onclick="switch_page(1)">最新会话</span>
				<i class="ses_icon"></i>
			</div>
			<div class="manual-title-other title-item" style="color: rgb(121, 121, 121);background: rgb(222, 222, 222)">
				<span onclick="switch_page(2);">最新异常会话</span>
				<i style="display: none;"></i>
			</div>
		</div>

		<div class="manual-head" id="ops_title" style="display: none">
			<div class="manual-title-other title-item" id="frist">
				<span onclick="switch_page(3)">最新操作</span>
				<i class="ops_icon"></i>
			</div>		
			<div class="manual-title-other title-item" style="color: rgb(121, 121, 121);background: rgb(222, 222, 222)">
				<span onclick="switch_page(4);">最新异常操作</span>
				<i style="display: none;"></i>
			</div>
		</div>
		<div class="manual-head" id="sys_title" style="display: none">
			<div class="manual-title" >
					<span id="host_add" onclick="switch_page(5);" onclick="" style="cursor: pointer;">系统日志</span>
				<i class="ops_icon"></i>
			</div>
		</div>
		<div class="manual-head" id="warn_title" style="display: none">
			<div class="manual-title" >
				<span id="host_add" onclick="switch_page(6);" onclick="" style="cursor: pointer;">告警日志</span>
				<i class="ops_icon"></i>
			</div>
		</div>
	</div>
	<div class="c-wrap">
		<div class="c-table">
			<!-- <div class="tab-t jsiWrap">
				<div class="js-ss" id="condition">
				</div>
				<a href="javascript:;" class="js-vm" onclick="_jsInfoView(0)"></a>
				<div id="jsMoreInfo">
					<a href="javascript:;" class="js-vm" onclick="_jsInfoView(1)"></a>
				</div>
			</div> -->
			<div class="clearfix"></div>
			
			<div class="" id="dataTable">
			</div>
			
		</div>
	</div>
	<div id="bBtn" style="z-index: 5;">
		<a href="javascript:;" class="btn" onclick="back();"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
	</div>
	<script src="/manage/js/jquery.jedate.min.js"></script>
	<link rel="stylesheet" href="/manage/css/jedate.css">	
	<script src="/manage/js/mmGrid.js"></script>
	<script src="/manage/js/mmPaginator.js"></script>
	<script src="/manage/js/xTable.js"></script>
	<link rel="stylesheet" href="/manage/css/mmGrid.css">
	<script src="/manage/js/Sortable.js"></script>
	<form action="/bhost/monitor_route" method="POST" name="more_info_frm" id="more_info_frm">
		<!--2 - 数据分布; 3 - 服务器; 4 - 运维用户; 5 - 协议; 6 - 最新会话; -->
		<input type="hidden" name="tasktype" id="tasktype" value="{{tasktype}}" />	
		<!-- name (from_flag)-->
		<input type="hidden" name="a1" id="a1" value="{{a1}}" />
		<!-- type (logtype)-->
		<input type="hidden" name="a2" id="a2" value="{{a2}}" />
		<!-- normal 1 - 全部; 2 - 异常; -->
		<input type="hidden" name="a3" id="a3" value="{{a3}}" />
		<!-- btn_status  -->
		<input type="hidden" name="a4" id="a4" value="{{a4}}"/>
		<!-- condition  -->
		<input type="hidden" name="a5" id="a5" value="{{a5}}"/>	
		<!-- tasktype  (position)-->
		<input type="hidden" name="a6" id="a6" value="{{a6}}"/>
		<!-- 二层监控条件 -->
		<input type="hidden" name="a8" id="a8" value="{{a8}}"/>	
		<!-- session -->
		<input type="hidden" name="se" id="se" value="{{se}}" />
		<input type="hidden" name="current_page" id = "current_page" value="{{p1}}" type="hidden">	
		<!--操作-->
		<input name="service_1" id="service_1" value="{{service_1}}"  type="hidden">
		<!--会话-->
		<input name="service_2" id="service_2" value="{{service_2}}"  type="hidden">
		<!--系统日志-->
		<input name="service_3" id="service_3" value="xtime_00,编号;xtime_01,入库时间;xtime_02,发生时间;int32_01,日志类型;ip_00,发生地址;str32_00,服务器用户;str32_01,操作;str32_06,返回信息;str32_08,模块" type="hidden">	
		<input type="hidden" name="ha" value="{{hash}}"/>
	</form>
<form action="/bhost/playback_index" method="get" name="frm_playback">
	<input type="hidden" name="a0"  value="{{se}}" />
	<input type="hidden" name="s1"  value="" />
	<input type="hidden" name="st"  value="" />
	<input type="hidden" name="et"  value="" />
	<input type="hidden" name="stat"  value="" />
	<input type="hidden" name="tp"  value="" />
	<input type="hidden" name="su"  value="" />
	<input type="hidden" name="si"  value="" />
	<input type="hidden" name="lo"  value="" />
	<input type="hidden" name="ha"  value="{{hash}}"/>
</form>
<form action="/bhost/analysis_index" method="get" name="frm_analysis">
	<input type="hidden" name="a0"  value="{{se}}" />
	<input type="hidden" name="s1"  value="" />
	<input type="hidden" name="st"  value="" />
	<input type="hidden" name="et"  value="" />
	<input type="hidden" name="stat"  value="" />
	<input type="hidden" name="tp"  value="" />
	<input type="hidden" name="su"  value="" />
	<input type="hidden" name="si"  value="" />
	<input type="hidden" name="lo"  value="" />
	<input type="hidden" name="ot"  value="" />
	<input type="hidden" name="yu"  value="" />
	<input type="hidden" name="ha"  value="{{hash}}"/>
</form>
{% endblock %} {% block script %}
<style>
	.layui-layer-setwin .layui-layer-close1{
		background-position:0;
	}
	.layui-layer-ico{
		background: url(/manage/images/icon_close.png) no-repeat 0 0;
	}
	.layer-custom {
		background: #fff url(/manage/images/layer_custom_bg.jpg) no-repeat 0 0;
		color: #fff;
		font-size: 14px;
	}

	.layer-custom .layui-layer-title {
		background: transparent;
		padding: 0;
		font-size: 16px;
		line-height: 36px;
		color: #fff;
		border-bottom: 0;
		height: auto;
	}

	.layer-custom .layui-layer-title:before {
		float: left;
		content: '';
		width: 3px;
		height: 16px;
		margin: 10px 5px 0 10px;
		background-color: #3fb4ce;
	}

	.layer-alert {
		text-align: center;
	}

	.layer-alert i.alert {
		display: block;
		width: 122px;
		height: 122px;
		background: url(/manage/images/layer_alert_icons.png) no-repeat 0 0;
		margin: 15px auto;
	}

	.layer-alert i.alert.fail {
		background-position: -122px 0;
	}

	.layer-alert i.alert.warning {
		background-position: -244px 0;
	}

	.layer-custom .layui-layer-btn {
		padding: 15px 0;
	}

	.layer-custom .layui-layer-btn a {
		height: 34px;
		padding: 0 45px;
		line-height: 34px;
		border: 1px solid #8f828c;
		background-color: #fff;
		color: #91848e;
		border-radius: 18px;
		transition: all 0.4s;
	}

	.layer-custom .layui-layer-btn a:hover {
		background-color: #8e828b;
		color: #fff;
		box-shadow: rgba(0, 0, 0, 0.15) 0 0 10px;
	}

	.tab-ctr a.m_ses_icon2 {
		display: inline-block;
		float: left;
		width: 16px;
		height: 20px;
		overflow: hidden;
		background: url(/manage/images/m_ses_icon.png) -16px 0px no-repeat;
		margin: -1px 4px 0 4px;
	}
	.tab-ctr a.m_ses_icon3 {
		display: inline-block;
		float: left;
		width: 16px;
		height: 20px;
		overflow: hidden;
		background: url(/manage/images/m_ses_icon.png) -32px 0px no-repeat;
		margin: -1px 4px 0 4px;
	}
	.tab-ctr a.m_ses_icon1 {
		display: inline-block;
		float: left;
		width: 16px;
		height: 20px;
		overflow: hidden;
		background: url(/manage/images/m_ses_icon.png) 0px 0px no-repeat;
		margin: -1px 4px 0 4px;
	}
	.tab-ctr a.m_ses_icon4 {
		display: inline-block;
		float: left;
		width: 16px;
		height: 20px;
		overflow: hidden;
		background: url(/manage/images/m_ses_icon.png) -48px 0px no-repeat;
		margin: -1px 4px 0 4px;
	}
	.tab-ctr a.m_ses_icon5 {
		display: inline-block;
		float: left;
		width: 16px;
		height: 20px;
		overflow: hidden;
		background: url(/manage/images/m_ses_icon.png) -64px 0px no-repeat;
		margin: -1px 4px 0 4px;
	}
	.tab-ctr a.m_ses_icon6 {
		display: inline-block;
		float: left;
		width: 16px;
		height: 20px;
		overflow: hidden;
		background: url(/manage/images/m_ses_icon6.png) no-repeat 0 0;
		margin: -1px 4px 0 4px;
	}
	.xTable-body tr:hover .tab-ctr {
		position: absolute;
		display: block;
		padding: 13px;
		background-color: #63c3d9;
	}
</style>
<script>
	var sess = window.parent.document.frm.se.value;
	var CLASS = document.more_info_frm.a3.value;
	var TYPE = document.more_info_frm.a2.value;
	var COND = document.more_info_frm.a6.value;
	var TITLE = ""
	var page_num = 10;
	var logtype = 0;				//1：会话	2：操作
	var show_field = "";	
	var protocol_list = [];
	var field_list = [];	
	var field_list_show = [];
	var display_field_list = [];
	var _btn;
	var monitor_flag1 = {{monitor_flag1}};
	var btn_ses = [];
	var btn_ops = [];

	if(monitor_flag1 == 2){
		btn_ses = [
			{
				class:'m_ses_icon1',
				title:'指令查看',
				cb: function(data){
					//alert(data.id);
					sessid = data['xtime_03'];
					stime = data['xtime_04']==null?"":data['xtime_04'];
					etime = data['xtime_05']==null?"":data['xtime_05'];
					s =data['int08_03'] ;
					if(s == '连接中') statue = 0;
					else if (s == '异常退出') statue = 2;
					else statue = 1;
					IfReplay = data['IfReplay'];//ir
	                                IfReplayDrawing = data['IfReplayDrawing'];//ird
	                                document.frm_analysis.ot.value = IfReplay+"@"+IfReplayDrawing;	
					typ = data['int32_01'] ;
					server_user = data['str32_00']==null?"":data['str32_00'];
					y_user = data['str32_22']==null?"":data['str32_22'];
					server_ip =data['ip_01']==null?"":data['ip_01'];  
					$('form[name=frm_analysis]').attr('target','_blank');
					$('form[name=frm_analysis]').attr('method','get');
					document.frm_analysis.s1.value = sessid;
					document.frm_analysis.st.value = stime.replace('T','  ').replace('+08:00','');;
					document.frm_analysis.et.value = etime.replace('T','  ').replace('+08:00','');;
					document.frm_analysis.stat.value = statue;
					document.frm_analysis.tp.value = typ;
					document.frm_analysis.su.value = server_user;
					document.frm_analysis.yu.value = y_user;
					document.frm_analysis.si.value = server_ip;
					if (logtype == 'NORMAL') lo = 1;
					else if(logtype == 'SESSION') lo = 2;
					else lo = 3;
					document.frm_analysis.lo.value = lo;
					document.frm_analysis.submit();
					//console.log(data);
				}
			},
			{
				class:'icon-block',
				title:'阻断',
				cb: function(data){
					$.ajax({
						url: "/bhost/block_session",
						type:"POST",
						async:true,		
						data:{a0:sess,p1:data['int32_14'],s1:data['int32_15'],s2:data['xtime_03']},
						success:function(result){
							var result=JSON.parse(result);
							if(result.Result){
								_alert(0,"实时监控","操作成功");
								setTimeout("dataTable()",700);
							}else{
								_alert(1,"实时监控",result.ErrMsg);
							}
						}
					})
				}
			},{
				class:'icon-moni',
				title:'监控',
				cb: function(data){
					ifacc = false;
					if(data['str32_28'].indexOf('acc') != -1){
						ifacc = true;
					}
					_cowork(data['str32_22'],data['int32_14'],data['int32_01'],2,data['ip_01'],data['int16_01'],data['int16_02'],data['str32_00'],ifacc,data['xtime_03'],data['int32_15']);
				}
			},
			{
				class:'m_ses_icon2',
				title:'回放',
				cb: function(data){
					//console.log(data);
					if(data['IfReplay'] == true){
						MapPort = '8080';
						$.ajax({
							url: "/bhost/get_MapPort",
							type:"POST",
							async:false,		
							data:{a0:sess},
							success:function(result){
								var result=JSON.parse(result);
								if(result.Result){
									MapPort = result.info;
								}else{
									_alert(1,"实时监控",result.ErrMsg);
								}
							}
						})
						var sesstimet = (new Date()).valueOf();
						cmd_json ={
							"Cmd":"\"D:\\Program Files\\Java\\jre1.8.0_131\\bin\\java.exe\" -jar CharReplay.jar",
							"Protocol":data['int32_01']==null?"":data['int32_01'],
							"ReplayPath":data['str32_28']==null?"":data['str32_28'],
							"UrlIp":document.domain+ (location.port!=''?':'+location.port:''),
							"ClientIp":data['ip_02']==null?"":data['ip_02'],
							"ServerIp":data['ip_01']==null?"":data['ip_01'],
							"StartTime":data['xtime_04']==null?"":((new Date(data['xtime_04']).valueOf())/1000),
							"File":"123",//SlasEncode 加密？？？
							"Sessid":data['xtime_03'],
							"Usercode":data['str32_22']==null?"":data['str32_22'],
							"Username":data['str32_23']==null?"":data['str32_23'],
							"IfReplay":true,
							"IfReplayDrawing":data['IfReplayDrawing'],
							"MapPort":MapPort,
							"sesstimet":sesstimet,
							"sess":sess
						}
					
						var if_html_client = false;
						var base64_str = '';
						$.ajax({
							url: "/bhost/get_base64",
							type:"POST",
							async:false,		
							data:{a0:sess,z1:JSON.stringify(cmd_json)},
							success:function(result){
								var result=JSON.parse(result);
								if(result.Result){
									if_html_client = result.info;
									base64_str = result.b64;
								}else{
									_alert(1,"数据检索",result.ErrMsg);
								}
							}
						})
						if(if_html_client) window.open('https://'+document.domain+':'+location.port+'/bhost/test_html?se='+sess+'&z1='+JSON.stringify(cmd_json));
						else{
							//window.location.href = 'bhost://cmd&'+base64_str;
							get_regedit('bhost',sess,'',sesstimet);
							$('#YuFrame1').remove();
							$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
							$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+base64_str);	
						}
						
					
						return false;
					}
				
					sessid = data['xtime_03'];
					stime = data['xtime_04']==null?"":data['xtime_04'];
					etime = data['xtime_05']==null?"":data['xtime_05'];
					s =data['int08_03'] ;
					if(s == '连接中') statue = 0;
					else if (s == '异常退出') statue = 2;
					else statue = 1;

					typ = data['int32_01'] ;
					server_user = data['str32_00']==null?"":data['str32_00'];
					server_ip = data['ip_01']==null?"":data['ip_01'];  
					$('form[name=frm_playback]').attr('target','_blank');
					$('form[name=frm_playback]').attr('method','get');
					document.frm_playback.s1.value = sessid;
					document.frm_playback.st.value = stime.replace('T','  ').replace('+08:00','');;
					document.frm_playback.et.value = etime.replace('T','  ').replace('+08:00','');;
					document.frm_playback.stat.value = statue;
					document.frm_playback.tp.value = typ;
					document.frm_playback.su.value = server_user;
					document.frm_playback.si.value = server_ip;
					if (logtype == 'NORMAL') lo = 1;
					else if(logtype == 'SESSION') lo = 2;
					else lo = 3;
					document.frm_playback.lo.value = lo;
					document.frm_playback.submit();
					//console.log(data);
			}
			},
			{
				class:'m_ses_icon3',
				title:'下载',
				cb: function(data){
					download_file(data);
				}
			},{
				class:'msg1',
				title:'确认',
				cb: function(data,obj){
					//console.log($(obj));
					MarkWMsg(data.xtime_00,2,obj);
				}
			}
			/*,
			{
				class:'m_ses_icon4',
				title:'指令导出',
				cb: function(data){
					alert(data.id);
				}
			},*/
		];
		btn_ops = [
			{
				class:'m_ses_icon2',
				title:'回放',
				cb: function(data){
					//console.log(data);
					if(data['IfReplay'] == true){
						MapPort = '8080';
						$.ajax({
							url: "/bhost/get_MapPort",
							type:"POST",
							async:false,		
							data:{a0:sess},
							success:function(result){
								var result=JSON.parse(result);
								if(result.Result){
									MapPort = result.info;
								}else{
									_alert(1,"实时监控",result.ErrMsg);
								}
							}
						})
						var sesstimet = (new Date()).valueOf();
						cmd_json ={
							"Cmd":"\"D:\\Program Files\\Java\\jre1.8.0_131\\bin\\java.exe\" -jar CharReplay.jar",
							"Protocol":data['int32_01']==null?"":data['int32_01'],
							"ReplayPath":data['str32_28']==null?"":data['str32_28'],
							"UrlIp":document.domain+ (location.port!=''?':'+location.port:''),
							"ClientIp":data['ip_02']==null?"":data['ip_02'],
							"ServerIp":data['ip_01']==null?"":data['ip_01'],
							"StartTime":data['xtime_04']==null?"":((new Date(data['xtime_04']).valueOf())/1000),
							"File":"pm02qgAra6HxipYvGc8czCBbrk8dM7NQ385dwKqhuor8cz9lAUMIeJfYQ+skvL6J3g==",//SlasEncode 加密？？？
							"Sessid":data['xtime_03'],
							"Usercode":data['str32_22']==null?"":data['str32_22'],
							"Username":data['str32_23']==null?"":data['str32_23'],
							"IfReplay":true,
							"IfReplayDrawing":data['IfReplayDrawing'],
							"MapPort":MapPort,
							"sesstimet":sesstimet,
							"sess":sess
						}
					
						var if_html_client = false;
						var base64_str = '';
						$.ajax({
							url: "/bhost/get_base64",
							type:"POST",
							async:false,		
							data:{a0:sess,z1:JSON.stringify(cmd_json)},
							success:function(result){
								var result=JSON.parse(result);
								if(result.Result){
									if_html_client = result.info;
									base64_str = result.b64;
								}else{
									_alert(1,"数据检索",result.ErrMsg);
								}
							}
						})
						if(if_html_client) window.open('https://'+document.domain+':'+location.port+'/bhost/test_html?se='+sess+'&z1='+JSON.stringify(cmd_json));
						else{
							//window.location.href = 'bhost://cmd&'+base64_str;
							get_regedit('bhost',sess,'',sesstimet);
							$('#YuFrame1').remove();
							$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
							$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+base64_str);	
						}
						
					
						return false;
					}
				
					//alert(data.id);
				/*
			 	xtime_03 会话标志
			  	xtime_04 起始时间
			  	xtime_05 结束时间
			  	int08_03 会话状态
			  	int32_01 日志类型
			  	str32_00 服务器用户
			  	ip_01    服务端地址
				*/
					sessid = data['xtime_03'];
					stime = data['xtime_04']==null?"":data['xtime_04'];
					etime = data['xtime_05']==null?"":data['xtime_05'];
					s =data['int08_03'] ;
					if(s == '连接中') statue = 0;
					else if (s == '异常退出') statue = 2;
					else statue = 1;

					typ = data['int32_01'] ;
					server_user = data['str32_00']==null?"":data['str32_00'];
					server_ip = data['ip_01']==null?"":data['ip_01'];  
					$('form[name=frm_playback]').attr('target','_blank');
					$('form[name=frm_playback]').attr('method','get');
					document.frm_playback.s1.value = sessid;
					document.frm_playback.st.value = stime.replace('T','  ').replace('+08:00','');;
					document.frm_playback.et.value = etime.replace('T','  ').replace('+08:00','');;
					document.frm_playback.stat.value = statue;
					document.frm_playback.tp.value = typ;
					document.frm_playback.su.value = server_user;
					document.frm_playback.si.value = server_ip;
					if (logtype == 'NORMAL') lo = 1;
					else if(logtype == 'SESSION') lo = 2;
					else lo = 3;
					document.frm_playback.lo.value = lo;
					document.frm_playback.submit();
					//console.log(data);
				}
			},{
				class:'m_ses_icon5',
				title:'关联分析',
				cb: function(data){
					//alert(data.id);
					sessid = data['xtime_03'];
					stime = data['xtime_04']==null?"":data['xtime_04'];
					etime = data['xtime_05']==null?"":data['xtime_05'];
					s =data['int08_03'] ;
					if(s == '连接中') statue = 0;
					else if (s == '异常退出') statue = 2;
					else statue = 1;
					
					typ = data['int32_01'] ;
					server_user = data['str32_00']==null?"":data['str32_00'];
					y_user = data['str32_22']==null?"":data['str32_22'];
					server_ip =data['ip_01']==null?"":data['ip_01']; 
					IfReplay = data['IfReplay'];//ir
					IfReplayDrawing = data['IfReplayDrawing'];//ird			
					document.frm_analysis.ot.value = IfReplay+"@"+IfReplayDrawing; 
					$('form[name=frm_analysis]').attr('target','_blank');
					$('form[name=frm_analysis]').attr('method','get');
					document.frm_analysis.s1.value = sessid;
					document.frm_analysis.st.value = stime.replace('T','  ').replace('+08:00','');;
					document.frm_analysis.et.value = etime.replace('T','  ').replace('+08:00','');;
					document.frm_analysis.stat.value = statue;
					document.frm_analysis.tp.value = typ;
					document.frm_analysis.su.value = server_user;
					document.frm_analysis.yu.value = y_user;
					document.frm_analysis.si.value = server_ip;
					if (logtype == 'NORMAL') lo = 1;
					else if(logtype == 'SESSION') lo = 2;
					else lo = 3;
					document.frm_analysis.lo.value = lo;
					document.frm_analysis.submit();
					//console.log(data);
				}
			},{
				class:'m_ses_icon3',
				title:'下载',
				cb: function(data){
					//console.log(data);
					download_file(data);
				}
			},{
				class:'m_ses_icon6',
				title:'删除',
				cb: function(data,obj){
					delete_file(data,obj);
				}
			},{
				class:'msg1',
				title:'确认',
				cb: function(data,obj){
					MarkWMsg(data.xtime_00,1,obj);
				}
			}
		];
		btn_sys = [
			{
				class:'msg1',
				title:'确认',
				cb: function(data,obj){
					MarkWMsg(data.xtime_00,3,obj);
				}
			}
		];
	}else{
		btn_ses = [
			{
				class:'m_ses_icon3',
				title:'下载',
				cb: function(data){
					download_file(data);
				}
			}
		];
		btn_ops = [
			{
				class:'m_ses_icon3',
				title:'下载',
				cb: function(data){
					//console.log(data);
					download_file(data);
				}
			}
		];
		btn_sys = [
		];		
	}

	var c_today1;
	var c_today2;
	var condition_json={
		"starttime":null,
		"endtime":null,
		"serverip":null,
		"usercode":null,
		"inttype":null,
		"intexception":null,
		"moretime":null
	};
	var intexception;
	$(function(){
		//console.log(TYPE);
		if(TYPE == 1){
			$("#ops_title").hide();
			_btn = btn_ses;
			if(CLASS == 1){
				$("#ses_title").children('div').eq(1).attr("style","color: rgb(121, 121, 121);background: rgb(222, 222, 222)").attr("id","");
				$("#ses_title").children('div').eq(1).children('i').attr("class","").attr("style","display: none;");
				$("#ses_title").children('div').eq(0).attr("style","").attr("id","frist");
				$("#ses_title").children('div').eq(0).children('i').attr("class","ses_icon").attr("style","");
			}else if(CLASS == 2){
				$("#ses_title").children('div').eq(0).attr("style","color: rgb(121, 121, 121);background: rgb(222, 222, 222)").attr("id","");
				$("#ses_title").children('div').eq(0).children('i').attr("class","").attr("style","display: none;");
				$("#ses_title").children('div').eq(1).attr("style","").attr("id","frist");
				$("#ses_title").children('div').eq(1).children('i').attr("class","ases_icon").attr("style","");
			}
		}else if(TYPE == 2){
			$("#ses_title").hide();
			$("#ops_title").show();
			_btn = btn_ops;
			if(CLASS == 1){
				$("#ops_title").children('div').eq(1).attr("style","color: rgb(121, 121, 121);background: rgb(222, 222, 222)").attr("id","");
				$("#ops_title").children('div').eq(1).children('i').attr("class","").attr("style","display: none;");
				$("#ops_title").children('div').eq(0).attr("style","").attr("id","frist");
				$("#ops_title").children('div').eq(0).children('i').attr("class","ops_icon").attr("style","");
			}else if(CLASS == 2){
				$("#ops_title").children('div').eq(0).attr("style","color: rgb(121, 121, 121);background: rgb(222, 222, 222)").attr("id","");
				$("#ops_title").children('div').eq(0).children('i').attr("class","").attr("style","display: none;");
				$("#ops_title").children('div').eq(1).attr("style","").attr("id","frist");
				$("#ops_title").children('div').eq(1).children('i').attr("class","aops_icon").attr("style","");
			}
		}else if(TYPE == 3){
			if(CLASS == 1){
				$("#sys_title").show();
				$("#warn_title").hide();
			}else{
				$("#warn_title").show();
				$("#sys_title").hide();
			}
			$("#ses_title").hide();
			$("#ops_title").hide();
			_btn = btn_sys;
		}
		_initSize();
		//console.log(CLASS);
		if(CLASS == 1){
			intexception = null;
		}else if(CLASS == 2){
			intexception = 1;
		}
		c_today1 = "";
		c_today2 = "";
		getDate();
		c_today1 = now_date+' '+'00:00:00%2B08';
		c_today2 = now_date+' '+'23:59:59%2B08';		
		if(COND == 2){
			var hour_s = document.more_info_frm.a5.value;
			if(hour_s < 10){
				hour_s = '0'+hour_s;
			}
			var hour_f = (parseInt(hour_s)+1).toString();
			if(hour_f == 24){
				var hour_f = '00';
			}
			var timestamp1 = now_date+' '+hour_s+':00:00%2B08';//+  --> 防止+被转成空格
			var timestamp2 = now_date+' '+hour_f+':00:00%2B08';
			condition_json ={
				"starttime":timestamp1,
				"endtime":timestamp2,
				"intexception":intexception
			}
			//console.log(condition_json);
		}else if(COND == 3){
			condition_json ={
				"starttime":c_today1,
				"endtime":c_today2,
				"serverip":document.more_info_frm.a5.value,
				"intexception":intexception
			}			
		}else if(COND == 4){
			condition_json ={
				"starttime":c_today1,
				"endtime":c_today2,					
				"usercode":document.more_info_frm.a5.value,
				"intexception":intexception
			}
		}else if(COND == 5){
			condition_json ={
				"starttime":c_today1,
				"endtime":c_today2,					
				"inttype":document.more_info_frm.a5.value,
				"intexception":intexception
			}
		}else if(COND == 1){//from monitor.html
			get_condition();
			//console.log(condition_json);
		}
		get_more_condition();
		logtype = document.more_info_frm.a2.value;
		if(logtype == 1){
			logtype = 'SESSION';
		}else if(logtype == 2){
			logtype = 'NORMAL';
		}else if(logtype == 3){
			logtype = 'SYSTEM';
		}

		get_protocol_list();
		init_title();
		
	})
	$(window).resize(function(){
		_initSize();
	});

	function _initSize(){
		var h = $(window).height();
		$('.c-wrap').height(h - 115).css('overflow','auto');//兼容1280分辨率
	}	
	var now_date;
	function getDate(){
		now_date = "";
		var date = new Date();
		var syear = date.getFullYear();
		var smonth = date.getMonth()+1;
		var sday=date.getDate();
		now_date = syear +'-'+ smonth +'-'+ sday;
	}
	//获取date
	function GetDateStr(AddDayCount) { 
		var dd = new Date(); 
		dd.setDate(dd.getDate()+AddDayCount);//获取AddDayCount天后的日期 
		var y = dd.getFullYear(); 
		var m = dd.getMonth()+1;//获取当前月份的日期 
		var d = dd.getDate();
		if (m < 10) m = "0" + m;
		if (d < 10) d = "0" + d;
		return m+"-"+d; 
	}	
	function get_condition(){
		condition_json = {
			"starttime":null,
			"endtime":null,
			"serverip":null,
			"usercode":null,
			"inttype":null,
			"intexception":null,
			"moretime":null
		};	
		getDate();
		c_today1 = now_date+' '+'00:00:00%2B08';
		c_today2 = now_date+' '+'23:59:59%2B08';
		//console.log(c_today1);
		//console.log(c_today2);
		var seven_days = GetDateStr(-6);
		var date = new Date();
		var currentdate = date.getFullYear() + "-" + seven_days + " " + "00:00:00%2B08";
		//console.log(currentdate);
		condition_json.starttime = c_today1;
		condition_json.endtime = c_today2;
		condition_json.moretime = currentdate;
		condition_json.intexception = intexception;
	}
	function get_more_condition(){
		//console.log("second_page");
		var more_condition = document.more_info_frm.a8.value;
		//console.log(more_condition);
		if(more_condition == "no_con"){
			return false;
		}else{
			//console.log(more_condition);
			var con_type = parseInt(more_condition.split('-')[0]);
			var con_content = more_condition.split('-')[1];
			//console.log(con_type);
			switch(con_type){
				case 1:
					//console.log("11111");
					var hour_s = con_content;
					if(hour_s < 10){
						hour_s = '0'+hour_s;
					}
					var hour_f = (parseInt(hour_s)+1).toString();
					if(hour_f == 24){
						var hour_f = '00';
					}
					var timestamp1 = now_date+' '+hour_s+':00:00%2B08';//+  --> 防止+被转成空格
					var timestamp2 = now_date+' '+hour_f+':00:00%2B08';
					//console.log(timestamp1+"+++"+timestamp2);
					condition_json.starttime = timestamp1;
					condition_json.endtime = timestamp2;
					//console.log(condition_json);
					break;
				case 2:
					condition_json.inttype = con_content;
					break;
				case 3:
					condition_json.serverip = con_content;
					break;
				case 4:
					condition_json.inttype = con_content;
					break;
				case 5:
					condition_json.usercode = con_content;
					break;
				case 6:
					condition_json.inttype = con_content;
					break;
			}
		}
	}
	//生成协议列表
	function get_protocol_list(){
		var max_page = "null";
		var ipage = "null";
		var keyword = JSON.stringify([]);
		$.ajax({
			url:'/bhost/get_agreement_list',
			type: "post",
			async: true,
			data: {a0:sess,data1:max_page,data2:ipage,data3:keyword},
			success: function(result){
				protocol_data = JSON.parse(result);
				protocol_data = protocol_data.data;
				protocol_list = [];
				$.each(protocol_data,function(i,item){
					var list = {
						protocolname:"",
						protocolid:""
					}
					list.protocolname = item.ProtocolName;
					list.protocolid = item.ProtocolId;
					protocol_list.push(list);
				})
				//console.log(protocol_list);
			}
		})
	}

	function down(x, y) {
		if(parseInt(x.Order) > parseInt(y.Order)){
			return 1;
		}else{
			return -1;
		}
	}

	function init_title(){
		if(TYPE == 1){
			logtype = 'SESSION';
		}else if(TYPE == 2){
			logtype = 'NORMAL';
		}else if(TYPE == 3){
			logtype = 'SYSTEM';
		}

		//获取所有的字段
		/*
		[{"Content": "xtime_00","Translation": "编号"}]*/
		field_list = [];
		field_list_show = [];
		$.ajax({
			url:'/bhost/get_logfield',
			type:'post',
			async:false,
			data:{a0:{{se}},o1:logtype},
			success:function(result){
				field_list_show = JSON.parse(result);
				$(field_list_show).each(function(i,item){
					field_list[item.Content] = item.Translation;
				})
			}
		})
		$(field_list_show).each(function(i,item){
			$('#tabvList ul').append('<li><input type="checkbox" name="'+item.Content+'" id="" class="form-checkbox" >'+item.Translation+'</li>');
		})		
		//获取 显示得日志 字段
		display_field_list = [];
		show_field = "";
		$.ajax({
			url:'/bhost/get_displaylogfield',
			type:'post',
			async:false,
			data:{a0:{{se}},o1:logtype},
			success:function(result){
				display_field_list = JSON.parse(result);
				display_field_list.sort(down);
				$(display_field_list).each(function(i,item){
					show_field = show_field + item.Content + ',';
				})
				show_field = show_field.substring(0,show_field.length-1);
				dataTable();
			}
		})
	}

	function switch_page(args){
		switch(args){
			case 1:
				document.more_info_frm.tasktype.value = 6;
				document.more_info_frm.a2.value = 1;
				document.more_info_frm.a3.value = 1;
				document.more_info_frm.submit();
				break;
			case 2:
				document.more_info_frm.tasktype.value = 6;
				document.more_info_frm.a2.value = 1;
				document.more_info_frm.a3.value = 2;
				document.more_info_frm.submit();
				break;
			case 3:
				document.more_info_frm.tasktype.value = 6;
				document.more_info_frm.a2.value = 2;
				document.more_info_frm.a3.value = 1;
				document.more_info_frm.submit();			
				break;
			case 4:
				document.more_info_frm.tasktype.value = 6;
				document.more_info_frm.a2.value = 2;
				document.more_info_frm.a3.value = 2;
				document.more_info_frm.submit();
				break;
			case 5:
				document.more_info_frm.tasktype.value = 6;
				document.more_info_frm.a2.value = 3;
				document.more_info_frm.a3.value = 1;
				document.more_info_frm.submit();
			case 6:
				document.more_info_frm.tasktype.value = 6;
				document.more_info_frm.a2.value = 3;
				document.more_info_frm.a3.value = 2;
				document.more_info_frm.submit();
		}
	}

	function ChangeLogFieldStatus(obj){
		if(logtype == 'NORMAL') logtype_i =1;
		if(logtype == 'SESSION') logtype_i =2;
		if(logtype == 'SYSTEM') logtype_i =3;
		
		field_json = {
			"logtype": logtype_i,    //日志类型，1-操作，2-会话，3-系统
			"logfieldset":[
			]
		};
		logfieldset = [];
		$(obj).each(function(i,item){
			if(item.hide == false) fStatus = 0;
			else fStatus = 1;
			////console.log(item.field_id);
			logfieldset.push(JSON.parse('{"LogFieldId":'+item.field_id+',"Order":'+(i+1)+',"Status":'+fStatus+'}'));
		})
		field_json.logfieldset = logfieldset;
		msstr = aceg(JSON.stringify(field_json),sess);
		$.ajax({
			url:'/bhost/ChangeLogFieldStatus',
			type:'post',
			async:true,
			data:{a0:{{se}},s1:JSON.stringify(field_json),m1:msstr},
			success:function(result){
				
			}
		})
	}

	var xtable;
	function dataTable() {
		var cols = [];
		if(display_field_list.length > 0 ){
			$(display_field_list).each(function(i,item){
				if(item.Translation == '日志属性') return true;
				
				var width_value=200;
				if(item.Translation.indexOf('时间')>=0){
					width_value=140;
				}
				else if(item.Translation.indexOf('地址')>=0){
					width_value=110;
				}
				else if(item.Translation=='日志类型' || item.Translation=='是否告警' || 
				item.Translation=='编号' || item.Translation=='会话状态' || 
				item.Translation=='告警类型' || item.Translation=='告警等级' ||
				item.Translation=='操作个数' || item.Translation=='告警处理' || item.Translation=='告警动作'){
					width_value=100;
				}
				else if(item.Translation=='会话标识'){
					width_value=160;
				}
				else if(item.Translation=='客户端端口' || item.Translation=='服务器端口'){
					width_value=70;
				}
				else if(item.Translation=='文件大小'){
					width_value=70;
				}
				if(item.Status == 0) 
					cols.push(JSON.parse('{ "title": "'+item.Translation+'", "name": "'+item.Content+'","field_id":"'+item.LogFieldId+'" ,"width": '+width_value+', "align": "center" }'));
				else 
					cols.push(JSON.parse('{ "title": "'+item.Translation+'", "name": "'+item.Content+'", "field_id":"'+item.LogFieldId+'","width": '+width_value+', "align": "center","hide": true}'));
			})
		}
		//cols.push(JSON.parse(' { "title": "","name":"1111","infoDiv": false}'));
		//hide: true/*默认隐藏*/
		//lock: true/*锁定*/
		//infoDiv: true/*信息层*/
		/*
		var cols = [
			{ title: '入库时间', name: 'startTime', width: 160, align: 'center' },
			{ title: '发生时间', name: 'endTime', width: 160, align: 'center' },
			{ title: '子类型', name: 'type', width: 120, align: 'center' },
			{ title: '会话标识', name: 'status', width: 60, align: 'center' },
			{ title: '运维用户账号', name: 'user', width: 120, align: 'center' },
			{ title: '运维用户姓名', name: 'username', width: 600, align: 'center',hide: true },
			{ title: '服务端IP', name: 'ip', width: 200, align: 'center' },
			{ title: '审批用户姓名', name: 'suser', width: 120, align: 'center' },
			{ title: '服务器用户名', name: 'husername', width: 120, align: 'center', lock: true},
			{ title: '',name:'moreInfo',infoDiv: true}
        ];*/
		//ipage = $("#curpage").val(); //页数
		//ipage = 1;
		//console.log(condition_json);		
		xtable = $('#dataTable').xTable({
			cols: cols,
			url: '/bhost/get_log_list_monitor?a0={{se}}&t1='+MAX_PAGE+'&t2='+JSON.stringify(condition_json)+'&t4='+logtype+'&t5='+show_field,
			method: 'get',
			data: {page:$('#current_page').val(),limit:10},
			select: true,	//显示筛选
			infoDiv: false,	/*  信息浮层 */
			btns:_btn,
			dblclick: function(data,items){	//双击
				page = $('li.jump input').val();
				xtime_00 = data.xtime_00;
				index = "";
				$(items).each(function(i,trm){
					index = index + trm.xtime_00 +",";
				})
				index = index.substring(0,index.length-1);
				location.href="/bhost/log_detail_route?a0={{se}}&m1={{a1}}&m2={{a2}}&m3={{a3}}&m4={{a4}}&m5={{a5}}&m6={{a6}}&m7="+xtime_00+"&m8="+index+"&m9="+page+"&m10="+logtype;
			},
			success: function(){	//加载完成
				$(".tab-ctr").css ({
					"height": "14px",
					"overflow": "hidden",
				});
			}
		})
	}
	function back(){
		var Tasktype;
		var c1 = document.more_info_frm.a1.value;

		if(c1 == 10){
			if(parent.$("#MonitorStyle").attr('value') == '2'){
				Tasktype = "1";
			}else{
				Tasktype = "1_1";
			}
		}else if(c1 == 11){
			Tasktype = 8;
		}
		document.more_info_frm.tasktype.value = Tasktype;
		document.more_info_frm.se.value = {{se}};
		document.more_info_frm.a1.value = document.more_info_frm.a5.value;
		document.more_info_frm.a2.value = {{a2}};
		document.more_info_frm.a3.value = {{a3}};
		document.more_info_frm.a4.value = {{a4}};
		// document.more_info_frm.a5.value = {{a5}};		
		document.more_info_frm.a6.value = {{a6}};
		document.more_info_frm.submit();
	}
	function download_file(data){
		var DownloadType = 0;		//1->回放文件  2->传输文件；
		var log_id,log_name;
		if(data.str32_28 != ""){
			DownloadType = 1;
			log_id = data.xtime_00;
			log_name = data.str32_28;		
		}else{
			if(data.str32_28 == "" && (data.int32_01 == 'SFTP' || data.int32_01 == 'FTP' || data.int32_01 == 'SSH')){
				if(data.str32_01.indexOf('Save') >= 0){
					DownloadType = 2;
					log_id = data.xtime_00;
					log_name = data.str32_01.replace('Save ','');
				}
			}
		}
		if(log_name != ""){
			TITLE = "实时监控>"+$(".manual-head:visible").find("#frist:visible").find('span').text();
			$.ajax({
				url: "/bhost/download_fileCheck",
				type:"POST",
				async:true,		
				data:{a0:sess,a1:log_id,a2:log_name,a3:DownloadType,a10:TITLE},
				success:function(result){
					var result=JSON.parse(result);
					if(result.Result){
						//console.log(document.referrer);
						var referer_tmp = document.referrer.toString();
						var referer_array_tmp = referer_tmp.split('/');
						referer_array_tmp.pop();
						var referer_new = referer_array_tmp.join('/');
						//console.log(referer_new);
						if(DownloadType == 1){
							var index_tmp = data.str32_28.split('/').length;
							log_name = data.str32_28.split('/')[index_tmp-1]
						}
						var sesstimet = (new Date()).valueOf();
						var json_download = {
							"Type": "Download",
							"Url": referer_new,
							"Path": result.Path,
							"Filename": log_name,
							"Session": sess,
							"sesstimet":sesstimet
						}
						// cmd_str = JSON.stringify(json_download);
						// var evt = document.createEvent("CustomEvent");
						// evt.initCustomEvent('LocalEvent', true, false, cmd_str);
						// document.dispatchEvent(evt);
						// window.open('https://'+window.location.host+'/bhost/test_html?se={{se}}&z1='+cmd_str);
						var if_html_client = false;
						var base64_str = '';
						$.ajax({
							url: "/bhost/get_base64",
							type:"POST",
							async:false,
							data:{a0:window.parent.document.frm.se.value,z1:JSON.stringify(json_download)},
							success:function(result){
								var result=JSON.parse(result);
								if(result.Result){
									if_html_client = result.info;
									base64_str = result.b64;
								}else{
									_alert(1,"实时监控",result.ErrMsg);
								}
							}
						})
						if(if_html_client) window.open('https://'+document.domain+':'+location.port+'/bhost/test_html?se='+window.parent.document.frm.se.value+'&z1='+JSON.stringify(json_download));
						else{
							//window.location.href = 'bhost://cmd&'+base64_str;
							get_regedit('bhost',window.parent.document.frm.se.value,'',sesstimet);
							$('#YuFrame1').remove();
							$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
							$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+base64_str);	
						}						
					}else{
						_alert(1,$("#frist").children('span').text(),result.ErrMsg);
					}
				}
			})
		}	
	}

	function delete_file(data,obj){
		TITLE = "实时监控>"+$(".manual-head:visible").find("#frist:visible").find('span').text();
		parent.layer.open({
			type:1,
			title: $(".manual-head:visible").find("#frist:visible").find('span').text(),
			content: '<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
			btn:['删&nbsp;&nbsp;除','取&nbsp;&nbsp;消'],
			btnAlign:'c',
			closeBtn: false,
			skin:'layer-custom',
			area:['380px','310px'],
			move: false,
			resize: false,
			yes:function(i){
				//传输文件；
				parent.layer.close(i);
				var log_id = data.xtime_00;
				var log_name = data.str32_01.replace('Save ','');
				$.ajax({
					url: "/bhost/delete_file_log",
					type:"POST",
					async:true,
					data:{a0:sess,a1:log_id,a2:log_name,a10:TITLE},
					success:function(result){
						var re = JSON.parse(result);
						if(re.Result == false){
							_alert(1,$(".manual-head:visible").find("#frist:visible").find('span').text(),re.ErrMsg);

						}else{
							_alert(0,$(".manual-head:visible").find("#frist:visible").find('span').text(),"删除成功");
							$(obj).attr('class','m_ses_icon6 disabled').unbind();
							$(obj).prev().attr('class','m_ses_icon3 disabled').unbind();
						}
					}
				})
			}
		})
	}
	var url_str = "https://"+document.domain+':8443';
	function _cowork(bhname,pid,protoname,Type,ip,port1,port2,sername,ifacc,se_old,int32_15) {
		var ip_domain='';
		var getdomainpass=true;
		$.ajax({
			url: "/bhost/getdomain",
			type:"POST",
			async:false,
			data:{a0:$("input[name=se]").val(),a1:int32_15},
			success:function(result){
				var result = JSON.parse(result);
				if(result.Result == true){
					if(result.ip!=''){
						ip_domain=result.ip
					}
				}else{
					_alert(1,"最新会话",result.ErrMsg);
					getdomainpass=false;
					return false;
				}
			}
		});
		if(!getdomainpass){
			return false;
		}
		if(ip_domain!=''){
			url_str = "https://"+ip_domain+':8443';
		}
		var timestamp = new Date().getTime();
		var username1 = sess + '@' + timestamp;
		var param_host = '{"name":"hostname","value":"127.0.0.1"}';
		var username;
		var paramStr = "";
		$.ajax({
			url:'/bhost/get_user_name',
			type:'post',
			async:false,
			data:{a0:$("input[name=se]").val()},
			success:function(result){
				var re_result = JSON.parse(result);
				username = re_result.info;
			}
		});	
		$.ajax({
			url:'/bhost/module_app_set_list',
			type:'post',
			async:false,
			data:{a0:$("input[name=se]").val()},
			success:function(result){
				var re_result = JSON.parse(result);
				$.each(re_result.data,function(i,item){
					if (item.ApplicationName == 'TELNET'){
						param_port = '{"name":"port","value":"'+item.ServicePort+'"}';
						return false;
					}else if(item.ApplicationName == 'RDP|VNC|X11'){
						param_port1 = '{"name":"port","value":"'+item.ServicePort+'"}';
					}
				});
			}
		});
		$.ajax({
			url:'/bhost/get_Param',
			type:'post',
			async:false,
			data:{a0:$("input[name=se]").val(),a1:bhname,a2:ip,a3:protoname,a4:sername},
			success:function(result){
				var re_result = JSON.parse(result);
				paramStr = '\\t'+re_result.ServiceName+'\\t'+re_result.ConnMode+'\\t'+re_result.ConnParam+'\\t'+re_result.ClientName;
			}
		});
		var username0 = "";
		var Type1 = 0;
		var param_array = [];
		if(Type == 2){
			if(protoname == "RDP" || ifacc==true || protoname == "VNC" || protoname == "X11"){
				Type1 = 1;
				username0 = bhname+'@'+sername+'@'+ip+':'+port1+':'+protoname+':'+port2+'@h5:1:'+se_old+':'+'{{us}}'+':'+username;
                        	if(ifacc == true){
	                                username0 += ':1';
	                        }else{
	                                username0 += ':0';
	                        }
				param_array.push(JSON.parse(param_port1));
				var pwd_str = parent.client_ip+':0@'+'d106f6959747';
				param_password = '{"name":"password","value":"'+pwd_str+'"}';
			}else{
				username0 = '+'+'{{us}}'+'@'+username+'@'+pid+':'+protoname+'@ad';
				param_array.push(JSON.parse(param_port));
				param_password = '{"name":"password","value":"'+sess+'"}';
			}
		}
		if(protoname == "SSH" || protoname == "TELNET" || protoname == "RLOGIN"){
		}else{
			username0 += paramStr;
		}
		var param_username = '{"name":"username","value":"'+username0+'"}';
		param_array.push(JSON.parse(param_host));
		param_array.push(JSON.parse(param_username.replace("\\","\\\\")));
		param_array.push(JSON.parse(param_password));
		var pwd = sess;
		$.ajax({
			url: "/bhost/get_token_remote_Monitor",
			type:"POST",
			async:false,
			data:{a0:$("input[name=se]").val(),a1:url_str,a2:bhname,a3:pid,a4:protoname,a5:username1,a6:pwd,a7:JSON.stringify(param_array),a8:Type,a9:Type1},
			success:function(result){
				var result=JSON.parse(result);
				$.ajax({
					url: "/bhost/RealIPGet",
					type: "POST",
					async: false,
					data: { a0: $("input[name=se]").val(), a1: document.domain},
					success: function (result) {
						var result = JSON.parse(result);
						if(result.result == true){
							if(result.dev_type == "gluster"){
								document_domain = result.info;
							}else{
								document_domain = document.domain;
							}
						}else{
							document_domain = document.domain;
						}
					}
				})
				var url_addr = 'https://'+(ip_domain==''?document_domain:ip_domain)+':8443/bhremote/?token='+result.authToken;
				window.open(url_addr);
			}
		});
	}
	var $_hostGroupObj;
	var type_g;
	var s_id_g;
	function MarkWMsg(s_id,type,obj){
		$_hostGroupObj = $(obj);
		type_g = type;
		s_id_g = s_id;
		hglayer = layer.open({
			type:2,
			title:'确认备注',
			content:'/bhost/mark_layer?a0={{se}}&a1='+s_id+'&a2='+type+'&a3=实时监控',
			area:['650px','350px'],
			btn:false,
			shade:0.7
		});
	}

	function _closeHgLayer(flag,content){
		if(flag == 0){
			//1-操作，2-会话，3-系统
			$.ajax({
				url: "/bhost/set_logstat",
				type:"POST",
				async:false,
				data:{a0:$("input[name=se]").val(),a1:type_g,a2:s_id_g,a3:content,a10:TITLE},
				success:function(result){
					var result = JSON.parse(result);
					if(result.Result == true){
						_alert(0,$("#frist").children('span').text(),"操作成功");
						$.each($_hostGroupObj.parent().parent().parent().children('td'),function(i,item){
							if($(item).data('role') == 'int08_11'){
								$obj1 = $(item);
							}else if($(item).data('role') == 'str32_16'){
								$obj2 = $(item);
							}else if($(item).data('role') == 'str32_17'){
								$obj3 = $(item);
							}else if($(item).data('role') == 'str32_18'){
								$obj4 = $(item);
							}
						});
						//console.log($obj1);
						$obj1.text("已处理");
						$obj2.text(result.UserCode);
						$obj3.text(result.UserName);
						$obj4.text(content);
						$_hostGroupObj.attr('class','msg1 disabled').unbind();
					}else{
						_alert(1,$("#frist").children('span').text(),"操作失败");
					}
				}
			})
		}
		layer.close(hglayer);
	}
</script>
{% endblock %}
