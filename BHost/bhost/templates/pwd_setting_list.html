<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>manager</title>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<link rel="stylesheet" href="/manage/css/style.css">
	<link rel="stylesheet" href="/manage/css/ui-dialog.css" type="text/css" />
	<link rel="stylesheet" href="/manage/css/G-style.css" type="text/css" />

	<link rel="stylesheet" href="/manage/css/new-head.css">
	<!--script-->
	<script src="/manage/js/jquery.min.js"></script>
	<script src="/manage/js/jquery.easing.js"></script>
	<script src="/manage/js/layer.js"></script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/common_e.js"></script>
	<script src="/manage/js/xSelect.js"></script>
	<!--icheck-->
	<script src="/manage/js/icheck.min.js"></script>
	<!--select2-->
	<script src="/manage/js/select2.full.min.js"></script>
	<script type="text/javascript" src="/manage/js/dialog-plus.js"></script>
	
</head>
<script>
	var perm={{perm}};
	if(perm==0){
		parent.$('#nav-s1 a.active').click();
	}	
</script>
<style>
	.form-item {
		float:left;
		width: auto;
		height: auto;
		padding: 20px 0 0 0;
		min-height: 28px;
	}
	.form-text1{
		padding-right: 8px;
	}
	.item i.ctrl {
		float: left;
		margin-top: 26px;
		display: inline-block;
		width: 15px;
		height: 15px;
		background: url(/manage/images/icon-ctr.png) no-repeat 0 0;
		vertical-align: middle;
		margin-left: 5px;
		cursor: pointer;
	}
	.item i.ctrl.add {
		background-position: 0 -15px;
	}
	a.btn-normal1 {
		display: inline-block;
		width: 90px;
		height: 32px;
		border: 1px solid #DDD;
		text-align: center;
		line-height: 32px;
		border-radius: 18px;
		margin: 0 10px;
		background-color: #fff;
		transition: background-color 0.4s;
		color: #7c7c7c;
	}
	a.btn-normal1:hover{
		background-color: #8d808a;
		color: #fff;
	}
	.tab-type2 table tr:hover td:last-child {
		border-right: 1px solid #3fb7d2;
		background-color: #63c3d9;
	}
	.c-dialog-cont {
		width: 100%;
		position: relative;
		overflow: auto;
		background-color: #fff;
	}
	.c-form-host .form-item {
		float: left;
		width: 230px;
		padding: 20px 0 0 0;
	}
	.fsel {
		position: fixed;
		margin: -67px 0 0 -20px;
		width: 580px;
		height: 45px;
		background: #FFF;
	}
	.fsel ul li{
		float:left;
	}
	.fsel ul li a{
		float:left;
		padding:0 32px;
		line-height:45px;
		font-size:18px;
		color:#000;
	}
	.fsel ul li a.active{
		border-top:5px solid #4cb2d0;
		border-right:1px solid #DDD;
		border-left:1px solid #DDD;
		line-height:41px;
		border-bottom:1px solid #FFF;
	}
	.c-table #usertask_list th:last-child {
		width:25px !important;
	}
	.form-c {
		padding-left: 158px;
	}
	.form-tag {
		width: 150px;
	}
	.ctr-form .form-c i.ctr-add {
		margin-top: 6px;
	}
	.user_add {
		padding-left: 0px !important;
		width: 240px;
		float: left;
		padding-bottom: 10px;
	}
	.ctr-form .form-c i.ctr-del {
		left: 5px;
		top: -1px;
	}
	.select2-container--open {
		z-index: 9999999;
	}
	.scDCTab1_class {
		opacity: 0 !important;
	}
	.g-tsel:after {
		right: 12px;
	}
	.ui-dialog-body {
		padding: 20px 0 20px 0;
		text-align: center;
		padding-bottom: 0px;
	}
	/*
	.c-table {
		min-width:1177px;
	}
	*/
</style>
<body style="overflow:hidden;" class="bg-white">
		<!--主机-->
		<div class="rwrap">
			<div class="c-top">
				<div class="c-title c-title-pc">
					<div class="manual-head" style="">
						<div class="manual-title" style="">
							<span id="pwd_set" >主机设定</span>
							<i class="pwd_set_icon"></i>
						</div>
						<!-- <div class="manual-title-other title-item">
							<span id="hostpwd_show">密码</span>
							<i style="display: none;"></i>
						</div>
						<div class="manual-title-other title-item">
							<span id="hostsend_show">发送方式</span>
							<i style="display: none;"></i>
						</div> -->
					</div>
				</div>
			</div>
		<div class="mainer" name="pwd_setting" id="pwd_setting" >
			<div class="container">
				<div class="c-cont">
					<div class="c-wrap">
						<div class="c-table r-list">
							<div class="tab-t">
								<div class="ctr">
									<a href="javascript:;" class="btn btn-default" onclick="pwd_setting_page(0);">刷新</a>
								</div>
								<div class="filter">
									<div class="search">
										<select name="pwd_setting_select" id="pwd_setting_select" class="filter-select">
											<option value="all" selected>所有</option>
											<option value="hostname">主机名</option>
											<option value="hostip">IP</option>
											<!--<option value="DeviceTypeName">设备类型</option>-->
											<!--<option value="Name">改密模式</option>-->
										</select>

										<input type="text" style="/*display:none;*/padding-right: 22px;" 
										class="filter-text" placeholder="输入关键字" 
										name="pwd_setting_text" id="pwd_setting_text" maxlength="128" 
										onchange="if($('#pwd_setting_text').val()==''){$('#pwd_setting_text_check').hide();}else{$('#pwd_setting_text_check').show();}"
										onkeyup="if($('#pwd_setting_text').val()==''){$('#pwd_setting_text_check').hide();}else{$('#pwd_setting_text_check').show();}"
										onblur="if($('#pwd_setting_text').val()=='' && search_typeall_new!=''){search_typeall_new='';_addFilter(this,false,1);}"
										onkeydown="if($('#pwd_setting_text').val()==''){$('#pwd_setting_text_check').hide();}else{$('#pwd_setting_text_check').show();}; if (event.keyCode == 13){_addFilter(this,false);return false;} else return; ">
										<i class="v-check v-wrong" id="pwd_setting_text_check" 
										onclick="_clearFilter(this,1)" 
										style="display:none;cursor: pointer;float: left;position: static;"></i>
										<button class="btn filter-btn" onclick="_addFilter(this,false);"><i class="add-filter"></i></button>
										<button class="btn filter-btn" onclick="_addFilter(this,true)"><i class="append-filter"></i></button>
									</div>
									<div class="search" id="clearFilter" style="margin: 0px 15px 0px -16px;display:none;">
										<button class="filter-btn" onclick="_clearFilter(this)"><i class="clear-filter"></i></button>
									</div>
									<div class="selector selector-multiple" id="filterWW" style="display:none;">
										<span class="ww">搜索条件</span>
										<ul>
										</ul>
									</div>
								</div>
							</div>
							<div class="box-table">
								<table cellpadding="0" cellspacing="0">
									<thead>
										<tr>
											<th>主机名</th>
                                            <th width='150'>IP</th>
											<th width='150'>设备类型</th>
											<th>改密模式</th>
                                            <th width='100'>账号数量</th>
                                            <th width='100'>指定账号个数</th>
											<th width="25"></th>
										</tr>
									</thead>

									<tbody name="pwd_setting_list" id="pwd_setting_list">
									</tbody>
								</table>
							</div>
							<div class="tab-i">
								<div class="il">
									每页显示<span id="page_nums">10</span>条 总数：<span id = "pwd_setting_total">0</span>
								</div>

								<div class="ipage">
									<a href="javascript:;" class="nav2 begin" id="pwd_setting_begin" onclick="pwd_setting_page(0.1);" ><i></i></a>
									<a href="javascript:;" class="nav prev" id="pwd_setting_prev" onclick="pwd_setting_page(-1);" ><i></i></a>
									<input type="text" id = "pwd_setting_page" value="1" onchange="showMsg();" onblur="showMsg();">/&nbsp;<span id = "pwd_setting_pages">1</span>
									<a href="javascript:;" class="nav next" id="pwd_setting_next" onclick="pwd_setting_page(1);" ><i></i></a>
									<a href="javascript:;" class="nav2 end" id="pwd_setting_end" onclick="pwd_setting_page(0.9);" ><i></i></a>
								</div>
							</div>
						</div>
						<div class="clearfix"></div>
						<div id="bBtn" style="position: fixed;z-index:5;">
							<a href="javascript:;" class="btn" style="float: right;" onclick="back();"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<form action="/bhost/get_pwd_setting_list" method="POST" name="frm_pwd_setting" id="frm_pwd_setting">	
			<input type="hidden" name="tasktype" id = "tasktype" value="{{tasktype}}" />
			<!--创建 编辑 列表-->
			<input type="hidden" name="a" id = "a" value="{{a}}" />
			<!--需要查询id-->
			<input type="hidden" name="c" id = "c" value="{{c}}" />
			<!--页码-->
			<input type="hidden" name="d" id = "d" value="{{d}}" />
			<!--search_typeall-->
			<input type="hidden" name="e" id = "e" value="{{e}}" />
			<input type="hidden" name="se" id = "se" value="{{se}}" />
	</form>
	<!-- 浮层 -->
	<!--改密模式-->
	<div class="dialog-cont" id="scDCTab2_import" style="display:none;">
		<div class="fsel" style="margin-top: -47px;margin-left: 0px;">
			<ul><li><a class="active" href="javascript:;" id="task_host" onclick="set_tab(this,1);">主机</a></li>
				<li><a href="javascript:;" id="task_user" onclick="set_tab(this,2);">账号</a></li>
			</ul>
		</div>
		<div class="container">
			<div id="host_mode" class="" style="min-height:340px;max-height:340px;overflow:hidden;padding-bottom: 60px;margin-top: -20px;">
				<div class="c-form" id="pwdchange_mode_form" name="pwdchange_mode_form"  style="height: 340px;overflow: auto;height: 343px;padding: 0 35px;">
					<div class="form-item name_form" style="width: 100%;">
						<span class="form-tag">改密方式：</span>
						<div class="form-c">
							<select class="form-select" name="Name_value" id="Name_value" style="width:132px;">
									<option value="1">跟随设备类型</option>
									<option value="2">自定义</option>
							</select>
						</div>
					</div>
					<div class="form-item name_form" style="width: 100%;">
						<span class="form-tag"><em class="imp">*</em>改密配置：</span>
						<div class="form-c">
							<div class="xSelect Name" id="Name" style="float: left;"></div>
							<input type="text" class="form-text forName" maxlength="128" id="Name_new" name="Name_new" style="width: 200px;padding: 0 8px;display:none;float: left;margin-left: 10px;">
						</div>
					</div>
					<div class="form-item name_form" style="width: 100%;">
						<span class="form-tag"><em class="imp">*</em>改密脚本：</span>
						<div class="form-c">
							<select class="form-select" name="Name_type" id="Name_type" style="width:132px;">
									<option value="1">默认</option>
									<option value="2">自定义</option>
							</select>
						</div>
					</div>
					<div class="form-item" id="Config_div" style="width: 100%;">
						<span class="form-tag"><em class="imp">*</em>脚本：</span>
						<div class="form-c">
							<textarea id="Config" name="Config" class="form-textarea" style="height: 88px;width: 422px;resize: none;"></textarea>
						</div>
					</div>
					<div class="btns" style="padding: 10px 0 10px;">
						<a href="javascript:;" class="btn btn-normal btn-submit" >保&nbsp;&nbsp;存</a>
						<a href="javascript:;" class="btn btn-normal btn-cancel" >重&nbsp;&nbsp;置</a>
					</div>
				</div>
			</div>
		
			<div id="user_mode" class="" style="min-height:340px;max-height:340px;overflow:hidden;display:none;padding-bottom: 60px;margin-top: -20px;">
				<div class="c-form" style="padding: 12px 0px;width: auto;">
					<div class="c-wrap" style="padding:0;">
					<div class="c-table r-list" style="padding:0;">
						<div class="tab-t">
							<div class="ctr">
								<a href="javascript:;" id='change_many' class="btn btn-default" onclick="change_many(this);">管理</a>
								<a href="javascript:;" class="btn btn-default" onclick="mode_ajax();show_pwd_setting_user_list();">刷新</a>
							</div>
						</div>
						<div class="box-table" style="max-height: 253px;min-height:253px;overflow: hidden;">
							<table cellpadding="0" cellspacing="0" id="usertask_list">
								<thead>
									<tr>		
										<th>账号</th>
										<th>协议</th>
										<th>设备类型</th>
										<th>改密模式</th>
										<th></th>
									</tr>
								</thead>
								<tbody>
									
								</tbody>
							</table>
						</div>
						<div class="tab-i">
							<div class="il">
								每页显示<span id="page_total">5</span>条 总数：<span id = "task_total">25</span>
							</div>

							<div class="ipage">
								<a href="javascript:;" class="nav2 begin" onclick="pwd_setting_user_page(0.1);"><i></i></a>
								<a href="javascript:;" class="nav prev" onclick="pwd_setting_user_page(-1)"><i></i></a>
								<input type="text" value="1" id="curpage" onblur="showMsg_user();" onchange="showMsg_user();">/&nbsp;<span id = "totalpage">25</span>
								<a href="javascript:;" class="nav next" onclick="pwd_setting_user_page(1)"><i></i></a>
								<a href="javascript:;" class="nav2 end" onclick="pwd_setting_user_page(0.9)"><i></i></a>
							</div>
						</div>
					</div>
					
					<div class="clearfix"></div>
					<div class="btns" style="padding: 10px 0 10px;display:none;">
						<a href="javascript:;" class="btn btn-normal btn-return" >返&nbsp;&nbsp;回</a>
					</div>
					</div>
				</div>
				</div>
			</div>
		</div>
	</div>
	<div class="dialog-cont" id="scDCTab1" style="display:none;">
		<div class="container">
			<div class="c-dialog-cont" style="min-height: 340px;max-height: 340px;overflow: hidden;padding-bottom: 60px;margin-top: -20px;">
				<div class="c-wrap" style="padding:0 0 90px;margin-top: -10px;overflow: hidden;">
				<div class="c-form c-form-host col3" style="min-width: 100%;">
					<div class="clearfix"></div>
					<div class="c-table" style="padding: 0;">
						<div class="form" style="height: 340px;overflow: auto;padding: 0 35px;" id="pwdchange_user_mode_form">
							<div class="form-item name_form" style="width: 100%;">
								<span class="form-tag">改密方式：</span>
								<div class="form-c">
									<!-- <label class="form-label" style="margin-top: 4px;">
										<input type="checkbox" class="form-checkbox" id="user_Name_value" style="">
									</label> -->
									<select class="form-select" name="user_Name_value" id="user_Name_value" style="width:132px;">
											<option value="1">跟随主机</option>
											<option value="2">自定义</option>
									</select>
								</div>
							</div>
							<div class="form-item name_form" style="width: 100%;">
								<span class="form-tag"><em class="imp">*</em>改密配置：</span>
								<div class="form-c">
									<div class="xSelect user_Name" id="user_Name" style="float: left;"></div>
									<input type="text" class="form-text forName" maxlength="128" id="user_Name_new" name="user_Name_new" style="width: 200px;padding: 0 8px;display:none;float: left; margin-left: 10px;">
								</div>
							</div>
							<div class="form-item name_form" style="width: 100%;">
								<span class="form-tag"><em class="imp">*</em>改密脚本：</span>
								<div class="form-c">
									<select class="form-select" name="user_Name_type" id="user_Name_type" style="width:132px;">
										<option value="1">默认</option>
										<option value="2">自定义</option>
									</select>
								</div>
							</div>
							<div class="form-item" id="user_Config_div" style="width: 100%;">
								<span class="form-tag"><em class="imp">*</em>脚本：</span>
								<div class="form-c">
									<textarea id="user_Config" name="user_Config" class="form-textarea" style="height: 88px;width: 422px;resize: none;"></textarea>
								</div>
							</div>
							<div class="form-item user_select ctr-form"  id="user_select_div" style="width:100%">
								<span class="form-tag"><em class="imp">*</em>账号：</span>
								<div style="width: auto;padding-left: 7em;">
									<div class="form-c user_add user_all" value='0'>
										<select class="form-select-user" name="user_select" id="user_select" style="width: 200px;">
											
										</select>
										<i class="ctr ctr-add" onclick="_adduser(this)" style="margin-left: 5px;"></i>
									</div>
								</div>
							</div>
						</div>
					</div>
					
					<div class="btns" style="padding: 10px 0 10px;">
						<a href="javascript:;" class="btn btn-normal btn-submit" >保&nbsp;&nbsp;存</a>
						<a href="javascript:;" class="btn btn-normal btn-cancel" onclick="">重&nbsp;&nbsp;置</a>
					</div>
				</div>
				</div>
			</div>  
		</div>
	</div>
<script>
	$('.form-checkbox,.form-radio').iCheck({
		checkboxClass: 'icheckbox_minimal-blue',
	    radioClass: 'iradio_minimal-blue',
	    increaseArea: '0' // optional
	});
</script>

<script>
$('.form-select,.filter-select').select2({minimumResultsForSearch: -1});
$('.form-select-user').select2();
</script>

<script type="text/javascript">
var delect_str = "";
var check_num=0;
var total_all_r=0;
var pwd_setting_data=null;
//总数
var fenye_r=0;
var pwd_setting_item=null;
var mode_json_arr=null;
//总页码
var search_typeall_r=new Array();
var mode_json_arr_IsDefault_true=null;
var mode_item=null;
var all_user_select_arr=new Array();
var check_user_select_arr=new Array();
var id_arr_pagenum=null;
//关键字
var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
var HostId=null;
var DeviceTypeId=null;
function user_back()
{
	$("#pwd_setting_user").hide();
	$('#pwd_setting').show();
}
$(function(){
	if(perm==1){
		$('#host_mode .btn-normal.btn-submit').remove();
		$('#user_mode #change_many').remove();
		$('#scDCTab1 .btn-normal.btn-submit').remove();
	}
	$("#pwd_set").on("click",function(){
		pwd_setting();
	});
	$('#hostpwd_show').on('click',function () {
		hostpwd_showing();
	});
	$('#hostsend_show').on('click',function () {
		hostsend_showing();
	});
	$('.xSelect').on('click','.xSelect-show',function () {
		$focusObj=$(this).parents('.xSelect');
	});
	//输入数字
	$("#curpage").bind('keydown', function(e){
		DigitInput(e);
	});
	$("#pwd_setting_select").change(function(){
		var type = $(this).val();
		if(type == 0){
			$("#pwd_setting_text").hide();
			$('#filterWW').hide();
			$('#clearFilter').hide();
		}else{
			$("#pwd_setting_text").show();
			if($('#filterWW ul li').length){
				$('#filterWW').show();
				$('#clearFilter').show();
			}
		}
	});
	$('#Name_type').on('change',function () {
		var name_id=$('#Name_type').val();
		if(name_id=='1'){
			$('#Config_div').hide();
			$('#host_mode .select-form').show();
		}else{
			$('#Config_div').show();
			$('#host_mode .select-form').hide();
		}
	});
	$('#user_Name_type').on('change',function () {
		var name_id=$('#user_Name_type').val();
		if(name_id=='1'){
			$('#user_Config_div').hide();
			$('#pwdchange_user_mode_form .select-form').show();
		}else{
			$('#user_Config_div').show();
			$('#pwdchange_user_mode_form .select-form').hide();
		}
	});
	$('#Name_value').on('change',function () {
		var value_num=$('#Name_value').val();
		if(value_num=='1'){
			var items=null;
			$('#autoView').hide();
			$('#Name').blur();
			if(mode_json_arr_IsDefault_true==null){
				$('#Name').data('value','');
				$('.xSelect-show-text',$('#Name')).text('请选择');
			}else{
				$('#Name').data('value',mode_json_arr_IsDefault_true.PwdModConfigId);
				$('.xSelect-show-text',$('#Name')).text(mode_json_arr_IsDefault_true.Name);
				items=mode_json_arr_IsDefault_true;
			}
			host_mode_info(items);
		}else{
			var items=null;
			$('#autoView').hide();
			$('#Name').blur();
			if(pwd_setting_item.PwdModConfigId!=null){
				$('#Name').data('value',pwd_setting_item.PwdModConfigId);
				$('.xSelect-show-text',$('#Name')).text(pwd_setting_item.Name);
				$.each(mode_json_arr.PwdModConfigSet,function (i,item) {
					if(pwd_setting_item.PwdModConfigId==item.PwdModConfigId){
						items=item;
						return false;
					}
				});
			}else if(mode_json_arr_IsDefault_true==null){
				$('#Name').data('value','');
				$('.xSelect-show-text',$('#Name')).text('请选择');
			}else{
				$('#Name').data('value',mode_json_arr_IsDefault_true.PwdModConfigId);
				$('.xSelect-show-text',$('#Name')).text(mode_json_arr_IsDefault_true.Name);
				items=mode_json_arr_IsDefault_true;
			}
			host_mode_info(items);
		}
	});
	$('#user_Name_value').on('change',function () {
		var value_name=$('#user_Name_value').val();
		if(value_name=='1'){
			var items=null;
			$('#autoView').hide();
			$('#user_Name').blur();
			if (pwd_setting_item.PwdModConfigId!=null) {
				$('.xSelect-show-text',$('#user_Name')).text(pwd_setting_item.Name);
				$('#user_Name').data('value',pwd_setting_item.PwdModConfigId);
				$.each(mode_json_arr.PwdModConfigSet,function (i,item) {
					if(pwd_setting_item.PwdModConfigId==item.PwdModConfigId){
						items=item;
						return false;
					}
				});
			} else if(mode_json_arr_IsDefault_true==null){
				$('.xSelect-show-text',$('#user_Name')).text('请选择');
				$('#user_Name').data('value','');
			}else{
				$('.xSelect-show-text',$('#user_Name')).text(mode_json_arr_IsDefault_true.Name);
				$('#user_Name').data('value',mode_json_arr_IsDefault_true.PwdModConfigId);
				items=mode_json_arr_IsDefault_true;
			}
			host_mode_info_user(items);
		}else{
			var items=null;
			$('#autoView').hide();
			$('#user_Name').blur();
			if (pwd_setting_user_item.length==1 && pwd_setting_user_item[0]!=null) {
				$.each(mode_json_arr.PwdModConfigSet,function (i,item) {
					if(item.PwdModConfigId==pwd_setting_user_item[0]){
						$('.xSelect-show-text',$('#user_Name')).text(item.Name);
						$('#user_Name').data('value',item.PwdModConfigId);
						items=item;
						return false;
					}
				});
			} else if(pwd_setting_item.PwdModConfigId!=null){
				$('.xSelect-show-text',$('#user_Name')).text(pwd_setting_item.Name);
				$('#user_Name').data('value',pwd_setting_item.PwdModConfigId);
				$.each(mode_json_arr.PwdModConfigSet,function (i,item) {
					if(pwd_setting_item.PwdModConfigId==item.PwdModConfigId){
						items=item;
						return false;
					}
				});
			}else if(mode_json_arr_IsDefault_true==null){
				$('#user_Name').val('');
				$('.xSelect-show-text',$('#user_Name')).text('请选择');
				$('#user_Name').data('value','');
			}else{
				$('.xSelect-show-text',$('#user_Name')).text(mode_json_arr_IsDefault_true.Name);
				$('#user_Name').data('value',mode_json_arr_IsDefault_true.PwdModConfigId);
				items=mode_json_arr_IsDefault_true;
			}
			host_mode_info_user(items);
			
		}
	});
	$('#user_select').on('change',function () {
		var val = $(this).val();
		$('#user_select').parent('.form-c').attr('value',val);
		if($('#user_select').find('option').length==1){
			$('#user_select').parent().hide();
		}else if($('#user_select').find('option').length==2 && val!='0'){
			$('#user_select').parent().hide();
			//console.log('_adduser');
			_adduser($('i.ctr-add'));
		}else{
			$('#user_select').parent().show();
		}
	})
	//输入数字
	$("#pwd_setting_page").bind('keydown', function(e){
		DigitInput(e);
	});
	//tr双击事件
	$("#pwd_setting_list").on('dblclick','tr',function(e){
		x=e.target;
		var id=$(this).find("td");
		DeviceTypeId=$(id).eq(4).text();
		HostId=$(id).eq(1).text();
		if(mode_ajax()){
			mode_Dialog();
		}
	}).on("click", "tr", function (e){  
		x=e.target;
		//编辑按钮
		if(x.id == 'edit'){
			var id=$(this).find("td");
			DeviceTypeId=$(id).eq(4).text();
			HostId=$(id).eq(1).text();
			if(mode_ajax()){
				mode_Dialog();
			}
		}
	});
	//账号tr双击事件
	$("#usertask_list tbody").on('dblclick','tr',function(e){
		x=e.target;
		var id=$(this).find("td");
		var pro_name=$(id).eq(2).text();
		if(pro_name=='MSSQL' || pro_name=='MYSQL' || pro_name=='ORACLE' || pro_name=='SYBASE'){
			return false;
		}
		var PasswordAuthId=$(id).eq(1).text();
		mode_user_Dialog(PasswordAuthId,1);
	}).on("click", "tr", function (e){  
		x=e.target;
		//编辑按钮
		if(x.id == 'edit'){
			var id=$(this).find("td");
			var PasswordAuthId=$(id).eq(1).text();
			mode_user_Dialog(PasswordAuthId,1);
		}
	});
 });
$(function(){
	document.frm_pwd_setting.se.value=window.parent.document.frm.se.value;
	//页码显示
	$("#page_nums").val(MAX_PAGE);
	//list show
	show_pwd_setting_list();
})
function _adduser(obj) {
	//console.log('cpp');
	var m_i = $(obj).parent().children('select').val();
	var text = $(obj).parent().children('select').find("option:selected").text();
	//console.log(m_i+':'+text);
	if (m_i == "0") {
		_alert(2, '账号改密配置', '请选择账号');
		return false;
	}
	//console.log('ccp11');
	var $c = $('<div class="form-c user_add" value="'+m_i+'">');
	$c.html('<input class="form-text" type="text" style="width: 182px;padding-right:8px;" value="' + text + '" disabled><i style="    " class="ctr ctr-del" onclick="_deluser(this);"></i>');
	$(obj).parent().after($c);
	//console.log('ccp12');
	check_user_select_arr[m_i]=all_user_select_arr[m_i];
	$(obj).parent().children('select').find('option[value=' + m_i + ']').remove();
	$(obj).parent().children('select').val(0).trigger("change");
	
}
var $focusObj;

function _delNode(obj,del_json) {
	var type = $focusObj.attr('id');
	var value = obj;
	switch (type) {
		case 'Name':
			var layer_value='主机设定';
			break;
		case 'user_Name':
			var layer_value='账号设定';
			break;
	}
	if(parseInt($focusObj.data('value'))==value){
		$focusObj.data('value', '');
		$('.xSelect-show-text',$focusObj).text('请选择');
	}
	msstr = aceg(JSON.stringify(pwdchange_mode_item),$("input[name=se]").val());
	$.ajax({
		url: "/bhost/save_pwdchange_mode_item",
		type:"POST",
		async:false,
		data:{a0:$("input[name=se]").val(),a1:JSON.stringify(mode_json_arr),a2:'del',a3:del_json,m1:msstr},
		success:function(result){
			var result=JSON.parse(result);
			if(result.Result){
				get_pwd_setting_list_fun();
			}else{
				_alert(1,layer_value,result.ErrMsg);
			}
		}
	});
}
function _addNew(obj,num) {
	if(num==0){
		var add_name='';
		var div_name='#pwdchange_mode_form ';
	}else{
		var add_name='user_';
		var div_name='#pwdchange_user_mode_form ';
	}
	//console.log(add_name+'|'+div_name);
	$('#'+add_name+'Name_type').attr('disabled',false);
	$('#'+add_name+'Name_type').val(1).trigger('change');
	$('#'+add_name+'Config').val('');
	$(div_name+'.select-form select.item_select').each(function () {
		$(this).val($(this).find('option:first').attr('value')).trigger('change');
	});
	//console.log('!!!!');
	$('.xSelect-show-text',$focusObj).text('新增');
	$focusObj.data('value','0');
	$focusObj.next('input.forName').val('').show().focus();
	$(div_name+' .name_form').show();
	$('#'+add_name+'Name_type').val(1).trigger('change');
}
function _setVal(obj,num) {
	var id_name=parseInt($(obj).attr('id').split('-')[1]);
	$.each(mode_json_arr.PwdModConfigSet,function (i,item) {
		if(item.PwdModConfigId==id_name){
			$focusObj.val(item.Name);
			$focusObj.attr('value',item.PwdModConfigId);
			if(num==0){
				host_mode_info(item);
			}else{
				host_mode_info_user(item);
			}
			return false;
		}
	});
	var $item = $focusObj.parents('div.g-title').next('div.g-cont').find('div.forName');
	var $item2 = $focusObj.parent().next('input.forName');
	$item.hide();
	$item2.hide();
}
function _hideView(obj,num) {
	//console.log('_hideView');
	$(document)[0].onclick = function () {
		$('#autoView').hide();
		$('.g-tsel').removeClass('on');
	}
	if($focusObj==undefined){
		return false;
	}
	var get_name=mode_json_arr.PwdModConfigSet.map(function (index) {
		return index.Name;
	})
	var id=$focusObj.attr('id');
	var name=$focusObj.val().trim();
	var val=$.inArray(name,get_name);
	var exist_val=$focusObj.attr('value');
	//console.log('exist_val:'+exist_val);
	if(num==0){
		if(!$('#Name_new').is(':hidden')){
			$focusObj.val('新增');
			$('#Name_new').focus();
		}else{
			if(val>=0){
				if(mode_json_arr.PwdModConfigSet[val].PwdModConfigId!=exist_val){
					$focusObj.attr('value',mode_json_arr.PwdModConfigSet[val].PwdModConfigId);
					$focusObj.val(mode_json_arr.PwdModConfigSet[val].Name);
					host_mode_info(mode_json_arr.PwdModConfigSet[val]);
				}else{
					$focusObj.val(mode_json_arr.PwdModConfigSet[val].Name);
				}
			}else{
				if(exist_val!='Name'){
					$.each(mode_json_arr.PwdModConfigSet,function (i,item) {
						if(item.PwdModConfigId==parseInt(exist_val)){
							$focusObj.val(item.Name);
							return false;
						}
					});
					// $focusObj.val(mode_json_arr.PwdModConfigSet[exist_val].Name);
				}else {
					$focusObj.val('');
				}
				
			}
		}
	}else{
		if(!$('#user_Name_new').is(':hidden')){
			$focusObj.val('新增');
			$('#user_Name_new').focus();
		}else{
			if(val>=0){
				if(mode_json_arr.PwdModConfigSet[val].PwdModConfigId!=exist_val){
					$focusObj.attr('value',mode_json_arr.PwdModConfigSet[val].PwdModConfigId);
					$focusObj.val(mode_json_arr.PwdModConfigSet[val].Name);
					host_mode_info_user(mode_json_arr.PwdModConfigSet[val]);
				}else{
					$focusObj.val(mode_json_arr.PwdModConfigSet[val].Name);
				}
			}else{
				if(exist_val!='user_Name'){
					$.each(mode_json_arr.PwdModConfigSet,function (i,item) {
						if(item.PwdModConfigId==parseInt(exist_val)){
							$focusObj.val(item.Name);
							return false;
						}
					});
					// $focusObj.val(mode_json_arr.PwdModConfigSet[exist_val].Name);
				}else {
					$focusObj.val('');
				}
			}
		}
	}
}
function _deluser(obj) {
	var $c = $(obj).parent();
	var m_i = $(obj).parent().attr('value');
	//console.log('m_i'+m_i);
	delete check_user_select_arr[m_i];
	for (x in all_user_select_arr){
		//console.log(x);
		//console.log(check_user_select_arr[x]);
		//console.log(all_user_select_arr[x]);
		if(parseInt(x)>parseInt(m_i) && check_user_select_arr[x]==undefined && $('#user_select').find('option[value='+m_i+']').length==0){
			//console.log('111');
			//console.log(all_user_select_arr[x].PasswordAuthId);
			$('#user_select').find('option[value='+x+']').before(all_user_select_arr[m_i]);
			break;
		}
		if(parseInt(x)==all_user_select_arr.length-1 && $('#user_select').find('option[value='+m_i+']').length==0){
			$('#user_select').append(all_user_select_arr[m_i]);
			break;
		}
	}
	
	//console.log(x);
	if(!$('.user_all').is(":hidden")){
		$c.fadeOut(function () {
			$c.remove();
		});
	}else{
		$c.remove();
	}
	$('#user_select').trigger('change');	
}
function clear_null_uer_mode(obj,num) {
	//console.log(obj);
	if(num==1){
		pwd_setting_item.AcctPwdModConfigSet.filter(function (params) {
			if(params.PasswordAuthId==parseInt(obj)){
				params.PwdModConfigId=null;
				params.Name=null;
			} 
		});
		//console.log(pwd_setting_item);
	}else{
		$(obj).blur();

	}
	show_pwd_setting_user_list();
}

//切换导入/任务
function set_tab(obj,type){
	$('#autoView').hide();
	if (type == 1){
		$("#host_mode").show();
		$("#user_mode").hide();
	}else if(type == 2){
		$("#user_mode").show();
		$("#host_mode").hide();
	}
	$(obj).addClass("active").parent().siblings().children().removeClass("active");
}
function change_many(obj) {
	$(obj).blur();
	mode_user_Dialog(0,'all');
}
function get_pwd_setting_list_fun() {
	var pass=true;
	$.ajax({
		url: "/bhost/get_pwd_setting_list",
		type:"POST",
		async:false,
		data:{a0:$("input[name=se]").val(),a1:'{'+HostId+'}',a5:'false'},
		success:function(result){
			var result=JSON.parse(result);
			if(result.Result){
				pwd_setting_item=result.info.data[0];
				if(pwd_setting_item.AcctPwdModConfigSet==null){
					pwd_setting_item.AcctPwdModConfigSet=new Array();
				}
			}else{
				_alert(1,'主机设定',result.ErrMsg);
				pass=false;
			}
		}
	});
	//console.log('pwd_setting_item');
	//console.log(pwd_setting_item);
	return pass;
}
function get_pwdchange_mode_list_fun(num) {
	var pass=true;
	$.ajax({
		url: "/bhost/get_pwdchange_mode_list",
		type:"POST",
		async:false,
		data:{a0:$("input[name=se]").val(),a1:DeviceTypeId},
		success:function(result){
			var result=JSON.parse(result);
			if(result.Result){
				mode_json_arr=result.info.data[0];
				if(mode_json_arr.PwdModConfigSet==null){
					mode_json_arr.PwdModConfigSet=new Array();
				}
				if(num==0){
					var form_select=$('#pwdchange_mode_form .select-form');
					//console.log(form_select);
					var form_select_value=form_select.map(function (params) {
						return $('.item_select',$(this)).val();
					});
					//console.log(form_select_value);
				}else if(num==1){
					var form_select=$('#pwdchange_user_mode_form .select-form');
					var form_select_value=form_select.map(function (params) {
						return $('.item_select',$(this)).val();
					});
				}else if(num=='all'){
					var form_select=$('#pwdchange_user_mode_form .select-form');
					var form_select_value=form_select.map(function (params) {
						return $('.item_select',$(this)).val();
					});
				}
				else{
					var form_select=null;
					var form_select_value=null;
				}
				var style_value='';
				if(form_select==null){

				}else if (form_select.length==0){
					style_value='style="display:none;"';
				}else if(form_select.eq(0).is(':hidden')){
					style_value='style="display:none;"';
				}
				// var style_value=$('#pwdchange_mode_form .select-form').eq(0).is(':hidden');
				$('#pwdchange_mode_form .select-form').remove();
				$('#pwdchange_user_mode_form .select-form').remove();
				if(mode_json_arr.PwdModConfigSet==null || mode_json_arr.PwdModConfigSet.length==0){
					mode_json_arr_IsDefault_true=null;
				}else{
					mode_json_arr_IsDefault_true=null;
					$.each(mode_json_arr.PwdModConfigSet,function (i,item) {
						if(item.IsDefault){
							mode_json_arr_IsDefault_true=item;
							return false;
						}
					});
				}
				if(mode_json_arr.PwdModMethodSet!=null){
					var select_form_arr=mode_json_arr.PwdModMethodSet.map(function (params,index) {//index
						if(form_select_value==null){
							var option_str='<option value="'+params.MethodOptionValue[0].replace(/'/g,"")+'" selected >'+params.MethodOptionName[0].replace(/'/g,"")+'</option>';
							//"<option value="RPC" selected >RPC普通</option>"
						}else if(form_select_value[index]==params.MethodOptionValue[0].replace(/'/g,"")){//=="RPC"
							var option_str='<option value="'+params.MethodOptionValue[0].replace(/'/g,"")+'" selected >'+params.MethodOptionName[0].replace(/'/g,"")+'</option>';
							//"<option value="RPC" selected >RPC普通</option>"
						}else{
							var option_str='<option value="'+params.MethodOptionValue[0].replace(/'/g,"")+'">'+params.MethodOptionName[0].replace(/'/g,"")+'</option>';
							//"<option value="RPC">RPC普通</option>"
						}
						for (i=1;i<params.MethodOptionValue.length;i++){
							if (params.MethodOptionName[i].replace(/'/g,"")=='RPC特权'){
								continue;
							}
							if(form_select_value==null){
								option_str+=('<option value="'+params.MethodOptionValue[i].replace(/'/g,"")+'" >'+params.MethodOptionName[i].replace(/'/g,"")+'</option>');
							}else if(form_select_value[index]==params.MethodOptionValue[i].replace(/'/g,"")){
								option_str+=('<option value="'+params.MethodOptionValue[i].replace(/'/g,"")+'" selected>'+params.MethodOptionName[i].replace(/'/g,"")+'</option>');
							}else{
								option_str+=('<option value="'+params.MethodOptionValue[i].replace(/'/g,"")+'" >'+params.MethodOptionName[i].replace(/'/g,"")+'</option>');
							}
						}
						return '<div class="form-item select-form" '+style_value+'>'+
						'<span class="form-tag">'+params.MethodTitle+'：'+'</span>'+
						'<div class="form-c">'+
						'<select class="form-select item_select" name="'+params.MethodName+'" id="'+params.MethodName+'" style="width: 132px;">'+
						option_str+'</select>'+
						'</div></div>';
					}).join('');
					$('#pwdchange_mode_form').append(select_form_arr);
					$('#user_select_div').before(select_form_arr);
					$('#SecuritySetting','#pwdchange_mode_form').unbind().on('change',function () {
						var SecuritySetting_value=$('#SecuritySetting','#pwdchange_mode_form').val();
						if(SecuritySetting_value=='1'){
							$('#EnrcyptLevel','#pwdchange_mode_form').parents('div.select-form').show();
							$('#SecurityLevel','#pwdchange_mode_form').parents('div.select-form').hide();
						}else{
							$('#EnrcyptLevel','#pwdchange_mode_form').parents('div.select-form').hide();
							$('#SecurityLevel','#pwdchange_mode_form').parents('div.select-form').show();
						}
					});
					$('#ModelSetting','#pwdchange_mode_form').unbind().on('change',function () {
						var ModelSetting_value=$('#ModelSetting','#pwdchange_mode_form').val();
						if(ModelSetting_value=='1'){
							$('#VTYSettingStart','#pwdchange_mode_form').parents('div.select-form').show();
							$('#VTYSettingEnd','#pwdchange_mode_form').parents('div.select-form').show();
						}else{
							$('#VTYSettingStart','#pwdchange_mode_form').parents('div.select-form').hide();
							$('#VTYSettingEnd','#pwdchange_mode_form').parents('div.select-form').hide();
						}
					});
					$('#SecuritySetting','#pwdchange_user_mode_form').unbind().on('change',function () {
						var SecuritySetting_value=$('#SecuritySetting','#pwdchange_user_mode_form').val();
						if(SecuritySetting_value=='1'){
							$('#EnrcyptLevel','#pwdchange_user_mode_form').parents('div.select-form').show();
							$('#SecurityLevel','#pwdchange_user_mode_form').parents('div.select-form').hide();
						}else{
							$('#EnrcyptLevel','#pwdchange_user_mode_form').parents('div.select-form').hide();
							$('#SecurityLevel','#pwdchange_user_mode_form').parents('div.select-form').show();
						}
					});
					$('#ModelSetting','#pwdchange_user_mode_form').unbind().on('change',function () {
						var ModelSetting_value=$('#ModelSetting','#pwdchange_user_mode_form').val();
						if(ModelSetting_value=='1'){
							$('#VTYSettingStart','#pwdchange_user_mode_form').parents('div.select-form').show();
							$('#VTYSettingEnd','#pwdchange_user_mode_form').parents('div.select-form').show();
						}else{
							$('#VTYSettingStart','#pwdchange_user_mode_form').parents('div.select-form').hide();
							$('#VTYSettingEnd','#pwdchange_user_mode_form').parents('div.select-form').hide();
						}
					});
					$('.select-form .form-select','#pwdchange_mode_form').select2({minimumResultsForSearch: -1});
					$('.select-form .form-select','#pwdchange_user_mode_form').select2({minimumResultsForSearch: -1});
				}else{
					var select_form_arr=
					'<div class="form-item select-form" style="width: 132px;">'+
						'<span class="form-tag">连接方式：</span>'+
						'<div class="form-c">'+
							'<select class="form-select item_select" name="UpdateStyle" id="UpdateStyle" style="width: 132px;">'+
								'<option value="" selected >普通</option>'+
								'<option  value="privilege">特权</option>'+
							'</select>'+
						'</div>'+
					'</div>';
					$('#pwdchange_mode_form').append(select_form_arr);
					$('#user_select_div').before(select_form_arr);
					$('#SecuritySetting','#pwdchange_mode_form').unbind().on('change',function () {
						var SecuritySetting_value=$('#SecuritySetting','#pwdchange_mode_form').val();
						if(SecuritySetting_value=='1'){
							$('#EnrcyptLevel','#pwdchange_mode_form').parents('div.select-form').show();
							$('#SecurityLevel','#pwdchange_mode_form').parents('div.select-form').hide();
						}else{
							$('#EnrcyptLevel','#pwdchange_mode_form').parents('div.select-form').hide();
							$('#SecurityLevel','#pwdchange_mode_form').parents('div.select-form').show();
						}
					});
					$('#ModelSetting','#pwdchange_mode_form').unbind().on('change',function () {
						var ModelSetting_value=$('#ModelSetting','#pwdchange_mode_form').val();
						if(ModelSetting_value=='1'){
							$('#VTYSettingStart','#pwdchange_mode_form').parents('div.select-form').show();
							$('#VTYSettingEnd','#pwdchange_mode_form').parents('div.select-form').show();
						}else{
							$('#VTYSettingStart','#pwdchange_mode_form').parents('div.select-form').hide();
							$('#VTYSettingEnd','#pwdchange_mode_form').parents('div.select-form').hide();
						}
					});
					$('#SecuritySetting','#pwdchange_user_mode_form').unbind().on('change',function () {
						var SecuritySetting_value=$('#SecuritySetting','#pwdchange_user_mode_form').val();
						if(SecuritySetting_value=='1'){
							$('#EnrcyptLevel','#pwdchange_user_mode_form').parents('div.select-form').show();
							$('#SecurityLevel','#pwdchange_user_mode_form').parents('div.select-form').hide();
						}else{
							$('#EnrcyptLevel','#pwdchange_user_mode_form').parents('div.select-form').hide();
							$('#SecurityLevel','#pwdchange_user_mode_form').parents('div.select-form').show();
						}
					});
					$('#ModelSetting','#pwdchange_user_mode_form').unbind().on('change',function () {
						var ModelSetting_value=$('#ModelSetting','#pwdchange_user_mode_form').val();
						if(ModelSetting_value=='1'){
							$('#VTYSettingStart','#pwdchange_user_mode_form').parents('div.select-form').show();
							$('#VTYSettingEnd','#pwdchange_user_mode_form').parents('div.select-form').show();
						}else{
							$('#VTYSettingStart','#pwdchange_user_mode_form').parents('div.select-form').hide();
							$('#VTYSettingEnd','#pwdchange_user_mode_form').parents('div.select-form').hide();
						}
					});
					$('.select-form .form-select','#pwdchange_mode_form').select2({minimumResultsForSearch: -1});
					$('.select-form .form-select','#pwdchange_user_mode_form').select2({minimumResultsForSearch: -1});
				}
			}else{
				_alert(1,'主机设定',result.ErrMsg);
				pass=false;
			}
		}
	});
	return pass;
}
function mode_ajax(){
	var pass=true;
	if(!get_pwd_setting_list_fun()){
		pass=false;
	}
	if(!get_pwdchange_mode_list_fun()){
		pass=false;
	}
	$('#Name_value').trigger('change');
	return pass;
}
function host_mode_info(items){
	$('#Name_new').hide();
	//console.log('host_mode_info');
	//console.log(items);
	if(items==null){
		$('#Name_type').parents('.name_form').hide();
		$('#Config_div').hide();
		$('#host_mode .select-form').hide();
		return false;
	}else{
		$('#Name_type').parents('.name_form').show();
	}
	var select_arr=$('#host_mode select.item_select');
	if(items.PwdModConfigId<1000){
		$('#Name_type').attr('disabled',true);
	}else{
		$('#Name_type').attr('disabled',false);
	}
	$('#Name_type').val(items.Type).trigger('change');
	if(items.Type==1){
		var config_arr=items.Config.split(' ');
		$.each(select_arr,function (i,item) {
			$(item).val(config_arr[i]).trigger('change');
		});
	}else{
		$('#Config').val(items.Config);
	}
}
function host_mode_info_user(items) {
	$('#user_Name_new').hide();
	if(items==null){
		$('#user_Name_type').parents('.name_form').hide();
		$('#user_Config_div').hide();
		$('#pwdchange_user_mode_form .select-form').hide();
		return false;
	}else{
		$('#user_Name_type').parents('.name_form').show();
	}
	var select_arr=$('#pwdchange_user_mode_form select.item_select');
	if(items.PwdModConfigId<1000){
		$('#user_Name_type').attr('disabled',true);
	}else{
		$('#user_Name_type').attr('disabled',false);
	}
	$('#user_Name_type').val(items.Type).trigger('change');
	if(items.Type==1){
		var config_arr=items.Config.split(' ');
		$.each(select_arr,function (i,item) {
			$(item).val(config_arr[i]).trigger('change');
		});
	}else{
		$('#user_Config').val(items.Config);
	}
}
function update_xSelect($obj){
	var obj_class=$obj.attr('class').indexOf('user_Name');
	if(obj_class>=0){
		var title_value='账号设定';
		var _addNew_num=1;
	}else{
		var title_value='主机设定';
		var _addNew_num=0;
	}
	var id_value=$obj.data('value');
	var text_value=$('.xSelect-show-text',$obj).text();
	var id=$('.xSelect-show',$obj).data('id');
	$obj.empty().data('xSelect','');
	$('.'+id).remove();
	$.ajax({
		url: "/bhost/get_pwdchange_mode_list",
		type:"POST",
		async:false,
		data:{a0:$("input[name=se]").val(),a1:DeviceTypeId},
		success:function(result){
			var result=JSON.parse(result);
			if(result.Result){
				mode_json_arr=result.info.data[0];
				if(mode_json_arr.PwdModConfigSet==null){
					mode_json_arr.PwdModConfigSet=new Array();
				}
				if(mode_json_arr.PwdModMethodSet==null){
					mode_json_arr.PwdModMethodSet=new Array();
				}
				PwdModConfigSet=new Array();
				$.each(mode_json_arr.PwdModConfigSet,function (i,item) {
					PwdModConfigSet.push(JSON.parse('{"type":'+(perm==2?'"delete"':'null')+',"name":"'+item.Name+'","value":'+item.PwdModConfigId+'}'));
				});
			}else{
				_alert(1,title_value,result.ErrMsg);
				return false;
			}
		}
	});
	xSelect_json={
		width: 200,
		defaultText: '请选择',
		items:PwdModConfigSet,
		edit: function (item, obj) {
		},
		delete: function(item,obj){
			$('.'+$('.xSelect-show',$obj).data('id')).hide();
			update_xSelect($obj);
			item=obj.children('span').data('value');
			if(item<=1000){
				_alert(1,title_value,'系统自带的脚本不能删除');
				return false;
			}
			var pass=1;
			$.each(mode_json_arr.PwdModConfigSet,function (i,item_1) {
				if(item_1.IsDefault && item_1.PwdModConfigId==item){
					_alert(1,title_value,'该脚本已被选为默认');
					pass=0;
					return false;
				}
			});
			if(pass==0){
				return false;
			}
			$('.btn').blur(); 
			parent.layer.open({
				type: 1,
				title: title_value,
				content: '<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
				btn: ['删&nbsp;&nbsp;除', '取&nbsp;&nbsp;消'],
				btnAlign: 'c',
				closeBtn: false,
				skin: 'layer-custom',
				area: ['380px', '310px'],
				move: false,
				resize: false,
				yes: function (i) {
					parent.layer.close(i);
					var del_json;
					$.each(mode_json_arr.PwdModConfigSet,function(i,item_1){
						if(item_1.PwdModConfigId==parseInt(item)){
							del_json=JSON.stringify(mode_json_arr.PwdModConfigSet[i]);
							mode_json_arr.PwdModConfigSet.splice(i,1);
							return false;
						}
					});
					_delNode(item,del_json);
					update_xSelect($obj);
				}
			});
		},
		btn:[
			
		],
		setval:function(item,obj){
			//console.log(obj.children('span').data('value'));
			item=obj.children('span').data('value');
			var items;
			$.each(mode_json_arr.PwdModConfigSet,function (i,item_1) {
				if(item==item_1.PwdModConfigId){
					items=item_1;
					return false;
				}
			});
			if(obj_class>=0){
				host_mode_info_user(items);
			}else{
				host_mode_info(items);
			}
		}
	};
	if(perm==2){
		xSelect_json.btn.push({
				'name':'新增',
				'event': function(items,obj){
					_addNew(obj,_addNew_num);
				}
			});
	}
	$obj.xSelect(xSelect_json);
	$obj.data('value',id_value);
	$('.xSelect-show-text',$obj).text(text_value);
}
function clear_mode() {
	update_xSelect($('.Name'));
	$('.forName').hide();
	if(pwd_setting_item.PwdModConfigId==null){
		$('#Name_value').val(1).trigger('change');
	}else{
		$('#Name_value').val(2).trigger('change');
	}
	$('#curpage').val(1);
	show_pwd_setting_user_list();
	var len_num=pwd_setting_item.AcctPwdModConfigSet.length;
	$('#task_total').text(len_num);
	$('#totalpage').text(len_num%5==0?(len_num==0?1:parseInt(len_num/5)):parseInt(len_num/5)+1);
	all_user_select_arr=new Array();
	check_user_select_arr=new Array();
	all_user_select_arr.push('<option value="0">请选择</option>');
	pwd_setting_item.AcctPwdModConfigSet.filter(function (params) {
		return (params.ProtocolName.indexOf('MSSQL')<0 && params.ProtocolName.indexOf('MYSQL')<0 && params.ProtocolName.indexOf('ORACLE')<0 && params.ProtocolName.indexOf('SYBASE')<0);
	}).map(function (params) {
		all_user_select_arr[params.PasswordAuthId]='<option value="'+params.PasswordAuthId+'">'+params.AccountName+'('+params.ProtocolName+')'+'</option>';
	});
	//console.log(all_user_select_arr);
	if(all_user_select_arr.length==1){
		$('#change_many').hide();
	}else{
		$('#change_many').show();
	}
}
function show_pwd_setting_user_list(){
	$('#usertask_list tbody').empty();
	if(pwd_setting_item.AcctPwdModConfigSet!=null){
		var _len=pwd_setting_item.AcctPwdModConfigSet.length;
		var num=parseInt($('#curpage').val())
		for(i=((num-1)*5);i<(num*5>_len?_len:num*5);i++){
			var params=pwd_setting_item.AcctPwdModConfigSet[i];
			//console.log(params);
			var Name;
			if(params.Name==null){
				Name='跟随主机';
			}else{
				Name='自定义：'+params.Name;
			}
			$('#usertask_list tbody').append('<tr>'+
				'<td title="'+(params.AccountName||'')+'">'+(params.AccountName||'')+'</td>'+
				'<td title="'+params.PasswordAuthId+'" style = "display:none">'+params.PasswordAuthId+'</td>'+
				'<td title="'+(params.ProtocolName||'')+'">'+(params.ProtocolName||'')+'</td>'+
				'<td title="'+(pwd_setting_item.DeviceTypeName||'')+'">'+(pwd_setting_item.DeviceTypeName||'')+'</td>'+
				'<td title="'+(Name||'跟随主机')+'">'+(Name||'跟随主机')+'</td>'+
				'<td><div class="tab-ctr">'+
				((params.ProtocolName.indexOf('MSSQL')>=0 || params.ProtocolName.indexOf('MYSQL')>=0 || params.ProtocolName.indexOf('ORACLE')>=0 || params.ProtocolName.indexOf('SYBASE')>=0)?'<a href="javascript:;" class="'+(perm==2?'edit disabled':'search_result')+'" id="'+(perm==2?'':'edit')+'" title="'+(perm==2?'修改模式':'查看模式')+'"></a>':'<a href="javascript:;" class="'+(perm==2?'edit':'search_result')+'" id="edit" title="'+(perm==2?'修改模式':'查看模式')+'"></a>')+'</div></td></tr>');
		}
		$(".input_checkbox","#usertask_list tbody").iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		});
	}else{
		pwd_setting_item.AcctPwdModConfigSet=new Array();
	}
}
function clear_mode_user(id,num) {
	update_xSelect($('#user_Name'));
	$('#user_Name_new').hide();
	if(num==1){
		pwd_setting_user_item=pwd_setting_item.AcctPwdModConfigSet.filter(function (params) {
			return params.PasswordAuthId==parseInt(id);
		}).map(function (params) {
			return params.PwdModConfigId;
		});
		$('#user_select').empty();
	}else{
		pwd_setting_user_item=new Array();
		check_user_select_arr=new Array();
		$('#user_select_div .user_add:not(.user_all)').remove();
		$('#user_select').empty();
		$('#user_select').append(all_user_select_arr);
	}
	//console.log('pwd_setting_user_item');
	//console.log(pwd_setting_user_item);
	if(pwd_setting_user_item.length==1 && pwd_setting_user_item[0]!=null){
		$('#user_Name_value').val(2).trigger('change');
	}else{
		$('#user_Name_value').val(1).trigger('change');
	}
}
function unique(arr){
	var result = [];
	for(var i=0;i<arr.length;i++){
		if(result.indexOf(arr[i])==-1){
			result.push(arr[i])
		}
	}
	return result;
}
function mode_user_Dialog(id,num) {
	var $dialogCont = $("#scDCTab1").show();
	clear_mode_user(id,num);
	if(num==1){
		$('#user_select_div').hide();
	}else{
		$('#user_select_div').show();
		$('#user_select_div').attr('value','0');
		$('#user_select').val(0).trigger('change');
	}
	d0 = dialog({
		title:"账号改密配置",
		content:$dialogCont,
		id:"scDCTab1",
		width:"850px",
	});
	d0.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	d0.showModal();
	$('#scDCTab1').parents('.ui-popup').next('div').addClass('scDCTab1_class');
	$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
		clear_mode_user(id,num);
		if(num==1){
			$('#user_select_div').hide();
		}else{
			$('#user_select_div').show();
			$('#user_select_div').attr('value','0');
			$('#user_select').val(0).trigger('change');
		}
		show_pwd_setting_user_list();
	});
	$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
		//console.log('a.btn-submit');
		$('#autoView').hide();
		if(save_user_mode(id,num) && save_mode(num,id)){
			$('.btn').blur();parent.layer.open({
				type: 1,
				title: '主机设定',
				content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
				btn: ['确&nbsp;&nbsp;定'],
				btnAlign: 'c',
				closeBtn: false,
				skin: 'layer-custom',
				area: ['380px', '310px'],
				move: false,
				resize: false,
				yes: function (i) {
					parent.layer.close(i);
					d0.close().remove();
					$('#Name_value').trigger('change');
					show_pwd_setting_user_list();
					show_pwd_setting_list();
				}
			});
		}
	});
}
var PwdModConfigSet=new Array();
function mode_Dialog() {
	var $dialogCont = $("#scDCTab2_import").show();
	clear_mode();
	d = dialog({
		title:"主机改密配置",
		content:$dialogCont,
		id:"scDCTab2_import",
		width:"850px"
	});
	$("#host_mode").show();
	$("#user_mode").hide();
	$("#task_host").addClass("active").parent().siblings().children().removeClass("active");
	if(pwd_setting_item.AcctPwdModConfigSet.length==0){
		$('#task_user').parent('li').hide();
	}else{
		$('#task_user').parent('li').show();
	}
	d.addEventListener('close', function () {
		$dialogCont.appendTo("body").hide();
	});
	d.showModal();

	$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
		clear_mode();
		show_pwd_setting_list();
	});
	
	$("a.btn-return",$dialogCont).unbind().bind("click",function(){
		d.close().remove();
	});
	$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
		$('#autoView').hide();
		if(save_mode(0)){
			$('.btn').blur();parent.layer.open({
				type: 1,
				title: '改密配置',
				content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
				btn: ['确&nbsp;&nbsp;定'],
				btnAlign: 'c',
				closeBtn: false,
				skin: 'layer-custom',
				area: ['380px', '310px'],
				move: false,
				resize: false,
				yes: function (i) {
					parent.layer.close(i);
					d.close().remove();
					show_pwd_setting_list();
					
				}
			});
		}
	})
}
function save_user_mode(id,num){
	if($('#user_Name').data('value')=='' || $('#user_Name').data('value')==undefined){
		_alert(2,alert_title,'请选择脚本',$('#'+id_add+'Name'));
		return false;
	}
	if($('#user_Name_value').val()=='1'){
		select_id=null;
		select_name=null;
	}else{
		var select_id=parseInt($('#user_Name').data('value'));
		if(select_id==0){
			var select_name=$('#user_Name_new').val();
		}else{
			var select_name=$('.xSelect-show-text',$('#user_Name')).text();
		}
	}
	if(num==1){
		$.each(pwd_setting_item.AcctPwdModConfigSet,function (i,item) {
			if(item.PasswordAuthId==parseInt(id)){
				item.PwdModConfigId=select_id;
				item.Name=select_name;
				return false;
			}
		});
	}else{
		var div_arr=$('div.user_add[value!=0]');
		if(div_arr.length==0){
			_alert(2,'改密配置','请选择账号');
			return false;
		}
		var id_arr=div_arr.map(function (params) {
			return parseInt($(this).attr('value'));
		});
		//console.log(id_arr);
		$.each(pwd_setting_item.AcctPwdModConfigSet,function (i,item) {
			//console.log(item);
			var index=$.inArray(item.PasswordAuthId,id_arr);
			if(index>=0){
				item.PwdModConfigId=select_id;
				item.Name=select_name;
				id_arr.splice(index,1);
				if(id_arr.length==0){
					return false;
				}
			}
		});
	}
	//console.log('pwd_setting_item');
	//console.log(pwd_setting_item);
	return true;
}
function save_mode(num,id){
	//console.log('num:'+num);
	if(num==0){
		var id_add='';
		var div_name='#pwdchange_mode_form '
		var alert_title='主机设定';
	}else{
		var id_add='user_';
		var div_name='#pwdchange_user_mode_form '
		var alert_title='账号设定';
	}
	var name=$('.xSelect-show-text',$('#'+id_add+'Name')).text();
	var value=$('#'+id_add+'Name').data('value');
	//console.log('name:'+name);
	//console.log('value:'+value);
	var pass=true;
	if(value=='0'){
		name=$('#'+id_add+'Name_new').val();
		if(name==''){
			_alert(2,alert_title,'请输入名称',$('#'+id_add+'Name_new'));
			return false;
		}else if(!nameReg.test(name)){
			_alert(2,alert_title,'名称格式不正确',$("#"+id_add+"Name_new"));
			return false;
		}
		if(mode_json_arr.PwdModConfigSet.filter(function (params) {
			return params.Name==name;
		}).length){
			_alert(1,alert_title,'同名的脚本已存在',$("#"+id_add+"Name_new"));
			return false;
		}
	}else if(value==undefined || value==''){
		_alert(2,alert_title,'请选择脚本',$('#'+id_add+'Name'));
		return false;
	}
	var mode_json_arr_copy=JSON.parse(JSON.stringify(mode_json_arr));
	//console.log(mode_json_arr_copy);
	if(mode_json_arr_copy.PwdModConfigSet==null || mode_json_arr_copy.PwdModConfigSet.length==0){
		//console.log("进到了无配置代码块");
		//if(mode_json_arr_copy.PwdModConfigSet==null) mode_json_arr_copy.PwdModConfigSet = new Array();
		if(mode_json_arr_copy.PwdModMethodSet==null) mode_json_arr_copy.PwdModMethodSet = new Array();
		//mode_json_arr_copy.PwdModConfigSet[0] = 
		//{
		//	"Name": null,
		//	"Type": null,
		//	"Config": "",
		//	"IsDefault": true,
		//	"PwdModConfigId": null
		//}
		mode_json_arr_copy.PwdModMethodSet[0] = 
		{
			"Position": 2,
			"MethodName": "UpdateStyle",
			"MethodTitle": "连接方式",
			"MethodOptionName": [
				"'普通'",
				"'特权'"
			],
			"MethodOptionValue": [
				"''",
				"'privilege'",
			],
			"MethodDefaultValue": "''"
		}
		//console.log(JSON.stringify(mode_json_arr_copy));
	}else if(mode_json_arr_copy.DeviceTypeId!=1){
		//console.log("进到了有配置代码块");
		//var seltext = $('#UpdateStyle option:selected').text();//选中的文本普通，特权
		//var selval = $('#UpdateStyle option:selected').val();//选中的值 "", "privilege"
		//mode_json_arr_copy.PwdModConfigSet[0].Config = selval;
		//console.log("连接方法:  "+mode_json_arr_copy.PwdModConfigSet[0].Config);
		if(mode_json_arr_copy.PwdModMethodSet==null) mode_json_arr_copy.PwdModMethodSet = new Array();
		mode_json_arr_copy.PwdModMethodSet[0] = 
		{
			"Position": 2,
			"MethodName": "UpdateStyle",
			"MethodTitle": "连接方式",
			"MethodOptionName": [
				"'普通'",
				"'特权'"
			],
			"MethodOptionValue": [
				"''",
				"'privilege'",
			],
			"MethodDefaultValue": "''"
		}
	}
	//console.log(JSON.stringify(mode_json_arr_copy));
	//console.log('pwd_setting_item1111');
	//console.log(pwd_setting_item);
	var edit_str;
	if(value=='0'){
		var config_json=JSON.parse('{"Config":null,"IsDefault": '+(mode_json_arr.PwdModConfigSet.filter(function (params) {
			return params.IsDefault;
		}).length<=0?'true':'false')+',"Type": 1,"PwdModConfigId": 0,"Name":null}');
		config_json.Name=name;
		mode_json_arr_copy.PwdModConfigSet.push(config_json);
		//console.log(JSON.stringify(mode_json_arr_copy));
		$(mode_json_arr_copy.PwdModConfigSet).each(function (i,item) {
			if(item.PwdModConfigId==parseInt(value)){
				if($('#'+id_add+'Name_type').val()=='2'){
					item.Type=2;
					var config=$('#'+id_add+'Config').val();
				}else{
					item.Type=1;
					if(mode_json_arr_copy.PwdModMethodSet.length>0){
						var config=mode_json_arr_copy.PwdModMethodSet.map(function (params) {
							return $(div_name+'#'+params.MethodName).val();
						}).join(' ');
					}else{
						var config='';
					}
				}
				item.Config=config;
				if(($('#'+id_add+'Name_value').val()=='1' && num==0)||($('#'+id_add+'Name_value').val()=='1' && num!=0)){
					item.IsDefault=true;
				}
				edit_str=JSON.stringify(item)				
			}else{
				if(($('#'+id_add+'Name_value').val()=='1' && num==0)||($('#'+id_add+'Name_value').val()=='1' && num!=0)){
					item.IsDefault=false;
				}
			}
		});
	}else{
		//console.log(JSON.stringify(mode_json_arr_copy));
		$(mode_json_arr_copy.PwdModConfigSet).each(function (i,item) {
			if(item.PwdModConfigId==parseInt(value)){
				if($('#'+id_add+'Name_type').val()=='2'){
					item.Type=2;
					var config=$('#'+id_add+'Config').val();
				}else{
					item.Type=1;
					if(mode_json_arr_copy.PwdModMethodSet.length>0){
						var config=mode_json_arr_copy.PwdModMethodSet.map(function (params) {
							return $(div_name+'#'+params.MethodName).val();
						}).join(' ');
					}else{
						var config='';
					}
					//console.log('config:'+config);
				}
				item.Config=config;
				if(($('#'+id_add+'Name_value').val()=='1' && num==0)||($('#'+id_add+'Name_value').val()=='1' && num!=0)){
					item.IsDefault=true;
				}
				edit_str=JSON.stringify(item)
			}else{
				if(($('#'+id_add+'Name_value').val()=='1' && num==0)||($('#'+id_add+'Name_value').val()=='1' && num!=0)){
					item.IsDefault=false;
				}
			}
		});
	}
	//console.log(mode_json_arr_copy);
	msstr = aceg(JSON.stringify(mode_json_arr_copy),$("input[name=se]").val());
	$.ajax({
		url: "/bhost/save_pwdchange_mode_item",
		type:"POST",
		async:false,
		data:{a0:$("input[name=se]").val(),a1:JSON.stringify(mode_json_arr_copy),a2:(value=='0'?'add':'edit'),a3:edit_str,m1:msstr},
		success:function(result){
			var result=JSON.parse(result);
			if(result.Result){
			}else{
				_alert(1,alert_title,result.ErrMsg);
				pass=false;
			}
		}
	});
	if(!get_pwdchange_mode_list_fun(num)){
		pass=false;
	}
	value=mode_json_arr.PwdModConfigSet.filter(function (params) {
		return params.Name==name;
	})[0].PwdModConfigId;
	//console.log('pwd_setting_item:'+JSON.stringify(pwd_setting_item));
	if($('#'+id_add+'Name_value').val()=='1'){
		if(num==0){
			pwd_setting_item.PwdModConfigId=null;
			pwd_setting_item.Name=null;
		}else{
			if(pwd_setting_item.PwdModConfigId!=null){
				pwd_setting_item.PwdModConfigId=parseInt(value);
				pwd_setting_item.Name=name;
			}
		}
	}else{
		if(num==0){
			pwd_setting_item.PwdModConfigId=parseInt(value);
			pwd_setting_item.Name=name;
		}else if(num==1){
			$.each(pwd_setting_item.AcctPwdModConfigSet,function (i,item) {
				if(item.PasswordAuthId==parseInt(id)){
					item.PwdModConfigId=value;
					item.Name=name;
					return false;
				}
			});
		}else{
			var div_arr=$('div.user_add[value!=0]');
			if(div_arr.length==0){
				_alert(2,'警告','请选择账号');
				return false;
			}
			var id_arr=div_arr.map(function (params) {
				return parseInt($(this).attr('value'));
			});
			//console.log(id_arr);
			$.each(pwd_setting_item.AcctPwdModConfigSet,function (i,item) {
				//console.log(item);
				var index=$.inArray(item.PasswordAuthId,id_arr);
				if(index>=0){
					item.PwdModConfigId=value;
					item.Name=name;
					id_arr.splice(index,1);
					if(id_arr.length==0){
						return false;
					}
				}
			});
		}
	}
	//console.log('pwd_setting_item');
	//console.log(pwd_setting_item);
	var pwd_setting_item_copy=JSON.parse(JSON.stringify(pwd_setting_item));
	var arr_len=pwd_setting_item_copy.AcctPwdModConfigSet.length;
	//console.log(arr_len);
	for(var i=0;i<arr_len;i++){
		if(pwd_setting_item_copy.AcctPwdModConfigSet[i].PwdModConfigId==null){
			pwd_setting_item_copy.AcctPwdModConfigSet.splice(i,1);
			i--;
			arr_len--;
		}
	}
	//console.log(pwd_setting_item_copy);
	msstr = aceg(JSON.stringify(pwd_setting_item_copy),$("input[name=se]").val());
	$.ajax({
		url: "/bhost/save_pwd_setting_item",
		type:"POST",
		async:false,
		data:{a0:$("input[name=se]").val(),a1:JSON.stringify(pwd_setting_item_copy),m1:msstr},
		success:function(result){
			var result=JSON.parse(result);
			if(result.Result){
			}else{
				_alert(1,alert_title,result.ErrMsg);
				pass=false;
			}
		}
	});
	if(!get_pwd_setting_list_fun()){
		pass=false;
	}
	return pass;
}
function _addFilter(obj,type,type_num){
	var id = $(obj).parent().children('select').val();
	// <option value="all" selected>所有</option>
	// <option value="hostname">主机名</option>
	// <option value="hostip">IP</option>
	// <option value="DeviceTypeName">设备类型</option>
	// <option value="Name">改密模式</option>
	var v1 = $(obj).parent().children('select').children('option:selected').text();
	var v2 = $(obj).parent().children('input[type=text]').val().trim();
	if(id=='all'){
		v1='';
	}else{
		v1=v1+'-';
	}
	if(v2 == '' && type_num!=1){
		$(obj).parent().children('input[type=text]').blur();
		_alert(2,'搜索','请输入关键字', $(obj).parent().children('input[type=text]'));
		return false;
	}
	// else
	{
		switch (id) {
			case 'hostip':
				var Reg=/^[0-9\.\s]+$/;
				break;
			case 'hostname':
				var Reg=/^[\u4e00-\u9fa5a-zA-Z\d_\-\.\s]+$/;
				break;
			case 'DeviceTypeName':
				var Reg=/^[\u4e00-\u9fa5a-zA-Z\d_\-\.\s]+$/;
				break;
			case 'Name':
				break;
		} 
		if(id!='all' && id!='Name' && !nameReg.test(v2) && type_num!=1){
			$(obj).parent().children('input[type=text]').blur();
			_alert(1,'搜索','关键字格式不正确', $(obj).parent().children('input[type=text]'));
			return false;
		}
		if($.inArray(id+'-'+v2,search_typeall_r)>=0 && type_num!=1){
			$(obj).parent().children('input[type=text]').blur();
			_alert(2,'搜索','关键字重复', $(obj).parent().children('input[type=text]'));
			return false;
		}
		if(type){
			search_typeall_r.push(id+'-'+v2);
			search_typeall_new='';
			$('#filterWW>ul').append('<li><span style = "display:none">'+id+'-'+v2+'</span><span class="ww">'+v1+v2+'</span><i class="del" onclick="_delFilter(this);"></i></li>')
			$("#pwd_setting_text").val('');
			$('#pwd_setting_text_check').hide();
			selView();
		}else{
			if(type_num!=1)search_typeall_new=id+'-'+v2;
		}
	}
	pwd_setting_page(0.1);
}
var search_typeall_new='';
function _delFilter(obj){
	var id = $(obj).parent().find("span");
	var ids=$(id).eq(0).text();
	search_typeall_r.splice($.inArray(ids,search_typeall_r),1);
	var pwd_setting_text=$('#pwd_setting_text').val().trim();
	if(pwd_setting_text==''){
		search_typeall_new=='';
	}else{
		search_typeall_new=$('#pwd_setting_select').val()+'-' +pwd_setting_text;
	}
	$(obj).parent().remove();
	selView();
	pwd_setting_page(0.1);
}
function _clearFilter(obj,num){
	if(num==1){
	$('#pwd_setting_text').val('');
	$('#pwd_setting_text_check').hide();
	search_typeall_new='';
	pwd_setting_page(0.1);
		return;
	}
	$('#clearFilter').next().children('ul').empty();
	$('#pwd_setting_text').val('');
	$('#pwd_setting_text_check').hide();
	search_typeall_new='';
	search_typeall_r=new Array();
	$('#clearFilter').hide();
	selView();
	pwd_setting_page(0.1);
}
function selView(){
	var $sel = $('#filterWW');
	var len = $('li',$sel).length;
	if(len == 0){
		$sel.hide();
		$('#clearFilter').hide();
	}else{
		$("#filterWW").show();
		$('#clearFilter').show();
		$('>span.ww',$sel).show();
		$sel.addClass('selector-multiple');
	}
}

//input回车触发事件
function showMsg(){
	var cur = $("#pwd_setting_page").val();
	cur=cur.replace(/\D/g, "");
	if(cur=='' || parseInt(cur) < 1){
		cur=1;
	}else if (parseInt(cur)>fenye_r) {
		cur=fenye_r;
	}
	if (parseInt(cur) ==parseInt(document.frm_pwd_setting.c.value)){
		$("#pwd_setting_page").val(cur);
		return false;
	}
	document.frm_pwd_setting.c.value=cur;
	show_pwd_setting_list();
}

//input回车触发事件
function showMsg_user(){
	var cur = $("#curpage").val();
	cur=cur.replace(/\D/g, "");
	if(cur=='' || parseInt(cur) < 1){
		cur=1;
	}else if (parseInt(cur)>parseInt($('#totalpage').text())) {
		cur=parseInt($('#totalpage').text());
	}
	$("#curpage").val(cur);
	show_pwd_setting_user_list();
}
//以每页显示数显示列表函数
function show_pwd_setting_list(){
	var paging = document.frm_pwd_setting.c.value;
	var page_num = MAX_PAGE;
	var search_typeall=search_typeall_r.join('\t');
	if(search_typeall_new!=''){
		search_typeall+=('\t'+search_typeall_new);
	}
	$.ajax({
		url: "/bhost/get_pwd_setting_list",
		type:"POST",
		async:false,
		data:{a0:$("input[name=se]").val(),a4:page_num,a3:paging,a2:search_typeall},
		success:function(result){
			var pwd_setting_result = JSON.parse(result);
			if (pwd_setting_result.Result==true){
				pwd_setting_data = pwd_setting_result.info;
				var total_all = pwd_setting_data.totalrow;
				if(total_all%MAX_PAGE==0){
					fenye_r=parseInt(total_all/MAX_PAGE);
				}else{
					fenye_r=parseInt(total_all/MAX_PAGE)+1;
				}
				if(pwd_setting_data.data=="" && paging!="1"){
					pwd_setting_page(0.9);
				}else{
					//total = 0;
					total_all_r = total_all;
					if(total_all){
						id_arr_pagenum='{'+pwd_setting_data.data.map(function (item) {
							return item.HostId;
						}).join(',')+'}';
						$.ajax({
							url: "/bhost/get_pwd_setting_list",
							type:"POST",
							async:false,
							data:{a0:$("input[name=se]").val(),a1:id_arr_pagenum,a5:'false'},
							success:function(result){
								//console.log('success');
								var result=JSON.parse(result);
								if(result.Result){
									pwd_setting_data=result.info;
									//console.log('pwd_setting_data');
									//console.log(pwd_setting_data);
									$("#pwd_setting_list").empty();
									$("#pwd_setting_list").append(pwd_setting_data.data.map(function (params) {
										if (params.Name==null)
											params.Name='跟随设备类型';
										else
											params.Name='自定义：'+params.Name;
										return "<tr>"+
											"<td title=\""+(params.HostName||'')+"\">"+(params.HostName||'')+"</td>"+
											"<td title=\""+params.HostId+"\" style = \"display:none\">"+params.HostId+"</td>"+
											"<td title=\""+(params.HostIP||'')+"\">"+(params.HostIP||'')+"</td>"+
											"<td title=\""+(params.DeviceTypeName||'')+"\">"+(params.DeviceTypeName||'')+"</td>"+
											"<td title=\""+params.DeviceTypeId+"\" style = \"display:none\">"+params.DeviceTypeId+"</td>"+
											"<td title=\""+params.Name+"\">"+params.Name+"</td>"+
											"<td title=\""+(params.AccountNum||'0')+"\">"+(params.AccountNum||'0')+"</td>"+
											"<td title=\""+(params.SetedAccountNum||'0')+"\">"+(params.SetedAccountNum||'0')+"</td>"+
											"<td><div class=\"tab-ctr\">"+
											((params.DeviceTypeId==null)?'':"<a href=\"javascript:;\" class=\""+(perm==2?'edit':'search_result')+"\" id=\"edit\" title='"+(perm==2?'修改模式':'查看模式')+"'></a>")+
											"</div></td></tr>"
									}));
									// tabArr();
									$(".input_checkbox","#pwd_setting_list").iCheck({
										checkboxClass: 'icheckbox_minimal-blue',
										radioClass: 'iradio_minimal-blue',
										increaseArea: '0' // optional
									});
								}else{
									_alert(2,'警告',result.ErrMsg);
									return false;
								}
							}
						});
						$("#pwd_setting_total").text(total_all);
						if(paging>=fenye_r){
							paging=fenye_r;
						}
						document.frm_pwd_setting.c.value=paging;
						document.getElementById("pwd_setting_page").value=paging;
						$("table tbody tr").children("td.in").children("div").children("input").iCheck('uncheck');
						$("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(0);
						$("#pwd_setting_pages").text(fenye_r);
					}else{
						$("#pwd_setting_list").empty();
						$("#pwd_setting_total").text(total_all);
						$("#pwd_setting_pages").text(1);
						$("table tbody tr").children("td.in").children("div").children("input").iCheck('uncheck');
						$("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(0);
						document.frm_pwd_setting.c.value=1;
						fenye_r=1;
						document.getElementById("pwd_setting_page").value=1;
					}	
				}
			}else{
				_alert(2,"主机设定",pwd_setting_result.ErrMsg);
				$("table tbody tr").children("td.in").children("div").children("input").iCheck('uncheck');
				$("div.box-table").next("div.tab-i").children("div.il").find("span.sum").text(0);
				$("#pwd_setting_total").text(0);
				$("#pwd_setting_pages").text(1);
				document.frm_pwd_setting.c.value=1;
				fenye_r=1;
				document.getElementById("pwd_setting_page").value=1;
				return false;
			}
		}
	});
	
}
//分页 and 刷新
function pwd_setting_page(num){
	var paging=parseInt(document.frm_pwd_setting.c.value)+num;
	if(paging==0 || paging==fenye_r+1){
		return false;
	}
	if (num == 0.1){
		paging = 1;
	}else if(num == 0.9){
		paging=fenye_r;
	}
	document.getElementById("pwd_setting_page").value=paging;
	document.frm_pwd_setting.c.value=paging;
	show_pwd_setting_list();
}
//分页 and 刷新
function pwd_setting_user_page(num){
	var paging=parseInt($("#curpage").val())+num;
	if(paging<=0){
		paging = 1;
	}else if(paging>parseInt($("#totalpage").text())){
		paging = parseInt($("#totalpage").text());
	}
	if (num == 0.1){
		paging = 1;
	}else if(num == 0.9){
		paging=parseInt($("#totalpage").text());
	}
	$("#curpage").val(paging);
	show_pwd_setting_user_list();
}
function back() {
	document.frm_pwd_setting.tasktype.value = 4;
	document.frm_pwd_setting.action = '/bhost/index';
	document.frm_pwd_setting.submit();
}
function pwd_setting() {
	document.frm_pwd_setting.action = '/bhost/pwd_setting';
	document.frm_pwd_setting.tasktype.value = 1;
	document.frm_pwd_setting.submit();
}
function hostpwd_showing() {
	document.frm_pwd_setting.action = '/bhost/hostpwd_showing';
	document.frm_pwd_setting.submit();
}
function hostsend_showing() {
	document.frm_pwd_setting.action = '/bhost/hostsend_showing';
	document.frm_pwd_setting.submit();
}	 

</script>
</body>
</html>
