<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>manager</title>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<link rel="stylesheet" href="/manage/css/style.css">
	<link rel="stylesheet" href="/manage/css/jquery.datepick.css">
	<link rel="stylesheet" href="/manage/css/ui-dialog.css" type="text/css" />
	<link rel="stylesheet" href="/manage/css/G-style.css" type="text/css" />
	<link rel="stylesheet" href="/manage/css/jquery.datepick.css">
	<link rel="stylesheet" href="/manage/css/new-head.css">
	<link rel="stylesheet" href="/manage/css/jedate.css">

	<script src="/manage/js/jquery.min.js"></script>
	<script src="/manage/js/jquery.easing.js"></script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/layer.js"></script>
	<script src="/manage/js/select2.full.min.js"></script>
	<script src="/manage/js/xSelect.js"></script>
	<script src="/manage/js/jquery.plugin.js"></script>
	<script src="/manage/js/icheck.min.js"></script>
	<script src="/manage/js/common_e.js"></script>
	<script type="text/javascript" src="/manage/js/dialog-plus.js"></script>
	<script src="/manage/js/jquery.jedate.min.js"></script>
	<script src="/manage/js/my_scrollbar.js"></script>
	<style>
		.c-form-host span.ss {
			float: left;
			width: 171px;
			line-height: 28px;
			position: relative;
		}
		.h-name-son{
			display: inline-block;
		}
		.filter .selector.selector-multiple::after {
			margin: 10px 0px 0px 9.3em;
		}

		.ani_dot {
			font-family: simsun;
		}

		:root .ani_dot {
			display: inline-block;
			width: 1.5em;
			vertical-align: bottom;
			overflow: hidden;
		}
		a.btn-normal1:hover {
			background-color: #8d808a !important;
			color: #fff !important;
		}
		@-webkit-keyframes dot {
			0% {
				width: 0;
				margin-right: 1.5em;
			}
			33% {
				width: .5em;
				margin-right: 1em;
			}
			66% {
				width: 1em;
				margin-right: .5em;
			}
			100% {
				width: 1.5em;
				margin-right: 0;
			}
		}
		.hosttree span.h-name2 {
			margin-top: -6px;
		}
		.ani_dot {
			-webkit-animation: dot 3s infinite step-start;
		}

		.h-content2 span.checkbox:not(.disabled) {
			cursor: pointer;
		}

		.h-content2 span.disabled {
			cursor: default;
		}

		@keyframes dot {
			0% {
				width: 0;
				margin-right: 1.5em;
			}
			33% {
				width: .5em;
				margin-right: 1em;
			}
			66% {
				width: 1em;
				margin-right: .5em;
			}
			100% {
				width: 1.5em;
				margin-right: 0;
			}
		}

		.ani_dot {
			animation: dot 3s infinite step-start;
		}

		.hosttree span.h-name1 {
			width: 16em;
		}

		.filter-user .selector.selector-multiple:after {
			margin: 11px 0 0 129px;
		}

		.h-content2 .form-item {
			height: auto;
			padding: 20px 0 10px;
			min-height: 38px;
			padding: 5px;
			width: 100%;
		}

		.h-content2 .form-tag {
			float: left;
			width: 10em;
			text-align: right;
			color: #000;
			line-height: 28px;
		}

		.h-content2 .form-c {
			padding-left: 0px;
			position: relative;
		}

		.h-content2 .form-text {
			width: 200px;
			padding-right: 8px;
		}

		.select2-results__option.select2-results__option--highlighted {
			background-color: #5897fb;
			color: white;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		.btns {
			background-color: rgba(255, 255, 255, 1);
		}

		.h-content22 .form-item-100 .btn {
			display: inline-block;
			width: 90px;
			height: 32px;
			border: 1px solid #DDD;
			text-align: center;
			line-height: 32px;
			border-radius: 18px;
			margin: 0 10px;
			background-color: #fff;
			transition: background-color 0.4s;
			color: #7c7c7c;
		}

		.select2-container--open {
			z-index: 9999999;
		}

		.g-tsel:after {
			border-width: 4px;
			right: 7px;
			top: 9px;
		}

		.g-tsel1:after {
			right: 11px;
		}

		#g-tsel_server:after {
			right: 10px;
		}
		.select2-results__option{
			font-size: 14px;
		}
	</style>
</head>
<script>
	var perm={{perm}};
	if (perm==0){
		parent.$('#nav-s1 a.active').click();
	}
</script>
<body style="overflow:hidden;" class="bg-white">
	<!---->
	<div class="rwrap">
		<!---->
		<div class="mainer">
			<div class="container">
				<div class="c-top">
					<div class="c-title c-title-pc">
						<div class="manual-head" style="width: 136px;float:left;">
							<div class="manual-title" id="" style="">
								<span onclick="pwd_trust();" style="">自动改密</span>
								<i class="pwd_auth_icon" style=""></i>
							</div>
						</div>
						<div class="secnav">
							<ul>
								<li id="li1" class="active" onclick="prev();">改密对象配置</li>
								<li id="li2" onclick="next();">改密策略配置</li>
							</ul>
						</div>

					</div>
				</div>
				<div class="c-cont">
				<div class="c-wrap" style="padding: 10px 0 0" id="one" name="one">
					<div class="c-exp">
						<div class="h-explorer">
							<div class="h-top">
								<div class="h-tit" style="width: 100%;">
									<div class="form-item form-nm" style="width: 520px;">
										<div class="form-tag">
											<em class="imp">*</em>名称：</div>
										<div class="form-c">
											<input type="text" maxlength="128" class="form-text" placeholder="输入名称" id="PwdModPlanName" name="PwdModPlanName" onblur="regCheck(this,nameReg);">
											<i class="v-check" style="margin: 11px 0px 0px -27px;"></i>
											<span style="font-size: 12px;">特殊字符仅支持下划线、横杠、小数点</span>
										</div>
									</div>
									<div style="float: right;width: 100%;margin-top: -34px;">
										<div class="form-item form-nm" style="float: right;width: 170px;">
											<div class="form-tag">发送预备改密文件：</div>
											<div class="form-c">
												<label class="form-label" style="">
													<input id="IsSendPrePwdFile" name="IsSendPrePwdFile" class="form-checkbox" type="checkbox" name="" checked="checked">
												</label>
											</div>
										</div>
									</div>
								</div>
							</div>

							<div class="h-content22" style="padding-top: 0px;">
								<div class="h-top">

									<div class="h-tit">
										<div class="form-item form-nm">
											<div style="margin-top:-1px">
												<select name="" id="typeSet" class="filter-select" style="width: 120px;    margin-top: -2px;" onchange="_typeSet(this)">
													<option value="1" selected>对象指定</option>
													<option value="2">范围指定</option>
												</select>
											</div>
										</div>
									</div>
								</div>
								<div id="pointSet1" style="display:none;">
									<div class="h-content3 sel-type1" id="server_frame" style="border-bottom: 1px solid #CCC;color: #9a9a9a;overflow-x: hidden;width:97%;">
										<div class="form-tag" style="width:105px;line-height: 43px;padding:0px;">
											<em class="imp">*</em>服务器集合：</div>
										<div class="form-c c-form-host" style="min-width: 1173px;margin-left: 85px;" id="server_frame_list">
											<div class="item" style="margin-top: -10px;width:230px;margin-left: -14px;">
												<div class="" id="server_text_zdp" style="float:left;width: 162px;margin-left: 14px;"></div>
												<i class="ctrl add" style="margin-left: 5px;margin-top: 6px;" onclick="addserver(this)"></i>
											</div>
										</div>
									</div>
									<div class="dialog-cont" id="server_suspend" style="display:none;max-height:500px">
										<div class="container" style="margin-top: -10px;">
											<div class="c-cont2" style="padding: 0px;">
												<div class="c-wrap" style="padding: 0px 0 0">
													<div class="c-exp" style="padding: 0px;">

														<div class="h-explorer1" style="border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-image: initial;margin: 0px auto;">
															<div class="h-top">
																<div class="form-item" style="padding: 0 0 0 21px;float:left;width:auto;margin:3px;">
																	<span class="form-tag" style="float:left;width:auto;">
																		<em class="imp">*</em>名称：</span>
																	<div class="form-c" style="float:left;padding-left:0px;">
																		<input type="text" class="form-text" id="d_n" name="d_n" style="width:160px;" maxlength="128" onblur="regCheck(this,nameReg);">
																		<i class="v-check" style="    margin: 7px 0 0 -26px;"></i>
																		<span>特殊字符仅支持下划线、横杠、小数点</span>
																	</div>
																</div>
															</div>

															<div class="h-catelog h-catelog2 h-catelog2_tmp" style="width:353px;max-height:400px;background: none;overflow-x: hidden; padding: 0;">
																<div class="h-top" style="background-color: white;">
																	<span class="form-tag" style="float:left;width:auto;padding: 4px 0px 0px 15px;">IP限制：</span>
																	<input type="checkbox" class="form-checkbox" name="" id="part1" value="" style="margin-top: 9px; float: right;position: relative;" checked="checked" >
																	<h2 style="font-size: 13px;padding: 8px 6px 0px 0px;font-weight: 100;float: right;">启用</h2>
																</div>
																<h2 style="font-size: 14px;padding: 19px 0 0 14px;font-weight: 400;">地址：</h2>
																<div id="ip_n1" name="ip_n1" class="form-c c-form-host" style="padding-left:22px;width:343px;min-width:300px;float: left;"
																	value="0">
																	<span class="ss ss-add" id="ip_span1" value="0" style="position:static;padding-bottom: 10px;width:170px">
																		<input type="text" class="form-text" style="width:105px;">
																		<i class="ctr ctr-add" onclick="_addIp1(this)" style="margin-left: 5px;"></i>
																	</span>
																</div>
																<h2 style="font-size: 14px;padding:0px 0 0 14px;float:left;font-weight: 400;">IP区间：</h2>
																<div id="ip_n" name="ip_n" class="form-c c-form-host" style="padding-left:22px;width:335px;min-width:300px;float: left;"
																	value="0">
																	<span class="ss ss-add" id="ip_span" value="0" style="position:static;padding-bottom: 10px;">
																		<input type="text" class="form-text" placeholder="起始IP地址" style="width:105px;">
																		<span style="vertical-align:middle;">-</span>
																		<input type="text" class="form-text" placeholder="结束IP地址" style="width:105px;">
																		<i class="ctr ctr-add" onclick="_addIp2(this);" style="margin-left: 5px;"></i>
																	</span>
																</div>
															</div>

															<div class="h-content2 h-catelog2_tmp" style="max-height:400px;overflow:hidden">
																<div class="h-top" style="background-color: #fff;margin-top: -20px;">
																	<div class="filter filter_server" style="float:right;min-width:auto;">
																		<div id="waitTip" class="waitTipserver" style="float: right;margin-top: 7px;margin-left: -20px;"></div>
																		<div class="search">
																			<select name="server_select" id="server_select_z" class="filter-select">
																				<option value="all" selected>所有</option>
																				<option value="hgname">组名</option>
																				<option value="hostname">主机名</option>
																				<option value="ip">IP</option>
																			</select>

																			<input type="text" class="filter-text server_text" placeholder="输入关键字" 
																			name="server_text_z" id="server_text_z" maxlength="128"
																			style="/*display:none;*/padding-right: 22px;" 
																			onchange="if($('#server_text_z').val()==''){$('#server_text_z_check').hide();}else{$('#server_text_z_check').show();}"
																			onblur="if($('#server_text_z').val()=='' && search_typeall_new_z!=''){search_typeall_new_z='';find_hostgroup_z();}"
																			onkeyup="if($('#server_text_z').val()==''){$('#server_text_z_check').hide();}else{$('#server_text_z_check').show();}"
																			onkeydown="if($('#server_text_z').val()==''){$('#server_text_z_check').hide();}else{$('#server_text_z_check').show();};if (event.keyCode == 13){_addFilter1(this,false);return false;} else return;">
																			<i class="v-check v-wrong" id="server_text_z_check" 
																			onclick="_clearFilter1(this,1)" 
																			style="display:none;cursor: pointer;float: left;position: static;"></i>
																			<button class="btn filter-btn" onclick="_addFilter1(this,false)">
																				<i class="add-filter"></i>
																			</button>
																			<button class="btn filter-btn" onclick="_addFilter1(this,true)">
																				<i class="append-filter"></i>
																			</button>
																		</div>
																		<div class="search" id="clearFilter1" style="margin: 0px 15px 0px -16px;display:none;">
																			<button class="filter-btn" onclick="_clearFilter1(this)">
																				<i class="clear-filter"></i>
																			</button>
																		</div>
																		<div class="selector selector-multiple" id="filterWW_z" style="display: none;width: 146px;">
																			<span class="ww" style="width:9.5em">搜索条件</span>
																			<ul style="padding-left: 0px;    width: 146px;"></ul>
																		</div>
																	</div>
																</div>

																<div style="overflow: auto;width:100%;height:93%;margin-top: 2px;max-height:362px;" id="hosttree_div">
																	<h2 style="font-size: 14px;">
																		<em class="imp">*</em>主机：</h2>
																	<ul id="userTree1" class="hosttree" style="padding: 0 0 0 0;    float: left;"></ul>
																</div>
															</div>
														</div>
													</div>

													<div class="clearfix"></div>
													<div class="btns" style="margin-bottom: -20px;margin-left:-20px;width:1040px;">
														<a href="javascript:;" class="btn btn-submit btn-normal perm_server_disabled">保&nbsp;&nbsp;存</a>
														<a href="javascript:;" class="btn btn-cancel btn-normal">重&nbsp;&nbsp;置</a>
													</div>
												</div>
											</div>
										</div>
									</div>
									<div class="h-top">

										<div class="h-tit">
											<div class="form-item form-nm" style="width:200px;">
												<div style="margin-top:-1px">
													<select name="" id="define_select" class="filter-select" style="width: 80px;margin-top:-2px" onchange="define_change(this);">
														<option value="1">已定义</option>
														<option value="2">自定义</option>
													</select>
												</div>
												<div id="mix_module" style="margin-top: -34px;margin-left: 85px;">
													<select name="" id="mix_select" class="filter-select" style="width: 80px;display:none;" onchange="mix_change(this);">
														<option value="1">所有</option>
														<option value="2">共有</option>
													</select>
												</div>
											</div>
										</div>
									</div>
									<div id="custom_info" style="display:none">
										<div class="h-catelog h-catelog2 h-content2_temp" style="height: 444px; width: 28.3%;background-color: #ffffff; padding: 0px;overflow-x: hidden;">
											<div class="c-col2 ss" style="width:313px">

												<div>
													<span class="form-tag" style="float: none;">
														<em class="imp">*</em>账号：</span>
												</div>

												<div class="ss-cont h-content3" id="account_module" style="padding: 0;min-width:341px">
													<li class="item">
														<select class="filter-select" name="" id="account_select" style="width:120px" onchange="change_account(this);">
														</select>
														<i class="ctrl add" onclick="_addaccount(this)"></i>
													</li>
												</div>
											</div>
										</div>
										<div class="h-catelog h-catelog2 h-content2_temp" style="height: 444px; width: 71.6%;background-color: #ffffff;padding: 0px;border-right:0px;">
											<div class="c-col2 ss">


												<div>
													<span class="form-tag" style="float: none;">
														<em class="imp">*</em>服务：</span>
												</div>
												<div class="h-content22" style="height: auto;width: 100%;overflow: hidden;padding: 0px;">
													<div class="c-table">


														<table cellpadding="0" cellspacing="0" style="margin-bottom:20px;">
															<thead>
																<tr>
																	<th>协议</th>
																	<th>端口</th>
																	<th>连接参数</th>
																	<th width="55"></th>
																</tr>
															</thead>

															<tbody id="service_list1" style="height:auto">

															</tbody>
														</table>
														<div class="form">
															<div class="form-item form-item-100" style="width:100%">
																<div style="text-align: right;">
																	<a href="javascript:;" id="" class="btn btn-normal1" onclick="_getDialog1('add','');">添&nbsp;&nbsp;加</a>
																</div>
															</div>
														</div>
													</div>
												</div>


												
											</div>
										</div>
									</div>
									<div id="defined_info" style="">
										<div class="h-catelog h-catelog2 h-content2_temp h-content2-d" style="height: 375px; width:30%;background-color: #ffffff; padding: 0px;border-right: 1px solid #CCC;max-height:400px;">
											<div class="c-col2 ss">

												<div>
													<span class="form-tag" style="float: none;">
														<em class="imp">*</em>账号：
													</span>
													<select name="" id="a_mix_select" class="filter-select" style="width: 80px;display:none;margin-left: 16px;" onchange="a_mix_change(this);">
														<option value="1">指定</option>
														<option value="2">所有</option>
													</select>
												</div>

												<div class="ss-cont" id="account" style="padding: 0;">
													<div class="h-content222" style="height: auto;width: 100%;overflow: hidden;padding: 0px;">
														<div class="c-table tab-type2" style="padding: 0;margin-top: 10px;">
															<table cellpadding="0" cellspacing="0" style="">
																<thead>
																	<tr>
																		<th width="50">
																			<input type="checkbox" class="form-checkbox" id="check_all_a" />
																		</th>
																		<th>账号</th>

																	</tr>
																</thead>
															</table>
														</div>
														<div class="c-table tab-type2" style="padding: 0px; overflow: auto; max-height: 300px;">
															<table cellpadding="0" cellspacing="0" style="">
																<tbody id="service_list_a" style="height:auto">
																</tbody>
															</table>
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="h-catelog h-catelog2 h-content2_temp h-content2-d" style="height: 375px; width:69.9%;background-color: #ffffff;padding: 0px; border-right: 0px;max-height:400px;">
											<div class="c-col2 ss">
												<div>
													<span class="form-tag" style="float: none;">
														<em class="imp">*</em>服务：
													</span>
													<select name="" id="s_mix_select" class="filter-select" style="width: 80px;display:none;margin-left: 16px;" onchange="s_mix_change(this);">
														<option value="1">指定</option>
														<option value="2">所有</option>
													</select>
												</div>
												<div class="h-content222" style="height: auto;width: 100%;overflow: hidden;padding: 0px;" id="service_module">
													<div class="c-table tab-type2" style="padding: 0;margin-top: 10px;">
														<table cellpadding="0" cellspacing="0" style="">
															<thead>
																<tr>
																	<th width="50">
																		<input type="checkbox" class="form-checkbox" id="check_all" />
																	</th>
																	<th>协议</th>
																	<th>端口</th>
																	<th>连接参数</th>

																</tr>
															</thead>

															
														</table>
													</div>
													<div class="c-table tab-type2" style="padding: 0px; overflow: auto; max-height: 300px;">
														<table cellpadding="0" cellspacing="0" style="">
															<tbody id="service_list2" style="height:auto">
															</tbody>
														</table>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div id="pointSet2">
									<div class="h-content2 p-h-2" style="overflow:hidden;width:100%;padding-top: 0px;">
										<div class="h-top" style="background-color: #fff;    border-bottom: none;">
											<div class="filter" style="float:right;min-width:auto;">
												<div id="waitTip" class="waitTiphost" style="float: right;margin-top: 7px;margin-left: -20px;"></div>
												<div class="search">
													<select name="server_select_hg1" id="server_select_hg1" class="filter-select">
														<option value="all" selected>所有</option>
														<option value="hgname">组名</option>
														<option value="hostname">主机名</option>
														<option value="ip">IP</option>
														<!-- <option value="hostservicename">服务名</option> -->
														<option value="accountname">账号</option>
													</select>
													<input type="text" style="/*display: none;*/border-left:none;padding-right: 22px;" 
													class="filter-text" placeholder="输入关键字" 
													name="server_text" id="server_text" maxlength="128" 
													onchange="if($('#server_text').val()==''){$('#server_text_check').hide();}else{$('#server_text_check').show();}"
													onblur="if($('#server_text').val()=='' && search_typeall_new!=''){search_typeall_new='';find_hostgroup();}"
													onkeyup="if($('#server_text').val()==''){$('#server_text_check').hide();}else{$('#server_text_check').show();}"
													onkeydown="if($('#server_text').val()==''){$('#server_text_check').hide();}else{$('#server_text_check').show();}; if (event.keyCode == 13){_addFilter(this,false);return false;} else return; ">
													<i class="v-check v-wrong" id="server_text_check" 
													onclick="_clearFilter(this,1)" 
													style="display:none;cursor: pointer;float: left;position: static;"></i>
													<button class="btn filter-btn" onclick="_addFilter(this,false);">
														<i class="add-filter"></i>
													</button>
													<button class="btn filter-btn" onclick="_addFilter(this,true)">
														<i class="append-filter"></i>
													</button>
												</div>
												<div class="search" id="clearFilter" style="margin: 0px 15px 0px -16px;display:none;">
													<button class="filter-btn" onclick="_clearFilter(this)">
														<i class="clear-filter"></i>
													</button>
												</div>

												<div class="selector selector-multiple" id="filterWW" style="display: none;width: 146px;">
													<span class="ww" style="width: 132px;">搜索条件</span>
													<ul style="padding-left: 0px;width: 146px;"></ul>
												</div>
											</div>
										</div>
										<div style="overflow: auto;width:100%;height:90%;" id="hosttree_div_c">
											<h2 style="padding: 0 0 0 20px;">
												<em class="imp" style="color: red;font-style: normal;">*</em>主机：</h2>
											<ul id="userTree" class="hosttree" style="padding-left: 68px;"></ul>
										</div>
									</div>
								</div>
							</div>

						</div>
					</div>

					<div class="clearfix"></div>
					<div class="btns">
						<a href="javascript:;" class="btn btn-normal" onclick="next();">下一步</a>
					</div>
				</div>
				<div class="c-wrap" style="padding: 10px 0;display:none;font-size: 14px;" id="two" name="two">
					<div class="c-exp" style="margin: -1px auto;">

						<div class="h-explorer" style="height:auto;">
							<div class="G-top">
								<div class="G-box1"></div>
								<strong>&nbsp;基本策略</strong>
							</div>

							<div class="h-content2 h-content2-tmp" style="height:auto;width: 100%;overflow: hidden;padding: 14px 0 0;">
								<div class="form-item">
									<span class="form-tag">
										策略名称：</span>
									<div class="form-c">
										<div class="xSelect PwdModStrategy" id="PwdModStrategy" style="float: left;"></div>
										<input type="text" class="form-text forName" maxlength="128" id="PwdModStrategyName" name="PwdModStrategyName" style="display: none;margin-left: 10px;float: left;">
									</div>
								</div>

								<div class="form-item">
									<span class="form-tag">
										<em class="imp">*</em>开始时间：</span>
									<div class="form-c form-c1">
										<div class="srSort" id="srTemp-xtime" style="">
												<span class="stwrap">
												<input type="text" id="StartDay" value="" placeholder="日期" class="datepicker" readonly>
												<input type="text" id="Starth" placeholder="时" class="timeinput" min="00" max="23" value="00">
												<span class="srTip">:</span>
												<input type="text" id="Startm" placeholder="分" class="timeinput" min="00" max="59" value="00">
												<span class="srTip">:</span>
												<input type="text" id="Starts" placeholder="秒" class="timeinput" min="00" max="59" value="00">
											</span>
										</div>
									</div>


								</div>
								<div class="form-item">
									<span class="form-tag">
										<em class="imp">*</em>重复周期：</span>
									<div class="form-c">
										<div class="input-group g-sel">
											<input type="text" class="form-text g-item" value="30" style="width: 38px;text-align: center;" id="PeriodValue" name="PeriodValue"
												maxlength="4">
											<select name="PeriodType" id="PeriodType" class="select2 g-item" style="width: 64px">
												<option value="1" selected>天</option>
												<option value="2">分钟</option>

											</select>
										</div>
									</div>
								</div>
								<div class="form-item">
									<span class="form-tag">密码策略：</span>
									<div class="form-c g-radios" id="PasswordType" name="PasswordType" style="line-height: 26px;">
										<label class="form-label">
											<input class="form-radio" type="radio" name="a" value="1" id="a1" checked="checked">随机生成不同密码</label>
										<label class="form-label">
											<input class="form-radio" type="radio" name="a" value="2" id="a2">随机生成相同密码</label>
										<label class="form-label" style="line-height: 28px;">
											<input class="form-radio" type="radio" name="a" value="3" id="a3">人工指定相同密码
											<input type="password" class="form-text" maxlength="128" value="" style="display: none;margin-top: -3px;" id="Password" name="Password">
										</label>
									</div>
								</div>
							</div>
						</div>
						<div class="h-explorer" style="height:auto;margin: -1px auto;">
							<div class="G-top">
								<div class="G-box1"></div>
								<strong>&nbsp;发送方式</strong>
							</div>
							<div class="h-content2 h-content2-tmp" style="height: auto;width: 100%;overflow: hidden;padding: 0px;">
								<div class="form-item">
									<span class="form-tag">发送方式：</span>
									<div class="form-c">
										<select name="ResultSendMethod" id="ResultSendMethod" class="select2" style="width: 168px;" onchange="_switchShow(this)">
											<option value="3" selected>默认</option>
											<option value="1">邮件</option>
											<option value="2">FTP</option>
										</select>
									</div>
								</div>
								<div class="form-item" style="display:none;">
									<span class="form-tag">默认：</span>
										<div class="form-c">
											<div class="xSelect xSelect_stmp1"></div>  
										</div>
								</div>
								<div class="form-item" style="display:none;">
									<span class="form-tag">备用：</span>
									<div class="form-c">
										<div class="xSelect xSelect_stmp2" style="float:left;"></div>  
										
									</div>
								</div>
								<div class="form-item" style="display:none;">
									<span class="form-tag">默认：</span>
									<div class="form-c">
										<div class="xSelect xSelect_ftp1"></div>
									</div>
								</div>
								<div class="form-item" style="display:none;">
									<span class="form-tag">备用：</span>
									<div class="form-c">
										<div class="xSelect xSelect_ftp2" style="float: left;"></div>
										
									</div>
								</div>
								<div class="form-item" style="display:none;">
									<span class="form-tag"><em class="imp">*</em>接收者：</span>
									<div class="h-content3" id="select_r" style="margin-top: -19px; width:80%;padding: 10px 20px 0px 19px;">
										<div class="item" style="width: 225px;float: left;margin-left: -19px;">
											<select class="form-select" id="ReceiverSet" name="ReceiverSet" style="width: 168px">
												<option value="0" selected>请选择</option>
											</select>
											<i class="ctrl add" onclick="_addReceiver(this);"></i>
										</div>
									</div>
								</div>
								<div class="form-item" style="display:none;">
									<span class="form-tag"><em class="imp">*</em>接收者：</span>
									<div class="h-content3" id="select_r2" style="margin-top: -19px; width:80%;padding: 10px 20px 0px 19px;">
										<div class="item" style="width: 225px;float: left;margin-left: -19px;">
											<select class="form-select" id="ReceiverSet2" name="ReceiverSet2" style="width: 168px">
												<option value="0" selected>请选择</option>
											</select>
											<i class="ctrl add" onclick="_addReceiver(this);"></i>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="clearfix"></div>
					<div class="btns">
						<a href="javascript:;" class="btn btn-normal" onclick="prev();">上一步</a>
						<a id='_finish_' href="javascript:;" class="btn btn-normal" onclick="_finish();">保&nbsp;&nbsp;存</a>
					</div>
					<script>
						if(perm==1){
							$('#_finish_').remove();
						}
					</script>
				</div>
				</div>
			</div>

		</div>

	</div>

	<form action="/bhost/index" method="POST" name="frm_pwdauth_add" id="frm_pwdauth_add">
		<input type="hidden" name="tasktype" id="tasktype" value="{{ tasktype }}" />
		<!--创建 编辑 列表-->
		<input type="hidden" name="a" id="a" value="{{ a }}" />
		<!--serverId-->
		<input type="hidden" name="c" id="c" value="{{c}}" />
		<!--页码-->
		<input type="hidden" name="d" id="d" value="{{d}}" />
		<!--search_typeall-->
		<input type="hidden" name="us" id="us" value="{{us}}" />
		<input type="hidden" name="se" id="se" value="{{se}}" />
		<input type="hidden" name="e" id="e" value="{{e}}" />
	</form>
	<!--浮层-->
	<!--邮件  -->
	<div class="dialog-cont" id="smtp_suspend" style="display:none;max-height:500px">
		<div class="container" style="margin-top: -10px;">
			<div class="c-cont" style="padding: 0px; height: 281px;overflow: hidden;">
				<div class="c-form " style="overflow: auto;height: 70%;">
					<div class="form">
						<div class="form-item" style="padding: 10px 0;" id="SmtpConfig_Master" name="SmtpConfig_Master">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>配置名称：</span>
							<div class="form-c">
								<input style="width: 224px;" type="text" class="form-text" id="SmtpConfigName_Master" name="SmtpConfigName_Master" onblur="regCheck(this,nameReg);">
								<i class="v-check" style=""></i>
								<p class="form-tip" style="padding-left: 84px;">特殊字符仅支持下划线、横杠、小数点</p>
							</div>
						</div>

						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>服务器地址：</span>
							<div class="form-c">
								<input style="padding-right: 8px;" type="text" class="form-text" id="SmtpServer_Master" name="SmtpServer_Master">
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>发送邮箱地址：</span>
							<div class="form-c">
								<input style="padding-right: 8px;" 
								onblur="if($('#Sender_Master').val()==''){$('#Sender_Master').val($('#SenderEmail_Master').val());}" 
								type="text" class="form-text" id="SenderEmail_Master" name="SenderEmail_Master">
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								服务器账号：</span>
							<div class="form-c">
								<input style="padding-right: 8px;" 
								onblur="if($('#Sender_Master').val()==''){$('#Sender_Master').val($('#SenderEmail_Master').val());}" 
								type="text" class="form-text" id="Sender_Master" name="Sender_Master">
							</div>
						</div>

						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">服务器验证：</span>
							<div class="form-c g-radios" id="ServerVerify_Master" name="ServerVerify_Master">
								<label class="form-label" style="line-height: 30px;">
									<input class="form-radio" type="radio" name="b" value="1" id="b1" checked="checked">否</label>
								<label class="form-label" style="line-height: 30px;">
									<input class="form-radio" type="radio" name="b" value="2" id="b2">是
									<input type="password" class="form-text" maxlength="128" value="" style="display: none;width: 80px;margin-top: -1px;" id="SenderEmailPass_Master" name="SenderEmailPass_Master">
								</label>
							</div>
						</div>

						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;">
								<em class="imp">*</em>附件大小：</span>
							<div class="form-c">
								<input type="text" maxlength="5" class="form-text" style="width: 82px;padding-right: 8px;" id="AttachMaxLimit_Master" name="AttachMaxLimit_Master"> M (应用于报表邮件抄送)
							</div>
						</div>

						
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;"><em class="imp">*</em>编码方式：</span>
							<div class="form-c">
								<select name="EnCode" id="EnCode" class="select2" style="width: 100px;" onchange="">
									<option value="0">UTF-8</option>
									<option value="1">GBK</option>
								</select>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;"><em class="imp">*</em>方式：</span>
							<div class="form-c">
								<select name="Flag" id="Flag" class="select2" style="width: 100px" onchange="">
									<option value="2">默认</option>
									<option value="1">备用</option>
									<option value="0">其他</option>
								</select>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="clearfix"></div>
		<div class="btns" style="margin-bottom: -20px;margin-left:-20px;width:840px;">
			<a href="javascript:;" class="btn btn-normal btn-submit perm_1_disabled">保&nbsp;&nbsp;存</a>
			<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
		</div>
	</div>
	<!--ftp  -->
	<div class="dialog-cont" id="ftp_suspend" style="display:none;max-height:500px">
		<div class="container" style="margin-top: -10px;">
			<div class="c-cont" style="padding: 0px; height: 281px;overflow: hidden;">
				<div class="c-form " style="overflow: auto;height: 70%;">
					<div class="form">
						<div class="form-item" style="padding: 10px 0;" id="FTPServer_Master" name="FTPServer_Master">
							<span class="form-tag" style="width:285px;">
								<em class="imp">*</em>配置名称：</span>
							<div class="form-c">
								<input type="text" style="width: 224px;" class="form-text" id="FTPServerName_Master" name="FTPServerName_Master" onblur="regCheck(this,nameReg);">
								<i class="v-check" style=""></i>
								<p class="form-tip" style="padding-left: 84px;">特殊字符仅支持下划线、横杠、小数点</p>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width:285px;">
								<em class="imp">*</em>服务器地址：</span>
							<div class="form-c">
								<input style="padding-right: 8px;" type="text" class="form-text" id="ServerIP_Master" name="ServerIP_Master">
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width:285px;">
								<em class="imp">*</em>用户名：</span>
							<div class="form-c">
								<input style="padding-right: 8px;" type="text" class="form-text" id="ServerUser_Master" name="ServerUser_Master">
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width:285px;">
								<em class="imp">*</em>用户密码：</span>
							<div class="form-c">
								<input style="padding-right: 8px;" maxlength="128" type="password" class="form-text" id="ServerPasswd_Master" name="ServerPasswd_Master">
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width:285px;">
								<em class="imp">*</em>上传路径：</span>
							<div class="form-c">
								<input style="padding-right: 8px;" type="text" class="form-text" id="ServerPath_Master" name="ServerPath_Master">
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;"><em class="imp">*</em>方式：</span>
							<div class="form-c">
								<select name="ftpFlag" id="ftpFlag" class="select2" style="width: 100px" onchange="">
									<option value="2">默认</option>
									<option value="1">备用</option>
									<option value="0">其他</option>
								</select>
							</div>
						</div>
						<div class="form-item" style="padding: 10px 0;">
							<span class="form-tag" style="width: 285px;"><em class="imp">*</em>模式：</span>
							<div class="form-c">
								<select name="IfPasv" id="IfPasv" class="form-select" style="width: 100px" onchange="">
									<option value="1">被动</option>
									<option value="2">主动</option>
								</select>
							</div>
						</div>  
					</div>
				</div>
			</div>
		</div>
		<div class="clearfix"></div>
		<div class="btns" style="margin-bottom: -20px;margin-left:-20px;width:840px;">
			<a href="javascript:;" class="btn btn-normal btn-submit perm_1_disabled">保&nbsp;&nbsp;存</a>
			<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
		</div>
	</div>
	<!-- 协议 -->
	<div class="dialog-cont" id="protoDialog" style="display:none;">
		<div class="container">
			<div class="c-cont" style="min-height:200px;max-height:200px;overflow:auto;">
				<div class="c-form c-form-host" style="padding: 0 0 90px;min-width:0px;">
					<div class="clearfix"></div>
					<div class="c-table">
						<div class="form">
							<div class="form-item" style="width: 300px;">
								<span class="form-tag" style="width: 72px;"><em class="imp">*</em>名称：</span>
								<div class="form-c" style="padding-left: 0;">
									<input type="text" class="form-text" id="Protocol_Name0" maxlength="15" style="width: 195px;" tabindex="1">
									<i class="v-check" style=""></i>
									<p class="form-tip" style="width: 185px;margin-left: 66px;">特殊字符仅支持下划线、横杠</p>
								</div>
							</div>
							<div class="form-item" style="width: 185px;">
								<span class="form-tag" style="width:85px;"><em class="imp">*</em>端口：</span>
								<div class="form-c" style="padding-left: 0px;">
									<input type="text" class="form-text" id="Port0" maxlength="5" style="width: 50px;" tabindex="1">
									<i class="v-check" style=""></i>
									<p class="form-tip" style="width: 78px;margin-left: 80px;">0-65535之间</p>
								</div>
							</div>
							<div class="form-item" style="width: 185px;">
								<span class="form-tag" style="width:85px;"><em class="imp">*</em>端口1：</span>
								<div class="form-c" style="padding-left: 0px;">
									<input type="text" class="form-text" id="Port1" maxlength="5" style="width: 50px;" tabindex="1">
									<i class="v-check" style=""></i>
									<p class="form-tip" style="width: 78px;margin-left: 80px;">0-65535之间</p>
								</div>
							</div>
							<div class="form-item" style="width: 250px;">
								<span class="form-tag" style="width:85px;">描述：</span>
								<div class="form-c" style="padding-left: 0px;">
									<input type="text" class="form-text" id="Description0" maxlength="128" style="width:170px;" tabindex="1">
								</div>
							</div>
						</div>
						<div class="btns" style="padding: 10px 0 10px;">
							<a href="javascript:;" class="btn btn-normal btn-submit perm_host_disabled" >保&nbsp;&nbsp;存</a>
							<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 连接参数 -->
	<div class="dialog-cont" id="connDialog" style="display:none;">
		<div class="container">
			<div class="c-cont" style="max-height:500px;">
				<div class="c-form" style="">
					<div class="form" style="padding-left:50px;">
						<div class="form-item">
							<span class="form-tag"><em class="imp">*</em>名称：</span>
							<div class="form-c">
								<input type="text" class="form-text" id="d_n_con" name="d_n_con" onblur="regCheck(this,cnameReg);" maxlength="128">
								<i class="v-check"></i>
								<p class="form-tip">特殊字符仅支持下划线、横杠、小数点</p>
							</div>
						</div>
						<div class="form-item">
							<span class="form-tag"><em class="imp">*</em>协议类型：</span>
							<div class="form-c">
								<select class="form-select form-select2" name="Protocol_con" id="Protocol_con" style="width:150px;">
									<option value="0" selected>请选择</option>
								</select>
							</div>
							<span class="form-tag" id="Protocol_port"></span>
						</div>
						<!-- SSH -->
						<div id="SSH" style="display:none;">
							<div class="form-item">
								<span class="form-tag">版本号：</span>
								<div class="form-c">
									<select class="form-select" name="ServiceName_ssh" id="ServiceName_ssh" style="width:150px;">
										<option value="1" selected>1</option>
										<option value="2" >2</option>
									</select>
								</div>
							</div>
						</div>
						<!-- SFTP -->
                                                <div id="SFTP" style="display:none;">
                                                        <div class="form-item">
                                                                <span class="form-tag">版本号：</span>
                                                                <div class="form-c">
                                                                        <select class="form-select" name="ServiceName_sftp" id="ServiceName_sftp" style="width:150px;">
                                                                                <option value="1" selected>1</option>
                                                                                <option value="2" >2</option>
                                                                        </select>
                                                                </div>
                                                        </div>
                                                </div>
						<!--HTTP-->
						<div id="HTTP" style="display:none;">
							<div class="form-item">
								<span class="form-tag"><em class="imp">*</em>URL：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="url" name="url" maxlength="128" style="width:252px;padding-right:8px;">
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">账号元素：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="UserName" name="UserName" maxlength="128" style="width:252px;padding-right:8px;">
									<p class="form-tip">不能含有特殊字符</p>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">密码元素：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="UserPwd" name="UserPwd" maxlength="128" style="width:252px;padding-right:8px;">
									<p class="form-tip">不能含有特殊字符</p>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">提交元素：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="Submit" name="Submit" maxlength="128" style="width:252px;padding-right:8px;">
								</div>
							</div>
						</div>
						<!--HTTPs-->
						<div id="HTTPs" style="display:none;">
							<div class="form-item">
								<span class="form-tag"><em class="imp">*</em>URL：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="httpsurl" name="httpsurl" maxlength="128" style="width:252px;padding-right:8px;">
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">账号元素：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="httpsUserName" name="httpsUserName" maxlength="128" style="width:252px;padding-right:8px;">
									<p class="form-tip">不能含有特殊字符</p>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">密码元素：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="httpsUserPwd" name="httpsUserPwd" maxlength="128" style="width:252px;padding-right:8px;">
									<p class="form-tip">不能含有特殊字符</p>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">提交元素：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="httpsSubmit" name="httpsSubmit" maxlength="128" style="width:252px;padding-right:8px;">
								</div>
							</div>
						</div>
						<!--RDP-->
						<div id="RDP" style="display:none;">
							<div class="form-item">
								<span class="form-tag">访问方式：</span>
								<div class="form-c">
									<select class="form-select" name="rdpType" id="rdpType" style="width:150px;">
										<option value="NORMAL" text="NORMAL">NORMAL</option>
										<option value="CONSOLE" text="CONSOLE">CONSOLE</option>
									</select>
								</div>
							</div>
						</div>
						<!--ORACLE-->
						<div id="ORACLE" style="display:none;">
							<div class="form-item">
								<span class="form-tag"><em class="imp">*</em>指定：</span>
								<div class="form-c">
									<select class="form-select" name="appoint" id="appoint" style="width:150px;">
									<option value="0" text="请选择" selected>请选择</option>
									<option value="SID" text="SID">SID</option>
									<option value="SERVICE_NAME" text="SERVICE_NAME">SERVICE_NAME</option>
								</select>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag"><em class="imp">*</em>实例名或服务名：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="s_n" name="s_n" maxlength="128" style="width:252px;padding-right:8px;">
									<p class="form-tip">不能含有特殊字符</p>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">连接方式：</span>
								<div class="form-c">
									<select class="form-select" name="conn" id="conn" style="width:150px;">
									<option value="0" text="未指定" selected>未指定</option>
									<option value="NORMAL" text="NORMAL">NORMAL</option>
									<option value="SYSDBA" text="SYSDBA">SYSDBA</option>
									<option value="SYSOPER" text="SYSOPER">SYSOPER</option>
								</select>
								</div>
							</div>
						</div>
						<!--RADMIN-->
						<div id="RADMIN" style="display:none;">
							<div class="form-item">
								<span class="form-tag">认证方式：</span>
								<div class="form-c">
									<select class="form-select" name="authtype" id="authtype" style="width:150px;">
									<option value="0" text="未指定" selected>未指定</option>
									<option value="RADMIN" text="RADMIN">RADMIN</option>
									<option value="Windows" text="Windows">Windows</option>
								</select>
								</div>
							</div>
						</div>
						<!--MSSQL-->
						<div id="MSSQL" style="display:none;">
							<div class="form-item">
								<span class="form-tag"><em class="imp">*</em>实例名：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="o_n" name="o_n" maxlength="128" style="width:252px;padding-right:8px;">
									<p class="form-tip">不能含有特殊字符</p>
								</div>
							</div>
							<div class="form-item">
								<span class="form-tag">认证方式：</span>
								<div class="form-c">
									<select class="form-select" name="R_authtype" id="R_authtype" style="width:150px;">
									<option value="0" text="未指定" selected>未指定</option>
									<option value="SQL服务器验证" text="SQL服务器验证" >SQL服务器验证</option>
									<option value="Windows验证" text="Windows验证" >Windows验证</option>
									<option value="Windows单一登录" text="Windows单一登录" >Windows单一登录</option>
								</select>
								</div>
							</div>
						</div>
						<!--MYSQL &&　DB2-->
						<div id="MY_DB2" style="display:none;">
							<div class="form-item" style="min-height:40px;">
								<span class="form-tag"><em class="imp">*</em>数据库名：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="sql_n" name="sql_n" maxlength="128" style="width:252px;padding-right:8px;">
									<p class="form-tip">不能含有特殊字符</p>
								</div>
							</div>
						</div>
						<!-- <div id="MY_ConnType" style="display:none;">
							<div class="form-item" style="min-height:40px;">
								<span class="form-tag"><em class="imp">*</em>版本号：</span>
								<div class="form-c">
									<select class="form-select" name="select_my" id="select_my" style="width:150px;">
										<option value="0" text="0" selected>&lt;7.5</option>
										<option value="1" text="1" >≥7.5</option>
									</select>
								</div>
							</div>
						</div> -->
						<div id="DB2" style="display:none;">
							<div class="form-item" style="min-height:40px;">
								<span class="form-tag"><em class="imp">*</em>数据库名：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="dbsql_n" name="dbsql_n" maxlength="128" style="width:252px;padding-right:8px;">
									<p class="form-tip">不能含有特殊字符</p>
								</div>
							</div>
						</div>
						<!--SYBASE-->
						<div id="SYBASE" style="display:none;">
							<div class="form-item" style="min-height:40px;">
								<span class="form-tag"><em class="imp">*</em>实例名：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="sy_o_n" name="sy_o_n" maxlength="128" style="width:252px;padding-right:8px;">
									<p class="form-tip">不能含有特殊字符</p>
								</div>
							</div>
						</div>
						<!---->
					</div>
				</div>
				<div class="c-form">
					<div class="btns">
						<a href="javascript:;" class="btn btn-normal btn-submit perm_host_disabled">保&nbsp;&nbsp;存</a>
						<a href="javascript:;" class="btn btn-normal btn-cancel">重&nbsp;&nbsp;置</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 服务 -->
	<div class="dialog-cont" id="scDCTab1" style="display:none;">
		<div class="container">
			<div class="c-cont1" style="max-height:280px;overflow:auto; min-height: 220px;">
				<div class="c-wrap" style="padding:0 0 90px;margin-top: -10px;overflow: hidden;">
					<div class="c-form c-form-host col3" style="min-width:760px;">

						<div class="clearfix"></div>
						<div class="c-table" style="padding: 0;margin-left: 10px;">
							<div class="form" style="overflow: hidden;">
								<div class="form-item" style="width:40%;margin-left: -5px;" id="device_module">
									<span class="form-tag">设备类型：</span>
									<div class="form-c">
										<select class="form-select" name="" id="device_type" onchange="change_device_type(this);" style="width: 140px;">
											<option value="-1">请选择</option>
										</select>
									</div>
								</div>
								<div class="form-item" style="width:40%;margin-left: -10px;" id="module_server">
									<span class="form-tag">模板载入：</span>
									<div class="form-c">
										<select class="form-select" name="" id="def_server" onchange="show_def_server(this);" style="width: 140px;">
											<option value="-1">请选择</option>
										</select>
									</div>
								</div>
								<div class="form-item" style="width: 39.3%;margin-left: -6px;">
									<span class="form-tag">
										<em class="imp">*</em>协议：</span>
									<div class="form-c" style="padding-left: 99px;">
										<div class="xSelect ProtocolName" id="ProtocolName"></div>
										<!-- <select class="form-select" name="" id="ProtocolName" style="width: 140px;">
											<option value="">请选择</option>
										</select> -->
									</div>
								</div>
								<div class="form-item" style="width: 42.3%;margin-left: -4px;">
									<span class="form-tag">
										<em class="imp">*</em>端口：</span>
									<div class="form-c">
										<input type="text" class="form-text" id="Port" maxlength="5" onkeyup="/*port_check(this);*/" style="width:108px">
									</div>
								</div>

								<div class="form-item" style="width: 47.3%;margin-left: -7px;">
									<span class="form-tag">连接参数：</span>
									<div class="form-c" style="padding-left: 99px;">
										<div class="xSelect ConnParamName" id="ConnParamName"></div>
										<!-- <select class="form-select" name="" id="ConnParamName" style="width: 140px;">
											<option value="">请选择</option>
										</select> -->
									</div>
								</div>
							</div>
						</div>

						<div class="btns" style="width: 640px;margin-left: -20px;margin-bottom: -20px;">
							<a href="javascript:;" class="btn btn-normal btn-submit">保&nbsp;&nbsp;存</a>
							<a href="javascript:;" class="btn btn-normal" onclick="clear_serverdata();">重&nbsp;&nbsp;置</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="bBtn" style="position: fixed;z-index:5;">
		<a href="javascript:;" class="btn" style="float: right;" onclick="back(0);"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
	</div>
	<script>
		$('.form-checkbox,.form-radio').iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		});
		$('.select2,.filter-select,.form-select').select2({ minimumResultsForSearch: -1 });
	</script>
	<!---->
	<script>
		var perm_1={{perm_1}};
		var perm_host={{perm_host}};
		if(perm_host==1){
			$('.perm_host_disabled').remove();
		}
		if(perm_1==1){
			$('.perm_1_disabled').remove();
		}
		var perm_server={{perm_server}};
		if(perm_server==1){
			$('.perm_server_disabled').remove();
		}
		var perm_client={{perm_client}}
		var perm_pwd_mod={{perm_pwd_mod}};
		var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
		var urlReg = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
		var ipReg=/(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;
		var hostcheck1=/^(https?:\/\/)?(w{3}\.)?([a-zA-Z0-9-_.])+\.(com|cn|gov|info|us|hk|tw|cc|tv|uk|org)$/;
		var hostcheck2=/^(https?:\/\/)?((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$/;
		var pwdmodstrategy = null;
		var smtpconfig = null;
		var ftpserver = null;
		var pwdauth = {
			"PwdModPlanId": 0,
			"PwdModPlanName": null,
			"PwdModType": 1,
			"PwdModStrategyId": 0,
			"Enabled": true,
			"LoginUserCode": null,
			"IsSendPrePwdFile": true,
			"ReviewStatus": 0,   //--审核状态
			"Status": 0,        // --执行结果
			"PasswordAuthSet": [],
			"HostSet": [],
			"DeleteAuthObject": [],
			"AuthMode": 1,           //1-按目标，指定账号；2-范围，共有账号；3-范围，所有账号；4-范围，自定义
			"AuthService": null,     //AuthMode=2或3或4时使用，授权服务,如果勾选了所有服务，则为*，否则为null
			"AuthAccountId": null,   //AuthMode=2或3或4时使用，授权账号
			"AuthScope": [],                  //AuthMode=2或3或4
			"AuthServiceSet": []    //AuthMode=2或3或4

		};
		var pwdauth_save = {
			"PwdModPlanId": 0,
			"PwdModPlanName": null,
			"PwdModType": 1,
			"PwdModStrategyInfo": {
				"Type": 1,         // --1.公用的改密策略，2-用户自己配置的改密策略
            	"IsModified":false,
				"PwdModStrategyId": null,
				"UserCode": "",
				"PwdModStrategyName": "",
				"StartTime": "",
				"PeriodType": 1,
				"PeriodValue": 3,
				"PasswordType": 1,
				"Password": null,
				"ResultSendMethod": 0,
				"MasterSmtpConfigId": null,
				"StandBySmtpConfigId": null,
				"MasterFTPServerId": null,
				"StandByFTPServerId": null,
				"ReceiverSet": null
			},
			"Enabled": true,
			"LoginUserCode": null,
			"IsSendPrePwdFile": true,
			"ReviewStatus": 0,   //--审核状态
			"Status": 0,        // --执行结果
			"PasswordAuthSet": [],
			"HostSet": [],
			"DeleteAuthObject": [],
			"AuthMode": 1,           //1-按目标，指定账号；2-范围，共有账号；3-范围，所有账号；4-范围，自定义
			"AuthService": null,     //AuthMode=2或3或4时使用，授权服务,如果勾选了所有服务，则为*，否则为null
			"AuthAccountId": null,   //AuthMode=2或3或4时使用，授权账号
			"AuthScope": [],                  //AuthMode=2或3或4
			"AuthServiceSet": []    //AuthMode=2或3或4

		};
		var pwdmod = {
			"PwdModStrategyId": 0,
			"UserCode": "",
			"PwdModStrategyName": "",
			"StartTime": "",
			"PeriodType": 1,
			"PeriodValue": 3,
			"PasswordType": 1,
			"Password": null,
			"ResultSendMethod": 0,
			"MasterSmtpConfigId": null,
			"StandBySmtpConfigId": null,
			"MasterFTPServerId": null,
			"StandByFTPServerId": null,
			"ReceiverSet": null
		}
		var smtpconfig_save = {
			"SmtpConfigId": 0,
			"SmtpConfigName": null,
			"SmtpServer": null,
			"DNS": null,
			"Sender": null,
			"SenderEmail": null,
			"AttachMaxLimit": 20,
			"ServerVerify": true,
			"SenderEmailPass": null,
			"Flag": 0,     
        	"EnCode": 0
		};
		var ftpserver_save = {
			"FTPServerId": 0,
			"FTPServerName": null,
			"ServerIP": null,
			"DNS": null,
			"ServerUser": null,
			"ServerPasswd": null,
			"ServerPath": null,
			"Flag": 0 ,
			"IfPasv": true
		};
		var type = new Array();
		type[0] = 6;
		type[1] = 1;
		type[2] = 2;
		var usercode = "";
		var search_typeall_r = '';
		var max = 365;
		var hostpwd_data = null;
		var se;

		var last_object = new Array();
		last_object[0] = null;
		last_object[1] = null;
		last_object[2] = null;
		var edit_id = new Array();
		edit_id[0] = parseInt(document.frm_pwdauth_add.a.value);
		edit_id[1] = 0;
		edit_id[2] = 0;
		var top1 = 9007199254740991;
		var host_path_all = new Array();
		host_path_all[0] = [];
		host_path_all[1] = [];
		host_path_all[2] = [];
		var push_hgid = new Array();
		push_hgid[0] = [];
		push_hgid[1] = [];
		push_hgid[2] = [];
		var push_hid = new Array();
		push_hid[0] = [];
		push_hid[1] = [];
		push_hid[2] = [];
		var hdata = new Array();
		hdata[0] = null;
		hdata[1] = null;
		hdata[2] = null;
		var filter_flag_append = new Array();
		filter_flag_append[0] = false;
		filter_flag_append[1] = false;
		filter_flag_append[2] = false;
		var flag_loading = false;
		var old_path_all = new Array();
		old_path_all[0] = [];
		old_path_all[1] = [];
		old_path_all[2] = [];
		var pwdmod_id=0;
		var old_pwdmod_id=0;
		var smtpconfig_data_all;
		var ftpconfig_data_all;
		$(function () {
			$('#AttachMaxLimit_Master').bind('keydown', function (e) {
				DigitInput(e);
			}).on("input propertychange", function () {				//防止在输入法开启的情况下输入非数字
				this.value = this.value.replace(/\D/g, "").trim();
			});
			$('#ReceiverSet').on('change',function () {
				var ReceiverSet = $('#ReceiverSet').val();
				if ($('#ReceiverSet').find('option').length == 2 && $('#ReceiverSet option:selected').val() != '0') {
					_addReceiver($('#ReceiverSet').siblings('i'));
					$('#ReceiverSet').parent('div.item').hide();
				} else if ($('#ReceiverSet').find('option').length == 1) {
					$('#ReceiverSet').parent('div.item').hide();
				} else {
					$('#ReceiverSet').parent('div.item').show();
				}
			});
			var pass=true;
			$.ajax({
				url: '/bhost/get_user_all_admin',
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(),a1:1 },
				success: function (result) {
					var result=JSON.parse(result);
					if(result.Result){
						ReceiverSet_array=new Array();
						ReceiverSet_array2=new Array();
						$.each(result.info,function (i,params) {
							if(params.Email!='' && params.Email!=null){
								ReceiverSet_array[params.UserId]='<option value="'+params.UserId+'">'+params.UserCode+'</option>';
							}
							ReceiverSet_array2[params.UserId]='<option value="'+params.UserId+'">'+params.UserCode+'</option>';
						});
						$('#ReceiverSet').append(ReceiverSet_array.join(''));
						$('#ReceiverSet2').append(ReceiverSet_array2.join(''));
					}else{
						_alert(1,'自动改密',result.ErrMsg);
						pass=false;
						return false;
					}
				}
			});
			if(!pass){
				return false;
			}
			bind_server_xSelect();
			$('#StartDay').jeDate({
				format:"YYYY-MM-DD",
				isTime:true,
				// maxDate:9999 + "-" + 99 + "-" + 99
			});
			$(document).on('keydown','input.timeinput',function(){
				var i = $(this).index();        
				var v = $(this).val();
				v = v.replace(/[^\d]/g,'');
				$(this).val(v);
			}).on('keyup','input.timeinput',function(e){
				var i = $(this).index();
				var v = $(this).val();    
				var max = 23;
				if(i>1){
					max = 59;
				}

				if(v > max){
					v = max;
				}

				$(this).val(v);

				v = v.toString();
				if(v.length >= 2){
					$(this).val(v.substring(0,2));

					var keycode = e.keyCode;
					if(keycode != 9){
						$(this).next().next().focus();
					}
				}
			}).on('focus','input.timeinput',function(){
				$(this).select();
			}).on('blur','input.timeinput',function(){
				var v = $(this).val();
				v = v.toString();

				if(v == ''){
					v = '00';
				}else if(v.length == 1){
					v = '0' + v;
				}

				$(this).val(v);
			});
			$('.xSelect').on('click','.xSelect-show',function () {
				$focusObj=$(this).parents('.xSelect');
			})
			$('#userTree,#userTreeh,#userTree1').on('change', 'span.authtype input', function () {
				var checked = $(this).prop('checked');
				_authTypeTheme($(this));
				if (checked) {
					var $input1 = $(this).parent().parent().siblings('ul').find('span.authtype input');
					var $input2 = $(this).parent().parent().siblings('ul').find('input.zcheck');
					var $input3 = $(this).parent().parent().siblings('input.zcheck');
					$input2.attr("data-loadlast", 2);
					$input3.attr("data-loadlast", 2);
					$(this).attr('data-ifselect', true);
					$input1.prop('disabled', true);
					_authTypeTheme($input1);
					$input2.prop('checked', true).prop('disabled', true);
					$(this).parent().parent().siblings('input.zcheck').prop('checked', true).next('span.checkbox').attr('class', 'checkbox checked');
					$.each($input2, function () {
						$(this).next('span.checkbox').attr('class', 'checkbox checked disabled');
					});

					_checkEvent($(this).parent().parent().siblings('input.zcheck'));
				} else {
					var $input1 = $(this).parent().parent().siblings('ul').children('li').find('span.authtype').find('input');
					var $input2 = $(this).parent().parent().siblings('ul').children('li').find('input.zcheck');
					$(this).attr('data-ifselect', false);
					$input1.prop('disabled', false);
					_checkEvent1($(this));
				}
			}).on('click', 'i.h-aicon', function () {
				var $item = $(this);
				var id = $item.data('id').split('-');
				var $u = $item.parent().children('ul');
				if ($u.is(':hidden')) {
					$item.addClass('h-aicon-d');
					$u.show();
					if ($u.children('li').length == 0) {
						var v = 2, d;
						var $input = $(this).siblings('span.checkbox');
						if ($(this).siblings('span.authtype').find('input').is(':checked')) {
							d = 0;
						} else {
							d = 1;
						}
						if ($input.attr('class').indexOf('disabled') > 0) {
							d = 0;
						}
						var c = $input.attr('class');
						if (c.indexOf('checked') > 0) {
							v = 1;
						} else if (c == 'checkbox') {
							v = 0;
						}
						_initHTML($u, id[1], v, d, id[0]);
					}
				} else {
					$item.removeClass('h-aicon-d');
					$u.hide();
				}
			}).on('dblclick','i.h-eicon,span.h-name',function () {
				var i_class_arr=$(this).siblings('i.h-aicon');
				if(i_class_arr.length==0){
					return false;
				}
				var $item = i_class_arr;
				var id = $item.data('id').split('-');
				var $u = $item.parent().children('ul');
				if ($u.is(':hidden')) {
					$item.addClass('h-aicon-d');
					$u.show();
					if ($u.children('li').length == 0) {
						var v = 2, d;
						var $input = $(this).siblings('span.checkbox');
						if ($(this).siblings('span.authtype').find('input').is(':checked')) {
							d = 0;
						} else {
							d = 1;
						}
						if ($input.attr('class').indexOf('disabled') > 0) {
							d = 0;
						}
						var c = $input.attr('class');
						if (c.indexOf('checked') > 0) {
							v = 1;
						} else if (c == 'checkbox') {
							v = 0;
						}
						_initHTML($u, id[1], v, d, id[0]);
					}
				} else {
					$item.removeClass('h-aicon-d');
					$u.hide();
				}
			});
			$('#PeriodType').on('change', function () {
				var PeriodType = $('#PeriodType').val();
				if (PeriodType == 1) {
					max = 365;
				} else {
					max = 1440;
				}
			});
			$('#server_select').on('change', function () {
				var server_select = $('#server_select').val();
				if (server_select == 0) {
					$('#server_text').hide();
					$('#filterWW').hide();
					$('#clearFilter').hide();
				} else {
					$('#server_text').show();
					if ($('#filterWW ul li').length) {
						$('#filterWW').show();
						$('#clearFilter').show();
					}
				}
			});
			$("#server_select_z").change(function () {
				var type = $(this).val();
				if (type == 0) {
					$("#server_text_z").hide();
					$('#filterWW_z').hide();
					$('#clearFilter1').hide();
				} else {
					$("#server_text_z").show();
					if ($('#filterWW_z ul li').length) {
						$('#filterWW_z').show();
						$('#clearFilter1').show();
					}
				}
			});
			$('#a3').on('ifChecked', function (e) {
			}).on('ifUnchecked', function (e) {
			});
			$('.g-radios').on('ifChecked', 'input[type=radio]', function () {
				var v = $(this).val();
				var v_id = $(this).attr('id');
				if (v_id == 'a3' || v_id == 'b2') {
					$(this).parents('.g-radios').find('input[type=text],input[type=password]').show();
				} else {
					$(this).parents('.g-radios').find('input[type=text],input[type=password]').hide();
				}
			}).on('ifChecked', 'input[type=checkbox]', function () {
				$(this).parents('label').next('span.forCheck').show();
			}).on('ifUnchecked', 'input[type=checkbox]', function () {
				$(this).parents('label').next('span.forCheck').hide();
			});
			$("#ProtocolName").unbind().bind("change", function () {
				$("#Port").val($("#ProtocolName option:selected").attr("data"));
				//获取 连接参数
				$.ajax({
					url: '/bhost/get_ConnParam_list',
					type: "post",
					async: false,
					cache: false,
					data: { a0: se, a1: $(this).val() },
					success: function (Result) {
						connparm_list = JSON.parse(Result);
						$("#ConnParamName").empty();
						$("#ConnParamName").append("<option value=\"\">请选择</option>");
						$.each(connparm_list.data, function (i, item) {
							$("#ConnParamName").append("<option value=\"" + item.ConnParamId + "\" >" + item.ConnParamName + "</option>");
						})
					}
				})
			});
			$("#check_all").on("ifClicked", function () {
				if (!$(this).prop("checked")) {
					$("#service_list2").find('input').iCheck('check');
				} else {
					$("#service_list2").find('input').iCheck('uncheck');
				}
			});
			//只输入数字
			$("#PeriodValue").bind('keydown', function (e) {
				DigitInput(e);
			});
			_initSize();
			_initList();
			$("#part1").on('ifChecked',function(){
				$("#ip_n1").find("input").attr("disabled",false);
				$("#ip_n").find("input").attr("disabled",false);
				$("#ip_n1").find(".ctr.ctr-add").attr("onclick","_addIp1(this,2)");
				$("#ip_n").find(".ctr.ctr-add").attr("onclick","_addIp(this,2)");
			}).on('ifUnchecked',function(){
				$("#ip_n1").find("input").attr("disabled",true);
				$("#ip_n").find("input").attr("disabled",true);
				$("#ip_n1").find(".ctr.ctr-add").attr("onclick","");
				$("#ip_n").find(".ctr.ctr-add").attr("onclick","");
			})
			$("#part1").parent().attr("style","float: right; margin-top: 9px; position: relative;");
			var tasktype = document.frm_pwdauth_add.tasktype.value;
			$.ajax({
				url: "/bhost/get_smtpconfig",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val() },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						var data = result.info;
						smtpconfig_data_all=result.info.data;
						smtpconfig = new Array();
						smtpconfig[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
						$.each(data.data, function (i, item) {
							if(item.SmtpConfigId==0){
								return true;
							}
							smtpconfig[item.SmtpConfigId]=(JSON.parse('{"value":'+item.SmtpConfigId+',"name":"'+item.SmtpConfigName+'","type":"'+(perm_1==2?'edit':'check')+'"}'));
						});
					} else {
						_alert(1, '自动改密', result.ErrMsg);
						pass=false;
						return false;
					}
				}
			});
			if(!pass){
				return false;
			}
			$.ajax({
				url: "/bhost/get_ftpserver",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val() },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						var data = result.info;
						ftpconfig_data_all=result.info.data;
						ftpserver = new Array();
						ftpserver[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
						$.each(data.data, function (i, item) {
							if(item.FTPServerId==0){
									return true;
								}
							ftpserver[item.FTPServerId] =(JSON.parse('{"value":'+item.FTPServerId+',"name":"'+item.FTPServerName+'","type":"'+(perm_1==2?'edit':'check')+'"}'));
						})
					} else {
						_alert(1, '自动改密', result.ErrMsg);
						pass=false;
						return false;
					}
				}
			});
			if(!pass){
				return false;
			}
			xSelect_json={
				num:'1',
				width: 168,
				defaultText: '全局指定',
				items:smtpconfig,
				edit: function(item,obj){
					$('.'+$('.xSelect_stmp1 .xSelect-show').data('id')).hide();
					get_dialog_stmp(obj,1);
				},
				check: function(item,obj){
					$('.'+$('.xSelect_stmp1 .xSelect-show').data('id')).hide();
					get_dialog_stmp(obj,1);
				},
				delete: function(item,obj){
				},
				btn:[
				],
				setval:function(item,obj){
					update_xSelect($('.xSelect_stmp2'));
				}
			};
			if(perm_1==2){
				xSelect_json.num='2';
				xSelect_json.btn.push({
						'name':'新增',
						'event': function(items,obj){
							get_dialog_stmp(obj,2);
						}
					});
			}
			$('.xSelect_stmp1').xSelect(xSelect_json);
			$('.xSelect_stmp1').data('value',0);
			xSelect_json={
				num:'1',
				width: 168,
				defaultText: '全局指定',
				items:smtpconfig,
				edit: function(item,obj){
					$('.'+$('.xSelect_stmp2 .xSelect-show').data('id')).hide();
					get_dialog_stmp(obj,1);
				},
				check: function(item,obj){
					$('.'+$('.xSelect_stmp2 .xSelect-show').data('id')).hide();
					get_dialog_stmp(obj,1);
				},
				delete: function(item,obj){
				},
				btn:[
					
				],
				setval:function(item,obj){
					update_xSelect($('.xSelect_stmp1'));
				}
			};
			if(perm_1==2){
				xSelect_json.num='2';
				xSelect_json.btn.push({
						'name':'新增',
						'event': function(items,obj){
							get_dialog_stmp(obj,2);
						}
					});
			}
			$('.xSelect_stmp2').xSelect(xSelect_json);
			$('.xSelect_stmp2').data('value',0);
			xSelect_json={
				num:'1',
				width: 168,
				defaultText: '全局指定',
				items:ftpserver,
				edit: function(item,obj){
					$('.'+$('.xSelect_ftp1 .xSelect-show').data('id')).hide();
					get_dialog_ftp(item,1);
				},
				check: function(item,obj){
					$('.'+$('.xSelect_ftp1 .xSelect-show').data('id')).hide();
					get_dialog_ftp(item,1);
				},
				delete: function(item,obj){
				},
				btn:[
					
				],
				setval:function(item,obj){
					update_xSelect($('.xSelect_ftp2'));
				}
			};
			if(perm_1==2){
				xSelect_json.num='2';
				xSelect_json.btn.push({
						'name':'新增',
						'event': function(items,obj){
							get_dialog_ftp(items,2);
						}
					});
			}
			$('.xSelect_ftp1').xSelect(xSelect_json);
			$('.xSelect_ftp1').data('value',0);
			xSelect_json={
				num:'1',
				width: 168,
				defaultText: '全局指定',
				items:ftpserver,
				edit: function(item,obj){
					$('.'+$('.xSelect_ftp2 .xSelect-show').data('id')).hide();
					get_dialog_ftp(item,1);
				},
				check: function(item,obj){
					$('.'+$('.xSelect_ftp2 .xSelect-show').data('id')).hide();
					get_dialog_ftp(item,1);
				},
				delete: function(item,obj){
				},
				btn:[
					
				],
				setval:function(item,obj){
					update_xSelect($('.xSelect_ftp1'));
				}
			};
			if(perm_1==2){
				xSelect_json.num='2';
				xSelect_json.btn.push({
						'name':'新增',
						'event': function(items,obj){
							get_dialog_ftp(items,2);
						}
					});
			}
			$('.xSelect_ftp2').xSelect(xSelect_json);
			$('.xSelect_ftp2').data('value',0);
			document.frm_pwdauth_add.us.value = window.parent.document.frm.us.value;
			document.frm_pwdauth_add.se.value = window.parent.document.frm.se.value;
			usercode = window.parent.document.frm.us.value;
			se = window.parent.document.frm.se.value;
			time_show(0);
			$.ajax({
				url: '/bhost/get_hostpwdstrategy',
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a1: usercode },
				success: function (result) {
					result = result.replace('None', 'null');
					var hostpwd_result = JSON.parse(result);
					if (hostpwd_result.Result) {
						hostpwd_data = hostpwd_result.info;
						if (hostpwd_data == null) {
							pass=false;
							parent.layer.open({
								type: 1,
								title: '自动改密',
								content: '<div class="layer-alert"><i class="alert warning"></i>改密设定未配置</div>',
								btn: ['确&nbsp;&nbsp;定'],
								btnAlign: 'c',
								closeBtn: false,
								skin: 'layer-custom',
								area: ['380px', '310px'],
								move: false,
								resize: false,
								yes: function (i) {
									parent.layer.close(i);
									hostpwdstrategy();
								}
							});
						}else if((hostpwd_data.ReceiverSet==null || hostpwd_data.ReceiverSet.length==0)){
							pass=false;
							parent.layer.open({
								type: 1,
								title: '自动改密',
								content: '<div class="layer-alert"><i class="alert warning"></i>改密设定未配置</div>',
								btn: ['确&nbsp;&nbsp;定'],
								btnAlign: 'c',
								closeBtn: false,
								skin: 'layer-custom',
								area: ['380px', '310px'],
								move: false,
								resize: false,
								yes: function (i) {
									parent.layer.close(i);
									hostpwdstrategy();
								}
							});
						}else{
							$.ajax({
								url: '/bhost/get_global_IfPwdApprove',
								type: "POST",
								async: false,
								data: { a0: $("input[name=se]").val() },
								success: function (result_global) {
									var result_global=JSON.parse(result_global);
									if(result_global.Result){
										if(result_global.info.PwdApproveNum && (hostpwd_data.PwdApproveUserSet==null || hostpwd_data.PwdApproveUserSet.length<result_global.info.PwdApproveNum || hostpwd_data.PwdFileApproveUserSet==null || hostpwd_data.PwdFileApproveUserSet.length<result_global.info.PwdFileApproveNum)){
											pass=false;
											parent.layer.open({
												type: 1,
												title: '自动改密',
												content: '<div class="layer-alert"><i class="alert warning"></i>改密设定审批管理员配置错误</div>',
												btn: ['确&nbsp;&nbsp;定'],
												btnAlign: 'c',
												closeBtn: false,
												skin: 'layer-custom',
												area: ['380px', '310px'],
												move: false,
												resize: false,
												yes: function (i) {
													parent.layer.close(i);
													hostpwdstrategy();
												}
											});
										}
									}else{
										_alert(2,'全局策略',result.ErrMsg);
										pass=false;
										return false;
									}
								}
							});
						}
					} else {
						pass=false;
						_alert(1, '自动改密', hostpwd_result.ErrMsg);
						return false;
					}
				}
			});
			if(!pass){
				return false;
			}
			var pwdmodstrategy_x=[];
			$.ajax({
				url: "/bhost/get_pwdmodstrategy",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val() },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						var data = result.info;
						pwdmodstrategy = new Array();
						pwdmodstrategy[0] = (JSON.parse('{"value":'+pwdmod_id+',"name":"请选择","type":null}'));
						pwdmodstrategy_x.push(JSON.parse('{"value":'+pwdmod_id+',"name":"请选择","type":null}'));
						$.each(data.data, function (i, item) {
							if(item.PwdModStrategyName.indexOf('#')>=0){
								return true;
							}
							pwdmodstrategy[item.PwdModStrategyId] = (JSON.parse('{"value":'+item.PwdModStrategyId+',"name":"'+item.PwdModStrategyName+'","type":'+(perm_pwd_mod==2?'"delete"':'null')+'}'));
							pwdmodstrategy_x.push(JSON.parse('{"value":'+item.PwdModStrategyId+',"name":"'+item.PwdModStrategyName+'","type":'+(perm_pwd_mod==2?'"delete"':'null')+'}'));
						});
					} else {
						_alert(1, '自动改密', result.ErrMsg);
						pass=false;
						return false;
					}
				}
			});
			if(!pass){
				return false;
			}
			console.log(pwdmodstrategy_x);
			console.log(pwdmodstrategy_x[-1]);
			xSelect_json={
				num:'1',
				width: 168,
				defaultText: '请选择',
				items:pwdmodstrategy_x,
				edit: function(item,obj){
				},
				check: function(item,obj){
				},
				delete: function(item,obj){
					$('.'+$('#PwdModStrategy .xSelect-show').data('id')).hide();
					update_xSelect($('#PwdModStrategy'));
					var layer_value = '自动改密';
					$.ajax({
						url: '/bhost/find_mod_to_other_pwdauth',
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val(), a1: document.frm_pwdauth_add.a.value, a2: item.value },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								if (result.num > 0) {
									$('.btn').blur(); parent.layer.open({
										type: 1,
										title: '自动改密',
										content: '<div class="layer-alert"><i class="alert warning"></i>该密码策略应用于其他计划，是否删除</div>',
										btn: ['确&nbsp;&nbsp;定', '取&nbsp;&nbsp;消'],
										btnAlign: 'c',
										closeBtn: false,
										skin: 'layer-custom',
										area: ['380px', '310px'],
										move: false,
										resize: false,
										yes: function (i) {
											parent.layer.close(i);
											if((parseInt($focusObj.data('value'))==item.value)){
												$focusObj.data('value',0);
												$('.xSelect-show-text',$focusObj).text('请选择');
											}
											_delNode(item);
											$(obj).fadeOut(function(){
												$(this).remove();
												Xselect._setPosition();
											});
											update_xSelect($('#PwdModStrategy'));
										}
									});
								} else {
									$('.btn').blur(); parent.layer.open({
										type: 1,
										title: layer_value,
										content: '<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
										btn: ['删&nbsp;&nbsp;除', '取&nbsp;&nbsp;消'],
										btnAlign: 'c',
										closeBtn: false,
										skin: 'layer-custom',
										area: ['380px', '310px'],
										move: false,
										resize: false,
										yes: function (i) {
											parent.layer.close(i);
											if((parseInt($focusObj.data('value'))==item.value)){
												$focusObj.data('value',0);
												$('.xSelect-show-text',$focusObj).text('请选择');
											}
											_delNode(item);
											$(obj).fadeOut(function(){
												$(this).remove();
												Xselect._setPosition();
											});
											update_xSelect($('#PwdModStrategy'));
										}
									});
								}
							}
						}
					});
				},
				btn:[
					
				],
				setval:function(item,obj){
					if(item.value==0){
						item.value=old_pwdmod_id;
					}
					if(item.value==0){
						pwd_clear();
						$('#PwdModStrategyName').hide();
						// _viewHTML('#userTreeh', 'UG');
						return false;
					}
					$.ajax({
						url: "/bhost/get_pwdmodstrategy",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val(),a1:item.value},
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								item_pwd = result.info.data[0];
								PwdModStrategy();
							} else {
								_alert(1, '自动改密', result.ErrMsg);
								return false;
							}
						}
					});
				}
			};
			if(perm_pwd_mod==2){
				xSelect_json.num='2';
				xSelect_json.btn.push({
						'name':'新增',
						'event': function(items,obj){
							_addNew2();
						}
					});
			}
			var Xselect=$('#PwdModStrategy').xSelect(xSelect_json);
			$('#PwdModStrategy').data('value',pwdmod_id);
			get_account();
			get_server();
			//协议
			// $.ajax({
			// 	url: '/bhost/get_protocol_list',
			// 	type: "post",
			// 	async: false,
			// 	cache: false,
			// 	data: { a0: se, a1: 1, a2: null, a3: null, a4: ',,', a5: null },
			// 	success: function (Result) {
			// 		proto_list = JSON.parse(Result);
			// 		$("#ProtocolName").empty();
			// 		$("#ProtocolName").append("<option value=\"\" data=\"\">请选择</option>");
			// 		$.each(proto_list.data, function (i, item) {
			// 			$("#ProtocolName").append("<option value=\"" + item.ProtocolId + "\" data=\"" + item.Port + "\">" + item.ProtocolName + "</option>");
			// 		})
			// 	}
			// })
			disabled_ftp();
			disabled_smtp();
			pwdmod.UserCode = usercode;
			pwdauth_save.PwdModStrategyInfo.UserCode=usercode;
			pwdauth_save.LoginUserCode = usercode;
			server_find_json.loginusercode = usercode;
			if (tasktype == '2') {
				var id = document.frm_pwdauth_add.a.value;
				$.ajax({
					url:'/bhost/PUpdateHNodeSelectedForQuick',
					type:'post',
					async:false,
					data:{a0:$("input[name=se]").val(),z1:id,z2:6},
					success:function(result){
						var data = JSON.parse(result)
						if(data.Result != true){
							_alert(1, "自动改密", "数据刷新失败");
							return false;
						}
					}
				});
				$.ajax({
					url: "/bhost/get_pwdauth_list",
					type: "POST",
					async: false,
					data: { a0: $("input[name=se]").val(), a1: id },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							var data = result.info;
							pwdauth = data.data[0];
							last_object[0] = pwdauth.HostSet;
							var PwdModStrategyId;
							if(pwdauth.PwdModStrategyInfo==null){
								pwdauth.PwdModStrategyInfo={
									'PwdModStrategyId':0,
									'PwdModStrategyName':null
								}
							}
							if (pwdauth.PwdModStrategyInfo.PwdModStrategyId == null) {
								PwdModStrategyId = 0;
							}else{
								PwdModStrategyId=pwdauth.PwdModStrategyInfo.PwdModStrategyId;
							}
							if (pwdauth.PwdModStrategyInfo.PwdModStrategyName == null || pwdauth.PwdModStrategyInfo.PwdModStrategyName.indexOf('#')>=0) {
								old_pwdmod_name=String(pwdauth.PwdModStrategyInfo.PwdModStrategyName);
								//////console.log('old_pwdmod_name:'+old_pwdmod_name);
								pwdauth.PwdModStrategyInfo.PwdModStrategyName = '请选择';
								//////console.log('old_pwdmod_name:'+old_pwdmod_name);
								PwdModStrategyId = 0;
								pwdmod_id=0;
								old_pwdmod_id=pwdauth.PwdModStrategyInfo.PwdModStrategyId;
							}
							$('#PwdModPlanName').val(pwdauth.PwdModPlanName);
							$('#PwdModPlanName').attr('disabled', true);
							$('#PwdModStrategy .xSelect-show-text').text(pwdauth.PwdModStrategyInfo.PwdModStrategyName);
							$('#PwdModStrategy').data('value', PwdModStrategyId);
							if (!pwdauth.IsSendPrePwdFile) {
								$('#IsSendPrePwdFile').iCheck('uncheck');
							}
							if (pwdauth.AuthMode == 2 || pwdauth.AuthMode == 3) {
								$("#typeSet").val(2).trigger('change');
								if (pwdauth.AuthMode == 3) {
									all_flag = 1;
								} else {
									$("#mix_select").val(2).trigger('change');
									all_flag = 0;
								}
								if (pwdauth.AuthAccountId == '*'){
									$("#a_mix_select").val('2').trigger('change');
								}
								if (pwdauth.AuthService == '*'){
									$("#s_mix_select").val('2').trigger('change');
								}
								for (var index = 0; index < pwdauth.AuthScope.length - 1; index++) {
									var item = pwdauth.AuthScope[index];
									$('.xSelect-show-text',$("#server_text_zdp")).text(item.ServerScopeName);
									$("#server_text_zdp").data('value',item.ServerScopeId);
									server_id = item.ServerScopeId;

									var $c = $('<div style="width:215px;margin-top: -10px;" class="item" id="' + item.ServerScopeId + '"/>');
									if (serverid_list.indexOf(item.ServerScopeId) === -1) {
										serverid_list.push(item.ServerScopeId);
									}
									$c.html('<input style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;width: 144px;padding: 0 8px;" typr="text" class="form-text" disabled="true" value="' + item.ServerScopeName + '"><i class="ctrl del" onclick="_del(this)"></i>');
									$("#server_text_zdp").parent().after($c);
									$("#server_text_zdp").data('value',-1);
									$('.xSelect-show-text',$("#server_text_zdp")).text('请选择');
								}
								if (pwdauth.AuthScope.length != 0) {
									var item = pwdauth.AuthScope[index];
									$('.xSelect-show-text',$("#server_text_zdp")).text(item.ServerScopeName);
									$("#server_text_zdp").data('value',item.ServerScopeId);
									server_id = item.ServerScopeId;
									binding_ServerScope();
								}
								if (pwdauth.AuthAccountId != "*" && pwdauth.AuthAccountId != null) {
									accountid = pwdauth.AuthAccountId.split(',');
								}
								if (pwdauth.AuthService == null) {
									$.each(pwdauth.AuthServiceSet, function (i, item) {
										var id = item.ProtocolId + '-' + item.ConnParamId + '-' + item.Port;
										AuthServiceSet.push(id);
									})
								} else {
									$("#-1").iCheck('check');
									AuthServiceSet.push('-1');
								}
								change_server();
							} else if (pwdauth.AuthMode == 4) { //范围自定义
								$("#typeSet").val(2).trigger('change');
								$("#define_select").val(2).trigger('change');
								for (var index = 0; index < pwdauth.AuthScope.length - 1; index++) {
									var item = pwdauth.AuthScope[index];
									$('.xSelect-show-text',$("#server_text_zdp")).text(item.ServerScopeName);
									$("#server_text_zdp").data('value',item.ServerScopeId);
									server_id = item.ServerScopeId;

									var $c = $('<div style="width:215px;margin-top: -10px;" class="item" id="' + item.ServerScopeId + '"/>');
									if (serverid_list.indexOf(item.ServerScopeId) === -1) {
										serverid_list.push(item.ServerScopeId);
									}
									$c.html('<input style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;width: 144px;padding: 0 8px;" typr="text" class="form-text" disabled="true" value="' + item.ServerScopeName + '"><i class="ctrl del" onclick="_del(this)"></i>');
									$("#server_text_zdp").parent().after($c);
									$("#server_text_zdp").data('value',-1);
									$('.xSelect-show-text',$("#server_text_zdp")).text('请选择');
								}
								if (pwdauth.AuthScope.length != 0) {
									var item = pwdauth.AuthScope[index];
									$('.xSelect-show-text',$("#server_text_zdp")).text(item.ServerScopeName);
									$("#server_text_zdp").data('value',item.ServerScopeId);
									server_id = item.ServerScopeId;
									binding_ServerScope();
								}
								
								var account_arry_temp = pwdauth.AuthAccountId.split(',');
								var data_all = a_data.data.length - 1;
								$.each(account_arry_temp, function (i, item) {
									if (item != '-1') {
										$("#account_select").val(item).trigger('change');
										if (i != account_arry_temp.length - 1) {
											$("#account_select").parent().find('i.add').click();
										}
									}
								})
								$.each(pwdauth.AuthServiceSet, function (i, item) {
									clear_serverdata();
									$("#ProtocolName").data('value',item.ProtocolId);
									$("#ProtocolName").find('span').text(item.ProtocolName);
									// $("#ProtocolName").val(item.ProtocolId).trigger('change');
									$("#Port").val(item.Port);
									if (item.ConnParamId != null) {
										$("#ConnParamName").data('value',item.ConnParamId);
										// $("#ProtocolName").find('span').text(item.ProtocolName);
										// $("#ConnParamName").val(item.ConnParamId).trigger('change');
									}
									update_xSelect($("#ProtocolName"));
									update_xSelect($("#ConnParamName"));
									_addServer('add');
								})
								change_server();
							} else {//对象指定
								$("#typeSet").val(1).trigger('change');
							}
							$.ajax({
								url: "/bhost/get_pwdmodstrategy",
								type: "POST",
								async: false,
								data: { a0: $("input[name=se]").val(),a1:pwdauth.PwdModStrategyInfo.PwdModStrategyId},
								success: function (result) {
									var result = JSON.parse(result);
									if (result.Result) {
										item_pwd = result.info.data[0];
										PwdModStrategy();
									} else {
										_alert(1, '自动改密', result.ErrMsg);
										return false;
									}
								}
							});
						} else {
							_alert(1, '自动改密', result.ErrMsg);
							return false;
						}
					}
				});
			}
			
			$('.form-select').select2({ minimumResultsForSearch: -1 });
		});
		$(window).resize(function () {
		});
		function a_mix_change(obj){
			var v = $(obj).val();
			if (v == 2){
				$("#account").hide();
			}else{
				$("#account").show();
				if ($("#mix_select").val() == 1){
					all_flag = 1;
					change_server();
				}else{
					all_flag = 0;
					change_server();
				}
			}
		}
		function _addReceiver(obj) {
			var add = 0;
			var $c = $(obj).parent();
			var $select=$c.children('select');
			var name2 = $select.children('option:selected').val();
			if (name2 == '0'){
				_alert(2, '自动改密', '请选择接收者');
				return false;
			}	
			var t = $select.children('option:selected').text();
			var $s = $('<li class="item" id="'+name2+'" style="width:225px;float: left;margin-left: -19px;">'+
			'<input type="text" class="form-text" id="'+name2+'" value="'+t+'" style="width:150px;" disabled="true">'+
			'<i class="ctrl del" style="margin-left: 9px;" onclick="_delReceiver(this)"></i></li>');
			$select.val(0);
			$select.find('option[value='+name2+']').remove();
			$c.after($s);
		}
		function _delReceiver(obj) {
			var $c = $(obj).parent();
			var m_id=parseInt($c.attr('id'));
			var div_content3_id=$(obj).parents('div.h-content3').attr('id');
			switch (div_content3_id) {
				case 'select_r':
					var select_name='ReceiverSet';
					var all_array=JSON.parse(JSON.stringify(ReceiverSet_array));
					break;
				case 'select_r2':
					var select_name='ReceiverSet2';
					var all_array=JSON.parse(JSON.stringify(ReceiverSet_array2));
					break;
			}
			if($('#'+select_name+' option[value='+m_id+']').length==0){
				var pass=true;
				for(i in all_array){
					if(i>m_id){
						if($('#'+select_name+' #'+i).length==0){
							$('#'+select_name+' option[value='+i+']').before(all_array[m_id]);
							pass=false;
							break;
						}
					}
				}
				if(pass){
					$('#'+select_name).append(all_array[m_id]);
				}
			}
			$c.fadeOut(function () {
				$c.remove();
				$('#'+select_name).trigger('change');
			});
		}
		function s_mix_change(obj){
			var v = $(obj).val();
			if (v == 2){
				$("#service_module").hide();
			}else{
				$("#service_module").show();
				if ($("#mix_select").val() == 1){
					all_flag = 1;
					change_server();
				}else{
					all_flag = 0;
					change_server();
				}
			}
		}
		function pwd_trust(){
			document.frm_pwdauth_add.action = '/bhost/pwd_trust';
			document.frm_pwdauth_add.submit();	
		}
		var protocol_id;
		function clear_protocol(){
			$("#protoDialog").find('input').val('');
			$("#Protocol_Name0").attr('disabled',false);
		}
		function protocol_main(type){
			$("#Port1").parent().parent().hide();
			$("#Port0").on("input propertychange",function(){
				this.value = this.value.replace(/\D/g, "");
			}).on("paste",function(){return false});
			$("#Port1").on("input propertychange",function(){
				this.value = this.value.replace(/\D/g, "");
			}).on("paste",function(){return false});
			if(type == 1){
				$.ajax({
				url:'/bhost/select_protocol',
				type:"post",
				async:false,
				data:{a0:se,x1:protocol_id},
				success:function(result){
						protdata = JSON.parse(result);
						$.each(protdata.data,function(i,item){
							if(item.ProtocolName=="PCANY")
							{
								$("#Port1").parent().parent().show();
								$("#Port1").val(item.Port1);
							}
							$("#Protocol_Name0").val(item.ProtocolName);
							$("#Port0").val(item.Port);
							$("#Description0").val(item.Description);
							$("#Protocol_Name0").attr("disabled",true);
						});
					}
				});
			}
		}
		function _editNode5(obj,type){
			clear_protocol();
			var title;
			if (type == 1) {//
				protocol_id = $(obj).children('span').data('value');
				title = "协议";
			} else if (type == 2) {
				protocol_id = 0;
				title = "协议";
			}
			var $dialogCont = $("#protoDialog").show();
			var d = dialog({
				title: title,
				content: $dialogCont,
				id: "protoDialog",
				width: "1000px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			protocol_main(type);
			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				clear_protocol();
				protocol_main(type);
			});
			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				save_pro(d);
			})
		}
		function save_pro(d){
			var nameReg1 = /^[\u4e00-\u9fa5a-zA-Z\d_\-]+$/;
			var ProtocolName = $("#Protocol_Name0").val();
			var des = $("#Description0").val();
			var Port = $("#Port0").val();
			if ($("#Port1").is(":visible")){
				//////console.log("123123");
				var Port1 = $("#Port1").val();
			}else{
				//////console.log("123123zzzzz");
				var Port1 = "0";
			}
			
			if(ProtocolName == ""){
				_alert(2,"协议","请输入名称",$("#Protocol_Name0"));	
				return false;
			}
			var len = 0;
			if (des != ""){
				for (var i = 0; i < des.length; i++) {
				if (des.charAt(i).match(/[\u4E00-\u9FA5]/ig) != null){ //全角 
						len += 2; 
					}else{
						len += 1; 
					}
				}
				if(len >= 255){
					_alert(1,"协议","描述内容过长",$("#Description0"));
					return false;                   
				}
			}
			//////console.log("Port:"+Port);
			//////console.log("Port1:"+Port1);
			if(Port == ""){
				//////console.log("zzzzaaaaa11111");
				_alert(1,"协议","请输入端口",$("#Port0"));
				return false;
			}
			if (Port1 == 0){
				//////console.log("qiguai");
			}
			
			if(Port1 == ""){
				//////console.log("zzzzaaaaa");
				_alert(1,"协议","请输入端口",$("#Port1"));
				return false;
			}
			//检查输入框格式
			if(!nameReg1.test(ProtocolName)){
				_alert(1,"协议","名称格式不正确",$("#Protocol_Name0"));
				return false;
			}
			if (protocol_id == 0){
				if(namecheck(ProtocolName)==false){
					_alert(1,"协议","相同名称已存在",$("#Protocol_Name0"));
					return false;
				}
			}
			
			var datalist = [];
			var dataP='{"ProtocolId":'+protocol_id+',"ProtocolName":"'+ProtocolName+'","Port":'+Port+',"Port1":'+Port1+',"Description":"'+des+'"}';
			datalist.push(dataP);
			msstr = aceg(JSON.stringify(datalist),se);
			$.ajax({
				url:'/bhost/set_protocol',
				type: "post",
				async:false,
				data: {a0:se,x1:JSON.stringify(datalist),a10:"密码管理>自动改密",m1:msstr},
				success:function(result){
					var data = JSON.parse(result);
					if (data.Result){
						$('.btn').blur();
						_alert(0,"协议","保存成功");
						var ProtocolName_id=$("#ProtocolName").data('value');
						//////console.log('ProtocolName_id'+ProtocolName_id);
						if(ProtocolName_id==0 || ProtocolName_id==undefined){
							$("#ProtocolName").data('value',data.ProtocolId);
							$("#ProtocolName").find('span').text(ProtocolName);
							$("#Port").val(Port);
						}else if(ProtocolName_id==data.ProtocolId){
							$("#Port").val(Port);
						}
						update_xSelect($('#ProtocolName'));
						//////console.log($("#ProtocolName").data('value'));
						//////console.log($("#ProtocolName").find('span').text(ProtocolName));
						update_xSelect($('#ConnParamName'));
						d.close().remove();
					}else{
						_alert(1,"协议",data.ErrMsg);
					}
				}
			});
		}
		function namecheck(name){
			var flag=true;
			$.ajax({
				url:'/bhost/select_name',
				type: "post",
				async:false,
				data: {a0:se,x1:name},
				success:function(result){
					data = parseInt(result);
					if (data !=0){
						flag=false;
					}
				}
			});
			return flag;
		}
		var conn_id;
		function _editNode6(obj,type){
			clear_conn();
			var title;
			if (type == 1) {//
				conn_id = $(obj).children('span').data('value');
				title = "连接参数";
			} else if (type == 2) {
				protocol_id = 0;
				title = "连接参数";
			}
			var $dialogCont = $("#connDialog").show();
			var con_d = dialog({
				title: title,
				content: $dialogCont,
				id: "connDialog",
				width: "800px;"
			});
			//////console.log(con_d)
			con_d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			con_d.showModal();
			conn_main(type);
			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				clear_conn();
				conn_main(type);
			});
			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				connection_add(con_d);
			})
		}
		function clear_conn(){
			$("#d_n_con").attr('disabled',false).val("");
			$("#d_n_con").next('i').attr('class','v-check');
			$("#connDialog").find('input').val('');
			$("#connDialog").find('select').val('0').trigger('change');
			$("#ServiceName_ssh").val('1').trigger('change');
			$("#ServiceName_sftp").val('1').trigger('change');
			$("#rdpType").val('NORMAL').trigger('change');
		}
		function conn_main(type){
			//协议类型下拉框
			$.ajax({
				url: "/bhost/get_protocol_list",
				type: "POST",
				async: false,
				data: { a0: se, a3: 30, a2: 1, a4: ",," },
				success: function (result) {
					var userinfo_result = JSON.parse(result);
					var userinfo_data = userinfo_result.data;
					$("#Protocol_con").empty();
					$("#Protocol_con").append('<option value="0">请选择</option>');
					var ProtocolId_arr=[9,10,11,12,16,17,18];
					$.each(userinfo_data, function (i, item) {
						if(item.ProtocolId<1000 && $.inArray(item.ProtocolId,ProtocolId_arr)<0){
						$("#Protocol_con").append('<option value="' + item.ProtocolId + '" text="' + item.ProtocolName + '">' + item.ProtocolName + '</option>');
						}
					});
				}
			});
			if (type == 1) {
				$.ajax({
					url: "/bhost/get_connection_list",
					type: "POST",
					async: false,
					data: { a0:se, a1: conn_id },
					success: function (result) {
						var connection_result = JSON.parse(result);
						if (connection_result.Result == true) {
							var connection_data = connection_result.info.data[0];
							$("#d_n_con").val(connection_data.ConnParamName);
							$("#d_n_con").attr("disabled", true);
							$("#Protocol_con").val(connection_data.ProtocolId).trigger('change');
							//////console.log(connection_data.ProtocolId);
							$("#HTTP").hide();
							$("#HTTPs").hide();
							$("#ORACLE").hide();
							$("#RADMIN").hide();
							$("#MSSQL").hide();
							$("#SYBASE").hide();
							$("#MY_DB2").hide();
							$('#RDP').hide();
							$("#SSH").hide();
							$("#SFTP").hide();
							$('#MY_ConnType').hide();
							$("#DB2").hide();
							switch (connection_data.ProtocolName) {
								case 'RDP':
									$('#RDP').show();
									$('#rdpType').val(connection_data.ConnType).trigger('change');
									break;
								case 'SSH':
									$('#SSH').show();
									$('#ServiceName_ssh').val(connection_data.ServiceName).trigger('change');
									break;
								case 'SFTP':
                                                                        $('#SFTP').show();
                                                                        $('#ServiceName_sftp').val(connection_data.ServiceName).trigger('change');
                                                                        break;
								//HTTP(S)
								case 'HTTP(S)':
									$("#HTTP").show();
									$("#url").val(connection_data.ServiceName);
									var index=connection_data.ConnParamValue.indexOf('|');
									$("#UserName").val(connection_data.ConnParamValue.substring(0,index));
									connection_data.ConnParamValue=connection_data.ConnParamValue.substring(index+1);
									var index=connection_data.ConnParamValue.indexOf('|');
									$("#UserPwd").val(connection_data.ConnParamValue.substring(0,index));
									$("#Submit").val(connection_data.ConnParamValue.substring(index+1));
									/*
									$("#HTTP").show();
									connection_data.ConnParamValue =connection_data.ConnParamValue.split('|');
									$("#url").val(connection_data.ServiceName);
									$("#UserName").val(connection_data.ConnParamValue[0]);
									$("#UserPwd").val(connection_data.ConnParamValue[1]);
									$("#Submit").val(connection_data.ConnParamValue[2]);
									*/
									break;
								//HTTPs
								case 'HTTPS':
									$("#HTTPs").show();
									$("#httpsurl").val(connection_data.ServiceName);
									var index=connection_data.ConnParamValue.indexOf('|');
									$("#httpsUserName").val(connection_data.ConnParamValue.substring(0,index));
									connection_data.ConnParamValue=connection_data.ConnParamValue.substring(index+1);
									var index=connection_data.ConnParamValue.indexOf('|');
									$("#httpsUserPwd").val(connection_data.ConnParamValue.substring(0,index));
									$("#httpsSubmit").val(connection_data.ConnParamValue.substring(index+1));
									
									/*
									$("#HTTPs").show();
									connection_data.ConnParamValue = JSON.parse(connection_data.ConnParamValue);
									$("#httpsurl").val(connection_data.ServiceName);
									if (connection_data.ConnParamValue.UserPwd == null) {
										connection_data.ConnParamValue.UserPwd = "";
									}
									if (connection_data.ConnParamValue.UserName == null) {
										connection_data.ConnParamValue.UserName = "";
									}
									if (connection_data.ConnParamValue.Submit == null) {
										connection_data.ConnParamValue.Submit = "";
									}
									$("#httpsUserPwd").val(connection_data.ConnParamValue.UserPwd);
									$("#httpsUserName").val(connection_data.ConnParamValue.UserName);
									$("#httpsSubmit").val(connection_data.ConnParamValue.Submit);
									*/
									break;
								//ORACLE
								case 'ORACLE':
									//
									////////console.log("switch 111 ORACLE");
									if (connection_data.ConnParamValue == null) {
										connection_data.ConnParamValue = 0;
									}
									//指定项必填
									$("#appoint").val(connection_data.ConnParamValue).trigger('change');
									$("#s_n").val(connection_data.ServiceName);
									if (connection_data.ConnType == null) {
										connection_data.ConnType = 0;
									}
									$("#conn").val(connection_data.ConnType).trigger('change');
									//
									$("#ORACLE").show();
									break;
								//RADMIN
								case 'RADMIN':
									//认证方式：
									if (connection_data.ConnType == null) {
										connection_data.ConnType = "0";
									}
									$("#authtype").val(connection_data.ConnType).trigger("change");
									////////console.log("switch 111 RADMIN");
									$("#RADMIN").show();
									break;
								//MSSQL
								case 'MSSQL':
									//
									//实例名：
									$("#o_n").val(connection_data.ServiceName);
									//认证方式：
									if (connection_data.ConnType == null) {
										connection_data.ConnType = "0";
									}
									$("#R_authtype").val(connection_data.ConnType).trigger("change");
									//
									$("#MSSQL").show();
									break;
								//MYSQL 
								case 'MYSQL':
									//
									//数据库名：
									$('#sql_n').val(connection_data.ServiceName);
									//
									$("#MY_DB2").show();
									$('#MY_ConnType').show();
									break;
								//DB2
								case 'DB2':
									//
									//数据库名：
									$('#dbsql_n').val(connection_data.ServiceName);
									//
									$("#DB2").show();
									break;
								//SYBASE
								case 'SYBASE':
									//
									//实例名：
									$('#sy_o_n').val(connection_data.ServiceName);
									//
									$("#SYBASE").show();
									break;
							}
						} else {
							_alert(1, '连接参数', connection_result.ErrMsg);
							return false;
						}
					}
				});
			}
			
			$("#Protocol_con").change(function () {
				var p_id = $(this).val();
				//////console.log(p_id);
				$("#HTTP").hide();
				$("#HTTPs").hide();
				$("#ORACLE").hide();
				$("#RADMIN").hide();
				$("#MSSQL").hide();
				$("#SYBASE").hide();
				$("#MY_DB2").hide();
				$('#RDP').hide();
				$("#SSH").hide();
				$("#SFTP").hide();
				$('#MY_ConnType').hide();
				$("#DB2").hide();
				switch ($('#Protocol_con option[value='+p_id+']').text()) {
					case "RDP":
						$('#RDP').show();
						break;
					case "SSH":
						$('#SSH').show();
						break;
					case "SFTP":
                                                $('#SFTP').show();
                                                break;
					//HTTP(S)
					case "HTTP(S)":
						$("#HTTP").show();
						break;
					//HTTP
					case "HTTPS":
						$("#HTTPs").show();
						break;
					//ORACLE
					case "ORACLE":
						$("#ORACLE").show();
						break;
					//RADMIN
					case "RADMIN":
						$("#RADMIN").show();
						break;
					//MSSQL
					case "MSSQL":
						$("#MSSQL").show();
						break;
					//MYSQL 
					case "MYSQL":
						$("#MY_DB2").show();
						$('#MY_ConnType').show();
						break;
					//DB2
					case "DB2":
						$("#DB2").show();
						break;
					//SYBASE
					case "SYBASE":
						$("#SYBASE").show();
						break;
				}
			});
		}
		var cnameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
		var sp_char = /^[^@\/\'\\\"#$%&\^\*|]+$/;
		function connection_add(con_d){
			//////console.log(con_d);
			connection = {
				"ConnParamId": 0,
				"ConnParamName": null,
				"ProtocolId": 0,
				"ServiceName": null,
				"ConnType": null,
				"ConnParamValue": null
			};
			var p_id = $("#Protocol_con").val();
			var val = $("#d_n_con").val();
			var $i = $("#d_n_con").next('i.v-check');
			if (val == "") {
				_alert(2, "连接参数", '请输入名称', $("#d_n_con"));
				return false;
			}
			if (!cnameReg.test(val)) {
				_alert(1, "连接参数", '名称格式不正确', $("#d_n_con"));
				return false;
			}
			if (p_id == "0") {
				_alert(2, "连接参数", '请选择协议类型');
				return false;
			}
			connection.ConnParamName = val;
			connection.ConnParamId = parseInt(conn_id);
			switch ($('#Protocol_con option[value='+p_id+']').text()) {
				case 'RDP':
					connection.ServiceName = null;
					connection.ConnType = $('#rdpType').val();
					connection.ConnParamValue = null;
					break;
				//SSH
				case "SSH":
					var ServiceName_ssh = $('#ServiceName_ssh').val();
					connection.ServiceName = ServiceName_ssh;
					connection.ConnType = null;
					connection.ConnParamValue = null;
					break;
				case "SFTP":
                                        var ServiceName_ssh = $('#ServiceName_sftp').val();
                                        connection.ServiceName = ServiceName_ssh;
                                        connection.ConnType = null;
                                        connection.ConnParamValue = null;
                                        break;
				//HTTP(S)
				case "HTTP(S)":
					//////console.log("switchHTTP");
					var url = $("#url").val();
					if (url == "") {
						_alert(2, "连接参数", "请输入URL", $("#url"));
						return false;
					}
					var UserName = $("#UserName").val();
					//////console.log(UserName);
					//////console.log(sp_char.test(UserName));
					if (!sp_char.test(UserName) && UserName != "") {
						_alert(1, "连接参数", "账号元素格式不正确", $("#UserName"));
						//$("#UserName").val("");
						return false;
					}
					var UserPwd = $("#UserPwd").val();
					if (!sp_char.test(UserPwd) && UserPwd != "") {
						_alert(1, "连接参数", "密码元素格式不正确", $("#UserPwd"));
						//$("#UserPwd").val("");
						return false;
					}
					connection.ServiceName = url;
					connection.ConnType = null;
					var Submit = $("#Submit").val();
					var json_a = UserName + '|' + UserPwd + '|' + Submit;
					connection.ConnParamValue = json_a;
					break;
				//HTTPs
				case "HTTPS":
					////////console.log("switchHTTP");
					var url = $("#httpsurl").val();
					if (url == "") {
						_alert(2, "连接参数", "请输入URL", $("#url"));
						return false;
					}
					var UserName = $("#httpsUserName").val();
					if (!sp_char.test(UserName) && UserName != "") {
						_alert(1, "连接参数", "账号元素格式不正确", $("#UserName"));
						//$("#UserName").val("");
						return false;
					}
					var UserPwd = $("#httpsUserPwd").val();
					if (!sp_char.test(UserPwd) && UserPwd != "") {
						_alert(1, "连接参数", "密码元素格式不正确", $("#UserPwd"));
						//$("#UserPwd").val("");
						return false;
					}
					connection.ServiceName = url;
					connection.ConnType = null;
					var Submit = $("#httpsSubmit").val();
					//Submit = '"' + Submit + '"';
					//UserName = '"' + UserName + '"';
					//UserPwd = '"' + UserPwd + '"';
					//var json_a = '{"UserName":' + UserName + ',"UserPwd":' + UserPwd + ',"Submit":' + Submit + '}';
					var json_a = UserName + '|' + UserPwd + '|' + Submit;
					connection.ConnParamValue = json_a;
					//connection.ConnParamValue = (JSON.parse(json_a));
					break;
				//ORACLE
				case "ORACLE":
					////////console.log("switchORACLE");
					//指定项必填
					var appoint = $("#appoint").children("option:selected").val();
					if (appoint == "0") {
						_alert(2, "连接参数", "请选择指定项", $("#appoint"));
						return false;
					}
					var s_n = $("#s_n").val();
					if (s_n == "") {
						_alert(2, "连接参数", "请输入实例名或服务名", $("#s_n"));
						//$("#s_n").val("");
						return false;
					} else if (!sp_char.test(s_n)) {
						_alert(1, "连接参数", "实例名或服务名格式不正确", $("#s_n"));
						//$("#s_n").val("");
						return false;
					}
					var conn_text = $("#conn").children("option:selected").text();
					if (conn_text == "未指定") {
						conn_text = null;
					}
					var appoint_text = $("#appoint").children("option:selected").text();
					////////console.log(appoint+appoint_text);
					connection.ConnParamValue = appoint_text;
					connection.ServiceName = s_n;
					connection.ConnType = conn_text;
					break;
				//RADMIN
				case "RADMIN":
					//认证方式：
					var authtype = $("#authtype").children("option:selected").text();
					if (authtype == "未指定") {
						authtype = null;
					}
					////////console.log("switchRADMIN");
					connection.ServiceName = null;
					connection.ConnType = authtype;
					connection.ConnParamValue = null;
					break;
				//MSSQL
				case "MSSQL":
					//实例名：
					var o_n = $("#o_n").val();
					if (o_n == "") {
						_alert(2, "连接参数", "请输入实例名", $("#o_n"));
						//$("#o_n").val("");
						return false;
					} else if (!sp_char.test(o_n)) {
						_alert(1, "连接参数", "实例名格式不正确", $("#o_n"));
						//$("#o_n").val("");
						return false;
					}
					//认证方式：
					var R_authtype = $("#R_authtype").children("option:selected").text();
					if (R_authtype == "未指定") {
						R_authtype = null;
					}
					connection.ServiceName = o_n;
					connection.ConnType = R_authtype;
					connection.ConnParamValue = null;
					break;
				//MYSQL 
				case "MYSQL":
					//数据库名：
					var sql_n = $("#sql_n").val();
					if (sql_n == "") {
						_alert(2, "连接参数", "请输入数据库名", $("#sql_n"));
						//$('#sql_n').val("");
						return false;
					} else if (!sp_char.test(sql_n)) {
						_alert(1, '连接参数', '数据库名格式不正确', $("#sql_n"));
						//$("#sql_n").val("");
						return false;
					}
					// var select_my=parseInt($('#select_my').val());
					connection.ServiceName = sql_n;
					// connection.ConnType = select_my;
					connection.ConnParamValue = null;
					break;
				//DB2
				case "DB2":
					//数据库名：
					var sql_n = $("#dbsql_n").val();
					if (sql_n == "") {
						_alert(2, "连接参数", "请输入数据库名", $("#sql_n"));
						//$('#sql_n').val("");
						return false;
					} else if (!sp_char.test(sql_n)) {
						_alert(1, '连接参数', '数据库名格式不正确', $("#sql_n"));
						//$("#sql_n").val("");
						return false;
					}
					connection.ServiceName = sql_n;
					connection.ConnType = null;
					connection.ConnParamValue = null;
					break;
				//SYBASE
				case "SYBASE":
					//实例名：
					var sy_o_n = $("#sy_o_n").val();
					if (sy_o_n == "") {
						_alert(2, "连接参数", "请输入实例名", $("#sy_o_n"));
						//$('#sy_o_n').val("");
						return false;
					} else if (!sp_char.test(sy_o_n)) {
						_alert(1, '连接参数', '实例名格式不正确', $("#sy_o_n"));
						//$("#sy_o_n").val("");
						return false;
					}
					connection.ServiceName = sy_o_n;
					connection.ConnType = null;
					connection.ConnParamValue = null;
					break;
				default:
					connection.ServiceName = null;
					connection.ConnType = null;
					connection.ConnParamValue = null;
			}
			connection.ProtocolId = parseInt(p_id);
			////////console.log(connection);
			var msstr = aceg(JSON.stringify(connection),se);
			$.ajax({
				url: '/bhost/add_connection',
				type: "POST",
				async: false,
				data: { a0: se, a1: JSON.stringify(connection), a10:"密码管理>自动改密",m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result == true) {
						$('.btn').blur();
						_alert(0,"连接参数","保存成功");
						con_d.close().remove();
						var conn_text = $('#ConnParamName').find('span').text();
						var sel_conid = $('#ConnParamName').data('value');
						if (sel_conid == 0 || sel_conid == undefined){
							var isexist = 0;
							var ProtocolName_id = $('#ProtocolName').data('value');
							if(connection.ProtocolId==ProtocolName_id){
								$("#ConnParamName").data('value',result.ConnParamId);
								$("#ConnParamName").find('span').text(connection.ConnParamName);
								isexist = 1;
							}
							if (isexist == 0){
								$("#ConnParamName").data('value','0');
								$("#ConnParamName").find('span').text('请选择');
							}
						}
						update_xSelect($('#ConnParamName'));
					} else {
						_alert(1, "连接参数", result.ErrMsg, $("#d_n_con"));
						return false;
					}
				}
			});
		}
		function update_xSelect($obj){
			//////console.log('update_xSelect');
			if($obj==0){
				$obj=$focusObj;
			}
			var id_value=$obj.data('value');
			var text_value=$('.xSelect-show-text',$obj).text();
			var id=$('.xSelect-show',$obj).data('id');
			$obj.empty().data('xSelect','');
			$('.'+id).remove();
			//////console.log(id_value);
			//////console.log(text_value);
			//////console.log($obj.attr('class').split(' ')[1]);
			switch ($obj.attr('class').split(' ')[1]) {
				case 'xSelect_ftp1':
					$.ajax({
						url: "/bhost/get_ftpserver",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val() },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								ftpconfig_data_all=result.info.data;
								var data = result.info;
								ftpserver = new Array();
								ftpserver[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
								$.each(data.data, function (i, item) {
									if(item.FTPServerId==0){
										return true;
									}
									ftpserver[item.FTPServerId] =(JSON.parse('{"value":'+item.FTPServerId+',"name":"'+item.FTPServerName+'","type":"'+(perm_1==2?'edit':'check')+'"}'));
								})
							} else {
								_alert(1, 'FTP服务器查询', result.ErrMsg);
								return false;
							}
						}
					});
					var ftpserver1=JSON.parse(JSON.stringify(ftpserver));
					var ftp2_id=$('.xSelect_ftp2').data('value');
					if(ftp2_id!=undefined &&  ftp2_id!=''){
						ftpserver1.splice(parseInt(ftp2_id),1);
					}
					for(i in ftpserver1){
						if(ftpserver1[i]==null){
							delete ftpserver1[i];
						}
					}
					xSelect_json={
						num:'1',
						width: 168,
						defaultText: '全局指定',
						items:ftpserver1,
						edit: function(item,obj){
							$('.'+$('.xSelect_ftp1 .xSelect-show').data('id')).hide();
							get_dialog_ftp(item,1);
						},
						check: function(item,obj){
							$('.'+$('.xSelect_ftp1 .xSelect-show').data('id')).hide();
							get_dialog_ftp(item,1);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
							update_xSelect($('.xSelect_ftp2'));
						}
					};
					if(perm_1==2){
						xSelect_json.num='2';
						xSelect_json.btn.push({
								'name':'新增',
								'event': function(items,obj){
									get_dialog_ftp(items,2);
								}
							});
					}
					$obj.xSelect(xSelect_json);
					break;
				case 'xSelect_ftp2':
					$.ajax({
						url: "/bhost/get_ftpserver",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val() },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								ftpconfig_data_all=result.info.data;
								var data = result.info;
								ftpserver = new Array();
								ftpserver[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
								$.each(data.data, function (i, item) {
									if(item.FTPServerId==0){
										return true;
									}
									ftpserver[item.FTPServerId] =(JSON.parse('{"value":'+item.FTPServerId+',"name":"'+item.FTPServerName+'","type":"'+(perm_1==2?'edit':'check')+'"}'));
								})
							} else {
								_alert(1, 'FTP服务器查询', result.ErrMsg);
								return false;
							}
						}
					});
					var ftpserver2=JSON.parse(JSON.stringify(ftpserver));
					var ftp1_id=$('.xSelect_ftp1').data('value');
					if(ftp1_id!=undefined && ftp1_id!=''){
						ftpserver2.splice(parseInt(ftp1_id),1);
					}
					for(i in ftpserver2){
						if(ftpserver2[i]==null){
							delete ftpserver2[i];
						}
					}
					xSelect_json={
						num:'1',
						width: 168,
						defaultText: '全局指定',
						items:ftpserver2,
						edit: function(item,obj){
							$('.'+$('.xSelect_ftp2 .xSelect-show').data('id')).hide();
							get_dialog_ftp(item,1);
						},
						check: function(item,obj){
							$('.'+$('.xSelect_ftp2 .xSelect-show').data('id')).hide();
							get_dialog_ftp(item,1);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
							update_xSelect($('.xSelect_ftp1'));
						}
					};
					if(perm_1==2){
						xSelect_json.num='2';
						xSelect_json.btn.push({
								'name':'新增',
								'event': function(items,obj){
									get_dialog_ftp(items,2);
								}
							});
					}
					$obj.xSelect(xSelect_json);
					break;
				case 'xSelect_stmp1':
					$.ajax({
						url: "/bhost/get_smtpconfig",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val() },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								var data = result.info;
								smtpconfig_data_all=result.info.data;
								smtpconfig=new Array();
								smtpconfig[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
								$.each(data.data, function (i, item) {
									if(item.SmtpConfigId==0){
										return true;
									}
									smtpconfig[item.SmtpConfigId]=(JSON.parse('{"value":'+item.SmtpConfigId+',"name":"'+item.SmtpConfigName+'","type":"'+(perm_1==2?'edit':'check')+'"}'));
								})
							} else {
								_alert(1, '邮件服务器查询', result.ErrMsg);
								return false;
							}
						}
					});
					var smtpconfig1=JSON.parse(JSON.stringify(smtpconfig));
					var stmp2_id=$('.xSelect_stmp2').data('value');
					if (stmp2_id!=undefined && stmp2_id!='') {
						smtpconfig1.splice(parseInt(stmp2_id),1);
					}
					for(i in smtpconfig1){
						if(smtpconfig1[i]==null){
							delete smtpconfig1[i];
						}
					}
					xSelect_json={
						num:'1',
						width: 168,
						defaultText: '全局指定',
						items:smtpconfig1,
						edit: function(item,obj){
							$('.'+$('.xSelect_stmp1 .xSelect-show').data('id')).hide();
							get_dialog_stmp(obj,1);
						},
						check: function(item,obj){
							$('.'+$('.xSelect_stmp1 .xSelect-show').data('id')).hide();
							get_dialog_stmp(obj,1);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
							update_xSelect($('.xSelect_stmp2'));
						}
					};
					if(perm_1==2){
						xSelect_json.num='2';
						xSelect_json.btn.push({
								'name':'新增',
								'event': function(items,obj){
									get_dialog_stmp(obj,2);
								}
							});
					}
					$obj.xSelect(xSelect_json);
					break;
				case 'ProtocolName':
					if (id_value==undefined)id_value=0;
					if (text_value==undefined || text_value=='')text_value='请选择';
					var protocol;
					var protocol_x;
					$.ajax({
						url: "/bhost/get_protocol_list",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val(),a1:1,a2:null,a3:null,a4:',,',a5:null },
						success: function (result) {
							var result = JSON.parse(result);
							// if (result.Result) {
								var data = result;
								protocol_data_all=result.data;
								protocol=new Array();
								protocol_x=new Array();
								$.each(data.data, function (i, item) {
									if(item.ProtocolId==0){
										return true;
									}
									protocol[item.ProtocolId]=(JSON.parse('{"value":'+item.ProtocolId+',"name":"'+item.ProtocolName+'","type":"'+(perm_host==2?'edit':'check')+'","port":"'+item.Port+'"}'));
									protocol_x.push(JSON.parse('{"value":'+item.ProtocolId+',"name":"'+item.ProtocolName+'","type":"'+(perm_host==2?'edit':'check')+'","port":"'+item.Port+'"}'));
								})
							// } else {
							// 	_alert(1, '协议', result.ErrMsg);
							// 	return false;
							// }
						}
					});
					xSelect_json={
						num:'1',
						width: 140,
						defaultText: '请选择',
						items:protocol_x,
						edit: function(item,obj){
							$('.'+$('.ProtocolName .xSelect-show').data('id')).hide();
							_editNode5(obj,1);
						},
						check: function(item,obj){
							$('.'+$('.ProtocolName .xSelect-show').data('id')).hide();
							_editNode5(obj,1);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
							var protocol_id=parseInt($(obj).find('span').data('value'));
							$('#scDCTab1 #Port').val(protocol[protocol_id].port);
							update_xSelect($('.ConnParamName'));
						}
					};
					if(perm_host==2){
						xSelect_json.num='2';
						xSelect_json.btn.push({
								'name':'新增',
								'event': function(items,obj){
									$(obj).parents('.xSelect-view').hide();
									_editNode5(obj,2);
								}
							});
					}
					$obj.xSelect(xSelect_json);
					break;
				case 'ConnParamName':
					if (id_value==undefined)
						id_value=0;
					if (text_value==undefined || text_value=='')
						text_value='请选择';
					var ProtocolName_value=$('#ProtocolName').data('value');
					var ConnParam;
					var pass=false;
					//////console.log(ProtocolName_value);
					if(ProtocolName_value!=0 && ProtocolName_value!=undefined){
						$.ajax({
							url:'/bhost/get_ConnParam_list',
							type: "post",
							async:false,
							cache:false,
							data: {a0:$("input[name=se]").val(),a1:ProtocolName_value},
							success: function(result) {
								var result = JSON.parse(result);
								// if (result.Result) {
									var data = result;
									ConnParam_data_all=result.data;
									ConnParam=new Array();
									$.each(data.data, function (i, item) {
										if(item.ConnParamId==0){
											text_value='请选择';
											return true;
										}else if(item.ConnParamId==id_value && !pass){
											text_value=item.ConnParamName;
											pass=true;
										}
										ConnParam.push(JSON.parse('{"value":'+item.ConnParamId+',"name":"'+item.ConnParamName+'","type":"'+(perm_host==2?'edit':'check')+'"}'));
									});
									if (!pass){
										id_value=0;
										text_value='请选择';
									}
								// } else {
								// 	_alert(1, '连接参数', result.ErrMsg);
								// 	return false;
								// }
							}
						});
					}else{
						ConnParam=new Array();
						id_value=0;
						text_value='请选择';
					}
					xSelect_json={
						num:'1',
						width: 140,
						defaultText: '请选择',
						items:ConnParam,
						edit: function(item,obj){
							$('.'+$('.ConnParamName .xSelect-show').data('id')).hide();
							_editNode6(obj,1);
						},
						check: function(item,obj){
							$('.'+$('.ConnParamName .xSelect-show').data('id')).hide();
							_editNode6(obj,1);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
						}
					};
					if(perm_host==2){
						xSelect_json.num='2';
						xSelect_json.btn.push({
								'name':'新增',
								'event': function(items,obj){
									$(obj).parents('.xSelect-view').hide();
									_editNode6(obj,2);
								}
							});
					}
					$obj.xSelect(xSelect_json);
					break;
				case 'xSelect_stmp2':
					$.ajax({
						url: "/bhost/get_smtpconfig",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val() },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								var data = result.info;
								smtpconfig_data_all=result.info.data;
								smtpconfig=new Array();
								smtpconfig[0] =(JSON.parse('{"value":0,"name":"全局指定","type":null}'));
								$.each(data.data, function (i, item) {
									if(item.SmtpConfigId==0){
										return true;
									}
									smtpconfig[item.SmtpConfigId]=(JSON.parse('{"value":'+item.SmtpConfigId+',"name":"'+item.SmtpConfigName+'","type":"'+(perm_1==2?'edit':'check')+'"}'));
								})
							} else {
								_alert(1, '邮件服务器查询', result.ErrMsg);
								return false;
							}
						}
					});
					var smtpconfig2=JSON.parse(JSON.stringify(smtpconfig));
					var smtp1_id=$('.xSelect_stmp1').data('value');
					if(smtp1_id!=undefined && smtp1_id!=''){
						smtpconfig2.splice(smtp1_id,1);
					}
					for(i in smtpconfig2){
						if(smtpconfig2[i]==null){
							delete smtpconfig2[i];
						}
					}
					xSelect_json={
						num:'1',
						width: 168,
						defaultText: '全局指定',
						items:smtpconfig2,
						edit: function(item,obj){
							$('.'+$('.xSelect_stmp2 .xSelect-show').data('id')).hide();
							get_dialog_stmp(obj,1);
						},
						check: function(item,obj){
							$('.'+$('.xSelect_stmp2 .xSelect-show').data('id')).hide();
							get_dialog_stmp(obj,1);
						},
						delete: function(item,obj){
						},
						btn:[
							
						],
						setval:function(item,obj){
							update_xSelect($('.xSelect_stmp1'));
						}
					};
					if(perm_1==2){
						xSelect_json.num='2';
						xSelect_json.btn.push({
								'name':'新增',
								'event': function(items,obj){
									get_dialog_stmp(obj,2);
								}
							});
					}
					$obj.xSelect(xSelect_json);
					break;
				case 'PwdModStrategy':
					var pwdmodstrategy_x=[];
					$.ajax({
						url: "/bhost/get_pwdmodstrategy",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val() },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								var data = result.info;
								pwdmodstrategy = new Array();
								pwdmodstrategy[0] = (JSON.parse('{"value":'+pwdmod_id+',"name":"请选择","type":null}'));
								pwdmodstrategy_x.push(JSON.parse('{"value":'+pwdmod_id+',"name":"请选择","type":null}'));
								$.each(data.data, function (i, item) {
									if(item.PwdModStrategyName.indexOf('#')>=0){
										return true;
									}
									pwdmodstrategy[item.PwdModStrategyId] = (JSON.parse('{"value":'+item.PwdModStrategyId+',"name":"'+item.PwdModStrategyName+'","type":'+(perm_pwd_mod==2?'"delete"':'null')+'}'));
									pwdmodstrategy_x.push(JSON.parse('{"value":'+item.PwdModStrategyId+',"name":"'+item.PwdModStrategyName+'","type":'+(perm_pwd_mod==2?'"delete"':'null')+'}'));
								});
							} else {
								_alert(1, '自动改密', result.ErrMsg);
								return false;
							}
						}
					});
					console.log(pwdmodstrategy_x);
					console.log(pwdmodstrategy_x[-1]);
					xSelect_json={
						num:'1',
						width: 168,
						defaultText: '请选择',
						items:pwdmodstrategy_x,
						edit: function(item,obj){
						},
						check: function(item,obj){
						},
						delete: function(item,obj){
							$('.'+$('#PwdModStrategy .xSelect-show').data('id')).hide();
							update_xSelect($('#PwdModStrategy'));
							var layer_value = '自动改密';
							$.ajax({
								url: '/bhost/find_mod_to_other_pwdauth',
								type: "POST",
								async: false,
								data: { a0: $("input[name=se]").val(), a1: document.frm_pwdauth_add.a.value, a2: item.value },
								success: function (result) {
									var result = JSON.parse(result);
									if (result.Result) {
										if (result.num > 0) {
											$('.btn').blur(); parent.layer.open({
												type: 1,
												title: layer_value,
												content: '<div class="layer-alert"><i class="alert warning"></i>该密码策略应用于其他计划，是否删除</div>',
												btn: ['确&nbsp;&nbsp;定', '取&nbsp;&nbsp;消'],
												btnAlign: 'c',
												closeBtn: false,
												skin: 'layer-custom',
												area: ['380px', '310px'],
												move: false,
												resize: false,
												yes: function (i) {
													parent.layer.close(i);
													if((parseInt($focusObj.data('value'))==item.value)){
														$focusObj.data('value',0);
														$('.xSelect-show-text',$focusObj).text('请选择');
													}
													_delNode(item);
													$(obj).fadeOut(function(){
														$(this).remove();
														Xselect._setPosition();
													});
													update_xSelect($('#PwdModStrategy'));
												}
											});
										} else {
											$('.btn').blur(); parent.layer.open({
												type: 1,
												title: layer_value,
												content: '<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
												btn: ['删&nbsp;&nbsp;除', '取&nbsp;&nbsp;消'],
												btnAlign: 'c',
												closeBtn: false,
												skin: 'layer-custom',
												area: ['380px', '310px'],
												move: false,
												resize: false,
												yes: function (i) {
													parent.layer.close(i);
													if((parseInt($focusObj.data('value'))==item.value)){
														$focusObj.data('value',0);
														$('.xSelect-show-text',$focusObj).text('请选择');
													}
													_delNode(item);
													$(obj).fadeOut(function(){
														$(this).remove();
														Xselect._setPosition();
													});
													update_xSelect($('#PwdModStrategy'));
												}
											});
										}
									}
								}
							});
						},
						btn:[
							
						],
						setval:function(item,obj){
							
							if(item.value==0){
								item.value=old_pwdmod_id;
							}
							if(item.value==0){
								pwd_clear();
								$('#PwdModStrategyName').hide();
								// _viewHTML('#userTreeh', 'UG');
								return false;
							}
							$.ajax({
								url: "/bhost/get_pwdmodstrategy",
								type: "POST",
								async: false,
								data: { a0: $("input[name=se]").val(),a1:item.value},
								success: function (result) {
									var result = JSON.parse(result);
									if (result.Result) {
										item_pwd = result.info.data[0];
										PwdModStrategy();
									} else {
										_alert(1, '自动改密', result.ErrMsg);
										return false;
									}
								}
							});
						}
					};
					if(perm_pwd_mod==2){
						xSelect_json.num='2';
						xSelect_json.btn.push({
								'name':'新增',
								'event': function(items,obj){
									_addNew2();
								}
							});
					}
					var Xselect=$('#PwdModStrategy').xSelect(xSelect_json);
					break;
			}
			$obj.data('value',id_value);
			$('.xSelect-show-text',$obj).text(text_value);
		}
		function _checkEvent1(obj) {
			if ($(obj).length == 0) return false;
			var _run1 = function () {
				_input = $(obj).parent().parent().siblings('input.zcheck');
				_ul = _input.siblings('ul');
				if (_input.length > 0 && (_ul.children('li').length > 0)) {
					$inp = _ul.children('li').children('input.zcheck');
					$($inp).each(function (i, item) {
						$parent = $(item).parent().parent().siblings('span.authtype').find('input');
						v = $($parent).prop("checked");
						$spanp = $(item).siblings('span.authtype');
						//如果发现父节点还是disabled
						if ($($parent).prop("disabled") == true) v = true;
						if (v == false) {
							$(item).prop("disabled", false);
							$(item).siblings('span.checkbox').removeClass("disabled");
							$spanp.find('input').prop("disabled", false);
							$spanp.find('span').removeClass("disabled");
							if ($spanp.length == 0) {
								_checkEvent2($(item).siblings('ul').children('li').children('input.zcheck'));
							}
							else {
								if ($(item).prop('checked') == false) $spanp.find('input').prop('checked', false).next('span').removeClass('checked');
								_checkEvent1($spanp.find('input'));
							}
						} else {
							$(item).prop("checked", true).prop("disabled", true);
							$(item).siblings('span.checkbox').addClass("disabled");
							$spanp.find('input').prop("disabled", true);
							$spanp.find('span').addClass("disabled");
							if ($spanp.length == 0) _checkEvent2($(item).siblings('ul').children('li').children('input.zcheck'));
							else _checkEvent1($spanp.find('input'));

						}
					})
				} else {
					return;
				}
			}
			_run1();
		}
		function bind_server_xSelect(){
			binding_ServerScope();
			var id_value=$('#server_text_zdp').data('value');
			if(id_value==undefined){
				id_value='-1';
			}
			if($('.xSelect-show-text',$('#server_text_zdp')).length==0){
				var text_value='请选择';
			}else{
				var text_value=$('.xSelect-show-text',$('#server_text_zdp')).text();
			}
			var id=$('.xSelect-show',$('#server_text_zdp')).data('id');
			$('#server_text_zdp').empty().data('xSelect','');
			$('.'+id).remove();
			var server_array = [];
			$.each(serdata.data,function(i,item){
				var select_data_json = {
					'value':1,
					'name':'admin2',
					'type':(perm_server==2?'edit':'check')
				};
				select_data_json.value = item.ServerScopeId;
				select_data_json.name = item.ServerScopeName;
				if($('div[id='+item.ServerScopeId+']').length==0){
					server_array.push(select_data_json);
				}
			});
			xSelect_json={
				num:'1',
				width: 162,
				defaultText: '请选择',
				items:server_array,
				module_type:'server',
				edit: function(item,obj){
					$(obj).parents('.xSelect-view').hide();
					_editNode(obj,1);
				},
				check: function(item,obj){
					$(obj).parents('.xSelect-view').hide();
					_editNode(obj,1);
				},
				btn:[
				],
				setval:function(item,obj){
					server_id=parseInt(obj.children('span').data('value'));
					change_ser_scope(obj);
					if ($("#define_select").val() == 1 && ($("#a_mix_select").val() == 1 || $("#s_mix_select").val() ==1)){
						change_server(obj);
					}
				}
			}
			if(perm_server==2){
				xSelect_json.num='2';
				xSelect_json.btn.push({
						'name':'新增',
						'event': function(items,obj){
							_editNode(obj,2);
						}
					});
			}
			$('#server_text_zdp').xSelect(xSelect_json);
			$('#server_text_zdp').data('value',id_value);
        	$('.xSelect-show-text',$('#server_text_zdp')).text(text_value);
		}
		function change_ser_scope(obj){
			var t = $(obj).find('span').data('value');
			if (serverid_list.indexOf(t) === -1 && t != undefined) {
				serverid_list.splice(0, 1, t);
			}
			if ($(obj).parent('ul').children('li').length == 2 && parseInt(t) >0) {
			}
		}
		function _checkEvent2(obj) {
			if (obj.length == 0) return false;
			var _run2 = function () {
				_input = $(obj).parent().parent().siblings('input.zcheck');;
				if ($(_input).prop('disabled') == true) {
					$(obj).prop("checked", true).prop("disabled", true);
					$(obj).siblings('span.checkbox').addClass("disabled");
				} else {
					$(obj).prop("disabled", false);
					$(obj).siblings('span.checkbox').removeClass("disabled");
				}
				_checkEvent2($(obj).siblings('ul').children('li').children('input.zcheck'));
			}

			_run2();
		}
		//
		function _authTypeTheme(obj) {
			$.each(obj, function (i, item) {
				var $_item = $(item);

				if ($_item.parent().children('span').length == 0) {
					$_item.after('<span class="checkbox"></span>');
				}

				var $s = $_item.next('span');
				var checked = $_item.prop('checked');
				var disabled = $_item.prop('disabled');

				if (checked) {
					$s.addClass('checked');
				} else {
					$s.removeClass('checked');
				}

				if (disabled) {
					$s.addClass('disabled');
				} else {
					$s.removeClass('disabled');
				}
			})
		}
		var server_set;
		//设备类型选择
		function change_device_type(obj) {
			$("#def_server").children('option').not('option:first').remove();
			$("#def_server").val('-1').trigger('change');
			$('#ProtocolName').data('value',0);
			$('#ProtocolName .xSelect-show-text').text('请选择');
			$('#ConnParamName').data('value',0);
			$('#ConnParamName .xSelect-show-text').text('请选择');
			$("#Port").val('');
			update_xSelect($('.ConnParamName'));
			server_set = [];
			if ($(obj).val() != '-1') {
				$.each(device_data.data, function (i, item) {
					if (item.DeviceTypeId == $(obj).val()) {
						server_set = item.ServiceSet;
						return false;
					}
				})
				$.each(server_set, function (i, item) {
					$("#def_server").append('<option value="' + item.DeviceServiceId + '">' + item.DeviceServiceName + '</option>');
				});
			}
		}
		//模板载入
		function show_def_server(obj) {
			if ($(obj).val() != '-1') {
				$.each(server_set, function (i, item) {
					if ($(obj).val() == item.DeviceServiceId) {
						$("#Port").val(item.Port);
						if(item.ProtocolId==null){
							$('#ProtocolName').data('value',0);
							$('#ProtocolName .xSelect-show-text').text('请选择');
						}else{
							$('#ProtocolName').data('value',item.ProtocolId);
							$('#ProtocolName .xSelect-show-text').text(item.ProtocolName);
						}
						if(item.ConnParamId==null){
							$('#ConnParamName').data('value',0);
							$('#ConnParamName .xSelect-show-text').text('请选择');
						}else{
							$('#ConnParamName').data('value',item.ConnParamId);
							$('#ConnParamName .xSelect-show-text').text(item.ConnParamName);
						}
					}
				})
				update_xSelect($('.ConnParamName'));
			} else {
				$("#Port").val('');
				$('#ProtocolName').data('value',0);
				$('#ProtocolName .xSelect-show-text').text('请选择');
				$('#ConnParamName').data('value',0);
				$('#ConnParamName .xSelect-show-text').text('请选择');
				update_xSelect($('.ConnParamName'));
			}
		}

		var device_data;
		//获取设备类型
		function get_server() {
			$.ajax({
				url: '/bhost/get_server',
				type: 'post',
				async: false,
				data: { a0: se },
				success: function (result) {
					device_data = JSON.parse(result);
					$.each(device_data.data, function (i, item) {
						$("#device_type").append('<option value="' + item.DeviceTypeId + '">' + item.DeviceTypeName + '</option>');
					})
				}
			});
			$('#device_type').select2({ minimumResultsForSearch: -1 });
		}


		var a_data;
		var a_index_all = [];
		//获取账号
		function get_account() {
			$.ajax({
				url: '/bhost/select_account_all',
				type: 'post',
				async: false,
				data: { a0: se, z11: -1 },
				success: function (result) {
					a_data = JSON.parse(result);
					$("#account_select").append('<option value="-1">请选择</option>');
					var AName;
					$.each(a_data.data, function (i, item) {
						if (item.AccountName == '*') {
							AName = '任意账号';
						} else if (item.AccountName == '-') {
							AName = '空账号';
						} else {
							AName = item.AccountName;
						}
						$("#account_select").append('<option value="' + item.AccountId + '">' + AName + '</option>');
						a_index_all.push(item.AccountId);
					});
				}
			});
			$('#account_select').select2({ minimumResultsForSearch: -1 });
		}
		var account_arry = ['-1'];
		//选择账号
		function change_account(obj) {
			var t = $(obj).children('option:selected').val();
			if (account_arry.indexOf(t) === -1 && t != undefined) {
				account_arry.splice(0, 1, t);
			}
			if ($(obj).children('option').length == 2 && t != '-1') {
				$(obj).parent().children('i.add').click();
				$(obj).parent().hide();
			}
		}
		//添加账号
		function _addaccount(obj) {
			var add = 0;
			var name2 = $(obj).parent().children('select').children('option:selected').val();
			var t = $(obj).parent().children('select').children('option[value=' + name2 + ']').text();
			if (name2 == undefined) {
				$(obj).parent().children('select').val('-1').trigger('change');
				return false;
			}
			if (name2 == -1) {
				_alert(2, "自动改密", "请选择账号");
				return;
			}
			account_arry.splice(0, 0, '-1');
			a_index_all.splice($.inArray(parseInt(name2), a_index_all), 1);
			var $c = $(obj).parent();
			var d = $('select>option:first', $c).val();
			$c.children('select').val(d);
			var $s = $('<li class="item" id="' + name2 + '"><input type="text" class="form-text" value="' + t + '" style="width:86px;" disabled="true"><i class="ctrl del" style="margin-left: 10px;" onclick="_del_mora(this,2)"></i></li>');
			$c.children('select').find('option[value=' + name2 + ']').remove();
			$c.after($s);
		}

		//删除账号
		function _del_mora(obj, type) {
			var $c = $(obj).parent();
			var id = $c.attr('id');
			var t = $(obj).siblings('input').val();
			var v, data, max;
			var min = 0;
			max = a_index_all.length - 1;
			$("#account_select").parent().show();
			account_arry.splice($.inArray(id, account_arry), 1);
			data = a_index_all;
			$p = $("#account_select");
			$c.remove();
			var index_1 = search_i(min, max, id, data);
			index_1 = parseInt(index_1);

			if (index_1 == -1) {
				index_1 = max;
				$p.append('<option value="' + id + '">' + t + '</option>');
			} else if (index_1 == -2) {
				index_1 = 0;
				$p.children('option').eq(0).after('<option value="' + id + '">' + t + '</option>');
			} else {
				$p.children('option[value=' + data[index_1] + ']').before('<option value="' + id + '">' + t + '</option>');
			}
			a_index_all.splice(index_1, 0, parseInt(id));
		}

		function search_i(min, max, id, data) {
			var mid, res;
			if (data[max] < id) {
				return -1;
			}
			if (data[min] > id) {
				return -2;
			}
			while (min <= max) {
				mid = parseInt((min + max) / 2);
				if (data[mid] > id) {
					max = mid - 1;
					res = mid;
				} else {
					min = mid + 1;
				}
			}
			return res;
		}

		var ServerIndex = -1;
		//添加服务
		function _addServer(type) {
			var ServiceSet = {
				"ProtocolName": 0,
				"ProtocolId": 0,
				"Port": 0,
				"ConnParamId": 0,
				"ConnParamName": 0
			}
			ProtocolId = $("#ProtocolName").data('value');
			ProtocolName=$('#ProtocolName .xSelect-show-text').text();
			if (ProtocolId == 0 || ProtocolId==undefined) {
				_alert(2, '添加服务', "请选择协议", $("#ProtocolName"));
				return false;
			}
			Port = $("#Port").val();
			if (Port == "") {
				_alert(2, '添加服务', "请输入协议端口", $("#Port"));
				return false;
			}

			if (parseInt(Port) <= 0 || parseInt(Port) >= 65535) {
				_alert(2, '添加服务', "协议端口在0~65535之间", $("#Port"));
				return false;
			}
			ConnParamId = $("#ConnParamName").data('value');
			ConnParamName = $('#ConnParamName .xSelect-show-text').text();
			if (ConnParamId == 0 || ConnParamId==undefined) {
				ConnParamId = null;
				ConnParamName=null;
			}
			var n = 0;
			$.each(DeviceType.ServiceSet, function (i, item) {
				if (item.ProtocolId == ProtocolId && item.Port == Port && item.ConnParamId == ConnParamId && ServerIndex != i) {
					n = 1;
					_alert(2, "服务", "已存在同名的服务");
					return false;
				}
			})
			if (n) return false;
			ServiceSet.ProtocolId = parseInt(ProtocolId);
			ServiceSet.ProtocolName = ProtocolName;
			ServiceSet.Port = parseInt($("#Port").val());
			ServiceSet.ConnParamId = ConnParamId;
			ServiceSet.ConnParamName = ConnParamName;

			if (type == "add") {
				DeviceType.ServiceSet.push(ServiceSet);
				$("#service_list1").append("<tr id=\"ser_" + DeviceType.ServiceSet.length + "\">"+
				"<td>" +$('#ProtocolName .xSelect-show-text').text() + "</td>"+
				"<td>" + Port + "</td>"+
				"<td>" + $('#ConnParamName .xSelect-show-text').text().replace("请选择", "") + "</td>"+
				"<td><div class=\"tab-ctr\">"+
				"<a style=\"width:8px;\" href=\"javascript:;\" class=\"edit\" onclick=\"_getDialog1('edit','" + DeviceType.ServiceSet.length + "')\"></a>"+
				"<a style=\"width:8px;\" href=\"javascript:;\" class=\"del\" onclick=\"_delServer('" + DeviceType.ServiceSet.length + "',this)\"></a></div></td></tr>");
			}
			else {
				DeviceType.ServiceSet[ServerIndex] = ServiceSet;
				tr_lenght = ServerIndex + 1
				$("#ser_" + (tr_lenght)).html("<td>" + $('#ProtocolName .xSelect-show-text').text() + "</td><td>" + Port + "</td><td>" + $('#ConnParamName .xSelect-show-text').text().replace("请选择", "") + "</td><td><div class=\"tab-ctr\"><a style=\"width:8px;\" href=\"javascript:;\" class=\"edit\" onclick=\"_getDialog1('edit','" + tr_lenght + "')\"></a><a style=\"width:8px;\" href=\"javascript:;\" class=\"del\" onclick=\"_delServer('" + tr_lenght + "',this)\"></a></div></td></td>");

			}
			$("#service_list1 tr").bind("dblclick", function () {
				$(this).children('td:last').find('.edit').click();
			});
			return true;
			// clear_serverdata();
		}
		//删除服务
		function _delServer(num, obj) {
			$('.btn').blur();
			parent.layer.open({
				type: 1,
				title: "自动改密",
				content: '<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
				btn: ['确&nbsp;&nbsp;定', '取&nbsp;&nbsp;消'],
				btnAlign: 'c',
				closeBtn: false,
				skin: 'layer-custom',
				area: ['380px', '310px'],
				move: false,
				resize: false,
				btn1: function (i) {
					parent.layer.close(i);
					var index = parseInt(num) - 1;
					DeviceType.ServiceSet.splice(index, 1);
					$(obj).parent().parent().parent().remove();
					// clear_serverdata();
				},
				btn2: function (i) {
					parent.layer.close(i);
				}
			});
		}

		//重置数据
		function clear_serverdata() {
			$("#def_server").children('option').not('option:first').remove();
			$("#device_type").val('-1').trigger('change');
			ServerIndex = -1;
			update_xSelect($("#ProtocolName"));
			update_xSelect($("#ConnParamName"));
		}

		//编辑 服务列表数据绑定
		function _editServer(num) {
			$('#device_module').hide();
			$('#module_server').hide();
			var index = parseInt(num) - 1;
			ServerIndex = index;
			//////console.log(DeviceType.ServiceSet[index]);
			if(DeviceType.ServiceSet[index].ProtocolId==null){
				$('#ProtocolName').data('value',0);
				$('#ProtocolName .xSelect-show-text').text('请选择');
			}else{
				$('#ProtocolName').data('value',DeviceType.ServiceSet[index].ProtocolId);
				$('#ProtocolName .xSelect-show-text').text(DeviceType.ServiceSet[index].ProtocolName);
			}
			if(DeviceType.ServiceSet[index].ConnParamId==null){
				$('#ConnParamName').data('value',0);
				$('#ConnParamName .xSelect-show-text').text('请选择');
			}else{
				$('#ConnParamName').data('value',DeviceType.ServiceSet[index].ConnParamId);
				$('#ConnParamName .xSelect-show-text').text(DeviceType.ServiceSet[index].ConnParamName);
			}
			$("#Port").val(DeviceType.ServiceSet[index].Port);
			update_xSelect($('.ConnParamName'));
		}

		var DeviceType = {
			"ServiceSet": [],
		}
		////服务 浮层
		function _getDialog1(type, num) {
			$('.btn-normal1').blur();
			clear_serverdata();
			var $dialogCont = $("#scDCTab1").show();
			var title = '服务';
			var d = dialog({
				title: title,
				content: $dialogCont,
				id: "scDCTab1",
				width: "600px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			if (type == 'edit') {
				_editServer(num);
			}else{
				$('#device_module').show();
                        	$('#module_server').show();
				$('#ProtocolName').data('value',0);
                                $('#ProtocolName .xSelect-show-text').text('请选择');
				$('#ConnParamName').data('value',0);
                                $('#ConnParamName .xSelect-show-text').text('请选择');				
				$("#Port").val('');
				update_xSelect($('.ConnParamName'));
			}
			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				d.close().remove();
			});
			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				if (_addServer(type) == false) return false;
				d.close().remove();
			})
		}


		function _typeSet(obj) {
			var i = $(obj).val();//1:范围指定，2:个别指定

			if (i == 1) {
				$('#pointSet2').show();
				$('#pointSet1').hide();
			} else if (i == 2) {
				$('#pointSet2').hide();
				$('#pointSet1').show();
			}

		}
		//已定义自定义
		function define_change(obj) {
			var v = $(obj).val();
			if (v == 1) { //已定义
				$("#mix_module").show();
				$("#custom_info").hide();
				$("#server_frame").show();
				$("#defined_info").show();
				change_server();
			} else if (v == 2) { //自定义
				$("#mix_module").hide();
				$("#defined_info").hide();
				$("#custom_info").show();
			}
		}
		//所有共有
		var all_flag = 1;
		function mix_change(obj) {
			var v = $(obj).val();
			if (v == 1) {
				all_flag = 1;
				change_server();
			} else {
				all_flag = 0;
				change_server();
			}
		}
		//添加服务器集合
		function addserver(obj) {
			var server_id = $(obj).prev('div').data('value');
			var v = $(obj).prev('div').find('span').text();
			var add = 0;
			var again_s = 0;
			if (server_id == undefined || server_id == '-1') {
				_alert(2, "自动改密", "请选择服务器集合");
				return false;
			}
			var $c = $('<div style="width:215px;margin-top: -10px;" class="item" id="' + server_id + '"/>');
			if (serverid_list.indexOf(server_id) === -1) {
				serverid_list.push(server_id);
			}
			$c.html('<input style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;vertical-align: middle;width: 144px;padding: 0 8px;" typr="text" class="form-text" disabled="true" value="' + v + '"><i class="ctrl del" onclick="_del(this)"></i>');
			$(obj).parent().after($c);
			$(obj).prev('div').find('span').text('请选择');
			$(obj).prev('div').data('value',-1);
			// if (again_s == 0) {
			// 	change_server();
			// }
			bind_server_xSelect();
		}
		//取服务器下账号和服务
		function change_server() {
			if ($("#a_mix_select").val() == 2 && $("#s_mix_select").val() == 2){//所有
				return false;
			}
			var auth_json = {
				"HostSet": [],
				"HGroupSet": [],
				"IPAddr": [],
				"ServerScopeSet": []
			};
			var add = 0;
			$("#service_list_a,#protocol,#param,#service_list2").empty();
			$("#check_all_a").iCheck('uncheck');
			$("#check_all").iCheck('uncheck');
			if ($("#server_text_zdp").data('value') != undefined && $("#server_text_zdp").data('value') != '-1'){
				var serverset = '{"ServerScopeId":' + $("#server_text_zdp").data('value') + '}';
				serverset = JSON.parse(serverset);
				auth_json.ServerScopeSet.push(serverset);
				add = 1;
			}
			$("#server_frame_list").children('div:not(:first)').each(function (i, item) {
				var id = $(item).attr('id');
				var serverset = '{"ServerScopeId":' + id + '}';
				serverset = JSON.parse(serverset);
				auth_json.ServerScopeSet.push(serverset);
				add = 1;
			});
			if (add == 1) {
				var accountid_temp = [];
				var ConnParamName = "";
				var set;
				var AuthServiceSet_temp = [];
				//获取所有的账号和服务
				if (all_flag == 1) {
					$.ajax({
						url: '/bhost/get_AccountProtocolForAuth',
						type: 'post',
						async: false,
						data: { a0: se, z1: JSON.stringify(auth_json) },
						success: function (result) {
							apdata = JSON.parse(result);
						}
					});
				} else {
					$.ajax({
						url: '/bhost/Get_SameAccountProtocolForAuth',
						type: 'post',
						async: false,
						data: { a0: se, z1: JSON.stringify(auth_json) },
						success: function (result) {
							if (result == "None") {
								add = 0;
							} else {
								apdata = JSON.parse(result);
							}
						}
					})
				}
			}
			if (add == 0) {
				$('#service_list_a').empty();
				$('#service_list2').empty();
				return false;
			}
			if ($("#a_mix_select").val() != 2){
				var account_table = "";
					$.each(apdata.AccountSet, function (i, item) {
						if (accountid_temp.indexOf(item.AccountId) === -1) {
							accountid_temp.push(item.AccountId);
						// if (item.AccountId == 5){
						// 	return true;
						// }
						account_table = account_table + '<tr><td width="50"><input type="checkbox" class="form-checkbox" id="ai' + item.AccountId + '"/></td><td>' + item.AccountName + '</td></tr>';
						}
					});
				$("#service_list_a").append(account_table);
			}
			if ($("#s_mix_select").val() != 2){
				var service_table = "";
				$.each(apdata.ServiceSet, function (i, item) {
					if (item.ConnParamName == null) {
						ConnParamName = "";
					} else {
						ConnParamName = item.ConnParamName;
					}
					set = item.ProtocolId + '-' + item.ConnParamId + '-' + item.Port;
					AuthServiceSet_temp.push(set);
					service_table = service_table + "<tr><td width=\"50\"><input type=\"checkbox\" class=\"form-checkbox\" id=\"" + item.ProtocolId + "-" + item.ConnParamId + "-" + item.Port + "\"/></td><td>" + item.ProtocolName + "</td><td>" + item.Port + "</td><td>" + ConnParamName + "</td></tr>";
				});
				$("#service_list2").append(service_table);
				
				$.each(accountid, function (i, item) {
					$("#ai" + item).iCheck('check');
				});
				$.each(AuthServiceSet, function (i, item) {
					$("#" + item).iCheck('check');
				})
				var isexist = 0;
				var A_C_TEMP = accountid.slice(0);
				$.each(A_C_TEMP, function (i, item) {
					$.each(accountid_temp, function (i1, item1) {
						if (item1 == item) {
							isexist = 1;
							return false;
						} else {
							isexist = 0;
						}
					});
					if (isexist == 1) {
						return true;
					} else {
						accountid.splice($.inArray(item, accountid), 1);
					}
				});
				var A_S_TEMP = AuthServiceSet.slice(0);
				$.each(A_S_TEMP, function (i, item) {
					$.each(AuthServiceSet_temp, function (i1, item1) {
						if (item1 == item) {
							isexist = 1;
							return false;
						} else {
							isexist = 0;
						}
					});
					if (isexist == 1) {
						return true;
					} else {
					AuthServiceSet.splice($.inArray(item, AuthServiceSet), 1);
					}
				});
			} else {
				accountid = [];
				AuthServiceSet = [];
			}
			_change_app();
			if ($("#defined_info").is(':visible') && $("#a_mix_select").val() == 1){
				var de_h = $("#defined_info").children(".h-catelog.h-catelog2.h-content2_temp:eq(0)").height();
				//////console.log("de_h:"+de_h);
				$("#service_list_a").parents('.c-table.tab-type2').css('max-height',de_h-109);
			}
			if ($("#defined_info").is(':visible') && $("#s_mix_select").val() == 1){
				var de_h = $("#defined_info").children(".h-catelog.h-catelog2.h-content2_temp:eq(1)").height();
				////////console.log("de_h:"+de_h);
				$("#service_list2").parents('.c-table.tab-type2').css('max-height',de_h-109);
			}
		}
		//绑定账号协议连接参数事件
		var AuthServiceSet = [];
		var accountid = [];
		function _change_app() {
			$('#account,#protocol,#param,#service_list2').find('input').iCheck({
				checkboxClass: 'icheckbox_minimal-blue',
				radioClass: 'iradio_minimal-blue',
				increaseArea: '0' // optional
			});
			$('#account').find('input').on('ifChanged', function () {
				var id = $(this).attr('id').substring(2);
				if ($(this).prop('checked')) {
					if ($.inArray(id, accountid) === -1) {
						accountid.push(id);
					}
				} else {
					if ($.inArray(id, accountid)>=0) {
						accountid.splice($.inArray(id, accountid), 1);
					}
				}
			});
			var list_len = $("#service_list2").find('input').length;
			$('#service_list2').find('input').on('ifChanged', function () {
				var id = $(this).attr('id');
				if ($(this).prop("checked")) {
					if (AuthServiceSet.indexOf(id) === -1) {
						AuthServiceSet.push(id);
					}
				} else {
					AuthServiceSet.splice($.inArray(id, AuthServiceSet), 1);
				}
				if ($("#service_list2").find('input:checked').length == list_len && list_len != 0) {
					$("#check_all").iCheck('check');
				} else {
					$("#check_all").iCheck('uncheck');
				}
			});
			var list_len_a = $("#service_list_a").find('input').length;
			$('#service_list_a').find('input').on('ifChanged', function () {
				var id = $(this).attr('id').substring(2);
				if ($(this).prop("checked")) {
					if ($.inArray(id, accountid) === -1) {
						accountid.push(id);
					}
				} else {
					if ($.inArray(id, accountid)>=0) {
						accountid.splice($.inArray(id, accountid), 1);
					}
				}
				if ($("#service_list_a").find('input:checked').length == list_len_a && list_len_a != 0) {
					$("#check_all_a").iCheck('check');
				} else {
					$("#check_all_a").iCheck('uncheck');
				}
			});
			$("#check_all_a").on("ifClicked", function () {
				if (!$(this).prop("checked")) {
					$("#service_list_a").find('input').iCheck('check');
				} else {
					$("#service_list_a").find('input').iCheck('uncheck');
				}
			});
			$("#service_list_a").children('tr').bind('click', function (e) {
				x = e.target;
				if (x.nodeName != 'A') {
					var input = $(this).find("input[type='checkbox']");
					if ($(input).prop('checked') == false) {
						$(input).iCheck('check');
					} else {
						$(input).iCheck('uncheck');
					}
				}
			});
			$("#service_list2").children('tr').bind('click', function (e) {
				x = e.target;
				if (x.nodeName != 'A') {
					var input = $(this).find("input[type='checkbox']");
					if ($(input).prop('checked') == false) {
						$(input).iCheck('check');
					} else {
						$(input).iCheck('uncheck');
					}
				}
			});
		}

		//删除服务器集合
		function _del(obj) {
			var id = $(obj).parent().attr('id');
			var $c = $(obj).parent();
			$c.remove();
			serverid_list.splice($.inArray(parseInt(id), serverid_list), 1);
			bind_server_xSelect();
			change_server();
			//}
		}

		var search_typeall_r_z = '';
		var search_typeall_new_z = '';
		//加入服务器集合搜索
		function _addFilter1(obj, type) {
			if(find_host_group_loading_z){
				_alert(2, "搜索", "正在搜索中，请先等待搜索完成");
				return false;
			}
			var id = $(obj).parent().children('select').children('option:selected').val();
			var v1 = $(obj).parent().children('select').children('option:selected').text();
			var v2 = $(obj).parent().children('input[type=text]').val().trim();
			if(id=='all'){
				v1='';
			}else{
				v1=v1+'-';
			}
			if (v2 == '') {
				$(obj).parent().children('input[type=text]').blur();
				_alert(2, '搜索', '请输入关键字', $(obj).parent().children('input[type=text]'));
				return false;
			} else {
				switch (id) {
					case 'hgname':
						var Reg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.\s]+$/;
						break;
					case 'hostname':
						var Reg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.\s]+$/;
						break;
					case 'ip':
						var Reg = /^[0-9\.\s]+$/;
						break;
				}
				if (id!='all' && !Reg.test(v2)) {
					$(obj).parent().children('input[type=text]').blur();
					_alert(1, '搜索', '关键字格式不正确', $(obj).parent().children('input[type=text]'));
					return false;
				}
				if (search_typeall_r_z.indexOf(id + '-' + v2 + '\t') >= 0) {
					$(obj).parent().children('input[type=text]').blur();
					_alert(2, '搜索', '相同的关键字已存在', $(obj).parent().children('input[type=text]'));
					return false;
				}
				if (type) {
					var type_value=(search_typeall_new_z==id + '-' + v2 + '\t');
					search_typeall_r_z = search_typeall_r_z + id + '-' + v2 + '\t';
					search_typeall_new_z = '';
					$('#filterWW_z>ul').append('<li style="height: 18px;"><span style = "display:none;">' + id + '-' + v2 + '</span><span class="ww" style="width:8em" title="' + v1 + v2 + '">' + v1 + v2 + '</span><i class="del" style="margin-top: 2px;" onclick="_delFilter1(this);"></i></li>')
					$("#server_text_z").val("");
					$('#server_text_z_check').hide();
					selView1(type_value);
				} else {
					if(search_typeall_new_z == id + '-' + v2 + '\t'){
						return false;
					}
					search_typeall_new_z = id + '-' + v2 + '\t';
					find_hostgroup_z();
				}

			}
		}
		//删除搜索
		function _delFilter1(obj) {
			if(find_host_group_loading_z){
				_alert(2, "搜索", "正在搜索中，请先等待搜索完成");
				return false;
			}
			var id = $(obj).parent().find("span");
			var ids = $(id).eq(0).text();
			search_typeall_r_z = search_typeall_r_z.replace(ids + '\t', '');
			var server_text_z = $('#server_text_z').val().trim();
			$(obj).parent().remove();
			selView1();
		}
		function _clearFilter1(obj,num) {
			if(find_host_group_loading_z){
				_alert(2, "搜索", "正在搜索中，请先等待搜索完成");
				return false;
			}
			if(num==1){
			$('#server_text_z').val('');
			$('#server_text_z_check').hide();
			search_typeall_new_z = '';
			selView1();
				return;
			}
			$('#clearFilter1').next().children('ul').empty();
			$('#server_text_z').val('');
			$('#clearFilter1').hide();
			$('#server_text_z_check').hide();
			search_typeall_new_z = '';
			search_typeall_r_z = '';
			selView1();
		}
		//显示搜索条件
		function selView1(type_value) {
			var $sel = $('#filterWW_z');
			var len = $('li', $sel).length;

			if (len == 0) {
				$sel.hide();
				$('#clearFilter1').hide();
			} else if (len == 1) {
				$("#filterWW_z").show();
				$('#clearFilter1').show();
				$('>span.ww', $sel).show();
				$sel.addClass('selector-multiple');
			} else {
				$("#filterWW_z").show();
				$('#clearFilter1').show();
				$('>span.ww', $sel).show();
				$sel.addClass('selector-multiple');
			}
			if(!type_value) find_hostgroup_z();
		}
		function click_h1(num, group_name) {
			//清空数据
			var i = 0;
			index = 0;
			flag_ajax_true = true;
			$(group_name).find('i.h-aicon-d').removeClass('h-aicon-d');
			$(group_name).find('ul').hide();
			$(group_name).find('li').hide();
			$(group_name).find('font.font-red').removeClass('font-red');
			$(group_name).find('span.h-name-red').removeClass('h-name-red');
			host_path_all[num] = [];
			old_path_all[num] = [];
			click_h0(num);
		}


		var mtr = null;
		var flag_ajax_true = false;
		String.prototype.ResetBlank=function(){
			var regEx = /\s+/g; 
			return this.replace(regEx, ' '); 
		};
		function click_h0(num) {
			server_find_json.type = type[num];
			server_find_json.id = edit_id[num]
			if (mtr != null) {
				mtr.abort();
				mtr = null;
			}
			flag_ajax_true = true;
			//条件没有的情况 直接返回
			if (num == 0) {
				var search_typeall_all = search_typeall_r + search_typeall_new;
				_getWait($('.waitTiphost'));
			} else if (num == 1) {
				var search_typeall_all = search_typeall_r_z + search_typeall_new_z;
				_getWait($('.waitTipserver'));
			}
			var find_host_arry = search_typeall_all.split('\t');
			for (var i = 0; i < find_host_arry.length; i++) {
				if (find_host_arry[i] == '') {
					find_host_arry.splice(i, 1);
					i--;
				}
			}
			if (search_typeall_all == "") {
				if (num == 0) {
					_waitDone($('.waitTiphost'), 0);
					$('#hosttree_div_c').scrollTop(0);
					tmp_list[num] = null;
					first_find_index[num] = null;
					$('#userTree').find('li').show();
					$("#userTree").find('i.h-aicon-d').removeClass('h-aicon-d');
					$("#userTree").find('ul').hide();
					$('#userTree').find('font.font-red').removeClass('font-red');
					$("#userTree").find('span.h-name-red').removeClass('h-name-red');
					find_host_group_loading=false;
					return false;
				} else if (num == 1) {
					_waitDone($('.waitTipserver'), 0);
					$('#hosttree_div').scrollTop(0);
					tmp_list[num] = null;
					first_find_index[num] = null;
					$('#userTree1').find('li').show();
					$("#userTree1").find('i.h-aicon-d').removeClass('h-aicon-d');
					$("#userTree1").find('ul').hide();
					$('#userTree1').find('font.font-red').removeClass('font-red');
					$("#userTree1").find('span.h-name-red').removeClass('h-name-red');
					find_host_group_loading_z=false;
					return false;
				}
				return false;
			}
			var hgname_str = '';
			var hostname_str = '';
			var hostip_str = '';
			var searchstring = '';
			var accountname='';
			var hostservicename='';
			$.each(find_host_arry,function(i,item){
				if(item==''){
					return true;
				}
				var item_id = item.indexOf('-');
				switch (item.substr(0, item_id)) {
					case 'hgname':
						hgname_str += (item.substr(item_id + 1, item.length) + '\n');
						break;
					case 'hostname':
						hostname_str += (item.substr(item_id + 1, item.length) + '\n');
						break;
					case 'accountname':
						accountname += (item.substr(item_id + 1, item.length) + '\n');
						break;
					case 'ip':
						hostip_str += (item.substr(item_id + 1, item.length) + '\n');
						break;
					case 'hostservicename':
						hostservicename += (item.substr(item_id + 1, item.length) + '\n');
						break;
					default:
						searchstring += (item.substr(item_id + 1, item.length) + '\n');
						break;
				}
			});
			hgname_str=(hgname_str.substr(0, hgname_str.length - 1)).ResetBlank();
			hostname_str=(hostname_str.substr(0, hostname_str.length - 1)).ResetBlank();
			hostip_str=(hostip_str.substr(0, hostip_str.length - 1)).ResetBlank();
			searchstring=(searchstring.substr(0, searchstring.length - 1)).ResetBlank();
			accountname=(accountname.substr(0, accountname.length - 1)).ResetBlank();
			hostservicename=(hostservicename.substr(0, hostservicename.length - 1)).ResetBlank();
			server_find_json.hgname = hgname_str;
			server_find_json.hostname = hostname_str;
			server_find_json.hostip = hostip_str;
			server_find_json.searchstring = searchstring;
			server_find_json.accountname = accountname;
			server_find_json.hostservicename = hostservicename;
			mtr = $.ajax({
				url: '/bhost/find_hostgroup',
				type: "POST",
				async: true,
				data: { a0: $("input[name=se]").val(), a1: JSON.stringify(server_find_json) },
				success: function (result) {
					ajax_find_host_doing = true;
					mtr = null;
					tmp_list[num] = null;
					var result = JSON.parse(result);
					if (result.Result) {
						tmp_list[num] = result.info.filter(function (params) {
							return params.Type != 3;
						});
						if (tmp_list[num].length != 0) {
							host_path_all[num] = JSON.parse(JSON.stringify(tmp_list[num]));
							//开始过滤
							flag_ajax_true = false;
							find_append(num);
						} else {
							flag_ajax_true = true;
							ajax_find_host_doing = false;
							if (num == 0) {
								$('#server_text').blur();
								_alert(0, '搜索', '无搜索结果', $("#server_text"));
								find_host_group_loading=false;
								_waitDone($('.waitTiphost'), 0);
							} else if (num == 1) {
								$("#server_text_z").blur();
								_alert(0, '搜索', '无搜索结果', $("#server_text_z"));
								find_host_group_loading_z=false;
								_waitDone($('.waitTipserver'), 0);
							}
							return false;
						}
					} else {
						flag_ajax_true = true;
						ajax_find_host_doing = false;
						if (num == 0) {
							_alert(1, '自动改密', result.ErrMsg);
							find_host_group_loading=false;
							_waitDone($('.waitTiphost'), 0);
						} else if (num == 1) {
							_alert(1, '服务器集合', result.ErrMsg);
							find_host_group_loading_z=false;
							_waitDone($('.waitTipserver'), 0);
						}
						return false;
					}
				}
			});
		}
		function _jScrollBar(scid) {
			var myBar = new MyScrollBar({
				selId:scid,
				hasX:true,
				hasY:false,
				width:6,
				// enterShow:false,
			})
		}
		function li_red_to_no_red(num,obj) {
			var red_input = $(obj).find('span.h-name-red');
			for (var im = 0; im < red_input.length; im++) {
				var item = red_input.eq(im);
				var Type=item.siblings('input').attr('id');
				//////console.log(Type);
				var pass = true;
				var item_name = item.siblings('input').attr('data-name');
				if(num==0){
					var find_host_arry = (search_typeall_r + search_typeall_new).split('\t');
				}else{
					var find_host_arry = (search_typeall_r_z + search_typeall_new_z).split('\t');
				}
				var $span_son_font=$('.h-name-son',item).find('font');
                if(Type.indexOf('HostId')<0){
                    var span_son_name=item_name.toLowerCase();
                }else{
                    var host_span_arr=item_name.split('\t');
                    var span_son_name=(host_span_arr[0]+'('+host_span_arr[1]+')').toLowerCase();
                }
				for (var jm = 0; jm < find_host_arry.length; jm++) {
					if (find_host_arry[jm] == '' || find_host_arry[jm] == undefined || find_host_arry[jm] == null) {
						continue;
					}
					var pass_one = false;
					//////console.log(find_host_arry[jm]);
					var jm_index_=find_host_arry[jm].indexOf('-');
					var search_arr = find_host_arry[jm].substr(jm_index_ + 1, find_host_arry[jm].length).split(' ');
					$.each(search_arr, function (i1, item1) {
						if(find_host_arry[jm].substr(0,jm_index_)=='hostname'){
							var Name=item_name.split('\t')[0];
							if (Type.indexOf('HostId')<0){
								return false;
							}
						}else if(find_host_arry[jm].substr(0,jm_index_)=='ip'){
							var Name=item_name.split('\t')[1];
							if (Type.indexOf('HostId')<0){
								return false;
							}
						}else if(find_host_arry[jm].substr(0,jm_index_)=='hgname'){
							var Name=item_name;
							if (Type.indexOf('HGId')<0){
								return false;
							}
						}else if(find_host_arry[jm].substr(0,jm_index_)=='accountname'){
							var Name=item_name;
							if (Type.indexOf('PasswordAuthId')<0){
								return false;
							}
						}else{
							var Name=item_name;
						}
						//////console.log(coverString(item1, Name));
						if (coverString(item1, Name)) {
							item1=item1.toLowerCase();
                            if(find_host_arry[jm].substr(0, jm_index_) == 'hostname'){
                                var index_start=span_son_name.indexOf('(');
                                var index_true=span_son_name.indexOf(item1,index_start);
                                if(index_true>=0){
                                    for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
                                        $span_son_font.eq(i_red_span).addClass('font-red');
                                    }
                                }
                            }else{
                                var index_true=span_son_name.indexOf(item1);
                                if(index_true>=0){
                                    for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
                                        $span_son_font.eq(i_red_span).addClass('font-red');
                                    }
                                }
                            }
							pass_one = true;
							return false;
						}
					});
					if (pass_one == false) {
						pass = false;
						break;
					}
				}
				if (pass == false) {
					item.removeClass('h-name-red');
					$span_son_font.removeClass('font-red');
				} else {
				}
			}
		}
		function li_hide_while_no_red(obj,num){
			var li_visible=$(obj).children('li');
			for(var i=num;i<num+100;i++){
				if(i>=li_visible.length){
					break;
				}
				var item=li_visible.eq(i);
				var span_red_time=$(item).find('span.h-name-red').length;
				//////console.log('span_red_time:'+span_red_time);
				if(span_red_time==0){
					$(item).hide();
					$(item).find('font.font-red').removeClass('font-red');
				}else if(span_red_time>0){
					$(item).show();
					var children_red_time=$(item).children('span.h-name-red').length;
					if(children_red_time>0 && span_red_time==1){
						$(item).find('i.h-aicon-d').removeClass('h-aicon-d');
						$(item).find('ul').hide();
						$(item).find('li').show();
					}
					else if(children_red_time>0 && span_red_time>1){
						$(item).find('li').show();
					}
					else if (children_red_time==0) {
						var $children_ul=$(item).children('ul');
						li_hide_while_no_red($children_ul,0);
					}
				}
			}
			if(i<li_visible.length){
				setTimeout(function () {li_hide_while_no_red(obj,i);},1);
			}
		}
		function scrollTop_check_server1(num, group_name) {
			var i = 0;
			var index_i = 0;
			// li_red_to_no_red(num,group_name);
			li_hide_while_no_red(group_name, 0);
			if ($(group_name).find('span.h-name-red').length == 0) {
				if (num == 0) {
					$("#server_text").blur();
					_alert(0, '搜索', '无搜索结果', $("#server_text"));
					_waitDone($('.waitTiphost'), 0);
					find_host_group_loading=false;
				} else {
					$("#server_text_z").blur();
					_alert(0, '搜索', '无搜索结果', $("#server_text_z"));
					_waitDone($('.waitTipserver'), 0);
					find_host_group_loading_z=false;
				}
				flag_ajax_true = true;
				ajax_find_host_doing = false;
				return false;
			}

			ajax_find_host_doing = false;
			flag_ajax_true = true;
			if (num == 0) {
				$('#hosttree_div_c').scrollTop($(group_name).find('span.h-name-red').eq(0).offset().top - 200);
				_waitDone($('.waitTiphost'), 3000);
				find_host_group_loading=false;
			} else {
				$('#hosttree_div').scrollTop($(group_name).find('span.h-name-red').eq(0).offset().top - 200);
				_waitDone($('.waitTipserver'), 3000);
				find_host_group_loading_z=false;
			}
			old_path_all[num] = new Array();
		}
		function ajax_host(num, group_name) {
			ajax_flag = true;
			if (ajax_data.length == 0) return;
			$.ajax({
				url: '/bhost/get_hosts',
				type: 'post',
				cache: false,
				async: true,
				data: { a0: $("input[name=se]").val(), z1: ajax_data.join(",") },
				beforeSend: function (xmlHttp) {
					xmlHttp.setRequestHeader("If-Modified-Since", "0");
					xmlHttp.setRequestHeader("Cache-Control", "no-cache");
				},
				success: function (result) {
					if (ajax_data.length == 0) return;
					results = JSON.parse(result);
					//ajax_data 排序
					ajax_data.sort(AscSort);
					$(results.info).each(function (i, item) {
						var adata = item;
						var hgid = ajax_data[i].split(':')[0];
						//改变样式
						$(group_name + '#HostId-' + hgid + '-' + adata.HostId).prev('i').addClass('h-aicon-d');
						obj = $(group_name + '#HostId-' + hgid + '-' + adata.HostId).siblings('ul');

						$(obj).empty().show();
						var v = 2, d;
						var $input = $(group_name + '#HostId-' + hgid + '-' + adata.HostId).siblings('span.checkbox');
						if ($input.length == 0) return true;
						if ($(group_name + '#HostId-' + hgid + '-' + adata.HostId).siblings('span.authtype').find('input').is(':checked')) {
							d = 0;
						} else {
							d = 1;
						}
						if ($input.attr('class').indexOf('disabled') > 0) {
							d = 0;
						}
						var c = $input.attr('class');
						if (c.indexOf('checked') > 0) {
							v = 1;
						} else if (c == 'checkbox') {
							v = 0;
						}

						var flag_change = false;
						var _loadfirst = $(obj).siblings('input.zcheck').attr("data-loadfirst");
						var _loadlast = $(obj).siblings('input.zcheck').attr("data-loadlast");
						var parents_aid = $(obj).siblings('input.zcheck').attr('id').split('-');
						var parents_id = parents_aid[2];
						var parentss_id = parents_aid[1];
						//判断 父节点是否状态改变

						var loadfirst = 0;
						var loadlast = 0;

						if (_loadfirst == _loadlast) {
							if (_loadlast == 2) {
								loadfirst = 2;
								loadlast = 2;
							} else if (_loadlast == 1) {
								flag_change = true;
							}
						} else {
							if (_loadlast == 2) {
								loadlast = 2;
							}
							if (_loadfirst == 2) {
								loadfirst = 2;
							}
						}
						$.each(adata.AccountSet, function (i, item) {
							if(item.HostAccount==null || item.HostAccount.AccountName=='SSO' || item.PasswordType==0 ||item.PasswordType==3){
								return true;
							}
							var $H = $('<li></li>');
							var class_flag = 0;
							var PasswordAuth_str = '';
							var PasswordAuth_str_title='';
							var HostServiceSet_str = item.HostServiceSet.filter(function (params) {
								return (params.ProtocolName == 'RDP' || params.ProtocolName == 'SSH' || params.ProtocolName == 'RLOGIN' || params.ProtocolName == 'TELNET' || params.ProtocolName == 'MYSQL' || params.ProtocolName == 'ORACLE' || params.ProtocolName == 'MSSQL' || params.ProtocolName == 'SYBASE' || params.ProtocolName == 'DB2');
							}).map(function (params) {
								return params.ProtocolName;
							});
							HostServiceSet_str=method1(HostServiceSet_str);
							if (HostServiceSet_str.length == 0) {
								// PasswordAuth_str = item.HostAccount.AccountName;
								return true;
							} else {
								// PasswordAuth_str = autoAddEllipsis(item.HostAccount.AccountName, '12') + '(' + HostServiceSet_str.join('，') + ')';
								PasswordAuth_str = item.HostAccount.AccountName+ '(' + HostServiceSet_str.join('，') + ')';
								PasswordAuth_str_title=item.HostAccount.AccountName + '(' + HostServiceSet_str.join('，') + ')';
							}
							if (loadlast == 2) {
								$H.html('<i class="h-blank"/>'+
								'<input type="checkbox" checked="checked" id="PasswordAuthId-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" value="' + item.PasswordAuthId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=2 data-name="' + item.HostAccount.AccountName + '">'+
								'<i class="h-eicon h-eicon-a"></i>'+
								'<span class="h-name h-name2" id="spanHG-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" style="width: 12em;" title="'+PasswordAuth_str_title+'">' + 
								'<span class="h-name-son" style="">' + 
									PasswordAuth_str.split('').map(function (params) {
										return '<font>'+params+'</font>'    
									}).join('') + 
								'</span>'+
								'</span>');
							} else {
								$H.html('<i class="h-blank"/>'+
								'<input type="checkbox" id="PasswordAuthId-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" value="' + item.PasswordAuthId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=2 data-name="' + item.HostAccount.AccountName + '">'+
								'<i class="h-eicon h-eicon-a"></i>'+
								'<span class="h-name h-name2" id="spanHG-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" style="width: 12em;" title="'+PasswordAuth_str_title+'">' + 
								'<span class="h-name-son" style="">' + 
									PasswordAuth_str.split('').map(function (params) {
										return '<font>'+params+'</font>'    
									}).join('') + 
								'</span>'+
								'</span>');
							}
							$(obj).append($H);
						});
						if (flag_change) {
							if (pwdauth.PasswordAuthSet != null) {
								var ser_flag = 0;
								var serid_flag = 0;
								var first_serid = 1;
								if (v != 0) {
									$.each(pwdauth.PasswordAuthSet, function (i1, item1) {
										$(group_name + 'input[value=' + item.PasswordAuthId + ']').attr('checked', true);
										$(group_name + 'input[value=' + item.PasswordAuthId + ']').next('span').attr("class", "checkbox checked");
										$(group_name + 'input[value=' + item.PasswordAuthId + ']').attr('data-loadfirst', 2);
										$(group_name + 'input[value=' + item.PasswordAuthId + ']').attr('data-loadlast', 2);
									})
								}
							}
						}


						if (d == 0) {
							$(obj).find('input').prop('disabled', true);
							if ($(obj).siblings('span.authtype').find('input').length > 0) {
								if ($(obj).siblings('span.authtype').find('input').next('span').attr('class').indexOf('checked') != -1 || $(obj).siblings('input').prop('disabled')) {

								} else {
									$(obj).find('input').each(function () {
										$(this).attr('disabled', false);
										$(this).next('span.checkbox').removeClass('disabled');
									});
								}
							}
						}

						_checkView_host(obj);
					})

					//50个结束 继续调用 过滤信息
					if (host_path_all[num].length == 0) {
						scrollTop_check_server1();
					} else {
					}
					ajax_flag = false;
					ajax_data = [];
					return true;
				}
			})
		}
		function AscSort(a, b) {
			a = parseInt(a.split(':')[1]);
			b = parseInt(b.split(':')[1]);
			return a - b;
		}
		var MAX_AJAX = 50;
		var ajax_flag = false;
		var ajax_data = [];
		var timeout = [];
		function red_to_font(obj,num){
			if (num == 0) {
				var search_typeall_all = search_typeall_r + search_typeall_new;
				_getWait($('.waitTiphost'));
			} else if (num == 1) {
				var search_typeall_all = search_typeall_r_z + search_typeall_new_z;
				_getWait($('.waitTipserver'));
			}
			var find_host_arry = search_typeall_all.split('\t');
			for (var i = 0; i < find_host_arry.length; i++) {
				if (find_host_arry[i] == '') {
					find_host_arry.splice(i, 1);
					i--;
				}
			}
			//console.log(obj);
			var item=$(obj).siblings('span.h-name');
			var item_name = item.siblings('input').attr('data-name');
			var Type = item.siblings('input').attr('id');
			var $span_son_font=$('.h-name-son',item).find('font');
			//console.log(Type);
			if(Type.indexOf('HostId')<0){
				var span_son_name=item_name.toLowerCase();
			}else{
				var host_span_arr=item_name.split('\t');
				var span_son_name=(host_span_arr[0]+'('+host_span_arr[1]+')').toLowerCase();
			}
			for (var jm = 0; jm < find_host_arry.length; jm++) {
				var pass_one = false;
				var jm_index_ = find_host_arry[jm].indexOf('-');
				var search_arr = find_host_arry[jm].substr(jm_index_ + 1, find_host_arry[jm].length).split(' ');
				$.each(search_arr, function (i1, item1) {
					if(item1==''){
						return true;
					}
						if (find_host_arry[jm].substr(0, jm_index_) == 'hgname'){
							var Name = item_name;
							if(Type.indexOf('HGId')<0){
								return true;
							}
						}else if (find_host_arry[jm].substr(0, jm_index_) == 'hostname') {
							var Name = item_name.split('\t')[1];
							if(Type.indexOf('HostId')<0){
								return true;
							}
						} else if (find_host_arry[jm].substr(0, jm_index_) == 'ip'){
							var Name = item_name.split('\t')[0];
							if(Type.indexOf('HostId')<0){
								return true;
							}
						}else if (find_host_arry[jm].substr(0, jm_index_) == '服务'){
							var Name = item_name;
							if(Type.indexOf('nodes')<0){
								return true;
							}
						}else if (find_host_arry[jm].substr(0, jm_index_) == 'accountname'){
							var Name = item_name;
							if(Type.indexOf('PasswordAuthId')<0){
								return true;
							}
						}else{
							var Name = item_name;
						}
					if (coverString(item1, Name)) {
						item1=item1.toLowerCase();
						if(find_host_arry[jm].substr(0, jm_index_) == 'hostname'){
							var index_start=span_son_name.indexOf('(');
							var index_true=span_son_name.indexOf(item1,index_start);
							if(index_true>=0){
								for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
									$span_son_font.eq(i_red_span).addClass('font-red');
								}
							}
						}else{
							var index_true=span_son_name.indexOf(item1);
							if(index_true>=0){
								for(var i_red_span=index_true;i_red_span<index_true+item1.length;i_red_span++){
									$span_son_font.eq(i_red_span).addClass('font-red');
								}
							}
						}
					}
				});
			}
		}
		function find_append(num) {
			if (num == 0) {
				var group_name = '#userTree ';
			} else if (num == 1) {
				var group_name = '#userTree1 ';
			}
			var i = 0;
			var index_f = 0;
			ajax_data = [];
			ajax_flag = false;
			var t_do1;
			function _do1() {
				clearTimeout(t_do1);
				for (i = index_f; i < index_f + 50; i++) {
					if (ajax_flag == true) {
						t_do1 = setTimeout(function () { _do1(); }, 1);
						return false;
					}
					if (i >= host_path_all[num].length) {    //
						if (host_path_all[num].length == 0) {
							//过滤结束 开始标红
							scrollTop_check_server1(num, group_name);
							return false;
						} else {
							if (ajax_data.length > 0) ajax_host(num, group_name);
							index_f = 0;
							t_do1 = setTimeout(function () { _do1(); }, 1);
							return false;
						}
					}
					if((host_path_all[num][i].Type == 5 && host_path_all[num][i].Name=='SSO') || host_path_all[num][i].Type == 3){
						host_path_all[num].splice(i, 1);
						continue;
					}	
					var Path_array = host_path_all[num][i].Path.split('/');
					var len = Path_array.length;
					if (len == 2) {//主机层
						//数据未完全展开 留在 host_path_all，下次继续执行
						if ($(group_name + '#HGId-' + host_path_all[num][i].Id).length == 0) continue;//
						$(group_name + '#HGId-' + host_path_all[num][i].Id).siblings('span.h-name').addClass('h-name-red');
						red_to_font($(group_name + '#HGId-' + host_path_all[num][i].Id),num);
						$(group_name + '#HGId-' + host_path_all[num][i].Id).parent('li').show();
						$(group_name + '#HGId-' + host_path_all[num][i].Id).siblings('ul').find('li').show();
					} else {
						if (host_path_all[num][i].Type == 5) {
							for (var j = 1; j < len; j++) {
								var id = Path_array[j].split(',')[1];
								s = 0;
								if (j == len - 1) { //主机层
									//数据正在展开 留在 host_path_all，下次继续执行
									if (flag_loading == true) {
										s = 1;
										break;
									}
									//数据未完全展开 留在 host_path_all，下次继续执行
									if ($(group_name + '#HostId-' + Path_array[j - 1].split(',')[1] + '-' + id).length == 0) {
										s = 1;
										break;//
									}
									$(group_name + '#HostId-' + Path_array[j - 1].split(',')[1] + '-' + id).parent('li').show();
									red_to_font($(group_name + '#HostId-' + Path_array[j - 1].split(',')[1] + '-' + id),num);
									$i_item = $(group_name + '#HostId-' + Path_array[j - 1].split(',')[1] + '-' + id).prev('i');
									if ($i_item.attr('class') == "h-blank") { //
										host_path_all[num].splice(i, 1);
										s = 1;
										break;//
									}

									if (push_hid[num].indexOf((Path_array[j - 1].split(',')[1] + ':' + id + ':true')) != -1) {
										s = 1;
										break;
									}
									if (push_hid[num].indexOf((Path_array[j - 1].split(',')[1] + ':' + id + ':false')) != -1) {
										s = 1;
										break;
									}
									if ($(group_name + '#HostId-' + Path_array[j - 1].split(',')[1] + '-' + id).siblings('ul').children('li').length == 0) {
										// filter_flag_append[num] = true;
										if (ajax_data.length > MAX_AJAX) {
											ajax_host(num, group_name);
											t_do1 = setTimeout(function () { _do1(); }, 1);
											return false;
										} else {
											hg_id = Path_array[j - 1].split(',')[1];
											inv = ajax_data.indexOf(hg_id + ":" + id);
											if (inv < 0) ajax_data.push(hg_id + ":" + id); //没展开的主机 放入ajax_data									
											if (ajax_data.length == MAX_AJAX) {
												ajax_host(num, group_name);
												t_do1 = setTimeout(function () { _do1(); }, 1);
												return false;
											} else {
											}
										}
									} else {
										if (($i_item.attr('class').indexOf('h-aicon-d')) === -1) {
											$i_item.trigger('click');
										}
									}

								} else { //主机组层	
									if ($(group_name + '#HGId-' + id).length == 0) {
										s = 1
										break;//
									}
									if (flag_loading == true) {
										s = 1;
										break;
									}
									$(group_name + '#HGId-' + id).parent('li').show();
									red_to_font($(group_name + '#HGId-' + id),num);
									$i_item = $(group_name + '#HGId-' + id).prev('i');
									//发现主机或者组 其实下面没数据，跳过该条数据
									if ($i_item.attr('class') == "h-blank") { //
										host_path_all[num].splice(i, 1);
										s = 1;
										break;
									}
									if (($i_item.attr('class').indexOf('h-aicon-d')) === -1) {
										filter_flag_append[num] = true;
										$i_item.trigger('click');
									}

								}
							}
							if (s) continue;
							var s = 0;
							if (host_path_all[num][i].Type == 5) {
								if ($i_item.siblings('ul').find('input').length == 0) continue;
								$i_item.parent('li').show();
								if (($i_item.attr('class').indexOf('h-aicon-d')) === -1) {
									filter_flag_append[num] = true;
									$i_item.trigger('click');
								}
								var hg_id=Path_array[j-2].split(',')[1];
								var h_id = Path_array[j - 1].split(',')[1];
								//console.log(group_name + '#HostId-' + hg_id + '-' + h_id+':'+host_path_all[num][i].Id);
								var $PasswordAuth_input=$(group_name + '#HostId-' + hg_id + '-' + h_id).siblings('ul').find('input[value='+host_path_all[num][i].Id+']');
								if($PasswordAuth_input.length==0){
									host_path_all[num].splice(i, 1);
									continue
								}
								$PasswordAuth_input.parent('li').show();
								red_to_font($PasswordAuth_input,num);
								$PasswordAuth_input.siblings('span.h-name').addClass('h-name-red');
								$PasswordAuth_input.siblings('ul').find('li').show();
							}
						} 
						else {
							s = 0;
							for (var j = 1; j < len - 1; j++) {
								var id = Path_array[j].split(',')[1];
								if ($(group_name + '#HGId-' + id).length == 0) {
									s = 1;
									break;//
								}
								if (flag_loading == true) {
									s = 1;
									break;
								}
								//show
								$(group_name + '#HGId-' + id).parent('li').show();
								red_to_font($(group_name + '#HGId-' + id),num);
								$i_item = $(group_name + '#HGId-' + id).prev('i');

								if ($i_item.attr('class') == "h-blank") { //
									host_path_all[num].splice(i, 1);
									s = 1;
									break;//
								}
								if (push_hgid[num].indexOf(Path_array[j - 1].split(',')[1] + ':true') != -1) {
									continue;
								}
								if (push_hgid[num].indexOf(Path_array[j - 1].split(',')[1] + ':false') != -1) {
									continue;
								}
								if ($(group_name + '#HGId-' + id).length > 0) {
									if (($i_item.attr('class').indexOf('h-aicon-d')) == -1) {
										filter_flag_append[num] = true;
										$i_item.trigger('click');
									}
								}
							}
							if (s) continue;
							if (host_path_all[num][i].Type == 1) {
								var $li_item_hg = $(group_name + '#HGId-' + host_path_all[num][i].Id);
								if ($li_item_hg.length == 0) {
									continue;
								}
								$li_item_hg.siblings('span.h-name').addClass('h-name-red');
								red_to_font($li_item_hg,num);
								$li_item_hg.siblings('span.h-name').parent('li').show();
								$li_item_hg.siblings('span.h-name').siblings('ul').find('li').show();
							} else if (host_path_all[num][i].Type == 2) {
								var $li_item_host = $(group_name + '#HostId-' + Path_array[j - 1].split(',')[1] + '-' + host_path_all[num][i].Id);
								if ($li_item_host.length == 0) {
									continue;
								}
								$li_item_host.siblings('span.h-name').addClass('h-name-red');
								red_to_font($li_item_host,num);
								$li_item_host.siblings('span.h-name').parent('li').show();
								$li_item_host.siblings('span.h-name').siblings('ul').find('li').show();
							}
						}
					}
					//数据展开后 从host_path_all删除掉，并且放在old_path_all，为标红和定位准备
					old_path_all[num].push(host_path_all[num][i]);
					host_path_all[num].splice(i, 1);

				}
				index_f = i;
				get_msg();
				t_do1 = setTimeout(function () { _do1(); }, 1);
			}
			_do1();
		}
		var global_time=Date.parse(new Date())/1000;
		function get_msg() {
			var n = 0;
			$.ajax({
				url: '/bhost/get_msg',
				type: "post",
				async: false,
				data: { a0: se },
				success: function (result) {
					var result = JSON.parse(result);
					global_time = Date.parse(new Date())/1000;	
					if (result.Result == false) {
						if (result.info.indexOf('系统异常') >= 0 || result.info.indexOf('非法访问') >= 0 || result.info.indexOf('系统超时') >= 0) {
							_alert(2, '系统', result.info);
						} else {
							_alert(2, '系统', result.info);
						}
					}
					else {
					}
				}
			});
			if (n) return false;
		}
		var data_array_Path_z = null;
		var first_find_index = new Array();
		first_find_index[0] = null;
		first_find_index[1] = null;
		first_find_index[2] = null;
		var tmp_list = new Array();
		tmp_list[0] = new Array();
		tmp_list[1] = new Array();
		tmp_list[2] = new Array();
		var ajax_find_host_doing = false;
		var find_host_group_loading_z=false;
		function find_hostgroup_z() {
			find_host_group_loading_z=true;
			_getWait($(".waitTipserver"));
			var search_typeall_all = search_typeall_r_z + search_typeall_new_z;
			var find_host_arry = search_typeall_all.split('\t');
			for (var i = 0; i < find_host_arry.length; i++) {
				if (find_host_arry[i] == '') {
					find_host_arry.splice(i, 1);
					i--;
				}
			}
			$('#hosttree_div').scrollTop(0);
			//先清空之前的过滤信息 
			click_h1(1, '#userTree1 ');
			return true;
		}

		function red_to_no_red_and_open_to_red(obj, num, type_) {
			if(type_==0){
				var search_typeall_all=search_typeall_r+search_typeall_new;
			}else{
				var search_typeall_all = search_typeall_r_z + search_typeall_new_z;
			}
			var find_host_arry = search_typeall_all.split('\t');
			for (var i = 0; i < find_host_arry.length; i++) {
				if (find_host_arry[i] == '') {
					find_host_arry.splice(i, 1);
					i--;
				}
			}
			for (var i = 0; i < tmp_list[type_].length; i++) {
				var item = tmp_list[type_][i];
				var pass = true;
				for (var jm = 0; jm < find_host_arry.length; jm++) {
					var pass_one = false;
					var jm_index_=find_host_arry[jm].indexOf('-');
					var search_arr = find_host_arry[jm].substr(jm_index_ + 1, find_host_arry[jm].length).split(' ');
					$.each(search_arr, function (i1, item1) {
						if (item1 != '') {
							if(find_host_arry[jm].substr(0,jm_index_)=='hostname'){
								var Name=item.Name.split('\t')[0];
								if (item.Type!=2){
									return false;
								}
							}else if(find_host_arry[jm].substr(0,jm_index_)=='ip'){
								var Name=item.Name.split('\t')[1];
								if (item.Type!=2){
									return false;
								}
							}else if(find_host_arry[jm].substr(0,jm_index_)=='hgname'){
								var Name=item.Name;
								if (item.Type!=1){
									return false;
								}
							}else if(find_host_arry[jm].substr(0,jm_index_)=='accountname'){
								var Name=item.Name;
								if (item.Type!=5){
									return false;
								}
							}else{
								var Name=item.Name;
							}
							if (coverString(item1, Name)) {
								pass_one = true;
								return false;
							}
						}
					});
					if (pass_one == false) {
						pass = false;
						break;
					}
				}
				if (pass == true) {
					open_and_make_red(item, type_);
				} else {
				}
			}
			li_red_to_no_red(type_,obj);
			//定位
			top_to_move(obj,type_);
		}
		function open_and_make_red(item,num){
			if (num == 0) {
				var group_name = '#userTree ';
			} else if (num == 1) {
				var group_name = '#userTree1 ';
			}
			var Path_array = item.Path.split('/');
			var len = Path_array.length;
			if (len == 2) {//主机层
				//数据未完全展开 留在 host_path_all，下次继续执行
				$(group_name + '#HGId-' + item.Id).siblings('span.h-name').addClass('h-name-red');
				$(group_name + '#HGId-' + item.Id).parent('li').show();
			} else {
				if (item.Type == 5) {
					for (var j = 1; j < len; j++) {
						var id = Path_array[j].split(',')[1];
						if (j == len - 1) { //主机层
							$(group_name + '#HostId-' + Path_array[j - 1].split(',')[1] + '-' + id).parent('li').show();
							$i_item = $(group_name + '#HostId-' + Path_array[j - 1].split(',')[1] + '-' + id).prev('i');
							if (($i_item.attr('class').indexOf('h-aicon-d')) === -1) {
								$i_item.trigger('click');
							}
						} else { //主机组层	
							$(group_name + '#HGId-' + id).parent('li').show();
							$i_item = $(group_name + '#HGId-' + id).prev('i');
							if (($i_item.attr('class').indexOf('h-aicon-d')) === -1) {
								$i_item.trigger('click');
							}
						}
					}
					if (item.Type == 5) {
						$i_item.parent('li').show();
						if (($i_item.attr('class').indexOf('h-aicon-d')) === -1) {
							$i_item.trigger('click');
						}
						var hg_id=Path_array[j-2].split(',')[1];
						var h_id = Path_array[j - 1].split(',')[1];
						//console.log(group_name + '#HostId-' + hg_id + '-' + h_id+':'+item.Id);
						var $PasswordAuth_input=$(group_name + '#HostId-' + hg_id + '-' + h_id).siblings('ul').find('input[value='+item.Id+']');
						$PasswordAuth_input.parent('li').show();
						$PasswordAuth_input.siblings('span.h-name').addClass('h-name-red');
					}
				} else {
					for (var j = 1; j < len - 1; j++) {
						var id = Path_array[j].split(',')[1];
						//show
						$(group_name + '#HGId-' + id).parent('li').show();
						$i_item = $(group_name + '#HGId-' + id).prev('i');
						if (($i_item.attr('class').indexOf('h-aicon-d')) == -1) {
							$i_item.trigger('click');
						}
					}
					if (item.Type == 1) {
						var $li_item_hg = $(group_name + '#HGId-' + item.Id);
						$li_item_hg.siblings('span.h-name').addClass('h-name-red');
						$li_item_hg.siblings('span.h-name').parent('li').show();
					} else if (item.Type == 2) {
						var $li_item_host = $(group_name + '#HostId-' + Path_array[j - 1].split(',')[1] + '-' + item.Id);
						$li_item_host.siblings('span.h-name').addClass('h-name-red');
						$li_item_host.siblings('span.h-name').parent('li').show();
					}
				}
			}
		}
		function top_to_move(obj,type_) {
			var top_arr = $(obj).find('span.h-name-red');
			if (top_arr.length != 0) {
				//非红隐藏
				li_hide_while_no_red(obj, 0);
				if(type_==0){
					$('#hosttree_div_c').scrollTop(top_arr.eq(0).offset().top - 200);
					_waitDone('.waitTiphost',3000);
				}else{
					$('#hosttree_div').scrollTop(top_arr.eq(0).offset().top - 200);
					_waitDone('.waitTipserver',3000);
				}
				
			} else {
				if(type_==0){
					$('#userTree').find('font.font-red').removeClass('font-red');
					$('#userTree').find('span.h-name-red').removeClass('h-name-red');
					$('#userTree').find('i.h-aicon-d').removeClass('h-aicon-d');
					$('#userTree').find('ul').hide();
					$('#userTree').find('li').hide();
					$("#server_text").blur();
					_alert(0, '搜索', '无搜索结果', $("#server_text"));
					_waitDone('.waitTiphost',0);
				}else{
					$('#userTree1').find('font.font-red').removeClass('font-red');
					$('#userTree1').find('span.h-name-red').removeClass('h-name-red');
					$('#userTree1').find('i.h-aicon-d').removeClass('h-aicon-d');
					$('#userTree1').find('ul').hide();
					$('#userTree1').find('li').hide();
					$("#server_text_z").blur();
					_alert(0, '搜索', '无搜索结果', $("#server_text_z"));
					_waitDone('.waitTipserver',0);
				}
			}
		}
		function hostpwdstrategy() {
			document.frm_pwdauth_add.action = '/bhost/hostpwd_showing'
			document.frm_pwdauth_add.submit();
		}
		function hostpwdstrategy_send() {
			document.frm_pwdauth_add.action = '/bhost/hostpwd_showing'
			document.frm_pwdauth_add.submit();
		}
		//判断是否是对象
		function isObj(object) {
			return object && typeof (object) == 'object' && Object.prototype.toString.call(object).toLowerCase() == "[object object]";
		}
		//判断是否是数组
		function isArray(object) {
			return object && typeof (object) == 'object' && object.constructor == Array;
		}
		//获取长度
		function getLength(object) {
			var count = 0;
			for (var i in object) count++;
			return count;
		}
		//比较函数
		function Compare(objA, objB) {
			if (!isObj(objA) || !isObj(objB))
				return false; //判断类型是否正确
			if (getLength(objA) != getLength(objB))
				return false; //判断长度是否一致
			return CompareObj(objA, objB, true);//默认为true
		}
		//递归函数
		function CompareObj(objA, objB, flag) {
			for (var key in objA) {
				if (!flag) //跳出整个循环
					break;
				if (!objB.hasOwnProperty(key)) {
					flag = false;
					break;
				}
				if (!isArray(objA[key])) { //子级不是数组时,比较属性值
					if (objB[key] != objA[key]) {
						flag = false;
						break;
					}
				} else {
					if (!isArray(objB[key])) {
						flag = false;
						break;
					}
					var oA = objA[key], oB = objB[key];
					if (oA.length != oB.length) {
						flag = false;
						break;
					}
					for (var k in oA) {
						if (!flag) //这里跳出循环是为了不让递归继续
							break;
						flag = CompareObj(oA[k], oB[k], flag);
					}
				}
			}
			return flag;
		}
		var search_typeall_new = '';
		//加入搜索
		function _addFilter(obj, type) {
			if(find_host_group_loading){
				_alert(2, "搜索", "正在搜索中，请先等待搜索完成");
				return false;
			}
			var id = $(obj).parent().children('select').children('option:selected').val();
			var v1 = $(obj).parent().children('select').children('option:selected').text();
			var v2 = $(obj).parent().children('input[type=text]').val().trim();
			if(id=='all'){
				v1='';
			}else{
				v1=v1+'-';
			}
			if (v2 == '') {
				$(obj).parent().children('input[type=text]').blur();
				_alert(2, '搜索', '请输入关键字', $(obj).parent().children('input[type=text]'));
				return false;
			} else {
				switch (id) {
					case 'hostname':
					case 'hgname':
					case 'hostname':
					case 'hostservicename':
						var Reg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.\s]+$/;
						break;
					case 'accountname':
						var Reg = /^[a-zA-Z\d_\-\.\s]+$/;
						break;
					case 'ip':
						var Reg = /^[0-9\.\s]+$/;
						break;
				}
				if (id!='all' && !Reg.test(v2) ) {
					$(obj).parent().children('input[type=text]').blur();
					_alert(1, '搜索', '关键字格式不正确', $(obj).parent().children('input[type=text]'));
					return false;
				}
				if (search_typeall_r.indexOf(id + '-' + v2 + '\t') >= 0) {
					$(obj).parent().children('input[type=text]').blur();
					_alert(2, '搜索', '相同的关键字已存在', $(obj).parent().children('input[type=text]'));
					return false;
				}
				if (type) {
					var type_value=(search_typeall_new==id + '-' + v2 + '\t');
					search_typeall_r = search_typeall_r+id + '-' + v2 + '\t';
					$('#filterWW>ul').append('<li style="height: 18px;"><span style = "display:none;">'+id+'-' + v2 + '</span><span style="width:120px;" title="' + v1+v2 + '" class="ww">' + v1+v2 + '</span><i class="del" style="margin-top: -17px;" onclick="_delFilter(this);"></i></li>')
					$("#server_text").val("");
					$('#server_text_check').hide();
					search_typeall_new = '';
					selView(type_value);
				} else {
					if(search_typeall_new == id + '-' + v2 + '\t'){
						return false;
					}
					search_typeall_new =id + '-'+ v2 + '\t';
					find_hostgroup();
				}

			}
		}
		//删除搜索
		function _delFilter(obj) {
			if(find_host_group_loading){
				_alert(2, "搜索", "正在搜索中，请先等待搜索完成");
				return false;
			}
			var id = $(obj).parent().find("span");
			var ids = $(id).eq(0).text();
			search_typeall_r = search_typeall_r.replace(ids + '\t', '');
			var server_text = $('#server_text').val().trim();
			$(obj).parent().remove();
			selView();
		}
		function _clearFilter(obj,num) {
			if(find_host_group_loading){
				_alert(2, "搜索", "正在搜索中，请先等待搜索完成");
				return false;
			}
			if(num==1){
			$('#server_text').val('');
			$('#server_text_check').hide();
			search_typeall_new = '';
			selView();
				return;
			}
			$('#clearFilter').next().children('ul').empty();
			$('#server_text').val('');
			$('#clearFilter').hide();
			$('#server_text_check').hide();
			search_typeall_new = '';
			search_typeall_r = '';
			selView();
		}
		//显示搜索条件
		function selView(type_value) {
			var $sel = $('#filterWW');
			var len = $('li', $sel).length;

			if (len == 0) {
				$sel.hide();
				$('#clearFilter').hide();
			} else {
				$("#filterWW").show();
				$('#clearFilter').show();
				$('>span.ww', $sel).show();
				$sel.addClass('selector-multiple');
			}
			if(!type_value) find_hostgroup();
		}
		var data_array_Path = null;
		var server_find_json = {
			"loginusercode": null,
			"hgid": 0,
			"type": null,
			"id": null,
			"istree": true,
			"hgname": "",
			"hostname": "",
			"hostip": "",
			"accountname":'',              //--搜索条件，服务器账号
    		"hostservicename":"",        //--搜索条件，主机服务名
			"searchstring": "",
			"limitrow": null,
			"offsetrow": null
		}
		var find_host_group_loading=false;
		function find_hostgroup() {
			find_host_group_loading=true;
			_getWait($('.waitTiphost'));
			var search_typeall_all = search_typeall_r + search_typeall_new;
			var find_host_arry = search_typeall_all.split('\t');
			for (var i = 0; i < find_host_arry.length; i++) {
				if (find_host_arry[i] == '') {
					find_host_arry.splice(i, 1);
					i--;
				}
			}
			$('#hosttree_div_c').scrollTop(0);
			//先清空之前的过滤信息 
			click_h1(0, '#userTree ');
			return true;
		}
		function _getWait(obj) {
			if (typeof waitDonelayer != 'undefined') {
				layer.close(waitDonelayer);
			}

			$(obj).removeClass('done').show().unbind().on('mouseover', function () {
				waitlayer = layer.tips('搜索中', this, {
					tips: 1,
					time: 0,
					skin: 'waitlayer'
				});
			}).on('mouseout', function () {
				if (typeof waitlayer != 'undefined') {
					layer.close(waitlayer);
				}
			});
		}
		function _waitDone(obj, num) {
			if (typeof waitlayer != 'undefined') {
				layer.close(waitlayer);
			}
			if (num == 0) {
				$(obj).stop();
				$(obj).hide();
			} else {
				$(obj).fadeOut(num);
			}

			if (typeof waitDonelayer != 'undefined') {
				layer.close(waitDonelayer);
			}
		}
		var search_typeall_r_user = '';
		var search_typeall_new_user = '';
		function _addFilter_user(obj, type) {
			var id = $(obj).parent().children('select').children('option:selected').val();
			if (id == "0") {
				$('#filterWW_user>ul').empty();
				search_typeall_r_user = "";
				search_typeall_new_user = '';
				$(obj).parent().children('input[type=text]').val('');
				selView_user();
				return false;
			}
			var v1 = $(obj).parent().children('select').children('option:selected').text();
			var v2 = $(obj).parent().children('input[type=text]').val().trim();
			if (v2 == '' && type) {
				$(obj).parent().children('input[type=text]').blur();
				_alert(2, '搜索', '请输入关键字', $(obj).parent().children('input[type=text]'));
				return false;
			} else {
				if (search_typeall_r_user.indexOf(v2 + '\t') >= 0) {
					$(obj).parent().children('input[type=text]').blur();
					_alert(2, '搜索', '相同的关键字已存在', $(obj).parent().children('input[type=text]'));
					return false;
				}
				if (type) {
					search_typeall_r_user = search_typeall_r_user + v2 + '\t';
					search_typeall_new_user = '';
					$('#filterWW_user>ul').append('<li style="height: 18px;"><span style = "display:none;">' + v2 + '</span><span style="width: 105px;" class="ww">' + v2 + '</span><i class="del" style="margin-top: 2px;" onclick="_delFilter_user(this);"></i></li>')
					$("#user_text").val("");
					selView_user();
				} else {
					if (v2 != '') search_typeall_new_user = v2 + '\t';
					else search_typeall_new_user = '';
					find_usergroup();
				}
			}
		}
		function _clearFilter_user(obj,num) {
			if(num==1){
			$('#user_text').val('');
			search_typeall_new_user = '';
			selView_user();
				return;
			}
			$('#clearFilter_user').next().children('ul').empty();
			$('#user_text').val('');
			search_typeall_new_user = '';
			search_typeall_r_user = '';
			selView_user();
		}
		function _delFilter_user(obj) {
			var id = $(obj).parent().find("span");
			var ids = $(id).eq(0).text();
			search_typeall_r_user = search_typeall_r_user.replace(ids + '\t', '');
			var user_text = $('#user_text').val().trim();
			if (user_text == '') {
				search_typeall_new_user == '';
			} else {
				search_typeall_new_user = user_text + '\t';
			}
			$(obj).parent().remove();
			selView_user();
		}
		function selView_user() {
			var $sel = $('#filterWW_user');
			var len = $('li', $sel).length;
			if (len == 0) {
				$sel.hide();
				$('#clearFilter_user').hide();
			} else {
				$("#filterWW_user").show();
				$('#clearFilter_user').show();
				$('>span.ww', $sel).show();
				$sel.addClass('selector-multiple');
			}
			find_usergroup();
		}
		//搜索回显
		var data_array_Path_user = null;
		var user_find_json = {
			"ugid": 0,
			"istree": true,
			"searchstring": "",
			"limitrow": null,
			"offsetrow": null
		}
		function find_usergroup() {
			_getWait($('.waitTipuser'));
			if (data_array_Path_user != null) {
				$('#userTreeh').find('font.font-red').removeClass('font-red');
				$('#userTreeh').find('span.h-name-red').removeClass('h-name-red');
	       		$('#userTreeh').find('i.h-aicon-d').removeClass('h-aicon-d');
				$('#userTreeh').find('ul').hide();
			}
			$('#userTreeh').find('li').hide();
			$('#usertree_div').scrollTop(0);
			var search_typeall_all = search_typeall_r_user + search_typeall_new_user;
			if (search_typeall_all != '') {
				var searchstring_str = '';
				$.each(search_typeall_all.split('\t'), function (i, item) {
					if (item == '' || item == null) {
						return true;
					}
					searchstring_str += (item + '\n');
				});
				searchstring_str = searchstring_str.substr(0, searchstring_str.length - 1);
				user_find_json.searchstring = searchstring_str;
				$.ajax({
					url: '/bhost/find_usergroup',
					type: "POST",
					async: true,
					data: { a0: $("input[name=se]").val(), a1: JSON.stringify(user_find_json) },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							data_array_Path_user = result.info;
							if (data_array_Path_user.length != 0) {
								$.each(data_array_Path_user, function (i, item) {
									var Path_array = item.Path.split('/');
									var len = Path_array.length;
									for (var j = 1; j < len - 1; j++) {
										var id = Path_array[j].split(',')[1];
										$('#UGId-' + id).parent('li').show();
										$i_item = $('#UGId-' + id).siblings('i.h-aicon');
										if (($i_item.attr('class').indexOf('h-aicon-d')) == -1) {
											$i_item.trigger('click');
										}
									}
									if (item.Type == 1) {
										$('#UGId-' + item.Id).parent('li').show();
										$('#UGId-' + item.Id).siblings('span.h-name').addClass('h-name-red');
										var $span_son_font=$('#UGId-'+item.Id).siblings('span.h-name').find('font')
										var span_son_name=$('#UGId-'+item.Id).attr('data-name').toLowerCase();
										$.each(search_typeall_all.split('\t'),function(i,item){
											if(item=='' || item==null){
												return true;
											}
											var index=item.indexOf('-');
											switch (item.substring(0,index)) {
												case 'ugname':
												case 'all':
													$.each(item.substring(index+1).split(' '),function (i_s,params_s) {
														params_s=params_s.toLowerCase();
														var index_true=span_son_name.indexOf(params_s);
														if(index_true>=0){
															for(var i_red_span=index_true;i_red_span<index_true+params_s.length;i_red_span++){
																$span_son_font.eq(i_red_span).addClass('font-red');
															}
														}
													});
													break;
											}
										});
									} else {
										$('#UserId-' + item.Parent + '-' + item.Id).parent('li').show();
										$('#UserId-' + item.Parent + '-' + item.Id).siblings('span.h-name').addClass('h-name-red');
										var $span_son_font=$('#UserId-'+item.Parent+'-'+item.Id).siblings('span.h-name').find('font')
										var span_son_name=$('#UserId-'+item.Parent+'-'+item.Id).attr('data-name').toLowerCase();
										$.each(search_typeall_all.split('\t'),function(i,item){
											if(item=='' || item==null){
												return true;
											}
											var index=item.indexOf('-');
											switch (item.substring(0,index)) {
												case 'usercode':
												case 'all':
													$.each(item.substring(index+1).split(' '),function (i_s,params_s) {
														params_s=params_s.toLowerCase();
														var index_true=span_son_name.indexOf(params_s);
														if(index_true>=0){
															for(var i_red_span=index_true;i_red_span<index_true+params_s.length;i_red_span++){
																$span_son_font.eq(i_red_span).addClass('font-red');
															}
														}
													});
													break;
											}
										});
									}
								});
								li_hide_while_no_red($('#userTreeh'),0);
								scrollTop_check_user();
								_waitDone($('.waitTipuser'), 3000);
							} else {
								$("#user_text").blur();
								_waitDone($('.waitTipuser'), 0);
								_alert(0, '搜索', '无搜索结果', $("#user_text"));
							}
						} else {
							_alert(1, '搜索', result.ErrMsg);
							_waitDone($('.waitTipuser'), 0);
							return false;
						}
					}
				});
			} else {
				$('#userTreeh').find('li').show();
				data_array_Path_user = null;
				_waitDone($('.waitTipuser'), 0);
			}
		}
		//返回第一个标红处
		function scrollTop_check_user() {
			if (data_array_Path_user.length != 0) {
				$('#usertree_div').scrollTop($('#userTreeh').find('span.h-name-red') - 400);
			}
		}

		//加载树
		function _initListh() {
			// _viewHTML('#userTreeh', 'UG');
		}
		var server_id = 0;
		function next() {
			var PwdModPlanName = $('#PwdModPlanName').val();
			if (PwdModPlanName == "") {
				_alert(2, '自动改密', '请输入名称', $('#PwdModPlanName'));
				return false;
			} else if (!nameReg.test(PwdModPlanName)) {
				_alert(1, '自动改密', '名称格式不正确', $('#PwdModPlanName'));
				return false;
			}
			if (document.frm_pwdauth_add.a.value == '0') {
				var pass = 1;
				$.ajax({
					url: '/bhost/PGetPwdModPlanByName',
					type: "POST",
					async: false,
					data: { a0: $("input[name=se]").val(), a1: PwdModPlanName },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							if (result.info != 0) {
								_alert(2, '自动改密', '已存在同名的计划', $('#PwdModPlanName'));
								pass = 0;
								return false;
							}
						} else {
							_alert(1, '自动改密', result.ErrMsg);
							pass = 0;
							return false;
						}
					}
				});
				if (pass == 0) {
					return false;
				}
			}
			if ($("#typeSet").val() == 2) { //范围指定
				if (server_id == 0 && $("#server_frame_list").children('div').length == 1) {
					_alert(2, "自动改密", "请选择服务器集合")
					return false;
				}
				if ($("#define_select").val() == 1) {//已定义
					if ($("#a_mix_select").val() == 1){
						if (accountid.length == 0) {
							_alert(2, "自动改密", "请选择账号");
							return false;
						}
					}
					if ($("#s_mix_select").val() == 1){
						if ($("#service_list2").find('input:checked').length == 0) {
							_alert(2, "自动改密", "请选择服务");
							return false;
						}
					}
				} else {//自定义
					if (account_arry.length == 1 && account_arry[0] == '-1') {
						_alert(2, "自动改密", "请添加账号");
						return false;
					}
					if ($("#service_list1").children('tr').length == 0) {
						_alert(2, "自动改密", "请添加服务");
						return false;
					}
				}
			} else {//对象指定
				if ($("#userTree").find('span.checkbox.half,span.checkbox.checked').length == 0) {
					_alert(2, "自动改密", "请选择对象");
					return false;
				}
			}
			//用户树
			_initListh();
			$('#one').hide();
			$('#two').show();
			$('#li1').removeClass();
			$('#li2').addClass('active');
		}
		function  coverString(subStr,str){
			subStr=subStr.replace(/\?/g, "\\?").replace(/\|/g, "\\|").replace(/\\/g, "\\\\").replace(/\$/g, "\\$").replace(/\(/g, "\\(").replace(/\)/g, "\\)").replace(/\*/g, "\\*").replace(/\./g, "\\.").replace(/\[/g, "\\[").replace(/\^/g, "\\^").replace(/\{/g, "\\{");
			var reg = eval("/"+subStr+"/ig");
			return reg.test(str);
		}
		function save_pwdauth_host(obj, id) {
			$(">li", obj).children('input').each(function () {
				var input_id = $(this).attr('id');
				var input_str = input_id.split('-');
				var hg_id = parseInt(input_str[1]);
				if (input_str[0] != "HGId") {
					if (input_str[0] == 'PasswordAuthId') {
						var host_id_or_pwd_id = parseInt($(this).attr('value'));
						var host_id = parseInt(input_str[2]);
					}
					else var host_id_or_pwd_id = parseInt(input_str[2]);
				}
				var input_state = $(this).next('span.checkbox').attr('class');
				var radio_value = $(this).siblings('span.authtype').find('input');
				var $u = $(this).parent().children('ul');
				var pass = 1;
				var loadfirst = parseInt($(this).attr('data-loadfirst'));
				var loadlast = parseInt($(this).attr('data-loadlast'));
				if (input_state.indexOf('checked') > 0) {
					if (radio_value.is(':checked')) {
						if (input_str[0] == "HGId") {
							switch (loadfirst) {
								case 1:
									var json_a = '{"HGId":' + hg_id + ',"HostId":null,"IsGroupAuth":true,"IsDelOld":true}';
									pwdauth_save.HostSet.push(JSON.parse(json_a));
									break;
								case 2:
									$.each(pwdauth.HostSet, function (i, item) {
										if (item.HGId == hg_id && item.HostId == null) {
											pass = 0;
											return false;
										}
									});
									if (pass == 1) {
										var json_a = '{"HGId":' + hg_id + ',"HostId":null,"IsGroupAuth":true,"IsDelOld":true}';
										pwdauth_save.HostSet.push(JSON.parse(json_a));
										pass = 0;
									}
									break;
								case 0:
									var json_a = '{"HGId":' + hg_id + ',"HostId":null,"IsGroupAuth":true}';
									pwdauth_save.HostSet.push(JSON.parse(json_a));
									break;
							}
						} else if (input_str[0] == "HostId") {
							switch (loadfirst) {
								case 1:
									var json_a = '{"HGId":' + hg_id + ',"HostId":' + host_id_or_pwd_id + ',"IsGroupAuth": true,"IsDelOld":true}';
									pwdauth_save.HostSet.push(JSON.parse(json_a));
									break;
								case 2:
									$.each(pwdauth.HostSet, function (i, item) {
										if (item.HGId == hg_id && item.HostId == host_id_or_pwd_id) {
											pass = 0;
											return false;
										}
									});
									if (pass == 1) {
										var json_a = '{"HGId":' + hg_id + ',"HostId":' + host_id_or_pwd_id + ',"IsGroupAuth": true,"IsDelOld":true}';
										pwdauth_save.HostSet.push(JSON.parse(json_a));
										pass = 0;
									}
									break;
								case 0:
									var json_a = '{"HGId":' + hg_id + ',"HostId":' + host_id_or_pwd_id + ',"IsGroupAuth": true}';
									pwdauth_save.HostSet.push(JSON.parse(json_a));
									break;
							}
						}
					} else {
						if (input_str[0] == "PasswordAuthId") {
							$.each(pwdauth.PasswordAuthSet, function (i, item) {
								if (item.PasswordAuthId == host_id_or_pwd_id) {
									pass = 0;
									return false;
								}
							});
							if (pass == 1) {
								var json_a = '{"HGId":'+hg_id+',"HostId":' + host_id + ',"PasswordAuthId":' + host_id_or_pwd_id + '}';
								pwdauth_save.PasswordAuthSet.push(JSON.parse(json_a));
							}
						} else if (input_str[0] == "HGId") {
							switch (loadfirst) {
								case 1:
									var json_a = '{"HGId":' + hg_id + ',"HostId":null,"IsGroupAuth":false,"IsDelOld":true}';
									pwdauth_save.HostSet.push(JSON.parse(json_a));
									break;
								case 2:
									$.each(pwdauth.HostSet, function (i, item) {
										if (item.HGId == hg_id && item.HostId == null) {
											pass = 0;
											return false;
										}
									});
									if (pass == 1) {
										var json_a = '{"HGId":' + hg_id + ',"HostId":null,"IsGroupAuth":false,"IsDelOld":true}';
										pwdauth_save.HostSet.push(JSON.parse(json_a));
									}
									break;
								case 0:
									var json_a = '{"HGId":' + hg_id + ',"HostId":null,"IsGroupAuth":false}';
									pwdauth_save.HostSet.push(JSON.parse(json_a));
									break;
							}
						} else if (input_str[0] == "HostId") {
							switch (loadfirst) {
								case 1:
									var json_a = '{"HGId":' + hg_id + ',"HostId":' + host_id_or_pwd_id + ',"IsGroupAuth": false,"IsDelOld":true}';
									pwdauth_save.HostSet.push(JSON.parse(json_a));
									break;
								case 2:
									$.each(pwdauth.HostSet, function (i, item) {
										if (item.HGId == hg_id && item.HostId == host_id_or_pwd_id) {
											pass = 0;
											return false;
										}
									});
									if (pass == 1) {
										var json_a = '{"HGId":' + hg_id + ',"HostId":' + host_id_or_pwd_id + ',"IsGroupAuth": false,"IsDelOld":true}';
										pwdauth_save.HostSet.push(JSON.parse(json_a));
										pass = 0;
									}
									break;
								case 0:
									var json_a = '{"HGId":' + hg_id + ',"HostId":' + host_id_or_pwd_id + ',"IsGroupAuth": false}';
									pwdauth_save.HostSet.push(JSON.parse(json_a));
									break;
							}
						}
					}
				} else if (input_state.indexOf('half') > 0) {
					if (input_str[0] == "HGId") {
						$.each(pwdauth.HostSet, function (i, item) {
							if (item.HGId == hg_id && item.HostId == null) {
								var json_a = '{"HGId":' + hg_id + ',"HostId":null,"IsGroupAuth":false,"IsDelOld":true}';
								pwdauth_save.HostSet.push(JSON.parse(json_a));
							}
						});
					} else if (input_str[0] == "HostId") {
						$.each(pwdauth.HostSet, function (i, item) {
							if (item.HGId == hg_id && item.HostId == host_id_or_pwd_id) {
								var json_a = '{"HGId":' + hg_id + ',"HostId":' + host_id_or_pwd_id + ',"IsGroupAuth": false,"IsDelOld":true}';
								pwdauth_save.HostSet.push(JSON.parse(json_a));
							}
						});
					}
					if ($u.text() != "Loading..." && $u.text() != "") {
						save_pwdauth_host($u, hg_id);
					}
				} else {
					if (input_str[0] == "HGId") {
						$.each(pwdauth.HostSet, function (i, item) {
							if (item.HGId == hg_id && item.HostId == null) {
								var json_a = '{"HGId":' + hg_id + ',"HostId":null}';
								pwdauth_save.DeleteAuthObject.push(JSON.parse(json_a));
							}
						});
						if ((loadfirst == 1 || loadfirst == 2) && loadlast == 0) {
							var json_a = '{"HGId":' + hg_id + ',"HostId":null}';
							pwdauth_save.DeleteAuthObject.push(JSON.parse(json_a));
						}
					} else if (input_str[0] == "HostId") {
						$.each(pwdauth.HostSet, function (i, item) {
							if (item.HGId == hg_id && item.HostId == host_id_or_pwd_id) {
								var json_a = '{"HGId":' + hg_id + ',"HostId":' + host_id_or_pwd_id + '}';
								pwdauth_save.DeleteAuthObject.push(JSON.parse(json_a));
								return false;
							} else if (item.HGId == hg_id && item.HostId == null) {
								var json_a = '{"HGId":' + hg_id + ',"HostId":' + host_id_or_pwd_id + '}';
								pwdauth_save.DeleteAuthObject.push(JSON.parse(json_a));
								return false;
							}
						});
						if ((loadfirst == 1 || loadfirst == 2) && loadlast == 0) {
							var json_a = '{"HGId":' + hg_id + ',"HostId":' + host_id_or_pwd_id + '}';
							pwdauth_save.DeleteAuthObject.push(JSON.parse(json_a));
						}
					} else if (input_str[0] == "PasswordAuthId") {
						host_id_or_pwd_id = parseInt($('#' + input_id).attr('value'));
						$.each(pwdauth.PasswordAuthSet, function (i, item) {
							if (item.PasswordAuthId == host_id_or_pwd_id) {
								var json_a = '{"HGId":'+hg_id+',"HostId":' + host_id + ',"PasswordAuthId":' + host_id_or_pwd_id + '}';
								//var json_a = '{"PasswordAuthId":' + host_id_or_pwd_id + '}';
								pwdauth_save.DeleteAuthObject.push(JSON.parse(json_a));
								return false;
							}
						});
						$.each(pwdauth.HostSet, function (i, item) {
							if (item.HGId == hg_id && item.HostId == host_id ) {
								var json_a = '{"HGId":'+hg_id+',"HostId":' + host_id + ',"PasswordAuthId":' + host_id_or_pwd_id + '}';
								//var json_a = '{"PasswordAuthId":' + host_id_or_pwd_id + '}';
								pwdauth_save.DeleteAuthObject.push(JSON.parse(json_a));
								return false;
							}
						});
					}
					if ($u.text() != "Loading..." && $u.text() != "") {
						save_pwdauth_host($u, hg_id);
					}
				}
			});
		}
		function prev() {
			$('#one').show();
			$('#two').hide();
			$('#li1').addClass('active');
			$('#li2').removeClass();
		}
		function back(num, id) {
			if (num == 1) {
				$.ajax({
					url: '/bhost/PGetRecordRownum',
					type: "POST",
					async: false,
					data: { a0: $("input[name=se]").val(), a1: id, a2: 17, a3: 1 },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result == true) {
							if (result.info % MAX_PAGE == 0) {
								document.frm_pwdauth_add.c.value = parseInt(result.info / MAX_PAGE);
							} else {
								document.frm_pwdauth_add.c.value = parseInt(result.info / MAX_PAGE) + 1;
							}
						}
					}
				});
				document.frm_pwdauth_add.d.value = '';
				document.frm_pwdauth_add.e.value = ':';
			}
			var tasktype = document.frm_pwdauth_add.tasktype.value;
			if (tasktype == "4") {
				document.frm_pwdauth_add.tasktype.value = 4;
			} else {
				document.frm_pwdauth_add.tasktype.value = 3;
				document.frm_pwdauth_add.a.value = 0;
				document.frm_pwdauth_add.action = '/bhost/pwd_trust';
			}
			document.frm_pwdauth_add.submit();
		}
		$(window).resize(function () {
			_initSize();
		});

		function _initSize() {
			var h = $(window).height();
			var w = $(window).width();
			$('#hosttree_div_c').height(h - 210 - 36 - 17);
			$('.h-content2').height(h - 210);
			$('.h-content2-tmp').height('auto');
			$('.p-h-2').height(h - 226);
			$('.h-content2_temp').height(h - 263);
			$('.h-content2-d').height(h - 333);
			$('.h-catelog2_tmp').height(h - 288);
			$(".h-catelog.h-catelog2.h-catelog2_tmp").height(h - 269);
			$('#hosttree_div').height(h - 304);
			if ((w - 500) < 630) {
				$('.h-top-tmp').width(630);
			} else {
				$('.h-top-tmp').width(w - 520 + 10);
			}
			$('#usertree_div').height(h - 130 - 330 - 9);
			$('#usertree_div').width(w - 300 - 228 + 13);
			var de_h1 = $("#defined_info").children(".h-catelog.h-catelog2.h-content2_temp:eq(0)").height();
			var de_h2 = $("#defined_info").children(".h-catelog.h-catelog2.h-content2_temp:eq(1)").height();
			$("#service_list_a").parents('.c-table.tab-type2').css('max-height',de_h1-109);
			$("#service_list2").parents('.c-table.tab-type2').css('max-height',de_h1-109);
		}

		function _initList() {
			_viewHTML('#userTree', 'HG');
		}
		/*
		* 处理过长的字符串，截取并添加省略号
		* 注：半角长度为1，全角长度为2
		*
		* pStr:字符串
		* pLen:截取长度
		*
		* return: 截取后的字符串
		*/
		function autoAddEllipsis(pStr, pLen) {

			var _ret = cutString(pStr, pLen);
			var _cutFlag = _ret.cutflag;
			var _cutStringn = _ret.cutstring;

			if ("1" == _cutFlag) {
				return _cutStringn + "...";
			} else {
				return _cutStringn;
			}
		}
		/*
		* 取得指定长度的字符串
		* 注：半角长度为1，全角长度为2
		*
		* pStr:字符串
		* pLen:截取长度
		*
		* return: 截取后的字符串
		*/
		function cutString(pStr, pLen) {

			// 原字符串长度
			var _strLen = pStr.length;

			var _tmpCode;

			var _cutString;

			// 默认情况下，返回的字符串是原字符串的一部分
			var _cutFlag = "1";

			var _lenCount = 0;

			var _ret = false;

			if (_strLen <= pLen / 2) {
				_cutString = pStr;
				_ret = true;
			}

			if (!_ret) {
				for (var i = 0; i < _strLen; i++) {
					if (isFull(pStr.charAt(i))) {
						_lenCount += 2;
					} else {
						_lenCount += 1;
					}

					if (_lenCount > pLen) {
						_cutString = pStr.substring(0, i);
						_ret = true;
						break;
					} else if (_lenCount == pLen) {
						_cutString = pStr.substring(0, i + 1);
						_ret = true;
						break;
					}
				}
			}

			if (!_ret) {
				_cutString = pStr;
				_ret = true;
			}

			if (_cutString.length == _strLen) {
				_cutFlag = "0";
			}

			return { "cutstring": _cutString, "cutflag": _cutFlag };
		}

		/*
		* 判断是否为全角
		*
		* pChar:长度为1的字符串
		* return: true:全角
		*          false:半角
		*/
		function isFull(pChar) {
			if ((pChar.charCodeAt(0) > 128)) {
				return true;
			} else {
				return false;
			}
		}
		var count_ajax = 0;
		//加载下拉树
		
		function method1(arr1){
			var arr=[];    //定义一个临时数组
			for(var i = 0; i < arr1.length; i++){    //循环遍历当前数组
			//判断当前数组下标为i的元素是否已经保存到临时数组
			//如果已保存，则跳过，否则将此元素保存到临时数组中
				if(arr.indexOf(arr1[i]) == -1){  
						arr.push(arr1[i]);  
				}  
			}  
			return arr;  
		}
		function _initHTML(obj, id, v, d, arr_i) {
			if (arr_i.indexOf('HG') >= 0) {
				if (arr_i == 'HG') {
					var num = 0;
					var group_name = '#userTree ';
					var label_style = "";
					var label_title='组托管';
				} else {
					var num = 1;
					var group_name = '#userTree1 ';
					var label_style = 'style="display:none"';
					var label_title='组授权';
				}
				//过滤中 不需要 showloading
				if (filter_flag_append[num] == true) filter_flag_append[num] = false;
				else _showLoading();
				flag_loading = true;
				var loading_hgid;
				$.ajax({
					url: '/bhost/get_hostdirectory',
					type: 'post',
					async: true,
					cache: false,
					data: { a0: $("input[name=se]").val(), a2: id, a5: edit_id[num], a6: type[num] },
					success: function (result) {
						$(obj).empty();
						var hdata_host = JSON.parse(result).info.data;
						loading_hgid = id;
						if (edit_id[num] > 0) disabled_flag = "disabled";
						else disabled_flag = "";
						var loadfirst = 0;
						var loadlast = 0;
						var parent_id = $(obj).siblings('input').attr('id').split('-')[1];
						var _p_loadfirst = $(obj).siblings('input').attr('data-loadfirst');
						var _p_loadlast = $(obj).siblings('input').attr('data-loadlast');
						var auth_type_checked = false;
						if ($(obj).siblings('span.authtype').find('input').length != 0) {
							auth_type_checked = $(obj).siblings('span.authtype').find('input').prop('checked');
						}
						if ((_p_loadfirst == 0) && (_p_loadlast == 0)) {
						}
						if (auth_type_checked) {
							disabled_flag = "";
						}
						if (_p_loadfirst == _p_loadlast) {
							if (_p_loadlast == 2) {
								loadfirst = 2
								loadlast = 2;
							}
						} else {
							if (_p_loadlast == 2) {
								loadlast = 2;
							}
							if (_p_loadfirst == 2) {
								loadfirst = 2;
							}

						}
						if (hdata_host.HGroup == null) hdata_host.HGroup = [];
						$.each(hdata_host.HGroup, function (i, item) {
							if (num==1) item.Mode =2;
							if (item.Mode == 2) var $auth = '<label><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + '" >'+label_title+'</label>';
							else var $auth = '<label style="display:none"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + '" >'+label_title+'</label>';
							var $H = $('<li></li>');
							if (ajax_find_host_doing == true && $(obj).siblings('span.h-name-red').length == 0) {
								var $H = $('<li style="display: none;"></li>');
							} else {
								var $H = $('<li></li>');
							}
							if ((item.MemberNum + item.HostNum) == 0) i_class = "h-blank";
							else i_class = "h-aicon";
							//data-loadfirst(初始的状态) 0->未选中 1->部分选中 2->全选中 
							//data-loadlast(最后保存的状态) 
							if (v == 1 && d == 0) {
								disabled_flag = "disabled";
								if (item.Mode == 2) $auth = '<label><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + '" >'+label_title+'</label>';
								else $auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + '" >'+label_title+'</label>';
								$H.html('<i class="' + i_class + '" data-id="' + arr_i + '-' + item.HGId + '" />'+
								'<input type="checkbox" checked="checked" id="HGId-' + item.HGId + '" data-check="1" class="zcheck zcheck-g" disabled data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-mode="2" data-name="' + item.HGName + '">'+
								'<i class="h-eicon h-eicon-g"></i>'+
								'<span class="h-name" title="'+item.HGName+'" id="'+arr_i+'spanHG-' + item.HGId + '" style="width: 12em;">' + 
								'<span class="h-name-son" style="">' + 
									item.HGName.split('').map(function (params) {
										return '<font>'+params+'</font>'    
									}).join('') + 
								'</span>'+
								'</span>'+
								'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
								'<ul style="display:none">Loading...</ul>');
							} else if (v == 1) { //v == 1 d ==1
								$H.html('<i class="' + i_class + '" data-id="' + arr_i + '-' + item.HGId + '" />'+
								'<input type="checkbox" checked="checked" id="HGId-' + item.HGId + '" data-check="1" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-mode="2" data-name="' + item.HGName + '">'+
								'<i class="h-eicon h-eicon-g"></i>'+
								'<span class="h-name" title="'+item.HGName+'" id="'+arr_i+'spanHG-' + item.HGId + '" style="width: 12em;">' + 
								'<span class="h-name-son" style="">' + 
									item.HGName.split('').map(function (params) {
										return '<font>'+params+'</font>'    
									}).join('') + 
									'</span>'+
								'</span>'+
								'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
								'<ul style="display:none">Loading...</ul>');
							} else if (v == 0) {
								$H.html('<i class="' + i_class + '" data-id="' + arr_i + '-' + item.HGId + '" />'+
								'<input type="checkbox" id="HGId-' + item.HGId + '" data-check="0" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-mode="2" data-name="' + item.HGName + '">'+
								'<i class="h-eicon h-eicon-g"></i>'+
								'<span class="h-name" title="'+item.HGName+'" id="'+arr_i+'spanHG-' + item.HGId + '" style="width: 12em;">' + 
								'<span class="h-name-son" style="">' + 
									item.HGName.split('').map(function (params) {
										return '<font>'+params+'</font>'    
									}).join('') + 
								'</span>'+
								'</span>'+
								'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
								'<ul style="display:none">Loading...</ul>');
							} else {
								$H.html('<i class="' + i_class + '" data-id="' + arr_i + '-' + item.HGId + '" />'+
								'<input type="checkbox" id="HGId-' + item.HGId + '" data-check="0" class="zcheck zcheck-g" ' + disabled_flag + ' data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-ifselect=false data-mode="2" data-name="' + item.HGName + '">'+
								'<i class="h-eicon h-eicon-g"></i>'+
								'<span class="h-name" title="'+item.HGName+'" id="'+arr_i+'spanHG-' + item.HGId + '" style="width: 12em;">' + 
								'<span class="h-name-son" style="">' + 
								item.HGName.split('').map(function (params) {
									return '<font>'+params+'</font>'    
								}).join('') + 
								'</span>'+
								'</span>'+
								'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
								'<ul style="display:none">Loading...</ul>');
							}
							if (edit_id[num] > 0) {
								if (!auth_type_checked) {
									if (push_hgid[num].indexOf(item.HGId + ":false") < 0) {
										push_hgid[num].push(item.HGId + ":false");
									}
								}
							}
							$(obj).append($H);
						});
						_checkView_host(obj);
						if (edit_id[num] > 0) {
							select_checkbox("HGroup", parent_id, num);	 //只有编辑情况下 才需要判断 select 
						}
						if (hdata_host.Host == null) {
							hdata_host.Host = [];
							flag_loading = false;
							_closeLoading();
							return false;
						}
						// $.each(hdata_host.Host,function name(i,item) {
						for (var i = 0; i < hdata_host.Host.length; i++) {
							if (num==1) hdata_host.Host[i].Mode =2;
							if ((hdata_host.Host[i].Selected == 0 && hdata_host.Host[i].Mode == 0 && ajax_find_host_doing == true) || (hdata_host.Host[i].Selected == 0 && hdata_host.Host[i].Mode == 0 && edit_id[num]<=0)) {
								continue;
							}
							var $auth = '<label ' + label_style + '><input type="checkbox" name="check' + hdata_host.Host[i].HostId + '"  ' + disabled_flag + 'data-ifselect=false data-mode="' + hdata_host.Host[i].Mode + '" >主机托管</label>';
							if (ajax_find_host_doing == true && $(obj).siblings('span.h-name-red').length == 0) {
								var $H = $('<li style="display: none;"></li>');
							}else if(hdata_host.Host[i].Mode==0){
								var $H = $('<li style="display: none;"></li>');
							} else {
								var $H = $('<li></li>');
							}
							var HostName_h = hdata_host.Host[i].HostName;
							// var HostName_h = autoAddEllipsis(hdata_host.Host[i].HostName, '12');
							i_class = "h-blank"
							if (hdata_host.Host[i].AccountNum != 0 && arr_i == 'HG') i_class = "h-aicon";
							if (v == 1 && d == 0) {
								$auth = '<label ' + label_style + '><input type="checkbox" name="check' + hdata_host.Host[i].HostId + '" disabled data-ifselect=false data-mode="' + hdata_host.Host[i].Mode + '" >主机托管</label>';
								$H.html('<i class="' + i_class + '" data-id="HOST-' + hdata_host.Host[i].HostId + '" />'+
								'<input type="checkbox" checked="checked" id="HostId-' + parent_id + '-' + hdata_host.Host[i].HostId + '" data-check="1" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + ' data-ifselect=false disabled data-mode="' + hdata_host.Host[i].Mode + '" data-name="' + hdata_host.Host[i].HostIP + '\t' + hdata_host.Host[i].HostName + '">'+
								'<i class="h-eicon h-eicon-u"></i>'+
								'<span class="h-name" id="'+arr_i+'spanHG-' + parent_id + '-' + hdata_host.Host[i].HostId + '" style="width: 12em;" title="'+hdata_host.Host[i].HostName+'(' + hdata_host.Host[i].HostIP + ')'+'">' + 
								'<span class="h-name-son" style="">' + 
									( hdata_host.Host[i].HostIP+ '(' + HostName_h + ')').split('').map(function (params) {
										return '<font>'+params+'</font>'    
									}).join('') + 
									'</span>'+
								'</span>'+
								'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
								'<ul style="display:none">Loading...</ul>');

							} else if (v == 1) {
								$H.html('<i class="' + i_class + '" data-id="HOST-' + hdata_host.Host[i].HostId + '" />'+
								'<input type="checkbox" checked="checked" id="HostId-' + parent_id + '-' + hdata_host.Host[i].HostId + '" data-check="1" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + '  data-ifselect=false data-mode="' + hdata_host.Host[i].Mode + '" data-name="' + hdata_host.Host[i].HostIP + '\t' + hdata_host.Host[i].HostName + '">'+
								'<i class="h-eicon h-eicon-u"></i>'+
								'<span class="h-name" id="'+arr_i+'spanHG-' + parent_id + '-' + hdata_host.Host[i].HostId + '" style="width: 12em;" title="'+hdata_host.Host[i].HostName+'(' + hdata_host.Host[i].HostIP + ')'+'">' + 
								'<span class="h-name-son" style="">' + 
									( hdata_host.Host[i].HostIP+ '(' + HostName_h + ')').split('').map(function (params) {
										return '<font>'+params+'</font>'    
									}).join('') + 
								'</span>'+
								'</span>'+
								'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
								'<ul style="display:none">Loading...</ul>');
							} else if (v == 0) {
								$H.html('<i class="' + i_class + '" data-id="HOST-' + hdata_host.Host[i].HostId + '" />'+
								'<input type="checkbox" id="HostId-' + parent_id + '-' + hdata_host.Host[i].HostId + '" data-check="0" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=' + loadlast + '  data-ifselect=false data-mode="' + hdata_host.Host[i].Mode + '" data-name="' + hdata_host.Host[i].HostIP + '\t' + hdata_host.Host[i].HostName + '">'+
								'<i class="h-eicon h-eicon-u"></i>'+
								'<span class="h-name" id="'+arr_i+'spanHG-' + parent_id + '-' + hdata_host.Host[i].HostId + '" style="width: 12em;" title="'+hdata_host.Host[i].HostName+'(' + hdata_host.Host[i].HostIP + ')'+'">' + 
								'<span class="h-name-son" style="">' + 
									(hdata_host.Host[i].HostIP + '(' + HostName_h + ')').split('').map(function (params) {
										return '<font>'+params+'</font>'    
									}).join('') + 
								'</span>'+
								'</span>'+
								'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
								'<ul style="display:none">Loading...</ul>');
							} else {
								$H.html('<i class="' + i_class + '" data-id="HOST-' + hdata_host.Host[i].HostId + '" /><input type="checkbox" id="HostId-' + parent_id + '-' + hdata_host.Host[i].HostId + '" data-check="0" class="zcheck zcheck-g" data-loadfirst=0 data-loadlast=' + loadlast + ' ' + disabled_flag + '  data-ifselect=false data-mode="' + hdata_host.Host[i].Mode + '" data-name="' + hdata_host.Host[i].HostIP + '\t' + hdata_host.Host[i].HostName + '"><i class="h-eicon h-eicon-u" class="zcheck"></i><span class="h-name" style="width: 16em;" title="'+hdata_host.Host[i].HostName+'(' + hdata_host.Host[i].HostIP + ')'+'">' + hdata_host.Host[i].HostIP + '(' + HostName_h + ')' + '</span><span class="authtype" style="display:inline-block">' + $auth + '</span><ul style="display:none">Loading...</ul>');
								if (ajax_find_host_doing == false) {
									$H.html('<i class="' + i_class + '" data-id="HOST-' + hdata_host.Host[i].HostId + '" />'+
									'<input type="checkbox" id="HostId-' + parent_id + '-' + hdata_host.Host[i].HostId + '" data-check="0" class="zcheck zcheck-g" data-ifselect=false data-loadfirst=0 data-loadlast=' + loadlast + ' ' + disabled_flag + ' data-mode="' + hdata_host.Host[i].Mode + '" data-name="' + hdata_host.Host[i].HostIP + '\t' + hdata_host.Host[i].HostName + '">'+
									'<i class="h-eicon h-eicon-u" class="zcheck"></i>'+
									'<span class="h-name" id="'+arr_i+'spanHG-' + parent_id + '-' + hdata_host.Host[i].HostId + '" style="width: 12em;" title="'+hdata_host.Host[i].HostName+'(' + hdata_host.Host[i].HostIP + ')'+'">' + 
									'<span class="h-name-son" style="">' + 
									(hdata_host.Host[i].HostIP + '(' + HostName_h + ')').split('').map(function (params) {
										return '<font>'+params+'</font>'    
									}).join('') + 
									'</span>'+
									'</span>'+
									'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
									'<ul style="display:none">Loading...</ul>');

								}
								else {
									switch (hdata_host.Host[i].Selected) {
										case 0:
											$H.html('<i class="' + i_class + '" data-id="HOST-' + hdata_host.Host[i].HostId + '" />'+
											'<input type="checkbox" id="HostId-' + parent_id + '-' + hdata_host.Host[i].HostId + '" data-check="0" class="zcheck zcheck-g" data-ifselect=false data-loadfirst=0 data-loadlast=' + hdata_host.Host[i].Selected + ' data-mode="' + hdata_host.Host[i].Mode + '" data-name="' + hdata_host.Host[i].HostIP + '\t' + hdata_host.Host[i].HostName + '">'+
											'<i class="h-eicon h-eicon-u" class="zcheck"></i>'+
											'<span class="h-name" id="'+arr_i+'spanHG-' + parent_id + '-' + hdata_host.Host[i].HostId + '" style="width: 12em;" title="'+hdata_host.Host[i].HostIP+'(' + hdata_host.Host[i].HostName + ')'+'">' + 
											'<span class="h-name-son" style="">' + 
												( hdata_host.Host[i].HostIP+ '(' +  + ')').split('').map(function (params) {
													return '<font>'+params+'</font>'    
												}).join('') + 
											'</span>'+
											'</span>'+
											'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
											'<ul style="display:none">Loading...</ul>');
											break;
										case 1:
											$H.html('<i class="' + i_class + '" data-id="HOST-' + hdata_host.Host[i].HostId + '" />'+
											'<input type="checkbox" id="HostId-' + parent_id + '-' + hdata_host.Host[i].HostId + '" data-check="2" class="zcheck zcheck-g" data-ifselect=false data-loadfirst=1 data-loadlast=' + hdata_host.Host[i].Selected + ' data-mode="' + hdata_host.Host[i].Mode + '" data-name="' + hdata_host.Host[i].HostIP + '\t' + hdata_host.Host[i].HostName + '">'+
											'<i class="h-eicon h-eicon-u" class="zcheck"></i>'+
											'<span class="h-name" id="'+arr_i+'spanHG-' + parent_id + '-' + hdata_host.Host[i].HostId + '" style="width: 12em;" title="'+hdata_host.Host[i].HostIP+'(' + hdata_host.Host[i].HostName + ')'+'">' + 
											'<span class="h-name-son" style="">' + 
												(hdata_host.Host[i].HostIP + '(' + HostName_h + ')').split('').map(function (params) {
													return '<font>'+params+'</font>'    
												}).join('') + 
											'</span>'+
											'</span>'+
											'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
											'<ul style="display:none">Loading...</ul>');
											break;
										case 2:
											$.each(last_object, function (i1, item1) {
												if ((item1.HostId == hdata_host.Host[i].HostId) && (item1.HGId == parseInt(parent_id))) {
													$auth = '<label ' + label_style + '><input type="checkbox" name="check' + hdata_host.Host[i].HostId + '" checked="checked" data-ifselect=true data-mode="' + hdata_host.Host[i].Mode + '" >主机托管</label>';
													return false;
												}
											})
											$H.html('<i class="' + i_class + '" data-id="HOST-' + hdata_host.Host[i].HostId + '" />'+
											'<input type="checkbox" checked="checked" id="HostId-' + parent_id + '-' + hdata_host.Host[i].HostId + '" data-check="1" class="zcheck zcheck-g" data-ifselect=false data-loadfirst=2 data-loadlast=' + hdata_host.Host[i].Selected + ' data-mode="' + hdata_host.Host[i].Mode + '" data-name="' + hdata_host.Host[i].HostIP + '\t' + hdata_host.Host[i].HostName + '">'+
											'<i class="h-eicon h-eicon-u" class="zcheck"></i>'+
											'<span class="h-name" id="'+arr_i+'spanHG-' + parent_id + '-' + hdata_host.Host[i].HostId + '" style="width: 12em;" title="'+hdata_host.Host[i].HostIP+'(' + hdata_host.Host[i].HostName + ')'+'">' + 
											'<span class="h-name-son" style="">' + 
												(hdata_host.Host[i].HostIP + '(' + HostName_h + ')').split('').map(function (params) {
													return '<font>'+params+'</font>'    
												}).join('') + 
												'</span>'+
											'</span>'+
											'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
											'<ul style="display:none">Loading...</ul>');
											break;
									}
								}
							}
							if (edit_id[num] > 0) {
								if (auth_type_checked) {
								} else {
									if (push_hid[num].indexOf(parent_id + ':' + hdata_host.Host[i].HostId + ":false") < 0) {
										if (ajax_find_host_doing == false) {
											push_hid[num].push(parent_id + ':' + hdata_host.Host[i].HostId + ":false");
										}
									}
								}
							}
							$(obj).append($H);
							_checkView1($(group_name + '#HostId-' + parent_id + '-' + hdata_host.Host[i].HostId));
						}
						_closeLoading();
						if (ajax_find_host_doing == false) {
							select_checkbox("Host", parent_id, num);
						}
						flag_loading = false;
					}
				});
			} else if (arr_i == 'HOST') {
				if (filter_flag_append[num] == true) filter_flag_append[num] = false;
				else _showLoading();
				$.ajax({
					url: '/bhost/get_host',
					type: "POST",
					async: true,
					cache: false,
					data: { a0: $("input[name=se]").val(), a1: id, a2: 'false' },
					beforeSend: function (xmlHttp) {
						xmlHttp.setRequestHeader("If-Modified-Since", "0");
						xmlHttp.setRequestHeader("Cache-Control", "no-cache");
					},
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							$(obj).empty();
							var flag_change = false;
							_loadfirst = obj.siblings('input.zcheck').attr("data-loadfirst");
							var parents_aid = $(obj).siblings('input.zcheck').attr('id').split('-');
							var parents_id = parents_aid[2];
							var parentss_id = parents_aid[1];
							//判断 父节点是否状态改变
							if (obj.siblings('input.zcheck').attr("data-loadfirst") == obj.siblings('input.zcheck').attr("data-loadlast")) {
								if (v == 1 && d == 0) {
									loadfirst = 2
								} else if (v == 1) {
									loadfirst = 2;
								} else if (v == 0) {
									loadfirst = 0;
								} else {
									loadfirst = 0;///
								}
							} else {

								if (_loadfirst == 0) {
									loadfirst = 0;
								} else if (_loadfirst == 1) {
									loadfirst = 0;///
								} else {
									loadfirst = 2;
								}
								flag_change = true;
							}
							var host_data = result.info;
							$.each(host_data.AccountSet, function (i, item) {
								if(item.HostAccount==null || item.HostAccount.AccountName=='SSO' || item.PasswordType==0 ||item.PasswordType==3){
									return true;
								}
								var $H = $('<li></li>');
								var PasswordAuth_str = '';
								var PasswordAuth_str_title='';
								var HostServiceSet_str = item.HostServiceSet.filter(function (params) {
									return (params.ProtocolName == 'RDP' || params.ProtocolName == 'SSH' || params.ProtocolName == 'RLOGIN' || params.ProtocolName == 'TELNET' || params.ProtocolName == 'MYSQL' || params.ProtocolName == 'ORACLE' || params.ProtocolName == 'MSSQL' || params.ProtocolName == 'SYBASE' || params.ProtocolName == 'DB2');
								}).map(function (params) {
									return params.ProtocolName;
								});
								HostServiceSet_str=method1(HostServiceSet_str);
								if (HostServiceSet_str.length == 0) {
									return true;
								} else {
									// PasswordAuth_str = autoAddEllipsis(item.HostAccount.AccountName, '12') + '(' + HostServiceSet_str.join('，') + ')';
									PasswordAuth_str = item.HostAccount.AccountName + '(' + HostServiceSet_str.join('，') + ')';
									PasswordAuth_str_title = item.HostAccount.AccountName + '(' + HostServiceSet_str.join('，') + ')';
								}
								if (v == 1 && d == 0) {
									$H.html('<i class="h-blank"/>'+
									'<input type="checkbox" checked="checked" id="PasswordAuthId-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" value="' + item.PasswordAuthId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=2 data-name="' + item.HostAccount.AccountName + '">'+
									'<i class="h-eicon h-eicon-a"></i>'+
									'<span class="h-name h-name2" id="'+arr_i+'spanHG-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" style="width: 12em;" title="'+PasswordAuth_str_title+'">' + 
									'<span class="h-name-son" style="">' + 
										PasswordAuth_str.split('').map(function (params) {
											return '<font>'+params+'</font>'    
										}).join('') + 
									'</span>'+
									'</span>');
								} else if (v == 1) {
									$H.html('<i class="h-blank"/>'+
									'<input type="checkbox" checked="checked" id="PasswordAuthId-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" value="' + item.PasswordAuthId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=2 data-name="' + item.HostAccount.AccountName + '">'+
									'<i class="h-eicon h-eicon-a"></i>'+
									'<span class="h-name h-name2" id="'+arr_i+'spanHG-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" style="width: 12em;" title="'+PasswordAuth_str_title+'">' + 
									'<span class="h-name-son" style="">' + 
										PasswordAuth_str.split('').map(function (params) {
											return '<font>'+params+'</font>'    
										}).join('') + 
										'</span>'+
									'</span>');
								} else if (v == 0) {
									$H.html('<i class="h-blank"/>'+
									'<input type="checkbox" id="PasswordAuthId-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" value="' + item.PasswordAuthId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=0 data-name="' + item.HostAccount.AccountName + '">'+
									'<i class="h-eicon h-eicon-a"></i>'+
									'<span class="h-name h-name2" id="'+arr_i+'spanHG-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" style="width: 12em;" title="'+PasswordAuth_str_title+'">' + 
									'<span class="h-name-son" style="">' + 
										PasswordAuth_str.split('').map(function (params) {
											return '<font>'+params+'</font>'    
										}).join('') + 
										'</span>'+
									'</span>');
								} else {
									$H.html('<i class="h-blank" />'+
									'<input type="checkbox" id="PasswordAuthId-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" value="' + item.PasswordAuthId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=0 data-name="' + item.HostAccount.AccountName + '">'+
									'<i class="h-eicon h-eicon-a"></i>'+
									'<span class="h-name h-name2" id="'+arr_i+'spanHG-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" style="width: 12em;" title="'+PasswordAuth_str_title+'">' + 
									'<span class="h-name-son" style="">' + 
										PasswordAuth_str.split('').map(function (params) {
											return '<font>'+params+'</font>'    
										}).join('') + 
										'</span>'+
									'</span>');
									$.each(pwdauth.PasswordAuthSet, function (i, item1) {
										if (item1.PasswordAuthId == item.PasswordAuthId) {
											$H.html('<i class="h-blank"/>'+
											'<input type="checkbox" checked="checked" id="PasswordAuthId-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" value="' + item.PasswordAuthId + '" class="zcheck zcheck-g" data-loadfirst=' + loadfirst + ' data-loadlast=2 data-name="' + item.HostAccount.AccountName + '">'+
											'<i class="h-eicon h-eicon-a"></i>'+
											'<span class="h-name h-name2" id="'+arr_i+'spanHG-' + parentss_id + '-' + parents_id + '-' + item.HostAccount.AccountId + '" style="width: 12em;" title="'+PasswordAuth_str_title+'">' + 
											'<span class="h-name-son" style="">' + 
												PasswordAuth_str.split('').map(function (params) {
													return '<font>'+params+'</font>'    
												}).join('') + 
											'</span>'+
											'</span>');
											return false;
										}
									});
								}
								$(obj).append($H);
							});
						} else {
							_alert(1, '自动改密', result.ErrMsg);
							return false;
						}
						if (d == 0) {
							$(obj).find('input').prop('disabled', true);
							if ($(obj).siblings('span.authtype').find('input').length > 0) {
								if ($(obj).siblings('span.authtype').find('input').next('span').attr('class').indexOf('checked') != -1 || $(obj).siblings('input').prop('disabled')) {

								} else {
									$(obj).find('input').each(function () {
										$(this).attr('disabled', false);
										$(this).next('span.checkbox').removeClass('disabled');
									});
								}
							}
						}
						_checkView_host(obj);
						_closeLoading();
					},
					error: function (XmlHttpRequest, textStatus, errorThrown) {

					}
				});
			} else if (arr_i == 'UG') {
				var PwdModStrategy = $('#PwdModStrategy').data('value');
				//////console.log(PwdModStrategy);
				if (PwdModStrategy == "" || PwdModStrategy==undefined) {
					PwdModStrategy = 0
				}
				if(PwdModStrategy==0 && old_pwdmod_id>0){
					PwdModStrategy=old_pwdmod_id;
				}
				$.ajax({
					url: '/bhost/get_userdirectory',
					type: "POST",
					async: true,
					cache: false,
					data: { a0: $("input[name=se]").val(), a1: usercode, a2: id, a5: parseInt(PwdModStrategy), a6: type[2] },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							var user_data = result.info;
							var total_all = user_data.totalrow;
							$(obj).empty();
							$.each(user_data.data.UGroup, function (i, item) {
								var $H = $('<li></li>');
								var d0 = 1;
								var $auth = '<label><input type="checkbox" name="check' + item.UGId + '">组发送</label>';
								if (item_pwd != null) {
									$.each(item_pwd.ReceiverSet, function (i1, item1) {
										if (item1.Id == item.UGId && item1.Type == 2) {
											$auth = '<label><input type="checkbox" name="check' + item.UGId + '" checked="checked">组发送</label>';
											d0 = 0;
											return false;
										}
									});
								}
								if (item.MemberNum + item.UserNum) {
									var i_class = 'class="h-aicon"';
								} else {
									var i_class = 'class="h-blank"';
								}
								if (v == 1 && d == 0) {
									$auth = '<label><input type="checkbox" name="check' + item.UGId + '" checked="checked">组发送</label>';
									$H.html('<i ' + i_class + ' data-id="' + arr_i + '-' + item.UGId + '" />'+
									'<input type="checkbox" checked="checked" id="UGId-' + item.UGId + '" data-check="1" class="zcheck zcheck-g" data-name="'+item.UGName+'">'+
									'<i class="h-eicon h-eicon-s"></i>'+
									'<span class="h-name" id="'+arr_i+'spanHG-' + item.UGId + '" style="width: 12em;" title="'+item.UGName+'">' + 
										'<span class="h-name-son" style="">' + 
										item.UGName.split('').map(function (params) {
											return '<font>'+params+'</font>'    
										}).join('') + 
										'</span>'+
									'</span>'+
									'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
									'<ul style="display:none">Loading...</ul>');
									$(obj).append($H);
								} else if (v == 1) {
									$H.html('<i ' + i_class + ' data-id="' + arr_i + '-' + item.UGId + '" />'+
									'<input type="checkbox" checked="checked" id="UGId-' + item.UGId + '" data-check="1" class="zcheck zcheck-g" data-name="'+item.UGName+'">'+
									'<i class="h-eicon h-eicon-s"></i>'+
									'<span class="h-name" id="'+arr_i+'spanHG-' + item.UGId + '" style="width: 12em;" title="'+item.UGName+'">' + 
										'<span class="h-name-son" style="">' + 
										item.UGName.split('').map(function (params) {
											return '<font>'+params+'</font>'    
										}).join('') + 
									'</span>'+
									'</span>'+
									'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
									'<ul style="display:none">Loading...</ul>');
									$(obj).append($H);
								} else if (v == 0) {
									$H.html('<i ' + i_class + ' data-id="' + arr_i + '-' + item.UGId + '" />'+
									'<input type="checkbox" id="UGId-' + item.UGId + '" data-check="0" class="zcheck zcheck-g" data-name="'+item.UGName+'">'+
									'<i class="h-eicon h-eicon-s"></i>'+
									'<span class="h-name" id="'+arr_i+'spanHG-' + item.UGId + '" style="width: 12em;" title="'+item.UGName+'">' + 
										'<span class="h-name-son" style="">' + 
										item.UGName.split('').map(function (params) {
											return '<font>'+params+'</font>'    
										}).join('') + 
									'</span>'+
									'</span>'+
									'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
									'<ul style="display:none">Loading...</ul>');
									$(obj).append($H);
								} else {
									switch (item.Selected) {
										case 0:
											$H.html('<i ' + i_class + ' data-id="' + arr_i + '-' + item.UGId + '" />'+
											'<input type="checkbox" id="UGId-' + item.UGId + '" data-check="' + item.Selected + '" class="zcheck zcheck-g" data-name="'+item.UGName+'">'+
											'<i class="h-eicon h-eicon-s"></i>'+
											'<span class="h-name" id="'+arr_i+'spanHG-' + item.UGId + '" style="width: 12em;" title="'+item.UGName+'">' + 
											'<span class="h-name-son" style="">' + 
												item.UGName.split('').map(function (params) {
													return '<font>'+params+'</font>'    
												}).join('') + 
											'</span>'+
											'</span>'+
											'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
											'<ul style="display:none">Loading...</ul>');
											$(obj).append($H);
											break;
										case 1:
											item.Selected = 2;
											$H.html('<i ' + i_class + ' data-id="' + arr_i + '-' + item.UGId + '" />'+
											'<input type="checkbox" id="UGId-' + item.UGId + '" data-check="' + item.Selected + '" class="zcheck zcheck-g" data-name="'+item.UGName+'">'+
											'<i class="h-eicon h-eicon-s"></i>'+
											'<span class="h-name" id="'+arr_i+'spanHG-' + item.UGId + '" style="width: 12em;" title="'+item.UGName+'">' + 
											'<span class="h-name-son" style="">' + 
												item.UGName.split('').map(function (params) {
													return '<font>'+params+'</font>'    
												}).join('') + 
											'</span>'+
											'</span>'+
											'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
											'<ul style="display:none">Loading...</ul>');
											$(obj).append($H);
											break;
										case 2:
											item.Selected = 1;
											$H.html('<i ' + i_class + ' data-id="' + arr_i + '-' + item.UGId + '" />'+
											'<input type="checkbox" checked="checked" id="UGId-' + item.UGId + '" data-check="' + item.Selected + '" class="zcheck zcheck-g" data-name="'+item.UGName+'">'+
											'<i class="h-eicon h-eicon-s"></i>'+
											'<span class="h-name" id="'+arr_i+'spanHG-' + item.UGId + '" style="width: 12em;" title="'+item.UGName+'">' + 
											'<span class="h-name-son" style="">' + 
												item.UGName.split('').map(function (params) {
													return '<font>'+params+'</font>'    
												}).join('') + 
											'</span>'+
											'</span>'+
											'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
											'<ul style="display:none">Loading...</ul>');
											$(obj).append($H);
											break;
									}
								}
							});
							$.each(user_data.data.User, function (i, item) {
								if (v == 1 && d == 0) {
									$(obj).append('<li><i class="h-blank" />'+
										'<input type="checkbox" checked="checked" id="UserId-' + id + '-' + item.UserId + '" class="zcheck zcheck-g" data-name="'+item.UserCode+'">'+
										'<i class="h-eicon h-eicon-r"></i>'+
										'<span class="h-name" id="'+arr_i+'spanHG-' + id + '-' + item.UserId + '" style="width: 12em;" title="'+item.UserCode+'">' + 
											'<span class="h-name-son" style="">' + 
											item.UserCode.split('').map(function (params) {
													return '<font>'+params+'</font>'    
												}).join('') + 
										'</span>'+
										'</span>'+
										'</li>');
								} else if (v == 1) {
									$(obj).append('<li><i class="h-blank" />'+
										'<input type="checkbox" checked="checked" id="UserId-' + id + '-' + item.UserId + '" class="zcheck zcheck-g" data-name="'+item.UserCode+'">'+
										'<i class="h-eicon h-eicon-r"></i>'+
										'<span class="h-name" id="'+arr_i+'spanHG-' + id + '-' + item.UserId + '" style="width: 12em;" title="'+item.UserCode+'">' + 
											'<span class="h-name-son" style="">' + 
											item.UserCode.split('').map(function (params) {
												return '<font>'+params+'</font>'    
											}).join('') + 
										'</span>'+
										'</span>'+
										'</li>');
								} else if (v == 0) {
									$(obj).append('<li><i class="h-blank" />'+
										'<input type="checkbox" id="UserId-' + id + '-' + item.UserId + '" class="zcheck zcheck-g" data-name="'+item.UserCode+'">'+
										'<i class="h-eicon h-eicon-r"></i>'+
										'<span class="h-name" id="'+arr_i+'spanHG-' + id + '-' + item.UserId + '" style="width: 12em;" title="'+item.UserCode+'">' + 
											'<span class="h-name-son" style="">' + 
											item.UserCode.split('').map(function (params) {
												return '<font>'+params+'</font>'    
											}).join('') + 
											'</span>'+
										'</span>'+
										'</li>');
								} else {
									if (item.Selected == 2) {
										var $H = $('<li><i class="h-blank" />'+
											'<input type="checkbox"  checked="checked" id="UserId-' + id + '-' + item.UserId + '" class="zcheck zcheck-g" data-name="'+item.UserCode+'">'+
											'<i class="h-eicon h-eicon-r"></i>'+
											'<span class="h-name" id="'+arr_i+'spanHG-' + id + '-' + item.UserId + '" style="width: 12em;" title="'+item.UserCode+'">' + 
											'<span class="h-name-son" style="">' + 
												item.UserCode.split('').map(function (params) {
													return '<font>'+params+'</font>'    
												}).join('') + 
												'</span>'+
											'</span>'+
											'</li>');
									} else {
										var $H = $('<li><i class="h-blank" />'+
											'<input type="checkbox" id="UserId-' + id + '-' + item.UserId + '" class="zcheck zcheck-g" data-name="'+item.UserCode+'">'+
											'<i class="h-eicon h-eicon-r"></i>'+
											'<span class="h-name" id="'+arr_i+'spanHG-' + id + '-' + item.UserId + '" style="width: 12em;" title="'+item.UserCode+'">' + 
											'<span class="h-name-son" style="">' + 
												item.UserCode.split('').map(function (params) {
													return '<font>'+params+'</font>'    
												}).join('') + 
												'</span>'+
											'</span>'+
											'</li>');
									}
									$(obj).append($H);
								}
							});
							if (d == 0) {
								$(obj).find('input').prop('disabled', true);
							}
							_checkView_user(obj);
						} else {
							_alert(1, '自动改密', result.ErrMsg);
							return false;
						}
					}
				});
			}
			return true;
		}

		var _viewHTML_fun=false;
		function _viewHTML(obj, arr_i) {
			if (arr_i.indexOf('HG') >= 0) {
				if (arr_i == 'HG') {
					var num = 0;
					var group_value = '组托管'
				} else {
					var num = 1;
					var group_value = '组授权'
				}
				$(obj).empty();
				$.ajax({
					url: '/bhost/get_hostdirectory',
					type: 'POST',
					async: true,
					cache: false,
					data: { a0: $("input[name=se]").val(), a2: "0", a5: edit_id[num], a6: type[num] },
					success: function (result) {
						count_ajax = count_ajax + 1;
						var result = JSON.parse(result);
						if (result.Result) {
							var host_data = result.info.data;
							if (edit_id[num] > 0) {
								$(host_data.HGroup).each(function (i, item) {
									if (push_hgid[num].indexOf(item.HGId) < 0) {
										push_hgid[num].push(item.HGId + ":false");
									}
								})
							}
							$(obj).empty();
							disabled_flag = "";
							if (edit_id[num] > 0) disabled_flag = "disabled";
							$.each(host_data.HGroup, function (i, item) {
								if(num==1)	item.Mode = 2;
								if (item.Mode == 2)
									var $auth = '<label><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + ' " >' + group_value + '</label>';
								else
									var $auth = '<label style="display:none;"><input type="checkbox" name="check' + item.HGId + '" data-ifselect=false ' + disabled_flag + ' data-mode="' + item.Mode + '">' + group_value + '</label>';
								if (item.HGId == 1)
									var $auth = '';
								var $H = $('<li></li>');
								if ((item.MemberNum + item.HostNum) == 0) i_class = "h-blank";
								else i_class = "h-aicon";
								$H.html('<i class="' + i_class + '" data-id="' + arr_i + '-' + item.HGId + '" />'+
								'<input type="checkbox" id="HGId-' + item.HGId + '" data-check="0" class="zcheck zcheck-g" ' + disabled_flag + ' data-loadfirst=0 data-loadlast=0 data-ifselect=false data-mode="2" data-name="' + item.HGName + '">'+
								'<i class="h-eicon h-eicon-g" ></i>'+
								'<span class="h-name" title="'+item.HGName+'" id="'+arr_i+'spanHG-' + item.HGId + '" style="width: 12em;">' + 
								'<span class="h-name-son" style="">' + 
									item.HGName.split('').map(function (params) {
										return '<font>'+params+'</font>'    
									}).join('') + 
								'</span>'+
								'</span>'+
								'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
								'<ul style="display:none">Loading...</ul>');
								$(obj).append($H);
							});
							_checkView_host(obj);
							if (edit_id[num] > 0) {
								select_checkbox("HGroup", 0, num);	 //只有编辑情况下 才需要判断 select 
							}else{
								select_checkbox_fun=false;
							}
							_viewHTML_fun=false;
						} else {
							if (num == 0) {
								_alert(1, '自动改密', result.ErrMsg);
							} else {
								_alert(1, '服务器集合', result.ErrMsg);
							}
							select_checkbox_fun=false;
							_viewHTML_fun=false;
							return false;
						}
					}
				});
			} else if (arr_i == 'UG') {
				var PwdModStrategy = $('#PwdModStrategy').data('value');
				if (PwdModStrategy == "" || PwdModStrategy==undefined) {
					PwdModStrategy = 0;
				}
				if(PwdModStrategy==0 && old_pwdmod_id>0){
					PwdModStrategy=old_pwdmod_id;
				}
				$.ajax({
					url: '/bhost/get_userdirectory',
					type: "POST",
					async: true,
					cache: false,
					data: { a0: $("input[name=se]").val(), a1: usercode, a2: "0", a5: parseInt(PwdModStrategy), a6: type[2] },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							var user_data = result.info;
							var total_all = user_data.totalrow;
							$(obj).empty();
							$.each(user_data.data.UGroup, function (i, item) {
								var $H = $('<li></li>');
								var d = 1;
								if (item.UGId == 1) {
									var $auth = '';
								} else {
									var $auth = '<label><input type="checkbox" name="check' + item.UGId + '">组发送</label>';
									if (item_pwd != null) {
										$.each(item_pwd.ReceiverSet, function (i1, item1) {
											if (item1.Id == item.UGId && item1.Type == 2) {
												$auth = '<label><input type="checkbox" name="check' + item.UGId + '" checked="checked">组发送</label>';
												d = 0;
												return false;
											}
										});
									}
								}
								var i_class = 'class="h-blank"';
								if (item.MemberNum + item.UserNum) {
									var i_class = 'class="h-aicon"';
								}
								switch (item.Selected) {
									case 0:
										$H.html('<i ' + i_class + ' data-id="' + arr_i + '-' + item.UGId + '" />'+
										'<input type="checkbox" id="UGId-' + item.UGId + '" data-check="' + item.Selected + '" class="zcheck zcheck-g" data-name="'+item.UGName+'">'+
										'<i class="h-eicon h-eicon-s"></i>'+
										'<span class="h-name" title="'+item.UGName+'" id="'+arr_i+'spanHG-' + item.UGId + '" style="width: 12em;">' + 
										'<span class="h-name-son" style="">' + 
											item.UGName.split('').map(function (params) {
												return '<font>'+params+'</font>'    
											}).join('') + 
										'</span>'+
										'</span>'+
										'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
										'<ul style="display:none">Loading...</ul>');
										$(obj).append($H);
										break;
									case 1:
										item.Selected = 2;
										$H.html('<i ' + i_class + ' data-id="' + arr_i + '-' + item.UGId + '" />'+
										'<input type="checkbox" id="UGId-' + item.UGId + '" data-check="' + item.Selected + '" class="zcheck zcheck-g" data-name="'+item.UGName+'">'+
										'<i class="h-eicon h-eicon-s"></i>'+
										'<span class="h-name" title="'+item.UGName+'" id="'+arr_i+'spanHG-' + item.UGId + '" style="width: 12em;">' + 
										'<span class="h-name-son" style="">' + 
											item.UGName.split('').map(function (params) {
												return '<font>'+params+'</font>'    
											}).join('') + 
										'</span>'+
										'</span>'+
										'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
										'<ul style="display:none">Loading...</ul>');
										$(obj).append($H);
										break;
									case 2:
										item.Selected = 1;
										$H.html('<i class="h-aicon" data-id="' + arr_i + '-' + item.UGId + '" />'+
										'<input type="checkbox" checked="checked" id="UGId-' + item.UGId + '" data-check="' + item.Selected + '" class="zcheck zcheck-g" data-name="'+item.UGName+'">'+
										'<i class="h-eicon h-eicon-s"></i>'+
										'<span class="h-name" title="'+item.UGName+'" id="'+arr_i+'spanHG-' + item.UGId + '" style="width: 12em;">' + 
										'<span class="h-name-son" style="">' + 
											item.UGName.split('').map(function (params) {
												return '<font>'+params+'</font>'    
											}).join('') + 
										'</span>'+
										'</span>'+
										'<span class="authtype" style="display:inline-block">' + $auth + '</span>'+
										'<ul style="display:none">Loading...</ul>');
										$(obj).append($H);
										break;
								}
							});
							_checkView_user(obj);
						} else {
							_alert(1, '自动改密', result.ErrMsg);
							return false;
						}
					}
				});
				
			}
		}
		function _checkView_user(obj) {
			_authTypeTheme($('span.authtype input', obj));
			$('input.zcheck', obj).each(function () {
				var $s = $('<span class="checkbox"></span>');
				$(this).after($s);
				var v = $(this).prop('checked');
				if (v) {
					$s.addClass('checked');
				} else {
					var c = $(this).data('check');
					if (c && c == 2) {
						$s.addClass('half');
					}
				}
				var d = $(this).prop('disabled');
				if (d) {
					$s.addClass('disabled');
				}
				var span_id = $(this).siblings('span.h-name').attr('id');
				setTimeout(function () {
					if (_jScrollBar_array.indexOf(span_id) === -1) {
						_jScrollBar_array.push(span_id);
						_jScrollBar(span_id);
					}
				}, 100);
			}).on('change', function () {
				var v = $(this).prop('checked');
				var $s = $(this).next('span.checkbox');
				var $u = $(this).parent().children('ul').find('li');
				var $authInput = $(this).siblings('span.authtype').find('input');
				if (v) {
					$s.attr('class', 'checkbox checked');
					$('input.zcheck', $u).prop('checked', true);
					$('span.checkbox:first', $u).attr('class', 'checkbox checked');
					$u.each(function () {
						if ($(this).children('span.authtype').find('input').prop('checked')) {
							var $u_li = $(this).children('ul').find('li');
							$('input.zcheck', $u_li).prop('disabled', true);
							$('span.checkbox:first', $u_li).addClass('disabled');
						};
					});
				} else {
					$s.attr('class', 'checkbox');
					$('input', $u).prop('checked', false).prop('disabled', false);
					$('span.checkbox', $u).attr('class', 'checkbox');
					$authInput.prop('checked', false).trigger('change');
					$(this).siblings('span.authtype').find('span').attr('class', 'checkbox');
				}
				_checkEvent(this);
			});
		}

		function _checkEvent(obj) {
			var _run = function () {
				var $li = $(obj).parent().parent().parent();
				var tagname = $li[0].tagName.toLowerCase();
				var v = $(obj).prop('checked');

				if (tagname == 'li') {
					var c1 = 0, c2 = 0;
					var len = $(obj).parent().parent().children('li').length;
					$(obj).parent().parent().children('li').each(function () {
						var c = $(this).children('span.checkbox').attr('class');
						if (c.indexOf('checked') > 0) {
							c1++;
						} else if (c.indexOf('half') > 0) {
							c2++;
						}

						if (c1 == len) {
							var span_class = $li.children('input.zcheck').prop('checked', false).siblings('span.checkbox').attr('class');
							var d_class = "";
							if (span_class.indexOf('disabled') != -1) {
								d_class = 'disabled';
							}
							var attr_class = 'checkbox checked ' + d_class;
							$li.children('input.zcheck').prop('checked', true).siblings('span.checkbox').attr('class', attr_class);
							$li.children('input.zcheck').attr("data-loadlast", 2);
						} else if (c1 == 0 && c2 == 0) {
							$li.children('input.zcheck').prop('checked', false).prop('disabled', false).siblings('span.checkbox').attr('class', 'checkbox').removeClass('disabled');
							$li.children('input.zcheck').attr("data-loadlast", 0);
							$li.children('input.zcheck').siblings('span.authtype').children('input').prop('checked', false).siblings('span.checkbox').attr('class', 'checkbox');
						} else {
							var span_class = $li.children('input.zcheck').prop('checked', false).siblings('span.checkbox').attr('class');
							var d_class = "";
							if (span_class.indexOf('disabled') != -1) {
								d_class = 'disabled';
							}
							var attr_class = 'checkbox half ' + d_class;
							$li.children('input.zcheck').prop('checked', false).siblings('span.checkbox').attr('class', attr_class);
							$li.children('input.zcheck').attr("data-loadlast", 1);
						}
					});
					_checkEvent($li.children('input.zcheck'));
				} else {
					return;
				}
			}
			_run();
		}


		//检查格式
		function dataCheck(obj, min, max) {//min can not bigger than 1
			obj.value = obj.value.replace(/\D/g, "");
			if (min) {
				if (parseInt(obj.value, 10) < parseInt(min, 10)) obj.value = min;
			}
			if (max) {
				if (parseInt(obj.value, 10) > parseInt(max, 10)) obj.value = max;
			}
		}
		//添加零
		function add_zero(obj) {
			obj.value = obj.value.replace(/\D/g, "");
			var v = obj.value.trim();
			if (v == "") {
				v = '00';
			}
			v = parseInt(v);
			if (v <= 0) {
				v = '00';
			} else if (v >= 1 && v <= 9) {
				v = '0' + v;
			}
			obj.value = v;
		}
		function pwd_clear() {
			time_show(0);
			$('#PeriodValue').val(30);
			$('#PeriodType').val(1).trigger('change');
			$('#a1').iCheck('check');
			$('#Password').hide();
			$('#Password').val('');
			pwdmod.Password = null;
			pwdauth_save.PwdModStrategyInfo.Password=null;
			$('#ResultSendMethod').val(3).trigger('change');
			$('.xSelect_stmp1').data('value',0);
			$('.xSelect_stmp1 .xSelect-show-text').text('全局指定');
			$('.xSelect_stmp2').data('value',0);
			$('.xSelect_stmp2 .xSelect-show-text').text('全局指定');
			$('.xSelect_ftp1').data('value',0);
			$('.xSelect_ftp1 .xSelect-show-text').text('全局指定');
			$('.xSelect_ftp2').data('value',0);
			$('.xSelect_ftp2 .xSelect-show-text').text('全局指定');
			update_xSelect($('.xSelect_stmp1'));
			update_xSelect($('.xSelect_stmp2'));
			update_xSelect($('.xSelect_ftp1'));
			update_xSelect($('.xSelect_ftp2'));
			$('#select_r li').remove();
			$('#select_r2 li').remove();
			$('#ReceiverSet option[value!=0]').remove();
			$('#ReceiverSet2 option[value!=0]').remove();
			$.ajax({
				url: '/bhost/get_user_all_admin',
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(),a1:1 },
				success: function (result) {
					var result=JSON.parse(result);
					if(result.Result){
						ReceiverSet_array=new Array();
						ReceiverSet_array2=new Array();
						$.each(result.info,function (i,params) {
							if(params.Email!='' && params.Email!=null){
								ReceiverSet_array[params.UserId]='<option value="'+params.UserId+'">'+params.UserCode+'</option>';
							}
							ReceiverSet_array2[params.UserId]='<option value="'+params.UserId+'">'+params.UserCode+'</option>';
						});
						$('#ReceiverSet').append(ReceiverSet_array.join(''));
						$('#ReceiverSet2').append(ReceiverSet_array2.join(''));
					}else{
						_alert(1,'自动改密',result.ErrMsg);
						pass=false;
						return false;
					}
				}
			});
			$('#ReceiverSet').val(0).trigger('change');
			$('#ReceiverSet2').val(0).trigger('change');
		}
		//smtp_master_clear
		function smtp_master_clear() {
			$('#SmtpConfigName_Master').attr("disabled", false);
			$('#SmtpConfigName_Master').val('');
			$('#SmtpConfigName_Master').next('i.v-check').attr('class','v-check');
			$('#SmtpServer_Master').val('');
			$('#Sender_Master').val('');
			$('#SenderEmail_Master').val('');
			$('#AttachMaxLimit_Master').val('');
			$('#b1').iCheck('check');
			$('#SenderEmailPass_Master').val('');
			smtpconfig_save.SenderEmailPass = null;
			$('#test_Master').iCheck('uncheck');
			$('#test_Master').parents('label').next('span.forCheck').hide();
			$('#test_Master_input').val('');
			$('#DNS_Master').val('');
			$('#EnCode').val(0).trigger('change');
			var smtpconfig_data_all_Flag=smtpconfig_data_all.map(function (params) {
				return params.Flag;
			});
			if($.inArray(2,smtpconfig_data_all_Flag)<0){
				$('#Flag').val(2).trigger('change');
			}else if($.inArray(1,smtpconfig_data_all_Flag)<0){
				$('#Flag').val(1).trigger('change');
			}else{
				$('#Flag').val(0).trigger('change');
			}
		}
		//ftp_master_clear
		function ftp_master_clear() {
			$("#FTPServerName_Master").val('');
			$("#FTPServerName_Master").attr("disabled", false);
			$('#FTPServerName_Master').next('i.v-check').attr('class','v-check');
			$('#ServerIP_Master').val('');
			$('#ServerUser_Master').val('');
			$('#ServerPasswd_Master').val('');
			ftpserver_save.ServerPasswd = null;
			$('#ServerPath_Master').val('');
			$('#DNS_FTP_Master').val('');
			var ftpconfig_data_all_Flag=ftpconfig_data_all.map(function (params) {
				return params.Flag;
			});
			if($.inArray(2,ftpconfig_data_all_Flag)<0){
				$('#ftpFlag').val(2).trigger('change');
			}else if($.inArray(1,ftpconfig_data_all_Flag)<0){
				$('#ftpFlag').val(1).trigger('change');
			}else{
				$('#ftpFlag').val(0).trigger('change');
			}
		}
		//disabled_ftp
		function disabled_ftp() {
			$('#FTPServer_Stand').hide();
			$('#StandByFTPServer').attr('disabled', true);
			$('#FTPServerName_Stand').attr('disabled', true);
			$('#ServerIP_Stand').attr('disabled', true);
			$('#ServerUser_Stand').attr('disabled', true);
			$('#ServerPasswd_Stand').attr('disabled', true);
			$('#ServerPath_Stand').attr('disabled', true);
			$('#DNS_FTP_Stand').attr('disabled', true);
		}
		//disabled_smtp
		function disabled_smtp() {
			$('#SmtpConfig_Stand').hide();

			$('#SmtpConfigName_Stand').attr('disabled', true);
			$('#SmtpServer_Stand').attr('disabled', true);
			$('#Sender_Stand').attr('disabled', true);
			$('#SenderEmail_Stand').attr('disabled', true);
			$('#AttachMaxLimit_Stand').attr('disabled', true);
			$('#c1').iCheck('disable');
			$('#c2').iCheck('disable');
			$('#SenderEmailPass_Stand').attr('disabled', true);
			$('#test_Stand').iCheck('disable');
			$('#test_Stand').parents('label').next('span.forCheck').attr('disabled', true);
			$('#test_Stand_input').attr('disabled', true);
			$('#DNS_Stand').attr('disabled', true);
		}
		//remove_disabled_smtp
		/*		function remove_disabled_smtp() {
					$('#StandBySmtpConfig').removeAttr('disabled');
				}
		*/
		var time_now = null;
		function time_show(num) {
			var now = new Date();
			var year = now.getFullYear();
			var month = ("0" + (now.getMonth() + 1)).slice(-2);
			var date = ("0" + now.getDate()).slice(-2);
			var hour = ("0" + (now.getHours())).slice(-2);
			var second = ("0" + (now.getSeconds())).slice(-2);
			var minute = ("0" + (now.getMinutes())).slice(-2);
			time_now = year + "-" + month + "-" + date + 'T' + hour + ':' + minute + ':' + second;
			if (num == 0) {
				$('#StartDay').val(year + "-" + month + "-" + date);
				$('#Starth').val(hour);
				$('#Startm').val(minute);
				$('#Starts').val(second);
			}
		}
		//邮件FTP详细信息显示隐藏
		function _switchShow(obj) {
			var v = $(obj).val();
			if (v == 1) {
				$('.xSelect_stmp1').parents('.form-item').show();
				$('.xSelect_stmp2').parents('.form-item').show();
				$('.xSelect_ftp1').parents('.form-item').hide();
				$('.xSelect_ftp2').parents('.form-item').hide();
				$('#ReceiverSet').parents('.form-item').show();
				$('#ReceiverSet2').parents('.form-item').hide();
			} else if (v == 2) {
				$('.xSelect_stmp1').parents('.form-item').hide();
				$('.xSelect_stmp2').parents('.form-item').hide();
				$('.xSelect_ftp1').parents('.form-item').show();
				$('.xSelect_ftp2').parents('.form-item').show();
				$('#ReceiverSet').parents('.form-item').hide();
				$('#ReceiverSet2').parents('.form-item').show();
			} else if (v == 3 && hostpwd_data != null) {
				$('.xSelect_stmp1').parents('.form-item').hide();
				$('.xSelect_stmp2').parents('.form-item').hide();
				$('.xSelect_ftp1').parents('.form-item').hide();
				$('.xSelect_ftp2').parents('.form-item').hide();
				$('#ReceiverSet').parents('.form-item').hide();
				$('#ReceiverSet2').parents('.form-item').hide();
				if((hostpwd_data.ReceiverSet==null || hostpwd_data.ReceiverSet.length==0)){
					parent.layer.open({
						type: 1,
						title: '自动改密',
						content: '<div class="layer-alert"><i class="alert warning"></i>改密设定未配置</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						yes: function (i) {
							parent.layer.close(i);
							hostpwdstrategy();
						}
					});
				}
			} else if (v == 3 && hostpwd_data == null) {
				parent.layer.open({
					type: 1,
					title: '自动改密',
					content: '<div class="layer-alert"><i class="alert warning"></i>改密设定未配置</div>',
					btn: ['确&nbsp;&nbsp;定'],
					btnAlign: 'c',
					closeBtn: false,
					skin: 'layer-custom',
					area: ['380px', '310px'],
					move: false,
					resize: false,
					yes: function (i) {
						parent.layer.close(i);
						hostpwdstrategy();
					}
				});
			}
		}
		function get_dialog_ftp(obj, type) {
			ftp_master_clear();
			var title;
			if (type == 1) {
				var id = obj.value;
				title = "FTP配置";
				$.ajax({
					url: "/bhost/get_ftpserver",
					type: "POST",
					async: false,
					data: { a0: $("input[name=se]").val(),a1:id },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							var data = result.info.data[0];
							MasterFTPServer_input(data);
							$('#FTPServerName_Master').attr("disabled", true);
							ftpserver_save.FTPServerId=parseInt(id);
						} else {
							_alert(1, 'FTP服务器查询', result.ErrMsg);
							return false;
						}
					}
				});
			} else {
				title = "FTP配置";
				ftpserver_save.FTPServerId = 0;
			}
			var $dialogCont = $("#ftp_suspend").show();

			var d = dialog({
				title: title,
				content: $dialogCont,
				id: "ftp_suspend",
				width: "800px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				// d.close().remove();
				ftp_master_clear();
				if (type == 1) {
					var id = obj.value;
					$.ajax({
						url: "/bhost/get_ftpserver",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val(),a1:id },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								var data = result.info.data[0];
								MasterFTPServer_input(data);
								$('#FTPServerName_Master').attr("disabled", true);
								ftpserver_save.FTPServerId=parseInt(id);
							} else {
								_alert(1, 'FTP服务器查询', result.ErrMsg);
								return false;
							}
						}
					});
				} else {
					ftpserver_save.FTPServerId = 0;
				}
			});
			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				var FTPServerName_Master = $("#FTPServerName_Master").val();
				if (FTPServerName_Master == '') {
					_alert(2, 'FTP配置', '请输入名称', $('#FTPServerName_Master'));
					return false;
				} else if (!nameReg.test(FTPServerName_Master)) {
					_alert(1, 'FTP配置', '名称格式不正确', $('#FTPServerName_Master'));
					return false;
				}
				var DNS_FTP_Master = $('#DNS_FTP_Master').val();
				if (DNS_FTP_Master == "") {
					DNS_FTP_Master = null;
				}
				var ServerIP_Master = $('#ServerIP_Master').val();
				if (ServerIP_Master == "") {
					_alert(2, 'FTP配置', '请输入服务器地址地址', $('#ServerIP_Master'));
					return false;
				} else if (!ipReg.test(ServerIP_Master)) {
					_alert(1, 'FTP配置', '服务器地址地址格式不正确', $('#ServerIP_Master'));
					return false;
				}
				if (ServerIP_Master=='0.0.0.0' || ServerIP_Master=='255.255.255.255') {
					_alert(1, 'FTP配置', '服务器地址地址格式不正确', $('#ServerIP_Master'));
					return false;
				}
				var ServerUser_Master = $("#ServerUser_Master").val();
				if (ServerUser_Master == "") {
					_alert(2, 'FTP配置', '请输入用户名', $("#ServerUser_Master"));
					return false;
				}
				var ServerPasswd_Master = $('#ServerPasswd_Master').val();
				if (ServerPasswd_Master == "") {
					_alert(2, 'FTP配置', '请输入密码', $('#ServerPasswd_Master'));
					return false;
				}
				if(ServerPasswd_Master.length > 64){
					_alert(2, 'FTP配置', "密码不能超过系统限定64位", $("#ServerPasswd_Master"));
					return false;
				}
				var ServerPath_Master = $('#ServerPath_Master').val();
				if (ServerPath_Master == "") {
					_alert(2, 'FTP配置', '请输入上传路径', $('#ServerPath_Master'));
					return false;
				}
				ftpserver_save.FTPServerName = FTPServerName_Master;
				ftpserver_save.ServerIP = ServerIP_Master;
				ftpserver_save.DNS = DNS_FTP_Master;
				ftpserver_save.ServerUser = ServerUser_Master;
				ftpserver_save.ServerPasswd = ServerPasswd_Master;
				ftpserver_save.ServerPath = ServerPath_Master;
            	ftpserver_save.Flag=parseInt($('#ftpFlag').val());
            	ftpserver_save.IfPasv=$('#IfPasv').val()=='1';
				if (save_ftpserver()) {
					$('.btn').blur(); parent.layer.open({
						type: 1,
						title: 'FTP配置',
						content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						yes: function (i) {
							parent.layer.close(i);
							d.close().remove();
						}
					});
				}
			})
		}
		var $focusObj;
		//绑定服务器集合
		var serdata;
		var serverid_list = [];
		function binding_ServerScope() {
			$.ajax({
				url: '/bhost/get_ServerScope',
				type: 'post',
				async: false,
				data: { a0:$("input[name=se]").val()},
				success: function (result) {
					serdata = JSON.parse(result);
					var server_text_zdp_id=$('#server_text_zdp').data('value');
					if(server_text_zdp_id!=-1){
						if(serdata.data.filter(function(index){
							if(index.ServerScopeId==server_text_zdp_id){
								$('#server_text_zdp .xSelect-show-text').text(index.ServerScopeName);
								return true;
							}
							return false;
						}).length==0){
							$('#server_text_zdp').data('value',-1);
							server_id=-1;
						}else{
							
						}
					}
				}
			});
		}
		//初始化服务器集合
		function clear_server() {
			server = {
				"ServerScopeId": 0,
				"ServerScopeName": "",
				"IsApplyToClientScope": false,
				"HostList": [],
				"IPList": {
					"IPSetId": 0,
					"Set": []
				}
			}
			data_array_Path_z = null;
			search_typeall_r_z = '';
			$("#ip_n1").children('span').not('span:first').remove();
			$("#ip_n").children('span').not('span:first').remove();
			$('#ip_span1').find('input').val('');
			$('#ip_span').find('input').val('');
			$("#d_n").val('');
			$("#d_n").attr("disabled", false);
			$("#d_n").next('i').attr('class', 'v-check');
			$("#userTree1").empty();
			$("#server_select_z").val('all').trigger('change');
			$("#filterWW_z").children('ul').children('li').remove();
			$("#filterWW_z").hide();
			$('#server_text_z_check').hide();
			$("#server_text_z").val('');
			$('#part1').iCheck('check');
			_clearFilter1();
			ajax_find_host_doing = false;
			flag_ajax_true = true;
			select_checkbox_fun=true;
			_viewHTML_fun=true;
		}
		////服务器 浮层
		var d = null;
		function _editNode(obj, name) {
			clear_server();
			var title;
			if (name == 1) {//编辑服务器
				serverId = parseInt($(obj).children('span').data('value'));
				$.ajax({
					url: "/bhost/get_server_list",
					type: "POST",
					async: false,
					data: { a0: se, a1: serverId },
					success: function (result) {
						var server_result = JSON.parse(result);
						if (server_result.Result == true) {
							var server_data = server_result.info.data[0];
							//title = server_data.ServerScopeName;
							title = "服务器集合";
							server_edit = server_data;
							last_object[1] = server_edit.HostList;
							edit_id[1] = server_data.ServerScopeId;
						}
					}
				});
			} else if (name == 2) {
				server_edit = null;
				serverId = 0;
				edit_id[1] = 0;
				last_object[1]=null;
				title = "服务器集合";
			}
			var $dialogCont = $("#server_suspend").show();

			var d = dialog({
				title: title,
				content: $dialogCont,
				id: "server_suspend",
				width: "1000px"
			});
			d.addEventListener('close', function () {
				clear_server();
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			$(".ui-dialog-title").css("width", "140px");
			server_main(name);

			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				// d.close().remove();
				ajax_find_host_doing = false;
				flag_ajax_true = true;
				_waitDone($('.waitTipserver'), 0);
				//////console.log('_showLoading');
				select_checkbox_fun=true;
				_viewHTML_fun=true;
				_showLoading();
				clear_server();
				if (name == 1) {//编辑服务器
					serverId = parseInt($(obj).children('span').data('value'));
					$.ajax({
						url: "/bhost/get_server_list",
						type: "POST",
						async: false,
						data: { a0: se, a1: serverId },
						success: function (result) {
							var server_result = JSON.parse(result);
							if (server_result.Result == true) {
								var server_data = server_result.info.data[0];
								server_edit = server_data;
								last_object[1] = server_edit.HostList;
								edit_id[1] = server_data.ServerScopeId;
							}
						}
					});
				} else if (name == 2) {
					server_edit = null;
					serverId = 0;
					edit_id[1] = 0;
					last_object[1]=null;
				}
				server_main(name);
				var t;
				function run_() {
					clearTimeout(t);
					//////console.log('_viewHTML_fun:'+_viewHTML_fun+'|select_checkbox_fun:'+select_checkbox_fun);
					if(_viewHTML_fun==false && select_checkbox_fun==false){
						_closeLoading();
						//////console.log('_closeLoading');
					}else{
						t=setTimeout(function(){run_();},10);
					}
				}
				run_();
			});

			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				server_add(d);
			})
		}

		var server = {
			"ServerScopeId": 0,
			"ServerScopeName": "",
			"IsApplyToClientScope": false,
			"HostList": [],
			"EnableIPLimit":1,
			"IPList": {
				"IPSetId": 0,
				"Set": []
			}
		};
		var server_edit = null;
		var serverId = 0;
		function server_main(name) {
			if (name == 1) {
				$("#d_n").val(server_edit.ServerScopeName);
				$("#d_n").attr("disabled", true);
				server.ServerScopeId = server_edit.ServerScopeId;
				server.ServerScopeName = server_edit.ServerScopeName;
				if (server.IPList != null) {
					server.IPList.IPSetId = server_edit.IPList.IPSetId;
					if (server_edit.IPList.Set != null) {
						var IPset_group = server_edit.IPList.Set.filter(function (params) {
							return params.StartIP != params.EndIP
						});
						var IP_group = server_edit.IPList.Set.filter(function (params) {
							return params.StartIP == params.EndIP
						});
						for (var i = 0; i < IPset_group.length - 1; i++) {
							var item = IPset_group[i];
							var $c = $('<span class="ss" value="' + item.IPSetMemberId + '" style="float: left;width: 312px;position: static;padding: 0 0 10px 0;"/>');
							$c.html('<input type="text" class="form-text" value="' + item.StartIP + '" style="width:105px;">'
								+ '<span style="vertical-align:middle;padding-left: 4px;padding-right: 4px;">-</span>'
								+ '<input type="text" class="form-text" value="' + item.EndIP + '" style="width:105px;">'
								+ '<i class="ctr ctr-del" style="margin-top: 5px;margin-left: -3px;" onclick="_delIp(this)"></i>');
							$("#ip_n").find("span[class='ss ss-add']").after($c);
						}
						if (IPset_group.length != 0) {
							$('#ip_n').find("span[class='ss ss-add']").attr('value', IPset_group[i].IPSetMemberId);
							var $ip_input = $('#ip_n').find("span[class='ss ss-add']").find('input');
							$ip_input.first().val(IPset_group[i].StartIP);
							$ip_input.last().val(IPset_group[i].EndIP);
						}
						for (var i = 0; i < IP_group.length - 1; i++) {
							var item = IP_group[i];
							var $c = $('<span class="ss" value="' + item.IPSetMemberId + '" style="float: left;position: static;padding: 0 0 10px 0;"/>');
							$c.html('<input type="text" class="form-text" style="width:105px;" value="' + item.StartIP + '">'
								+ '<i class="ctr ctr-del" onclick="_delIp(this)" style="margin-top: 4px;margin-left: -3px;"></i>');
							$('#ip_n1').find("span[class='ss ss-add']").after($c);
						}
						if (IP_group.length != 0) {
							$('#ip_n1').find("span[class='ss ss-add']").attr('value', IP_group[i].IPSetMemberId);
							$('#ip_n1').find("span[class='ss ss-add']").find('input').val(IP_group[i].StartIP);
						}
					}
				}
				if(server_edit.EnableIPLimit == 0){
					$('#part1').iCheck('uncheck');
				}				
			}
			_initList1();
			parent._switchBtn(0);//隐藏按钮
		}

		//加载树
		function _initList1() {
			_viewHTML('#userTree1', 'SHG');
		}
		function _checkView1(obj) {
			_authTypeTheme($(obj).parent().find('span.authtype input'));
			$(obj).each(function () {
				var $s = $('<span class="checkbox"></span>');
				$(this).after($s);
				var v = $(this).prop('checked');
				if (v) {
					$s.addClass('checked');
				} else {
					var c = $(this).data('check');
					if (c && c == 2) {
						$s.addClass('half');
					}
				}

				var d = $(this).prop('disabled');
				if (d) {
					$s.addClass('disabled');
				}
				var span_id = $(this).siblings('span.h-name').attr('id');
				setTimeout(function () {
					if (_jScrollBar_array.indexOf(span_id) === -1) {
						_jScrollBar_array.push(span_id);
						_jScrollBar(span_id);
					}
				}, 100);
			}).on('change', function () {
				var v = $(this).prop('checked');
				var $s = $(this).next('span.checkbox');
				var $u = $(this).parent().children('ul');
				var d;
				if ($(this).siblings('span.authtype').find('input').is(':checked')) {
					d = 0;
				} else {
					d = 1;
				}

				if (v) {
					$s.attr('class', 'checkbox checked');
					$('input.zcheck', $u).prop('checked', true);
					$('span.checkbox', $u).attr('class', 'checkbox checked');
					$(this).attr("data-loadlast", "2");
					$(this).find('input.zcheck').attr('data-loadlast', 2);
				} else {
					$s.attr('class', 'checkbox');
					$('input.zcheck', $u).prop('checked', false).prop('disabled', false);
					$('span.checkbox', $u).attr('class', 'checkbox');
					$(this).siblings('span.authtype').find('input').prop('checked', false);
					$(this).siblings('span.authtype').find('span').attr('class', 'checkbox');
					$(this).siblings('span.authtype').find('span').trigger('change');
					//$u.find('span.authtype').find('input').iCheck('uncheck');	
					$(this).attr("data-loadlast", "0");
					$(this).siblings('ul').find('input.zcheck').attr('data-loadlast', 0);
				}


				_checkEvent(this);
			});
		}
		var atr = null;
		var atr_flag = 0;
		var select_checkbox_fun=false;
		///// 绑定 主机组状态
		function select_checkbox(select_flag, pid, num) {
			if (num == 0) {
				var group_name = '#userTree ';
			} else {
				var group_name = '#userTree1 '
			}
			if (select_flag == "HGroup") { //主机组 
				var i = 0;
				var index_w = 0;
				var indx = 0;
				var t_doselect;
				var c_count = 1;
				var index_a = 0;
				function _doselect() {
					index_a+=1;
					//console.log(index_a);
					for (i = index_w; i < index_w + 200; i += 1) { //每次只加载一个 根据情况定
						if (i >= push_hgid[num].length) {
							if (push_hgid[num].length == 0) {
								select_checkbox_fun=false;
								return false;
							} else {
								index_w = 0;
								i = 0;
								t_doselect = setTimeout(function () { _doselect(); }, 1);
								return false;
							}
						}
						var PGetHNodeSelected_json = {
							"type": type[num],
							"id": edit_id[num],
							"ishost": false,
							"hnodeset": new Array()
						}
						for (var m = i; m < i + 100; m++) {
							if (m >= push_hgid[num].length) {
								break;
							}
							var hg_id = push_hgid[num][m].split(":")[0];
							var falg_sec = push_hgid[num][m].split(":")[1];
							var $hg_pinput = $("#HGId-" + hg_id).parent().parent().siblings('input');
							var hg_pid = 0;
							if ($hg_pinput.length != 0) {
								hg_pid = $hg_pinput.attr('id').split('-')[1];
								if (push_hgid[num].indexOf(hg_id + ':true') >= 0) {
									continue;
								}
								if (push_hgid[num].indexOf(hg_pid + ':false') >= 0) {
									continue;
								}
								if (push_hgid[num].indexOf(hg_pid + ':true') >= 0) {
									continue;
								}
							}
							if (falg_sec == 'false') {
								PGetHNodeSelected_json.hnodeset.push(JSON.parse('{"parentid": null,"hid": ' + hg_id + '}'));
								push_hgid[num][m] = hg_id + ":" + "true";
							}
						}
						if (PGetHNodeSelected_json.hnodeset.length > 0) {
							$.ajax({
								url: '/bhost/PGetHNodeSelected',
								type: 'post',
								async: true,
								data: { a0: $("input[name=se]").val(), z1: JSON.stringify(PGetHNodeSelected_json) },//hg_id
								success: function (result) {
									var result = JSON.parse(result);
									var data = result.info;
									$.each(data, function (i, item) {
										var _currentId = $(group_name + "#HGId-" + item.hid);
										var _span_authtype = _currentId.siblings('span.authtype');
										var mode = parseInt(_span_authtype.find('input').attr("data-mode"));
										var p_id;
										if (_currentId.parent().parent().siblings("input").length > 0)
											p_id = _currentId.parent().parent().siblings("input").attr('id').split('-')[1];
										else p_id = 0;
										var if_change_parent = false; //主机组是否改变
										var loadlast = 0;
										var _p_loadfirst = $(group_name + '#HGId-' + p_id).attr("data-loadfirst");
										var _p_loadlast = $(group_name + '#HGId-' + p_id).attr("data-loadlast");

										if (_p_loadfirst == _p_loadlast) { //没改变		
										} else {
											if_change_parent = true;
											loadlast = _p_loadlast;
										}
										var gl_selected = false;
										if (item.selected == 0) {
											_currentId.next('span').attr("class", "checkbox");
											_currentId.prop('checked', false);
											_currentId.attr('data-loadfirst', item.selected);
											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);

										} else if (item.selected == 1) {
											_currentId.next('span').attr("class", "checkbox half");
											_currentId.prop('checked', false);
											_currentId.attr('data-loadfirst', item.selected);
											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);
										} else {
											_currentId.next('span').attr("class", "checkbox checked");
											_currentId.prop('checked', true);
											_currentId.attr('data-loadfirst', item.selected);
											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);

											$.each(last_object[num], function (i1, item1) {
												if (item1.HGId == item.hid) {
													if (item1.HostId == null) {
														gl_selected = true;
														return false;
													}
												}
											})
											//
										}
										if (gl_selected) {
											_span_authtype.find('input').attr('data-ifselect', true);
											_currentId.attr('data-ifselect', true);
										} else {
											_span_authtype.find('input').attr('data-ifselect', false);
											_currentId.attr('data-ifselect', false);
										}
										//判断是否隐藏按组授权

										if (mode == 0 && item.selected == 0) { //隐藏按组授权
											_span_authtype.children('label').hide();
										} else if (mode == 0 && item.selected == 1) { //隐藏按组授权
											_span_authtype.children('label').hide();
										} else if (mode == 0 && item.selected == 2) {
											if (gl_selected) _span_authtype.children('label').show();
											else _span_authtype.children('label').hide();
										} else if (mode == 2) {
											_span_authtype.children('label').show();
										}
										//如果父节点的状态改变了
										if (if_change_parent == true) {
											if (_p_loadlast == 0) { //1-0 2-0
												_currentId.next('span').attr("class", "checkbox");
												_currentId.prop('checked', false);
												_span_authtype.find('span').attr("class", "checkbox");
												_span_authtype.find('input').prop("checked", false);

												if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == false) {
													_span_authtype.find('input').prop("disabled", false);
													_currentId.prop('disabled', false);
												}
												_currentId.attr('data-loadfirst', item.selected);

												if (_p_loadfirst == 2) _currentId.attr('data-loadfirst', 2);
											} else if (_p_loadlast == 2) {	 // 0-2	 1-2							
												_currentId.prop('checked', true);

												//父节点 按组授权
												if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
													_currentId.prop('disabled', true);//input
													_currentId.next('span').attr("class", "checkbox checked disabled");
													//<<<< 
													_currentId.attr("data-loadlast", "2");
													_span_authtype.find('span').attr('class', "checkbox disabled");
													_span_authtype.find('input').prop('disabled', true);

												} else { // 1-0 1-2
													_currentId.prop('disabled', false);//input
													_currentId.next('span').attr("class", "checkbox checked");
													_currentId.attr("data-loadlast", "2");
													if (gl_selected) {
														_span_authtype.find('span').attr('class', "checkbox checked");
														_span_authtype.find('input').prop('checked', true).prop('disabled', false);
													} else {
														_span_authtype.find('input').prop('disabled', false);
														_span_authtype.find('span').attr('class', 'checkbox');
													}
												}
											}
										} else {
											//父节点 按组授权
											if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
												_currentId.prop('disabled', true);//input
												_currentId.prop('checked', true);
												_currentId.next('span').attr("class", "checkbox checked disabled");

												if (_p_loadlast == 2) {
													_currentId.attr("data-loadlast", "2");
												}
												if (gl_selected) {
													_span_authtype.find('span').attr('class', "checkbox checked disabled");
													_currentId.siblings('span.authtype').find('input').prop('checked', true).prop('disabled', true);
												} else {
													_span_authtype.find('input').prop('disabled', true);
													_span_authtype.find('span').attr('class', 'checkbox disabled');
												}
											} else {
												_currentId.attr('disabled', false);//input
												_currentId.next('span').removeClass("disabled");
												if (_p_loadlast == 2) {
													_currentId.prop('checked', true);
													_currentId.attr("data-loadlast", "2");
													_currentId.attr("data-loadfirst", "2");
													_currentId.next('span').attr("class", "checkbox checked");
												}
												if (gl_selected) {
													_span_authtype.find('span').attr('class', "checkbox checked");
													_span_authtype.find('input').prop('checked', true).prop('disabled', false);
												} else {
													_span_authtype.find('input').prop('disabled', false);
													_span_authtype.find('span').attr('class', 'checkbox');
												}
											}
										}
										if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('disabled')) {
											_currentId.prop('checked', true);
											_currentId.prop('disabled', true);//input
											_currentId.next('span').attr("class", "checkbox checked disabled");
											//<<<< 
											_span_authtype.find('span').addClass("disabled");
											_span_authtype.find('input').prop('disabled', true);
										}



										var ind = push_hgid[num].indexOf(item.hid + ":" + "true");
										if (ind != -1) {
											push_hgid[num].splice(ind, 1);
											i = 0;
										}
									});
									// index_w = i;
									// t_doselect = setTimeout(function () { _doselect(); }, 1);
								},
								error: function (XmlHttpRequest, textStatus, errorThrown) {
									// var ind = push_hgid[num].indexOf(hg_id + ":" + "true");
									// if (ind >= 0) {
									// 	push_hgid[num].splice(ind, 1);
									// 	push_hgid[num].push(hg_id + ":" + "false");
									// }
									// index_w = i;
									// t_doselect = setTimeout(function () { _doselect(); }, 1);
									return false;
								}
							});
						}
					}
					if (push_hgid[num].length == 0) {
						select_checkbox_fun=false;
						return false;
					}
					index_w = i;
				}
				var if_select = setInterval(function(){
					if (push_hgid[num].length == 0){  //
						select_checkbox_fun=false;
						clearInterval(if_select);
						return false;
					}
					var f = false;
					$.each(push_hgid[num],function(i1,item1){
						if(item1.split(':')[1] == "false"){
							f = true;
						}	
					})
					if(f ==false){
						clearInterval(if_select);
						select_checkbox_fun=false;
						return false;
						
					}
					_doselect();
					if(Date.parse(new Date())/1000 - global_time >=1)
						setTimeout("get_msg()", 100);	
				},10);
				// _doselect();

			}
			else if (select_flag == "Host") { //主机
				var i = 0;
				var index_w = 0;
				var indx = 0;
				var t_doselect1;
				var c_count = 700; 
				function _doselect1() {
					clearTimeout(t_doselect1);
					for (i = index_w; i < index_w + 20; i += 1) { //每次只加载一个 根据情况定
						if (i >= push_hid[num].length) {
							if (push_hid[num].length == 0) {
								select_checkbox_fun=false;
								return false;
							} else {
								index_w = 0;
								i = 0;
								t_doselect1 = setTimeout(function () { _doselect1(); }, 1);
								return false;
							}
						}
						var PGetHNodeSelected_json = {
							"type": type[num],
							"id": edit_id[num],
							"ishost": true,
							"hnodeset": new Array()
						}
						for (var m = i; m < i + 5; m++) {
							if (m >= push_hid[num].length) {
								break;
							}
							var pid_h = push_hid[num][m].split(":")[0];
							var h_id = push_hid[num][m].split(":")[1];
							var falg_sec = push_hid[num][m].split(":")[2];
							if (push_hid[num].indexOf(pid_h + ':' + h_id + ":" + "true") >= 0) {
								continue;
							}
							if (push_hgid[num].indexOf(pid_h + ':false') >= 0) {
								continue;
							}
							if (push_hgid[num].indexOf(pid_h + ':true') >= 0) {
								continue;
							}
							if (falg_sec == 'false') {
								PGetHNodeSelected_json.hnodeset.push(JSON.parse('{"parentid": ' + pid_h + ',"hid": ' + h_id + '}'));
								push_hid[num][m] = pid_h + ':' + h_id + ":" + "true";
							}
						}
						if (PGetHNodeSelected_json.hnodeset.length > 0) {
							atr = $.ajax({
								url: '/bhost/PGetHNodeSelected',
								type: 'post',
								async: true,
								data: { a0: $("input[name=se]").val(), z1: JSON.stringify(PGetHNodeSelected_json) },//hg_id
								success: function (result) {

									var result = JSON.parse(result);
									var data = result.info;
									$.each(data, function (i, item) {
										var p_id = item.parentid;//当前组所在的父组id
										_currentId = $(group_name + "#HostId-" + p_id + '-' + item.hid);//当前id
										atr_flag = 1;
										if (_currentId.length == 0) {
											return false;
										}
										var _span_authtype = _currentId.siblings('span.authtype');//当前按组授权
										var li_currentId = _currentId.parent();
										var mode = parseInt(_span_authtype.find('input').attr("data-mode"));
										var if_change_parent = false; //主机组是否改变
										var loadlast = 0;
										var _p_loadfirst = $(group_name + '#HGId-' + p_id).attr("data-loadfirst");
										var _p_loadlast = $(group_name + '#HGId-' + p_id).attr("data-loadlast");
										if (_p_loadfirst == _p_loadlast) { //没改变		
										} else {
											if_change_parent = true;
											loadlast = _p_loadlast;
										}

										//绑定 data-loadfirst状态 和 data-loadlast
										var gl_selected = false;
										if (item.selected == 0) {
											_currentId.next('span').attr("class", "checkbox");
											_currentId.prop('checked', false);
											_currentId.attr('data-loadfirst', item.selected);

											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);
										} else if (item.selected == 1) {
											_currentId.next('span').attr("class", "checkbox half");
											_currentId.prop('checked', false);
											_currentId.attr('data-loadfirst', item.selected);
											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);

										} else {
											_currentId.next('span').attr("class", "checkbox checked");
											_currentId.prop('checked', true);
											_currentId.attr('data-loadfirst', item.selected);

											if (if_change_parent == false) _currentId.attr('data-loadlast', item.selected);
											else _currentId.attr('data-loadlast', loadlast);
											$.each(last_object[num], function (i1, item1) {
												if (item1.HostId == item.hid && item1.HGId == p_id) {
													gl_selected = true;
													return false;
												}
											})
										}
										//绑定是否按组授权状态
										if (gl_selected) {
											_span_authtype.find('input').attr('data-ifselect', true);
											_currentId.attr('data-ifselect', true);
										} else {
											_span_authtype.find('input').attr('data-ifselect', false);
											_currentId.attr('data-ifselect', false);
										}
										//判断是否隐藏主机 因为存在 当前用户的管理权限 加了这个
										if (tmp_list[num] == null) {
											if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
												if (mode != 0 || item.selected != 0) {
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else {
													li_currentId.parent('li').remove();
												}

											} else {
												if (mode == 0 && item.selected == 0) { //隐藏主机
													li_currentId.hide();
												} else if (mode == 0 && item.selected == 1) { //隐藏主机
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else if (mode == 0 && item.selected == 2) {
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else if (mode == 2) {
													li_currentId.show();
												}
											}
										} else {
											li_currentId.hide();
											if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
												if (mode != 0 || item.selected != 0) {
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else {
													li_currentId.parent('li').remove();
												}
											} else {
												if (mode == 0 && item.selected == 0) { //隐藏主机
													li_currentId.parent('li').remove();
												} else if (mode == 0 && item.selected == 1) { //隐藏主机
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else if (mode == 0 && item.selected == 2) {
													_currentId.attr('data-mode', '2');
													li_currentId.show();
												} else if (mode == 2) {
													li_currentId.show();
												}
											}
										}
										//查看 父节点 是否是 1、全选还是空 2、是否按组授权 勾选 / disabled
										if (if_change_parent) {
											if (_p_loadlast == 0) {
												_currentId.next('span').attr("class", "checkbox");
												_currentId.prop('checked', false);
												_span_authtype.find('span').attr("class", "checkbox");
												_span_authtype.find('input').prop("checked", false);
												if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == false) {
													_span_authtype.find('input').prop("disabled", false);
													_currentId.prop('disabled', false);
												}
												if (_p_loadfirst == 2) _currentId.attr('data-loadfirst', 2);

											} else if (_p_loadlast == 2) {
												_currentId.prop('checked', true);

												//父节点 按组授权
												if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
													_currentId.prop('disabled', true);//input
													_currentId.next('span').attr("class", "checkbox checked disabled");
													_currentId.attr("data-loadlast", "2");
													_span_authtype.find('input').prop('disabled', true);
													_span_authtype.find('span').attr('class', 'checkbox disabled');

												} else {
													_currentId.prop('disabled', false);//input
													_currentId.next('span').attr("class", "checkbox checked");
													_currentId.attr("data-loadlast", "2");
													if (gl_selected) {
														_span_authtype.find('span').attr('class', "checkbox checked");
														_span_authtype.find('input').prop('checked', true).prop('disabled', false);
													} else {
														_span_authtype.find('input').prop('disabled', false);
														_span_authtype.find('span').attr('class', 'checkbox');
													}
												}
											}
										} else {
											//父节点 按组授权
											if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('checked') == true) {
												_currentId.prop('disabled', true);//input
												_currentId.next('span').attr("class", "checkbox checked disabled");
												if (_p_loadlast == 2) {
													_currentId.prop('checked', true);
													_currentId.attr("data-loadlast", "2");
												}
												if (gl_selected) {
													_span_authtype.find('span').attr('class', "checkbox checked disabled");
													_span_authtype.find('input').prop('checked', true).prop('disabled', true);
												} else {
													_span_authtype.find('input').prop('disabled', true);
													_span_authtype.find('span').attr('class', 'checkbox disabled');
												}

											} else {
												_currentId.prop('disabled', false);//input
												_currentId.next('span').removeClass("disabled");
												if (_p_loadlast == 2) {
													_currentId.prop('checked', true);
													_currentId.next('span').attr("class", "checkbox checked");
													_currentId.attr("data-loadlast", "2");
													_currentId.attr("data-loadfirst", "2");
												}
												if (gl_selected) {
													_span_authtype.find('span').attr('class', "checkbox checked");
													_span_authtype.find('input').prop('checked', true).prop('disabled', false);
												} else {
													_span_authtype.find('input').prop('disabled', false);
													_span_authtype.find('span').attr('class', 'checkbox');
												}

											}
										}
										//发现父主机组是disabled
										if (_currentId.parent().parent().siblings('span.authtype').find('input').prop('disabled')) {
											_currentId.prop('checked', true);
											_currentId.prop('disabled', true);//input
											_currentId.next('span').attr("class", "checkbox checked disabled");
											//<<<< 
											_span_authtype.find('span').addClass("disabled");
											_span_authtype.find('input').prop('disabled', true);
										}
										var ind = push_hid[num].indexOf(p_id + ':' + item.hid + ":" + "true");
										if (ind != -1) {
											push_hid[num].splice(ind, 1);
											i = 0;
										}
									});
									// index_w = i;
									// t_doselect1=setTimeout(function(){_doselect1();},1);
								},
								error: function (XmlHttpRequest, textStatus, errorThrown) {
									// index_w = i;
									// t_doselect1=setTimeout(function(){_doselect1();},1);
									return false;
								}
							});

						}
					}
					if (push_hid[num].length == 0) {
						select_checkbox_fun=false;
						return false;
					}
					index_w = i;
				}
				var if_select1 = setInterval(function () {
					
					if (push_hid[num].length == 0) {  //
						clearInterval(if_select1);
						select_checkbox_fun=false;
						return false;
					}
					var ff = false;
					$.each(push_hid[num],function(i1,item1){
						if(item1.split(':')[2] == "false"){
							ff = true;
						}	
					})
					if(ff ==false){
						clearInterval(if_select1);
						select_checkbox_fun=false;
						return false;
						
					}

					_doselect1();
					setTimeout("get_msg()", 100);	
				}, 10);	
				// _doselect1();
			}
		}
		var _jScrollBar_array=[];
		function _checkView_host(obj) {
			_authTypeTheme($('span.authtype input', obj));
			$('input.zcheck', obj).each(function () {
				var $s = $('<span class="checkbox"></span>');
				$(this).after($s);
				var v = $(this).prop('checked');
				if (v) {
					$s.addClass('checked');
				} else {
					var c = $(this).data('check');
					if (c && c == 2) {
						$s.addClass('half');
					}
				}

				var d = $(this).prop('disabled');
				if (d) {
					$s.addClass('disabled');
				}
				var span_id = $(this).siblings('span.h-name').attr('id');
				setTimeout(function () {
					if (_jScrollBar_array.indexOf(span_id) === -1) {
						_jScrollBar_array.push(span_id);
						_jScrollBar(span_id);
					}
				}, 100);
			}).on('change', function () {
				var v = $(this).prop('checked');
				var $s = $(this).next('span.checkbox');
				var $u = $(this).parent().children('ul').find('li');
				var $authInput = $(this).siblings('span.authtype').find('input');

				if (v) {
					$s.attr('class', 'checkbox checked');
					$('input.zcheck', $u).prop('checked', true);
					$('span.checkbox:first', $u).attr('class', 'checkbox checked');
					$(this).attr("data-loadlast", 2);
					$('input.zcheck', $u).attr("data-loadlast", 2);
					$u.each(function () {
						if ($(this).children('span.authtype').find('input').prop('checked')) {
							var $u_li = $(this).children('ul').find('li');
							$('input.zcheck', $u_li).prop('disabled', true);
							$('span.checkbox:first', $u_li).addClass('disabled');
						};
					});
				} else {
					$s.attr('class', 'checkbox');
					$('input', $u).prop('checked', false).prop('disabled', false);
					$('span.checkbox', $u).attr('class', 'checkbox');
					$(this).attr("data-loadlast", 0);
					$('input.zcheck', $u).attr("data-loadlast", 0);

					$authInput.prop('checked', false).trigger('change');
					$(this).siblings('span.authtype').find('span').attr('class', 'checkbox');
				}
				_checkEvent(this);
			});
		}

		//加入ip
		function _addIp2(obj) {
			var v1 = $(obj).prev().val().trim();
			var v = $(obj).prev().prev().prev().val().trim();
			var pass = 1;
			if (v == '') {
				_alert(2, '服务器集合', '请输入起始IP地址', $(obj).prev().prev().prev());
				return false;
			} else if (!ipReg.test(v)) {
				_alert(1, '服务器集合', '起始IP地址格式不正确', $(obj).prev().prev().prev());
				return false;
			}
			if (v=='0.0.0.0' || v=='255.255.255.255') {
                                _alert(1, '服务器集合', '起始IP地址格式不正确', $(obj).prev().prev().prev());
                                return false;
                        }
			if (v1 == '') {
				_alert(2, '服务器集合', '请输入结束IP地址', $(obj).prev());
				return false;
			} else if (!ipReg.test(v1)) {
				_alert(1, '服务器集合', '结束IP地址格式不正确', $(obj).prev());
				return false;
			}
			if (v1=='0.0.0.0' || v1=='255.255.255.255') {
                                _alert(1, '服务器集合', '结束IP地址格式不正确', $(obj).prev());
                                return false;
                        }
			if (v == v1) {
				_alert(2, '服务器集合', '起始IP地址小于结束IP地址', $(obj).prev().prev().prev());
				return false;
			}
			var v_str = v.split(".");
			var v1_str = v1.split(".");
			for (var i = 0; i < 4; i++) {
				if (parseInt(v_str[i]) > parseInt(v1_str[i])) {
					pass = 0;
					_alert(2, '服务器集合', '起始IP地址小于结束IP地址', $(obj).prev().prev().prev());
					return false;
				} else if (parseInt(v_str[i]) < parseInt(v1_str[i])) {
					break;
				}
			}
			if (pass == 0) {
				return false;
			}
			$("#ip_n").children('span:not(:first)').each(function (i1, item1) {
				var ip1_input1 = $(item1).find('input:eq(0)').val();
				var ip1_input2 = $(item1).find('input:eq(1)').val();
				if (v == ip1_input1 && v1 == ip1_input2) {
					pass = 0;
					_alert(2, "服务器集合", "相同的IP区间已存在", $(obj).prev('input:first'));
					return false;
				}
			});
			if (pass == 0) {
				return false;
			}
			var ip_id = $("#ip_span").attr("value");
			var $c = $('<span class="ss" value="' + ip_id + '" style="float: left;width: 312px;position: static;padding: 0 0 10px 0;"/>');
			$c.html('<input type="text" class="form-text" value="' + v + '" style="width:105px;">'
				+ '<span style="vertical-align:middle;padding-left: 4px;padding-right: 4px;">-</span>'
				+ '<input type="text" class="form-text" value="' + v1 + '" style="width:105px;">'
				+ '<i class="ctr ctr-del" style="    margin-top: 5px;margin-left: -3px;" onclick="_delIp(this)"></i>');
			$(obj).parent().after($c);
			$(obj).prev().val("");
			$(obj).prev().prev().prev().val("");
			$("#ip_span").attr("value", "0");
			//}
		}
		function _delIp(obj) {
			var $c = $(obj).parent();
			$c.fadeOut(function () {
				$c.remove();
			});
		}
		//加入ip
		function _addIp1(obj) {
			var pass = 1;
			var v = $(obj).prev('input').val().trim();

			if (v == '') {
				_alert(2, '服务器集合', '请输入IP地址', $(obj).prev('input'));
				return false;
			} else if (!ipReg.test(v)) {
				_alert(1, '服务器集合', 'IP地址格式不正确', $(obj).prev('input'));
				return false;
			} else if (v=='0.0.0.0' || v=='255.255.255.255') {
                                _alert(1, '服务器集合', 'IP地址格式不正确', $(obj).prev('input'));
                                return false;
                        } else {
				$(">span[class='ss']", "#ip_n1").each(function () {
					ip_str = $(this).find("input").val();
					if (ip_str == v) {
						_alert(2, '服务器集合', '相同的IP地址已存在', $(obj).prev('input'));
						pass = 0;
						return false;
					}
				});
			}
			var ip_id = $("#ip_span1").attr("value");
			if (pass == 1) {
				var $c = $('<span class="ss" value="' + ip_id + '" style="width: 170px;float: left;position: static;padding: 0 0 10px 0;"/>');
				$c.html('<input type="text" class="form-text" style="width:105px;" value="' + v + '" >'
					+ '<i class="ctr ctr-del" onclick="_delIp(this)" style="    margin-top: 4px;    margin-left: -3px;"></i>');
				$(obj).parent().after($c);
				$(obj).prev('input').val("");
				$("#ip_span1").attr("value", "0");
			}
		}
		function save_server_hg_host(obj, id) {
			$(">li", obj).children('input').each(function () {
				var input_id = $(this).attr('id');
				var input_str = input_id.split('-');
				var input_state = $(this).next('span.checkbox').attr('class');
				var radio_value = $(this).siblings('span.authtype').find('input');
				var $u = $(this).parent().children('ul');
				if (input_state.indexOf('checked') > 0) {
					if (radio_value.is(':checked') && input_str[1] != '1' && input_str[0] == "HGId") {
						var json_a = '{"HGId":' + input_str[1] + ',"HostId":null,"IsGroupAuth": true}';
						server.HostList.push(JSON.parse(json_a));
					} else {
						if (input_str[0] == "HGId") {
							var json_a = '{"HGId":' + input_str[1] + ',"HostId":null,"IsGroupAuth": false}';
							server.HostList.push(JSON.parse(json_a));
							if ($u.text() != "Loading..." && $u.text() != "") {
								save_server_hg_host($u, input_str[1]);
							}
						} else {
							var json_a = '{"HGId":' + id + ',"HostId":' + input_str[2] + '}';
							server.HostList.push(JSON.parse(json_a));
						}
					}
				} else if (input_state.indexOf('half') > 0) {
					if ($u.text() != "Loading..." && $u.text() != "") {
						save_server_hg_host($u, input_str[1]);
					} else {
						$.each(server_edit.HostList, function (i, item) {
							if (item.HGId == parseInt(input_str[1]) && item.HostId != null) {
								var json_a = '{"HGId":' + item.HGId + ',"HostId":' + item.HostId + '}';
								server.HostList.push(JSON.parse(json_a));
							}
						});
					}
				}
			});
		}
		function _compare_ip(x, y) {
			var ip1 = x.split('.');
			var ip2 = y.split('.');
			for (var i1 = 0; i1 < 4; i1++) {
				if (parseInt(ip1[i1]) < parseInt(ip2[i1])) {
					return 3;
				} else if (parseInt(ip1[i1]) > parseInt(ip2[i1])) {
					return 2
				} else {

				}
			}
			return 1
		}
		//创建
		function server_add(d) {
			var ip_section = 1;
			var ip_num = 1;
			var host_group = 1;
			var pass = 1;
			var d_n = $('#d_n').val();
			if (d_n == "") {
				_alert(2, '服务器集合', '请输入名称', $('#d_n'));
				return false;
			} else if (!nameReg.test(d_n)) {
				_alert(1, '服务器集合', '名称格式不正确', $('#d_n'));
				$("#d_n").val("");
				return false;
			}
			var v2 = $("#ip_n1").find("span[class='ss ss-add']").children("input").val().trim();
			if (v2 == "" && !$('#ip_n1').find("span[class=ss]").length) {
				ip_num = 0;
			}
			var ip_n1_len = $("#ip_n1").find('input').length;
			$("#ip_n1").find('input').each(function (i, item) {
				var input1 = $(item).val();
				if (ip_num == 0) {
					return true;
				}

				if (i == 0 && ip_n1_len != 1 && input1 == "") {
					return true;
				}

				if (input1 == "") {
					pass = 0;
					_alert(2, "服务器集合", "请输入IP地址", $(item));
					return false;
				}
				if (!ipReg.test(input1)) {
					pass = 0;
					_alert(1, "服务器集合", "IP格式不正确", $(item));
					return false;
				}
				if (input1=='0.0.0.0' || input1=='255.255.255.255') {
                                        pass = 0;
                                        _alert(1, "服务器集合", "IP格式不正确", $(item));
                                        return false;
                                }
				$("#ip_n1").find('input').not($(item)).each(function (i1, item1) {
					if (i1 < i) {
						return true;
					}
					var input2 = $(item1).val();
					if (input2 == "") {
						pass = 0;
						_alert(2, "服务器集合", "请输入IP地址", $(item1));
						return false;
					}
					if (!ipReg.test(input2)) {
						pass = 0;
						_alert(1, "服务器集合", "IP格式不正确", $(item1));
						return false;
					}
					if (input2=='0.0.0.0' || input2=='255.255.255.255') {
                                                pass = 0;
                                                _alert(1, "服务器集合", "IP格式不正确", $(item1));
                                                return false;
                                        }
					if (input1 == input2) {
						pass = 0;
						_alert(2, "服务器集合", "相同的IP地址已存在", $(item));
						return false;
					}
				});
				if (pass == 0) {
					return false;
				}
			});
			if (pass == 0) {
				return false;
			}


			var v = $("#ip_n").find("span[class='ss ss-add']").children("input").val().trim();
			var v1 = $("#ip_n").find("span[class='ss ss-add']").children().next("input").val().trim();

			if (v == "" && v1 == "" && !$(">span[class='ss']", "#ip_n").length) {
				ip_section = 0;
			}
			var ip_n_len = $("#ip_n").children('span').length;
			$("#ip_n").children('span').each(function (i, item) {
				if (ip_section == 0) {
					return true;
				}
				var ip_input1 = $(item).find('input:eq(0)').val();
				var ip_input2 = $(item).find('input:eq(1)').val();
				if (i == 0 && ip_n_len != 1 && ip_input1 == "" && ip_input2 == "") {
					return true;
				}
				if (ip_input1 == '') {
					pass = 0;
					_alert(2, '服务器集合', '请输入起始IP地址', $(item).find('input:eq(0)'));
					return false;
				} else if (!ipReg.test(ip_input1)) {
					pass = 0;
					_alert(1, '服务器集合', '起始IP地址格式不正确', $(item).find('input:eq(0)'));
					return false;
				}
				if (ip_input1=='0.0.0.0' || ip_input1=='255.255.255.255') {
                                        pass = 0;
                                        _alert(1, '服务器集合', '起始IP地址格式不正确', $(item).find('input:eq(0)'));
                                        return false;
                                }
                                
				if (ip_input2 == '') {
					pass = 0;
					_alert(2, '服务器集合', '请输入结束IP地址', $(item).find('input:eq(1)'));
					return false;
				} else if (!ipReg.test(ip_input2)) {
					pass = 0;
					_alert(1, '服务器集合', '结束IP地址格式不正确', $(item).find('input:eq(1)'));
					return false;
				}
				if (ip_input2=='0.0.0.0' || ip_input2=='255.255.255.255') {
                                        pass = 0;
                                        _alert(1, '服务器集合', '结束IP地址格式不正确', $(item).find('input:eq(1)'));
                                        return false;
                                }
				var r_v = _compare_ip(ip_input1, ip_input2);
				if (r_v != 3) {
					pass = 0;
					_alert(1, '服务器集合', '起始IP地址小于结束IP地址', $(item).find('input:eq(0)'));
					return false;
				}
				$("#ip_n").children('span').not($(item)).each(function (i1, item1) {
					if (i1 < i) {
						return true;
					}
					var ip1_input1 = $(item1).find('input:eq(0)').val();
					var ip1_input2 = $(item1).find('input:eq(1)').val();
					if (ip1_input1 == '') {
						pass = 0;
						_alert(2, '服务器集合', '请输入起始IP地址', $(item1).find('input:eq(0)'));
						return false;
					} else if (!ipReg.test(ip1_input1)) {
						pass = 0;
						_alert(1, '服务器集合', '起始IP地址格式不正确', $(item1).find('input:eq(0)'));
						return false;
					}else if (ip1_input1=='0.0.0.0' || ip1_input1=='255.255.255.255') {
                                                pass = 0;
                                                _alert(1, '服务器集合', '起始IP地址格式不正确', $(item1).find('input:eq(0)'));
                                                return false;
                                        }
					if (ip1_input2 == '') {
						pass = 0;
						_alert(2, '服务器集合', '请输入结束IP地址', $(item1).find('input:eq(1)'));
						return false;
					} else if (!ipReg.test(ip1_input2)) {
						pass = 0;
						_alert(1, '服务器集合', '结束IP地址格式不正确', $(item1).find('input:eq(1)'));
						return false;
					}else if (ip1_input2=='0.0.0.0' || ip1_input2=='255.255.255.255') {
                                                pass = 0;
                                                _alert(1, '服务器集合', '结束IP地址格式不正确', $(item1).find('input:eq(1)'));
                                                return false;
                                        }
					var r_v = _compare_ip(ip1_input1, ip1_input2);
					if (r_v != 3) {
						pass = 0;
						_alert(1, '服务器集合', '起始IP地址小于结束IP地址', $(item1).find('input:eq(0)'));
						return false;
					}
					if (ip_input1 == ip1_input1 && ip_input2 == ip1_input2) {
						pass = 0;
						_alert(2, "服务器集合", "相同的IP区间已存在", $(item).find('input:eq(1)'));
						return false;
					}
				});
				if (pass == 0) {
					return false;
				}
			});
			if (pass == 0) {
				return false;
			}

			server.HostList = new Array();
			save_server_hg_host($("#userTree1"), 0);
			if (server.HostList.length == 0) {
				host_group = 0;
			}

			if (host_group == 0 && ip_section == 0 && ip_num == 0 && $("#part1").prop('checked') == true) {
				_alert(2, '服务器集合', '请输入IP或选择主机', $("#ip_n1").find("span[class='ss ss-add']").children("input"));
				return false;
			}else if($("#part1").prop('checked') == false && host_group == 0){
				_alert(2, '服务器集合', '请输入IP或选择主机');
				return false;
			}
			if (pass == 1) {
				server.ServerScopeId = serverId;
				server.ServerScopeName = d_n;
				server.IPList.Set = new Array();
				var i = 1;
				var $all = $('#ip_n').find('span[class=ss]');
				var len = $all.length;
				for (var j = len - 1; j >= 0; j--) {
					var ip_id = $all.eq(j).attr("value");
					var $v = $all.eq(j).find('input');
					var input_0 = $v.eq(0).val();
					var input_1 = $v.eq(1).val();
					var json_a = '{"IPSetMemberId":' + ip_id + ',"Order":' + (i) + ',"StartIP":"' + input_0 + '","EndIP":"' + input_1 + '"}';
					server.IPList.Set.push(JSON.parse(json_a));
					i++;
				}
				if (v != "" && v1 != "") {
					ip_id = $("#ip_span").attr("value");
					var b1 = $("#ip_n").find("span[class='ss ss-add']").children("input").val().trim();
					var b2 = $("#ip_n").find("span[class='ss ss-add']").children().next("input").val().trim();
					var json_a = '{"IPSetMemberId":' + ip_id + ',"Order":' + (i) + ',"StartIP":"' + b1 + '","EndIP":"' + b2 + '"}';
					server.IPList.Set.push(JSON.parse(json_a));
					i++;
				}
				var $all = $('#ip_n1').find('span[class=ss]');
				var len = $all.length;
				for (var j = len - 1; j >= 0; j--) {
					var ip_id = $all.eq(j).attr("value");
					var ip_str = $all.eq(j).find("input").val();
					var json_a = '{"IPSetMemberId":' + ip_id + ',"Order":' + (i) + ',"StartIP":"' + ip_str + '","EndIP":"' + ip_str + '"}';
					server.IPList.Set.push(JSON.parse(json_a));
					i++;
				}
				if (v2 != "") {
					ip_id = $("#ip_span1").attr("value");
					var b1 = $("#ip_n1").find("span[class='ss ss-add']").children("input").val().trim();
					var json_a = '{"IPSetMemberId":' + ip_id + ',"Order":' + (i) + ',"StartIP":"' + b1 + '","EndIP":"' + b1 + '"}';
					server.IPList.Set.push(JSON.parse(json_a));
					i++
				}
				if($("#part1").prop('checked') == false){
					server.EnableIPLimit = 0;
				}else{
					server.EnableIPLimit = 1;
				}
				server.IsApplyToClientScope = false;
				save_server(server, d);
			}
		}

		function save_server(server, d) {
		var 	msstr = aceg(JSON.stringify(server),se);
			$.ajax({
				url: '/bhost/add_server',
				type: "POST",
				async: false,
				data: { a0: se, a1: JSON.stringify(server),a4:'密码管理>自动改密', m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result == true) {
						//d.close().remove();
						parent.layer.open({
							type: 1,
							title: '服务器集合',
							content: '<div class="layer-alert"><i class="alert succ"></i>操作成功</div>',
							btn: ['确&nbsp;&nbsp;定'],
							btnAlign: 'c',
							closeBtn: false,
							skin: 'layer-custom',
							area: ['380px', '310px'],
							move: false,
							resize: false,
							yes: function (i) {
								parent.layer.close(i);
								d.close().remove();
								var xselect_value=$('#server_text_zdp').data('value');
								// if(xselect_value=='' || xselect_value=='0' || xselect_value=='-1' || xselect_value==undefined){
									$('#server_text_zdp').data('value',result.ServerScopeId);
									server_id=result.ServerScopeId;
									bind_server_xSelect();
									if(server_id==-1){
										$('#server_text_zdp').data('value',-1);
										$('#server_text_zdp .xSelect-show-text').text('请选择');
									}
									//////console.log($("#define_select").val() == 1 && ($("#a_mix_select").val() == 1 || $("#s_mix_select").val() ==1));
									if ($("#define_select").val() == 1 && ($("#a_mix_select").val() == 1 || $("#s_mix_select").val() ==1)){
										change_server();
									}
								// }
								return false;
							}
						});
					} else {
						_alert(1, '服务器集合', result.ErrMsg);
						return false;
					}
				}
			});
		}


		var item_pwd = null;
		var item_smtp = null;
		var item_ftp = null;
		var input_check = 1;
		
		function get_dialog_stmp(obj, type) {
			//////console.log(obj);
			smtp_master_clear();
			var title;
			if (type == 1) {
				var id=parseInt($('span',obj).data('value'));
				title = "邮件配置";
				$.ajax({
					url: "/bhost/get_smtpconfig",
					type: "POST",
					async: false,
					data: { a0: $("input[name=se]").val(),a1:id },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							var data = result.info.data[0];
							MasterSmtpConfig_input(data);
							$('#SmtpConfigName_Master').attr("disabled", true);
							smtpconfig_save.SmtpConfigId=parseInt(id);
						} else {
							_alert(1, '邮件服务器查询', result.ErrMsg);
							return false;
						}
					}
				});
			} else {
				title = "邮件配置";
				smtpconfig_save.SmtpConfigId = 0;
			}
			var $dialogCont = $("#smtp_suspend").show();

			var d = dialog({
				title: title,
				content: $dialogCont,
				id: "smtp_suspend",
				width: "800px"
			});
			d.addEventListener('close', function () {
				$dialogCont.appendTo("body").hide();
			});
			d.showModal();
			$("a.btn-cancel", $dialogCont).unbind().bind("click", function () {
				// d.close().remove();
				smtp_master_clear();
				if (type == 1) {
					$.ajax({
						url: "/bhost/get_smtpconfig",
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val(),a1:id },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								var data = result.info.data[0];
								MasterSmtpConfig_input(data);
								$('#SmtpConfigName_Master').attr("disabled", true);
								smtpconfig_save.SmtpConfigId=parseInt(id);
							} else {
								_alert(1, '邮件服务器查询', result.ErrMsg);
								return false;
							}
						}
					});
				} else {
					smtpconfig_save.SmtpConfigId = 0;
				}
			});

			$("a.btn-submit", $dialogCont).unbind().bind("click", function () {
				var SmtpConfigName_Master = $("#SmtpConfigName_Master").val();
				if (SmtpConfigName_Master == '') {
					_alert(2, '邮件配置', '请输入名称', $('#SmtpConfigName_Master'));
					return false;
				} else if (!nameReg.test(SmtpConfigName_Master)) {
					_alert(1, '邮件配置', '名称格式不正确', $('#SmtpConfigName_Master'));
					return false;
				}
				var SmtpServer = $('#SmtpServer_Master').val();
				var DNS = $('#DNS_Master').val();
				if (SmtpServer == "") {
					_alert(2, '邮件配置', '请输入服务器地址', $('#SmtpServer_Master'));
					return false;
				} else if (!ipReg.test(SmtpServer) && (!hostcheck1.test(SmtpServer)) && (!hostcheck2.test(SmtpServer))) {
					_alert(1, '邮件配置', '服务器地址格式不正确', $('#SmtpServer_Master'));
					return false;
				}else if (SmtpServer=='0.0.0.0' || SmtpServer=='255.255.255.255') {
					_alert(1, '邮件配置', '服务器地址格式不正确', $('#SmtpServer_Master'));
					return false;
				}
				if (DNS == "") {
					DNS = null;
				}
				var Sender = $('#Sender_Master').val();
				if (Sender == "") {
					_alert(2, '邮件配置', '请输入服务器账号', $('#Sender_Master'));
					return false;
				}
				var SenderEmail = $('#SenderEmail_Master').val();
				if (SenderEmail == "") {
					_alert(2, '邮件配置', '请输入发送邮箱地址', $('#SenderEmail_Master'));
					return false;
				} else if (!urlReg.test(SenderEmail)) {
					_alert(1, '邮件配置', '发送邮箱地址格式不正确', $('#SenderEmail_Master'));
					return false;
				}
				var AttachMaxLimit = $('#AttachMaxLimit_Master').val();
				if (AttachMaxLimit == "") {
					_alert(2, '邮件配置', '请输入附件大小', $('#AttachMaxLimit_Master'));
					return false;
				}
				var ServerVerify = ($('#ServerVerify_Master').find('input[type=radio]:checked').val() == '2');
				var SenderEmailPass = "";
				if (ServerVerify) {
					SenderEmailPass = $('#SenderEmailPass_Master').val();
					if (SenderEmailPass == "") {
						_alert(2, '邮件配置', '请输入验证码', $('#SenderEmailPass_Master'));
						return false;
					}
				} else {
					SenderEmailPass = null;
				}
				smtpconfig_save.SmtpConfigName = SmtpConfigName_Master;
				smtpconfig_save.SmtpServer = SmtpServer;
				smtpconfig_save.DNS = DNS;
				smtpconfig_save.Sender = Sender;
				smtpconfig_save.SenderEmail = SenderEmail;
				smtpconfig_save.AttachMaxLimit = AttachMaxLimit;
				smtpconfig_save.ServerVerify = ServerVerify;
				smtpconfig_save.SenderEmailPass = SenderEmailPass;
				smtpconfig_save.EnCode=parseInt($('#EnCode').val());
				smtpconfig_save.Flag=parseInt($('#Flag').val());
				if (save_smtpconfig()) {
					$('.btn').blur(); parent.layer.open({
						type: 1,
						title: '邮件配置',
						content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						yes: function (i) {
							parent.layer.close(i);
							d.close().remove();
						}
					});
				}
			})
		}
		function PwdModStrategy() {
			pwd_clear();
			if (item_pwd == null) {
				return false;
			}
			$('#SmtpConfigName_Master').val('');
			$('#SmtpConfigName_Stand').val('');
			$('#FTPServerName_Master').val('');
			$('#FTPServerName_Stand').val('');
			$('#PwdModStrategyName').hide();
			if (item_pwd.StartTime != null) {
				var StartTime_str = item_pwd.StartTime.split('T');
				var time_str = StartTime_str[1].split(':');
				$('#StartDay').val(StartTime_str[0]);
				$('#Starth').val(time_str[0]);
				$('#Startm').val(time_str[1]);
				$('#Starts').val(time_str[2]);
			}
			if (item_pwd.PeriodValue != null) {
				$('#PeriodValue').val(item_pwd.PeriodValue);
			}
			if (item_pwd.PeriodType != null) {
				$('#PeriodType').val(item_pwd.PeriodType).trigger('change');
			}
			switch (item_pwd.PasswordType) {
				case 1:
					$('#a1').iCheck('check');
					$('#Password').hide();
					break;
				case 2:
					$('#a2').iCheck('check');
					$('#Password').hide();
					break;
				case 3:
					$('#a3').iCheck('check');
					$('#Password').show();
					$('#Password').val(item_pwd.Password);
					pwdmod.Password = item_pwd.Password;
                    pwdauth_save.PwdModStrategyInfo.Password=item_pwd.Password;
					break;
			}
			if (item_pwd.ResultSendMethod <= 3 && item_pwd.ResultSendMethod >= 1) {
				$('#ResultSendMethod').val(item_pwd.ResultSendMethod).trigger('change');
			}
			if (item_pwd.MasterSmtpConfig != null) {
				if(item_pwd.MasterSmtpConfig.SmtpConfigId>0){
					item_smtp = item_pwd.MasterSmtpConfig;
					$('.xSelect_stmp1').data('value',item_smtp.SmtpConfigId);
					$('.xSelect_stmp1 .xSelect-show-text').text(item_smtp.SmtpConfigName);
					update_xSelect($('.xSelect_stmp2'));
				}
			} else {
				$('.xSelect_stmp1').data('value',0);
				$('.xSelect_stmp1 .xSelect-show-text').text('全局指定');
			}
			if (item_pwd.StandBySmtpConfig != null) {
				if(item_pwd.StandBySmtpConfig.SmtpConfigId>0){
					item_smtp = item_pwd.StandBySmtpConfig;
					$('.xSelect_stmp2').data('value',item_smtp.SmtpConfigId);
					$('.xSelect_stmp2 .xSelect-show-text').text(item_smtp.SmtpConfigName);
					update_xSelect($('.xSelect_stmp1'));
				}
			} else {
				$('.xSelect_stmp2').data('value',0);
				$('.xSelect_stmp2 .xSelect-show-text').text('全局指定');
			}
			if (item_pwd.MasterFTPServer != null) {
				if (item_pwd.MasterFTPServer.FTPServerId>0) {
					item_ftp = item_pwd.MasterFTPServer;
					$('.xSelect_ftp1').data('value',item_ftp.FTPServerId);
					$('.xSelect_ftp1 .xSelect-show-text').text(item_ftp.FTPServerName);
					update_xSelect($('.xSelect_ftp2'));
				}
			} else {
				$('.xSelect_ftp1').data('value',0);
				$('.xSelect_ftp1 .xSelect-show-text').text('全局指定');
			}
			if (item_pwd.StandByFTPServer != null) {
				if (item_pwd.StandByFTPServer.FTPServerId>0) {
					item_ftp = item_pwd.StandByFTPServer;
					$('.xSelect_ftp2').data('value',item_ftp.FTPServerId);
					$('.xSelect_ftp2 .xSelect-show-text').text(item_ftp.FTPServerName);
					update_xSelect($('.xSelect_ftp1'));
				} else {
				}
			} else {
				$('.xSelect_ftp2').data('value',0);
				$('.xSelect_ftp2 .xSelect-show-text').text('全局指定');
			}
			if(item_pwd.ReceiverSet==null){
				item_pwd.ReceiverSet=new Array();
			}
			if(item_pwd.ResultSendMethod==1 && item_pwd.ReceiverSet.length>0){
				var num=0;
				for(var i=0;i<item_pwd.ReceiverSet.length;i++){
					var item=item_pwd.ReceiverSet[i];
					//////console.log(item);
					if($('#ReceiverSet option[value='+item.Id+']').length==1){
						if(num>0){
							_addReceiver($('#ReceiverSet').siblings('i'));
						}
						$('#ReceiverSet').val(item.Id).trigger('change');
						num++;
					}
				}
			}else if(item_pwd.ResultSendMethod==2 && item_pwd.ReceiverSet.length>0){
				var num=0;
				for(var i=0;i<item_pwd.ReceiverSet.length;i++){
					var item=item_pwd.ReceiverSet[i];
					//////console.log(item);
					if($('#ReceiverSet2 option[value='+item.Id+']').length==1){
						if(num>0){
							_addReceiver($('#ReceiverSet2').siblings('i'));
						}
						$('#ReceiverSet2').val(item.Id).trigger('change');
						num++;
					}
				}
			}
			// _viewHTML('#userTreeh', 'UG');
		}
		//StandByFTPServer输入
		//MasterFTPServer输入
		function MasterFTPServer_input(item_ftp) {
			$('#FTPServerName_Master').val(item_ftp.FTPServerName);
			$('#ServerIP_Master').val(item_ftp.ServerIP);
			$('#ServerUser_Master').val(item_ftp.ServerUser);
			$('#ServerPasswd_Master').val(item_ftp.ServerPasswd);
			ftpserver_save.ServerPasswd = item_ftp.ServerPasswd;
			$('#ServerPath_Master').val(item_ftp.ServerPath);
			$('#DNS_FTP_Master').val(item_ftp.DNS);
			$('#ftpFlag').val(item_ftp.Flag).trigger('change');
			$('#IfPasv').val(item_ftp.IfPasv?"1":"2").trigger('change');
		}
		//MasterSmtpConfig输入
		function MasterSmtpConfig_input(item_smtp) {
			$('#SmtpConfigName_Master').val(item_smtp.SmtpConfigName);
			$('#SmtpServer_Master').val(item_smtp.SmtpServer);
			$('#Sender_Master').val(item_smtp.Sender);
			$('#SenderEmail_Master').val(item_smtp.SenderEmail);
			$('#AttachMaxLimit_Master').val(item_smtp.AttachMaxLimit);
			if (item_smtp.ServerVerify) {
				$('#b2').iCheck('check');
				$('#SenderEmailPass_Master').val(item_smtp.SenderEmailPass);
				smtpconfig_save.SenderEmailPass = item_smtp.SenderEmailPass;
			} else {
				$('#b1').iCheck('check');
			}
			$('#DNS_Master').val(item_smtp.DNS);
			$('#test_Master').iCheck('uncheck');
			$('#test_Master').parents('label').next('span.forCheck').hide();
			$('#test_Master_input').val('');
			$('#EnCode').val(item_smtp.EnCode).trigger('change');
			$('#Flag').val(item_smtp.Flag).trigger('change');
		}
		//StandBySmtpConfig输入
		function StandBySmtpConfig_input() {
			$('#StandBySmtpConfig').attr('name', item_smtp.SmtpConfigId);
			$('#SmtpServer_Stand').val(item_smtp.SmtpServer);
			$('#Sender_Stand').val(item_smtp.Sender);
			$('#SenderEmail_Stand').val(item_smtp.SenderEmail);
			$('#AttachMaxLimit_Stand').val(item_smtp.AttachMaxLimit);
			if (item_smtp.ServerVerify) {
				$('#c2').iCheck('check');
				$('#SenderEmailPass_Stand').val(item_smtp.SenderEmailPass);
				smtpconfig_save.SenderEmailPass = item_smtp.SenderEmailPass;
			} else {
				$('#c1').iCheck('check');
			}
			$('#DNS_Stand').val(item_smtp.DNS);
			$('#test_Stand').iCheck('uncheck');
			$('#test_Stand').parents('label').next('span.forCheck').hide();
			$('#test_Stand_input').val('');
		}
		//邮件FTP下拉框删除函数
		function _delNode(obj) {
			var layer_value = '自动改密';
			var value = obj.value;
			delete_fun(value, 'pwdmod');
			pwd_clear();
		}
		//删除邮件或TFP
		function delete_fun(value, type) {
			var item = 0;
			type = "pwdmod";
			alert_value = '自动改密';
			item = value;
			$.ajax({
				url: '/bhost/del_' + type,
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a1: item },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						_alert(0, alert_value, "删除成功");
					} else {
						_alert(1, alert_value, result.ErrMsg);
						return false;
					}
				}
			});
		}

		function _addNew2() {
			var $item = $focusObj.next('input.forName');
			$item.show().focus();
			$('#PwdModStrategy').data('value', -1);
			$('.'+$('#PwdModStrategy .xSelect-show').data('id')).find('.active').removeClass('active');
			// _viewHTML('#userTreeh', 'UG');
			pwd_clear();
			$item.val('');
			$('.xSelect-show-text',$focusObj).text('添加新策略');
		}

		//矫正
		var pass_correct = 0;
		//smtpconfig_save
		function save_smtpconfig() {
			var pass = true;
			if (smtpconfig_save == null) {
				return false;
			}
			msstr = aceg(JSON.stringify(smtpconfig_save),$("input[name=se]").val());
			$.ajax({
				url: "/bhost/add_smtpconfig",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a1: JSON.stringify(smtpconfig_save),a2:'密码管理>自动改密',m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						if(smtpconfig[result.SmtpConfigId]!=null){
							
						}else{
							smtpconfig[result.SmtpConfigId]={};
							smtpconfig[result.SmtpConfigId]["type"]='edit';
							smtpconfig[result.SmtpConfigId]["value"]=result.SmtpConfigId;
							smtpconfig[result.SmtpConfigId]["name"]=smtpconfig_save.SmtpConfigName;
							update_xSelect(0);
						}
						var focusObj_value=$focusObj.data('value');
						if(focusObj_value=='0' || focusObj_value=='' || focusObj_value==undefined){
							$('.xSelect-show-text',$focusObj).text(smtpconfig_save.SmtpConfigName);
                   			$focusObj.data('value',result.SmtpConfigId);
						}
						// $('.xSelect-show-text',$focusObj).text(smtpconfig_save.SmtpConfigName);
                   		// $focusObj.data('value',result.SmtpConfigId);
						switch ($focusObj.attr('class').split(' ')[1]) {
							case 'xSelect_ftp1':
								update_xSelect($('.xSelect_ftp2'));
								break;
							case 'xSelect_ftp2':
								update_xSelect($('.xSelect_ftp1'));
								break;
							case 'xSelect_stmp1':
								update_xSelect($('.xSelect_stmp2'));
								break;
							case 'xSelect_stmp2':
								update_xSelect($('.xSelect_stmp1'));
								break;
						}
					} else {
						if (result.ErrMsg == "同名邮件服务器配置已存在") {
							_alert(1, "邮件配置", result.ErrMsg);
						} else {
							_alert(1, "邮件配置", result.ErrMsg);
						}
						pass = false;
					}
				}
			});
			return pass;
		}
		//ftpserver_save
		function save_ftpserver() {
			if (ftpserver_save == null) {
				return false;
			}
			var pass = true;
			msstr = aceg(JSON.stringify(ftpserver_save),$("input[name=se]").val());
			$.ajax({
				url: "/bhost/add_ftpserver",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a1: JSON.stringify(ftpserver_save),a2:'密码管理>自动改密',m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						if(ftpserver[result.FTPServerId]!=null){
						}else{
							ftpserver[result.FTPServerId]={};
							ftpserver[result.FTPServerId]["type"]='edit';
							ftpserver[result.FTPServerId]["value"]=result.FTPServerId;
							ftpserver[result.FTPServerId]["name"]=ftpserver_save.FTPServerName;
							update_xSelect(0);
						}
						var focusObj_value=$focusObj.data('value');
						if(focusObj_value=='0' || focusObj_value=='' || focusObj_value==undefined){
							$('.xSelect-show-text',$focusObj).text(ftpserver_save.FTPServerName);
							$focusObj.data('value',result.FTPServerId);
						}
						// $('.xSelect-show-text',$focusObj).text(ftpserver_save.FTPServerName);
						// $focusObj.data('value',result.FTPServerId);
						switch ($focusObj.attr('class').split(' ')[1]) {
							case 'xSelect_ftp1':
								update_xSelect($('.xSelect_ftp2'));
								break;
							case 'xSelect_ftp2':
								update_xSelect($('.xSelect_ftp1'));
								break;
							case 'xSelect_stmp1':
								update_xSelect($('.xSelect_stmp2'));
								break;
							case 'xSelect_stmp2':
								update_xSelect($('.xSelect_stmp1'));
								break;
						}
					} else {
						if (result.ErrMsg == "同名的FTP服务器配置已存在") {
							_alert(1, "FTP配置", result.ErrMsg, $('#FTPServerName_Master'));
						} else {
							_alert(1, "FTP配置", result.ErrMsg);
						}
						pass = false;
					}
				}

			});
			return pass;
		}
		//function pwdmodsave
		function save_pwdmod(pwdmod) {
			if (pwdmod == null) {
				return true;
			}
			var pass = true;
			msstr = aceg(JSON.stringify(pwdmod),$("input[name=se]").val());
			$.ajax({
				url: "/bhost/add_pwdmod",
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a1: JSON.stringify(pwdmod), m1:msstr },
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result) {
						pwdauth_save.PwdModStrategyId = result.PwdModStrategyId;
					} else {
						_alert(1, '自动改密', result.ErrMsg);
						pass = false;
					}
				}
			});
			return pass;
		}
		function _finish() {
			var pass=true;
			$.ajax({
				url: '/bhost/get_hostpwdstrategy',
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a1: usercode },
				success: function (result) {
					result = result.replace('None', 'null');
					var hostpwd_result = JSON.parse(result);
					if (hostpwd_result.Result) {
						hostpwd_data = hostpwd_result.info;
						if (hostpwd_data == null) {
							pass=false;
							parent.layer.open({
								type: 1,
								title: '自动改密',
								content: '<div class="layer-alert"><i class="alert warning"></i>改密设定未配置</div>',
								btn: ['确&nbsp;&nbsp;定'],
								btnAlign: 'c',
								closeBtn: false,
								skin: 'layer-custom',
								area: ['380px', '310px'],
								move: false,
								resize: false,
								yes: function (i) {
									parent.layer.close(i);
									hostpwdstrategy();
								}
							});
						}else if((hostpwd_data.ReceiverSet==null || hostpwd_data.ReceiverSet.length==0)){
							pass=false;
							parent.layer.open({
								type: 1,
								title: '自动改密',
								content: '<div class="layer-alert"><i class="alert warning"></i>改密设定未配置</div>',
								btn: ['确&nbsp;&nbsp;定'],
								btnAlign: 'c',
								closeBtn: false,
								skin: 'layer-custom',
								area: ['380px', '310px'],
								move: false,
								resize: false,
								yes: function (i) {
									parent.layer.close(i);
									hostpwdstrategy();
								}
							});
						}else{
							$.ajax({
								url: '/bhost/get_global_IfPwdApprove',
								type: "POST",
								async: false,
								data: { a0: $("input[name=se]").val() },
								success: function (result_global) {
									var result_global=JSON.parse(result_global);
									if(result_global.Result){
										if(result_global.info.PwdApproveNum && (hostpwd_data.PwdApproveUserSet==null || hostpwd_data.PwdApproveUserSet.length<result_global.info.PwdApproveNum || hostpwd_data.PwdFileApproveUserSet==null || hostpwd_data.PwdFileApproveUserSet.length<result_global.info.PwdFileApproveNum)){
											pass=false;
											parent.layer.open({
												type: 1,
												title: '自动改密',
												content: '<div class="layer-alert"><i class="alert warning"></i>改密设定审批管理员配置错误</div>',
												btn: ['确&nbsp;&nbsp;定'],
												btnAlign: 'c',
												closeBtn: false,
												skin: 'layer-custom',
												area: ['380px', '310px'],
												move: false,
												resize: false,
												yes: function (i) {
													parent.layer.close(i);
													hostpwdstrategy();
												}
											});
										}
									}else{
											pass=false;
										_alert(2,'全局策略',result_global.ErrMsg);
										return false;
									}
								}
							});
						}
					} else {
						pass=false;
						_alert(1, '自动改密', hostpwd_result.ErrMsg);
						return false;
					}
				}
			});
			if(!pass){
				return false;
			}
			var PwdModStrategy_id = $('#PwdModStrategy').data('value');
			pwdauth_save.Enabled=pwdauth.Enabled;
			pwdauth_save.InvalidLog=null;
			pwdauth_save.Status=pwdauth.Status;
			pwdauth_save.PwdModStrategyInfo.Type=1;
			$.ajax({
				url: '/bhost/get_global_IfPwdApprove',
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val() },
				success: function (result) {
					var result=JSON.parse(result);
					if(result.Result){
						if(result.info.PwdApproveNum){
							pwdauth_save.ReviewStatus=1;
						}else{
							$.ajax({
								url: '/bhost/get_hostpwdstrategy',
								type: "POST",
								async: false,
								data: { a0: $("input[name=se]").val() },
								success: function (result) {
									var result=JSON.parse(result);
									if(result.Result){
										if(result.info==null){
											pwdauth_save.ReviewStatus=0;
										}else{
											if(result.info.PwdApproveNum){
												pwdauth_save.ReviewStatus=1;
											}else{
												pwdauth_save.ReviewStatus=0;
											}
										}
									}else{
										_alert(2,'全局策略',result.ErrMsg);
										return false;
									}
								}
							});
						}
					}else{
						_alert(2,'全局策略',result.ErrMsg);
						return false;
					}
				}
			});
			if (parseInt(PwdModStrategy_id) ==pwdmod_id) {
				
				pwdauth_save.PwdModStrategyInfo.Type=2;
			}
			var PwdModStrategy=$('#PwdModStrategy .xSelect-show-text').text();
			var PwdModStrategyName = $('#PwdModStrategyName').val();
			if (parseInt(PwdModStrategy_id)==-1 && PwdModStrategyName == "") {
				_alert(2, '自动改密', '请输入策略名称');
				return false;
			}
			var StartDay = $('#StartDay').val();
			var Starth = $('#Starth').val();
			var Startm = $('#Startm').val();
			var Starts = $('#Starts').val();
			var PeriodValue = $('#PeriodValue').val();
			if (PeriodValue == '') {
				_alert(2, '自动改密', '请输入重复周期', $('#PeriodValue'));
				return false;
			}
			if (PeriodValue == 0) {
				_alert(1, '自动改密', '重复周期不能为0', $('#PeriodValue'));
				return false;
			}
			if (PeriodValue > max) {
				$('#PeriodValue').val(max);
				PeriodValue = max;
			}
			var PeriodType = $('#PeriodType').val();
			var PasswordType = $('#PasswordType').find('input[type=radio]:checked').val();
			if (PasswordType == '3') {
				var Password = $('#Password').val();
				if($("#Password").val().length > 64){
					_alert(2, '自动改密', "密码不能超过系统限定64位", $("#Password"));
					return false;
				}
				if (Password == '') {
					_alert(2, '自动改密', '请输入密码', $('#Password'));
					return false;
				}
				if(Password.length<hostpwd_data.PwdMinLen){
					_alert(2, '自动改密', '密码最小长度为'+hostpwd_data.PwdMinLen, $('#Password'));
					return false;
				}
				if(hostpwd_data.IfPwdComplex){
					if(Password.replace(/[^a-z]/g, '').length<hostpwd_data.PwdIncLowerAphaCount){
						_alert(2, '自动改密', '小写字母最小数目为'+hostpwd_data.PwdIncLowerAphaCount, $('#Password'));
						return false;
					}
					if(Password.replace(/[^A-Z]/g, '').length<hostpwd_data.PwdIncUpperAphaCount){
						_alert(2, '自动改密', '大写字母最小数目为'+hostpwd_data.PwdIncUpperAphaCount, $('#Password'));
						return false;
					}
					if(Password.replace(/\D/g, '').length<hostpwd_data.PwdIncNumberCount){
						_alert(2, '自动改密', '数字最小数目为'+hostpwd_data.PwdIncNumberCount, $('#Password'));
						return false;
					}
					if(Password.replace(/[^\`\~\!\@\#\$\%\^\&\*\(\)\-\=\_\+\[\]\\\{\}\|\;\'\:\"\,\.\/\<\>\?]/g, '').length<hostpwd_data.PwdIncSpecialCharCount){
						_alert(2, '自动改密', '特殊字符最小数目为'+hostpwd_data.PwdIncSpecialCharCount, $('#Password'));
						return false;
					}
				}
				if(hostpwd_data.IfPwdUnRepeat){
					for(var i=0;i<Password.length;i++){
						var char_index=Password.charAt(i);
						if(Password.split(char_index).length-1>hostpwd_data.CharRepeatCount){
							_alert(2, '自动改密', '单个字符使用最大次数为'+hostpwd_data.CharRepeatCount, $('#Password'));
							return false;
						}
					}
					//////console.log('pwdauth_save.PwdModStrategyInfo.Password:'+pwdauth_save.PwdModStrategyInfo.Password);
					if(pwdauth_save.PwdModStrategyInfo.Password!=null){
						var Password_tmp=Password;
						for(var i=0;i<pwdauth_save.PwdModStrategyInfo.Password.length;i++){
							var char_index=pwdauth_save.PwdModStrategyInfo.Password.charAt(i);
							Password_tmp=Password_tmp.split(char_index).join('');
						}
						if(Password_tmp.length<hostpwd_data.UnRepeatCharCount){
							_alert(2, '自动改密', '不出现在旧密码中的字符的最小数为'+hostpwd_data.UnRepeatCharCount, $('#Password'));
							return false;
						}
					}
				}
			} else {
				var Password = null;
			}
			var SendMethod = $("#ResultSendMethod").val();
			pwdmod.ReceiverSet = null;
			pwdmod.MasterSmtpConfigId = null;
			pwdmod.StandBySmtpConfigId = null;
			pwdmod.MasterFTPServerId = null;
			pwdmod.StandByFTPServerId = null;
            pwdauth_save.PwdModStrategyInfo.ReceiverSet=null;
            pwdauth_save.PwdModStrategyInfo.MasterSmtpConfigId=null;
            pwdauth_save.PwdModStrategyInfo.StandBySmtpConfigId=null;
            pwdauth_save.PwdModStrategyInfo.MasterFTPServerId=null;
            pwdauth_save.PwdModStrategyInfo.StandByFTPServerId=null;
			if (SendMethod == "1") {
				var smtpconfig_save_1 = null;
				var smtpconfig_save_2 = null;
				var SmtpConfigId = $('.xSelect_stmp1').data('value');
				if (SmtpConfigId == "" || SmtpConfigId==undefined) {
					SmtpConfigId=0;
				}
				pwdmod.MasterSmtpConfigId = parseInt(SmtpConfigId);
				pwdauth_save.PwdModStrategyInfo.MasterSmtpConfigId=parseInt(SmtpConfigId);
				pwdauth_save.PwdModStrategyInfo.MasterSmtpConfigName=$('.xSelect_stmp1 .xSelect-show-text').text();
				var StandBySmtpConfig_id = $('.xSelect_stmp2').data('value');
				if ((StandBySmtpConfig_id == '' || StandBySmtpConfig_id==undefined)) {
					StandBySmtpConfig_id=0;
				}
				pwdmod.StandBySmtpConfigId = parseInt(StandBySmtpConfig_id);
				pwdauth_save.PwdModStrategyInfo.StandBySmtpConfigId=parseInt(StandBySmtpConfig_id);
				pwdauth_save.PwdModStrategyInfo.StandBySmtpConfigName=$('.xSelect_stmp2 .xSelect-show-text').text();
				pwdmod.ReceiverSet = new Array();
				pwdauth_save.PwdModStrategyInfo.ReceiverSet=new Array();
				var $all=$('#select_r>li');
				for(var i=$all.length-1;i>=0;i--){
					var $li=$all.eq(i);
					pwdmod.ReceiverSet.push({"Id":parseInt($li.attr('id')),"Type":1,"Name":$li.children('input').val()});
				}
				if ($('#ReceiverSet').val()!='0'){
					pwdmod.ReceiverSet.push({"Id":parseInt($('#ReceiverSet').val()),"Type":1,"Name":$('#ReceiverSet option:selected').text()});
				}
				if (pwdmod.ReceiverSet.length == 0) {
					_alert(2, '自动改密', '请选择接收者');
					return false;
				}
				//////console.log(pwdmod);
				$.each(pwdmod.ReceiverSet, function (i, item) {
					if (item == null) {
						return true;
					}
					if (item.Type == 1) {
						$.each(pwdmod.ReceiverSet, function (i1, item1) {
							if (item1 == null) {
								return true;
							}
							if (item.Id == item1.Id && i != i1) {
								pwdmod.ReceiverSet[i1] = null;
							}
						})
					}
				});
				remove_null(pwdmod.ReceiverSet);
				pwdauth_save.PwdModStrategyInfo.ReceiverSet=JSON.parse(JSON.stringify(pwdmod.ReceiverSet));
			} else if (SendMethod == "2") {
				var ftpserver_save_1 = null, ftpserver_save_2 = null;
				var MasterFTPServer_id = $('.xSelect_ftp1').data('value');
				if (MasterFTPServer_id == "" || MasterFTPServer_id==undefined) {
					MasterFTPServer_id=0;
				}
				pwdmod.MasterFTPServerId = parseInt(MasterFTPServer_id);
				pwdauth_save.PwdModStrategyInfo.MasterFTPServerId=parseInt(MasterFTPServer_id);
				pwdauth_save.PwdModStrategyInfo.MasterFTPServerName=$('.xSelect_ftp1 .xSelect-show-text').text();
				var StandByFTPServer_id = $('.xSelect_ftp2').data('value');
				if ((StandByFTPServer_id == '' || StandByFTPServer_id==undefined)) {
					StandByFTPServer_id=0;
				}
				pwdmod.StandByFTPServerId = parseInt(StandByFTPServer_id);
				pwdauth_save.PwdModStrategyInfo.StandByFTPServerId=parseInt(StandByFTPServer_id);
				pwdauth_save.PwdModStrategyInfo.StandByFTPServerName=$('.xSelect_ftp2 .xSelect-show-text').text();
				pwdmod.ReceiverSet = new Array();
				pwdauth_save.PwdModStrategyInfo.ReceiverSet=new Array();
				var $all=$('#select_r2>li');
				for(var i=$all.length-1;i>=0;i--){
					var $li=$all.eq(i);
					pwdmod.ReceiverSet.push({"Id":parseInt($li.attr('id')),"Type":1,"Name":$li.children('input').val()});
				}
				if ($('#ReceiverSet2').val()!='0'){
					pwdmod.ReceiverSet.push({"Id":parseInt($('#ReceiverSet2').val()),"Type":1,"Name":$('#ReceiverSet2 option:selected').text()});
				}
				if (pwdmod.ReceiverSet.length == 0) {
					_alert(2, '自动改密', '请选择接收者');
					return false;
				}
				//////console.log(pwdmod);
				$.each(pwdmod.ReceiverSet, function (i, item) {
					if (item == null) {
						return true;
					}
					if (item.Type == 1) {
						$.each(pwdmod.ReceiverSet, function (i1, item1) {
							if (item1 == null) {
								return true;
							}
							if (item.Id == item1.Id && i != i1) {
								pwdmod.ReceiverSet[i1] = null;
							}
						})
					}
				});
				remove_null(pwdmod.ReceiverSet);
				pwdauth_save.PwdModStrategyInfo.ReceiverSet=JSON.parse(JSON.stringify(pwdmod.ReceiverSet));
			}
			if(parseInt(PwdModStrategy_id)<0){
				pwdmod.PwdModStrategyId = 0;
				pwdauth_save.PwdModStrategyInfo.PwdModStrategyId=0;
			}else{
				pwdmod.PwdModStrategyId = parseInt(PwdModStrategy_id);
				pwdauth_save.PwdModStrategyInfo.PwdModStrategyId=parseInt(PwdModStrategy_id);

			}
			if (parseInt(PwdModStrategy_id) < 0 && PwdModStrategyName != "") {
				pwdmod.PwdModStrategyName = PwdModStrategyName;
				pwdauth_save.PwdModStrategyInfo.PwdModStrategyName=PwdModStrategyName;
			} else if (parseInt(PwdModStrategy_id) > 0  && PwdModStrategy != "") {
				pwdmod.PwdModStrategyName = PwdModStrategy;
				pwdauth_save.PwdModStrategyInfo.PwdModStrategyName=PwdModStrategy;
			}else if(parseInt(PwdModStrategy_id)==pwdmod_id && old_pwdmod_id==0){
				pwdmod.PwdModStrategyName = '#'+ $("input[name=se]").val()+Date.parse(new Date());
				pwdauth_save.PwdModStrategyInfo.PwdModStrategyName='#'+ $("input[name=se]").val()+Date.parse(new Date());
			}else{
				pwdmod.PwdModStrategyId = parseInt(old_pwdmod_id);
				pwdauth_save.PwdModStrategyInfo.PwdModStrategyId=parseInt(old_pwdmod_id);
				pwdmod.PwdModStrategyName=old_pwdmod_name;
				pwdauth_save.PwdModStrategyInfo.PwdModStrategyName=old_pwdmod_name;
			}
			pwdmod.StartTime = StartDay + 'T' + Starth + ':' + Startm + ':' + Starts;
			pwdauth_save.PwdModStrategyInfo.StartTime=StartDay + 'T' + Starth + ':' + Startm + ':' + Starts;
			pwdmod.PeriodType = parseInt(PeriodType);
			pwdauth_save.PwdModStrategyInfo.PeriodType=parseInt(PeriodType);
			pwdmod.PeriodValue = parseInt(PeriodValue);
			pwdauth_save.PwdModStrategyInfo.PeriodValue=parseInt(PeriodValue);
			pwdmod.PasswordType = parseInt(PasswordType);
			pwdauth_save.PwdModStrategyInfo.PasswordType=parseInt(PasswordType);
			pwdmod.Password = Password;
			pwdauth_save.PwdModStrategyInfo.Password=Password;
			pwdmod.ResultSendMethod = parseInt(SendMethod);
			pwdauth_save.PwdModStrategyInfo.ResultSendMethod=parseInt(SendMethod);
			if (parseInt(PwdModStrategy_id) >0 && parseInt(PwdModStrategy_id)!=pwdmod_id) {
				$.ajax({
					url: "/bhost/get_pwdmodstrategy",
					type: "POST",
					async: false,
					data: { a0: $("input[name=se]").val(),a1:PwdModStrategy_id},
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result) {
							item_pwd = result.info.data[0];
						} else {
							_alert(1, '自动改密', result.ErrMsg);
							return false;
						}
					}
				});
				var pwd_item = JSON.parse(JSON.stringify(item_pwd));
				if (pwd_item.MasterFTPServer != null) {
					pwd_item['MasterFTPServerId'] = pwd_item.MasterFTPServer.FTPServerId;
				} else {
					pwd_item['MasterFTPServerId'] = null;
				}
				delete pwd_item.MasterFTPServer;
				if (pwd_item.MasterSmtpConfig != null) {
					pwd_item['MasterSmtpConfigId'] = pwd_item.MasterSmtpConfig.SmtpConfigId;

				} else {
					pwd_item['MasterSmtpConfigId'] = null;
				}
				delete pwd_item.MasterSmtpConfig;
				if (pwd_item.StandBySmtpConfig != null) {
					pwd_item['StandBySmtpConfigId'] = pwd_item.StandBySmtpConfig.SmtpConfigId;

				} else {
					pwd_item['StandBySmtpConfigId'] = null;
				}
				delete pwd_item.StandBySmtpConfig;
				if (pwd_item.StandByFTPServer != null) {
					pwd_item['StandByFTPServerId'] = pwd_item.StandByFTPServer.FTPServerId;

				} else {
					pwd_item['StandByFTPServerId'] = null;
				}
				delete pwd_item.StandByFTPServer;
				pwd_item['UserCode'] = pwdmod.UserCode;
				
				var pwdmod_change = JSON.parse(JSON.stringify(pwdmod));
				$.each(pwdmod_change.ReceiverSet, function (i, item) {
					if (item.Type == 2) {
						if (item.IsGroupAuth) {
							delete item.IsGroupAuth;
						} else {
							pwdmod_change.ReceiverSet[i] = null;
						}
					}
				});
				remove_null(pwdmod_change.ReceiverSet);
				if (pwdmod_change.ReceiverSet != null) {
					pwdmod_change.ReceiverSet.sort(sortId);
				}
				if (pwd_item.ReceiverSet != null) {
					pwd_item.ReceiverSet.sort(sortId);
				}
				delete pwdmod_change.Password_old;
				if (!Compare(pwdmod_change, pwd_item)) {
					$.ajax({
						url: '/bhost/find_mod_to_other_pwdauth',
						type: "POST",
						async: false,
						data: { a0: $("input[name=se]").val(), a1: document.frm_pwdauth_add.a.value, a2: pwdmod.PwdModStrategyId },
						success: function (result) {
							var result = JSON.parse(result);
							if (result.Result) {
								if (result.num > 0) {
									$('.btn').blur(); parent.layer.open({
										type: 1,
										title: '自动改密',
										content: '<div class="layer-alert"><i class="alert warning"></i>该密码策略应用于其他计划，是否修改</div>',
										btn: ['确&nbsp;&nbsp;定', '取&nbsp;&nbsp;消'],
										btnAlign: 'c',
										closeBtn: false,
										skin: 'layer-custom',
										area: ['380px', '310px'],
										move: false,
										resize: false,
										yes: function (i) {
											parent.layer.close(i);
											pwdauth_save.PwdModStrategyInfo.IsModified=true;
											save_pwd_auth();
										}
									});
								} else {
									pwdauth_save.PwdModStrategyInfo.IsModified=true;
									save_pwd_auth();
								}
							}
						}
					});

				} else {
					save_pwd_auth();
				}
			} 
			else {
				pwdauth_save.PwdModStrategyInfo.IsModified=true;
				save_pwd_auth();
			}
			

		}
		function sortId(a, b) {
			return a.Id - b.Id
		}
		function remove_null(item_array) {
			$.each(item_array, function (i, item) {
				if (item == null) {
					item_array.splice((i), 1);
					remove_null(item_array);
					return false;
				}
			});
		}
		function save_pwd_auth() {
			pwdauth_save.PasswordAuthSet = new Array();
			pwdauth_save.AuthScope = new Array();
			pwdauth_save.AuthServiceSet = new Array();
			pwdauth_save.HostSet = new Array();
			pwdauth_save.DeleteAuthObject = new Array();
			pwdauth_save.PwdModPlanId = parseInt(document.frm_pwdauth_add.a.value);
			var PwdModPlanName = $('#PwdModPlanName').val();
			pwdauth_save.PwdModPlanName = PwdModPlanName;
			pwdauth_save.IsSendPrePwdFile = $('#IsSendPrePwdFile').is(':checked');
			if ($("#typeSet").val() == 2) { //范围已定义
				if ($("#define_select").val() == 1) {
					if ($("#mix_select").val() == 1) {
						pwdauth_save.AuthMode = 3; //范围所有
					} else if ($("#mix_select").val() == 2) {
						pwdauth_save.AuthMode = 2; //范围共有
					}
				} else { //范围自定义
					pwdauth_save.AuthMode = 4;
				}
			} else { //对象指定
				pwdauth_save.AuthMode = 1;
			}
			if (pwdauth_save.AuthMode == 3 || pwdauth_save.AuthMode == 2) {
				var account_flag = 0;
				if ($("#a_mix_select").val() == 2){
					pwdauth_save.AuthAccountId = "*";
				}else{
					$.each(accountid, function (i, item) {
						if (item == 5) {
							account_flag = 1;
							pwdauth_save.AuthAccountId = "5";
						}
					});
					if (account_flag != 1) {
						pwdauth_save.AuthAccountId = accountid.join(',');
					}
				}
				if ($("#s_mix_select").val() == 2){
					pwdauth_save.AuthService = '*';
				}else{
					if (AuthServiceSet.indexOf('-1') != -1) {
						pwdauth_save.AuthService = '*';
					} else {
						pwdauth_save.AuthService = null; //勾选部分服务
						$.each(AuthServiceSet, function (i, item) {
							var serverset = item.split('-');
							var set = {
								"ProtocolId": 1,
								"Port": 23,
								"ConnParamId": null
							}
							set.ProtocolId = serverset[0];
							set.Port = serverset[2];
							if (serverset[1] != "null") {
								set.ConnParamId = serverset[1];
							} else {
								set.ConnParamId = null;
							}
							pwdauth_save.AuthServiceSet.push(set);
						})
					}
				}
				if ($("#server_text_zdp").data('value') != undefined && $("#server_text_zdp").data('value')!='-1') {
					var serverid = '{"ServerScopeId":' + server_id + ',"Type":1,"HostList":null,"IPList":null}';
					serverid = JSON.parse(serverid);
					pwdauth_save.AuthScope.push(serverid);
				}

				$('#server_frame_list').children('div:not(:first)').each(function (i, item) {
					var v = $(item).attr('id');
					var serverid = '{"ServerScopeId":' + v + ',"Type":1,"HostList":null,"IPList":null}';
					serverid = JSON.parse(serverid);
					pwdauth_save.AuthScope.push(serverid);
				});

			} else if (pwdauth_save.AuthMode == 4) {
				if (server_id != 0) {
					var serverid = '{"ServerScopeId":' + server_id + ',"Type":1,"HostList":null,"IPList":null}';
					serverid = JSON.parse(serverid);
					pwdauth_save.AuthScope.push(serverid);
				}
				$('#server_frame_list').children('div:not(:first)').each(function (i, item) {
					var v = $(item).attr('id');
					var serverid = '{"ServerScopeId":' + v + ',"Type":1,"HostList":null,"IPList":null}';
					serverid = JSON.parse(serverid);
					pwdauth_save.AuthScope.push(serverid);
				});
				$.each(account_arry, function (i, item) {
					var account_flag = 0;
					if (item == 5) {
						account_flag = 1;
						pwdauth_save.AuthAccountId = "5";
						return false;
					}
				})
				if (account_flag != 1) {
					var arry_f = account_arry.indexOf('-1');
					if (arry_f != -1) {
						account_arry.splice(arry_f, 1);
					}
					pwdauth_save.AuthAccountId = account_arry.join(',');
				}
				pwdauth_save.AuthServiceSet = DeviceType.ServiceSet;
			} else {
				save_pwdauth_host($("#userTree"), 0);
			}
			_showLoading();
			msstr = aceg(JSON.stringify(pwdauth_save),$("input[name=se]").val());
			$.ajax({
				url: "/bhost/add_pwdauth",
				type: "POST",
				async: true,
				data: { a0: $("input[name=se]").val(), a1: JSON.stringify(pwdauth_save), m1:msstr },
				success: function (result) {
					var result = JSON.parse(result);
					_closeLoading();
					if (result.Result) {
						$('.btn').blur(); parent.layer.open({
							type: 1,
							title: '自动改密',
							content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
							btn: ['确&nbsp;&nbsp;定'],
							btnAlign: 'c',
							closeBtn: false,
							skin: 'layer-custom',
							area: ['380px', '310px'],
							move: false,
							resize: false,
							yes: function (i) {
								parent.layer.close(i);
								back(1, result.PwdModPlanId);
							}
						});
					} else {
						_alert(1, '自动改密', result.ErrMsg);
					}
				}
			});
		}
		/*
		function save_user(obj, id) {
			$(">li", obj).children('input').each(function () {
				var input_id = $(this).attr('id');
				var input_str = input_id.split('-');
				var input_state = $(this).next('span.checkbox').attr('class');
				var radio_value = $(this).siblings('span.authtype').find('input');
				var $u = $(this).parent().children('ul');
				if (input_state.indexOf('checked') > 0) {
					if (radio_value.is(':checked')) {
						var json_a = '{"Id":' + input_str[1] + ',"Type": 2,"IsGroupAuth":true}';
						pwdmod.ReceiverSet.push(JSON.parse(json_a));
						pwdauth_save.PwdModStrategyInfo.ReceiverSet.push(JSON.parse(json_a));
					} else {
						if (input_str[0] == "UGId") {
							var json_a = '{"Id":' + input_str[1] + ',"Type": 2,"IsGroupAuth":false}';
							pwdmod.ReceiverSet.push(JSON.parse(json_a));
							pwdauth_save.PwdModStrategyInfo.ReceiverSet.push(JSON.parse(json_a));
							if ($u.text() != "Loading..." && $u.text() != "") {
								save_user($u, input_str[1]);
							} else {
								$(this).siblings('i.h-aicon').click();
								$(this).siblings('i.h-aicon').click();
								save_user($u, input_str[1]);
							}
						} else {
							var json_a = '{"Id":' + input_str[2] + ',"Type": 1}';
							pwdmod.ReceiverSet.push(JSON.parse(json_a));
							pwdauth_save.PwdModStrategyInfo.ReceiverSet.push(JSON.parse(json_a));
						}
					}
				} else if (input_state.indexOf('half') > 0) {
					if ($u.text() != "Loading..." && $u.text() != "") {
						save_user($u, input_str[1]);
					} else {
						$(this).siblings('i.h-aicon').click();
						$(this).siblings('i.h-aicon').click();
						save_user($u, input_str[1]);
					}
				}
			});
		}
		*/
		function test_button(obj) {
			var input = $(obj).parent('.forCheck').find('input[class=form-text]');
			var input_str = $(input).val();
			var check = $(obj).parent('.forCheck').prev('.form-label').find('input[class=form-checkbox]');
			if ($(check).is(':checked')) {
				if (input_str == "") {
					_alert(2, '邮件配置', '请输入测试邮件', $(input));
					return false;
				} else if (!urlReg.test(input_str)) {
					_alert(1, '邮件配置', '测试邮件格式不正确', $(input));
					return false;
				}
			}
			var input_id = $(input).attr('id');
			if (input_id == 'test_Master_input') {
				var id = 'MasterSmtpConfig';
				var name = $('#MasterSmtpConfig').attr('name');
			} else {
				var id = 'StandBySmtpConfig';
				var name = $('#StandBySmtpConfig').attr('name');
			}
			$.each(smtpconfig, function (i, item) {
				if (item.SmtpConfigId == name) {
					if (id == "MasterSmtpConfig") {
						MasterSmtpConfig_input(item);
					} else {
						StandBySmtpConfig_input(item);
					}
				}
			});
			_alert(0, '邮件配置', '保存成功');
		}
	</script>
</body>

</html>
