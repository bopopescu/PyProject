<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8" http-equiv="X-UA-Compatible" content="IE=11;IE=10;IE=9; IE=8; IE=EDGE,chrome=1" />
	<title>manager</title>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<link rel="stylesheet" href="/manage/css/style.css">
	<link rel="stylesheet" href="/manage/css/new-head.css">
	<script>
		var userAgent = navigator.userAgent;
		var ie8 = userAgent.indexOf('Trident/4.0');

		if(ie8 != -1){
			document.write('<script src="/manage/js/jquery-IE8.js"></' + 'script>');
		}else{
			document.write('<script src="/manage/js/jquery.min.js"></' + 'script>');
		}
	</script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/common_e.js"></script>
	<script src="/manage/js/layer.js"></script>
	<!--icheck-->
	<script src="/manage/js/icheck.min.js"></script>
	<!--select2-->
	<script src="/manage/js/select2.full.min.js"></script>
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<script src="/manage/js/base64.js"></script>
	<script type="text/javascript" src="/manage/js/dialog-plus.js"></script>
	<link rel="stylesheet" href="/manage/css/ui-dialog.css" type="text/css" />
	<script src="/manage/js/xSelect.js"></script>
	<script>
		var screenWidth = window.screen.width;
		var vmax = 10; //显示条数
		if(screenWidth <= 1440){
			vmax  = 8;
		}
	</script>
</head>

<body style="overflow-x:hidden;overflow-y:hidden;" class="bg-white" id="scroll">

	<!-- <iframe src="" frameborder="0" width="100%" height="100%" id="Target" name="Target" style="display: none">
	</iframe> -->
	<!---->
	<div class="mainer" style="height: 95%;">

		<div class="c-cont2">
			<div class="c-wrap">
				<div class="c-table c-table2" style="min-width: 850px;">
					<div class="tab-t tab-t2">
						<div class="ctr" style="width:205px;">
							<a href="javascript:;" class="btn btn-default" onclick="_allCheck('#fList');">全选</a>
							<a href="javascript:;" class="btn btn-default" onclick="_delete_batch('#fList');">删除</a>
							<a href="javascript:;" class="btn btn-default" style="margin-right:0px;" onclick="_refresh('#fList');">刷新</a>
						</div>
						<a class="quickgo" href="javascript:;" onclick="_quickLink(this)">
							<i></i>快速连接
						</a>
						<!-- <div class="filter">
							<div id="waitTip" class="waitTip" style="float: right;margin-top: 7px; margin-left: -26px;"></div>
								<div class="search">
									<select name="find_select" id="find_select" class="filter-select" style="height: 27px;">
										<option value="all" selected>所有</option>
										<option value="hostname">主机名</option>
										<option value="hostip">主机IP</option>
										<option value="protocolname">协议</option>
									</select>
									<div style="float:left;">
										<input type="text" class="filter-text" placeholder="输入关键字" id="keyword" style="border-left:0;padding: 0px 22px 0px 4px;" onkeydown="if($('#keyword').val()==''){$('#v_clear').hide();}else{$('#v_clear').show();};if (event.keyCode == 13){_addFilter(this,false);return false;} else return;" onchange="if($('#keyword').val()==''){$('#v_clear').hide();}else{$('#v_clear').show();}" onkeyup="if($('#keyword').val()==''){$('#v_clear').hide();}else{$('#v_clear').show();}" onblur="change_input(this);">
										<i style="display:none;cursor: pointer;" class="v-check v-wrong" id="v_clear" onclick="_clear_keyword(this)"></i>
									</div>
									<button class="btn filter-btn" onclick="_addFilter(this,false)"><i class="add-filter"></i></button>
									<button class="btn filter-btn" onclick="_addFilter(this,true)"><i class="append-filter"></i></button>
								</div>
								<div class="search" id="clearFilter" style="margin: 0px 15px 0px -16px;display:none;">
									<button class="filter-btn" onclick="_clearFilter(this)"><i class="clear-filter"></i></button>
								</div>
								<div class="selector selector-multiple" id="filterWW" style="display: none;">
									<span class="ww">搜索条件</span>
									<ul></ul>
								</div>
						</div> -->
					</div>

					<!---->
					<div class="box-table box-table2">
						<table cellpadding="0" cellspacing="0">
							<thead>
								<tr><th width="50"><input class="form-checkbox" type="checkbox" name="" id="check_page"></th>
									<th style="width: 32%;">主机</th>
									<th width="328">协议类型</th>
									<th style="">描述</th>
									<th width="30" id="on_view"></th>
									<!--
										<th width="64" style="text-align: center;">收藏</th>
									-->
								</tr>
							</thead>

							<tbody id="fList">

							</tbody>
						</table>
					</div>

					<div class="tab-i tab-i2">
						<div class="il">
							每页显示<span id="page_total">8</span>条 总数：<span id="host_total">0</span>
						</div>

						<div class="ipage">
							<a href="javascript:;" class="nav2 begin" onclick="changepage(1)"><i></i></a>
							<a href="javascript:;" class="nav prev" onclick="changepage(2)"><i></i></a>
							<input type="text" value="1" id="curpage" onchange="changepage(3)">/&nbsp;<span id="totalpage">1</span>
							<a href="javascript:;" class="nav next" onclick="changepage(4)"><i></i></a>
							<a href="javascript:;" class="nav2 end" onclick="changepage(5)"><i></i></a>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div id="RightTip"></div>

		<div id="protocolLink">
			<div class="pl-tit">
				<i></i><span>快速连接</span>
			</div>

			<div class="pl-c">
				<div class="item ip_div">
					<div class="label">IP：</div>
					<div class="group">
							<input type="text" name="" value="">
					</div>
				</div>
				
				<div class="item pro_div">
					<div class="label">协议：</div>
					<div class="group">
						<div class="pro_Select" id="pro_select_div" style="margin-left: 10px;"></div>
							<!--
								<select name="" id="pro_select" class="select2" style="width: 100px" onchange="change_pro(this);">
										<option value="1">DOWNLOAD</option>
								</select>
							-->
								&nbsp;端口：<input type="text" value="12345" style="width: 28px;padding: 0 3px;" id="port_input">
						</div>
					</div>

					<div class="item sel_user">
						<div class="label">选择用户：</div>
						<div class="group">
							<select name="" id="user_select" class="select2" style="width:170px;" onchange="change_user(this);">
			
							</select>
						</div>
					</div>

					<div class="item user_div">
						<div class="label">用户名：</div>
						<div class="group">
							<input type="text" name="" value="">
						</div>
					</div>

					<div class="item auth_mode">
						<div class="label">认证方式：</div>
						<div class="group">
							<label class="pwdselect2" style="width: 72px;"><input type="radio" name="authmode" value="1" checked>密码</label>
							<label class="keyselect2" style="width: 72px;"><input type="radio" name="authmode" value="2" >密钥</label>
							<!--
							<label class="keylab" style="width: 72px;"><input type="radio" name="authmodesel" value="1" checked>选择密钥</label>
							<label class="keylab" style="width: 72px;"><input type="radio" name="authmodesel" value="2">输入密钥</label>
							<input type="text" style="margin-top: 5px;display:none;">
							
							<input type="password" style="margin-top: 5px;display:none;">-->
						</div>
					</div>
				
					<div class="item pwd_check_div">
						<div class="label">密码：</div>
						<div class="group">
							<label class="defined" style="width: 72px;"><input type="radio" name="linkpwd" value="1" checked><span>托管密码</span></label>
							<label class="savepwd" style="width: 72px;"><input type="radio" name="linkpwd" value="3" checked><span>保存密码</span></label>
							<label class="custom" style="width: 72px;"><input type="radio" name="linkpwd" value="2"><span>输入密码</span></label>
							<label class="keyselect" style="width: 72px;"><input type="radio" name="linkpwd" value="4" checked><span>选择密钥</span></label>
							<input type="password" style="margin-top: 5px;display:none;">
						</div>
					</div>
				
					<div class="item pwd_div"  style="float: left;width: 222px;">
						<div class="label">密码：</div>
						<div class="group">
							<input type="password" name="" value="" style="width: 122px;">
						</div>
					</div>
				
					<div class="item sel_key" style="float: left;width: 222px;">
						<div class="label" id="SecretKey">密钥：</div>
						<div class="form-c" id="Key_select" style="float:left;display:none;padding-left: 0px;">
							<div class="key_Select" id="EnableKey" style="margin-left: 0px;background-color:#FFFFFF;width: 132px;"></div>
						</div>
					</div>
					
					<div class="item" id="Get_attrs" style="float:left;width: 40px;">
						<div class="group ctr" style="width: 52px;padding-left: 1px;">
							<a class="btn" href="javascript:;" style="float: left;line-height: 25px;padding: 0px 4px;" onclick="get_last_password();">搜索</a>
						</div>
					</div>
					<div class="item mfs_divall">
						
						<div class="group">
							<label class='mfs' style="width:20px; margin-right: 4px;"><input type="checkbox" name="" id="EnableCFG"></label>
						</div>
						<div class="label" style="text-align: left;">应用通道</div>
					</div>
					<div class="item linkmode_div">
						<div class="label">连接模式：</div>
						<div class="group">
							<label class="local_client" style="width:72px;"><input type="radio" name="linkmode">客户端</label>
							<label class="web_con" style="width:72px;"><input type="radio" name="linkmode">WEB访问</label>
							<!-- <label class="mfs" style="width:72px;"><input type="radio" name="linkmode">应用发布</label> -->
						</div>
					</div>

					<div class="item sel_linkmode">
						<div class="label">本地客户端：</div>
						<div class="group">
							<select name="" id="sel_client" class="select2" style="width:170px;" onchange="change_client(this);">
								<option value="1">WebTool</option>
							</select>
						</div>
					</div>

					<div class="item mfs_div">
						<div class="label">客户端：</div>
						<div class="group">
							<select name="" id="sel_mfs" class="select2" style="width: 171px">
								<option value="1">WebTool</option>
							</select>
						</div>
					</div>

					<div class="item screen_div">
						<div class="label">屏幕大小：</div>
						<div class="group">
								<select name="" id="screensize" class="select2" style="width:170px;margin-bottom: 5px;">
									<option value="0">自适应</option>
									<option value="1">全屏</option>
									<option value="800*600">800*600</option>
									<option value="1024*768">1024*768</option>
									<option value="1280*800">1280*800</option>
									<option value="1440*900">1440*900</option>
							</select>

							<label style="width:70px;"><input type="checkbox" name="" id="EnableRDPClipboard">剪贴板</label>
							<label style="width:80px;"><input type="checkbox" name="" id="EnableRDPDiskMap">磁盘映射</label>
							<label style="width:80px;"><input type="checkbox" name="" id="ApplicationChannel">应用通道</label>
						</div>
					</div>

					<div class="item disk_map">
						<!--
						<div class="label">硬盘映射：</div>
						<div class="group">
							<label style="width:35px;"><input type="checkbox" name="" id="">C:</label>
							<label style="width:35px;"><input type="checkbox" name="" id="">D:</label>
							<label style="width:35px;"><input type="checkbox" name="" id="">E:</label>
							<label style="width:35px;"><input type="checkbox" name="" id="">F:</label>
							<label style="width:35px;"><input type="checkbox" name="" id="">G:</label>
							<label style="width:35px;"><input type="checkbox" name="" id="">H:</label>
						</div>
						<div class="label">硬盘映射：</div>
						<div class="group">
							<label style="width:70px;"><input type="checkbox" name="" id="">所有磁盘</label>
							<label style="width:70px;"><input type="checkbox" name="" id="">主文件夹</label>
							<label style="width:70px;"><input type="checkbox" name="" id="">文档文件夹</label>
							<label style="width: 80px;float: none;">/path:<input type="text" name="" id="" style="margin-left: 6px;width:120px"></label>
						</div>
						-->
					</div>
				
					<div class="item url">
						<div class="label">URL：</div>
						<div class="group">
							<select name="" id="" class="select2">
								<option value="1">https://www.baidu.com/</option>
							</select>
						</div>
					</div>
				
					<div class="item conn">
						<div class="label">连接参数：</div>
						<div class="group">
							<select name="" id="conn_select" class="select2" style="width:172px;">
								<option value="RADMIN">RADMIN</option>
							</select>
						</div>
					</div>
				
					<div class="item oracle">
						<div class="label">指定：</div>
						<div class="group">
							<select name="" id="appoint" class="select2" style="width: 172px" onchange="appoint_change(this);">
								<option value="SID">SID</option>
								<option value="SERVICE_NAME">SERVICE_NAME</option>
							</select>
						</div>
					</div>
				
					<div class="item oracle">
						<div class="label">实例名：</div>
						<div class="group" style="padding: 0;">
							<input type="text" name="" value="" id="oracle_input">
						</div>
					</div>
				
					<div class="item oracle">
						<div class="label">连接方式：</div>
						<div class="group">
							<select name="" id="oracle_auth_select" class="select2" style="width: 172px">
								<option value="NORMAL" text="NORMAL">NORMAL</option>
								<option value="SYSDBA" text="SYSDBA">SYSDBA</option>
								<option value="SYSOPER" text="SYSOPER">SYSOPER</option>
							</select>
						</div>
					</div>
					
					<div class="item oracle_ctl">
						<div class="label">路径：</div>
						<div class="group" style="padding: 0;">
							<input type="text" name="" value="" id="ctl_input">
						</div>
					</div>
				
					<div class="item radmin">
						<div class="label">认证方式：</div>
						<div class="group">
							<select name="" id="radmin_auth_select" class="select2" style="width: 172px">
								<option value="RADMIN">RADMIN</option>
								<option value="Windows">Windows</option>
							</select>
						</div>
					</div>
				
					<div class="item mssql">
						<div class="label">实例名：</div>
						<div class="group">
							 <input type="text" name="" value="">
						</div>
					</div>

					<div class="item mssql">
						<div class="label">认证方式：</div>
						<div class="group">
							<select name="" id="mssql_auth" class="select2" style="width: 172px">
								<option value="SQL服务器验证">SQL服务器验证</option>
								<option value="Windows验证">Windows验证</option>
								<option value="Windows单一登录">Windows单一登录</option>
							</select>
						</div>
					</div>
					
					<div class="item mysql">
						<div class="label">数据库名：</div>
						<div class="group">
							<input type="text" name="" value="">
						</div>
					</div>
					<!--
					<div class="item mysql">
						<div class="label">版本号：</div>
						<div class="group">
							<select name="" id="mysql_version" class="select2" style="width:120px;">
								<option value="0"><7.5</option>
								<option value="1">≥7.5</option>
							</select>
						</div>
					</div>
					-->
					<div class="item http https">
						<div class="label">URL：</div>
						<div class="group">
							 <input type="text" name="" value="" id="http_url">
						</div>
					</div>
					<div class="item http https">
						<div class="label">账号元素：</div>
						<div class="group">
							<input type="text" name="" value="" id="http_account">
						</div>
					</div>
					<div class="item http https">
						<div class="label">密码元素：</div>
						<div class="group">
							<input type="text" name="" value="" id="http_pwd">
						</div>
					</div>
					<div class="item http https">
						<div class="label">提交元素：</div>
						<div class="group">
							<input type="text" name="" value="" id="http_submit">
						</div>
					</div>

					<div class="item sysbase">
						<div class="label">实例名：</div>
						<div class="group">
							<input type="text" name="" value="" id="sysbase_input">
						</div>
					</div>
					<div class="item sysbase_ctl">
						<div class="label">路径：</div>
						<div class="group" style="padding: 0;">
							<input type="text" name="" value="" id="ctl_sysbase_input">
						</div>
					</div>
					<div class="item db2" >
						<div class="label">数据库名：</div>
						<div class="group">
							<input type="text" name="" value="" id="db2_input">
						</div>
					</div>
				
					<div class="item sel_access">
						<div class="label">连接方式：</div>
						<div class="group">
							<select name="" id="access_select" class="select2" style="width:172px;">
							</select>
						</div>
					</div>
					<div class="item passageway" style="display: none;">
						<div class="label">方式：</div>
						<div class="group ctr" style="width:235px;">
							<select name="" id="passageway_select" class="select2" style="width:172px;">
								<option value="1">端口访问</option>
								<option value="2">访问通道</option>
							</select>
						</div>
					</div>
					<!--
					<div class="item">
						<div class="label">路径：</div>
						<div class="group">
							<input type="text" name="" value="" id="path_input">
						</div>
					</div>
					-->
					<div class="item remark">
						<div class="label">访问备注：</div>
						<div class="group ctr" style="width:197px;">
							<input type="text" name="" value="" id="remark_input" style="width:122px;">
							<a class="btn" href="javascript:;" style="margin-right: 26px;float: right;line-height: 26px;padding: 0 4px;" onclick="save_remark(1);">提交</a>
						</div>
					</div>
					<div class="item">
							<p class="err">工单未授权链接</p>
					</div>
					<div class="dialog-cont" id="EnableKey_suspend" style="display:none;">
						<div class="container">
							<div class="c-cont" style="min-height:434px;max-height:280px">
								<div class="c-form" style="padding-bottom:10px;padding:0;">
									<div class="form-item " style="float: left;width: 45%;padding: 20px 0px 0 85px;">
										
										<span class="form-tag" style="width: 150px;"><em class="imp">*</em>名称：</span>
										<div class="form-c" style="padding-left: 150px;padding-top: 3px;">
											<input type="text" class="form-text" id="d_n" name="d_n" onblur="regCheck(this,nameReg);" maxlength="128" 
											style="margin-left:8px;"><i class="v-check"></i>
											<p class="form-tip" style="padding-left: 10px;">特殊字符仅支持下划线、横杠、小数点</p>
										</div>
										
										<div class="form-item">
											<span class="form-tag" style="width: 150px;">类型：</span>
											<div class="form-c" style="padding-left: 160px;padding-top: 3px;">
												<select class="select2" name="Protocol" id="Protocol" style="width:150px;">
													<option value="1" selected>私钥</option>
													<option value="0" >公钥</option>
												</select>
											</div>
										</div>
														
										<!--<div class="form-item">
											<span class="form-tag" style="width: 150px;">状态：</span>
											<div class="form-c" style="padding-left: 160px;padding-top: 3px;">
													<input type="checkbox" class="form-checkbox" id="Enable"/>
													<span style="vertical-align:middle;font-size:16px; color: #000;">启用</span>
											</div>
										</div>-->
										<div class="form-item" style="width: 380px;" id="Password1">
											<span class="form-tag" style="width: 149px;"><!--<em class="imp">*</em>-->设置密码：</span>
											<div class="form-c">
												<input type="password" class="form-text" id="Password" name="Password" onblur="" maxlength="128" style="width: 238px;margin-left: -40px;">
												<!--<p class="form-tip">长度为16位</p>-->
											</div>
										</div>
										<div class="form-item" style="width: 280px;" id="Password_two1">
											<span class="form-tag" style="width: 147px;"><!--<em class="imp">*</em>-->确认密码：</span>
											<div class="form-c" style="padding-left: 100px;">
													<input type="password" class="form-text" id="Password_two" name="Password_two" onblur="" maxlength="128" style="width: 239px;margin-left: 12px;">
												<!--<p class="form-tip">长度为16位</p>-->
											</div>
										</div>
														
										<div class="form-item">
											<span class="form-tag" style="width: 150px;"><em class="imp">*</em>内容：</span>
											<div class="form-c" style="padding-left: 160px;padding-top: 3px;">
												<textarea type="textarea" class="form-text" id="content" style="width: 350px; height: 111px; resize: none"></textarea>
											</div>
										</div>
														
									</div>
								</div>
								<div class="c-form">
									<div class="btns">
										<a href="javascript:;" class="btn btn-normal" onclick="connection_add();">保&nbsp;&nbsp;存</a>
										<!-- <a href="javascript:;" class="btn btn-normal" onclick="connection_list(0);">取&nbsp;&nbsp;消</a> -->
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="pl-b s-hide">
					<a href="javascript:;" class="pl-btn" id="connect">连&nbsp;&nbsp;接</a>
				</div>
			
				<div class="pullbtn" onclick="_hideProt(this)"></div>
				<div class="dialog-cont" id="remarkDialog" style="display:none;">
					<div class="container">
						<div class="c-cont" style="max-height:300px;">
							<div class="c-form" style="">
								<div class="clearfix"></div>
								<div class="form">
									<div class="form-item" style="">
										<span class="form-tag" style=""><em class="imp">*</em>访问备注：</span>
										<div class="form-c" style="">
											<textarea id="operation_content" class="form-textarea" name="" cols="30" rows="10"></textarea>
										</div>
									</div>
								</div>
							</div>
							<div class="c-form" style="">
								<div class="btns" style="">
									<a href="javascript:;" class="btn btn-normal btn-submit" >提&nbsp;&nbsp;交</a>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div id="client_module" style="overflow:hidden;height: 200px;display:none;">
					<div class="c-form" style="padding-bottom:10px;padding-left:50px;">
						<div class="c-form" style="padding:0;">
							<span class="form-tag" style="width:222px;">路径：</span>
							<div style="width: 450px;margin-left: 200px;">
								<label style="float: left;margin-right:8px;">
									<select class="form-select select_clt" name=""  style="width: 60px;">
										<option value="0" selected >全局</option>
										<option value="1"  >指定</option>
									</select>
								</label>
								<input class="form-text" id="client_input" type="text" style="float: left;"/>
								<a href="javascript:;" class="btn btn-normal btn-global" onclick="get_win_path(this);">浏&nbsp;&nbsp;览</a>
							</div>
						</div>
						<div class="btns s-hide" style="/*padding: 20px 0 0px;*/position:absolute;">
							<a href="javascript:;" class="btn btn-normal btn-submit" >保&nbsp;&nbsp;存</a>
							<a href="javascript:;" class="btn btn-normal btn-cancel" >取&nbsp;&nbsp;消</a>
						</div>
					</div>
				</div>
			</div>
		</div>

	<script>
		var isMac = function() { 
			return /macintosh|mac os x/i.test(navigator.userAgent); 
		}();
		// isMac=true;
		if (isMac){
			$('.disk_map').html('<div class="label">硬盘映射：</div>'+
			'<div class="group">'+
				'<label style="width:70px;"><input type="radio" name="macdisks" id="">所有磁盘</label>'+
				'<label style="width:70px;"><input type="radio" name="macdisks" id="">主文件夹</label>'+
				'<label style="width:70px;"><input type="radio" name="macdisks" id="">文档文件夹</label>'+
				// '<label style="width: 80px;float: none;">/path:<input type="text" name="" id="" style="margin-left: 6px;width:120px"></label>'+
			'</div>');
		}else{
			$('.disk_map').html('<div class="label">硬盘映射：</div>'+
			'<div class="group">'+
				'<label style="width:35px;"><input type="checkbox" name="" id="">C:</label>'+
				'<label style="width:35px;"><input type="checkbox" name="" id="">D:</label>'+
				'<label style="width:35px;"><input type="checkbox" name="" id="">E:</label>'+
				'<label style="width:35px;"><input type="checkbox" name="" id="">F:</label>'+
				'<label style="width:35px;"><input type="checkbox" name="" id="">G:</label>'+
				'<label style="width:35px;"><input type="checkbox" name="" id="">H:</label>'+
			'</div>');
		}
		$('.pl-c input').iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		});
		$('.pl-c .select2').select2({minimumResultsForSearch: -1});
		$('#find_select').select2({minimumResultsForSearch: -1});
		$('.select_clt').select2({minimumResultsForSearch: -1});
	</script>

	<!--select2-->
		
<style>
	.select2-results__option[aria-selected]{
		font-size:12px;
	}
	.pl-c .item{
		display:none;
	}
	.RightTip_class::before{
		border: 0px solid;
	}
	.pl-c .item input[type=password] {
		width: 160px;
		height: 26px;
		border: 1px solid #b2b2b2;
		border-radius: 5px;
		padding: 0 4px;
		/*color: #888;*/
		font-size: 12px;
	}
	.pl-c .item input[type=password]:focus {
		border-color: #000;
	}
	.select2 {width:170px;}
	.btns{
		position:absolute;
	}
	.ui-dialog-body{
		padding:0;
	}
	.filter .search .filter-text:first-child{
		border-left: 0 !important;
		border-radius:0;
	}
	#screensize{
		width:88px;
	}
	#pro_select_div div{
		width: 88px;
		float: left;
		margin-left: -10px;
		background-color: #fff;
	}
	.xSelect-show-text{
		font-size:12px;
	}
	.xSelect-view ul li {
		padding-right:0px;
	}
	.xSelect-view ul li span {
		padding-left:4px;
		font-size: 12px;
	}
	#waitTip{
		position: unset;
		margin:10px 0px 0px 11.8em;
	}
	.filter .selector span.ww {
		width:160px;
	}
	.filter .selector.selector-multiple::after {
		margin:10px 0px 0px 12.8em;
	}
</style>
<style>
	a.btn-global{
		float: left;
		padding: 0px 8px;
		line-height: 26px;
		color: #8D808A;
		border: 1px solid #8D808A;
		margin-left:8px;
		border-radius: 5px;
		transition: all 0.4s;
	}
	a.btn-global:hover{
		background-color: #8D808A;
		border-color: #8D808A;
		color: #fff;
	}
	.box-table2 table tbody tr:hover>td:last-child {
		border-color: #3fb7d2;
		background-color: #3fb7d2;
	}
</style>
<style>
	.bluecolor {background-color: #d9dff3;}
</style>　　　　　　　
<script type="text/javascript">
	var json_icon = {
		"Unix":"1",
		"Switchboard":"2",
		"Ruijie":"3",
		"Linux":"4",
		"Huawei":"5",
		"Host":"6",
		"Firewall":"7",
		"H3C":"8",
		"Cluster":"9",
		"Cisco":"10",
		"AS400":"11",
		"Aix":"12",
		"Network":"13",
		"Windows":"14",
		"Server":"15"
	}
	var se = "{{se}}";
	var path_array;
	var IsTunnel;
	var MapPort;
	var global_data;
	var remote_data;
	var remark_need = 0;
	var document_domain = "";
	var window_location_host = "";
	function _initSize(){
		var h = $(window).height();
		$('.c-cont2').height(h-37);
	}
	$(window).resize(function () {
		_initSize();
	});
	// <div class="label">硬盘映射：</div>
	// <div class="group">
	// 	<label style="width:35px;"><input type="checkbox" name="" id="">C:</label>
	// 	<label style="width:35px;"><input type="checkbox" name="" id="">D:</label>
	// 	<label style="width:35px;"><input type="checkbox" name="" id="">E:</label>
	// 	<label style="width:35px;"><input type="checkbox" name="" id="">F:</label>
	// 	<label style="width:35px;"><input type="checkbox" name="" id="">G:</label>
	// 	<label style="width:35px;"><input type="checkbox" name="" id="">H:</label>
	// </div>
	// <div class="label">硬盘映射：</div>
	// <div class="group">
	// 	<label style="width:70px;"><input type="checkbox" name="" id="">所有磁盘</label>
	// 	<label style="width:70px;"><input type="checkbox" name="" id="">主文件夹</label>
	// 	<label style="width:70px;"><input type="checkbox" name="" id="">文档文件夹</label>
	// 	<label style="width: 80px;float: none;">/path:<input type="text" name="" id="" style="margin-left: 6px;width:120px"></label>
	// </div>
	$(function(){
		//mac_get();
		_initSize();
		if( IEVersion() < 10 && IEVersion() >0){
			$('.web_con').remove();
		}
		$.ajax({
			url:'/bhost/get_globalstrategy',
			type:'post',
			async:false,
			data:{a0:se},
			success:function(result){
				global_data = JSON.parse(result);
				IsTunnel = global_data.IsTunnel + "";
				MapPort = global_data.MapPort;
			}
		})
		$.ajax({
			url: "/bhost/RealIPGet",
			type: "POST",
			async: false,
			data: { a0: se, a1: document.domain},
			success: function (result) {
				var result = JSON.parse(result);
				if(result.result == true){
					if(result.dev_type == "gluster"){
						document_domain = result.info;
						window_location_host = result.info;
					}else{
						document_domain = document.domain;
						window_location_host = window.location.host;
					}
				}else{
					document_domain = document.domain;
					window_location_host = window.location.host;
				}
			}
		})
		$.ajax({
			url: "/bhost/PGet_LocalClient",
			type:"POST",
			async:false,
			data:{a0:se},
			success:function(result){
				var result=JSON.parse(result);
				if(result.Result){
					path_array = result.info.data;
				}else{
					_alert(2,'最近访问',result.ErrMsg);
					return false;
				}
			}
		});
		
		$.ajax({
			url: "/bhost/PGet_UserGlobalConfig",
			type:"POST",
			async:false,
			data:{a0:se},
			success:function(result){
				var result=JSON.parse(result);
				if(result.Result){
					remote_data = result.info;
				}else{
					_alert(2,'最近访问',result.ErrMsg);
					return false;
				}
			}
		});
	
		var clicktag = 0;
		$("#connect").on("click", function () {
			$("#connect").blur();
			if (clicktag == 0) {
				clicktag = 1;
				setTimeout(function () {clicktag = 0}, 1000);
			 }else return false;
			$.ajax({
				url:'/bhost/get_globalstrategy',
				type:'post',
				async:false,
				data:{a0:se},
				success:function(result){
					global_data = JSON.parse(result);
					IsTunnel = global_data.IsTunnel + "";
					MapPort = global_data.MapPort;
				}
			})
			var ServiceName = '';
			var ConnType = '';
			if (quick_link == 1){
				var hostip = $(".ip_div").find('input').val();
				var pro_name = $("#pro_select_div").find('span').text();
				var port = $("#port_input").val();
				var user = $(".user_div").find('input').val();
				var pwd = $(".pwd_div").find('input').val();
			}else{
				var user = "";
				if($("#user_select").val() == "任意账号"){
					user = $(".user_div").find('input').val();
					user1 = "任意账号";
				}else{
					user = $("#user_select").val();
					user1 = user;
				}
				if(user == ""){
					_alert(1,"最近访问","请输入账号");
					return false;
				}
				var index = $("#user_select").children('option[value="'+user1+'"]').index();
				var hostip = prolink_ip;
				var pro_name = prolink_pro;
				if (index < 0){
					$("#user_select").children().each(function(i,item){
						var option_v = $(item).val();
						if (option_v == user){
							index = i;
						}
					})
				}
				//console.log(service_re.data);
				//console.log(index);
				var port = service_re.data[index].ServerPort;
				var pwd = $(".pwd_div").find('input').val();//解密
				/*
				if (service_re.data[0].ServiceName == "" || service_re.data[0].ServiceName == null){
					ServiceName = "";
				}else{
					ServiceName = service_re.data[0].ServiceName;
				}
				*/
			}
			$.ajax({
				url:'/bhost/DevChk',
				type:'post',
				async:false,
				data:{a0:se,a1:hostip,a2:pro_name},
				success:function(result){
					result = JSON.parse(result);
					ret1 = result.info.split(',')[0];
					bhuser1 = result.info.split(',')[1];
					type_Chk = result.type;
				}
			})
			var con1 = 0;
			if(ret1 != 0){
				con1 = 1;
				if(type_Chk == "1"){//服务器登陆限制
					_alert(1,"最近访问","用户"+bhuser1+"已登录该主机");
					return false;
				}else{//客户端登陆限制
					parent.layer.open({
						type: 1,
						title: "最近访问",
						content: '<div class="layer-alert"><i class="alert warning"></i>当前用户已在'+bhuser1+'上登录</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '310px'],
						move: false,
						resize: false,
						btn1: function (i) {
							parent.logout();
						}	
					})
					return false;
				}
			}
			if(con1 == 1){
				return false;
			}
			switch (pro_name){
				case "SSH":
					ServiceName = $("#access_select").val();
					break;
				case "MYSQL":
					ServiceName = $('.mysql:eq(0)').find('input').val();
					break;
				case "MSSQL":
					ServiceName = $('.mssql:eq(0)').find('input').val();
					ConnType = $("#mssql_auth").val();
					break;
				case "ORACLE":
					ServiceName = $("#oracle_input").val();
					ConnType = $("#oracle_auth_select").val();
					break;
				case "HTTP(S)":
				case "HTTPS":
					ServiceName = $("#http_url").val();
					break;
				case "DB2":
					ServiceName = $("#db2_input").val();
					break;
				case "SYBASE":
					ServiceName = $("#sysbase_input").val();
					break;
				case "RADMIN":
					ConnType = $("#radmin_auth_select").val();
					break;
				case "RDP":
					ConnType = $("#access_select").val();
					break;
			}

			//var ipReg = /^((?:(?:2[0-4][0-9]\.)|(?:25[0-5]\.)|(?:1[0-9][0-9]\.)|(?:[1-9][0-9]\.)|(?:[0-9]\.)){3}(?:(?:2[0-5][0-5])|(?:25[0-5])|(?:1[0-9][0-9])|(?:[1-9][0-9])|(?:[0-9])))$/;
			var ipReg = /(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;
			if (hostip == ""){
				_alert(1,"最近访问","IP不能为空",$(".ip_div").find('input'));
				return false;
			}else if (!ipReg.test(hostip)){
				_alert(1,"最近访问","IP地址格式不正确",$(".ip_div").find('input'));
				return false;
			}
			if(($(".pwd_div").find('input').attr("disabled")== "disabled" && $(".pwd_div").find('input').val().length > 128) || ($(".pwd_div").find('input').attr("disabled")!= "disabled" && $(".pwd_div").find('input').val().length > 64)){
				_alert(1,"最近访问","密码不能超过系统限定64位");
				return false;
			}
			if ($("#EnableKey").is(":visible")){
				SshKeyId = $("#EnableKey").data('value');
				if (SshKeyId == null || SshKeyId == undefined || SshKeyId == 0){
					_alert(2,"最近访问","请选择密钥");
					return false;
				}
			}
			
			remark_need = 0;
			var remark_need_flag = 0;
			if (user == ""){
				user = "-";
			}
			$.ajax({
				url:"/bhost/Get_AuthObjectByInput",
				type:'post',
				async:false,
				data:{a0:se,z1:hostip,z2:pro_name,z3:port,z4:user.replace(/\\/g,"\\\\"),z5:ServiceName,z6:ConnType},
				success:function(result){
					if(result != ""){
						result1 = JSON.parse(result);
					}
					if (result == "" || result1.Result == false){
						remark_need_flag = 1;
						$.ajax({
							url:'/bhost/delHostAccount',
							type:"post",
							async:true,
							data:{a0:se,a1:hostip,a2:pro_name,a3:user.replace(/\\/g,"\\\\")},
							success:function(result){
								var result = JSON.parse(result);
								if(result.Result != true){
									_alert(1,"最近访问",result.ErrMsg);
								}
							}
						});
						parent.layer.open({
							type: 1,
							title: "最近访问",
							content: '<div class="layer-alert"><i class="alert fail"></i>无权访问，如有问题请联系管理员</div>',
							btn: ['确&nbsp;&nbsp;定'],
							btnAlign: 'c',
							closeBtn: false,
							skin: 'layer-custom',
							area: ['380px', '310px'],
							move: false,
							resize: false,
							btn1: function (i) {
								parent.layer.close(i);
								changepage(3);
							}
						})
						return false;
					}else{
						var obj_json = JSON.parse(result);
						if (obj_json.action == 2){
							remark_need_flag = 1;
							$.ajax({
								url:'/bhost/delHostAccount',
								type:"post",
								async:true,
								data:{a0:se,a1:hostip,a2:pro_name,a3:user.replace(/\\/g,"\\\\")},
								success:function(result){
									var result = JSON.parse(result);
									if(result.Result != true){
										_alert(1,"最近访问",result.ErrMsg);
									}
								}
							});
							parent.layer.open({
								type: 1,
								title: "最近访问",
								content: '<div class="layer-alert"><i class="alert fail"></i>无权访问，如有问题请联系管理员</div>',
								btn: ['确&nbsp;&nbsp;定'],
								btnAlign: 'c',
								closeBtn: false,
								skin: 'layer-custom',
								area: ['380px', '310px'],
								move: false,
								resize: false,
								btn1: function (i) {
									parent.layer.close(i);
									changepage(3);
								}
							})
							return false;
						}
						if (obj_json.AuthLevel != 1 && obj_json.EnableWorkOrderApprove){
							remark_need_flag = 1;
							_alert(1,"最近访问","工单未授权连接");
							return false;
						}
						if ($("#ApplicationChannel").is(":visible")){
							if (obj_json.IsAcc == 1 && !$("#ApplicationChannel").prop('checked')){
								remark_need_flag = 1;
								_alert(1,"最近访问","请选择应用通道");
								return false;
							}
							if (obj_json.IsAcc == 0 && $("#ApplicationChannel").prop('checked')){
								remark_need_flag = 1;
								_alert(1,"最近访问","请取消应用通道");
								return false;
							}
						}
						if (obj_json.EnableAccessInfo){
							remark_need = 1;
						}
					}
				}
			});
			
			if (remark_need_flag == 1){
				return false;
			}
			if (global_data.IfGiveAccessInfo || remark_need == 1){
				if (quick_link == 1){
					var hostip = $(".ip_div").find('input').val();
				}else{
					var hostip = prolink_ip;
				}
				get_plan(hostip,0);
				
				var $dialogCont = $("#remarkDialog").show();
				var title = '访问备注';
				var d = dialog({
					title:title,
					content:$dialogCont,
					id:"remarkDialog",
					width:"780px"
				});
				function addEventListener(ele,event,fn){
					if(ele.addEventListener){
						ele.addEventListener(event,fn,false);
					}else{
						ele.attachEvent('on'+event,fn.bind(ele));
					}
				}
				addEventListener(d,'close',function () {
					$dialogCont.appendTo("body").hide();
				})
				//d.addEventListener('close', function () {
					//$dialogCont.appendTo("body").hide();
				//});
				d.showModal();
				$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
					
				});
				$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
					connect_pro();
					d.close().remove();
				});
			}else{
				connect_pro();
			}
		});

		$('body').addClass('max'+vmax);
		$('#page_total').text(vmax);
		$("#RightTip").css({"cursor":"default"});
		$("#curpage").bind('keydown', function(e){
			DigitInput(e);
		});
		_initList();
		_initEvent();
		getAllData();
		$('.form-checkbox,.form-radio').iCheck({
			checkboxClass:'icheckbox_minimal-blue',
			radioClass:'iradio_minimal-blue',
			increaseArea:'0'
		});
		$('#check_page').on('ifClicked',function(e){
			if(!$('#check_page').prop('checked')){
				$("#fList").find('input[type=checkbox]').iCheck('check');
			}else{
				$("#fList").find('input[type=checkbox]').iCheck('uncheck');
			}
		});
		$("#fList").on("ifChecked",function(e){
			check_num++;
			if($("table tbody tr").children("td.in").children("div").children("input:checked").length==$("#fList tr").length){
				$('#check_page').iCheck('check');
			}
		}).on("ifUnchecked",function(e){
			check_num--;
			$('#check_page').iCheck('uncheck');
		});

		$("#scroll").scroll(function(){
			$(".layui-layer").removeClass("block").addClass("none")
		});

		$("#EnableRDPDiskMap").on('ifChanged',function(){
			if ($(this).prop('checked') && $("#EnableRDPDiskMap").is(":visible")){
				//if ($('.web_con').find('input').prop('checked')){
				//	$(".disk_map").hide();
				//}else{
					$(".disk_map").show();
				//}
			}else{
				$(".disk_map").hide();
			}
		});
		
		get_pro_v(0);//获取协议
		
		$(".local_client").find('input').on('ifChanged',function(){
			repeat_select();
			var pro_name;
			if ($("#pro_select_div").is(':visible')){
				pro_name = $("#pro_select_div").find('span').text();
			}else{
				pro_name = prolink_pro;
			}
			if ($(this).prop('checked')){
				if($('#EnableCFG').prop('checked') == false || !$('#EnableCFG').is(":visible")){
					$(".sel_linkmode").show();
					$(".mfs_div").hide();
					/*
					if ($("#ApplicationChannel").is(':visible') && $("#ApplicationChannel").prop('checked')){
						$(".mfs_div").show();
					}else{
						$(".mfs_div").hide();
					}
					*/
					$(".screen_div").hide();
					$(".disk_map").hide();
					$("#sel_client").empty();
					var option_str = "";
					switch(pro_name){
						case "SSH":
						case "RLOGIN":
							var Putty_flag = 0;
							var SecureCRT_flag = 0;
							var XShell_flag = 0;
							$.each(path_array,function(i,item){
								//if (item.ProtocolName == pro_name){
									if (item.ClientName == "Putty"){
										Putty_flag = 1;
									}else if (item.ClientName == "SecureCRT"){
										SecureCRT_flag = 1;
									}else if (item.ClientName == "XShell"){
										XShell_flag = 1;
									}
								//}
							});
							
							if (Putty_flag == 1){
								option_str = option_str + '<option value="Putty">Putty</option>';
							}else{
								option_str = option_str + '<option value="Putty">Putty(未设置)</option>';
							}
							
							if (SecureCRT_flag == 1){
								option_str = option_str + '<option value="SecureCRT">SecureCRT</option>';
							}else{
								option_str = option_str + '<option value="SecureCRT">SecureCRT(未设置)</option>';
							}
							
							if (XShell_flag == 1){
								option_str = option_str + '<option value="XShell">XShell</option>';
							}else{
								option_str = option_str + '<option value="XShell">XShell(未设置)</option>';
							}
							//var option_str = '<option value="Putty">Putty</option><option value="SecureCRT">SecureCRT</option><option value="XShell">XShell</option>';
							$("#sel_client").append(option_str);
							break;
						case "ORACLE":
							var PLSql_flag = 0;
							var PowerBuilder_flag = 0;
							var SqlPlus_flag = 0;
							var SqlPlusW_flag = 0;
							var Toad_flag = 0;
							var sqlldr_flag = 0;
							$.each(path_array,function(i,item){
								//if (item.ProtocolName == pro_name){
									if (item.ClientName == "PLSql"){
										PLSql_flag = 1;
									}else if (item.ClientName == "PowerBuilder"){
										PowerBuilder_flag = 1;
									}else if (item.ClientName == "SqlPlus"){
										SqlPlus_flag = 1;
									}else if (item.ClientName == "SqlPlusW"){
										SqlPlusW_flag = 1;
									}else if (item.ClientName == "Toad"){
										Toad_flag = 1;
									}else if (item.ClientName == "sqlldr"){
										sqlldr_flag = 1;
									}
								//}
							});
							if (PLSql_flag == 1){
								option_str = option_str + '<option value="PLSql">PLSql</option>';
							}else{
								option_str = option_str + '<option value="PLSql">PLSql(未设置)</option>';
							}
							if (PowerBuilder_flag == 1){
								option_str = option_str + '<option value="PowerBuilder">PowerBuilder</option>';
							}else{
								option_str = option_str + '<option value="PowerBuilder">PowerBuilder(未设置)</option>';
							}
							if (SqlPlus_flag == 1){
								option_str = option_str + '<option value="SqlPlus">SqlPlus</option>';
							}else{
								option_str = option_str + '<option value="SqlPlus">SqlPlus(未设置)</option>';
							}
							if (SqlPlusW_flag == 1){
								option_str = option_str + '<option value="SqlPlusW">SqlPlusW</option>';
							}else{
								option_str = option_str + '<option value="SqlPlusW">SqlPlusW(未设置)</option>';
							}
							if (Toad_flag == 1){
								option_str = option_str + '<option value="Toad">Toad</option>';
							}else{
								option_str = option_str + '<option value="Toad">Toad(未设置)</option>';
							}
							if (sqlldr_flag == 1){
								option_str = option_str + '<option value="sqlldr">sqlldr</option>';
							}else{
								option_str = option_str + '<option value="sqlldr">sqlldr(未设置)</option>';
							}
							
							//var option_str = '<option value="PLSql">PLSql</option><option value="PowerBuilder">PowerBuilder</option><option value="SqlPlus">SqlPlus</option><option value="SqlPlusW">SqlPlusW</option><option value="Toad">Toad</option><option value="sqlldr">sqlldr</option>';
							$("#sel_client").append(option_str);
							break;
						case "MYSQL":
							var MySql_flag = 0;
							$.each(path_array,function(i,item){
								//if (item.ProtocolName == pro_name){
									if (item.ClientName == "MySql"){
										MySql_flag = 1;
									}
								//}
							});
							if (MySql_flag == 1){
								option_str = '<option value="MySql">MySql</option>';
							}else{
								option_str = '<option value="MySql">MySql(未设置)</option>';
							}
							//var option_str = '<option value="MySql">MySql</option>';
							$("#sel_client").append(option_str);
							break;
						case "TELNET":
							var Netterm_flag = 0;
							var Putty_flag = 0;
							var SecureCRT_flag = 0;
							var XShell_flag = 0;
							$.each(path_array,function(i,item){
								//if (item.ProtocolName == pro_name){
									if (item.ClientName == "Netterm"){
										Netterm_flag = 1;
									}else if (item.ClientName == "Putty"){
										Putty_flag = 1;
									}else if (item.ClientName == "SecureCRT"){
										SecureCRT_flag = 1;
									}else if (item.ClientName == "XShell"){
										XShell_flag = 1;
									}
								//}
							});
							if (Netterm_flag == 1){
								option_str = option_str + '<option value="Netterm">Netterm</option>';
							}else{
								option_str = option_str + '<option value="Netterm">Netterm(未设置)</option>';
							}
							if (Putty_flag == 1){
								option_str = option_str + '<option value="Putty">Putty</option>';
							}else{
								option_str = option_str + '<option value="Putty">Putty(未设置)</option>';
							}
							if (SecureCRT_flag == 1){
								option_str = option_str + '<option value="SecureCRT">SecureCRT</option>';
							}else{
								option_str = option_str + '<option value="SecureCRT">SecureCRT(未设置)</option>';
							}
							if (XShell_flag == 1){
								option_str = option_str + '<option value="XShell">XShell</option>';
							}else{
								option_str = option_str + '<option value="XShell">XShell(未设置)</option>';
							}
							//var option_str = '<option value="Netterm">Netterm</option><option value="Putty">Putty</option><option value="SecureCRT">SecureCRT</option><option value="XShell">XShell</option>';
							$("#sel_client").append(option_str);
							break;
						case "FTP":
						case "SFTP":
							var FlashfXP_flag = 0;
							var LeapFtp2_flag = 0;
							var LeapFtp3_flag = 0;
							var WinSCP_flag = 0;
							var filezilla_flag = 0;
							$.each(path_array,function(i,item){
								//if (item.ProtocolName == pro_name){
									if (item.ClientName == "FlashfXP"){
										FlashfXP_flag = 1;
									}else if (item.ClientName == "LeapFtp2.0"){
										LeapFtp2_flag = 1;
									}else if (item.ClientName == "LeapFtp3.0"){
										LeapFtp3_flag = 1;
									}else if (item.ClientName == "WinSCP"){
										WinSCP_flag = 1;
									}else if (item.ClientName == "filezilla"){
										filezilla_flag = 1;
									}
								//}
							});
							if (FlashfXP_flag == 1){
								option_str = option_str + '<option value="FlashfXP">FlashfXP</option>';
							}else{
								option_str = option_str + '<option value="FlashfXP">FlashfXP(未设置)</option>';
							}
							if (pro_name == "FTP"){
								if (LeapFtp2_flag == 1){
									option_str = option_str + '<option value="LeapFtp2.0">LeapFtp2.0</option>';
								}else{
									option_str = option_str + '<option value="LeapFtp2.0">LeapFtp2.0(未设置)</option>';
								}
								if (LeapFtp3_flag == 1){
									option_str = option_str + '<option value="LeapFtp3.0">LeapFtp3.0</option>';
								}else{
									option_str = option_str + '<option value="LeapFtp3.0">LeapFtp3.0(未设置)</option>';
								}
							}
							
							if (WinSCP_flag == 1){
								option_str = option_str + '<option value="WinSCP">WinSCP</option>';
							}else{
								option_str = option_str + '<option value="WinSCP">WinSCP(未设置)</option>';
							}
							if (filezilla_flag == 1){
								option_str = option_str + '<option value="filezilla">filezilla</option>';
							}else{
								option_str = option_str + '<option value="filezilla">filezilla(未设置)</option>';
							}
							//var option_str = '<option value="FlashfXP">FlashfXP</option><option value="LeapFtp2.0">LeapFtp2.0</option><option value="LeapFtp3.0">LeapFtp3.0</option><option value="WinSCP">WinSCP</option><option value="filezilla">filezilla</option>';
							$("#sel_client").append(option_str);
							break;
						case "SYBASE":
							var PowerBuilder_flag = 0;
							var SqlAdvantage_flag = 0;
							var isqlw_flag = 0;
							$.each(path_array,function(i,item){
								if (item.ClientName == "SqlAdvantage"){
									SqlAdvantage_flag = 1;
								}
								if (item.ClientName == "isqlw"){
									isqlw_flag = 1;
								}
								/*
								if (item.ClientName == "PowerBuilder"){
									PowerBuilder_flag = 1;
								}else if (item.ClientName == "SqlAdvantage"){
									SqlAdvantage_flag = 1;
								}
								*/
							});
							/*
							if (PowerBuilder_flag == 1){
								option_str = '<option value="PowerBuilder">PowerBuilder</option>';
							}else{
								option_str = '<option value="PowerBuilder">PowerBuilder(未设置)</option>';
							}
							*/
							if (SqlAdvantage_flag == 1){
								option_str = option_str + '<option value="SqlAdvantage">SqlAdvantage</option>';
							}else{
								option_str = option_str + '<option value="SqlAdvantage">SqlAdvantage(未设置)</option>';
							}
							if (isqlw_flag == 1){
								option_str = option_str + '<option value="isqlw">isqlw</option>';
							}else{
								option_str = option_str + '<option value="isqlw">isqlw(未设置)</option>';
							}
							//var option_str = '<option value="PowerBuilder">PowerBuilder</option><option value="">SqlAdvantage</option>';
							$("#sel_client").append(option_str);
							break;
						case "DB2":
							var DB2Cmd_flag = 0;
							$.each(path_array,function(i,item){
								//if (item.ProtocolName == pro_name){
									if (item.ClientName == "DB2Cmd"){
										DB2Cmd_flag = 1;
									}
								//}
							});
							if (DB2Cmd_flag == 1){
								option_str = '<option value="DB2Cmd">DB2Cmd</option>';
							}else{
								option_str = '<option value="DB2Cmd">DB2Cmd(未设置)</option>';
							}
							//var option_str = '<option value="DB2Cmd">DB2Cmd</option>';
							$("#sel_client").append(option_str);
							break;
						case "RDP":
						case "VNC":
						case "X11":
							$("#sel_client").append('<option value="MSTSC">MSTSC</option>');
							$(".screen_div").show();
							$("#EnableRDPClipboard").parents('label:first').show();
							if (pro_name == "X11" || pro_name == "VNC"){
								$("#EnableRDPDiskMap").parents('label:first').hide();
								$(".disk_map").hide();
							}else{
								$("#EnableRDPDiskMap").parents('label:first').show();
								if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')){
									$(".disk_map").show();
								}else{
									$(".disk_map").hide();
								}
							}
							break;
						default:
							;
					}
					$("#sel_client").val($("#sel_client").children("option").eq(0).val()).trigger('change');
					if (!global_data.IsTunnel){
						if (pro_name == "SYBASE"){
							$("#passageway_select").empty().append('<option value="2">访问通道</option>');
						}else{
							$("#passageway_select").empty().append('<option value="1">端口访问</option>');
						}
						//$(".passageway").show();
					}
				}
			}else{
				$(".sel_linkmode").hide();
				if (pro_name == "RDP"){
					//$('.disk_map').hide();
				}else if ((pro_name == "VNC" || pro_name == "X11") && !$('#EnableCFG').prop('checked')){
					$('#EnableRDPDiskMap').parents('label:first').hide();
					$('.disk_map').hide();
				}
			}
		});

		$(".mfs").find('input').on('ifChanged',function(){
			//$('#ApplicationChannel,input[name=linkmode]:eq(1)').on('ifChanged',function(){
			if($(".mfs").is(":visible") == false){
				return true;
			}
			repeat_select();
			var pro_name;
			if ($("#pro_select_div").is(':visible')){
				pro_name = $("#pro_select_div").find('span').text();
			}else{
				pro_name = $(".prolink.active").text();
			}
			if ($(this).prop('checked') && $(this).is(":visible") == true){
				$('.web_con').show();
				var key_array = [];
				key_array.push("协议名称-" + pro_name);
				
				$.ajax({
					url:'/bhost/get_acc_client_list',
					type:"post",
					async:false,
					data:{a0:se,z4:"null",z5:"null",z6:JSON.stringify(key_array)},
					success:function(result){
						var result = JSON.parse(result);
						var option_str = "";
						$.each(result.data,function(i,item){
							option_str = option_str + '<option value="'+item.ClientName+'">'+item.ClientName+'</option>';
						});
						if (option_str == ""){
							option_str = '<option value="0">无</option>';
						}
						$("#sel_mfs").empty().append(option_str);
						$("#sel_mfs").select2();
					}
				});
				$(".mfs_div").show();
				$(".screen_div").show();
				$(".sel_linkmode").hide();
				if (pro_name == "X11"){
					$("#EnableRDPDiskMap").parents('label:first').hide();
				}
				/*
				if ($(this).attr('id') != "ApplicationChannel"){
					$("#sel_linkmode").hide();
				}else{
					if (pro_name == "VNC" || pro_name == "X11"){
						$("#EnableRDPDiskMap").parents('label:first').hide();
					}
				}
				*/
				
				if (pro_name == "VNC"){
					$('#EnableRDPDiskMap').parents('label:first').show();
					if ($("#EnableRDPDiskMap").prop('checked') && $("#EnableRDPDiskMap").is(':visible')){
						$('.disk_map').show();
					}else{
						$('.disk_map').hide();
					}
				}
				if($('#EnableRDPDiskMap').is(':visible') && $('#EnableRDPDiskMap').prop('checked')){
					$('.disk_map').show();
				}else{
					$('.disk_map').hide();
				}
			}else{
				if(pro_name != "SSH" && pro_name != "RDP" && pro_name != "TELNET" && pro_name != "VNC" && pro_name != "X11" && pro_name != "RLOGIN" && pro_name != "TN5250"){
					$('.web_con').hide();
					$(".local_client").find('input').iCheck('uncheck')
					$('.local_client').find('input').iCheck('check');
				}else{
					if(pro_name != "VNC" || $('.web_con').find("input").prop('checked')){
						$(".sel_linkmode").hide();
					}else{
						$(".sel_linkmode").show();
					}
				}
				
				$(".mfs_div").hide();
				/*
				if ($(this).attr('id') != "ApplicationChannel"){
					$("#sel_linkmode").hide();
				}
				*/
				if (pro_name == "VNC"){
					$('#EnableRDPDiskMap').parents('label:first').hide();
					$('.disk_map').hide();
				}
			}
			if (!global_data.IsTunnel){
				if (pro_name == "SYBASE" && $(".local_client").find('input').prop('checked')){
					$("#passageway_select").empty().append('<option value="2">访问通道</option>');
				}else{
					$("#passageway_select").empty().append('<option value="1">端口访问</option>');
				}
				// if ($(".web_con").find('input').prop('checked')){
				// 	$('.passageway').hide();
				// }else{
				// 	$(".passageway").show();
				// }
			}
		});
		
		$("#recent_visit").bind('click',function(){
			location.href = '/bhost/index?tasktype=7&us={{us}}&se={{se}}';
		})
		$(".web_con").find('input').on('ifChanged',function(){
			repeat_select();
			var pro_name;
			if ($("#pro_select_div").is(':visible')){
				pro_name = $("#pro_select_div").find('span').text();
			}else{
				pro_name = prolink_pro;
			}
			
			if (!global_data.IsTunnel){
				if (pro_name == "SYBASE" && $(".local_client").find('input').prop('checked')){
					$("#passageway_select").empty().append('<option value="2">访问通道</option>');
				}else{
					$("#passageway_select").empty().append('<option value="1">端口访问</option>');
				}
				//$(".passageway").show();
			}
			if($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked') == true && $(".web_con").find('input').prop('checked')){//h5访问前置机
				$(".screen_div").show();
			}else{
				$(".screen_div").show();
			}			
			if ($(this).prop('checked')){
				$(".passageway").hide();
				if(pro_name == "SSH" || pro_name == "RLOGIN" || pro_name == "TELNET"){
					$(".screen_div").hide();
				}
			}

		})
		
		$("input[name=linkpwd]").on('ifChanged',function(){
			$('.item.pwd_div').show();
			repeat_select();
			var pwd_value = $(this).attr('value');
			if ($(this).prop('checked')){
				if (pwd_value == '2'){//输入密码
					$('.item.pwd_div').find('.pwd').show();
					$('.item.pwd_div').find('.ssh').hide();
				}else if(pwd_value == '4'){//输入密钥
					$('.item.pwd_div').find('.pwd').hide();
					$('.item.pwd_div').find('.ssh').show();
				}else if(pwd_value == '1'){//托管密码
					$('.item.pwd_div').find('.pwd').show();
					$('.item.pwd_div').find('.ssh').hide();
				}else if(pwd_value == '3'){//托管密钥
					$('.item.pwd_div').find('.pwd').hide();
					$('.item.pwd_div').find('.ssh').show();
				}
			}
		})
		
		$("input[name=authmode]").on('ifChanged',function(){
			repeat_select();
			var mode_value = $(this).attr('value');
			if ($(this).prop('checked')){				
				if (mode_value == '1'){		
					$(".sel_key").hide();
					$("#Key_select").hide();
					$(".xSelect-key").hide();
					$("div[data-id=xSelect-key]").removeClass('on');
					/*$(".auth_mode").find('input[type=password]').show();
					$(".auth_mode").find('input[type=password]').focus();*/
					$(".pwd_div").show();
				}else{
					$('.sel_key').show();
					$("#Key_select").show();
					$(".pwd_div").hide();
				}
			}
		})
		
		$('#Protocol').on('change',function(){
			var Protocol_value=$('#Protocol').val();
			if(Protocol_value=='0'){
				$('#Password1').hide();
				$('#Password_two1').hide();
			}else{
				$('#Password1').show();
				$('#Password_two1').show();
			}
		});	
		bind_KeyName_xSelect();
		
	});
	
	function repeat_select(){
		$("#screensize").select2('destroy');
		$("#sel_client").select2('destroy');
		$("#sel_mfs").select2('destroy');
		$("#screensize").select2({minimumResultsForSearch:-1});
		$("#sel_client").select2({minimumResultsForSearch:-1});
		$("#sel_mfs").select2({minimumResultsForSearch:-1});
		$("#screensize").next('span').css("margin-bottom","5px");
	}
	
	function get_pro_v(type){
		var pro_data = [];
		var first_v = "";
		var first_id = 0;
		$.ajax({
			url:'/bhost/get_AccessProtocol_all_z',
			type:'post',
			async:false,
			data:{a0:se},
			success:function(result){
				pro_result = JSON.parse(result);
				$.each(pro_result.data,function(i,item){
					if (i == 0){
						first_v = item.ProtocolName;
						first_id = item.ProtocolId;
					}
					var select_json = {'value':0,'name':'','type':null};
					select_json.value = item.ProtocolId;
					select_json.name = item.ProtocolName;
					pro_data.push(select_json);
				});
				if (type == 1){
					clear_pro = 1;
				}
			}
		});

		$("#pro_select_div").empty().data('xSelect',"");
		$("#pro_select_div").xSelect({
			width: 88,
			defaultText: first_v,
			items:pro_data,
			module_type:"pro_sel_div",
			setval:function(item,obj){
				change_pro(obj);
			}
		});
		$("#pro_select_div").data('value',first_id);
		if (global_data.IsTunnel){
			$(".passageway").hide();
		}else{
			if (first_v == "SYBASE" && $(".local_client").find('input').prop('checked')){
				$("#passageway_select").empty().append('<option value="2">访问通道</option>');
			}else{
				$("#passageway_select").empty().append('<option value="1">端口访问</option>');
			}
			//$(".passageway").show();
		}
		change_pro();
	}
	
	
	function appoint_change(obj){
		if ($(obj).val() == "SID"){
			$('.oracle:eq(1)').children('.label').text('实例名：');
		}else{
			$('.oracle:eq(1)').children('.label').text('服务名：');
		}
	}
	
	function connect_pro(){
		var HostAccessCfg = {
			"UserCode": "",
			"ServerIP": "",
			"ProtocolName": "",
			"SessionId": "",
			"ServerUser": "",
			"ServerPort": null,
			"ServiceName": "",
			"ConnMode": "",
			"ConnParam": "", 
			"ConnParamId": "",
			"ExePath": null,
			"Pwd": "",
			"ClientName": "",
			"SSHType": null,        
			"RDPScreen": "0",
			"RDPClipboard": null,
			"RDPDiskMap": null,
			"RDPDiskMapList": null,
			"ConnParamName": null,
			"ConnModeName": null,
			"AppRelease": null,
			"AppChannel": null,
			"ConnWay":null
		}
		if (ajax_over == 0){
			return false;
		}
		var encrypt_pwd;
		var decrypt_pwd;
		//var ssh_sftp_flag = 0;
		if ($(".pwd_check_div").is(":visible")){
			var check_v = $(".pwd_check_div").find('input:checked').attr('value');
		}else{
			var check_v = 0;
		}
		
		if (quick_link == 1){
			var pro_name = $("#pro_select_div").find('span').text();
			var port = $("#port_input").val();
			var ip = $(".ip_div").find('input').val();
			var user = $(".user_div").find('input').val();
			var pwd = $(".pwd_div").find('input').val();
			if (!$(".pwd_check_div").is(":visible")&&($("#pro_select_div").find('span').text() =='SSH'||$("#pro_select_div").find('span').text()=='SFTP')){
				if ($(".keyselect2").find('input').prop('checked')){
					SshKeyId = $("#EnableKey").data('value');
					if (SshKeyId != null && SshKeyId != undefined && SshKeyId != 0){
						var t_keyName = $("#EnableKey").children("div").children("span").text();
						var t_type = 2;
						if(t_keyName == "默认"){
							t_type = 1;
						}
						pwd ="pkey\\t" + t_type + "\\t" + t_keyName;
					}else{
						pwd = "";
					}
				}
			}
			
			//判断是否是自动获取的密码
			if(pwd == auto_password){
				encrypt_pwd = pwd;
			}else{
				decrypt_pwd = pwd;
				if (pwd == ""){
					encrypt_pwd = pwd;
				}else{
					$.ajax({
						url:'/bhost/rc4_encrypt',
						type:'post',
						async:false,
						data:{a0:se,z1:pwd},
						success:function(result){
							var result = JSON.parse(result);
							if (result.Result){
								encrypt_pwd = result.info;
							}else{
								_alert(1,"最近访问",result.info);
								return false;
							}
						}
					});
				}
			}
		}else{
			var user = "";
			if($("#user_select").val() == "任意账号"){
				user = $(".user_div").find('input').val();
				user1 = "任意账号";
			}else{
				user = $("#user_select").val();
				user1 = user;
			}
			var index = $("#user_select").children('option[value="'+user1+'"]').index();
			var pro_name = prolink_pro
			if (index < 0){
				$("#user_select").children().each(function(i,item){
					var option_v = $(item).val();
					if (option_v == user){
						index = i;
					}
				})
			}
			var port = service_re.data[index].ServerPort;
			var ip = prolink_ip;
			var encrypt_flag = 0;
			if ($('.item.pwd_div').is(':visible') == true){//密码
				if($(".pwd_div").find('input:last').prop('disabled') == true){//托管
					var pwd = $(".pwd_div").find('input:last').val();//加密	
				}else{
					var pwd = $(".pwd_div").find('input:last').val();//wei加密
					encrypt_flag = 1;
				}
			}else{//密钥
				SshKeyId = $("#EnableKey").data('value');
				if (SshKeyId != null && SshKeyId != undefined && SshKeyId != 0){
					var t_keyName = $("#EnableKey").children("div").children("span").text();
					var t_type = 2;
					if(t_keyName == "默认"){
						t_type = 1;
					}	
					var pwd ="pkey\\t" + t_type + "\\t" + t_keyName;
					encrypt_flag = 1;
				}else{
					var pwd ="";
				}
			}
			if (pwd == ""){
				encrypt_pwd = pwd;
				decrypt_pwd = pwd;
			}else if(encrypt_flag == 1){
				decrypt_pwd = pwd;
				if (pwd != ""){
					$.ajax({
						url:'/bhost/rc4_encrypt',
						type:'post',
						async:false,
						data:{a0:se,z1:pwd},
						success:function(result){
							var result = JSON.parse(result);
							if (result.Result){
								encrypt_pwd = result.info;
							}else{
								_alert(1,"最近访问",result.info);
								return false;
							}
						}
					});
				}
			}else{
				encrypt_pwd = pwd;
			}
		}
		
		if (user == ""){
			_alert(1,"最近访问","请输入用户",$(".user_div").find('input'));
			return false;
		}
		if (ip == ""){
			_alert(1,"最近访问","请输入IP",$(".ip_div").find('input'));
			return false;
		}
		if (port == ""){
			_alert(1,"最近访问","请输入端口",$("#port_input"));
			return false;
		}
		if ($("#EnableRDPDiskMap").is(':visible') && $("#EnableRDPDiskMap").prop('checked')){
			if ($('.disk_map').is(':visible') && $(".disk_map").find('input:checked').length == 0){
				_alert(1,"最近访问","请选择硬盘");
				return false;
			}
			// if ($('.disk_map').is(':visible') && $(".disk_map").find('input:checked').length == 0 && !isMac){
			// 	_alert(1,"最近访问","请选择硬盘");
			// 	return false;
			// }
			// else if(isMac && $('.disk_map').is(':visible') && $(".disk_map").find('input[type=checkbox]:checked').length == 0 && $(".disk_map").find('input[type=text]').val()==''){
			// 	_alert(1,"最近访问","请选择硬盘");
			// 	return false;
			// }
		}
		if($("#conn_select").is(':visible')){
			HostAccessCfg.ConnParamId = $('#conn_select option:selected').attr('pid');
			if(HostAccessCfg.ConnParamId == 0){
				HostAccessCfg.ConnParamId = null;
			}
		}else{
			HostAccessCfg.ConnParamId = null;
		}		
		if ($(".local_client").find('input').prop('checked') || ($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked') && !$('.web_con').find('input').prop('checked'))){//客户端
			var timestamp = new Date().getTime();
			var username = se + '@' + timestamp;
			var bhus = window.parent.parent.frm.us.value;
			var param_host = '{"name":"hostname","value":"127.0.0.1"}';
			if($(".local_client").find('input').prop('checked')){
				HostAccessCfg.ConnModeName='local_client';
			}
			if($("#EnableCFG").prop('checked') == true && $("#EnableCFG").is(":visible")){
				HostAccessCfg.ConnModeName='local_client|mfs';
			}
			
			var json_data = {
				"BHUser":"", //堡垒机用户wen:xxx@root@192.168.0.83:22  base64加密
				"ServerUser":"",//服务器用户
				"ServerPassword":"", //rc4加密
				"BHIP":"",//堡垒机地址
				"ServerIP":"",//服务器地址
				"ServerPort":"",//服务器端口
				"ClientPath":"",//客户端全路径
				"ClientName":"",//客户端名称
				"Protocol":"",//协议名称
				"ServerName":"",//实例名、SID
				"ServerNameType":"",//实例名类型
				"ConnMode":"",//连接方式
				"title":"",
				"IsTunnel":"false",
				"MapPort":0,
				"Port":0,
				"screensize":"",
				"fullscreen":"true",
				"clip":"false",
				"diskmap":"false",
				"mapdisks":"",
				"AccAPP":"false",
				"RemoteApp":"false",
				"SshKeyName":"",
				"UrlIp":document_domain+ (location.port!=''?':'+location.port:''),
				"Sessid":se,
				"IfHiddenHostIP":"true"
			}
			if(HiddenFlag == true){
			  json_data.IfHiddenHostIP = "true"
			}else{
			  json_data.IfHiddenHostIP = "false"
			}
			var client_v = $("#sel_client").val();
			var client_text = $("#sel_client").children('option:selected').text();
			var path_input = "";
			if ($(".local_client").find('input').prop('checked') && $(".mfs").find('input').prop('checked') == false){//本地客户端
				if (client_text.indexOf('未设置') != -1){
					client_module_show(client_v);
					return false;
				}else{
					var flag_client =false;
					$.each(path_array,function(i,item){
						if(flag_client == true) return true;
						if (item.ClientName == client_v && item.ClientPath !=null){
							path_input = item.ClientProgram;
							flag_client = true
							return false;
						}
						if (item.ClientName == client_v){
							path_input = item.ClientProgram;
						}						
					});
				}
				path_input = path_input.replace(/\\/g,"\\\\\\\\");
				json_data.AccAPP = "false";
				if (($("#passageway_select").val() == 2 || IsTunnel == "true") && (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11")){
					client_v = "";
				}
			}else{//本地mstsc
				client_v = "";
				/*
				json_data.AccAPP = "true";
				if ($("#sel_mfs").val() == 0){
					_alert(1,"最近访问","请选择应用发布");
					return false;
				}
				*/
			}
			
			if (($("#ApplicationChannel").is(':visible') && $("#ApplicationChannel").prop('checked')) || (IsAcc == 1) || $(".mfs").find('input').prop('checked')){
				json_data.AccAPP = "true";
			}
			if($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked')){
				json_data.AccAPP = "true";
			}
			if (json_data.AccAPP == "true" && pro_name != "RDP"){
				if ($("#sel_mfs").val() == 0){
					_alert(1,"最近访问","请选择应用发布");
					return false;
				}
			}
			
			var cur_domain = document.domain;
			var cmd_str;
			if (IsTunnel == "false"){
				if ($("#passageway_select").val() == 1){
					IsTunnel = 'false';
				}else{
					IsTunnel = 'true';
				}
			}
			
			json_data.IsTunnel = IsTunnel;
			json_data.MapPort = MapPort;
			
			if ($(".local_client").find('input').prop('checked') && (!$("#EnableCFG").is(':visible') || !$("#EnableCFG").prop('checked'))){
				HostAccessCfg.ClientName = client_v;
			}else if (($("#EnableCFG").prop('checked') && $("#EnableCFG").is(':visible'))){
				HostAccessCfg.ClientName = $("#sel_mfs").val();
				if(HostAccessCfg.ClientName == 0){
					HostAccessCfg.ClientName = "MSTSC";
				}
			}else{
				HostAccessCfg.ClientName = "";
			}
			if(pro_name == "RDP" || pro_name == "X11" || (pro_name == "VNC" && !$("#EnableCFG").prop('checked'))){
				HostAccessCfg.ClientName = 'default';
			}
			json_data.ClientName = HostAccessCfg.ClientName;
			if (pro_name == "ORACLE"){
				var connmode = $("#oracle_auth_select").val();
				var servertype = $("#appoint").val();
				var ServerName = $("#oracle_input").val();
				var bhuser = window.parent.parent.frm.us.value;
				json_data.BHUser = bhuser;
				json_data.ConnMode = connmode;
				json_data.ServerNameType = servertype;
				json_data.ServerName = ServerName;
				if (client_v == "sqlldr"){
					var ctl_input = $("#ctl_input").val();
					if (ctl_input == ""){
						_alert(1,"最近访问","请填写路径",$("#ctl_input"));
						return false;
					}
					json_data.title = ctl_input.replace(/\\/g,"\\\\\\\\");
					HostAccessCfg.ExePath=ctl_input;
				}
			}else if (pro_name == "DB2"){
				json_data.ServerName = $("#db2_input").val();
			}else if (pro_name == "MYSQL"){
				json_data.ServerName = $(".mysql").find('input').val();
			}else if (pro_name == "MSSQL"){
				json_data.ServerName = $(".mssql:first").find('input').val();
				json_data.ConnMode = $("#mssql_auth").val();
			}else if (pro_name == "SYBASE"){
				json_data.ServerName = $("#sysbase_input").val();
				if (client_v == "isqlw"){
					var ctl_input = $("#ctl_sysbase_input").val();
					json_data.title = ctl_input.replace(/\\/g,"\\\\\\\\");
					HostAccessCfg.ExePath=ctl_input;
				}
			}else if (pro_name == "HTTP(S)" || pro_name == "HTTPS"){
				json_data.ServerName = $("#http_url").val();
				var http_account = $("#http_account").val();
				var http_pwd = $("#http_pwd").val();
				var http_submit = $("#http_submit").val();
				json_data.ConnMode = http_account + '|' + http_pwd + '|' + http_submit;
			}else if (pro_name == "RADMIN"){
				json_data.ConnMode = $("#radmin_auth_select").val();
			}else if (pro_name == "RDP"){
				json_data.ConnMode = $("#access_select").val();
				if (IsAcc == 0){
					json_data.ClientName = "default";
				}else if (($("#ApplicationChannel").is(":visible") && $("#ApplicationChannel").prop('checked')) || IsAcc == 1){
					json_data.ClientName = "mstsc";
				}else{
					json_data.ClientName = "";
				}
			}else if(pro_name == "SSH"){
				json_data.ServerName = $("#access_select").val();
			}
			
			json_data.BHUser = window.parent.parent.frm.us.value;
			if (remote_data != null && remote_data.EnableRemoteApp){
				json_data.RemoteApp = "true";
			}else{
				json_data.RemoteApp = "false";
			}
			if ($('.mfs').find('input').prop('checked') || pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11"){
				json_data.screensize = $("#screensize").val();
				json_data.clip = $("#EnableRDPClipboard").prop('checked') + '';
				if ($("#EnableRDPDiskMap").is(':visible')){
					json_data.diskmap = $("#EnableRDPDiskMap").prop('checked') + '';
				}else{
					json_data.diskmap = "false";
				}
				var mapdisks = "";
				if (json_data.diskmap == "true"){
					$('.disk_map').find('input:checked').each(function(i,item){
						mapdisks = mapdisks + $(item).parents('label:first').text() + '|';
					})
					if (mapdisks != ""){
						mapdisks = mapdisks.substring(0,mapdisks.length-1);
					}
					// if (isMac){
					// 	var path_disk=$('.disk_map').find('input[type=text]').val();
					// 	if(path_disk!=''){
					// 		if (mapdisks != ""){
					// 			mapdisks=mapdisks+'|'+path_disk;
					// 		}else{
					// 			mapdisks=path_disk;
					// 		}
					// 	}
					// }
				}
				json_data.mapdisks = mapdisks;
				HostAccessCfg.RDPDiskMapList = mapdisks;
			}
			var pro_name_temp = pro_name;
			if (pro_name_temp == "SFTP"){
				pro_name_temp = "SSH";
			}
			/*
			if (ssh_sftp_flag == 1){
				pro_name_temp = "SSH";
			}
			*/
			if ($(".local_client").find('input').prop('checked') && (!$("#EnableCFG").is(':visible') || !$("#EnableCFG").prop('checked'))){//客户端
				if (client_text == "Putty"){
					json_data.ServerPassword = "en::" + encrypt_pwd;
				}else{
					json_data.ServerPort = port + '';	
					if (pro_name != "ORACLE"){
						if (pro_name != "SYBASE"){
							if (pro_name == "DB2" || pro_name == "MYSQL"){
								json_data.ServerPassword = encrypt_pwd;
							}else{
								json_data.ServerPassword = "en::" + encrypt_pwd;
							}
						}else{
							json_data.ServerPassword = encrypt_pwd;//sybase客户端只能访问通道加密
						}
						
					}else{
						if (client_v == "PowerBuilder"){
							json_data.ServerPassword = "en::" + encrypt_pwd;
						}else{
							if (json_data.IsTunnel == "true"){//oracle 访问通道密加密码不用加en::
								json_data.ServerPassword = encrypt_pwd;
							}else{
								json_data.ServerPassword = encrypt_pwd;
							}
						}
					}
				}
			}else{//（前置机 本地）
				if ($("#EnableRDPClipboard").prop('checked')){
					var RDP_Select = 1;
				}else{
					var RDP_Select = 0;
				}
				if ($("#EnableRDPDiskMap").prop('checked')){
					var DiskMap = 1
				}else{
					var DiskMap = 0
				}
				json_data.ServerPassword = encrypt_pwd + ':' + RDP_Select + ':' + DiskMap;
				if ($('.mfs').find('input').prop('checked')){
					pro_name_temp = "RDP";
				}
			}
			if (pro_name == "VNC" || pro_name == "X11" || pro_name == "RDP"){
				if ($("#EnableRDPClipboard").prop('checked')){
					var RDP_Select = 1;
				}else{
					var RDP_Select = 0;
				}
				if ($("#EnableRDPDiskMap").prop('checked')){
					var DiskMap = 1
				}else{
					var DiskMap = 0
				}
				json_data.ServerPassword = encrypt_pwd + ':' + RDP_Select + ':' + DiskMap;
			}
			
			var noserverpwd = "-";
			$.ajax({
				url:'/bhost/rc4_encrypt',
				type:'post',
				async:false,
				data:{a0:se,z1:noserverpwd},
				success:function(result){
					var result = JSON.parse(result);
					if (result.Result){
						noserverpwd = result.info;
					}else{
						_alert(1,"最近访问",result.info);
						return false;
					}
				}
			});
			
			if($(".pwd_div").is(":visible") && $(".pwd_div").find("input").val() == ""){//空密码？
				json_data.ServerPassword = noserverpwd;
			}
			if ($("#EnableKey").is(":visible")){
				SshKeyId = $("#EnableKey").data('value');
				if (SshKeyId != null && SshKeyId != undefined && SshKeyId != 0){
					var t_keyName = $("#EnableKey").children("div").children("span").text();
					if(t_keyName == "默认"){
						t_keyName = "="
					}			
					json_data.SshKeyName = t_keyName;
					json_data.ServerPassword = noserverpwd;
				}
			}
			json_data.Port = port;
			var get_module_flag = 0;
			$.ajax({
				url:'/bhost/module_app_set_list',
				type:'post',
				async:false,
				data:{a0:se},
				success:function(result){
					var re_result = JSON.parse(result);
					$.each(re_result.data,function(i,item){
						if (pro_name_temp == "SSH"){
							if (item.ApplicationName.indexOf(pro_name_temp) != -1){
								get_module_flag = 1;
								json_data.ServerPort = item.ServicePort;
							}
						}else{
							if (item.ApplicationName.indexOf("菜单") === -1 && item.ApplicationName.indexOf(pro_name_temp) != -1){
								param_port = '{"name":"port","value":"'+item.ServicePort+'"}';							
								get_module_flag = 1;
								json_data.ServerPort = item.ServicePort;
								return false;
							}
						}
					});
					if (get_module_flag == 0){
						$.each(re_result.data,function(i,item){
							if (item.ApplicationName.indexOf(pro_name_temp) != -1){
								json_data.ServerPort = item.ServicePort;
								param_port = '{"name":"port","value":"'+item.ServicePort+'"}';
								json_data.Port = item.ServicePort;
								return false;
							}else{
								param_port = '{"name":"port","value":"'+port+'"}';
								json_data.Port = item.ServicePort;
							}
						});
					}
				}
			});
			
			HostAccessCfg.UserCode = window.parent.parent.frm.us.value;
			HostAccessCfg.ServerIP = ip;
			HostAccessCfg.ProtocolName = pro_name;
			HostAccessCfg.SessionId = se;
			HostAccessCfg.ServerUser = user;
			HostAccessCfg.ServerPort = port;
			HostAccessCfg.Pwd = encrypt_pwd;
			HostAccessCfg.SSHType = $("#access_select").val();
			
			if($("#ApplicationChannel").is(":visible") && $("#ApplicationChannel").prop('checked')){
				HostAccessCfg.AppChannel='true';
			}else if($("#ApplicationChannel").is(":visible") && !$("#ApplicationChannel").prop('checked')){
				HostAccessCfg.AppChannel='false';
			}
			if ($("#EnableRDPClipboard").prop('checked')){
				HostAccessCfg.RDPClipboard = true;
			}else{
				HostAccessCfg.RDPClipboard = false;
			}
			HostAccessCfg.RDPScreen = $("#screensize").val();
			if ($("#EnableRDPDiskMap").prop('checked')){
				HostAccessCfg.RDPDiskMap = true;
			}else{
				HostAccessCfg.RDPDiskMap = false;
			}
			if (HostAccessCfg.RDPScreen == 0){
				var nwidth = 0;
				var nheight = 0;
			}else if (HostAccessCfg.RDPScreen == 1){
				var nwidth = 1;
				var nheight = 1;
				if (pro_name == "X11"){
					var nwidth = window.screen.width;
					var nheight = window.screen.height;
				}
			}else{
				var nwidth = HostAccessCfg.RDPScreen.split("*")[0];
				var nheight = HostAccessCfg.RDPScreen.split("*")[1];
			}

			var param_array = [];
			if (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11"){
				if (HostAccessCfg.RDPScreen != 0 && HostAccessCfg.RDPScreen != 1){
					//var nwidth = HostAccessCfg.RDPScreen.split("*")[0];
					//var nheight = HostAccessCfg.RDPScreen.split("*")[1];
					var param_width = '{"name":"width","value":"'+nwidth+'"}';
					var param_height = '{"name":"height","value":"'+nheight+'"}';
					param_array.push(JSON.parse(param_width));
					param_array.push(JSON.parse(param_height));
				}
			}

			var param_array = [];
			var type_ver = "";
			if (get_module_flag == 1){
				var param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+':'+pro_name+type_ver+'@h5"}';
			}else{
				var param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+'@h5"}';
			}
			
			if (HostAccessCfg.RDPClipboard){
				var RDP_Select = 1;
			}else{
				var RDP_Select = 0;
			}
			if (HostAccessCfg.RDPDiskMap){
				var DiskMap = 1;
			}else{
				var DiskMap = 0;
			}
			if (pro_name == "VNC" || pro_name == "X11"){
				var param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+':'+pro_name+'@h5'+nwidth+'*'+nheight+'*'+RDP_Select+'*'+DiskMap+'"}';
			}			
			var client_ip = window.parent.parent.client_ip;
			var param_password = '{"name":"password","value":"'+client_ip+':0@'+encrypt_pwd+'"}';
			/*param_array.push(JSON.parse(param_host));
			param_array.push(JSON.parse(param_port));
			param_array.push(JSON.parse(param_username));
			param_array.push(JSON.parse(param_password));*/
			// HostAccessCfg.ExePath = path_input;
			HostAccessCfg.ConnParam = json_data.ServerNameType;
			HostAccessCfg.ServiceName = json_data.ServerName;
			HostAccessCfg.ConnMode = json_data.ConnMode;
			json_data.ServerUser = user;
			json_data.BHIP = document_domain;
			json_data.ServerIP = ip;
			json_data.ClientPath = path_input;
			
			if ($(".local_client").find('input').prop('checked') && (!$("#EnableCFG").is(':visible') || !$("#EnableCFG").prop('checked'))){
				HostAccessCfg.ClientName = client_v;
				// HostAccessCfg.ConnWay=$('#passageway_select').val();
			}else if ($('#EnableCFG').prop('checked') && $("#EnableCFG").is(':visible')){
				HostAccessCfg.ClientName = $("#sel_mfs").val();
				if(HostAccessCfg.ClientName == 0){
					HostAccessCfg.ClientName = "MSTSC";
				}
				// HostAccessCfg.ConnWay=$('#passageway_select').val();
			}
			if(pro_name == "RDP" || pro_name == "X11"){
				HostAccessCfg.ClientName = 'default';
			}
			//if($("#passageway_select").is(":visible")){
				HostAccessCfg.ConnWay=$('#passageway_select').val();
			//}
			if (pro_name == "SSH" || pro_name == "SFTP"){
				pro_name = "SSH" + $("#access_select").val();
			}
			if($("#conn_select").is(":visible")){
				HostAccessCfg.ConnParamName=$('#conn_select option:selected').text();
			}
			json_data.Protocol = pro_name;
			
			cmd_str = JSON.stringify(json_data);
			
			var remark_json = {
				"PlanId": 0,
				"UserCode": "test3", 
				"HostIP": "192.168.0.53",
				"HostName": "主机4Group",
				"PlanMsg": "testtt"
			}
			var remarktype = 0;
			if ($(".remark").is(":visible")){
				save_remark(0);
				if (remark_flag == 1){
					return false;
				}
			}
			var save_flag = 0;
		}else if($(".web_con").find('input').prop('checked')){// H5 （H5连前置机）		
			var bhus = window.parent.parent.frm.us.value;
			//var username = se + '@' + user + '@' + ip + ':' + port + ':' + pro_name;// + '@h5';
			var timestamp = new Date().getTime();
			var username = se + '@' + timestamp;
			
			var param_host = '{"name":"hostname","value":"127.0.0.1"}';
			var get_module_flag = 0;
			var param_port;
			//./rdesktop -a 16 -g 1024x768 -r "disk:C=C:/" -u RDP@administrator@disk:16 -p 12345678 192.168.0.104
			var json_data = {
				"BHIP":"",//堡垒机地址
				"Port":"",
				"Protocol":"",//协议名称
				"screensize":"",
				"diskmap":"false",
				"mapdisks":"",
				"username":"",
				"H5Flag":1,
				"UrlIp":document_domain+ (location.port !=''?':'+location.port:''),
				"Sessid":se,
				"IfHiddenHostIP":"true",
				"Password":"123456",
				"IsTunnel":"",
				"MapPort":""
			}
			json_data.IsTunnel = global_data.IsTunnel.toString();
			json_data.MapPort = global_data.MapPort;
			if(HiddenFlag == true){
				json_data.IfHiddenHostIP = "true"
			}else{
				json_data.IfHiddenHostIP = "false"
			}
			var HostAccessCfg = {
				"UserCode": "test3",
				"ServerIP": "192.168.0.53",
				"ProtocolName": "ORACLE",
				"SessionId": "6363408954018973473",
				"ServerUser": "ora",        
				"ServerPort": 1521,
				"ServiceName": "",
				"ConnMode": "",
				"ConnParam": "", 
				"ExePath": null,                                   
				"Pwd": "945da2c4d0",
				"ClientName": "",
				"SSHType": null,        
				"RDPScreen": "0",
				"RDPClipboard": null,                
				"RDPDiskMap": null,
				"RDPDiskMapList": null,
				"ConnParamName": null,
				"ConnModeName": null,
				"AppRelease": null,
				"AppChannel": null,
				"ConnWay":null
			}
			HostAccessCfg.UserCode = bhus;
			HostAccessCfg.ServerIP = ip;
			json_data.BHIP = document_domain;
			HostAccessCfg.ProtocolName = pro_name;
			HostAccessCfg.SessionId = se;
			HostAccessCfg.ServerUser = user;
			HostAccessCfg.ServerPort = port;
			HostAccessCfg.Pwd = encrypt_pwd;
			HostAccessCfg.SSHType = $("#access_select").val();

			HostAccessCfg.ConnModeName='web_con';
			if($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked') == true){
				HostAccessCfg.ConnModeName='web_con|mfs';
			}	

			if (pro_name == "ORACLE") {
				HostAccessCfg.ServiceName = $("#oracle_input").val();
				HostAccessCfg.ConnMode = $("#oracle_auth_select").val();
			} else if (pro_name == "DB2") {
				HostAccessCfg.ServiceName = $("#db2_input").val();
			} else if (pro_name == "MYSQL") {
				HostAccessCfg.ServiceName = $(".mysql").find('input').val();
			} else if (pro_name == "SYBASE") {
				HostAccessCfg.ServiceName = $("#sysbase_input").val();
			} else if (pro_name == "HTTP(S)" || pro_name == "HTTPS") {
				var http_account = $("#http_account").val();
				var http_pwd = $("#http_pwd").val();
				var http_submit = $("#http_submit").val();
				HostAccessCfg.ServiceName = $("#http_url").val();
				HostAccessCfg.ConnMode = http_account + '|' + http_pwd + '|' + http_submit;
			} else if (pro_name == "MSSQL") {
				HostAccessCfg.ServiceName = $(".mssql:first").find('input').val();
				HostAccessCfg.ConnMode = $("#mssql_auth").val();
			} else if (pro_name == "SSH") {
				HostAccessCfg.ServiceName = $("#access_select").val();
			} else if(pro_name == "RADMIN"){
				HostAccessCfg.ConnMode = $("#radmin_auth_select").val();
			} else{				
				HostAccessCfg.ConnMode = $("#access_select").val();
			}
			if ($("#EnableRDPClipboard").prop('checked')){
				HostAccessCfg.RDPClipboard = true;
			}else{
				HostAccessCfg.RDPClipboard = false;
			}
			HostAccessCfg.RDPScreen = $("#screensize").val();
			json_data.screensize = $("#screensize").val();
			
			if ($("#EnableRDPDiskMap").is(':visible') && $("#EnableRDPDiskMap").prop('checked')){
				HostAccessCfg.RDPDiskMap = true;
				var mapdisks = "";
				// $('.disk_map').find('input:checked').each(function(i,item){
				// 	mapdisks = mapdisks + $(item).parents('label:first').text() + '|';
				// })
				// if (mapdisks != ""){
				// 	mapdisks = mapdisks.substring(0,mapdisks.length-1);
				// }
				$('.disk_map').find('input:checked').each(function(i,item){
					mapdisks = mapdisks + $(item).parents('label:first').text() + '|';
				})
				if (mapdisks != ""){
					mapdisks = mapdisks.substring(0,mapdisks.length-1);
				}
				// if (isMac){
				// 	var path_disk=$('.disk_map').find('input[type=text]').val();
				// 	if(path_disk!=''){
				// 		if (mapdisks != ""){
				// 			mapdisks=mapdisks+'|'+path_disk;
				// 		}else{
				// 			mapdisks=path_disk;
				// 		}
				// 	}
				// }
				HostAccessCfg.RDPDiskMapList = mapdisks;
				json_data.diskmap = "true";
				json_data.mapdisks = mapdisks;
			}else{
				HostAccessCfg.RDPDiskMap = false;
				HostAccessCfg.RDPDiskMapList = "";
				json_data.diskmap = "false";
				json_data.mapdisks = "";
			}

			if (($("#ApplicationChannel").is(":visible") && $("#ApplicationChannel").prop('checked')) || IsAcc == 1){
				HostAccessCfg.ClientName = "mstsc";//$("#sel_mfs").val();
			}else if (IsAcc == 0 || IsAcc == 2){
				HostAccessCfg.ClientName = $("#sel_mfs").val();
				if($("#sel_mfs").text() == "无"){
					_alert(1,"最近访问","请选择应用发布");
					return false;
				}
				if(HostAccessCfg.ClientName == 0){
					HostAccessCfg.ClientName = "MSTSC";
				}
			}else{
				HostAccessCfg.ClientName = "";
			}
			if(pro_name == "RDP" || pro_name == "X11" || (pro_name == "VNC" && !$("#EnableCFG").prop('checked'))){
				HostAccessCfg.ClientName = 'default';
			}
			if($("#ApplicationChannel").is(":visible") && $("#ApplicationChannel").prop('checked')){
				HostAccessCfg.AppChannel='true';
			}else if($("#ApplicationChannel").is(":visible") && !$("#ApplicationChannel").prop('checked')){
				HostAccessCfg.AppChannel='false';
			}
			//if($("#passageway_select").is(":visible")){
				HostAccessCfg.ConnWay=$('#passageway_select').val();
			//}
			if($("#conn_select").is(":visible")){
				HostAccessCfg.ConnParamName=$('#conn_select option:selected').text();
			}
			
			if ($(".remark").is(":visible")){
				save_remark(0);
				if (remark_flag == 1){
					return false;
				}
			}
			var get_rdp_mode=0;
			$.ajax({
				url:'/bhost/module_app_set_list',
				type:'post',
				async:false,
				data:{a0:se},
				success:function(result){
					var re_result = JSON.parse(result);
					$.each(re_result.data,function(i,item){
						if (item.ApplicationName.indexOf("菜单") != -1 && item.ApplicationName.indexOf(pro_name) != -1){
							get_module_flag = 1;
							param_port = '{"name":"port","value":"'+item.ServicePort+'"}';
							json_data.Port = item.ServicePort;
							return false;
						}
					});
					if (get_module_flag == 0){
						$.each(re_result.data,function(i,item){
							if (item.ApplicationName.indexOf(pro_name) != -1){
								param_port = '{"name":"port","value":"'+item.ServicePort+'"}';
								if(pro_name=='RDP'){
									get_rdp_mode=item.Mode;
								}
								json_data.Port = item.ServicePort;
								return false;
							}else{
								param_port = '{"name":"port","value":"'+port+'"}';
								json_data.Port = item.ServicePort;
							}
						});
					}
				}
			});
			var param_array = [];
			var type_ver = "";
			if (pro_name == "SSH"){
				type_ver = $("#access_select").val();				
				var param_sftp = '{"name":"enable-sftp","value":"true"}';
				param_array.push(JSON.parse(param_sftp));
			}
			if (get_module_flag == 1){
				var param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+':'+pro_name+type_ver+'@h5"}';
			}else{
				var param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+'@h5"}';
			}
			
			if (HostAccessCfg.RDPScreen == 0){
				var nwidth = 0;
				var nheight = 0;
			}else if (HostAccessCfg.RDPScreen == 1){
				var nwidth = 1;
				var nheight = 1;
				if (pro_name == "X11"){
					var nwidth = window.screen.width;
					var nheight = window.screen.height;
				}
			}else{
				var nwidth = HostAccessCfg.RDPScreen.split("*")[0];
				var nheight = HostAccessCfg.RDPScreen.split("*")[1];
			}
			if (HostAccessCfg.RDPClipboard){
				var RDP_Select = 1;
			}else{
				var RDP_Select = 0;
			}
			if (HostAccessCfg.RDPDiskMap){
				var DiskMap = 1;
			}else{
				var DiskMap = 0;
			}
			
			if (pro_name == "VNC" || pro_name == "X11"){
				if($("#EnableCFG").prop('checked') == true && $("#EnableCFG").is(":visible")){
					param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+':'+pro_name+'@h5'+nwidth+'*'+nheight+'*'+RDP_Select+'*'+DiskMap+'"}';
				}else{
					param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+':'+pro_name+'@h5'+nwidth+'*'+nheight+'*'+RDP_Select+'*'+DiskMap+'"}';
				}

			}else if (pro_name == "RDP"){
				if(get_rdp_mode==1){
					param_username = '{"name":"username","value":"'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+':'+pro_name+'-'+$("#access_select").val()+'@h5'+'0*'+nheight+'*'+RDP_Select+'*'+DiskMap+'"}';
				}else{
					param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+':'+pro_name+'-'+$("#access_select").val()+'@h5'+'0*'+nheight+'*'+RDP_Select+'*'+DiskMap+'"}';
				}
				param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+':'+pro_name+'-'+$("#access_select").val()+'@h5'+'0*'+nheight+'*'+RDP_Select+'*'+DiskMap+'"}';
			}else if($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked') == true){
				param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+':'+pro_name+'@h5'+nwidth+'*'+nheight+'*'+RDP_Select+'*'+DiskMap+'"}';
				//@h5width*height*is_need_clipboard*is_need_disc_map*sessionid*disk_mode*exepath*disc_num\tservName\tconnMode\tconnParam\texePath\t
			}
			
			var client_ip = window.parent.parent.client_ip;
			var param_password = '{"name":"password","value":"'+client_ip+':0@'+encrypt_pwd+'"}';
			
			if (pro_name == "SSH"){
				var SshKeyId = 0;
				var sshkey_name = null;
				if ($("#EnableKey").is(":visible")){
					SshKeyId = $("#EnableKey").data('value');
					if (SshKeyId != null && SshKeyId != undefined && SshKeyId != 0){
						sshkey_name = $("#EnableKey").children("div").children("span").text();
						if(sshkey_name == "默认"){
							sshkey_name = "";
							param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+':'+pro_name+type_ver+'='+sshkey_name+'@h5'+'"}';							
						}else{
							param_username = '{"name":"username","value":"'+bhus+'@'+user.replace(/\\/g,"\\\\")+'@'+ip+':'+port+':'+pro_name+type_ver+'='+sshkey_name+'@h5'+'"}';	
						}
					}
				}			
			}
			if (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11"){
				if (HostAccessCfg.RDPScreen != 0 && HostAccessCfg.RDPScreen != 1){
					//var nwidth = HostAccessCfg.RDPScreen.split("*")[0];
					//var nheight = HostAccessCfg.RDPScreen.split("*")[1];
					var param_width = '{"name":"width","value":"'+nwidth+'"}';
					var param_height = '{"name":"height","value":"'+nheight+'"}';
					param_array.push(JSON.parse(param_width));
					param_array.push(JSON.parse(param_height));
				}
				if (pro_name == "X11" && HostAccessCfg.RDPScreen == 1){
					var param_width = '{"name":"width","value":"'+nwidth+'"}';
					var param_height = '{"name":"height","value":"'+nheight+'"}';
					param_array.push(JSON.parse(param_width));
					param_array.push(JSON.parse(param_height));
				}
			}														
			
			param_array.push(JSON.parse(param_host));
			param_array.push(JSON.parse(param_port));
			param_array.push(JSON.parse(param_username));
			param_array.push(JSON.parse(param_password));
			
			/*
			var url = location.href;
			url_array = url.split(":")
			var url_array1 = url_array.slice(0,2);
			var url_str = url_array1.join(":");
			*/
			var url_str = "https://"+document_domain+':8443';
			var save_flag = 0;
		}
		
		var save_pwd = 0;
		if (global_data.IsRemindSaveUser == 0){
			if (check_v != 3){//提示
				save_pwd = 0;
			}else{//保存
				save_pwd = 1;
			}
		}else if (global_data.IsRemindSaveUser == 1){//保存
			save_pwd = 1;
		}else if (global_data.IsRemindSaveUser == 2){//不保存
			save_pwd = 2;
		}

		var save_flag_s = 0;//1修改了密码（秘钥）提示保存
												//0未修改 不用提示保存 18-8-13
		////console.log(S_PWD);
		////console.log(auto_password);
		if($("#Key_select").is(":visible")){
			if(S_PWD.sshname == $("#EnableKey").find('span').text() && S_PWD.sshname != ""){
				save_flag_s = 0;
			}else{
				save_flag_s = 1;
			}
		}else if($(".item.pwd_div").is(":visible")){
			if($(".item.pwd_div").find('input').attr('disabled') == 'disabled'){
				if($(".item.pwd_div").find('input').val() == S_PWD.enpwd && $(".item.pwd_div").find('input').val() != ""){
					save_flag_s = 0;
				}else{
					save_flag_s = 1;
				}
			}else{
				if(auto_password == $(".item.pwd_div").find('input').val()){
					save_flag_s = 0;
				}else{
					if($(".item.pwd_div").find('input').val() == S_PWD.pwd && $(".item.pwd_div").find('input').val() != ""){
						save_flag_s = 0;
					}else{
						save_flag_s = 1;
					}
				}
			}
		}
		json_data.Password = JSON.parse(param_password).value;
		check_cilent = false;
		if (save_pwd == 0){//提示
			if(save_flag_s == 1){
				parent.layer.open({
					type: 1,
					title: "最近访问",
					content: '<div class="layer-alert"><i class="alert warning"></i>是否保存</div>',
					btn: ['确&nbsp;&nbsp;定', '取&nbsp;&nbsp;消'],
					btnAlign: 'c',
					closeBtn: false,
					skin: 'layer-custom',
					area: ['380px', '310px'],
					move: false,
					resize: false,
					btn1: function (i) {
						parent.layer.close(i);
						if ($(".web_con").find('input').prop('checked')){
							var sesstimet = (new Date()).valueOf();
							json_data['sesstimet'] = sesstimet;
							$.ajax({
								url: "/bhost/get_token_remote",
								type:"POST",
								async:false,
								data:{a0:se,z1:JSON.stringify(param_array),z2:ip,z3:pro_name,z4:username,z5:pwd,z6:url_str,z7:user,z8:JSON.stringify(HostAccessCfg),z9:1,z10:HostAccessCfg.RDPDiskMap,z12:JSON.stringify(json_data),m1:mac},
								success:function(result){
									var result=JSON.parse(result);
									var url_addr = 'https://'+document_domain+':8443/bhremote/?token='+result.authToken;
																	
									$('.prolink.active').click();
									if (HostAccessCfg.RDPDiskMap){
										if (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11" || HostAccessCfg.RDPDiskMap == true){
											if (result.Flag == 1){
												json_data.username = result.UserName.substring(0,result.UserName.length-1) + 2;
												window.open('https://'+window_location_host+'/bhost/test_html?se={{se}}&z1='+JSON.stringify(json_data));
											}else{
												//window.location.href = 'bhost://cmd&'+result.CmdSet;											
												get_regedit('bhost', se,'',sesstimet);
												$('#YuFrame1').remove();
												$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
												$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result.CmdSet);	
												
												_showLoading_client('正在启动客户端，请稍后');
												
												var c = 0;		
												var if_ok_down_other = setInterval(function(){													
													if(check_cilent == true){
														window.open(url_addr);
														clearInterval(if_ok_down_other);
														_closeLoading_client();
														return 0;				
													}
													if(c >=10){
														clearInterval(if_ok_down_other);	
														_closeLoading_client();
														return 0;
													}			
													c = c + 1;				
												},500)
																							
											}
										}
									}else{
											window.open(url_addr);
										}
								}
							});
						}else{
							var sesstimet = (new Date()).valueOf(); 
							var c = JSON.parse(cmd_str)
							c['sesstimet'] = ''+sesstimet;
							cmd_str =JSON.stringify(c);
							var msstr = aceg(JSON.stringify(HostAccessCfg),se);
							$.ajax({
								url:'/bhost/Save_HostAccessCfg',
								type:'post',
								async:false,
								data:{a0:se,z1:JSON.stringify(HostAccessCfg),z3:1,z4:cmd_str,m1:msstr,m2:mac},
								success:function(result){
									var save_result = JSON.parse(result);
									if (save_result.Result){
										if (save_result.Flag == 1){
											window.open('https://'+window_location_host+'/bhost/test_html?se={{se}}&z1='+cmd_str);
										}else{
											//window.location.href = 'bhost://cmd&'+save_result.CmdSet;
											get_regedit('bhost', se, '' ,sesstimet);
											$('#YuFrame1').remove();
											$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
											$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+save_result.CmdSet);
										}
									}else{
										_alert(1,"最近访问",save_result.ErrMsg);
										return false;
									}
								}
							});
						}
					},
					btn2: function (i) {
						parent.layer.close(i);
						//HostAccessCfg.Pwd = null;
						if ($(".web_con").find('input').prop('checked')){
							var sesstimet = (new Date()).valueOf();
							json_data['sesstimet'] = sesstimet;
							$.ajax({
								url: "/bhost/get_token_remote",
								type:"POST",
								async:false,
								data:{a0:se,z1:JSON.stringify(param_array),z2:ip,z3:pro_name,z4:username,z5:pwd,z6:url_str,z7:user,z8:JSON.stringify(HostAccessCfg),z9:0,z10:HostAccessCfg.RDPDiskMap,z12:JSON.stringify(json_data),m1:mac},
								success:function(result){
									var result=JSON.parse(result);
									var url_addr = 'https://'+document_domain+':8443/bhremote/?token='+result.authToken;
									//window.open(url_addr);
									if (HostAccessCfg.RDPDiskMap){
										if (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11" || HostAccessCfg.RDPDiskMap == true){
											if (result.Flag == 1){
												json_data.username = result.UserName.substring(0,result.UserName.length-1) + 2;
												window.open('https://'+window_location_host+'/bhost/test_html?se={{se}}&z1='+JSON.stringify(json_data));
											}else{
												//window.location.href = 'bhost://cmd&'+result.CmdSet;
												get_regedit('bhost', se,'',sesstimet);
												$('#YuFrame1').remove();
												$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
												$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result.CmdSet);
												
												_showLoading_client('正在启动客户端，请稍后');												
												var c = 0;		
												var if_ok_down_other = setInterval(function(){													
													if(check_cilent == true){
														window.open(url_addr);
														clearInterval(if_ok_down_other);
														_closeLoading_client();
														return 0;				
													}
													if(c >=10){
														clearInterval(if_ok_down_other);	
														_closeLoading_client();
														return 0;
													}			
													c = c + 1;				
												},500)
												
												
											}
										}
									}else{
											window.open(url_addr);
										}
								}
							});
						}else{
							var sesstimet = (new Date()).valueOf();
							var c = JSON.parse(cmd_str)
							c['sesstimet'] = ''+sesstimet;
							cmd_str =JSON.stringify(c);
							var msstr = aceg(JSON.stringify(HostAccessCfg),se);
							$.ajax({
								url:'/bhost/Save_HostAccessCfg',
								type:'post',
								async:false,
								data:{a0:se,z1:JSON.stringify(HostAccessCfg),z2:JSON.stringify(remark_json),z3:0,z4:cmd_str,m1:msstr,m2:mac},
								success:function(result){
									var save_result = JSON.parse(result);
									if (save_result.Result){
										if (save_result.Flag == 1){
											window.open('https://'+window_location_host+'/bhost/test_html?se={{se}}&z1='+cmd_str);
										}else{
											//window.location.href = 'bhost://cmd&'+save_result.CmdSet;
											get_regedit('bhost', se,'',sesstimet);
											$('#YuFrame1').remove();
											$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
											$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+save_result.CmdSet);
										}
									}else{
										_alert(1,"主机分组",save_result.ErrMsg);
										return false;
									}
								}
							});
						}
					}
				})
			}else{//和不保存一样 (btn2)
				if ($(".web_con").find('input').prop('checked')){
					var sesstimet = (new Date()).valueOf();
					json_data['sesstimet'] =sesstimet; 
					$.ajax({
						url: "/bhost/get_token_remote",
						type:"POST",
						async:false,
						data:{a0:se,z1:JSON.stringify(param_array),z2:ip,z3:pro_name,z4:username,z5:pwd,z6:url_str,z7:user,z8:JSON.stringify(HostAccessCfg),z9:0,z10:HostAccessCfg.RDPDiskMap,z12:JSON.stringify(json_data),m1:mac},
						success:function(result){
							var result=JSON.parse(result);
							var url_addr = 'https://'+document_domain+':8443/bhremote/?token='+result.authToken;
							//window.open(url_addr);
							if (HostAccessCfg.RDPDiskMap){
								if (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11" || HostAccessCfg.RDPDiskMap == true){
									if (result.Flag == 1){
										json_data.username = result.UserName.substring(0,result.UserName.length-1) + 2;
										window.open('https://'+window_location_host+'/bhost/test_html?se={{se}}&z1='+JSON.stringify(json_data));
									}else{
										//window.location.href = 'bhost://cmd&'+result.CmdSet;
										get_regedit('bhost', se,'',sesstimet);
										$('#YuFrame1').remove();
										$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
										$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result.CmdSet);
										_showLoading_client('正在启动客户端，请稍后');
												
										var c = 0;		
										var if_ok_down_other = setInterval(function(){													
											if(check_cilent == true){
												window.open(url_addr);
												clearInterval(if_ok_down_other);
												_closeLoading_client();
												return 0;				
											}
											if(c >=10){
												clearInterval(if_ok_down_other);	
												_closeLoading_client();
												return 0;
											}			
											c = c + 1;				
										},500)
										
										
									}
								}
							}else{
											window.open(url_addr);
										}
						}
					});
				}else{
					var sesstimet = (new Date()).valueOf();
					var c = JSON.parse(cmd_str)
					c['sesstimet'] = ''+sesstimet;
					cmd_str =JSON.stringify(c);
					var msstr = aceg(JSON.stringify(HostAccessCfg),se);
					$.ajax({
						url:'/bhost/Save_HostAccessCfg',
						type:'post',
						async:false,
						data:{a0:se,z1:JSON.stringify(HostAccessCfg),z2:JSON.stringify(remark_json),z3:0,z4:cmd_str,m1:msstr,m2:mac},
						success:function(result){
							var save_result = JSON.parse(result);
							if (save_result.Result){
								if (save_result.Flag == 1){
									window.open('https://'+window_location_host+'/bhost/test_html?se={{se}}&z1='+cmd_str);
								}else{
									//window.location.href = 'bhost://cmd&'+save_result.CmdSet;
									get_regedit('bhost', se,'',sesstimet);
									$('#YuFrame1').remove();
									$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
									$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+save_result.CmdSet);
								}
							}else{
								_alert(1,"主机分组",save_result.ErrMsg);
								return false;
							}
						}
					});
				}
			}
		}else if (save_pwd == 1){//保存
			save_flag = 1;
		}else if (save_pwd == 2){//不保存
			save_flag = 2;
			//HostAccessCfg.Pwd = null;
		}
		if (save_flag != 0){
			if ($(".web_con").find('input').prop('checked')){
				var sesstimet = (new Date()).valueOf();
				json_data['sesstimet'] = sesstimet;
				$.ajax({
					url: "/bhost/get_token_remote",
					type:"POST",
					async:false,
					data:{a0:se,z1:JSON.stringify(param_array),z2:ip,z3:pro_name,z4:username,z5:pwd,z6:url_str,z7:user,z8:JSON.stringify(HostAccessCfg),z9:save_flag,z10:HostAccessCfg.RDPDiskMap,z12:JSON.stringify(json_data),m1:mac},
					success:function(result){
						var result=JSON.parse(result);
						var url_addr = 'https://'+document_domain+':8443/bhremote/?token='+result.authToken;
						//window.open(url_addr);
						/*
						if (save_flag == 1){
							$('.prolink.active').click();
						}
						*/
						if (HostAccessCfg.RDPDiskMap){
							if (pro_name == "RDP" || pro_name == "VNC" || pro_name == "X11" || HostAccessCfg.RDPDiskMap == true){
								if (result.Flag == 1){
									json_data.username = result.UserName.substring(0,result.UserName.length-1) + 2;
									window.open('https://'+window_location_host+'/bhost/test_html?se={{se}}&z1='+JSON.stringify(json_data));
								}else{
									//window.location.href = 'bhost://cmd&'+result.CmdSet;
									get_regedit('bhost', se,'',sesstimet);
									$('#YuFrame1').remove();
									$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
									$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+result.CmdSet);
									
									_showLoading_client('正在启动客户端，请稍后');
										
										var c = 0;		
										var if_ok_down_other = setInterval(function(){													
											if(check_cilent == true){
												window.open(url_addr);
												clearInterval(if_ok_down_other);
												_closeLoading_client();
												return 0;				
											}
											if(c >=10){
												clearInterval(if_ok_down_other);	
												_closeLoading_client();
												return 0;
											}			
											c = c + 1;				
										},500)
									
								}
							}
						}else{
											window.open(url_addr);
										}
					}
				});
			}else{
				var sesstimet = (new Date()).valueOf();
				var c = JSON.parse(cmd_str)
				c['sesstimet'] = ''+sesstimet;
				cmd_str =JSON.stringify(c);
				var msstr = aceg(JSON.stringify(HostAccessCfg),se);
				$.ajax({
					url:'/bhost/Save_HostAccessCfg',
					type:'post',
					async:false,
					data:{a0:se,z1:JSON.stringify(HostAccessCfg),z2:JSON.stringify(remark_json),z3:save_flag,z4:cmd_str,m1:msstr,m2:mac},
					success:function(result){
						var save_result = JSON.parse(result);
						if (save_result.Result){
							if (save_result.Flag == 1){
								window.open('https://'+window_location_host+'/bhost/test_html?se={{se}}&z1='+cmd_str);
							}else{
								//window.location.href = 'bhost://cmd&'+save_result.CmdSet;
								get_regedit('bhost', se, '', sesstimet);
								$('#YuFrame1').remove();
								$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
								$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+save_result.CmdSet);
							}
						}else{
							_alert(1,"主机分组",save_result.ErrMsg);
							return false;
						}
					}
				});
			}
		}
	}
	
	var remark_flag = 0;
	function save_remark(type){
		var remark_json = {
			"PlanId": 0,
			"UserCode": "test3", 
			"HostIP": "192.168.0.53",
			"HostName": "主机4Group", 
			"PlanMsg": "testtt"
		}
		
		if (quick_link == 1){
			var ip = $(".ip_div").find('input').val();
			if (ip == ""){
				remark_flag = 1;
				_alert(1,"最近访问","请输入IP",$(".ip_div").find('input'));
				return false;
			}
			var HostName = ip;
			get_plan(ip,1);
		}else{
			if ($("#fList").find('a.prolink.active').length != 0){
				var tr_index = $('a.prolink.active').parents('tr:first').index();
				var ip = recent_re.data[tr_index].HostIP;
				var HostName = recent_re.data[tr_index].HostName;
			}else{
				var ip = recent_re.data[tr_click].HostIP;
				var HostName = recent_re.data[tr_click].HostName;
			}
		}
		remark_json.PlanId = planid;
		remark_json.UserCode = window.parent.parent.frm.us.value;
		remark_json.HostIP = ip;
		remark_json.HostName = HostName;
		if (type == 1){
			var remark_v = $("#remark_input").val();
			if (remark_v == ""){
				remark_flag = 1;
				_alert(1,"最近访问","备注不能为空",$("#remark_input"));
				return false;
			}
			remark_json.PlanMsg = remark_v;
		}else{
			var remark_v = $("#operation_content").val();
			if (remark_v == ""){
				remark_flag = 1;
				_alert(1,"最近访问","备注不能为空",$("#operation_content"));
				return false;
			}
			remark_json.PlanMsg = remark_v;
		}
		//remark_json.PlanMsg = $("#operation_content").val();
		var msstr = aceg(JSON.stringify(remark_json),se);
		$.ajax({
			url:'/bhost/save_remark',
			type:'post',
			async:false,
			data:{a0:se,z1:JSON.stringify(remark_json),m1:msstr},
			success:function(result){
				var remark_re = JSON.parse(result);
				if (remark_re.Result){
					_alert(0,"备注","提交成功");
					remark_flag = 0;
				}else{
					_alert(0,"备注","提交失败");
					remark_flag = 1;
				}
			}
		})
	}
	
	var planid = 0;
	function get_plan(hostip,type){
		$.ajax({
			url:'/bhost/get_plan',
			type:'post',
			async:false,
			data:{a0:se,z1:hostip},
			success:function(result){
				var plan_result = JSON.parse(result);
				if (plan_result.data.length != 0){
					$("#operation_content").val(plan_result.data[0].PlanMsg);
					$("#remark_input").val(plan_result.data[0].PlanMsg);
					planid = plan_result.data[0].PlanId;
				}else{
					if (type == 0){
						$("#operation_content").val('');
						$("#remark_input").val('');
					}
					planid = 0;
				}
			}
		})
	}
	
	var conn_array = [];
	function change_pro(obj){
		if (clear_pro == 1){
			$("#protocolLink").find('input[type=text]').val('').prop('disabled',false);
			$("#protocolLink").find('input[type=checkbox]').iCheck('uncheck');
			$("#protocolLink").find('input[type=checkbox]').iCheck('uncheck');
			$("#protocolLink").find('select').prop('disabled',false);
			$("#protocolLink").find('select').each(function(){
				$(this).children('option:first').prop('selected',true).trigger('change');
			});
			clear_pro = 0;
		}
		//clear_link();
		var flag = 0;
		var type = $('#pro_select_div').find('span').text();
		var sel_id = $('#pro_select_div').data('value');
		
		//var type = $(obj).children('option:selected').text();
		//var sel_id = $(obj).val();
		$.each(pro_result.data,function(i,item){
			if (sel_id == item.ProtocolId){
				$("#port_input").val(item.Port);
			}
		});
		$('.pl-c').children('div').not(".ip_div,.user_div,.pwd_div,.pro_div").hide();
		// $(".remark").show();
		if($(".pwd_check_div").is(":visible")){
			$("#Get_attrs").hide();
		}else{
			if($('.pl-tit').find('span').text() == '快速连接'){
				$("#Get_attrs").show();
			}else{
				$("#Get_attrs").hide();
			}
		}
		
		if (global_data.IfGiveAccessInfo && quick_link == 1){	
			$(".remark").show();
		}else{
			$(".remark").hide();
		}
		
		if (global_data.IsTunnel){
			$(".passageway").hide();
		}else{
			if (type == "SYBASE" && $(".local_client").find('input').prop('checked')){
				$("#passageway_select").empty().append('<option value="2">访问通道</option>');
			}else{
				$("#passageway_select").empty().append('<option value="1">端口访问</option>');
			}
			//$(".passageway").show();
		}
		var acc_client_data;
		$.ajax({  
			url:'/bhost/get_acc_client_list',
			type:"post",
			async:false,
			data:{a0:se,z4:"null",z5:"null",z6:'[]'},
			success:function(result){
				acc_client_data = JSON.parse(result);
			}
		});
		//获取连接参数
		var connparm_list;
		$.ajax({
			url:'/bhost/get_ConnParam_list',
			type: "post",
			async:false,
			cache:false,
			data: {a0:se,a1:sel_id},
			success: function(Result){
				connparm_list = JSON.parse(Result);
			}
		});
		if(quick_link == 1){
			connparm_list = [];
		}
		$('.pwd_div').attr('style',"width: 222px;float: left;");
		$('.pwd_div').find('input').attr('style',"width: 122px;");
		$("#ApplicationChannel").parents('label').hide();
		var default_proto = 0;
		switch (type){
			case "OTHER":
				break;
			case "PCANY":
			case "APPROVAL":
			case "SYBASE":
			case "DB2":
			case "MSSQL":
			case "MYSQL":
			case "ORACLE":
			case "RADMIN":
				$(".pwd_div").show();
				$(".linkmode_div").show();
				$(".mfs_div").show();
				$(".screen_div").show();
				$("#ApplicationChannel").parents('label').hide();
				$(".mfs_divall").show();
				$(".mfs").show();
				$("#EnableCFG").iCheck('uncheck');
				//$("#EnableCFG").iCheck('check');
				$("#EnableRDPClipboard").parents('label').show();
				var option_str = "";
				flag = 0;
				if (type == "APPROVAL"){
					flag = 1;
					option_str = '<option value="0">无</option>';
				}else{
					$.each(acc_client_data.data,function(i,item){
						if (item.ProtocolName == type){
							option_str = option_str + '<option value="'+item.ClientName+'">'+item.ClientName+'</option>';
						}
					});
				}
				if (option_str == ""){
					flag = 1;
					option_str = '<option value="0">无</option>';
				}
				$("#sel_mfs").empty().append(option_str);
				if (flag == 0){
					$("#sel_mfs").select2();
				}
				
				if (type == "SYBASE"){
					$(".sysbase").show();
					$(".local_client").show();
					$(".local_client").find('input').iCheck('uncheck');
					$(".local_client").find('input').iCheck('check');
					$(".web_con").hide();
					$(".conn").show();
					$(".item.mfs_div").hide();
					$(".screen_div").hide();					
					$('#EnableRDPDiskMap').parents('label:first').show();
					if ($("#EnableRDPDiskMap").prop('checked')){
						$('.disk_map').show();
					}
					option_str = "<option value=\"-1\">用户填写</option>";
					conn_array = [];
					$.each(connparm_list.data,function(i,item){
						conn_array.push(item);
						option_str = option_str + '<option value="'+i+'" text="'+item.ConnParamName+'">'+item.ConnParamName+'</option>';
					});
					$("#conn_select").empty().append(option_str);
					if (option_str != "<option value=\"-1\">用户填写</option>"){
						$("#conn_select").select2();
					}
					$("#conn_select").unbind().bind('change',function(){
						var conn_index = $("#conn_select").val();
						var conn_text = $("#conn_select").children('option:selected').text();
						$("#conn_select").next().find('.select2-selection__rendered').text(conn_text).attr('title',conn_text);
						if (conn_index == -1){
							$("#sysbase_input").val('');
						}else{
							$("#sysbase_input").val(conn_array[conn_index].ServiceName);
						}
					});
					$("#conn_select").trigger('change');
				}else if (type == "DB2"){
					$(".conn").show();
					$(".db2").show();
					$(".local_client").show();
					$(".local_client").find('input').iCheck('uncheck');
					$(".local_client").find('input').iCheck('check');
					$(".mfs_div").hide();
					$(".item.mfs_div").hide();
					$(".screen_div").hide();					
					$(".web_con").hide();
					$('#EnableRDPDiskMap').parents('label:first').show();
					if ($("#EnableRDPDiskMap").prop('checked')){
						$('.disk_map').show();
					}
					option_str = "<option value=\"-1\">用户填写</option>";
					conn_array = [];
					$.each(connparm_list.data,function(i,item){
						conn_array.push(item);
						option_str = option_str + '<option value="'+i+'" text="'+item.ConnParamName+'">'+item.ConnParamName+'</option>';
					});
					$("#conn_select").empty().append(option_str);
					if (option_str != "<option value=\"-1\">用户填写</option>"){
						$("#conn_select").select2();
					}
					$("#conn_select").unbind().bind('change',function(){
						var conn_index = $("#conn_select").val();
						var conn_text = $("#conn_select").children('option:selected').text();
						$("#conn_select").next().find('.select2-selection__rendered').text(conn_text).attr('title',conn_text);
						if (conn_index == -1){
							$("#db2_input").val('');
						}else{
							$("#db2_input").val(conn_array[conn_index].ServiceName);
						}
					});
					$("#conn_select").trigger('change');
				}else if (type == "MSSQL"){
					$(".conn").show();
					$(".mssql").show();
					$(".local_client").hide();
					$(".web_con").hide();
					$("#EnableRDPDiskMap").parents('label').show();
					if ($("#EnableRDPDiskMap").prop('checked')){
						$('.disk_map').show();
					}
					option_str = "<option value=\"-1\">用户填写</option>";
					conn_array = [];
					$.each(connparm_list.data,function(i,item){
						conn_array.push(item);
						option_str = option_str + '<option value="'+i+'" text="'+item.ConnParamName+'">'+item.ConnParamName+'</option>';
					});
					$("#conn_select").empty().append(option_str);
					if (option_str != "<option value=\"-1\">用户填写</option>"){
						$("#conn_select").select2();
					}
					$("#conn_select").unbind().bind('change',function(){
						var conn_index = $("#conn_select").val();
						var conn_text = $("#conn_select").children('option:selected').text();
						$("#conn_select").next().find('.select2-selection__rendered').text(conn_text).attr('title',conn_text);
						if (conn_index == -1){
							$(".mssql").find('input:first').val('');
							$("#mssql_auth").val('SQL服务器验证').trigger('change');
						}else{
							$(".mssql").find('input:first').val(conn_array[conn_index].ServiceName);
							if (conn_array[conn_index].ConnType != null){
								$("#mssql_auth").val(conn_array[conn_index].ConnType).trigger('change');
							}else{
								$("#mssql_auth").val('SQL服务器验证').trigger('change');
							}
						}
					});
					$("#conn_select").trigger('change');
					
				}else if (type == "MYSQL"){
					$(".conn").show();
					$(".mysql").show();
					$(".mfs_divall").show();
					$(".mfs").show();
					$(".local_client").show();
					$(".local_client").find('input').iCheck('uncheck');
					$(".local_client").find('input').iCheck('check');
					$('.web_con').hide();
					$(".item.mfs_div").hide();
					$(".screen_div").hide();					
					$("#EnableRDPDiskMap").parents('label').show();
					if ($("#EnableRDPDiskMap").prop('checked')){
						$('.disk_map').show();
					}
					option_str = "<option value=\"-1\">用户填写</option>";
					conn_array = [];
					$.each(connparm_list.data,function(i,item){
						conn_array.push(item);
						option_str = option_str + '<option value="'+i+'" text="'+item.ConnParamName+'">'+item.ConnParamName+'</option>';
					});
					$("#conn_select").empty().append(option_str);
					if (option_str != "<option value=\"-1\">用户填写</option>"){
						$("#conn_select").select2();
					}
					$("#conn_select").unbind().bind('change',function(){
						var conn_index = $("#conn_select").val();
						var conn_text = $("#conn_select").children('option:selected').text();
						$("#conn_select").next().find('.select2-selection__rendered').text(conn_text).attr('title',conn_text);
						if (conn_index == -1){
							$(".mysql").find('input:first').val('');
							$("#mysql_version").val('0').trigger('change');
						}else{
							$(".mysql").find('input:first').val(conn_array[conn_index].ServiceName);
							$("#mysql_version").val(conn_array[conn_index].ConnType).trigger('change');
						}
					});
					$("#conn_select").trigger('change');
					
				}else if (type == "RADMIN" || type == "PCANY"){
					$(".local_client").hide();
					$(".web_con").hide();
					$('#EnableRDPDiskMap').parents('label:first').show();
					if ($("#EnableRDPDiskMap").prop('checked')){
						$('.disk_map').show();
					}
					if (type == "RADMIN"){
						$(".radmin").show();
						$(".conn").show();
						option_str = "<option value=\"-1\">用户填写</option>";
						conn_array = [];
						$.each(connparm_list.data,function(i,item){
							conn_array.push(item);
							option_str = option_str + '<option value="'+i+'" text="'+item.ConnParamName+'">'+item.ConnParamName+'</option>';
						});
						$("#conn_select").empty().append(option_str);
						if (option_str != "<option value=\"-1\">用户填写</option>"){
							$("#conn_select").select2();
						}
						$("#conn_select").unbind().bind('change',function(){
							var conn_index = $("#conn_select").val();
							var conn_text = $("#conn_select").children('option:selected').text();
							$("#conn_select").next().find('.select2-selection__rendered').text(conn_text).attr('title',conn_text);
							if (conn_index == -1){
								$("#radmin_auth_select").val('RADMIN').trigger('change');
							}else{
								if (conn_array[conn_index].ConnType != null){
									$("#radmin_auth_select").val(conn_array[conn_index].ConnType).trigger('change');
								}else{
									$("#radmin_auth_select").val('RADMIN').trigger('change');
								}
							}
						});
						$("#conn_select").trigger('change');
					}
				}else if (type == "ORACLE"){
					$(".conn").show();
					$(".local_client").show();
					$(".local_client").find('input').iCheck('uncheck');
					$(".local_client").find('input').iCheck('check');
					$(".web_con").hide();
					$(".screen_div").hide();
					$(".oracle").show();
					$("#EnableRDPDiskMap").parents('label').show();
					if ($("#EnableRDPDiskMap").prop('checked')){
						$('.disk_map').show();
					}
					option_str = "<option value=\"-1\">用户填写</option>";
					conn_array = [];
					$.each(connparm_list.data,function(i,item){
						conn_array.push(item);
						option_str = option_str + '<option value="'+i+'" text="'+item.ConnParamName+'">'+item.ConnParamName+'</option>';
					});
					$("#conn_select").empty().append(option_str);
					if (option_str != "<option value=\"-1\">用户填写</option>"){
						$("#conn_select").select2();
					}
					$("#conn_select").unbind().bind('change',function(){
						var conn_index = $("#conn_select").val();
						var conn_text = $("#conn_select").children('option:selected').text();
						$("#conn_select").next().find('.select2-selection__rendered').text(conn_text).attr('title',conn_text);
						if (conn_index == -1){
							$("#appoint").val('SID').trigger('change');
							$("#oracle_input").val('');
							$("#oracle_auth_select").val('NORMAL').trigger('change');
						}else{
							$("#appoint").val(conn_array[conn_index].ConnParamValue).trigger('change');
							$("#oracle_input").val(conn_array[conn_index].ServiceName);
							if (conn_array[conn_index].ConnType != null){
								$("#oracle_auth_select").val(conn_array[conn_index].ConnType).trigger('change');
							}else{
								$("#oracle_auth_select").val('NORMAL').trigger('change');
							}
						}
					});
					$("#conn_select").trigger('change');
				}else{
					$(".local_client").show();
					$(".local_client").find('input').iCheck('uncheck');
					$(".local_client").find('input').iCheck('check');
					$(".web_con").hide();
				}
				//$(".mfs").find('input').iCheck('check');
				break;
			case "VNC":
				$(".pwd_div").show();
				$(".linkmode_div").show();
				$(".local_client").show();
				$(".local_client").find('input').iCheck('uncheck');
				$(".local_client").find('input').iCheck('check');
				$(".web_con").show();
				//$(".mfs").hide();
				$(".mfs_divall").show();
				$(".mfs").show();
				$(".screen_div").show();
				$("#EnableRDPClipboard").parents('label').show();
				$("#ApplicationChannel").parents('label').hide();
				$("#EnableRDPDiskMap").parents('label').hide();
				option_str = "";
				flag = 0;
				$.each(acc_client_data.data,function(i,item){
					if (item.ProtocolName == type){
						option_str = option_str + '<option value="'+item.ClientName+'">'+item.ClientName+'</option>';
					}
				});
				if (option_str == ""){
					flag = 1;
					option_str = '<option value="0">无</option>';
				}
				$("#sel_mfs").empty().append(option_str);
				if (flag == 0){
					$("#sel_mfs").select2();
				}
				
				//$(".web_con").find('input').iCheck('uncheck');
				//$(".web_con").find('input').iCheck('check');
				break;
			case "RDP":
				$(".pwd_div").show();
				$(".sel_access").show();
				$(".linkmode_div").show();
				$(".mfs_divall").hide();
				$(".mfs").hide();
				$(".web_con").show();
				//$(".web_con").find('input').iCheck('uncheck');
				//$(".web_con").find('input').iCheck('check');
				$(".local_client").show();
				$(".screen_div").show();
				$(".conn").show();
				$("#EnableRDPClipboard").parents('label:first').show();
				$("#EnableRDPDiskMap").parents('label:first').show();
				$("#ApplicationChannel").parents('label:first').show();
				$(".local_client").find('input').iCheck('uncheck');
				$(".local_client").find('input').iCheck('check');

				var option_str = "<option value=\"-1\">用户填写</option>";
				conn_array = [];
				$.each(connparm_list.data,function(i,item){
					conn_array.push(item);
					option_str = option_str + '<option value="'+i+'" text="'+item.ConnParamName+'">'+item.ConnParamName+'</option>';
				});
				$("#conn_select").empty().append(option_str);
				if (option_str != "<option value=\"-1\">用户填写</option>"){
					$("#conn_select").select2();
				}
				$("#conn_select").unbind().bind('change',function(){
					var conn_index = $("#conn_select").val();
					var conn_text = $("#conn_select").children('option:selected').text();
					$("#conn_select").next().find('.select2-selection__rendered').text(conn_text).attr('title',conn_text);
					if (conn_index == -1){
						$("#access_select").empty().append('<option value="NORMAL">NORMAL</option><option value="CONSOLE">CONSOLE</option>');
					}else{
						$("#access_select").empty().append('<option value="'+conn_array[conn_index].ConnType+'">'+conn_array[conn_index].ConnType+'</option>');
					}
				});
				$("#conn_select").trigger('change');
				break;
			case "FTP":
			case "SFTP":
			case "TELNET":
			case "RLOGIN":
				$(".pwd_div").show();
				$(".linkmode_div").show();
				if (type == "FTP" || type == "SFTP"){
					$(".web_con").hide();
					//$(".local_client").find('input').iCheck('uncheck');
					//$(".local_client").find('input').iCheck('check');
					if (type == "SFTP"){
						bind_KeyName_xSelect();
						$(".pwd_div").hide();
						$(".auth_mode").show();
						$(".sel_key").hide();
						$("#Key_select").hide();
						$(".xSelect-key").hide();
						$("div[data-id=xSelect-key]").removeClass('on');
						$(".pwd_div").show();
						if($(".keyselect2").find('input').prop('checked')){	
							bind_KeyName_xSelect();
							$(".sel_key").show();
							$("#Key_select").show();
							$(".pwd_div").hide();
						}
						$(".sel_access").show();
						option_str = '<option value="2">SSH2</option><option value="1">SSH1</option>';
						$("#access_select").empty().append(option_str);
					}
				}else{
					$(".web_con").show();
					//$(".web_con").find('input').iCheck('uncheck');
					//$(".web_con").find('input').iCheck('check');
				}
				$(".local_client").show();
				$(".local_client").find('input').iCheck('uncheck');
				$(".local_client").find('input').iCheck('check');
				$(".mfs_divall").hide();
				$(".mfs").hide();
				break;
			case "SSH":	
				bind_KeyName_xSelect();
				$(".auth_mode").show();
				$(".sel_key").hide();
				$("#Key_select").hide();
				$(".xSelect-key").hide();
				$("div[data-id=xSelect-key]").removeClass('on');
				$(".pwd_div").show();
				if($(".keyselect2").find('input').prop('checked')){		
					bind_KeyName_xSelect();
					$(".sel_key").show();
					$("#Key_select").show();
					$(".pwd_div").hide();
				}
				$(".sel_access").show();
				$(".linkmode_div").show();
				$(".mfs_divall").hide();
				$(".mfs").hide();
				$(".local_client").show();
				$(".local_client").find('input').iCheck('uncheck');
				$(".local_client").find('input').iCheck('check');
				$(".web_con").show();
				//$(".web_con").find('input').iCheck('uncheck');
				//$(".web_con").find('input').iCheck('check');
				$(".conn").show();
				var option_str = "<option value=\"-1\">用户填写</option>";
				conn_array = [];
				$.each(connparm_list.data,function(i,item){
					conn_array.push(item);
					option_str = option_str + '<option value="'+i+'" text="'+item.ConnParamName+'">'+item.ConnParamName+'</option>';
				});
				$("#conn_select").empty().append(option_str);
				if (option_str != "<option value=\"-1\">用户填写</option>"){
					$("#conn_select").select2();
				}
				$("#conn_select").unbind().bind('change',function(){
					var conn_index = $("#conn_select").val();
					var conn_text = $("#conn_select").children('option:selected').text();
					$("#conn_select").next().find('.select2-selection__rendered').text(conn_text).attr('title',conn_text);
					if (conn_index == -1){
						$("#access_select").empty().append('<option value="2">SSH2</option><option value="1">SSH1</option>');
					}else{
						$("#access_select").empty().append('<option value="'+conn_array[conn_index].ServiceName+'">'+conn_array[conn_index].ServiceName+'</option>');
					}
				});
				$("#conn_select").trigger('change');
				//$("#access_select").empty().append('<option value="'+item.ServerName+'">'+item.ServerName+'</option>');
				break;
			case "NEW":
				break;
			case "HTTP(S)":
			case "HTTPS":
				$(".conn").show();
				$(".http").show();
				$(".pwd_div").show();
				$(".linkmode_div").show();
				$(".web_con").hide();
				$(".local_client").hide();
				$(".mfs_divall").show();
				$(".mfs").show();
				$("#EnableCFG").iCheck('uncheck');
				//$("#EnableCFG").iCheck('check');
				$(".item.linkmode_div").hide();
				$(".screen_div").show();
				$(".mfs_div").show();
				$("#EnableRDPDiskMap").parents('label').show();
				$("#ApplicationChannel").parents('label').hide();
				if ($("#EnableRDPDiskMap").prop('checked')){
					$('.disk_map').show();
				}
				var option_str = "";
				flag = 0;
				$.each(acc_client_data.data,function(i,item){
					if (item.ProtocolName == type){
						flag = 1;
						option_str = option_str + '<option value="'+item.ClientName+'">'+item.ClientName+'</option>';
					}
				});
				if (option_str == ""){
					option_str = '<option value="0">无</option>';
				}
				$("#sel_mfs").empty().append(option_str);
				if (flag == 1){
					$("#sel_mfs").select2();
				}
				
				//连接参数
				option_str = "<option value=\"-1\">用户填写</option>";
				conn_array = [];
				$.each(connparm_list.data,function(i,item){
					conn_array.push(item);
					option_str = option_str + '<option value="'+i+'" text="'+item.ConnParamName+'">'+item.ConnParamName+'</option>';
				});
				$("#conn_select").empty().append(option_str);
				if (option_str != "<option value=\"-1\">用户填写</option>"){
					$("#conn_select").select2();
				}
				$("#conn_select").unbind().bind('change',function(){
					var conn_index = $("#conn_select").val();
					var conn_text = $("#conn_select").children('option:selected').text();
					$("#conn_select").next().find('.select2-selection__rendered').text(conn_text).attr('title',conn_text);
					if (conn_index == -1){
						$('.http').find('input').val('');
					}else{
						var conn_value = conn_array[conn_index].ConnParamValue.split('|');
						$("#http_url").val(conn_array[conn_index].ServiceName).attr('disabled',true);
						$("#http_account").val(conn_value[0]).attr('disabled',true);
						$("#http_pwd").val(conn_value[1]).attr('disabled',true);
						$("#http_submit").val(conn_value[2]).attr('disabled',true);
					}
				});
				$("#conn_select").trigger('change');
				break;
			case "TN5250":
				$(".pwd_div").show();
				$(".linkmode_div").show();
				$(".web_con").show();
				$(".local_client").hide();
				$(".mfs_divall").hide();
				$(".mfs").hide();
				$(".web_con").find('input').iCheck('uncheck');
				$(".web_con").find('input').iCheck('check');
				break;
			case "X11":
				$(".pwd_div").show();
				$(".linkmode_div").show();
				$(".local_client").show();
				$(".local_client").find('input').iCheck('uncheck');
				$(".local_client").find('input').iCheck('check');
				$(".mfs_divall").hide();
				$(".mfs").hide();
				$("#EnableRDPClipboard").parents('label').show();
				$("#EnableRDPDiskMap").parents('label').hide();
				$("#ApplicationChannel").parents('label').hide();
				$(".screen_div").show();
				$(".web_con").show();
				//$(".web_con").find('input').iCheck('uncheck');
				//$(".web_con").find('input').iCheck('check');
				break;	
			default:
				$(".ip_div").show();
				$(".sel_user").show();
				$(".user_div").show();
				$(".pwd_div").show();
				//$(".pro_div").show();
				$(".linkmode_div").show();
				$(".local_client").show();
				$(".local_client").find('input').iCheck('uncheck');
				$(".local_client").find('input').iCheck('check');
				$(".web_con").hide();
				$(".mfs_divall").show();
				$(".mfs").show().attr('disabled',true);
				//$(".mfs").find('input').iCheck('check');
				$(".mfs_div").show();
				$(".screen_div").show();
				$("#EnableCFG").iCheck('check');
				$("#EnableCFG").attr('disabled',true);
				$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked disabled');
				$(".local_client").show();
				default_proto = 1;
				break;
		}
		if(quick_link == 1){
			if(default_proto == 0){
				$("#EnableCFG").iCheck('uncheck');
			}
			$(".item.conn").hide();
		}
		if($('.local_client').is(":visible") == false && $('.web_con').is(":visible") == false){
			$("#EnableCFG").iCheck('check');
			$("#EnableCFG").attr('disabled',true);
			$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked disabled');
			$(".linkmode_div").show();
			$(".local_client").show();
			$(".web_con").show();
		}else{
			if(default_proto == 0){
				$("#EnableCFG").attr('disabled',false);
				class_tmp = $("#EnableCFG").parent().attr('class');
				if(class_tmp.indexOf('checked') == -1){
					$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue');
				}else{
					$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked');
				}
			}
		}
		//$("#path_input").parents('div.item:first').show();
	}
	
	var recent_re;
	var HiddenFlag = true;
	function _initList(){
		var $tb = $('#fList').empty();
		var max_page = $("#page_total").text();
		var page = $("#curpage").val();
		var offset_num = (parseInt(page)-1)*parseInt(max_page);
		if(keyword_re == "" || keyword_re == null){
			keyword_re1 = [];
		}else{
			keyword_re1 = [];
			keyword_re1.push(keyword_re.replace(/\"/g,""));
		}
		$.ajax({
			url:'/bhost/PGet_RecentAccessHost',
			type:'post',
			async:false,
			data:{a0:se,z1:max_page,z2:offset_num,z3:JSON.stringify(keyword_re1)},
			success:function(result){
				recent_re = JSON.parse(result);
				if(recent_re.data.length == 0 && offset_num != 0){
					$("#curpage").val($("#curpage").val() - 1);
					_initList();
				}
				var tr_str = "";
				$.each(recent_re.data,function(i,item){
					if (item.DeviceTypeIcon == null){
						var DeviceType = "Server";
						var hostname = item.HostIP;
					}else{
						var DeviceType = item.DeviceTypeIcon;
						var hostname = item.HostName;
					}
					if (global_data.IfHiddenHostIP){
						HiddenFlag = true;
						tr_str = tr_str + "<tr><td class=\"in s-hide\"><input type=\"checkbox\" class=\"input_checkbox\" id=\"host_"+item.HostIP+"\" /></td>" + '<td title="'+DeviceType+'"><i class="host-type host-type'+json_icon[DeviceType]+'" /><span class="forip" title="'+hostname+'" hip="'+item.HostIP+'">'+hostname+'</span></td>';
					}else{
						HiddenFlag = false;
						tr_str = tr_str + "<tr><td class=\"in s-hide\"><input type=\"checkbox\" class=\"input_checkbox\" id=\"host_"+item.HostIP+"\" /></td>" + '<td title="'+DeviceType+'"><i class="host-type host-type'+json_icon[DeviceType]+'" /><span title="'+item.HostIP+'" class="forip" hip="'+item.HostIP+'">'+item.HostIP+'</span><span title="'+hostname+'"> - '+hostname+'</span></td>';
					}
					
					var proname_array = [];
					if (item.ProtocolNameSet != null){
						$.each(item.ProtocolNameSet.split(','),function(i1,item1){
							var item2 = item1+'#';
							proname_array.push(item2);
						})
						$.each(item.ProtocolNameSetAll,function(i1,item1){
							var repeat_flag = 0;
							var item2 = item1.ProtocolName+'#';
							$.each(proname_array,function(ii,itemi){
								if(itemi.indexOf(item2) > -1){
									repeat_flag = 1;
									if(itemi.split('#').length <= 2){
										item2 = item1.ProtocolName+'#'+item1.HostServiceName;
										proname_array.splice(ii,1,item2);
									}
									return false;
								}
							})
							if(repeat_flag == 0){
								item2 = item1.ProtocolName+'#'+item1.HostServiceName+'#';
								proname_array.push(item2);
							}
						})
					}else{
						proname_array = [];
					}
					////console.log(proname_array);
					tr_str = tr_str + '<td id="type" style="padding: 0 18px;white-space: normal;"><div style="max-width:364px">';
					$.each(proname_array,function(i1,item1){
						if (i1 < 6){
							var classtmp = 'prolink';
							if(item1.split('#')[2] != ""){
								classtmp = 'prolink bluecolor';
							}
							////console.log(item1);
							tr_str = tr_str + '<a style="width: 66px;text-align: center;text-overflow: ellipsis;overflow: hidden" title="'+item1+'" class="'+classtmp+'" href="javascript:;" onclick="_getProLink(this,\''+item.HostIP+'\',\''+item1.split('#')[0]+'\',\''+item1.split('#')[1]+'\')" ondblclick="_dblclick(this,\''+item.HostIP+'\',\''+item1.split('#')[0]+'\',\''+item1.split('#')[1]+'\');">'+item1.split('#')[0]+'</a>';
						}else if (i1 == 6){
							tr_str = tr_str + '<a style="margin-top: -45px;right: 20px;" class="morelink" href="javascript:;" onclick="_getAllProtocol(this,'+i+',\''+item.HostIP+'\')" title="全部协议">+</a></td>';
						}
					});
					tr_str = tr_str + '</div>';
					var Description = "";
					if (item.Description != null){
						Description = item.Description;
					}
					tr_str = tr_str + '<td title="'+Description+'">'+Description+'</td>';
					tr_str = tr_str + "<td id=\"on\"><div class=\"tab-ctr\" id=\"tab\"><a href=\"javascript:;\" title = \"删除\" class=\"del s-hide\" id=\"del\" onclick=\"_delete('"+item.HostIP+"')\"></a></div></div></td></tr>"
				});
				$tb.append(tr_str);
				$(".input_checkbox","#fList").iCheck({
					checkboxClass: 'icheckbox_minimal-blue',
					radioClass: 'iradio_minimal-blue',
					increaseArea: '0' // optional
				});
				$('#check_page').iCheck('uncheck');
				$("table tbody tr").children("td.in").children("div").children("input").iCheck('uncheck');				
				check_show();
				var page_total = $("#page_total").text();
				$("#host_total").text(recent_re.totalrow);
				var totalpage = Math.ceil(parseInt(recent_re.totalrow)/parseInt(page_total));
				if (totalpage < 1){
					totalpage = 1;
				}
				$("#totalpage").text(totalpage);
				_waitDone($(".waitTip"));
				//hoverbackcolor();
			}
		})
	}
	
	// function hoverbackcolor(){
	// 	$('.bluecolor').hover(function() {
	// 		$('.bluecolor').addClass('over');
	// 	}, function() {
	// 		$('.bluecolor').removeClass('over').addClass('out');
	// 	});
	// }
	var initwidth;
	function _width(){
			initwidth=$(".mainer").width();
	}
	
		//all protocol
	var tr_click;
	function _getAllProtocol(obj,i,ip){
		tr_click = i;
		var $_obj=$(obj);
		
		if($_obj.siblings().hasClass("active")){
			var aIndex=$("a.active").index();
		}
		var num = $("#active").parents("tr").index();
		if(num == i){
			aIndex=$("a.active").index();
			if($("#ProtocolWrap").attr("aIndex") !=undefined){
				aIndex = $("#ProtocolWrap").attr("aIndex");
			}
		}
		$(".layui-layer").removeClass("none").addClass("block");
		if($('#ProtocolWrap').length == 0){
				$('body').append('<div id="ProtocolWrap" />');
		}

		$('#ProtocolWrap').empty();
		var $pw = $('#ProtocolWrap');
		var proname_array = [];
		$.each(recent_re.data[i].ProtocolNameSet.split(','),function(i1,item1){
			var item2 = item1+'#';
			proname_array.push(item2);
		})
		$.each(recent_re.data[i].ProtocolNameSetAll,function(i1,item1){
			var repeat_flag = 0;
			var item2 = item1.ProtocolName+'#';
			$.each(proname_array,function(ii,itemi){
				if(itemi.indexOf(item2) > -1){
					repeat_flag = 1;
					if(itemi.split('#').length <= 2){
						item2 = item1.ProtocolName+'#'+item1.HostServiceName;
						proname_array.splice(ii,1,item2);
					}
					return false;
				}
			})
			if(repeat_flag == 0){
				item2 = item1.ProtocolName+'#'+item1.HostServiceName+'#';
				proname_array.push(item2);
			}

		})

		$.each(proname_array,function(i1,item1){
			var a_class = "";
			if(i1 == aIndex){
				a_class = 'active';
			}
			if(item1.split('#')[2] != ""){
				a_class += ' bluecolor';
			}
			$pw.append('<a style="width: 66px;text-align: center;text-overflow: ellipsis;overflow: hidden" title="'+item1+'" class="prolink '+a_class+'" href="javascript:;" onclick="_getProLink(this,\''+recent_re.data[i].HostIP+'\',\''+item1.split('#')[0]+'\',\''+item1.split('#')[1]+'\')" ondblclick="_dblclick(this,\''+recent_re.data[i].HostIP+'\',\''+item1.split('#')[0]+'\',\''+item1.split('#')[1]+'\');">'+item1.split('#')[0]+'</a>');
		});

		var offset = $(obj).parent().offset();
		var changewidth = $(".mainer").width();
		if(initwidth != changewidth){
			$(".layui-layer").css({"left":offset.left,"top":offset.top});
		}else if(initwidth == changewidth){
			$(".layui-layer").css({"left":offset.left,"top":offset.top});
		}
		prolayer = layer.open({
			type: 1,
			title: false,
			content: $pw,
			area: '340px',
			offset:[offset.top, offset.left],
			closeBtn: false,
			btn: false,
			shade: false,
			resize: false,
			move: false,
			anim: 5
		});
		
		$(document).unbind().on('click',function(e){
			var $a = $(e.target);
			var $p = $a.parents('#ProtocolWrap');
			var $pl = $a.parents("#protocolLink");
			var $tr= $("tr").eq(i+1);
			
			if($p.length == 0 && $a.attr('class') != 'morelink' && $a.attr('id') != 'ProtocolWrap' && $pl.length == 0){
				//layer.close(prolayer);
				layer.closeAll('page');
				if($("#ProtocolWrap").children("a.prolink").hasClass("active")){
					aIndex=$("a.active").index();
					var $moreLink=$tr.children("td#type").children("a.morelink");
					var $type=$tr.children("td#type").children("a.prolink");
					if(aIndex <= 5){
						$("a.morelink").removeAttr("id");
						$type.eq(aIndex).addClass("active");
						$moreLink.css({"background":"","border-color":"","color":""});
					}else{
						$moreLink.css({"background":"#3291a8","border-color":"#3291a8","color":"#fff"});
						$("a.morelink").removeAttr("id");
						$moreLink.attr("id","active");
						$pw.attr("aIndex",aIndex);
					}
				}
			}
		});
	}

	var LoadFlag = 0;
	function change_user(obj){
		//$('.pwd_check_div').find('input:last').val('');
		$(".item.pwd_div").find('input').val('');
		$(".item.pwd_div").find('input').prop("disabled",false);
		$("#EnableRDPDiskMap").parents('label').show();
		var acc_client_data;
		$.ajax({
			url:'/bhost/get_acc_client_list',
			type:"post",
			async:false,
			data:{a0:se,z4:"null",z5:"null",z6:'[]'},
			success:function(result){
				acc_client_data = JSON.parse(result);
			}
		});
		
		//获取连接参数
		var connparm_list;
		$.ajax({
			url:'/bhost/get_ConnParam_list',
			type: "post",
			async:false,
			cache:false,
			data: {a0:se,a1:selpro_id},
			success: function(Result){
				connparm_list = JSON.parse(Result);
			}
		});
		var user_name = $(obj).val();

		if (quick_link != 1){
			////console.log(service_re.data);
			////console.log(user_name);
			$.each(service_re.data,function(i,item){
				if(user_name == "任意账号"){
					user_name = "*";
				}
				if(item.ServerUser == "任意账号"){
					item.ServerUser = "*";
				}
				if (item.ServerUser == user_name){
					if (item.ServerUser == '*') {
						$('.user_div').show();
						$('.pwd_div').show();
						$('.pwd_check_div').hide();
						S_PWD = {
							pwd:"",
							enpwd:"",
							sshname:""
						};
						if (item.PasswordType == 0 || item.PasswordType == null){//需要输入密码
							$(".item.pwd_div").show();
							$(".item.sel_key").hide();
							$(".defined").hide();
							////console.log(item.Password)
							if (item.Password == null){
								$(".savepwd").hide();
								$(".custom").hide();
								$(".keyselect").hide();
								$('.pwd_check_div').hide();
								$('.pwd_div').show();
								////console.log("password is null");
							}else{
								var save_pwd = item.Password;
								$.ajax({
									url:'/bhost/rc4_decrypt',
									type:'post',
									async:false,
									data:{a0:se,z1:save_pwd},
									success:function(result){
										var result = JSON.parse(result.replace(/	/g,"\\t"));
										if (result.Result){
											save_pwd = result.info;
											save_pwd = save_pwd.replace(/	/g,"\\t")
										}else{
											_alert(1,"最近访问",result.info);
											return false;
										}
									}
								});
								if(save_pwd.length >= 9){ //保存的密钥
									if(save_pwd.substring(0,6) == "pkey\\t"){
										var sshkeyName = save_pwd.split("\\t")[2];
										var sshkeyId = "";
										$.ajax({
											url:'/bhost/Get_SshPrivateKey',
											type:'post',
											async:false,
											data:{a0:se,z1:null,z2:ip,z3:pro_name,z4:user.replace(/\\/g,"\\\\")},
											success:function(result){
												if(result==""){
													appdata = [{}];
												}else{
													appdata = JSON.parse(result);
												}
											}
										});
										$.each(appdata,function(i,item){
											if(item.KeyName == sshkeyName){
												sshkeyId = item.SshKeyId;
											}
										})
										$("#EnableKey").data('value',sshkeyId)
										$("#EnableKey").children("div").children("span").text(sshkeyName);
										S_PWD.sshname = sshkeyName;
									}
								}else{//保存的密码
									$(".pwd_div").find('input').val(save_pwd);
									S_PWD.pwd = save_pwd;
								}
							}
						}else if (item.PasswordType == 1 || item.PasswordType == 2){//有密码、空密码
							//$(".defined").show();
							//$(".custom").show();
							$(".item.pwd_div").show();
							$(".sel_key").hide();
							if (item.PasswordType == 1){

								defined_pwd = item.Password;
								$(".pwd_div").find('input').val(defined_pwd);
								$(".pwd_div").find('input').attr("disabled",true);
								S_PWD.enpwd = defined_pwd;
							}else{
								defined_pwd = "";
								$(".pwd_div").find('input').attr("disabled",true);
							}
						}else if (item.PasswordType == 3){//秘钥
							xSelect_width = 170;
							$('.item.sel_key').attr('style',"width: 100%;float: left;");
							$('#EnableKey').attr('style',"width: "+xSelect_width+"px;");
							bind_KeyName_xSelect(xSelect_width);
							$(".item.pwd_div").hide();
							$(".item.sel_key").show();
							$("#Key_select").show();
							var t_keyName = null;
							var t_sshKeyId = 0;
							$.each(appdata,function(i,item){
								if(item.Type == 1 && item.KeyName != null || item.KeyName != ""){
									t_keyName = item.KeyName;
									t_sshKeyId = item.SshKeyId;
									var sskey_name = "pkey\\t1\\t" + item.KeyName;
									$.ajax({
										url:'/bhost/rc4_encrypt',
										type:'post',
										async:false,
										data:{a0:se,z1:sskey_name},
										success:function(result){
											var result = JSON.parse(result);
											if (result.Result){
												sskey_name = result.info;
											}else{
												alert(1,"最近访问",result.info);
												return false;
											}
										}
									});
									defined_pwd = sskey_name;
									$("#EnableKey").data('value',t_sshKeyId);
									$("#EnableKey").children("div").children("span").text("默认");
									S_PWD.sshname = '默认';
									return false;
								}else{
									defined_pwd = "";
								}
							});
							if($("#EnableKey").children("div").children("span").text() != "默认"){
								if (item.Password == null){
									$(".savepwd").hide();
									//$(".custom").show();
								}else{
									var save_pwd = item.Password;
									$.ajax({
										url:'/bhost/rc4_decrypt',
										type:'post',
										async:false,
										data:{a0:se,z1:save_pwd},
										success:function(result){
											var result = JSON.parse(result.replace(/	/g,"\\t"));
											if (result.Result){
												save_pwd = result.info;
												save_pwd = save_pwd.replace(/	/g,"\\t")
											}else{
												_alert(1,"最近访问",result.info);
												return false;
											}
										}
									});
									if(save_pwd.length >= 9){
										if(save_pwd.substring(0,6) == "pkey\\t"){
											var sshkeyName = save_pwd.split("\\t")[2];
											var sshkeyId = "";
											if(sshkeyName != "="){
												$.each(appdata,function(i,item){
													if(item.KeyName == sshkeyName){
														sshkeyId = item.SshKeyId;
													}
												})
												$("#EnableKey").data('value',sshkeyId)
												$("#EnableKey").children("div").children("span").text(sshkeyName);
												S_PWD.sshname = sshkeyName;										
											}else{//存的是托管秘钥 ，托管秘钥删除之后 这里变成请选择
												$("#EnableKey").data('value',-1);
												$("#EnableKey").children("div").children("span").text('请选择');	
											}
										}
									}
								}
							}
						}
						if (global_data.IfGiveAccessInfo){
							$(".remark").show();
						}else{
							$(".remark").hide();
						}						
					}else{
						$('.user_div').hide();
						//console.log(item);
						get_strategy(prolink_ip,prolink_pro,item.ServerPort,item.ServerUser,item.ServiceName,i,item.ConnMode,item.Password,item.PasswordType);
					}
					
					var type = prolink_pro;
					$('.pwd_div').attr('style',"width: 260px;float: left;");
					$('.pwd_div').find('input').attr('style',"width: 160px;");
					$('.pwd_div').show();
					switch (type){
						case "OTHER":
							break;
						case "PCANY":
						case "APPROVAL":
						case "SYBASE":
						case "DB2":
						case "MSSQL":
						case "MYSQL":
						case "ORACLE":
						case "RADMIN":
							$(".linkmode_div").show();//连接模式
							$(".mfs_div").show();			//应用发布
							$(".screen_div").show();
							$("#ApplicationChannel").parents('label').hide();
							$(".mfs_divall").show();
							$(".mfs").show();	//连接模式：应用发布
							$("#EnableCFG").iCheck('uncheck');
							
							//$("#EnableCFG").iCheck('check');
							var option_str = "";
							flag = 0;
							if (type == "APPROVAL"){
								flag = 1;
								option_str = '<option value="0">无</option>';
							}else{
								$.each(acc_client_data.data,function(i,item){
									if (item.ProtocolName == type){
										option_str = option_str + '<option value="'+item.ClientName+'">'+item.ClientName+'</option>';
									}
								});
							}
							if (option_str == ""){
								flag = 1;
								option_str = '<option value="0">无</option>';
							}
							$("#sel_mfs").empty().append(option_str);
							if (flag == 0){
								$("#sel_mfs").select2();
							}
							
							if (type == "SYBASE"){
								$(".conn").show();
								$(".sysbase").show();
								$(".local_client").show();
								$(".local_client").find('input').iCheck('uncheck');
								$(".local_client").find('input').iCheck('check');
								$(".web_con").hide();
								bind_conn(connparm_list,type);
								if(item.ConnParamName!='' && item.ConnParamName!=null && item.ConnParamName!='用户填写'){
										if($("#conn_select").find("option[text='"+item.ConnParamName+"']").length != 0){
											$("#conn_select").val($("#conn_select").find("option[text='"+item.ConnParamName+"']").attr('value')).trigger('change');
										}else{
											$("#conn_select").val($("#conn_select").find("option").eq(0).attr('value')).trigger('change');
										}
									clear_conn();
								}else{
									clear_conn();
									$("#sysbase_input").val(item.ServiceName);
								}
							}
							else if (type == "DB2"){
								$(".conn").show();
								$(".db2").show();
								$(".local_client").show();
								$(".local_client").find('input').iCheck('uncheck');
								$(".local_client").find('input').iCheck('check');
								$(".web_con").hide();
								bind_conn(connparm_list,type);
								if(item.ConnParamName!='' && item.ConnParamName!=null && item.ConnParamName!='用户填写'){
									if($("#conn_select").find("option[text='"+item.ConnParamName+"']").length != 0){
										$("#conn_select").val($("#conn_select").find("option[text='"+item.ConnParamName+"']").attr('value')).trigger('change');
									}else{
										$("#conn_select").val($("#conn_select").find("option").eq(0).attr('value')).trigger('change');
									}
									clear_conn();
								}else{
									clear_conn();
									$("#db2_input").val(item.ServiceName);
								}
							}
							else if (type == "MSSQL"){
								$(".linkmode_div").hide();
								$(".conn").show();
								$(".mssql").show();
								$(".local_client").hide();
								$(".web_con").hide();
								$(".screen_div").show();
								bind_conn(connparm_list,type);
								if(item.ConnParamName!='' && item.ConnParamName!=null && item.ConnParamName!='用户填写'){
									if($("#conn_select").find("option[text='"+item.ConnParamName+"']").length != 0){
										$("#conn_select").val($("#conn_select").find("option[text='"+item.ConnParamName+"']").attr('value')).trigger('change');
									}else{
										$("#conn_select").val($("#conn_select").find("option").eq(0).attr('value')).trigger('change');
									}
									clear_conn();
								}else{
									clear_conn();
									$('.mssql:first').find('input').val(item.ServiceName);
								}
							}
							else if (type == "MYSQL"){
								$(".conn").show();
								$(".mysql").show();
								$(".mfs_divall").show();
								$(".mfs").show();
								$(".local_client").show();
								$(".local_client").find('input').iCheck('uncheck');
								$(".local_client").find('input').iCheck('check');
								$('.web_con').hide();
								bind_conn(connparm_list,type);
								if(item.ConnParamName!='' && item.ConnParamName!=null && item.ConnParamName!='用户填写'){
									if($("#conn_select").find("option[text='"+item.ConnParamName+"']").length != 0){
										$("#conn_select").val($("#conn_select").find("option[text='"+item.ConnParamName+"']").attr('value')).trigger('change');
									}else{
										$("#conn_select").val($("#conn_select").find("option").eq(0).attr('value')).trigger('change');
									}
									clear_conn();
								}else{
									clear_conn();
									$('.mysql').find('input').val(item.ServiceName);
								}
							}
							else if (type == "RADMIN" || type == "PCANY"){
								$(".linkmode_div").hide();
								$(".local_client").hide();
								$(".web_con").hide();
								bind_conn(connparm_list,type);
								
								if (type == "RADMIN"){
									$(".radmin").show();
									$(".conn").show();
									// $("#radmin_auth_select").val(item.ConnMode).trigger('change');
									if(item.ConnParamName!='' && item.ConnParamName!=null && item.ConnParamName!='用户填写'){
										if($("#conn_select").find("option[text='"+item.ConnParamName+"']").length != 0){
											$("#conn_select").val($("#conn_select").find("option[text='"+item.ConnParamName+"']").attr('value')).trigger('change');
										}else{
											$("#conn_select").val($("#conn_select").find("option").eq(0).attr('value')).trigger('change');
										}
										clear_conn();
									}else{
										clear_conn();
										$("#radmin_auth_select").val(item.ConnMode).trigger('change');
									}
								}
								
							}else if (type == "ORACLE"){
								$(".conn").show();
								$(".local_client").show();
								$(".local_client").find('input').iCheck('uncheck');
								$(".local_client").find('input').iCheck('check');
								$(".web_con").hide();
								$(".oracle").show();
								bind_conn(connparm_list,type);
								if(item.ConnParamName!='' && item.ConnParamName!=null && item.ConnParamName!='用户填写'){
									//if(obj_json.ServiceName == item.ServiceName){
									if($("#conn_select").find("option[text='"+item.ConnParamName+"']").length != 0){
										$("#conn_select").val($("#conn_select").find("option[text='"+item.ConnParamName+"']").attr('value')).trigger('change');
									}else{
										$("#conn_select").val($("#conn_select").find("option").eq(0).attr('value')).trigger('change');
									}
									clear_conn();
								}else{
									clear_conn();
									//console.log(item);
									$("#oracle_input").val(item.ServiceName);
									$("#appoint").val(item.ConnParam).trigger('change');
									if(item.ConnMode == null){
										$("#oracle_auth_select").val('NORMAL').trigger('change');
									}else{
										$("#oracle_auth_select").val(item.ConnMode).trigger('change');	
									}
								
								}
							}else{
								$(".local_client").show();
								$(".local_client").find('input').iCheck('uncheck');
								$(".local_client").find('input').iCheck('check');
								$(".web_con").hide();
							}
							//$(".mfs").find('input').iCheck('check');
							break;
						case "VNC":
							$(".linkmode_div").show();
							$(".local_client").show();
							$(".local_client").find('input').iCheck('uncheck');
							$(".local_client").find('input').iCheck('check');
							$(".web_con").show();
							$(".mfs_divall").show();
							$(".mfs").show();
							//$(".web_con").find('input').iCheck('uncheck');
							//$(".web_con").find('input').iCheck('check');
							$(".screen_div").show();
							$("#EnableRDPDiskMap").parents('label').hide();
							$("#ApplicationChannel").parents('label').hide();
							$(".disk_map").hide();
							$("#EnableRDPClipboard").parents('label').show();
							option_str = "";
							flag = 0;
							$.each(acc_client_data.data,function(i,item){
								if (item.ProtocolName == type){
									option_str = option_str + '<option value="'+item.ClientName+'">'+item.ClientName+'</option>';
								}
							});
							if (option_str == ""){
								falg = 1;
								option_str = '<option value="0">无</option>';
							}
							$("#sel_mfs").empty().append(option_str);
							if (flag == 0){
								$("#sel_mfs").select2();
							}
							break;
						case "RDP":
							$(".sel_access").show();
							$(".linkmode_div").show();
							$(".mfs_divall").hide();
							$(".mfs").hide();
							$(".web_con").show();
							$(".local_client").show();
							$(".local_client").find('input').iCheck('uncheck');
							$(".local_client").find('input').iCheck('check');
							$(".screen_div").show();
							
							$("#EnableRDPClipboard").parents('label:first').show();
							$("#EnableRDPDiskMap").parents('label:first').show();
							if (IsAcc == 2){
								$("#ApplicationChannel").parents('label').show();
							}
							$(".conn").hide();
							if (item.ConnMode != "" && item.ConnMode != null){
								$("#access_select").val(item.ConnMode).trigger('change');
							}
							bind_conn(connparm_list,type);
							break;
						case "FTP":
						case "SFTP":
						case "TELNET":
						case "RLOGIN":
							$(".linkmode_div").show();
							if (type == "FTP" || type == "SFTP"){
								$(".web_con").hide();
								//$(".local_client").find('input').iCheck('uncheck');
								//$(".local_client").find('input').iCheck('check');
								if (type == "SFTP"){
									bind_KeyName_xSelect();
									$(".sel_access").show();
									option_str = '<option value="2">SSH2</option><option value="1">SSH1</option>';
									$("#access_select").empty().append(option_str);
									if (item.SSHType != null && item.SSHType != ""){
										$("#access_select").val(item.SSHType).trigger('change');
									}
								}
							}else{
								$(".web_con").show();
								//$(".web_con").find('input').iCheck('uncheck');
								//$(".web_con").find('input').iCheck('check');
							}
							$(".local_client").show();
							$(".local_client").find('input').iCheck('uncheck');
							$(".local_client").find('input').iCheck('check');
							$(".mfs_divall").hide();
							$(".mfs").hide();
							break;
						case "SSH":
							bind_KeyName_xSelect();
							$(".sel_access").show();
							$(".linkmode_div").show();
							$(".mfs_divall").hide();
							$(".mfs").hide();
							$(".local_client").show();
							$(".local_client").find('input').iCheck('uncheck');
							$(".local_client").find('input').iCheck('check');
							$(".web_con").show();
							//$(".web_con").find('input').iCheck('uncheck');
							//$(".web_con").find('input').iCheck('check');
							$(".conn").hide();
							if (item.SSHType != null && item.SSHType != ""){
								$("#access_select").val(item.SSHType).trigger('change');
							}
							bind_conn(connparm_list,type);
							break;
						case "NEW":
							break;
						case "HTTP(S)":
						case "HTTPS":
							$(".linkmode_div").hide();
							$(".web_con").hide();
							$(".local_client").hide();
							$(".mfs_divall").show();
							$(".mfs").show();
							$("#EnableCFG").iCheck('uncheck');
							//$("#EnableCFG").iCheck('check');
							$(".screen_div").show();
							$("#ApplicationChannel").parents('label').hide();
							$(".mfs_div").show();
							$(".http").show();
							$(".conn").show();
							var option_str = "";
							flag = 0;
							$.each(acc_client_data.data,function(i,item){
								if (item.ProtocolName == type){
									flag = 1;
									option_str = option_str + '<option value="'+item.ClientName+'">'+item.ClientName+'</option>';
								}
							});
							if (option_str == ""){
								option_str = '<option value="0">无</option>';
							}
							$("#sel_mfs").empty().append(option_str);
							if (flag == 1){
								$("#sel_mfs").select2();
							}
							bind_conn(connparm_list,type);
							var ConnMode = item.ConnMode;
							if (ConnMode != null && ConnMode != ""){
								ConnMode = ConnMode.split('|');
								if(item.ConnParamName!='' && item.ConnParamName!=null && item.ConnParamName!='用户填写'){
									if($("#conn_select").find("option[text='"+item.ConnParamName+"']").length != 0){
										$("#conn_select").val($("#conn_select").find("option[text='"+item.ConnParamName+"']").attr('value')).trigger('change');
									}else{
										$("#conn_select").val($("#conn_select").find("option").eq(0).attr('value')).trigger('change');
									}
									clear_conn();
								}else{
									clear_conn();
									$("#http_url").val(item.ServiceName);
									$("#http_account").val(ConnMode[0]);
									$("#http_pwd").val(ConnMode[1]);
									$("#http_submit").val(ConnMode[2]);
								}
							}
							break;
						case "TN5250":
							$(".linkmode_div").show();
							$(".web_con").show();
							$(".local_client").hide();
							$(".mfs_divall").hide();
							$(".mfs").hide();
							$(".web_con").find('input').iCheck('uncheck');
							$(".web_con").find('input').iCheck('check');
							break;
						case "X11":
							$(".linkmode_div").show();
							$(".local_client").show();
							$(".local_client").find('input').iCheck('uncheck');
							$(".local_client").find('input').iCheck('check');
							$(".mfs_divall").hide();
							$(".mfs").hide();
							$(".web_con").show();
							//$(".web_con").find('input').iCheck('uncheck');
							//$(".web_con").find('input').iCheck('check');
							$(".screen_div").show();
							$("#ApplicationChannel").parents('label').hide();
							$("#EnableRDPClipboard").parents('label').hide();
							$("#EnableRDPDiskMap").parents('label').hide();
							$(".disk_map").hide();
							break;	
						default:
							$(".linkmode_div").hide();
							$(".mfs").show();
							$(".mfs_div").show();
							$(".mfs_divall").show();
							$("#EnableCFG").iCheck('check');
							$("#EnableCFG").attr('disabled',true);
							$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked disabled');
							break;
					}
					
					if(item.ConnModeName != null){
						$.each(item.ConnModeName.split('|'), function (i1, item1) {
							switch (item1) {
								case 'mfs':
									$("#EnableCFG").iCheck('uncheck');
									$("#EnableCFG").iCheck('check');
									if (item.ClientName == null || item.ClientName == "MSTSC") {
										$('#sel_mfs').val($('#sel_mfs').find('option').eq(0).val()).trigger('change');
									} else {
										$('#sel_mfs').val(item.ClientName).trigger('change');
									}
									break;
								default:
									break;
							}
						})
						$.each(item.ConnModeName.split('|'), function (i1, item1) {
							switch (item1) {
								case 'web_con':
									$(".web_con").find('input').iCheck('uncheck');
									$(".web_con").find('input').iCheck('check');
									break;
								case 'local_client':
									$(".web_con").find('input').iCheck('uncheck');
									$(".local_client").find('input').iCheck('check');
									if (type != 'RDP' && type != 'VNC' && type != 'X11') {
										$('#sel_client').val(item.ClientName).trigger('change');
									}
									break;
							}
						})	
					}
					/*
						防止 之前版本只选了应用发布 升级之后 回显后只勾选应用发布 而没选择Client或者web
					*/
					if($("#EnableCFG").is(":visible") && $("#EnableCFG").prop('checked') == true && $(".linkmode_div").is(":visible") == true){
						if($(".linkmode_div").children('.group').find('input:checked:visible').length == 0){
							$(".linkmode_div").children('.group').find('input:visible').parent().click();
						}
					}
					/*
					*/
					if($('.local_client').is(":visible") == false && $('.web_con').is(":visible") == false){
						$("#EnableCFG").iCheck('check');
						$("#EnableCFG").attr('disabled',true);
						$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked disabled');
						$(".linkmode_div").show();
						$(".web_con").show();
						$(".local_client").show();
					}else{
						$("#EnableCFG").attr('disabled',false);
						class_tmp = $("#EnableCFG").parent().attr('class');
						if(class_tmp.indexOf('checked') == -1){
							$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue');
						}else{
							$("#EnableCFG").parent().attr('class','icheckbox_minimal-blue checked');
						}
					}					
					// if(item.ConnWay!='' && item.ConnWay!=null){
					// 	$('#passageway_select').val(item.ConnWay).trigger('change');
					// }
					if(item.AppChannel== "true"){
						$("#ApplicationChannel").iCheck('check');
					}
					if(item.ExePath!='' && item.ExePath!=null && $("#ctl_sysbase_input").is(':visible')){
						$("#ctl_sysbase_input").val(item.ExePath);
					}else if(item.ExePath!='' && item.ExePath!=null && $("#ctl_input").is(':visible')){
						$("#ctl_input").val(item.ExePath);
					}
					if (item.RDPScreen != "" && item.RDPScreen != null){
						$("#screensize").val(item.RDPScreen).trigger('change');
					}
					if (item.RDPDiskMap == "true"){
						$("#EnableRDPDiskMap").iCheck('check');
					}else{
						$("#EnableRDPDiskMap").iCheck('uncheck');
					}
					if (item.RDPClipboard == "true"){
						$("#EnableRDPClipboard").iCheck('check');
					}
					var mapdisks = "";
					if (item.RDPDiskMapList != null && item.RDPDiskMapList != ""){
						mapdisks = item.RDPDiskMapList.split('|');
					}
					if (mapdisks != ""){
						$.each(mapdisks,function(i1,item1){
							var incheck=false;
							$('.disk_map').find('input').each(function(i2,item2){
								if ($(item2).parents('label:first').text() == item1){
									$(item2).iCheck('check');
									incheck=true;
									return false;
								}
							})
							// if (i1==(mapdisks.length-1) && !incheck && isMac){
							// 	$('.disk_map').find('input[type=text]').val(item1);
							// }
						})
					}else{
						$('.disk_map').find('input').each(function(i2,item2){
							$(item2).iCheck('uncheck');
						})
					}
					if($("#sel_client").is(":visible") == true){
						$("#sel_client").val($("#sel_client").children("option").val()).trigger('change');
					}
				}
			});
		}
		accountname = $("#user_select").val();
		if(accountname == "#"){
			$("#user_select").next().find("#select2-user_select-container").text(accountname).attr('title','单点登录账号');
		}else if(accountname == "-"){
			$("#user_select").next().find("#select2-user_select-container").text(accountname).attr('title','空账号');
		}else{
			$("#user_select").next().find("#select2-user_select-container").text(accountname).attr('title', accountname);
		}
		$('.pl-c').unbind();
	}

	function clear_conn(){
		return false;
		var id1 = $("#conn_select").val();
		var name1 = $("#conn_select").children('option:selected').text();
		var pid_tmp = $("#conn_select").children('option:selected').attr('pid');
		var option_str = '<option pid="'+pid_tmp+'" value="'+id1+'" text="'+name1+'">'+name1+'</option>';
		$("#conn_select").empty().append(option_str);
		$("#conn_select").val(id1).trigger('change');
	}
	var pro_array = ["SYBASE","DB2","MSSQL","MYSQL","ORACLE","HTTP(S)","HTTP"];
	function bind_conn(connparm_list,pro_name){
		if(connparm_list.data.length != 0){
			var option_str = "";
		}else{
			var option_str = "<option pid=\"0\" value=\"-1\">用户填写</option>";
		}
		conn_array = [];
		if(quick_link == 0){
			if(pro_array.indexOf(pro_name) > -1){
				var param_tmp = new Array();
				$.each(recent_reAll1.data,function(i,item){
					if(item.HostIP == ip_str){
						//console.log(item);
						$.each(item.ProtocolNameSetAll,function(i1,item1){
							if(item1.ProtocolName == pro_name){
								var tmp1 = "";
								if(pro_name == "HTTP(S)" || pro_name == "HTTP"){
									if(item1.HostServiceName.split("(").length == 3){
										tmp1 = item1.HostServiceName.split("(")[2].split(")")[0];
									}else{
										tmp1 = undefined;
									}
								}else{
									if(item1.HostServiceName.split("(").length == 2){
										tmp1 = item1.HostServiceName.split("(")[1].split(")")[0];
									}else{
										tmp1 = undefined;
									}
								}
								if(tmp1 != undefined){
									param_tmp.push(tmp1);
								}
							}
						})
					}
				})
			}
			//console.log(param_tmp);
			$.each(connparm_list.data,function(i,item){
				if(pro_array.indexOf(pro_name) > -1){
					if(param_tmp.indexOf(item.ConnParamName) > -1){
						conn_array.push(item);
						var b = conn_array.length - 1;
						option_str = option_str + '<option pid="'+item.ConnParamId+'" value="'+b+'" text="'+item.ConnParamName+'">'+item.ConnParamName+'</option>';
					}
				}else{
					conn_array.push(item);
					option_str = option_str + '<option pid="'+item.ConnParamId+'" value="'+i+'" text="'+item.ConnParamName+'">'+item.ConnParamName+'</option>';
				}
			});
		}
		if(option_str == ""){
			var option_str = "<option pid=\"0\" value=\"-1\">用户填写</option>";
		}
		$("#conn_select").empty().append(option_str);
		if (option_str != "<option pid=\"0\" value=\"-1\">用户填写</option>"){
			$("#conn_select").select2();
		}
		$("#conn_select").unbind().bind('change',function(){
			var conn_index = $("#conn_select").val();
			var conn_text = $("#conn_select").children('option:selected').text();
			$("#conn_select").next().find('.select2-selection__rendered').text(conn_text).attr('title',conn_text);
			switch (pro_name){
				case "SYBASE":
					if (conn_index == -1){
						$("#sysbase_input").val('');
					}else{
						$("#sysbase_input").val(conn_array[conn_index].ServiceName).attr('disabled',true);
					}
					break;
				case "DB2":
					if (conn_index == -1){
						$("#db2_input").val('');
					}else{
						$("#db2_input").val(conn_array[conn_index].ServiceName).attr('disabled',true);
					}
					break;
				case "MSSQL":
					if (conn_index == -1){
						$(".mssql").find('input:first').val('');
						$("#mssql_auth").val('SQL服务器验证').trigger('change');
					}else{
						$(".mssql").find('input:first').val(conn_array[conn_index].ServiceName).attr('disabled',true);
						if (conn_array[conn_index].ConnType != null){
							$("#mssql_auth").val(conn_array[conn_index].ConnType).trigger('change').attr('disabled',true);
						}else{
							$("#mssql_auth").val('SQL服务器验证').trigger('change').attr('disabled',false);
						}
					}
					break;
				case "RADMIN":
					if (conn_index == -1){
						$("#radmin_auth_select").val('RADMIN').trigger('change');
					}else{
						if (conn_array[conn_index].ConnType != null){
							$("#radmin_auth_select").val(conn_array[conn_index].ConnType).trigger('change').attr('disabled',true);
						}else{
							$("#radmin_auth_select").val('RADMIN').trigger('change').attr('disabled',false);
						}
					}
					break;
				case "MYSQL":
					if (conn_index == -1){
						$(".mysql").find('input:first').val('');
						$("#mysql_version").val('0').trigger('change');
					}else{
						if(conn_array.length != 0){
							$(".mysql").find('input:first').val(conn_array[conn_index].ServiceName).attr('disabled',true);
							$("#mysql_version").val(conn_array[conn_index].ConnType).trigger('change').attr('disabled',true);
						}
					}
					break;
				case "ORACLE":
					if (conn_index == -1){
						$("#appoint").val('SID').trigger('change');
						$("#oracle_input").val('');
						$("#oracle_auth_select").val('NORMAL').trigger('change');
					}else{
						//console.log(conn_array);
						$("#appoint").val(conn_array[conn_index].ConnParamValue).trigger('change').attr('disabled',true);
						$("#oracle_input").val(conn_array[conn_index].ServiceName).attr('disabled',true);
						if (conn_array[conn_index].ConnType != null){
							$("#oracle_auth_select").val(conn_array[conn_index].ConnType).trigger('change').attr('disabled',true);
						}else{
							$("#oracle_auth_select").val('NORMAL').trigger('change').attr('disabled',false);
						}
					}
					break;
				case "RDP":
					//if (conn_index == -1){
						$("#access_select").empty().append('<option value="NORMAL">NORMAL</option><option value="CONSOLE">CONSOLE</option>');
					// }else{
					// 	$("#access_select").empty().append('<option value="'+conn_array[conn_index].ConnType+'">'+conn_array[conn_index].ConnType+'</option>');
					// }
					break;
				case "SSH":
					//if (conn_index == -1){
						$("#access_select").empty().append('<option value="2">SSH2</option><option value="1">SSH1</option>');
					//}else{
					//	$("#access_select").empty().append('<option value="'+conn_array[conn_index].ServiceName+'">'+conn_array[conn_index].ServiceName+'</option>');
					//}
					
					break;
				case "HTTP(S)":
				case "HTTPS":
					if (conn_index == -1){
						$('.http').find('input').val('');
					}else{
						var conn_value = conn_array[conn_index].ConnParamValue.split('|');
						$("#http_url").val(conn_array[conn_index].ServiceName).attr('disabled',true);
						$("#http_account").val(conn_value[0]).attr('disabled',true);
						$("#http_pwd").val(conn_value[1]).attr('disabled',true);
						$("#http_submit").val(conn_value[2]).attr('disabled',true);
					}
					break;
				default:
					;
			}
		});
		$("#conn_select").trigger('change');
	}
	
	var IsAcc = 2;
	var S_PWD = {
		pwd:"",
		enpwd:"",
		sshname:""
	}
	var xSelect_width = 132;
	var obj_json;
	function get_strategy(ip,pro_name,port,user,servicename,index,ConnType,pwd,pwdType){
		S_PWD = {
			pwd:"",
			enpwd:"",
			sshname:""
		};
		obj_json = "";
		if(pro_name == "HTTP" || pro_name == "HTTP(S)"){
			ConnType = "";
		}
		$.ajax({
			url:"/bhost/Get_AuthObjectByInput",
			type:'post',
			async:true,
			data:{a0:se,z1:ip,z2:pro_name,z3:port,z4:user.replace(/\\/g,"\\\\"),z5:servicename,z6:ConnType},
			success:function(result){
				LoadFlag = 1;
				if (result != ""){
					obj_json = JSON.parse(result);
					strategy_array[index].push(obj_json);
					
					IsAcc = obj_json.IsAcc;
					if (IsAcc == 2){
						$("#ApplicationChannel").parents('label').show();
					}else{
						$("#ApplicationChannel").parents('label').hide();
					}
					//if(pro_name == "HTTP" || pro_name == "HTTP(S)"){
						pwdType = obj_json.PasswordType;
						pwd = obj_json.Password;
					//}
					if(user == "#"){
						pwdType = 1;
						pwd = obj_json.Password;
					}
					if (pwdType == 0 || pwdType == null){//需要输入密码
						$(".item.pwd_div").show();
						$(".item.sel_key").hide();
						$(".defined").hide();
						if (service_re.data[index].Pwd == null){
							$(".savepwd").hide();
							$(".custom").hide();
							$(".keyselect").hide();
							$('.pwd_check_div').hide();
							$('.pwd_div').show();
						}else{
							var save_pwd = service_re.data[index].Pwd;
							$.ajax({
								url:'/bhost/rc4_decrypt',
								type:'post',
								async:false,
								data:{a0:se,z1:save_pwd},
								success:function(result){
									var result = JSON.parse(result.replace(/	/g,"\\t"));
									if (result.Result){
										save_pwd = result.info;
										save_pwd = save_pwd.replace(/	/g,"\\t")
									}else{
										_alert(1,"最近访问",result.info);
										return false;
									}
								}
							});
							/*if(save_pwd.length >= 9){ //保存的密钥
								if(save_pwd.substring(0,6) == "pkey\\t"){
									var sshkeyName = save_pwd.split("\\t")[2];
									var sshkeyId = "";
									$.ajax({
										url:'/bhost/Get_SshPrivateKey',
										type:'post',
										async:false,
										data:{a0:se,z1:null,z2:ip,z3:pro_name,z4:user.replace(/\\/g,"\\\\")},
										success:function(result){
											if(result==""){
												appdata = [{}];
											}else{
												appdata = JSON.parse(result);
											}
										}
									});
									$.each(appdata,function(i,item){
										if(item.KeyName == sshkeyName){
											sshkeyId = item.SshKeyId;
										}
									})
									$("#EnableKey").data('value',sshkeyId)
									$("#EnableKey").children("div").children("span").text(sshkeyName);
									S_PWD.sshname = sshkeyName;
								}
							}else{//保存的密码*/
								$(".pwd_div").find('input').val(save_pwd);
								S_PWD.pwd = save_pwd;
							//}
						}
					}else if (pwdType == 1 || pwdType == 2){//有密码、空密码
						//$(".defined").show();
						//$(".custom").show();
						$(".item.pwd_div").show();
						$(".sel_key").hide();
						if (pwdType == 1){
							defined_pwd = pwd;
							$(".pwd_div").find('input').val(defined_pwd);
							$(".pwd_div").find('input').attr("disabled",true);
							S_PWD.enpwd = defined_pwd;
						}else{
							defined_pwd = "";
							$(".pwd_div").find('input').attr("disabled",true);
						}
					}else if (pwdType == 3){//秘钥
						xSelect_width = 170;
						$('.item.sel_key').attr('style',"width: 100%;float: left;");
						$('#EnableKey').attr('style',"width: "+xSelect_width+"px;");
						bind_KeyName_xSelect(xSelect_width);
						$(".item.pwd_div").hide();
						$(".item.sel_key").show();
						$("#Key_select").show();
						var t_keyName = null;
						var t_sshKeyId = 0;
						$.each(appdata,function(i,item){
							if(item.Type == 1 && (item.KeyName != null || item.KeyName != "")){
								t_keyName = item.KeyName;
								t_sshKeyId = item.SshKeyId;
								var sskey_name = "pkey\\t1\\t" + item.KeyName;
								// $.ajax({
								// 	url:'/bhost/rc4_decrypt',
								// 	type:'post',
								// 	async:false,
								// 	data:{a0:se,z1:sskey_name},
								// 	success:function(result){
								// 		var result = JSON.parse(result);
								// 		if (result.Result){
								// 			sskey_name = result.info;
								// 		}else{
								// 			alert(1,"最近访问",result.info);
								// 			return false;
								// 		}
								// 	}
								// });
								defined_pwd = sskey_name;
								$("#EnableKey").data('value',t_sshKeyId);
								$("#EnableKey").children("div").children("span").text("默认");
								S_PWD.sshname = '默认';
								return false;
							}else{
								defined_pwd = "";
							}
						});
						if($("#EnableKey").children("div").children("span").text() != "默认"){
							if (service_re.data[index].Pwd == null){
								$(".savepwd").hide();
								//$(".custom").show();
							}else{
								var save_pwd = service_re.data[index].Pwd;
								$.ajax({
									url:'/bhost/rc4_decrypt',
									type:'post',
									async:false,
									data:{a0:se,z1:save_pwd},
									success:function(result){
										var result = JSON.parse(result.replace(/	/g,"\\t"));
										if (result.Result){
											save_pwd = result.info;
											save_pwd = save_pwd.replace(/	/g,"\\t")
										}else{
											_alert(1,"最近访问",result.info);
											return false;
										}
									}
								});
								//if(save_pwd.length >= 9){
									if(save_pwd.substring(0,6) == "pkey\\t"){
										var sshkeyName = save_pwd.split("\\t")[2];
										var sshkeyId = "";
										if(sshkeyName != "="){
											$.each(appdata,function(i,item){
												if(item.KeyName == sshkeyName){
													sshkeyId = item.SshKeyId;
												}
											})
											$("#EnableKey").data('value',sshkeyId)
											$("#EnableKey").children("div").children("span").text(sshkeyName);
											S_PWD.sshname = sshkeyName;										
										}else{//存的是托管秘钥 ，托管秘钥删除之后 这里变成请选择
											$("#EnableKey").data('value',-1);
											$("#EnableKey").children("div").children("span").text('请选择');	
										}
									}
								//}
							}
						}
					}else{
					}
					if (global_data.IfGiveAccessInfo || obj_json.EnableAccessInfo){
						$(".remark").show();
					}else{
						$(".remark").hide();
					}					
				}else{
					//如果策略过不去的话 密码默认填上次配置密码（未完成）
				}
			}
		});
	}
	
		//get protocal
	var service_re;
	var ajax_over = 0;
	var prolink_pro;
	var prolink_ip;
	var selpro_id;
	var defined_pwd = "";
	var strategy_array = [];
	var S_PWD = {
		pwd:"",
		enpwd:"",
		sshname:""
	}
	var clickTimer = null;
	var ip_str = "";
	function _getProLink(obj,ip,pro_name,ser_name){
		$('#protocolLink').css('margin-top','-37px');
		ip_str = ip;
		layer.closeAll('page');
		if(clickTimer) {
			window.clearTimeout(clickTimer);
			clickTimer = null;
		}
		clickTimer = window.setTimeout(function(){
			quick_link = 0;
			prolink_pro = pro_name;
			prolink_ip = ip;
			IsAcc = 0;
			$("a.morelink").removeAttr("id");
			$moreLink=$("a.morelink");
			$moreLink.css({"background":"","border-color":"","color":""});
			
			//$("#user_select").unbind();
			$("#conn_select").unbind();
			$("#protocolLink").find('input[type=text]').val('').prop('disabled',false);
			$("#protocolLink").find('input[type=password]').val('').prop('disabled',false);
			//$("#protocolLink").find('input[type=checkbox]').not("#ApplicationChannel").iCheck('uncheck');
			$("#protocolLink").find('input[type=checkbox]').iCheck('uncheck');
			$("#protocolLink").find('select').prop('disabled',false);
			$("#protocolLink").find('select').not('#user_select,#conn_select').each(function(){
				$(this).children('option:first').prop('selected',true).trigger('change');
			});
			$('.pl-c').children('div').hide();
			//$(".pwd_check_div").show();
			$(".sel_user").show();
			$(".remark").show();
			// if($(".pwd_check_div").is(":visible")){
			 	$("#Get_attrs").hide();
			// }else{
			// 	$("#Get_attrs").show();
			// }
			get_plan(ip,0);
			
			if (global_data.IsTunnel){
				$(".passageway").hide();
			}else{
				if (pro_name == "SYBASE" && $(".local_client").find('input').prop('checked')){
					$("#passageway_select").empty().append('<option value="2">访问通道</option>');
				}else{
					$("#passageway_select").empty().append('<option value="1">端口访问</option>');
				}
				//$(".passageway").show();
			}

			var $p = $('#protocolLink');

			if($(obj).hasClass('active')){
				//
			}else{
				/*
				$('.pl-tit>span',$p).text(pro_name=="SFTP-SSH"?"SSH":pro_name);
				$('.pl-tit>i',$p).attr('class','icon-'+pro_name=="SFTP-SSH"?"SSH":pro_name);
				*/
				$('.pl-tit>span', $p).text($(obj).text());
				if(pro_name == "HTTP(S)"){
					pro_name_tmp = "HTTP";
				}else{
					pro_name_tmp = pro_name;
				}
				$('.pl-tit>i',$p).attr('class','icon-'+pro_name_tmp);
				$('a.prolink').removeClass('active');
				$(obj).addClass('active');
			}

			$p.addClass('show');
			ajax_over = 0;
			$.ajax({
				url:'/bhost/PGet_HostAccessCfg',
				type:'post',
				async:false,
				data:{a0:se,z1:ip,z2:pro_name},
				success:function(result){
					service_re = JSON.parse(result);
					var option_str = "";
					json1 = {"srcip":"192.168.0.123","hostip":ip,"HostServiceName":ser_name}
					$.ajax({
						url:'/bhost/PGet_RecentAccessHost',
						type:'post',
						async:false,
						data:{a0:se,z1:'null',z2:'null',z3:JSON.stringify(json1)},
						success:function(result){
							recent_reAll = JSON.parse(result);
							$.each(recent_reAll,function(i,item){
								var flag1 = true;
								$.each(service_re.data,function(i1,item1){
									if(item.AccountName == "*"){
										item.AccountName = "任意账号";
									}
									if(item1.ServerUser == item.AccountName){
										item1.PasswordType = item.PasswordType;
										item1.Password = item1.Pwd;
										flag1 = false;
										return false;
									}
								})
								////console.log(flag1);
								if(flag1 == false) return true;
								var json2 = {"ServerPort":"","ServerUser":"","ServiceName":"","ConnType":""}
								json2.ServerPort = item.Port;
								json2.ServerUser = item.AccountName;
								json2.ServiceName = item.ServiceName;
								json2.ConnMode = item.ConnType;
								json2.Password = item.Password;
								json2.PasswordType = item.PasswordType;
								json2.ConnParam = item.ConnParamValue;
								service_re.data.push(json2);
							})
						}
					})
					$.each(service_re.data,function(i,item){
						if (item.ServerUser == "" || item.ServerUser == null){
							var ServerUser = "-";
						}else{
							var ServerUser = item.ServerUser;
						}
						if(ServerUser == '*'){
							ServerUser = "任意账号";
						}
						option_str = option_str + '<option value="'+ServerUser+'">'+ServerUser+'</option>';
						strategy_array[i] = new Array();
					});
					//get_strategy(ip,pro_name,service_re.data[0].ServerPort,service_re.data[0].ServerUser,service_re.data[0].ServiceName,0);
					$("#user_select").empty().append(option_str);
					//var pro_name_temp = pro_name=="SFTP-SSH"?"SSH":pro_name;
					var pro_name_temp = pro_name;
					$.each(pro_result.data,function(i,item){
						if (pro_name_temp == item.ProtocolName){
							selpro_id = item.ProtocolId;
							return false;
						}
					});
					clickTimer1 = window.setTimeout(function(){					
						$("#user_select").trigger('change');
					},100)
					ajax_over = 1;
				}
			});
		}, 300);
	}

	function _dblclick(obj,ip,pro_name,sername){
		var time_tmp1;
		var timeoutFlag = 0;
		if(clickTimer) {
			window.clearTimeout(clickTimer);
			clickTimer = null;
		}
		_getProLink(obj,ip,pro_name,sername);
		LoadFlag = 0;
		function func1() {
			if(timeoutFlag >= 10){
				_alert(2, "最近访问", '系统超时');
				clearTimeout(time_tmp1);
				return false;
			}
			if(LoadFlag == 1){
				clearTimeout(time_tmp1);
				$("#connect").click();
			}else{
				t_get_msg3 = setTimeout(function(){
					timeoutFlag++;
					func1();
				},1000);
			}
		}
		func1();
	}

	function _setColl(obj,type,id){
		if($(obj).hasClass('on')){
			alert('取消收藏');
			$(obj).removeClass('on');
		}else{
			if($('#collLayer').length == 0){
				$('body').append('<div id="collLayer"><div class="cc"></div><div class="btns"><a href="javascript:;" class="btn btn-normal submit">确定</a><a href="javascript:;" class="btn btn-normal cancel">取消</a></div></div>');
			}

			var $c = $('#collLayer');
			var $cc = $('div.cc',$c);
			$cc.empty();

			$.each(collectionList,function(i,item){
				if(item.joined){
					$cc.append('<a href="javascript:;" class="collbtn on" title="'+item.name+'">'+item.name+'</a>');
				}else{
					$cc.append('<a href="javascript:;" class="collbtn" title="'+item.name+'">'+item.name+'</a>');
				}
			});

			$cc.append('<div class="add"><input type="text" name="" placeholder="新建收藏夹…" /><a href="javascript:;" class="i" onclick="_addNewColl(this)"><i /></a></div>');

			var collLayer = parent.layer.open({
				type: 1,
				title: '添加到目标收藏夹',
				content: $c,
				area:['678px','350px'],
				skin: 'layer-dialog2'
			});

			$('#collLayer').unbind('click').on('click','a.submit',function(){
				alert('确定');
				layer.close(collLayer);

				$(obj).addClass('on');
			}).on('click','a.cancel',function(){
				layer.close(collLayer);
			});
		}
	}

	function _addNewColl(obj){
		var v = $.trim( $(obj).prev().val());
		if(v != ''){
			var $new = $('<a href="javascript:;" class="collbtn" title="'+v+'">'+v+'</a>');
			$(obj).parent().before($new);
			$(obj).prev().val('');
		}
	}

	function _initEvent(){
		$('body').on('click','#collLayer a.collbtn',function(){
			var $this = $(this);
			if($this.hasClass('on')){
				$this.removeClass('on');
			}else{
				$this.addClass('on');
			}
		}).on('click','#RightTip',function(){
			if($('a.prolink.active').length == 1 || quick_link == 1){
				$('#protocolLink').addClass('show');
			}else{
				//_quickLink();
			}
		});
	}

	function _hideProt(obj){
		$('#protocolLink').removeClass('show');
		$("#RightTip").css({"cursor":"pointer"});
	}
	
	function clear_link(){
		$("#protocolLink").find('input[type=text]').val('').prop('disabled',false);
		$("#protocolLink").find('input[type=password]').val('').prop('disabled',false);
		//$("#protocolLink").find('input[type=checkbox]').not("#ApplicationChannel").iCheck('uncheck').iCheck('enable');
		$("#protocolLink").find('input[type=checkbox]').iCheck('uncheck');
		$("#protocolLink").find('select').prop('disabled',false);
		$("#protocolLink").find('select').each(function(){
			$(this).children('option:first').prop('selected',true).trigger('change');
		});	
	}
	
		//快速连接
	var quick_link = 0;
	var clear_pro = 0;
	function _quickLink(){
		quick_link = 1;
		ajax_over = 1;
		IsAcc = 2;
		xSelect_width = 132;
		$('.item.sel_key').attr('style',"width: 222px;float: left;");
		$('#EnableKey').attr('style',"width: "+xSelect_width+"px;");
		$("#RightTip").css({"cursor":"pointer"});
		var $p = $('#protocolLink');

		$('.pl-tit>span',$p).text('快速连接');
		$('.pl-tit>i',$p).attr('class','icon-quick');
		$p.addClass('show');
		$('a.prolink').removeClass('active');
		$('a.morelink').removeClass('active');
		$("a.morelink").removeAttr("id");
		$("a.morelink").css({"background":"","border-color":"","color":""});
		//$("#user_select").unbind();
		$("#conn_select").unbind();
		clear_link();
		$('.pl-c').children('div').hide();
		$(".ip_div").show();
		$(".user_div").show();
		$(".pwd_div").show();
		$(".pro_div").show();
		$(".linkmode_div").show();
		$(".local_client").hide();
		$(".web_con").hide();
		$(".mfs_divall").show();
		$(".mfs").show();
		$(".mfs").find('input').iCheck('check');
		$(".mfs_div").show();
		$(".screen_div").show();
		get_pro_v(1);
	}
	
	function changepage(type){
		var curpage = $("#curpage").val();
		var totalpage = $("#totalpage").text();
		select_save();
		if (curpage == ""){
			curpage = 1;
		}
		if (type == 1){
			if (curpage == 1){
				return false;
			}
			$("#curpage").val(1);
		}else if (type == 2){
			if (curpage != 1){
				$("#curpage").val(parseInt(curpage)-1);
			}else{
				return false;
			}
		}else if (type == 3){ //onchange
			var numReg = /\D/;
			if (numReg.test(curpage) || parseInt(curpage) < 1 || curpage == ''){
				$("#curpage").val(1);
			}else if (parseInt(curpage) > parseInt(totalpage)){
				$("#curpage").val(totalpage);
			}else{
				$("#curpage").val(curpage);
			}
		}else if (type == 4){
			if (parseInt(curpage) != parseInt(totalpage)){
				$("#curpage").val(parseInt(curpage)+1);
			}else{
				return false;
			}
		}else if (type == 5){
			if (totalpage != parseInt(curpage)){
				$("#curpage").val(totalpage);
			}else{
				return false;
			}
		}
		curpage = $("#curpage").val();
		totalpage = $("#totalpage").val();
		if (parseInt(curpage) != parseInt(totalpage)){
			$('#protocolLink').removeClass('show');
			if (quick_link == 1){
				$("#RightTip").css({"cursor":"pointer"});
			}
		}
		_initList();
		getAllData();
	}
	
	//搜索
	var manage_filter_flag = 0;
	var keyword_re = unescape("{{keyword}}");
	var filter_v = "";
	// 将实体转回为HTML
	function unescape(str) {
		var elem = document.createElement('div')
		elem.innerHTML = str
		return elem.innerText || elem.textContent
	}
	function _addFilter(obj,type){
		$('#protocolLink').removeClass('show');
		if (quick_link == 1){
			$("#RightTip").css({"cursor":"pointer"});
		}
		var add = 0;
		var keyword = $.trim( $("#keyword").val());
		
		$("#keyword").blur();
		
		var filter_sel = $("#find_select").val();
		var addfilter;
		if (filter_sel == "all"){
			addfilter = keyword;
			keyword_v = "all-" + keyword;
		}else if (filter_sel == "hostname"){
			addfilter = '主机名-' + keyword;
			keyword_v = 'hname-' + keyword;
		}else if (filter_sel == "hostip"){
			addfilter = '主机IP-' + keyword;
			keyword_v = 'IP-' + keyword;
		}else {
			addfilter = '协议-' + keyword;
			keyword_v = 'pname-' + keyword;
		}
		if (keyword == ""){
			$("#keyword").blur();
			_alert(2,"搜索","请输入关键字",$("#keyword"));
			return false;
		}
		$("#filterWW li").each(function(i,item){
			var filter = $(item).find('.ww').text();             
			if (filter == addfilter){
				add = 1;
				_alert(2,"搜索","相同的搜索条件已存在",$("#keyword"));
			}
		});
		if (type){
			if (add != 1){
				if (manage_filter_flag == 1){
					keyword_re.splice(-1,1);
					manage_filter_flag = 0;
				}
				$("#filterWW").show();
				$("#clearFilter").show();
				$("#filterWW ul").append("<li><span class=\"ww\" data-value=\""+keyword_v+"\">"+addfilter+"</span><i class=\"del\" onclick=\"_delFilter(this)\"></i></li>");
				keyword_re.push(keyword_v);
				filter_v = "";
				$("#v_clear").hide();
			}
			$("#keyword").val('');
		}else{

			if (manage_filter_flag == 1){
				keyword_re.splice(-1,1);
			}
			manage_filter_flag = 1;
			keyword_re.push(keyword_v);
			filter_v = keyword_v;
		}
		
		$("#curpage").val(1);
		_getWait($(".waitTip"));
			
		_initList();
		getAllData();
		$("#keyword").focus();
	}
	
	function _clearFilter(obj){
		$('#protocolLink').removeClass('show');
		if (quick_link == 1){
			$("#RightTip").css({"cursor":"pointer"});
		}
		$("#filterWW").children('ul').empty();
		$("#filterWW").hide();
		$("#clearFilter").hide();
		keyword_re = [];
		$("#keyword").val('');
		$('#v_clear').hide();
		manage_filter_flag = 0;
		filter_v = "";
		_initList();
		getAllData();
	}
	
	//移除搜索条件
	function _delFilter(obj){
		$('#protocolLink').removeClass('show');
		if (quick_link == 1){
			$("#RightTip").css({"cursor":"pointer"});
		}
		var filter_text = $(obj).parent().children('span').attr('data-value');
		$(obj).parent().remove();
		keyword_re.splice($.inArray(filter_text,keyword_re),1);
		if ($("#filterWW").children("ul").children('li').length == 0){
			$("#filterWW").hide();
			$("#clearFilter").hide();
		}
		_initList();
		getAllData();
	}
	
	function _clear_keyword(obj){
		$("#keyword").val("");
		$("#v_clear").hide();
		if (filter_v != ""){
			filter_v = "";
			manage_filter_flag = 0;
			keyword_re.splice(-1,1);
			_initList();
			getAllData();
		}
	}
	
	function change_input(obj){
		if ($(obj).val() == "" && filter_v != ""){
			filter_v = "";
			manage_filter_flag = 0;
			keyword_re.splice(-1,1);
			_initList();
			getAllData();
		}
	}
	
	function _getWait(obj) {
		if (typeof waitDonelayer != 'undefined') {
			layer.close(waitDonelayer);
		}

		$(obj).removeClass('done').show().unbind().on('mouseover', function () {
			waitlayer = layer.tips('搜索中', this, {
				tips: 1,
				time: 0,
				skin: 'waitlayer'
			});
		}).on('mouseout', function () {
			if (typeof waitlayer != 'undefined') {
				layer.close(waitlayer);
			}
		});
	}
	function _waitDone(obj) {
		if (typeof waitlayer != 'undefined') {
			layer.close(waitlayer);
		}
		$(obj).fadeOut(3000);
		if (typeof waitDonelayer != 'undefined') {
			layer.close(waitDonelayer);
		}
	}
	
	function up_filter(){
		if($('#keyword').val() != ''){
			$('#v_clear').show();
		}else{
			$('#v_clear').hide();
		};
	}
	
	function change_client(obj){
		if ($(obj).val() == "sqlldr"){
			$(".oracle_ctl").show();
		}else{
			$(".oracle_ctl").hide();
		}
		if($(obj).val() == "isqlw"){
			$(".sysbase_ctl").show();
		}else{
			$(".sysbase_ctl").hide();
		}
	}
	var client_ip_global = '';
	function client_module_show(client_v){
		$("#client_input").val('');
		$("#client_input").prev('label').find('select').val('0').trigger('change');
		var $dialogCont = $("#client_module").show();
		d = dialog({
			title:"客户端路径",
			content:$dialogCont,
			id:"client_module",
			width:"850px"
		});
		$("#client_module").find('span.form-tag').text(client_v+'：');
		function addEventListener(ele,event,fn){
			if(ele.addEventListener){
				ele.addEventListener(event,fn,false);
			}else{
				ele.attachEvent('on'+event,fn.bind(ele));
			}
		}
		addEventListener(d,'close',function () {
			$dialogCont.appendTo("body").hide();
		})
			//d.addEventListener('close', function () {
			//$dialogCont.appendTo("body").hide();
			// });
		d.showModal();
		$("a.btn-cancel",$dialogCont).unbind().bind("click",function(){
			d.close().remove();
		});
		$("a.btn-submit",$dialogCont).unbind().bind("click",function(){
			d.close().remove();
			var LocalClient_json = {
				"LocalClientId": 0,    
				"ProtocolName": null,
				"ClientName": null,        
				"ClientProgram": null,
				"ClientIP":null
			};
			if (quick_link == 1){
				var pro_name = $("#pro_select_div").find('span').text();
			}else{
				var pro_name = prolink_pro;
			}
			
			if (pro_name == "SSH" || pro_name == "RLOGIN" || pro_name == "TELNET"){
				pro_name = "SSH";
			}
			if(pro_name=='SFTP' ||pro_name=='FTP'){
				pro_name='FTP';
			}
			LocalClient_json.ProtocolName = pro_name;
			LocalClient_json.ClientName = $("#sel_client").val();
			LocalClient_json.ClientProgram = $("#client_input").val();
			if($('#client_input').prev('label').find('select').val() == 1) LocalClient_json.ClientIP=client_ip_global;
			var msstr = aceg(JSON.stringify(LocalClient_json),se);
			$.ajax({
				url: "/bhost/PSave_LocalClient",
				type:"POST",
				async:false,
				data:{a0:se,a1:JSON.stringify(LocalClient_json),m1:msstr}, 
				success:function(result){
					var result=JSON.parse(result);
					if(result.Result){
						$.ajax({
							url: "/bhost/PGet_LocalClient",
							type:"POST",
							async:false,
							data:{a0:se},
							success:function(result){
								var result=JSON.parse(result);
								if(result.Result){
									path_array = result.info.data;
									client_ip_global = result.client_ip_global;
									$(".local_client").find('input').iCheck('uncheck');
									$(".local_client").find('input').iCheck('check');
									$("#sel_client").val(LocalClient_json.ClientName).trigger('change');
									$("#connect").click();
								}else{
									_alert(2,'最近访问',result.ErrMsg);
									return false;
								}
							}
						});
					}else{
						_alert(2,'最近访问',result.ErrMsg);
						return false;
					}
				}
			});
		});
	}
	var default_flag = false;
	function bind_KeyName_xSelect(xSelect_width){
		if(xSelect_width == undefined){
			xSelect_width = 132;
		}
		var HostIP = $(".ip_div").find('input').val();
		var ProtocolName = $("#pro_select_div").find('span').text();
		var AccountName = $(".user_div").find('input').val();
		var ipReg = /(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;
		if (!ipReg.test(HostIP)){
			HostIP = null;
		}
		
		/*var HostIP = null;
		var ProtocolName = null;
		var AccountName = null;*/

		//判断是否点击连接
		if($(".sel_user").is(":visible")){
			HostIP = prolink_ip;
			ProtocolName = prolink_pro;
			AccountName = $("#user_select").val();
		}
		if(AccountName != null && AccountName != ""){
			AccountName = AccountName.replace(/\\/g,"\\\\");
		}
		/*if(ProtocolName != "SSH" && ProtocolName != "SFTP"){
			ProtocolName = null;
		}*/
		$.ajax({
			url:'/bhost/Get_SshPrivateKey',
			type:'post',
			async:false,
			data:{a0:se,z1:null,z2:HostIP,z3:ProtocolName,z4:AccountName},
			success:function(result){
				if(result==""){
					appdata = [{}];
				}else{
					appdata = JSON.parse(result);
				}
			}
		});
		var keyName_array = [];
		var key_array = [];
		var t_id = 0;
		$.each(appdata,function(i,item){
			var select_data_json = {
				'value':1,
				'name':'admin2',
				'type':'edit'
			};
			if(item.Type == 1){
				select_data_json.name = "默认";
				select_data_json.type = null;
				t_id = item.SshKeyId;
				default_flag = true;
			}else{
				select_data_json.name = item.KeyName;
			}
			select_data_json.value = item.SshKeyId;
			keyName_array.push(select_data_json);
			var key_attr = {
				"SshKeyId": 0,
				"KeyName": null,
				"KeyType": 1,
				"KeyContent": null,
				"IfValid": false,
				"Password":null
			};
			key_attr.SshKeyId = item.SshKeyId;
			key_attr.KeyName = item.KeyName;
			//key_attr.KeyType = item.KeyType;
			key_attr.KeyContent = item.KeyContent;
			key_attr.Password = item.Password;
			//key_attr.IfValid = item.IfValid;
			key_array.push(key_attr);
			if(default_flag == true){
				return false;
			}
		});
		var keyName_array2 = [];
		var key_array2 = [];
		//删除和默认的Id相等的Type为2的项目
		$.each(keyName_array,function(i,item){
			if(item.value != t_id || item.name == "默认"){
				keyName_array2.push(item)
			}
		});
		$.each(key_array,function(i,item){
			if(item.SshKeyId != t_id){
				key_array2.push(item)
			}
		});
		if(default_flag == true){
			btm_tmp = [];
		}else{
			btm_tmp = [
				{
					'name':'新增',
					'event': function(items,obj){
						$(obj).parents('.xSelect-view').hide();
						_editNode(obj,key_array2,2);
					}
				}
			]
		}
		$('#EnableKey').empty().data('xSelect',"");
		$('#EnableKey').xSelect({
			width: xSelect_width,
			defaultText: '请选择',
			items:keyName_array2,
			module_type:'key',
			edit: function(item,obj){
				$(obj).parents('.xSelect-view').hide();
				_editNode(obj,key_array2,1);
			},
			btn:btm_tmp
		});	
		$("div[data-id=xSelect-key]").attr('style','width: '+xSelect_width+'px;');
		if(t_id != 0){
			$("#EnableKey").data('value',t_id);
			$("#EnableKey").children("div").children("span").text("默认");
		}else{
			$("#EnableKey").data('value',0)		
		}
	}
	
	var SshKeyId = 0;
	var dialogCont = null;
	function _editNode(obj,key_array,type){
		SshKeyId = $(obj).children('span').data('value');
		var key_attr = {};
		for(i in key_array){
			if(key_array[i]['SshKeyId'] == SshKeyId){
				key_attr = key_array[i];
			}
		}
		var title = "最近访问";
		var $dialogCont = $("#EnableKey_suspend").show();
		
		var d = dialog({
			title:title,
			content:$dialogCont,
			id:"EnableKey_suspend",
			width:"800px"
		});
		dialogCont = d;
		
		function addEventListener(ele,event,fn){
			if(ele.addEventListener){
				ele.addEventListener(event,fn,false);
			}else{
				ele.attachEvent('on'+event,fn.bind(ele));
			}
		}
		addEventListener(d,'close',function () {
			$dialogCont.appendTo("body").hide();
		});
		
		//d.addEventListener('close', function () {
			//$dialogCont.appendTo("body").hide();
		//});
		d.showModal();
		if(type == 1){
			$('#d_n').val($(obj).children('span').text());
			$("#d_n").attr("disabled", true);
			$('#Protocol').val(key_attr['KeyType']); 
			if($('#Protocol').val() == '0'){
				$("#select2-Protocol-container").text('公钥');
				$("#select2-Protocol-container").attr('title','公钥');
			}else{
				$("#select2-Protocol-container").text('私钥');
				$("#select2-Protocol-container").attr('title','私钥');
			}
			/*if(key_attr['IfValid']){
				$('#Enable').iCheck('check');
			}else{
				$('#Enable').iCheck('uncheck');
			}*/
			$('#Password').val(key_attr['Password']);
			$('#Password_two').val(key_attr['Password']);
			$('#content').val(key_attr['KeyContent']);
		}else{
			$('#d_n').val('');
			$("#d_n").attr("disabled", false);
			$('#Protocol').val('1'); 
			//$('#Enable').iCheck('check');
			$('#content').val('');
			$('#Password').val('');
			$('#Password_two').val('');
		}
		
		/*$("a.btn-normal",$dialogCont).unbind().bind("click",function(){
			d.close().remove();
		});*/
	}
	
	var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
	
	var sshkey = {
		"SshKeyId": 0,
		"KeyName": null,
		"KeyType": 0,
		"KeyContent": null,
		"IfValid": false,
		"Password":null
	};
		
	//创建
	function connection_add() {
		var p_id = $("#Protocol").val();
		var val =$.trim(  $("#d_n").val());
		var $i = $("#d_n").next('i.v-check');
		//事件告警信息名
		if (val == "") {
			_alert(2, "最近访问", '请输入名称', $("#d_n"));
			return false;
		}
		if (!nameReg.test(val)) {
			_alert(1, "最近访问", '名称格式不正确', $("#d_n"));
			return false;
		}
		sshkey.KeyName = val;
		var Password=$.trim($('#Password').val());
		var Password_two=$.trim(  $('#Password_two').val());
		if(Password.length > 64){
			_alert(2, "最近访问", "密码不能超过系统限定64位", $("#Password"));
			return false;
		}
		if(Password==''){
			Password=null;
		}
		else if(Password!=Password_two){
			_alert(2, "最近访问","两次密码不匹配",$("#Password"));
			return false;
		}
		sshkey.Password=Password;
		var content = $("#content").val();
		var keycheck = /^[\u4e00-\u9fa5]*$/g;
		if(content==""){
			_alert(2, "最近访问", '请填写密钥内容', $("#content"));
			return false;
		}
		if(keycheck.test(content)){_alert(1, "最近访问", '密钥格式不正确', $("#content"));return}
		if($("#d_n").val().length>128) {
			_alert(1, "最近访问", '密钥名称长度不能超过128', $("#d_n"));
			return false;
		}
		/*if($("#Enable").is(':checked')){
			sshkey.IfValid = true;
		}else{
			sshkey.IfValid = false;
		}*/
		sshkey.KeyContent = content;
		sshkey.KeyType = parseInt(p_id);
		
		//判断是编辑还是创建
		if($("#d_n").attr("disabled")=='disabled'){
			sshkey.SshKeyId = SshKeyId;
			SshKeyId = 0;
		}
		msstr = aceg(JSON.stringify(sshkey),se);
		$.ajax({
			url: '/bhost/add_sshkey',
			type: "POST",
			async: false,
			data: { a0: se, a1: JSON.stringify(sshkey),m1:msstr},
			success: function (result) {
				var result = JSON.parse(result);
				if (result.Result == true) {
					$('.btn').blur(); 
					parent.layer.open({
						type: 1,
						title: '最近访问',
						content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
						btn: ['确&nbsp;&nbsp;定'],
						btnAlign: 'c',
						closeBtn: false,
						skin: 'layer-custom',
						area: ['380px', '300px'],
						move: false,
						resize: false,
						yes: function (i) {
							parent.parent.layer.close(i);
						}
					});
				} else {
					_alert(1, "最近访问", result.ErrMsg, $("#d_n"));
					return false;
				}
			}
		});	
		//如果无选项，则选中新建的选项，如果有则保持不变
		var spantext = $("#EnableKey").children("div").children("span").text();
		var EnableKeyValue = $("#EnableKey").data('value');
		bind_KeyName_xSelect();		
		if( EnableKeyValue == null || EnableKeyValue == undefined || EnableKeyValue == 0){
			$("#EnableKey").data('value',sshkey.SshKeyId)
			$("#EnableKey").children("div").children("span").text(sshkey.KeyName);
		}else{
			$("#EnableKey").data('value',EnableKeyValue)
			$("#EnableKey").children("div").children("span").text(spantext);			
		}
		dialogCont.close().remove();
	}
	var auto_password = null;
	var auto_password_type = null;
	//获取上次登录的密码或密钥
	function get_last_password(){
		var ServiceName = '';
		var ConnType = '';
		var hostip = $(".ip_div").find('input').val();
		var pro_name = $("#pro_select_div").find('span').text();
		var port = $("#port_input").val();
		var user = $(".user_div").find('input').val();
			
		switch (pro_name){
			case "SSH":
				ServiceName = $("#access_select").val();
				break;
			case "MYSQL":
				ServiceName = $('.mysql:eq(0)').find('input').val();
				break;
			case "MSSQL":
				ServiceName = $('.mssql:eq(0)').find('input').val();
				ConnType = $("#mssql_auth").val();
				break;
			case "ORACLE":
				ServiceName = $("#oracle_input").val();
				ConnType = $("#oracle_auth_select").val();
				break;
			case "HTTP(S)":
			case "HTTPS":
				ServiceName = $("#http_url").val();
				break;
			case "DB2":
				ServiceName = $("#db2_input").val();
				break;
			case "RADMIN":
				ConnType = $("#radmin_auth_select").val();
				break;
			case "RDP":
				ConnType = $("#access_select").val();
				break;
		}
		var ipReg = /(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;		
		if (hostip == ""){
			_alert(1,"最近访问","IP不能为空",$(".ip_div").find('input'));
			return false;
		}else if (!ipReg.test(hostip)){
			_alert(1,"最近访问","IP地址格式不正确",$(".ip_div").find('input'));
			return false;
		}
		if (user == ""){
				_alert(1,"最近访问","用户名不能为空",$(".user_div").find('input'));
				return false;
		}
		if (pro_name == ""){
			return false;
		}
		auto_password = null;
		$.ajax({
			url:"/bhost/Get_AuthObjectByInput",
			type:'post',
			async:false,
			data:{a0:se,z1:hostip,z2:pro_name,z3:port,z4:user.replace(/\\/g,"\\\\"),z5:ServiceName,z6:ConnType},
			success:function(result){
				if(result != ""){
					result1 = JSON.parse(result)
				}
				if (result == "" || result1 == false){
					_alert(1,"最近访问","搜索无结果",$(".pwd_div").find('input'));
					return false;
				}else{
					var obj_json = JSON.parse(result);
					if (obj_json.Password != null && obj_json.Password != ""){
						auto_password = obj_json.Password;
					}else{

					}				
					auto_password_type = obj_json.PasswordType;				
					if(!$(".pwd_check_div").is(":visible")&&(pro_name=='SSH'||pro_name=='SFTP')){
						if(obj_json.PasswordType == 3){
							$.ajax({
								url:'/bhost/Get_SshPrivateKey',
								type:'post',
								async:false,
								data:{a0:se,z1:null,z2:hostip,z3:pro_name,z4:user.replace(/\\/g,"\\\\")},
								success:function(result){
									if(result==""){
										appdata = [{}];
									}else{
										appdata = JSON.parse(result);
									}
								}
							});
							$.each(appdata,function(i,item){
								if(item.Type == 1 && item.KeyName != null && item.KeyName != ""){
									var sskey_name = "pkey"+"\\t"+"1"+"\\t" + item.KeyName;
									$.ajax({
										url:'/bhost/rc4_encrypt',
										type:'post',
										async:false,
										data:{a0:se,z1:sskey_name},
										success:function(result){
											var result = JSON.parse(result);
											if (result.Result){
												auto_password = result.info;
											}else{
												alert(1,"最近访问",result.info);
												return false;
											}
										}
									});
									$(".keyselect2").find('input').iCheck('check');
									$('.sel_key').show();
									$("#Key_select").show();
									$(".pwd_div").hide();
									//下拉框选择默认
									bind_KeyName_xSelect();
									$("#EnableKey").data('value',item.SshKeyId)
									$("#EnableKey").children("div").children("span").text('默认');
								}
							});
						}else{
							$(".pwdselect2").find('input').iCheck('check');
							$(".sel_key").hide();
							$("#Key_select").hide();
							$(".xSelect-key").hide();
							$("div[data-id=xSelect-key]").removeClass('on');
							$(".pwd_div").show();
							$(".pwd_div").find('input').val(auto_password);
						}
					}else{
						$(".pwd_div").find('input').val(auto_password);
					}
					if(auto_password == null || auto_password == ""){
						_alert(1,"最近访问","搜索无结果",$(".pwd_div").find('input'));
						return false;
					}
				}
			}
		});
	}
	
	function get_win_path(obj){
		sesstime = new Date().getTime();
		
		//{"Session":"1533965498777","ClientName":"xShell","BHostUrl":"https://192.168.0.167"}
		
		var sesstimet = (new Date()).valueOf() +1;
		
		cmd_json ={
			"ClientName":"xShell",
			"Session": ""+sesstime,//
			"BHostUrl":"https://"+document.domain+ (location.port!=''?':'+location.port:''),
			"sesstimet":sesstimet
		}
		
		var base64_str = '';
		$.ajax({
			url: "/bhost/get_base64",
			type:"POST",
			async:false,		
			data:{a0:se,z1:JSON.stringify(cmd_json)},
			success:function(result){
				var result=JSON.parse(result);
				if(result.Result){
					if_html_client = result.info;
					base64_str = result.b64;
				}else{
					_alert(1,"最近访问",result.ErrMsg);
				}
			}
		})
		
		
		//window.location.href = 'bhost://cmd&'+base64_str;
		
		
		get_regedit('bhost', se,'',sesstimet);
		$('#YuFrame1').remove();
		$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
		$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+base64_str);
		//插入数据库数据
		$.ajax({
			url: "/bhost/insert_usbkeys",
			type:"POST",
			async:false,		
			data:{a0:se,z1:sesstime,t1:"find_client_path",u1:' ',c1:' ',a10:"最近访问"},
			success:function(result){
				var result=JSON.parse(result);
				if(result.Result){
				}else{
					_alert(1,"最近访问",result.ErrMsg);
					return false;
				}
			}
		})
		
		//循环获取 数据库状态
		var c = 0;
		
		if_ok_down = setInterval(function(){
			ret = repeat_get_path(sesstime);
			
			if(ret[0] == 1){
				clearInterval(if_ok_down);
				$(obj).prev('input').val(ret[1]);
				return 0;				
			}
			if(ret[0] == 2){
				clearInterval(if_ok_down);
				_alert(1,"最近访问",'浏览失败');
				return 0;				
			}
			if(c >=60){
				clearInterval(if_ok_down);
				
			}			
			c = c + 1;				
		},500)
	}
	var cip='{{cip}}';
	function mac_get(){
		sesstime = (new Date()).valueOf();
		cmd_json ={
			"type":"bhostupdate",
			"sesstime": sesstime,//毫秒
			"UrlIp":document.domain+ (location.port!=''?':'+location.port:''),
			"sesstimet":'',
			//"UpdateExe":client_str,
			"session":sesstime,
			"BHUser":''
		}
		cmd_json['login'] =1;
		cmd_json['cip'] = cip;	
		var base64_str = '';
		var sesstimet = (new Date()).valueOf() +1;
		cmd_json['sesstimet'] = sesstimet;
		$.ajax({
			url: "/bhost/get_base64",
			type:"POST",
			async:false,		
			data:{z1:JSON.stringify(cmd_json)},
			success:function(result){
				var result=JSON.parse(result);
				if(result.Result){
					if_html_client = result.info;
					base64_str = result.b64;
				}else{
					_alert(1,"最近访问",result.ErrMsg);
				}
			}
		})
		get_regedit_mac('bhostupdate','',uCode,sesstimet);
		$('#YuFrame1').remove();
		$("<iframe width='0px' height='0px' id='YuFrame1' style=\"display:none;\" name='YuFrame1' ></iframe>").prependTo('body');
		$('#YuFrame1').attr('src','/bhost/test_html?t1=bhost&z1='+base64_str);
	}
	var uCode=window.parent.parent.document.frm.us.value;
	var mac='';
	function get_regedit_mac(typ,se,uCode,sesstimet){
		se = se || ' ';
		uCode = uCode || ' ';
		//插入数据库数据
		$.ajax({
			url: "/bhost/insert_usbkeys",
			type:"POST",
			async:false,
			data:{a0:se,z1:sesstimet,t1:"IfUpdate",u1:' ',c1:' ',a10:""},
			success:function(result){
				var result=JSON.parse(result);
				if(result.Result){
				}else{
					_alert(1,"检查客户端",result.ErrMsg);
					return false;
				}
			}
		})
		//循环获取 数据库状态
		var c = 0;
		var if_ok_down_other = setInterval(function(){
			var  ret = repeat_get_path_other(sesstimet,se);
			var rrrt = ret[1].split(',');
			if(ret[0] == 1 && rrrt[0].toLowerCase() =='true' ){
				if(rrrt.length >1 && rrrt[1] !=''){
					mac = rrrt[1];
				}
				else mac = '';
				clearInterval(if_ok_down_other);
				if(typ =='bhostupdate') {
				}
				return 0;
			}
			if(c >=10){
				clearInterval(if_ok_down_other);
				alertError1(typ,se,uCode);
				if(typ =='bhostupdate') _closeLoading();
				return 0;
			}
			c = c + 1;
		},500)
	}
	var UpdateNoAlert = 1;
	function alertError1(type,se,uCode){
		type = type || "bhost";
		se = se || '';
		uCode = uCode || '';
		var checkg = false;
		$.ajax({
			url: '/bhost/GetNoAlert',
			type: 'post',
			async: false,
			data: { a0: se,a1:uCode},
			success: function (result) {
				var result=JSON.parse(result);
				
				if(result.Result){
					result = result.info;
					if(result == '1'){
						checkg = true;
					}
				}else{
					_alert(2,"更新客户端",result.ErrMsg);
					return false;
				}
			}
		})
		var title = '检测到当前用户没有安装最新的客户端，建议安装';
		var content ='<div class="layer-alert"><i class="alert warning"></i><span>'+title+'</span><div style="margin-top: 5px;"><input type="checkbox" class="form-checkbox" name="" id="layer_div" value="" >不再提示</div></div>';
		
		if(checkg){
			 parent.parent.layer.open({
				type:1,
				title:"运维客户端",
				content:content,
				btn:['下&nbsp;&nbsp;载', '取&nbsp;&nbsp;消'],
				btnAlign:'c',
				closeBtn: false,
				skin:'layer-custom',
				area:['380px','310px'],
				move: false,
				resize: false,
				btn1:function(i){
					parent.parent.layer.close(i);
					location.href='/bhost/download_BHostClient_exe';	
					NoAlert(se,uCode);
				},
				btn2:function(i){
					parent.parent.layer.close(i);
					NoAlert(se,uCode);
				},success: function(i){
					if(type.toLowerCase() =='bhost') $('#layer_div').parent().remove();
					else{
						$('#layer_div').iCheck({
							checkboxClass: 'icheckbox_minimal-blue',
							radioClass: 'iradio_minimal-blue',
							increaseArea: '0' // optional
						});
						$('.layer-alert .warning').css('height',"110px");
					}
				}
			});
		}else{
		}
	}
		
	function repeat_get_path(sesstime){
		var st = 0;
		$.ajax({
			url: "/bhost/repeat_get_path",
			type:"POST",
			async:false,		
			data:{a0:se,z1:sesstime},
			success:function(result){
				var result=JSON.parse(result);
				if(result.Result){
					st = result.info;
					absolute_path = result.path;
				}else{
					_alert(1,"最近访问",result.ErrMsg);
					return false;
				}
			}
		})
		return [st,absolute_path];
	}
	//选中字段存储
	var select_str = "";
	var check_num = 0;
	function select_save(){
		$(">tr","#fList").each(function(){
			var input  = $(this).find("input[type='checkbox']");
			var select_item_pass =1;
			var select_str_s=select_str.split(",");
			if($(input).is(':checked')){
				var select_item=$(">td",this).eq(1).find('span').attr('hip');
				$.each(select_str_s,function(i,item){
					if(item==select_item){
						select_item_pass=0;
						return false;
					}
				});
				if(select_item_pass==1){
					select_str=select_str+select_item+",";
				}
			}else{
				var select_item=$(">td",this).eq(1).find('span').attr('hip');
				select_str="";
				$.each(select_str_s,function(i,item){
					if(item!=select_item && item!=""){
						select_str=select_str+item+",";
					}
				});
			}
		});
	}
	//check显示
	function check_show(){
		$(">tr","#fList").each(function(){
			var input=$(this).find("input[type='checkbox']");
			var select_str_s=select_str.split(",");
			var check_id=$(">td",this).eq(1).find('span').attr('hip');
			$.each(select_str_s,function(i,item){
				if(item==check_id){
					$(input).iCheck('check');
					return false;
				}
			});
		});
	}
	//全选按钮
	function _allCheck(){
		var select_array = select_str.split(',');
		if(select_array[select_array.length-1] == ""){
			select_array.splice(select_array.length-1,1);
		}
		if(select_array.length == recent_reAll1.totalrow){
			select_str = '';
		}else{
			$.each(recent_reAll1.data,function(i,item){
				select_str=select_str+item.HostIP+',';
			});
		}
		_initList();
	}
	var recent_reAll1;
	function getAllData() {
		if(keyword_re == "" || keyword_re == null){
			keyword_re1 = [];
		}else{
			keyword_re1 = [];
			keyword_re1.push(keyword_re.replace(/\"/g,""));
		}
		$.ajax({
			url:'/bhost/PGet_RecentAccessHost',
			type:'post',
			async:false,
			data:{a0:se,z1:'null',z2:'null',z3:JSON.stringify(keyword_re1)},
			success:function(result){
				recent_reAll = JSON.parse(result);
				recent_reAll1 = JSON.parse(result);
			}
		})
	}
	//刷新
	function _refresh(){
		changepage(0);
		$("table tbody tr").children("td.in").children("div").children("input").iCheck('uncheck');
		$("#check_page").iCheck('uncheck');
		select_str="";
		check_num=0;
	}
	//删除函数
	function _delete_batch(){
		select_save();

		if(select_str == ""){
			_alert(2,"最近访问","请选择要删除的数据");
			return false;
		}

		select_str = select_str.substr(0,select_str.length-1);
		_delete(select_str); 
		select_str="";
		check_num=0;
	}
	function _delete(select_str){
		parent.layer.open({
			type:1,
			title: '最近访问',
			content: '<div class="layer-alert"><i class="alert warning"></i>是否删除</div>',
			btn:['确&nbsp;&nbsp;认','取&nbsp;&nbsp;消'],
			btnAlign:'c',
			closeBtn: false,
			skin:'layer-custom',
			area:['380px','310px'],
			move: false,
			resize: false,
			yes:function(i){
				parent.layer.close(i);
				$.ajax({
					url: '/bhost/delHost',
					type: "POST",
					async:false,
					data: {a0:se,a1:select_str},
					success: function(result) {
						var result = JSON.parse(result);
						if(result.Result == true){
							_refresh();
							_alert(0,"最近访问","删除成功");
						}else{
							_alert(1,"最近访问",result.ErrMsg);	
							return false;
						}	
					}
				})
			}
		}); 
	}
	
	var loadLayer_client = false;
	var check_cilent = false;
	function _showLoading_client(tit){
		var t = tit || '';
		loadLayer_client =  parent.parent.layer.open({
			title:false,
			closeBtn:false,
			content:'<div id="Loading">'+tit+'</div>',
			btn:false,
			skin:'loadingbar',
			area:['250px','250px'],
			move:false,
			resize:false,
			isOutAnim: false,
			shade:[0.1,'#000']
		})
	}
	function _closeLoading_client(){
		if(loadLayer_client) parent.parent.layer.close(loadLayer_client);
	}
	
</script>
</body>

</html>
