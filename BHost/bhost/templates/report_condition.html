<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>manager</title>
    <link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
    <link rel="stylesheet" href="/manage/css/select2.min.css">
    <link rel="stylesheet" href="/manage/css/style.css">
	<script src="/manage/js/jquery.min.js"></script>
	<script src="/manage/js/jquery.jedate.min.js"></script>
    <link rel="stylesheet" href="/manage/css/jedate.css">
</head>

<body style="overflow:hidden;min-width: 800px" class="bg-white">
    <div class="mainer">
        <div class="container" id="step1">
            <div class="c-top">
                <div class="c-title">
				{%if temp_id != '0' %}
                    <div class="tit-nav">
                        <ul>
                            <li><a href="javascript:;" class="active"><i class="icon1"></i>报表条件</a></li>
                            <li><a href="/bhost/report_details?se={{se}}&z2={{temp_id}}"><i class="icon2"></i>报表详情</a></li>
                        </ul>
                    </div>
				{%endif%}
					<div class="bb-tit-ctr">
						<a href="javascript:;" title="任务列表" onclick="parent.location.href='/bhost/report_task?se={{se}}'"><i class="list_icon"></i>任务列表</a>
                    </div>
                    <div class="bb-tit-ctr">
						<!--
                        <a href="javascript:;" title="添加分类" onclick="parent._addClassify()"><i class="icon1"></i></a>
                        <a href="javascript:;" title="添加模板" onclick="parent._addModel()"><i class="icon2"></i></a>
						-->
                        <a href="javascript:;" title="报表素材" onclick="parent._globalSetting()"><i class="icon3"></i>报表素材</a>
                    </div>
					
					
                </div>
            </div>
		{%if temp_id != '0' %}
            <div class="bb-cont" id="bbCont">
                <div class="bb-box">
                    <div class="bitem bitem-t">
                        <h3 id="rpt_name"></h3>
                    </div>
                    <div class="bitem">
                        <div class="label">描    述：</div>
                        <div class="bc">
                            <textarea name="" id="RptMemo" cols="30" rows="10" maxlength="120"></textarea>
                        </div>
                    </div>
                    <div class="bitem">
                        <div class="label">建    议：</div>
                        <div class="bc">
                            <textarea name="" id="RptSugg" cols="30" rows="10" maxlength="120"></textarea>
                        </div>
                    </div>
                    <div class="bitem">
                        <div class="label">计划任务：</div>
                        <div class="bc">
                            <input class="forSwitch" type="checkbox" name="renwuopen" id="renwuopen" data-text="开启|关闭" onchange="_taskTime(this)">
                            <span id="renwutime" style="display: none;">
                                <label><input type="checkbox" class="bb-checkbox" id="every_day">每天</label>
                                <label><input type="checkbox" class="bb-checkbox" id="every_week" >每周</label>
                                <label><input type="checkbox" class="bb-checkbox" id="every_mon">每月</label>
                            </span>
                        </div>
                    </div>
                    <div class="bitem">
                        <div class="label">邮件接收：</div>
                        <div class="bc">
                            <input class="forSwitch" type="checkbox" name="mailopen" id="mailopen" data-text="开启|关闭" onchange="_mailSend(this)">
                            <span id="mailarr" style="display: none;">
                                <input type="text" id="mailinput" class="texin">
                                <label><input type="checkbox" class="bb-checkbox" id="combine">合并发送</label>
                            </span>
                        </div>
                    </div>
                    <div class="bitem" id="layer_Report" style="display:none;">
                        <div class="label">二层报表：</div>
                        <div class="bc">
                            <input class="forSwitch" type="checkbox" name="mingxibaobiao" id="mingxibaobiao" data-text="产生|不产生">
                        </div>
                    </div>
                    <div class="bitem">
                        <div class="label">文件类型：</div>
                        <div class="bc">
                            <select name="DataFormat" id="DataFormat" class="bb-select" style="width:8em">
                                <option value="HTML" selected="">HTML</option>
                                <option value="DOC">DOC</option>
                                <option value="PDF">PDF</option>
                                <option value="RTF">RTF</option>
								<option value="XLS">XLS</option>
								<option value="ODT">ODT</option>
                            </select>
                        </div>
                    </div>
                    <div class="bitem">
                        <div class="label">日志属性：</div>
                        <div class="bc">
                            <select name="rzsx" id="rzsx" class="bb-select" style="width:8em">
                                <option value="1">操作</option>
                                <option value="2">会话</option>
                            </select>
                        </div>
                    </div>
                    <div class="bitem srItem" data-type="time" field="0" index="1">
                        <div class="label">入库时间：</div>
                        <div class="bc">
							<span class="stwrap" style="height: 26px;">
								<input type="text" value="" style="width:7.5em;height: 24px;" placeholder="日期" class="datepicker" readonly>
								<input type="text" value="" placeholder="时" class="timeinput" min="00" max="23">
								<span class="srTip">:</span>
								<input type="text" value="" placeholder="分" class="timeinput" min="00" max="59">
								<span class="srTip">:</span>
								<input type="text" value="" placeholder="秒" class="timeinput" min="00" max="59">
							</span>
							<span class="srTip">至</span>
							<span class="stwrap" style="height: 26px;">
								<input type="text" value="" style="width:7.5em;height: 24px;" placeholder="日期" class="datepicker" readonly>
								<input type="text" value="" placeholder="时" class="timeinput" min="00" max="23">
								<span class="srTip">:</span>
								<input type="text" value="" placeholder="分" class="timeinput" min="00" max="59">
								<span class="srTip">:</span>
								<input type="text" value="" placeholder="秒" class="timeinput" min="00" max="59">
							</span>
							<!--
                            <span class="stwrap">
                                <input type="text" value="" style="cursor: pointer;" placeholder="选择时间" class="datepicker" readonly>
                            </span>
                            <span class="srTip">至</span>
                            <span class="stwrap">
                                <input type="text" value="" style="cursor: pointer;" placeholder="选择时间" class="datepicker" readonly>
                            </span>
							-->
                        </div>
                    </div>
                </div>
				
				<div id="bBtn" style="z-index: 5;">
					<a href="javascript:;" class="btn" onclick="parent.location.href='/bhost/index?tasktype=2&us={{us}}&se={{se}}'"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
				</div>
				
				{%if (11 in manage_power_id) or (8 in manage_power_id) or (9 in manage_power_id) %}
                <div class="btns bb-btns" style="display:none;">
					<a class="btn btn-fr btn-submit btn-normal" href="javascript:;" onclick="execute_rpt();" style="">执&nbsp;&nbsp;行</a>
                </div>
				{%endif%}
				
            </div>
        {%endif%}
		</div>
    </div>
    <!--temps-->
    <div id="forTemp" style="display: none;">
        <div class="bb-sel-item bb-sel-item-sip ip-single">
            <select name="" onchange="_setDeAddr(this)" style="width: 8em">
                <option value="0">其他</option>
				<!--
                <option value="111">111</option>
                <option value="222">222</option>
				-->
            </select>
            <input type="text" class="texin">
            <span class="srsCtl">
                <a href="javascript:;" class="add" onclick="_itemAdd(this)"></a>
                <a href="javascript:;" class="del" onclick="_itemDel(this)"></a>
            </span>
        </div>
		<div class="bb-sel-item bb-sel-item-sip">
            <input type="text" class="texin">
            <span class="srsCtl">
                <a href="javascript:;" class="add" onclick="_itemAdd(this)"></a>
                <a href="javascript:;" class="del" onclick="_itemDel(this)"></a>
            </span>
        </div>
        <div class="bb-sel-item bb-sel-item-fip">
            <input type="text" class="texin">
            <span class="fix">-</span>
            <input type="text" class="texin">
            <span class="srsCtl">
                <a href="javascript:;" class="add" onclick="_itemAdd(this)"></a>
                <a href="javascript:;" class="del" onclick="_itemDel(this)"></a>
            </span>
        </div>

        <div class="bb-sel-item bb-sel-item-ingroup">
            <input type="text" class="texin forgroup" onclick="_getHostGroup(this)" readonly="">

            <span class="srsCtl">
                <a href="javascript:;" class="add" onclick="_getHostGroup(this)"></a>
                <a href="javascript:;" class="del" onclick="_itemDel(this)"></a>
            </span>
        </div>

        <div class="bb-sel-item bb-sel-item-sub">
            <input type="text" class="texin">

            <span class="srsCtl">
                <a href="javascript:;" class="add" onclick="_itemAdd(this)"></a>
                <a href="javascript:;" class="del" onclick="_itemDel(this)"></a>
            </span>
        </div>
		<!--time-->
		
        <div class="bb-sel-item time-twin">
			<span class="stwrap">
				<input type="text" value="" placeholder="日期" class="datepicker" readonly>
				<input type="text" value="" placeholder="时" class="timeinput" min="00" max="23">
				<span class="srTip">:</span>
				<input type="text" value="" placeholder="分" class="timeinput" min="00" max="59">
				<span class="srTip">:</span>
				<input type="text" value="" placeholder="秒" class="timeinput" min="00" max="59">
			</span>
			<span class="srTip">至</span>
			<span class="stwrap">
				<input type="text" value="" placeholder="日期" class="datepicker" readonly>
				<input type="text" value="" placeholder="时" class="timeinput" min="00" max="23">
				<span class="srTip">:</span>
				<input type="text" value="" placeholder="分" class="timeinput" min="00" max="59">
				<span class="srTip">:</span>
				<input type="text" value="" placeholder="秒" class="timeinput" min="00" max="59">
			</span>
			<!--
            <input type="text" class="datepicker">
            <span class="fix">至</span>
            <input type="text" class="datepicker">
			-->
            <span class="srsCtl">
                <a href="javascript:;" class="add" onclick="_itemAdd(this)"></a>
                <a href="javascript:;" class="del" onclick="_itemDel(this)"></a>
            </span>
			
        </div>
        <div class="bb-sel-item time-single">
			<span class="stwrap">
				<input type="text" value="" placeholder="日期" class="datepicker" readonly>
				<input type="text" value="" placeholder="时" class="timeinput" min="00" max="23">
				<span class="srTip">:</span>
				<input type="text" value="" placeholder="分" class="timeinput" min="00" max="59">
				<span class="srTip">:</span>
				<input type="text" value="" placeholder="秒" class="timeinput" min="00" max="59">
			</span>
			<!--
            <input type="text" class="datepicker">
			-->
            <span class="srsCtl">
                <a href="javascript:;" class="add" onclick="_itemAdd(this)"></a>
                <a href="javascript:;" class="del" onclick="_itemDel(this)"></a>
            </span>
        </div>
		<!--select-->
        <div class="bb-sel-item select-rzlx-single">
            <select name="rzlxselect" class="" style="width: 102px;">
                <option value="-1">选择协议</option>
            </select>
            <span class="srsCtl">
                <a href="javascript:;" class="add" onclick="_itemAdd(this)"></a>
                <a href="javascript:;" class="del" onclick="_itemDel(this)"></a>
            </span>
        </div>
		<div class="bb-sel-item select-gjlx-single">
            <select name="rzlxselect" class="" style="width:102px;">
                <option value="0">无</option>
                <option value="1">违规操作</option>
                <option value="2">高危操作</option>
				<option value="3">登录异常</option>
            </select>
            <span class="srsCtl">
                <a href="javascript:;" class="add" onclick="_itemAdd(this)"></a>
                <a href="javascript:;" class="del" onclick="_itemDel(this)"></a>
            </span>
        </div>
        <div class="bb-sel-item select-gjdz-single">
            <select name="rzlxselect" class="" style="width:102px;">
				<option value="80">邮件</option>
				<option value="100">短信</option>
				<option value="2000">阻断</option>
				<option value="4000">SYSLOG</option>
				<option value="8000">SNMP</option>
				<option value="10000">忽略</option>
            </select>
            <span class="srsCtl">
                <a href="javascript:;" class="add" onclick="_itemAdd(this)"></a>
                <a href="javascript:;" class="del" onclick="_itemDel(this)"></a>
            </span>
        </div>
		<div class="bb-sel-item select-gjcl-single">
            <select name="rzlxselect" class="" style="width:102px;">
                <option value="0">未处理</option>
                <option value="1">已确认</option>
            </select>
            <span class="srsCtl">
                <a href="javascript:;" class="add" onclick="_itemAdd(this)"></a>
                <a href="javascript:;" class="del" onclick="_itemDel(this)"></a>
            </span>
        </div>
        <div class="bb-sel-item select-gjdj-single">
            <select name="rzlxselect" class="" style="width:102px;">
                <option value="0">无</option>
                <option value="1">高</option>
                <option value="2">中</option>
                <option value="3">低</option>
            </select>
            <span class="srsCtl">
                <a href="javascript:;" class="add" onclick="_itemAdd(this)"></a>
                <a href="javascript:;" class="del" onclick="_itemDel(this)"></a>
            </span>
        </div>
    </div>
    <!---->
    <!--script-->
    <script src="/manage/js/jquery.min.js"></script>
    <script src="/manage/js/jquery.easing.js"></script>
    <script src="/manage/js/layer.js"></script>
    <script src="/manage/js/common.js"></script>
	<script src="/manage/js/common_e.js"></script>
    <!--select2-->
    <script src="/manage/js/select2.full.min.js"></script>
    <script>
    $('.bb-select').select2({ minimumResultsForSearch: -1 });
    </script>
	
    <!--icheck-->
    <script src="/manage/js/icheck.min.js"></script>
    <script>
    $('.bb-checkbox,.bb-radio').iCheck({
        checkboxClass: 'icheckbox_minimal-blue',
        radioClass: 'iradio_minimal-blue',
        increaseArea: '0' // optional
    });
    </script>
    <!--jedate-->
    <script src="/manage/js/jquery.jedate.min.js"></script>
	<script src="/manage/js/base64.js"></script>
    <link rel="stylesheet" href="/manage/css/jedate.css">
	<style>
	.srItem .srTip{
		float: left;
		text-align: center;
		width: 24px;
		vertical-align: middle;
		padding: 0 5px 0 0;
	}
	.srItem input{
		height: 26px;
		background-color: #fff;
		border-radius: 5px;
	}
	.srItem .label {
		border-right:0;
		cursor:default;
	}
	
	</style>
    <script>
	var se = "{{se}}";
	var temp_id = "{{temp_id}}";
	var back_type = "{{back_type}}";
	var manage_power_id = {{manage_power_id}};// 8, 9, 11, 12
    $(function() {
        _initSize();
        _btnSwitch();
		if (temp_id != 0){
			$("#combine").iCheck('disable');
			$("#bbCont").find('div.bitem:eq(3)').find("span.bb-switch-btn").on("click",function(){
				if ($("#bbCont").find('div.bitem:eq(3)').find(".bb-switch-text").text() == "开启"){
					$("#combine").iCheck('enable');
				}else{
					$("#combine").iCheck('uncheck').iCheck('disable');
				}
			});
			//bind_date($('div[data-type=time]:first'));
			
			var now = new Date();
			var setDate = now.getTime();
			setDate = new Date(setDate);
			
			var month = (setDate.getMonth() + 1).toString();
			var day =  setDate.getDate().toString();
			if(month.length == 1){
				month = '0' + month;
			}
			if(day.length == 1){
				day = '0' + day;
			}
			setDate = {
				year: setDate.getFullYear(),
				month: month,
				day: day
			}
			setDate = setDate.year + '-' + setDate.month + '-' + setDate.day;
			
			nowDate = new Date();
			nowDate.setDate(nowDate.getDate() - 6);
			month = (nowDate.getMonth() + 1).toString();
			day =  nowDate.getDate().toString();
			if(month.length == 1){
				month = '0' + month;
			}
			if(day.length == 1){
				day = '0' + day;
			}
			pre_Date = nowDate.getFullYear() + '-' + month + '-' + day;
			$('input.datepicker',$('div[data-type=time]:first')).each(function(){
				$(this).jeDate({
					format:"YYYY-MM-DD",
					isTime:true
					//maxDate:setDate.year + "-" + setDate.month + "-" + setDate.day
				});
			});
			$('input.datepicker',$('div[data-type=time]:first')).each(function(i,item){
				if(i==0){
					$(item).val(pre_Date);
					$(item).parent().find('input.timeinput').val('00');
				}else if(i==1){
					$(item).val(setDate);
					$(item).parent().find('input.timeinput').each(function(i){
						if(i == 0){
							$(this).val('23');
						}else{
							$(this).val('59');
						}
					})
				}   
			});
			
			/*
			var now = new Date();
			var setDate = {
				year: now.getFullYear(),
				month: now.getMonth() + 1,
				day: now.getDate()
			}

			setDate = setDate = setDate.year + '-' + setDate.month + '-' + setDate.day;
			$('input.datepicker').each(function(i, item) {
				$(this).jeDate({
					format: "YYYY-MM-DD hh:mm:ss",
					isTime: true,
					maxDate: setDate + " 23:59:59"
				});

				if (i == 0) {
					$(this).val(setDate + " 00:00:00");
				} else {
					$(this).val(setDate + " 23:59:59");
				}
			});
			*/
			$.ajax({
				url:'/bhost/Get_DataReportTemplate',
				type:'post',
				async:false,
				data:{a0:se,z2:temp_id},
				success:function(result){
					var result_data = JSON.parse(result);
					//rpt_json = JSON.parse(result_data[0].Condition)
					rpt_json = result_data[0].Condition;
										if (rpt_json.RptBuild.layer.length == 2){
						$("#layer_Report").show();
						$("#layer_Report").find('.bb-switch-btn').addClass('on');
						$("#mingxibaobiao").prop('checked',true);
						$("#mingxibaobiao").parent().find('.bb-switch-text').text('产生');
					}
					$("#rpt_name").text(rpt_json.RptName);
					//$("#rpt_name").text(rpt_json.Rpmember + ' - ' + rpt_json.RptName);
					//$("#RptMemo").val(window.atob(rpt_json.RptMemo.substring(4))).prop('disabled',true);
					//$("#RptSugg").val(window.atob(rpt_json.RptSugg.substring(4)));
					$("#RptMemo").prop('disabled',true);
					if (rpt_json.RptMemo != ""){
						$("#RptMemo").val(rpt_json.RptMemo);
					}
					if (rpt_json.RptSugg != ""){
						$("#RptSugg").val(rpt_json.RptSugg);
					}
					if (rpt_json.RptFormat.DataFormat != "未指定"){
						$("#DataFormat").parents('.bitem').hide();
					}
					var logtype_array = rpt_json.SearchDef.KeyLogType.split(',');
					
					if (logtype_array.length == 1){
						if (logtype_array[0] == 1){
							$("#bbCont").find('.bitem:eq(7)').children('.bc').empty().text("操作");
							if (manage_power_id.indexOf(8) <0) $('.bb-btns').hide();
							else $('.bb-btns').show();
						}else if (logtype_array[0] == 2){
							$("#bbCont").find('.bitem:eq(7)').children('.bc').empty().text("会话");
							if (manage_power_id.indexOf(8) <0) $('.bb-btns').hide();
							else $('.bb-btns').show();
						}else{
							$("#bbCont").find('.bitem:eq(7)').children('.bc').empty().text("系统");
							if (manage_power_id.indexOf(9) <0 && manage_power_id.indexOf(11) <0) $('.bb-btns').hide();
							else $('.bb-btns').show();
						}
					}else{
						if (manage_power_id.indexOf(8) <0) $('.bb-btns').hide();
						else $('.bb-btns').show();
					}
					var bitem = "";
					$.each(rpt_json.RptCond,function(i,item){
						var select_str = "";
						var div_class = "bitem";
						if (item.datatype == "string"){
							if (item.name == "编号" || item.name == "会话标识"){
								select_str = '<select name="rzsxselectsec" class="bb-select" onchange="_setAddr(this);" style="width: 8em"><option value="0">所有</option><option value="equal">=</option><option value="between">区间</option><option value="high">&gt;</option><option value="ehigh">&gt;=</option><option value="low">&lt;</option><option value="elow">&lt;=</option><option value="not equal">不等于</option></select>';
								//return true;
							}else{
								select_str = '<select name="rzsxselectsec" class="bb-select" onchange="_setAddr(this);" style="width: 8em"><option value="0">所有</option><option value="include">包含</option><option value="not include">不包含</option><option value="begin">开始</option><option value="end">结束</option><option value="regx" title="正则匹配">正则匹配</option><option value="not regx" title="正则不匹配" >正则不匹配</option><option value="ncregx" title="正则匹配（忽略大小写）">正则匹配（忽略大小写）</option><option value="not ncregx" title="正则不匹配（区分大小写）">正则不匹配（区分大小写）</option><option value="match" title="通配符">通配符</option></select>';
							}
						}else if (item.datatype == "number"){
							select_str = '<select name="rzsxselectsec" class="bb-select" onchange="_setAddr(this);" style="width: 8em"><option value="0">所有</option><option value="equal">=</option><option value="between">区间</option><option value="high">&gt;</option><option value="ehigh">&gt;=</option><option value="low">&lt;</option><option value="elow">&lt;=</option><option value="not equal">不等于</option></select>';
						}else if (item.datatype == "time"){
							if (item.field == 0 && item.index == 1){
								return true;
							}
							div_class = "bitem srItem";
							select_str= '<select name="rzsxselectsec" class="bb-select" onchange="_setTime(this);" style="width: 8em"><option value="0">所有</option><option value="between">区间</option><option value="equal">=</option><option value="ehigh">&gt;=</option><option value="elow">&lt;=</option></select>';
						}else if (item.datatype == "select"){
							if (item.field == 5 && item.index == 15){
								select_str = '<select name="rzsxselectsec" class="bb-select" onchange="_setAddr(this);" style="width: 8em"><option value="0">所有</option><option value="equal">等于</option><option value="not equal">不等于</option><option value="include">包含</option><option value="not include">不包含</option></select>';
							}else{
								select_str = '<select name="rzsxselectsec" class="bb-select" onchange="_setAddr(this);" style="width: 8em"><option value="0">所有</option><option value="equal">等于</option><option value="not equal">不等于</option></select>';
							}
						}else if (item.datatype == "ip"){
							select_str= '<select name="rzsxselectsec" class="bb-select" onchange="_setAddr(this);" style="width: 8em"><option value="0">所有</option><option value="equal">等于</option><option value="between">区间</option><option value="not equal">不等于</option><option value="ingroup">主机组</option></select>';
						}
						
						bitem = bitem + '<div class="'+div_class+'" data-type="'+item.datatype+'" field="'+item.field+'" index="'+item.index+'"><div class="label">'+item.name+'：</div><div class="bc"><div class="bb-sel-type">'+select_str+'</div><div class="bb-sel-cont"></div></div></div>';
					});
					$("#bbCont").children('.bb-box').append(bitem);
					$("#bbCont").find(".bb-select").select2({ minimumResultsForSearch: -1});
					
				}
			});
		}
    })
	
	function bind_date(obj){
		var now = new Date();
		var setDate = now.getTime();
		setDate = new Date(setDate);
		
		var month = (setDate.getMonth() + 1).toString();
		var day =  setDate.getDate().toString();
		if(month.length == 1){
			month = '0' + month;
		}
		if(day.length == 1){
			day = '0' + day;
		}
		setDate = {
			year: setDate.getFullYear(),
			month: month,
			day: day
		}
		
		setDate = setDate.year + '-' + setDate.month + '-' + setDate.day;
		$('input.datepicker',$(obj)).each(function(){
			$(this).jeDate({
				format:"YYYY-MM-DD",
				isTime:true
				//maxDate:setDate.year + "-" + setDate.month + "-" + setDate.day
			});
		});
		$('input.datepicker',$(obj)).each(function(i,item){
			if(i==0){
				$(item).val(setDate);
				$(item).parent().find('input.timeinput').val('00');
			}else if(i==1){
				$(item).val(setDate);
				$(item).parent().find('input.timeinput').each(function(i){
					if(i == 0){
						$(this).val('23');
					}else{
						$(this).val('59');
					}
				})
			}   
		});
	}
	
	$(document).on('keydown','input.timeinput',function(){
		var i = $(this).index();        
		var v = $(this).val();
		v = v.replace(/[^\d]/g,'');
		$(this).val(v);
	}).on('keyup','input.timeinput',function(e){
		var i = $(this).index();
		var v = $(this).val();
		v = v.replace(/[^\d]/g,'');
		$(this).val(v);		
		var max = 23;
		if(i>1){
			max = 59;
		}

		if(v > max){
			v = max;
		}

		$(this).val(v);

		v = v.toString();
		if(v.length >= 2){
			$(this).val(v.substring(0,2));

			var keycode = e.keyCode;
			if(keycode != 9){
				$(this).next().next().focus();
			}
		}
	}).on('focus','input.timeinput',function(){
		$(this).select();
	}).on('blur','input.timeinput',function(){
		var v = $(this).val();
		v = v.toString();

		if(v == ''){
			v = '00';
		}else if(v.length == 1){
			v = '0' + v;
		}

		$(this).val(v);
	});
	
	
	var rpt_json;
    $(window).resize(function(){
        _initSize();
    })

    function _initSize(){
        var h = $(window).height();
        $('#bbCont').height(h - 123);
    }

    function _btnSwitch() {
        $('input.forSwitch').each(function() {
            var $this = $(this);
            var $c = $('<div class="bb-switch" />');
            var $b = $('<span class="bb-switch-btn" />');
            var $t = $('<span class="bb-switch-text" />');

            var text = $this.data('text').split('|');

            var check = $this.prop('checked');
            var disable = $this.prop('disabled');

            if (check) {
                $b.addClass('on');
                $t.text(text[0]);
            } else {
                $b.removeClass('on');
                $t.text(text[1]);
            }

            $c.append($b, $t);
            $this.hide().after($c);

            if (disable) {
                return;
            }

            $this.trigger('change');
            $b.on('click', function() {
                var check = $this.prop('checked');
                if (check) {
                    $this.prop('checked', false);
                    $b.removeClass('on');
                    $t.text(text[1]);
                } else {
                    $this.prop('checked', true);
                    $b.addClass('on');
                    $t.text(text[0]);
                }

                $this.trigger('change');
            })
        });
    }

    function _taskTime(obj) {
        var v = $(obj).prop('checked');
        if (v) {
            $('#renwutime').show();
        } else {
            $('#renwutime').hide();
        }
    }

    function _mailSend(obj) {
        var v = $(obj).prop('checked');
        if (v) {
            $('#mailarr').show();
        } else {
            $('#mailarr').hide();
        }
    }
	
	function _setTime(obj){
		var v = $(obj).val();
		var $_c = $(obj).parents('div.bc').children('div.bb-sel-cont');
		if (v == 0){
			$_c.empty();
		}else{
			if (v == 'between' || v == 'span' || v == 'ehspan' || v == 'elspan') {
				var $t_c = $('#forTemp div.time-twin').clone();
			} else {
				var $t_c = $('#forTemp div.time-single').clone();
			}
			$_c.html($t_c);
			//bind_date($_c);
		}
		bind_date($_c);
		/*
		var now = new Date();
		var setDate = {
			year: now.getFullYear(),
			month: now.getMonth() + 1,
			day: now.getDate()
		}

		setDate = setDate.year + '-' + setDate.month + '-' + setDate.day;
				$_c.find('input.datepicker').each(function(i, item) {
									$(item).jeDate({
				format: "YYYY-MM-DD hh:mm:ss",
				isTime: true,
				maxDate: setDate + " 23:59:59"
			});

			if (i == 0) {
				$(item).val(setDate + " 00:00:00");
			} else {
				$(item).val(setDate + " 23:59:59");
			}
		})
		*/
		$_c.children('select').addClass('bb-select').select2({ minimumResultsForSearch: -1 });
	}
	
	function _settype(obj){
		if ($(obj).val() != 0){
			$.ajax({
				url:'/bhost/get_log_type',
				type:'post',
				async:false,
				data:{a0:se},
				success:function(result){
					var log_result = JSON.parse(result);
					var option_str = "";
					$.each(log_result.data,function(i,item){
						option_str = option_str + '<option value="'+item.ProtocolId+'">'+item.ProtocolName+'</option>';
					});
					$("#rpt_type").append(option_str);
					$("#rpt_type").select2();
				}
			});
			$(obj).parent().next('div').children('div').show();
		}else{
			$(obj).parent().next('div').children('div').hide();
		}
	}
	
    function _setAddr(obj) {
        var v = $(obj).val();
        var $c = $(obj).parents('div.bc').children('div.bb-sel-cont');
		var type = $(obj).parents('.bitem').data('type');
		var name = $(obj).parents('div.bc').prev('div').text();
        //var $sip = $('#forTemp').children('div.bb-sel-item-sip').clone();
		
		var $sub = $('#forTemp').children('div.bb-sel-item-sub').clone();
        var $fip = $('#forTemp').children('div.bb-sel-item-fip').clone();
        var $ingroup = $('#forTemp').children('div.bb-sel-item-ingroup').clone();
		
		var $sip = $('#forTemp').children('div.ip-single').clone();		
		var $rzlx = $('#forTemp').children('div.select-rzlx-single').clone();
		var $gjlx = $('#forTemp').children('div.select-gjlx-single').clone();
		var $gjcl = $('#forTemp').children('div.select-gjcl-single').clone();
		var $gjdj = $('#forTemp').children('div.select-gjdj-single').clone();
		var $gjdz = $('#forTemp').children('div.select-gjdz-single').clone();
		switch(v){
			case '0':
				$c.empty();
				break;
			case 'equal':
			case 'not equal':
				if (type == 'ip'){
					var host_str = "";
					$.ajax({
						url:'/bhost/get_host_rpt',
						type:'post',
						async:false,
						data:{a0:se},
						success:function(result){
							var host_result = JSON.parse(result);
							$.each(host_result,function(i,item){
								host_str = host_str + '<option value="'+item.HostIP+'-'+item.HostId+'">'+item.HostName+'</option>';
							});
						}
					});
					$sip.find('select:eq(0)').append(host_str);
					$c.html($sip);
					$('select',$sip).trigger('change').select2();
				}else if(type == "select"){
					if (name == '协议：'){
						$.ajax({
							url:'/bhost/get_log_type',
							type:'post',
							async:false,
							data:{a0:se},
							success:function(result){
								var log_result = JSON.parse(result);
								var option_str = "";
								$.each(log_result.data,function(i,item){
									option_str = option_str + '<option value="'+item.ProtocolId+'">'+item.ProtocolName+'</option>';
								});
								$rzlx.children('select').append(option_str);
								$rzlx.children('select').select2();
							}
						});
						$c.html($rzlx);
					}else if (name == "告警类型："){
						$c.html($gjlx);
						$gjlx.find('select').select2({minimumResultsForSearch: -1});
					}else if (name == "告警等级："){
						$c.html($gjdj);
						$gjdj.find('select').select2({minimumResultsForSearch: -1});
					}else if (name == "告警处理："){
						$c.html($gjcl);
						$gjcl.find('select').select2({minimumResultsForSearch: -1});
					}else if (name == "告警动作："){
						$c.html($gjdz);
						$gjdz.find('select').select2({minimumResultsForSearch: -1});
					}
				}else{
					$c.html($sub);
					$('select',$sub).trigger('change').select2({ minimumResultsForSearch: -1});
				}
				break;
			case 'ingroup':
				$c.html($ingroup);
				break;
			case "high":
			case "ehigh":
			case "low":
			case "elow":
			case "begin":
			case "end":
			case "include":
			case "not include":
			case "regx":
			case "not regx":
			case "ncregx":
			case "not ncregx":
			case "match":
				if (name == "告警动作："){
					$c.html($gjdz);
					$gjdz.find('select').select2({minimumResultsForSearch: -1});
				}else{
					$c.html($sub);
				}
				
				break;
			case "between":
			case "span":
			case "ehspan":
			case "elspan":
				$c.html($fip);
				break;
			default:
				;
		}
		/*
        if(v == '0' || v == 0){
            $c.empty();
        }else if(v == 'equal' || v == 'not equal'){
			if (type == 'ip'){
				var host_str = "";
				$.ajax({
					url:'/bhost/get_host_rpt',
					type:'post',
					async:false,
					data:{a0:se},
					success:function(result){
						var host_result = JSON.parse(result);
						$.each(host_result,function(i,item){
							host_str = host_str + '<option value="'+item.HostIP+'-'+item.HostId+'">'+item.HostName+'</option>';
						});
					}
				});
				$sip.find('select:eq(0)').append(host_str);
				$c.html($sip);
				$('select',$sip).trigger('change').select2();
			}else if(type == "select"){
				if (name == '日志类型：'){
					$.ajax({
						url:'/bhost/get_log_type',
						type:'post',
						async:false,
						data:{a0:se},
						success:function(result){
							var log_result = JSON.parse(result);
							var option_str = "";
							$.each(log_result.data,function(i,item){
								option_str = option_str + '<option value="'+item.ProtocolId+'">'+item.ProtocolName+'</option>';
							});
							$rzlx.children('select').append(option_str);
							$rzlx.children('select').select2();
						}
					});
					$c.html($rzlx);
				}else if (name == "告警类型："){
					$c.html($gjlx);
					$gjlx.find('select').select2({minimumResultsForSearch: -1});
				}else if (name == "告警等级："){
					$c.html($gjdj);
					$gjdj.find('select').select2({minimumResultsForSearch: -1});
				}else if (name == "告警处理："){
					$c.html($gjcl);
					$gjcl.find('select').select2({minimumResultsForSearch: -1});
				}
			}else{
				$c.html($sub);
				$('select',$sub).trigger('change').select2({ minimumResultsForSearch: -1});
			}
        }else if(v == 'ingroup'){
            $c.html($ingroup);
        }else if (v == "begin" || v == "end" || v == "include" || v == "not include" || v == "high"){
			$c.html($sub);
		}else{
            $c.html($fip);
        }
		*/
    }
	
    function _setSub(obj){
        var v = $(obj).val();
        var $c = $(obj).parents('div.bc').children('div.bb-sel-cont');

        var $sub = $('#forTemp').children('div.bb-sel-item-sub').clone();

        if(v == '0' || v == 0){
            $c.empty();
        }else{
            $c.html($sub);
        }
    }
	
	//var IPReg = /^((?:(?:2[0-4][0-9]\.)|(?:25[0-5]\.)|(?:1[0-9][0-9]\.)|(?:[1-9][0-9]\.)|(?:[0-9]\.)){3}(?:(?:2[0-5][0-5])|(?:25[0-5])|(?:1[0-9][0-9])|(?:[1-9][0-9])|(?:[0-9])))$/;
	var IPReg = /(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;
    var numReg = /^[0-9]*$/;
	function test_input(obj){
		var td_t = $(obj).parents('.bc').siblings('.label:eq(0)').text();
		var warn_cond = td_t.substring(0,td_t.length-1);
		var tr_type = $(obj).parents('.bitem').data('type');
		var td3_sel = $(obj).parents('.bitem').find('.bb-sel-type').find('select').val();
		var inputReg;
		if (tr_type == "number"){
			inputReg = numReg;
		}else if (tr_type == "ip"){
			inputReg = IPReg;
		}else{
			inputReg = "";
		}
						var input_len = $(obj).parents('.bb-sel-item').find('input:visible').length;
				if (input_len == 0){
			var v = $(obj).parents('.bb-sel-item').find('select:visible').val();
			if (v == "-1"){ //select
				_alert(2, "报表条件", "请选择" + warn_cond);
				return false;
			}
		}else if (input_len == 1){ //非区间
			var v = $(obj).parents('.bb-sel-item').find('input:visible').val();
			if (v == ""){
				_alert(2, "报表条件", warn_cond + '不能为空',$(obj).parents('.bb-sel-item').find('input:visible'));
				return false;
			}
			if (inputReg != "" && !inputReg.test(v)){
				_alert(2, "报表条件", warn_cond + '格式不正确');
				return false;
			}
		}else if (input_len == 4){//时间单
			var ytd = $(obj).parents('.bb-sel-item').find('input:visible').eq(0).val();
			var h = $(obj).parents('.bb-sel-item').find('input:visible').eq(1).val();
			var m = $(obj).parents('.bb-sel-item').find('input:visible').eq(2).val();
			var s = $(obj).parents('.bb-sel-item').find('input:visible').eq(3).val();
			if (h > 23){
				_alert(2, "报表条件", warn_cond + '时间格式不正确',$(obj).parents('.bb-sel-item').find('input:visible').eq(1));
				return false;
			}
			if (m > 59){
				_alert(2, "报表条件", warn_cond + '时间格式不正确',$(obj).parents('.bb-sel-item').find('input:visible').eq(2));
				return false;
			}
			if (s > 59){
				_alert(2, "报表条件", warn_cond + '时间格式不正确',$(obj).parents('.bb-sel-item').find('input:visible').eq(3));
				return false;
			}
		}else if (input_len == 8){
			var ytd_s = $(obj).parents('.bb-sel-item').find('input:visible').eq(0).val();
			var h_s = $(obj).parents('.bb-sel-item').find('input:visible').eq(1).val();
			var m_s = $(obj).parents('.bb-sel-item').find('input:visible').eq(2).val();
			var s_s = $(obj).parents('.bb-sel-item').find('input:visible').eq(3).val();
			if (h_s > 23){
				_alert(2, "报表条件", warn_cond + '时间格式不正确',$(obj).parents('.bb-sel-item').find('input:visible').eq(1));
				return false;
			}
			if (m_s > 59){
				_alert(2, "报表条件", warn_cond + '时间格式不正确',$(obj).parents('.bb-sel-item').find('input:visible').eq(2));
				return false;
			}
			if (s_s > 59){
				_alert(2, "报表条件", warn_cond + '时间格式不正确',$(obj).parents('.bb-sel-item').find('input:visible').eq(3));
				return false;
			}
			var ytd_e = $(obj).parents('.bb-sel-item').find('input:visible').eq(4).val();
			var h_e = $(obj).parents('.bb-sel-item').find('input:visible').eq(5).val();
			var m_e = $(obj).parents('.bb-sel-item').find('input:visible').eq(6).val();
			var s_e = $(obj).parents('.bb-sel-item').find('input:visible').eq(7).val();
			if (h_e > 23){
				_alert(2, "报表条件", warn_cond + '时间格式不正确',$(obj).parents('.bb-sel-item').find('input:visible').eq(5));
				return false;
			}
			if (m_e > 59){
				_alert(2, "报表条件", warn_cond + '时间格式不正确',$(obj).parents('.bb-sel-item').find('input:visible').eq(6));
				return false;
			}
			if (s_e > 59){
				_alert(2, "报表条件", warn_cond + '时间格式不正确',$(obj).parents('.bb-sel-item').find('input:visible').eq(7));
				return false;
			}
			var time_r = _compare_time(ytd_s,ytd_e);
			if (time_r == 1){
				_alert(2, "报表条件", '结束' + warn_cond + "不能小于起始" + warn_cond);
				return false;
			}
			if (parseInt(h_e) < parseInt(h_s)){
				_alert(2, "报表条件", '结束' + warn_cond + "不能小于起始" + warn_cond, $(obj).parents('.bb-sel-item').find('input:visible').eq(5));
				return false;
			}
			if (parseInt(m_e) < parseInt(m_s)){
				_alert(2, "报表条件", '结束' + warn_cond + "不能小于起始" + warn_cond, $(obj).parents('.bb-sel-item').find('input:visible').eq(6));
				return false;
			}
			if (parseInt(s_e) < parseInt(s_s)){
				_alert(2, "报表条件", '结束' + warn_cond + "不能小于起始" + warn_cond, $(obj).parents('.bb-sel-item').find('input:visible').eq(7));
				return false;
			}
			
		}else{
			var f_v = $(obj).parents('.bb-sel-item').find('input:visible').eq(0).val();
			var l_v = $(obj).parents('.bb-sel-item').find('input:visible').eq(1).val();
			if (f_v == ""){
				_alert(2, "报表条件", warn_cond + '不能为空',$(obj).parents('.bb-sel-item').find('input:visible').eq(0));
				return false;
			}
			if (inputReg != "" && !inputReg.test(f_v)){
				_alert(2, "报表条件", warn_cond + '格式不正确',$(obj).parents('.bb-sel-item').find('input:visible').eq(0));
				return false;
			}
			
			if (l_v == ""){
				_alert(2, "报表条件", warn_cond + '不能为空',$(obj).parents('.bb-sel-item').find('input:visible').eq(1));
				return false;
			}
			if (inputReg != "" && !inputReg.test(l_v)){
				_alert(2, "报表条件", warn_cond + '格式不正确',$(obj).parents('.bb-sel-item').find('input:visible').eq(1));
				return false;
			}
			if (tr_type == "number"){
				if (parseInt(l_v) < parseInt(f_v)){
					_alert(2, "报表条件", '结束' + warn_cond + "不能小于起始" + warn_cond, $(obj).parents('.bb-sel-item').find('input:visible').eq(1));
					return false;
				}
			}else if (tr_type == "ip"){
				var ip_r = _compare_ip(f_v,l_v);
				if (ip_r == 1 || ip_r == 2){ //1相等 2大于 3小于
					_alert(2, "报表条件", '结束' + warn_cond + "不能小于起始" + warn_cond, $(obj).parents('.bb-sel-item').find('input:visible').eq(1));
					return false;
				}
			}
			/*else if (tr_type == "time"){
				var time_r = _compare_time(f_v,l_v);
				if (time_r == 1){
					_alert(2, "报表条件", '结束' + warn_cond + "不能小于起始" + warn_cond, $(obj).parents('.bb-sel-item').find('input:visible').eq(1));
					return false;
				}
			}
			*/
		}
		var isexist = 0;
		$.each($(obj).parents('.bb-sel-cont').children('.bb-sel-item').not($(obj).parents('.bb-sel-item')),function(i,item){
			if (tr_type == "ip" && (td3_sel == 'equal' || td3_sel == "not equal")){
				var sel_v = $(item).find('select:visible').val();
								var input_v = $(item).find('input').val();
																if (input_len == 0){
					n_v = v.split('-')[0];
				}else{
					n_v = v;
				}
				if (sel_v == 0){
					if (input_v == n_v){
						isexist = 1;
						_alert(2,"报表条件",warn_cond + '已存在',$(obj).parents('.bb-sel-item').find('input'));
						return false;
					}
				}else{
					if (sel_v.split('-')[0] == n_v){
						isexist = 1;
						_alert(2,"报表条件",warn_cond + '已存在');
						return false;
					}
				}
				return true;
			}
			if (input_len == 0){
				if (v == $(item).find('select:visible').val()){
					isexist = 1;
					_alert(2,"报表条件",warn_cond + '已存在');
					return false;
				}
			}else if (input_len == 1){
				if ($(item).find('input:visible').val() == v){
					isexist = 1;
					_alert(2,"报表条件",warn_cond + '已存在',$(obj).parents('.bb-sel-item').find('input:visible'));
					return false;
				}
			}else if (input_len == 2){
				var item_f_v = $(item).find('input:visible').eq(0).val();
				var item_l_v = $(item).find('input:visible').eq(1).val();
				if (f_v == item_f_v && l_v == item_l_v){
					isexist = 1;
					_alert(2,"报表条件",warn_cond + '区间已存在',$(obj).parents('.bb-sel-item').find('input:visible').eq(1));
					return false;
				}
			}else if (input_len == 4){
				var item_ytd = $(item).find('input:visible').eq(0).val();
				var item_h = $(item).find('input:visible').eq(1).val();
				var item_m = $(item).find('input:visible').eq(2).val();
				var item_s = $(item).find('input:visible').eq(3).val();
				if (item_ytd == ytd && item_h == h && item_m == m && item_s == s){
					isexist = 1;
					_alert(2,"报表条件",warn_cond + '已存在',$(obj).parents('.bb-sel-item').find('input:visible').eq(3));
					return false;
				}
			}else if (input_len == 8){
				var item_ytd_s = $(item).find('input:visible').eq(0).val();
				var item_h_s = $(item).find('input:visible').eq(1).val();
				var item_m_s = $(item).find('input:visible').eq(2).val();
				var item_s_s = $(item).find('input:visible').eq(3).val();
				var item_ytd_e = $(item).find('input:visible').eq(4).val();
				var item_h_e = $(item).find('input:visible').eq(5).val();
				var item_m_e = $(item).find('input:visible').eq(6).val();
				var item_s_e = $(item).find('input:visible').eq(7).val();
				
				if (item_ytd_s == ytd_s && item_h_s == h_s && item_m_s == m_s && item_s_s == s_s && item_ytd_e == ytd_e && item_h_e == h_e && item_m_e == m_e && item_s_e == s_e){
					isexist = 1;
					_alert(2,"报表条件",warn_cond + '区间已存在',$(obj).parents('.bb-sel-item').find('input:visible').eq(7));
					return false;
				}
			}
		});
		if (isexist == 1){
			return false;
		}
		return true;
	}
	
	function _compare_time(begin,end){
		 var d1 = new Date(begin.replace(/\-/g, "\/"));
		 var d2 = new Date(end.replace(/\-/g, "\/"));  

		 if(d1 >d2){  
			return 1;
		 }
		 return 0;
	}
	
    function _itemAdd(obj){
        var $c = $(obj).parents('div.bb-sel-item').clone();
		var test_r = test_input(obj);
		if (test_r == false){
			return false;
		}
		
		$(obj).parents('div.bb-sel-item').before($c);
		$c.find('input').val('');
		bind_date($c);
		/*
        var now = new Date();
        var setDate = {
            year: now.getFullYear(),
            month: now.getMonth() + 1,
            day: now.getDate()
        }

        setDate = setDate.year + '-' + setDate.month + '-' + setDate.day;
        $c.children('input.datepicker').each(function(i, item) {
            $(item).jeDate({
                format: "YYYY-MM-DD hh:mm:ss",
                isTime: true,
                maxDate: setDate + " 23:59:59"
            });

            if (i == 0) {
                $(item).val(setDate + " 00:00:00");
            } else {
                $(item).val(setDate + " 23:59:59");
            }
        })
		*/
        $('.select2',$c).remove();
        $('select',$c).trigger('change').select2();
        //$(obj).parents('div.bb-sel-item').before($c);
    }

    function _itemDel(obj){
        var $_obj = $(obj).parent().parent()
        $_obj.fadeOut(function() {
            $_obj.remove();
        })
    }

    function _getHostGroup(obj){
        parent.__getHostGroup();

        $_hostGroupObj = $(obj);
    }

    function __setHostGroup(data){
        _setHostGroup(data,$_hostGroupObj)
    }

    function _setHostGroup(data,obj){
        var $_p = obj.parents('div.bb-sel-cont');
        var hgIds = new Array();
        $('input.forgroup:visible',$_p).each(function(){
            var hgid = $(this).attr('group');

            if(hgid){
                hgIds.push(parseInt(hgid));
            }
        })
		
						$.each(data,function(i,item){
			var isexist = 0;
			var path = item.path.split('/');
			$.each(path,function(i2,item2){
				if (item2 == 0){
					return true;
				}
				if ($.inArray(parseInt(item2),hgIds) != -1){
										isexist = 1;
					return false;
				}
			});
			if (isexist == 0){
				var $_c = $(obj).parents('div.bb-sel-item').clone();
                $_p.append($_c);
                $_c.find('input.forgroup').val(item.name).attr('group',item.id).attr('title',item.name);
			}
		});
		/*
        $.each(data,function(i,item){
            if($.inArray(item.id,hgIds) < 0){
                var $_c = $(obj).parents('div.bb-sel-item').clone();
                $_p.append($_c);
                $_c.find('input.forgroup').val(item.name).attr('group',item.id).attr('title',item.name);
            }
        })
		*/
        parent._closeHgLayer();
    }

    function _setDeAddr(obj){
        var v = $(obj).val();
        var $c = $(obj).parents('div.bb-sel-item').children('input');

        if(v == 0 || v == '0'){
            $c.show();
            $(obj).next('.select2').removeClass('bb-sel-sg');
        }else{
            $c.hide();
             $(obj).next('.select2').addClass('bb-sel-sg');
        }
    }
	
	function execute_rpt(){
		var begin_each = 0;
		var test_r = true;
		
		
		var ytd_l_v = $(".bitem.srItem").eq(0).find('input:eq(0)').val();
		var l_v = ytd_l_v + ' '+ '00:00:00';
		var overtime = Date.parse(new Date(l_v));
		var nowtime = Date.parse(new Date());
		if (overtime > nowtime){
			_alert(1,"报表条件","结束时间不能大于当前时间");
			return false;
		}
		
		
		$("#bbCont").find('.bitem').each(function(i,item){
			if ($(item).children('div:eq(0)').text() != "入库时间：" && begin_each == 0){
				return true;
			}
			begin_each = 1;
			var datatype = $(item).data('type');	
			var action = $(item).find('.bb-sel-type').find('select').val();
						if (action != 0){
				$(item).find('.bb-sel-cont').find('a.add').each(function(i1,item1){
					if (i1 == 0 && $(item).find('.bb-sel-cont').find('a.add').length != 1){
						
					}else{
						if (action == "ingroup"){
							if ($(item1).parent().prev('input').val() == ""){
								_alert(2,"报表条件","请选择主机组");
								test_r = false;
								return false;
							}
						}else{
							test_r = test_input(item1);
							if (test_r == false){
								return false;
							}
						}
					}
					
				});
				if (test_r == false){
					return false;
				}
			}
		});
		if (test_r == false){
			return false;
		}
		var hgid_array = [];
		var timestamp = Date.parse(new Date()).toString().substring(0,10);
		var RptSugg = $("#RptSugg").val();
		if (RptSugg != ""){
			//RptSugg = "B64:" + window.btoa(RptSugg);
			RptSugg = RptSugg;
		}
		var xml_str = '<?xml version="1.0" encoding="UTF-8"?><Report>\n\t<RptName>';
		xml_str = xml_str + rpt_json.RptName + '</RptName>\n\t<RptMemo>'+rpt_json.RptMemo+'</RptMemo>\n\t<RptSugg>'+RptSugg+'</RptSugg>\n\t<RptUser>'+rpt_json.RptUser+'</RptUser>\n\t<RptTime>'+timestamp+'</RptTime>\n\t<RptLoad>adreport_adapt.so</RptLoad>\n';
		
		if (rpt_json.RptFormat.DataFormat == "未指定"){
			var dataformat = $("#DataFormat").val();
		}else{
			var dataformat = rpt_json.RptFormat.DataFormat;
		}
		//计划任务
		var task_time = 0;
		var rptformat = "";
		var RptFormat_time = $("#bbCont").find('div.bitem:eq(3)').find(".bb-switch-text").text();
		if (RptFormat_time == "关闭"){
			rptformat = dataformat+'/DYNAMIC/-';
		}else{
			if ($("#every_day").prop('checked')){
				rptformat = rptformat + '/DAY';
				task_time = task_time + 1;
			}
			if ($("#every_week").prop('checked')){
				rptformat = rptformat + '/WEEK';
				task_time = task_time + 2;
			}
			if ($("#every_mon").prop('checked')){
				rptformat = rptformat + '/MONTH';
				task_time = task_time + 4;
			}
			if (task_time == 0){
				_alert(2,"报表条件","请选择计划任务周期");
				return false;
			}
			rptformat = dataformat + '/STATIC' + rptformat;
		}
		xml_str = xml_str + '\t<RptFormat>' + rptformat + '</RptFormat>\n';
		//邮件接收
		var mailReg = /^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]+)+)$/;
		var RptMail = $("#bbCont").find('div.bitem:eq(4)').find(".bb-switch-text").text();
		if (RptMail == "关闭"){
			xml_str = xml_str + '\t<RptMail></RptMail>\n';
		}else{
			var mailinput = $("#mailinput").val();
			if (mailinput == ""){
				_alert(2,"报表条件","请填写邮箱地址",$("#mailinput"));
				return false;
			}else{
				if (!mailReg.test(mailinput)){
					_alert(2,"报表条件","邮箱格式不正确",$("#mailinput"));
					return false;
				}
			}
			if($('#combine').prop('checked')){
				mailinput='combine:'+mailinput;
			}
			xml_str = xml_str + '\t<RptMail>'+mailinput+'</RptMail>\n';
		}
		var cont_str = "";
		if (rpt_json.RptCont.indexOf('chart-') === -1){
			cont_str = "catalog/abstract/chart/";
		}else{
			cont_str = "catalog/abstract/-/";
		}
		if (rpt_json.RptCont.indexOf('layer-') === -1){
			cont_str = cont_str + "layer";
		}else{
			cont_str = cont_str + "-";
		}
		xml_str = xml_str + '\t<RptCont>'+cont_str+'</RptCont>\n';
		var cond_str = "";
		$.each(rpt_json.RptCond,function(i,item){
			cond_str = cond_str + item.field + '.' + item.index + ',';
		});
		if (cond_str != ""){
			cond_str = cond_str.substring(0,cond_str.length-1);
		}
		xml_str = xml_str + '\t<RptCond>' + cond_str + '</RptCond>\n';

		//天是1 小时2 分钟3
		var layer = "";
		$.each(rpt_json.RptBuild.layer,function(i,item){
			var sort_num = 1;
			var groupstat = "";
			var groupstat_array = item.groupstat.sort(sort_data);
			var pre_group = 0;
			$.each(groupstat_array,function(i1,item1){
				var Grouped;
				var GroupIndex;
				if (item1.Grouped == "true"){
					Grouped = 'y';
				}else{
					Grouped = 'n';
				}
				var GroupUnit;
				if (item1.GroupUnit == "day"){
					GroupUnit = 1;
				}else if (item1.GroupUnit == "hour"){
					GroupUnit = 2;
				}else if (item1.GroupUnit == "minute"){
					GroupUnit = 3;
				}else{
					GroupUnit = 0;
				}
				if (item1.GroupIndex != i1 + 1){
					if (item1.GroupIndex == pre_group){
						GroupIndex = sort_num;
					}else{
						GroupIndex = sort_num + 1;
					}
					pre_group = item1.GroupIndex;
					sort_num = GroupIndex;
				}else{
					GroupIndex = parseInt(item1.GroupIndex);
					sort_num = GroupIndex;
					pre_group = item1.GroupIndex;
				}
				if (item.style == "detail"){
					//groupstat = groupstat + item1.field + '.' + item1.Index + '.' + item1.GroupIndex + ',';
					groupstat = groupstat + item1.field + '.' + item1.Index + '.' + GroupIndex + ',';
				}else{
					////console.log("groupstat1:"+groupstat);
					////console.log(item1);
					if (Grouped == 'n'){
						//groupstat = groupstat + item1.Field + '.' + item1.Index + '.' + Grouped + '.' + GroupUnit + '.' + item1.GroupIndex + '.' + item1.GroupInnerIndex + '.' + item1.StatMethod+',';
						groupstat = groupstat + item1.Field + '.' + item1.Index + '.' + Grouped + '.' + GroupUnit + '.' + GroupIndex + '.' + item1.GroupInnerIndex + '.' + item1.StatMethod+',';
					}else{
						//groupstat = groupstat + item1.Field + '.' + item1.Index + '.' + Grouped + '.' + GroupUnit + '.' + item1.GroupIndex + '.' + item1.GroupInnerIndex + ',';
						////console.log("item1.GroupInnerIndex:"+item1.GroupInnerIndex);
						groupstat = groupstat + item1.Field + '.' + item1.Index + '.' + Grouped + '.' + GroupUnit + '.' + GroupIndex + '.' + item1.GroupInnerIndex + ',';
					}
				}
				
			});
			if (groupstat != ""){
				////console.log("groupstat:"+groupstat);
				groupstat=groupstat.substring(0,groupstat.length-1);
                                groupstat_arr=groupstat.split(',');
				function sore_str(str1,str2){
                                        arr1=str1.split('.');
                                        arr2=str2.split('.');
                                        if(parseInt(arr1[4]) > parseInt(arr2[4])){
                                                return 1;
                                        }else if(parseInt(arr1[4]) < parseInt(arr2[4])){
                                                return -1;
                                        }else if(parseInt(arr1[5]) > parseInt(arr2[5])){
                                                return 1;
                                        }else if(parseInt(arr1[5]) < parseInt(arr2[5])){
                                                return -1;
                                        }
                                }
                                groupstat_arr=groupstat_arr.sort(sore_str);
                                groupstat=groupstat_arr.join(',');
				groupstat = '\t\t\t<group>' + groupstat + '</group>\n';
			}
			//'<group_1>f.+.n.-,n,n</group_1>'
			$.each(item.config,function(i1,item1){
				var group_v = "";
				if (item1.Sort == "64"){
					group_v = 'v.';
				}else if (item1.Sort == "32"){
					group_v = 'f.';
				}else{
					group_v = 'n.';
				}
				if (item1.Sorttrue){
					group_v = group_v + '+.';
				}else{
					group_v = group_v + '-.';
				}
				if (item1.StatValueShow){
					group_v = group_v + 'y.';
				}else{
					group_v = group_v + 'n.';
				}
							
				if (item1.Split){
					group_v = group_v + 's,';
				}else if (item1.Lascande){
					group_v = group_v + '*,';
				}else{
					group_v = group_v + '-,';
				}
				
				if (item1.ShowFilter.opened){
					group_v = group_v + 'y.';
					if (item1.ShowFilter.top != 0){
						group_v = group_v + 'y' + item1.ShowFilter.top + '.';
					}else{
						group_v = group_v + 'n.';
					}
					if (item1.ShowFilter.bottom != 0){
						group_v = group_v + 'y' + item1.ShowFilter.bottom + '.';
					}else{
						group_v = group_v + 'n.';
					}
					if (item1.max){
						group_v = group_v + 'y.';
					}else{
						group_v = group_v + 'n.';
					}
					if (item1.min){
						group_v = group_v + 'y,';
					}else{
						group_v = group_v + 'n,';
					}
				}else{
					group_v = group_v + 'n,';
				}
				if (item1.Condition.opened){
					group_v = group_v + 'y.'+item1.Condition.action + '.' + item1.Condition.value[0];
				}else{
					group_v = group_v + 'n';
				}
				groupstat = groupstat + '\t\t\t<group_'+item1.GroupIndex+'>'+group_v+'</group_'+item1.GroupIndex+'>\n';
			});
			/*
			var expand;
			if (item.expand){
				expand = '\t\t\t<expand>true</expand>\n';
			}else{
				expand = '\t\t\t<expand>false</expand>\n';
			}
			*/
			if (i == 0 && $("#mingxibaobiao").prop('checked')){
				expand = '\t\t\t<expand>true</expand>\n'; 
			}else{
				expand = '\t\t\t<expand>false</expand>\n';
			}
			layer = layer + '\t\t<layer>\n\t\t\t<level>' + item.level + '</level>\n\t\t\t<style>' + item.style +'</style>\n\t\t\t<template>' + item.template + '</template>\n\t\t\t<page>' + item.page +'</page>\n' + groupstat + expand + '\t\t</layer>\n';
		});
		xml_str = xml_str + '\t<RptBuild>\n\t\t<abstract></abstract>\n' + layer + '\t</RptBuild>\n';

		var KeyLogType;
		if (rpt_json.SearchDef.KeyLogType == 1){
			KeyLogType = "NORMAL";
		}else if (rpt_json.SearchDef.KeyLogType == 2){
			KeyLogType = "SESSION";
		}else if (rpt_json.SearchDef.KeyLogType == 3){
			KeyLogType = "SYSTEM";
		}else{
			var logtype = $("#rzsx").val();
			if (logtype == 1){
				KeyLogType = "NORMAL";
			}else{
				KeyLogType = "SESSION";
			}
		}
		var KeyLogType_str = '\t\t<KeyLogType>'+KeyLogType+'</KeyLogType>\n';
		var KeyCondition = "";
		$.each(rpt_json.SearchDef.KeyRule.KeyCondition,function(i,item){
			if (item.selectop == 1){
				var field = item.field;
				var index = item.index;
				if (parseInt(index) < 10){
					index = '0' + index;
				}
				var cond_v = "";
				switch(item.action){
					case "ingroup"://id:v
						$.each(item.value,function(i1,item1){
							var hg_id = item1.split(':');
							hgid_array.push(hg_id[0]);
							cond_v = cond_v + '\t\t\t\t<value action="ingroup">'+hg_id[0]+'</value>\n';
						});
						break;
					case "not equal":
					case "not include":
					case "not regx":
					case "not ncregx":
						var action_v = item.action.split(' ')[1];
						if (item.type == 'ip'){
							$.each(item.value,function(i1,item1){
								var ip_id = item1.split('-');
								if (ip_id.length == 1){
									cond_v = cond_v + '\t\t\t\t<value not="y" action="'+action_v+'">'+item1+'</value>\n';
								}else{//v-id
									cond_v = cond_v + '\t\t\t\t<value not="y" action="'+action_v+'">'+ip_id[0]+'</value>\n';
								}
							});
						}else if(item.type == 'select'){//id:v
							$.each(item.value,function(i1,item1){
								var sel_id = item1.split(':');
								if (field == "5" && index == "15"){
									cond_v = cond_v + '\t\t\t\t<value not="y" action="'+action_v+'">'+parseInt(sel_id[0],16)+'</value>\n';
								}else{
									cond_v = cond_v + '\t\t\t\t<value not="y" action="'+action_v+'">'+sel_id[0]+'</value>\n';
								}
							});
						}else{
							$.each(item.value,function(i1,item1){
								cond_v = cond_v + '\t\t\t\t<value not="y" action="'+action_v+'">'+item1+'</value>\n';
							});
						}
						break;
					case "equal":
					case "high":
					case "ehigh":
					case "low":
					case "elow":
					//case "not equal":
					case "begin":
					case "end":
					case "include":
					//case "not include":
					case "regx":
					//case "not regx":
					case "ncregx":
					//case "not ncregx":
					case "match":
						if (item.type == 'ip'){
							$.each(item.value,function(i1,item1){
								var ip_id = item1.split('-');
								if (ip_id.length == 1){
									cond_v = cond_v + '\t\t\t\t<value action="'+item.action+'">'+item1+'</value>\n';
								}else{//v-id
									cond_v = cond_v + '\t\t\t\t<value action="'+item.action+'">'+ip_id[0]+'</value>\n';
								}
							});
						}else if(item.type == 'select'){//id:v
							$.each(item.value,function(i1,item1){
								var sel_id = item1.split(':');
								if (field == "5" && index == "15"){
									cond_v = cond_v + '\t\t\t\t<value action="'+item.action+'">'+parseInt(sel_id[0],16)+'</value>\n';
								}else{
									cond_v = cond_v + '\t\t\t\t<value action="'+item.action+'">'+sel_id[0]+'</value>\n';
								}
							});
						}else if (item.type == "time"){
							$.each(item.value,function(i1,item1){
								var timestamp = Date.parse(new Date(item1));
								timestamp = timestamp / 1000;
								cond_v = cond_v + '\t\t\t\t<value action="'+item.action+'">'+timestamp+'</value>\n';
							});
						}else{
							$.each(item.value,function(i1,item1){
								cond_v = cond_v + '\t\t\t\t<value action="'+item.action+'">'+item1+'</value>\n';
							});
						}
						break;
					case "between":
					case "span":
					case "ehspan":
					case "elspan":
						$.each(item.value,function(i1,item1){
							if (item.type == "ip"){
								cond_v = cond_v + '\t\t\t\t<value action="'+item.action+'">'+item1+'</value>\n';
							}else if (item.type == "time"){
								var time_str = item1.split(';');
								var timestamp1 = Date.parse(new Date(time_str[0]));
								timestamp1 = timestamp1 / 1000;
								var timestamp2 = Date.parse(new Date(time_str[1]));
								timestamp2 = timestamp2 / 1000;
								cond_v = cond_v + '\t\t\t\t<value action="'+item.action+'">'+timestamp1+';'+timestamp2+'</value>\n';
							}else{
								cond_v = cond_v + '\t\t\t\t<value action="'+item.action+'">'+item1[0]+';'+item1[1]+'</value>\n';
							}
						});
						break;
					default:
						parent._errLayer('数据错误',"修改模板");
						return false;
				}
				KeyCondition = KeyCondition + '\t\t\t<KeyCondition field="'+field_key[field]+'" index="'+index+'">\n' + cond_v + '\t\t\t</KeyCondition>\n';
			}
		});
		xml_str = xml_str + '\t<SearchDef>\n' + KeyLogType_str + '\t\t<KeyRule>\n' + KeyCondition + '\t\t</KeyRule>\n\t</SearchDef>\n';
		var each_flag = 0;

		var SearchSet = '';
		var KeyCondition = "";
		$("#bbCont").find('.bitem').each(function(i,item){
			if ($(item).children('div:eq(0)').text() != "入库时间：" && each_flag == 0){
				return true;
			}
			
			each_flag = 1;
			var field = $(item).attr('field');
			var index = $(item).attr('index');
			if (parseInt(index) < 10){
				index = '0' + index;
			}
			var datatype = $(item).data('type');	
			var action = $(item).find('.bb-sel-type').find('select').val();
			var cond_v = "";
			switch(action){
				case "ingroup":
					$(item).find('.bb-sel-cont').each(function(i1,item1){
						var v_id = $(item1).find('input').attr('group');
						if (v_id != "" && v_id != undefined){
							if (hgid_array.indexOf(v_id) != -1){
								hgid_array.push(v_id);
							}
							cond_v = cond_v + '\t\t\t\t<value action="ingroup">'+v_id+'</value>\n';
							return true;
						}
					});
					break;
				case "not equal":
				case "not include":
				case "not regx":
				case "not ncregx":
					var bbc_action = action.split(' ')[1];
					if (datatype == 'ip'){
						$(item).find('.bb-sel-cont').children('.bb-sel-item').each(function(i1,item1){
							var v = $(item).find('input').val();
							var v1 = $(item).find('select').val();
							if (v != ""){
								cond_v = cond_v + '\t\t\t\t<value not="y" action="'+bbc_action+'">'+v+'</value>\n';
								return true;
							}
							if (v1 != "0"){
								cond_v = cond_v + '\t\t\t\t<value not="y" action="'+bbc_action+'">'+v1+'</value>\n';
								return true;
							}
						});
					}else if(datatype == 'select'){//id:v
						$(item).find('.bb-sel-cont').children('.bb-sel-item').each(function(i1,item1){
							var op_v = $(item1).find('select').val();
							if (field == "5" && index == "15"){
								cond_v = cond_v + '\t\t\t\t<value not="y" action="'+bbc_action+'">'+parseInt(op_v,16)+'</value>\n';
							}else{
								cond_v = cond_v + '\t\t\t\t<value not="y" action="'+bbc_action+'">'+op_v+'</value>\n';
							}
						});
					}else{
						$(item).find('.bb-sel-cont').children('.bb-sel-item').each(function(i1,item1){
							if (datatype == "time"){
								var ytd_v = $(item1).find('input:eq(0)').val();
								var h_v = $(item1).find('input:eq(1)').val();
								var m_v = $(item1).find('input:eq(2)').val();
								var s_v = $(item1).find('input:eq(3)').val();
								var v = ytd_v + ' ' + h_v + ':' + m_v + ':' + s_v;
								v = Date.parse(new Date(v));
								v = v / 1000;
							}else{
								var v = $(item1).find('input').val();
							}
							if (v != ""){
								cond_v = cond_v + '\t\t\t\t<value not="y" action="'+bbc_action+'">'+v+'</value>\n';
							}
						});
					}
					break;
				case "equal":
				//case "not equal":
				case "high":
				case "ehigh":
				case "low":
				case "elow":
				case "begin":
				case "end":
				case "include":
				//case "not include":
				case "regx":
				//case "not regx":
				case "ncregx":
				//case "not ncregx":
				case "match":
					if (datatype == 'ip'){
						$(item).find('.bb-sel-cont').children('.bb-sel-item').each(function(i1,item1){
							var v = $(item).find('input').val();
							var v1 = $(item).find('select').val();
							if (v != ""){
								cond_v = cond_v + '\t\t\t\t<value action="'+action+'">'+v+'</value>\n';
								return true;
							}
							if (v1 != "0"){
								cond_v = cond_v + '\t\t\t\t<value action="'+action+'">'+v1+'</value>\n';
								return true;
							}
						});
					}else if(datatype == 'select'){//id:v
						$(item).find('.bb-sel-cont').children('.bb-sel-item').each(function(i1,item1){
							var op_v = $(item1).find('select').val();
							if (field == "5" && index == "15"){
								cond_v = cond_v + '\t\t\t\t<value action="'+action+'">'+parseInt(op_v,16)+'</value>\n';
							}else{
								cond_v = cond_v + '\t\t\t\t<value action="'+action+'">'+op_v+'</value>\n';
							}
						});
					}else{
						$(item).find('.bb-sel-cont').children('.bb-sel-item').each(function(i1,item1){
							if (datatype == 'time'){
								var ytd_v = $(item1).find('input:eq(0)').val();
								var h_v = $(item1).find('input:eq(1)').val();
								var m_v = $(item1).find('input:eq(2)').val();
								var s_v = $(item1).find('input:eq(3)').val();
								var v = ytd_v + ' ' + h_v + ':' + m_v + ':' + s_v;
								v = Date.parse(new Date(v));
								v = v / 1000;
							}else{
								var v = $(item1).find('input').val();
							}
							if (v != ""){
								cond_v = cond_v + '\t\t\t\t<value action="'+action+'">'+v+'</value>\n';
							}
						});
					}
					break;
				case "between":
				case "span":
				case "ehspan":
				case "elspan":
					$(item).find('.bb-sel-cont').children('.bb-sel-item').each(function(i1,item1){
						if (datatype == 'time'){
							var ytd_f_v = $(item1).find('input:eq(0)').val();
							var h_f_v = $(item1).find('input:eq(1)').val();
							var m_f_v = $(item1).find('input:eq(2)').val();
							var s_f_v = $(item1).find('input:eq(3)').val();
							var f_v = ytd_f_v + ' ' + h_f_v + ':' + m_f_v + ':' + s_f_v;
							var ytd_l_v = $(item1).find('input:eq(4)').val();
							var h_l_v = $(item1).find('input:eq(5)').val();
							var m_l_v = $(item1).find('input:eq(6)').val();
							var s_l_v = $(item1).find('input:eq(7)').val();
							var l_v = ytd_l_v + ' ' + h_l_v + ':' + m_l_v + ':' + s_l_v;
							f_v = Date.parse(new Date(f_v));
							f_v = f_v / 1000;
							l_v = Date.parse(new Date(l_v));
							l_v = l_v / 1000;
						}else{
							var f_v = $(item1).find('input:eq(0)').val();
							var l_v = $(item1).find('input:eq(1)').val();
						}
						cond_v = cond_v + '\t\t\t\t<value action="'+action+'">'+f_v+';'+l_v+'</value>\n';
					});
					break;
				case "0":
					break;
				default:
					var ytd_f_v = $(item).find('input:eq(0)').val();
					var h_f_v = $(item).find('input:eq(1)').val();
					var m_f_v = $(item).find('input:eq(2)').val();
					var s_f_v = $(item).find('input:eq(3)').val();
					var f_v = ytd_f_v + ' ' + h_f_v + ':' + m_f_v + ':' + s_f_v;
					var ytd_l_v = $(item).find('input:eq(4)').val();
					var h_l_v = $(item).find('input:eq(5)').val();
					var m_l_v = $(item).find('input:eq(6)').val();
					var s_l_v = $(item).find('input:eq(7)').val();
					var l_v = ytd_l_v + ' ' + h_l_v + ':' + m_l_v + ':' + s_l_v;
					var timestamp1 = Date.parse(new Date(f_v));
					timestamp1 = timestamp1 / 1000;
					var timestamp2 = Date.parse(new Date(l_v));
					timestamp2 = timestamp2 / 1000;
					cond_v = cond_v + '\t\t\t\t<value action="between">'+timestamp1+';'+timestamp2+'</value>\n';
			}
			if (cond_v != ""){
				KeyCondition = KeyCondition + '\t\t\t<KeyCondition field="'+field_key[field]+'" index="'+index+'">\n' + cond_v + '\t\t\t</KeyCondition>\n';
			}
		});
		xml_str = xml_str + '\t<SearchSet>\n\t\t<KeyRule>\n' + KeyCondition + '\t\t</KeyRule>\n\t</SearchSet>\n';
				if (task_time == 1 || task_time == 2 || task_time == 4){
			task_time = 1;
		}else if (task_time == 3 || task_time == 5 || task_time == 6){
			task_time = 2;
		}else if (task_time == 7){
			task_time = 3;
		}
		//return false;
		msstr = aceg(xml_str,se);
		$.ajax({
			url:'/bhost/execute_rpt',
			type:'post',
			async:false,
			data:{a0:se,z1:xml_str,z2:KeyLogType,z3:JSON.stringify(hgid_array),z4:task_time,z5:temp_id,z6:back_type,z9:manage_power_id.join('-'),m1:msstr},
			success:function(result){
				var exe_re = JSON.parse(result);
				if (exe_re.Result){
					//_alert(1,"报表条件","执行成功");
					parent._errLayer(0,"报表条件","执行成功");
					parent.$('div.bb-menu2').find('li.active>span').trigger('click');
					return false;
				}else{
					//_alert(2,"报表条件","执行失败");
					parent._errLayer(1,"报表条件",exe_re.ErrMsg);
					return false;
				}
			}
		});
		
		//PSaveDataReportTask
	}
	/*
	function _errLayer(msg,title){
		layer.open({
			type: 1,
			title: title,
			content: '<div class="layer-alert"><i class="alert warning"></i>'+msg+'</div>',
			btn: '确定',
			btnAlign: 'c',
			area: ['380px', '310px'],
			skin: 'layer-custom',
			scrollbar: false
		});
	}
	*/
	var field_key = {
		"0":"xtime",
		"1":"int08",
		"2":"int16",
		"3":"int32",
		"4":"ip",
		"5":"int64",
		"6":"str32"
	}
	
	function sort_data(obj1,obj2){
		if (obj1.GroupIndex > obj2.GroupIndex){
			return 1;
		}else if (obj1.GroupIndex < obj2.GroupIndex){
			return -1;
		}else{
			if (obj1.GroupInnerIndex < obj2.GroupInnerIndex){
				return -1;
			}else{
				return 1;
			}
		}
	}
	function _compare_ip(x, y) {
		var ip1 = x.split('.');
		var ip2 = y.split('.');
		for (var i1 = 0; i1 < 4; i1++) {
			if (parseInt(ip1[i1]) < parseInt(ip2[i1])) {
				return 3;
			} else if (parseInt(ip1[i1]) > parseInt(ip2[i1])) {
				return 2
			} else {

			}
		}
		return 1
	}
    </script>
</body>

</html>
