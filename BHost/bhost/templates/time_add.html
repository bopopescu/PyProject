<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>manager</title>
	<link rel="stylesheet" href="/manage/skin/icheck/minimal/blue.css">
	<link rel="stylesheet" href="/manage/css/select2.min.css">
	<link rel="stylesheet" href="/manage/css/style.css">
	<!-- <link rel="stylesheet" href="/manage/css/jquery.datepick.css"> -->
	<link rel="stylesheet" href="/manage/css/new-head.css">
	<link rel="stylesheet" href="/manage/css/jedate.css">
	<!--script-->
	<script src="/manage/js/jquery.min.js"></script>
	<script src="/manage/js/jquery.easing.js"></script>
	<script src="/manage/js/common.js"></script>
	<script src="/manage/js/layer.js"></script>
	<script src="/manage/js/select2.full.min.js"></script>
	<script src="/manage/js/jquery.plugin.js"></script>
	<!-- <script src="/manage/js/jquery.datepick.js"></script> -->
	<script src="/manage/js/icheck.min.js"></script>
	<script src="/manage/js/common_e.js"></script>
	<script src="/manage/js/jquery.jedate.min.js"></script>
	<style>
		.form-text2 {
			padding: 0 8px;
		}
		.form-c1 .srSort span:not(:first-child):not(:last-child) {
			margin-right: -1px;
		}
		.form-c1 .srSort .select2-container {
			float: left;
		}
		.form-c1 .srSort span.select2-container:not(:nth-child(2)) .select2-selection--single {
			border-top-left-radius: 0;
			border-bottom-left-radius: 0;
		}
		.form-c1 .srSort span.select2-container:not(:last-child) .select2-selection--single {
			border-top-right-radius: 0;
    		border-bottom-right-radius: 0;
		}
		.form-c1 .srSort span:not(:first-child) {
			border-top-left-radius: 0;
			border-bottom-left-radius: 0;
		}
		.form-c1 .srSort span:not(:last-child) {
			border-top-right-radius: 0;
    		border-bottom-right-radius: 0;
		}
		.h-content3 .item {
			width: auto;
			padding: 0 0 10px 0;
		}
	</style>
</head>

<body style="overflow:hidden;display:none;" class="bg-white">
	<!--时间集合添加或编辑-->
	<div class="rwrap">
		<div class="c-top">
			<div class="c-title">
				<div class="manual-head" style="float:left;width:100px">
					<div class="manual-title">
						<span id="time_group" style="cursor: pointer;">时间集合</span>
						<i class="time_group_icon"></i>
					</div>
				</div>

				<div class="ctr">
					<a href="javascript:;" class="ret" onclick="parent._closePage(this)">
						<i></i>
					</a>
				</div>
			</div>
		</div>
		<div class="mainer">

			<div class="container">
				<div class="c-cont">
					<div class="c-form" style="padding-bottom: 10px;">
						<div class="form">
							<div class="form-item" style="">
								<span class="form-tag">
									<em class="imp">*</em>名称：</span>
								<div class="form-c">
									<input type="text" class="form-text" id="d_n" name="d_n" onblur="regCheck(this,nameReg);" maxlength="128">
									<i class="v-check"></i>
									<p class="form-tip">特殊字符仅支持下划线、横杠、小数点</p>
								</div>
							</div>
							<div class="form-item" style="">
								<span class="form-tag" style="">描述：</span>
								<div class="form-c" style="">
									<input type="text" class="form-text form-text2" style="width:252px;" id="Description" name="Description" maxlength="128">
								</div>
							</div>
							<div class="form-item form-item-100" style="">
								<span class="form-tag">
									<em class="imp">*</em>设置：</span>
								<div class="h-content3 form-c1" name="time_all" id="time_all" style="padding-top: 0px;padding-left: 8px;">
									<div class="srSort item" id="srTemp-xtime" name="select_time" style="">
										<select class="filter-select" name="TimeType" style="width:62px;">
											<option value="1" selected>周期</option>
											<option value="2">区间</option>
											<option value="3">任务</option>
										</select>
										<select class="filter-select" name="TimeSetType" style="width:62px;">
											<option value="1" selected>每天</option>
											<option value="2">每周</option>
											<option value="3">每月</option>
										</select>
										<select class="filter-select" name="TimeSetType_t" style="width:62px;">
											<option value="1" selected>当前</option>
											<option value="2">当天</option>
										</select>
										<select class="filter-select" name="StartPeriod" style="width:62px;">
											<option value="1" selected>周一</option>
											<option value="2">周二</option>
											<option value="3">周三</option>
											<option value="4">周四</option>
											<option value="5">周五</option>
											<option value="6">周六</option>
											<option value="7">周日</option>
										</select>
										<span style="display:none;float: left;" name="StartPeriod_month">
											<input style="width: 20px;border-top-left-radius: 0;border-bottom-left-radius: 0;" name="s_month" type="text" class="form-text form-text2"
											placeholder="" value="01" onblur="dataCheck(this, 1, 31);add_zero(this);" onfocus="this.select()" onkeyup="dataCheck(this, 1, 31);">
											<span style="margin-right: 10px;">日</span>
										</span>
										<span class="stwrap" name="StartTime" style="display:none;">
											<input type="text" name="StartDate" value="" placeholder="日期" class="datepicker" readonly>
											<input style="" type="text" name="s_h" placeholder="时" class="timeinput" min="00" max="23" value="00">
											<span class="srTip">:</span>
											<input type="text" name="s_m" placeholder="分" class="timeinput" min="00" max="59" value="00">
											<span class="srTip">:</span>
											<input type="text" name="s_s" placeholder="秒" class="timeinput" min="00" max="59" value="00">
										</span>
										<span style="display:none;float: left;margin-left: 5px;margin-right: 5px;margin-top: 3px;" name="to">-</span>
										<select class="filter-select" name="EndPeriod" style="width:62px;">
												<option value="1">周一</option>
												<option value="2">周二</option>
												<option value="3">周三</option>
												<option value="4">周四</option>
												<option value="5">周五</option>
												<option value="6">周六</option>
												<option value="7" selected>周日</option>
											</select>
										<span style="display:none;float: left;" name="EndPeriod_month">
											<input style="width:20px;" type="text" name="e_month" class="form-text form-text2" placeholder=""
												value="31" onblur="dataCheck(this, 1, 31);add_zero(this);" onfocus="this.select()" onkeyup="dataCheck(this, 1, 31);">
											<span style="margin-right: 10px;">日</span>
										</span>
										<span class="stwrap" name="EndTime" style="display:none;">
											<input type="text" name="EndDate" value="" placeholder="日期" class="datepicker" readonly>
											<input style="" type="text" name="e_h" placeholder="时" class="timeinput" min="00" max="23" value="23">
											<span class="srTip">:</span>
											<input type="text" name="e_m" placeholder="分" class="timeinput" min="00" max="59" value="59">
											<span class="srTip">:</span>
											<input type="text" name="e_s" placeholder="秒" class="timeinput" min="00" max="59" value="59">
										</span>
										<i class="ctrl add" style="margin-top: 6px;margin-left: 10px;" onclick="_addTimeSet(this)"></i>
									</div>
									
								</div>
								<!--</div>-->
							</div>
						</div>
					</div>
					<div class="c-form">
						<div class="btns perm_disabled">
							<a href="javascript:;" class="btn btn-normal" onclick="timeset_add();">保&nbsp;&nbsp;存</a>
							<!-- <a href="javascript:;" class="btn btn-normal" onclick="timeset_list(0);">取&nbsp;&nbsp;消</a> -->
						</div>
						<div id="bBtn" style="position: fixed;z-index:5;">
							<a href="javascript:;" class="btn" style="float: right;" onclick="timeset_list(0);"><i class="icon-c3-1"></i>返&nbsp;&nbsp;&nbsp;&nbsp;回</a>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<form action="/bhost/timeset_handle" method="POST" name="frm_timeset_add" id="frm_timeset_add">
		<input type="hidden" name="tasktype" id="tasktype" value="{{ tasktype }}" />
		<!--创建 编辑 列表-->
		<input type="hidden" name="timesetId" id="timesetId" value="{{ timesetId }}" />
		<!--timesetId-->
		<input type="hidden" name="paging" id="paging" value="{{paging}}" />
		<!--页码-->
		<input type="hidden" name="search_typeall" id="search_typeall" value="{{search_typeall}}" />
		<!--search_typeall-->
		<input type="hidden" name="e" id="e" value="{{e}}" />
		<!--e-->
		<input type="hidden" name="se" id="se" value="{{se}}" />
		<!--se-->
	</form>

	<script>
		var perm={{perm}};
		if (perm==0) parent.parent.$('#nav-s1 a.active').click();
		else{
			$('.bg-white').show();
			if(perm==1){
				$('.perm_disabled').remove();
			}
		}
		$('.form-checkbox,.form-radio').iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue',
			increaseArea: '0' // optional
		});

	</script>



	<script>
		$('.filter-select,.form-select').select2({ minimumResultsForSearch: -1 });
		// $("input.datepicker").datepick();

	</script>

	<script>
		var timeset = {
			"TimeSetId": 0,
			"Name": "",
			"Description": null,
			"Set": new Array()
		};
		var nameReg = /^[\u4e00-\u9fa5a-zA-Z\d_\-\.]+$/;
		var ipReg=/(^(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.(25[0-4]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$)/;
		var ip_all_str = "";
		$(function () {
			$('input.datepicker').each(function(){
				$(this).jeDate({
					format:"YYYY-MM-DD",
					isTime:true,
				});
			})
			$(document).on('keydown','input.timeinput',function(){
				var i = $(this).index();        
				var v = $(this).val();
				v = v.replace(/[^\d]/g,'');
				$(this).val(v);
			}).on('keyup','input.timeinput',function(e){
				var i = $(this).index();
				var v = $(this).val();    
				var max = 23;
				if(i>1){
					max = 59;
				}

				if(v > max){
					v = max;
				}

				$(this).val(v);

				v = v.toString();
				if(v.length >= 2){
					$(this).val(v.substring(0,2));

					var keycode = e.keyCode;
					if(keycode != 9){
						$(this).next().next().focus();
					}
				}
			}).on('focus','input.timeinput',function(){
				$(this).select();
			}).on('blur','input.timeinput',function(){
				var v = $(this).val();
				v = v.toString();

				if(v == ''){
					v = '00';
				}else if(v.length == 1){
					v = '0' + v;
				}

				$(this).val(v);
			});
			document.frm_timeset_add.se.value = window.parent.document.frm.se.value;
			//输入数字
			$("#s_month,#s_h,#s_m,#s_s,#e_month,#e_h,#e_m,#e_s").bind('keydown', function (e) {
				DigitInput(e);
			});
			parent._switchBtn(0);//隐藏按钮
			var $item = $('#time_all').find('div[name=select_time]').eq(0);
			$item.find("select[name=TimeSetType_t]").next('span').hide();
			$item.find("select[name=EndPeriod]").next('span').hide();
			$item.find("select[name=StartPeriod]").next('span').hide();
			$item.find("span[name=StartPeriod_month]").hide();
			$item.find("input[name=StartDate]").hide();
			$item.find("span[name=StartTime]").attr('style','border-top-right-radius: 5px;border-bottom-right-radius: 5px;').show();
			$item.find("span[name=to]").show();
			$item.find("span[name=EndPeriod_month]").hide();
			$item.find("input[name=EndDate]").hide();
			$item.find("span[name=EndTime]").attr('style','border-top-left-radius: 5px;border-bottom-left-radius: 5px;border-top-right-radius: 5px;border-bottom-right-radius: 5px;').show();
			$item.find('span[name=EndTime_today]').hide();
			$item.find('input[name=s_h]').attr('style','padding-left: 5px;');
			$item.find('input[name=e_h]').attr('style','padding-left: 5px;');
			var now = new Date();
			var year = now.getFullYear();
			var month = ("0" + (now.getMonth() + 1)).slice(-2);
			var date = ("0" + now.getDate()).slice(-2);
			$item.find("input[name=StartDate]").val(year + "-" + month + "-" + date);
			$item.find("input[name=EndDate]").val(year + "-" + month + "-" + date);
			$('#time_all').on('change', 'select,input', function () {
				//console.log(this)
				//console.log('change' + this.type);
				var $item_i = $(this).parents('div.item');
				if (this.type != "text") {
					var select_name = $(this).attr('name');
					switch (select_name) {
						//周期 任务
						case 'TimeType':
							var timetype_i = $(this).val();
							//console.log(timetype_i);
							switch (timetype_i) {
								case "1":
									$item_i.find("select[name=TimeSetType]").val(1).trigger('change');
									$item_i.find("select[name=TimeSetType]").next('span').show();
									$item_i.find("select[name=TimeSetType_t]").next('span').hide();
									break;
								case "2":
									$item_i.find("select[name=TimeSetType_t]").next('span').hide();
									$item_i.find("select[name=TimeSetType]").next('span').hide();
									$item_i.find("select[name=StartPeriod]").next('span').hide();
									$item_i.find("span[name=StartPeriod_month]").hide();
									$item_i.find("input[name=StartDate]").show();
									$item_i.find("span[name=StartTime]").attr('style','border-top-right-radius: 5px;border-bottom-right-radius: 5px;').show();
									$item_i.find("span[name=to]").text('-').attr('style', 'margin-top: 3px;float: left;margin-left: 5px;margin-right: 5px;').show();
									$item_i.find("select[name=EndPeriod]").next('span').hide();
									$item_i.find("span[name=EndPeriod_month]").hide();
									$item_i.find("input[name=EndDate]").show();
									$item_i.find("span[name=EndTime]").attr('style','border-top-left-radius: 5px;border-bottom-left-radius: 5px;border-top-right-radius: 5px;border-bottom-right-radius: 5px;').show();
									$item_i.find("span[name=EndTime_today]").hide();
									$item_i.find('input[name=s_h]').attr('style','');
									$item_i.find('input[name=e_h]').attr('style','');
									break;
								case "3":
									$item_i.find("select[name=TimeSetType_t]").val(1).trigger('change');
									$item_i.find("select[name=TimeSetType]").next('span').hide();
									$item_i.find("select[name=TimeSetType_t]").next('span').show();
									$item_i.find("select[name=TimeSetType_t]").next('span').find('.select2-selection--single').attr('style','border-top-right-radius: 5px;border-bottom-right-radius: 5px;');
									$item_i.find('input[name=s_h]').attr('style','padding-left: 5px;');
									$item_i.find('input[name=e_h]').attr('style','padding-left: 5px;');
									break;
							}
							break;
						//每天每月每周
						case 'TimeSetType':
							var timesettype_i = $(this).val();
							switch (timesettype_i) {
								case "1":
									$item_i.find("select[name=StartPeriod]").next('span').hide();
									$item_i.find("span[name=StartPeriod_month]").hide();
									$item_i.find("input[name=StartDate]").hide();
									$item_i.find("span[name=StartTime]").attr('style','border-top-right-radius: 5px;border-bottom-right-radius: 5px;').show();
									$item_i.find("span[name=to]").text('-').attr('style', 'float: left;margin-left: 5px;margin-right: 5px;margin-top: 3px;').show();
									$item_i.find("div.div-br,span.span-br").remove();
									$item_i.find("select[name=EndPeriod]").next('span').hide();
									$item_i.find("span[name=EndPeriod_month]").hide();
									$item_i.find("input[name=EndDate]").hide();
									$item_i.find("span[name=EndTime]").attr('style','border-top-left-radius: 5px;border-bottom-left-radius: 5px;border-top-right-radius: 5px;border-bottom-right-radius: 5px;').show();
									$item_i.find("span[name=EndTime_today]").hide();
									$item_i.find('input[name=s_h]').attr('style','padding-left: 5px;');
									$item_i.find('input[name=e_h]').attr('style','padding-left: 5px;');
									break;
								case "2":
									$item_i.find("select[name=StartPeriod]").next('span').show();
									$item_i.find("span[name=StartPeriod_month]").hide();
									$item_i.find("input[name=StartDate]").hide();
									$item_i.find("span[name=StartTime]").attr('style','border-top-right-radius: 5px;border-bottom-right-radius: 5px;').show();
									$item_i.find("span[name=to]").text('-').attr('style', 'margin-top: 3px;float: left;margin-left: 5px;margin-right: 5px;').show();
									$item_i.find("select[name=EndPeriod]").next('span').show();
									$item_i.find("select[name=EndPeriod]").next('span').find('.select2-selection--single').attr('style','border-top-left-radius: 5px;border-bottom-left-radius: 5px;');
									$item_i.find("span[name=EndPeriod_month]").hide();
									$item_i.find("input[name=EndDate]").hide();
									$item_i.find("span[name=EndTime]").attr('style','border-top-right-radius: 5px;border-bottom-right-radius: 5px;').show();
									$item_i.find("span[name=EndTime_today]").hide();
									$item_i.find('input[name=s_h]').attr('style','padding-left: 5px;');
									$item_i.find('input[name=e_h]').attr('style','padding-left: 5px;');
									break;
								case "3":
									$item_i.find("select[name=StartPeriod]").next('span').hide();
									$item_i.find("span[name=StartPeriod_month]").show();
									$item_i.find("input[name=StartDate]").hide();
									$item_i.find("span[name=StartTime]").attr('style','border-top-left-radius: 5px;border-bottom-left-radius: 5px;border-top-right-radius: 5px;border-bottom-right-radius: 5px;').show();
									$item_i.find("span[name=to]").text('-').attr('style', '    margin-top: 3px;float: left;margin-left: 5px;margin-right: 5px;').show();
									$item_i.find("select[name=EndPeriod]").next('span').hide();
									$item_i.find("span[name=EndPeriod_month]").show();
									$item_i.find("input[name=EndDate]").hide();
									$item_i.find("span[name=EndTime]").attr('style','border-top-left-radius: 5px;border-bottom-left-radius: 5px;border-top-right-radius: 5px;border-bottom-right-radius: 5px;').show();
									$item_i.find("span[name=EndTime_today]").hide();
									$item_i.find('input[name=s_h]').attr('style','padding-left: 5px;');
									$item_i.find('input[name=e_h]').attr('style','padding-left: 5px;');
									break;
							}
							break;
						//当前当天
						case 'TimeSetType_t':
							var timesettype_i = $(this).val();
							switch (timesettype_i) {
								case "1":
									$item_i.find("select[name=StartPeriod]").next('span').hide();
									$item_i.find("span[name=StartPeriod_month]").hide();
									$item_i.find("input[name=StartDate]").hide();
									$item_i.find("span[name=StartTime]").hide();
									$item_i.find("span[name=to]").text('-').attr('style', 'margin-top: 3px;float: left;margin-left: 5px;margin-right: 5px;').show();
									$item_i.find("div.div-br,span.span-br").remove();
									$item_i.find("select[name=EndPeriod]").next('span').hide();
									$item_i.find("span[name=EndPeriod_month]").hide();
									$item_i.find("input[name=EndDate]").hide();
									$item_i.find("span[name=EndTime]").show();
									$item_i.find("span[name=EndTime_today]").show();
									$item_i.find("select[name=TimeSetType_t]").next('span').find('.select2-selection--single').attr('style','border-top-right-radius: 5px;border-bottom-right-radius: 5px;');
									break;
								case "2":
									$item_i.find("select[name=StartPeriod]").next('span').hide();
									$item_i.find("span[name=StartPeriod_month]").hide();
									$item_i.find("input[name=StartDate]").hide();
									$item_i.find("span[name=StartTime]").show();
									$item_i.find("span[name=to]").text('-').attr('style', 'float: left;margin-left: 5px;margin-right: 5px;margin-top: 3px;').show();
									$item_i.find("div.div-br,span.span-br").remove();
									$item_i.find("select[name=EndPeriod]").next('span').hide();
									$item_i.find("span[name=EndPeriod_month]").hide();
									$item_i.find("input[name=EndDate]").hide();
									$item_i.find("span[name=EndTime]").attr('style','border-top-left-radius: 5px;border-bottom-left-radius: 5px;border-top-right-radius: 5px;border-bottom-right-radius: 5px;').show();
									$item_i.find("span[name=EndTime_today]").hide();
									$item_i.find("select[name=TimeSetType_t]").next('span').find('.select2-selection--single').attr('style','');
									break;
							}
							break;
					}
				}
				var timetype_value = $item_i.find("select[name=TimeType]").val();
				switch (timetype_value) {
					case "1":
						var timesettype_value = $item_i.find("select[name=TimeSetType]").val();
						switch (timesettype_value) {
							case "1":
								var TimeSetType_str = "周期 每天";
								var TimeSetType_id = "11";
								var StartDate_str = null;
								var EndDate_str = null;
								var StartPeriod_str = null;
								var EndPeriod_str = null;
								var StartTime_str = "";
								$(">input.timeinput", $item_i.find("span[name=StartTime]")).each(function () {
									StartTime_str = StartTime_str + ('0' + $(this).val()).slice(-2) + ":";
								});
								StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
								var EndTime_str = "";
								$(">input.timeinput", $item_i.find("span[name=EndTime]")).each(function () {
									EndTime_str = EndTime_str + ('0' + $(this).val()).slice(-2) + ":";
								});
								EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
								break;
							case "2":
								var TimeSetType_str = "周期 每周";
								var TimeSetType_id = "12";
								var StartDate_str = null;
								var EndDate_str = null;
								var StartPeriod_str = $item_i.find("select[name=StartPeriod]").val();
								var EndPeriod_str = $item_i.find("select[name=EndPeriod]").val();
								var StartTime_str = "";
								$(">input.timeinput", $item_i.find("span[name=StartTime]")).each(function () {
									StartTime_str = StartTime_str + ('0' + $(this).val()).slice(-2) + ":";
								});
								StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
								var EndTime_str = "";
								$(">input.timeinput", $item_i.find("span[name=EndTime]")).each(function () {
									EndTime_str = EndTime_str + ('0' + $(this).val()).slice(-2) + ":";
								});
								EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
								break;
							case "3":
								var TimeSetType_str = "周期 每月";
								var TimeSetType_id = "13";
								var StartDate_str = null;
								var EndDate_str = null;
								var StartPeriod_str = ('0' + $item_i.find("span[name=StartPeriod_month]").children("input").val()).slice(-2);
								var EndPeriod_str = ('0' + $item_i.find("span[name=EndPeriod_month]").children("input").val()).slice(-2);;
								var StartTime_str = "";
								$(">input.timeinput", $item_i.find("span[name=StartTime]")).each(function () {
									StartTime_str = StartTime_str + ('0' + $(this).val()).slice(-2) + ":";
								});
								StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
								var EndTime_str = "";
								$(">input.timeinput", $item_i.find("span[name=EndTime]")).each(function () {
									EndTime_str = EndTime_str + ('0' + $(this).val()).slice(-2) + ":";
								});
								EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
								break;
						}
						break;
					case "2":
						var TimeSetType_str = "区间     "
						var TimeSetType_id = "20"
						var StartDate_str = $item_i.find("input[name=StartDate]").val();
						var EndDate_str = $item_i.find("input[name=EndDate]").val();
						var StartPeriod_str = null;
						var EndPeriod_str = null;
						var StartTime_str = "";
						$(">input.timeinput", $item_i.find("span[name=StartTime]")).each(function () {
							StartTime_str = StartTime_str + ('0' + $(this).val()).slice(-2) + ":";
						});
						StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
						var EndTime_str = "";
						$(">input.timeinput", $item_i.find("span[name=EndTime]")).each(function () {
							EndTime_str = EndTime_str + ('0' + $(this).val()).slice(-2) + ":";
						});
						EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
						break;
					case "3":
						var timesettype_t_value = $item_i.find("select[name=TimeSetType_t]").val();
						switch (timesettype_t_value) {
							case "1":
								var TimeSetType_str = "任务 当前";
								var TimeSetType_id = "31";
								var StartDate_str = null;
								var EndDate_str = null;
								var StartPeriod_str = null;
								var EndPeriod_str = null;
								var StartTime_str = null;
								var EndTime_str = "";
								$(">input.timeinput", $item_i.find("span[name=EndTime]")).each(function () {
									EndTime_str = EndTime_str + ('0' + $(this).val()).slice(-2) + ":";
								});
								EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
								// EndTime_str = EndTime_str + '00';
								break;
							case "2":
								var TimeSetType_str = "任务 当天";
								var TimeSetType_id = "32";
								var StartDate_str = null;
								var EndDate_str = null;
								var StartPeriod_str = null;
								var EndPeriod_str = null;
								var StartTime_str = null;
								var StartTime_str = "";
								$(">input.timeinput", $item_i.find("span[name=StartTime]")).each(function () {
									StartTime_str = StartTime_str + ('0' + $(this).val()).slice(-2) + ":";
								});
								StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
								var EndTime_str = "";
								$(">input.timeinput", $item_i.find("span[name=EndTime]")).each(function () {
									EndTime_str = EndTime_str + ('0' + $(this).val()).slice(-2) + ":";
								});
								EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
								break;
						}
						break;
				}
				switch (TimeSetType_id) {
					case "11":
						var time_all_str = TimeSetType_str + "  " + StartTime_str + "- " + EndTime_str;
						break;
					case "12":
						var time_all_str = TimeSetType_str + "  " + $item_i.find("select[name=StartPeriod]").children("option:selected").text() + StartTime_str + "- " + $item_i.find("select[name=EndPeriod]").children("option:selected").text() + EndTime_str;
						break;
					case "13":
						var time_all_str = TimeSetType_str + "  " + StartPeriod_str + "日 " + StartTime_str + "- " + EndPeriod_str + "日 " + EndTime_str;
						break;
					case "20":
						var time_all_str = TimeSetType_str + "  " + StartDate_str + " " + StartTime_str + "- " + EndDate_str + " " + EndTime_str;
						break;
					case "31":
						var time_all_str = TimeSetType_str + "  " + "- " + EndTime_str;
						break;
					case "32":
						var time_all_str = TimeSetType_str + "  " + StartTime_str + "- " + EndTime_str;
						break;
				}
				$item_i.attr('value', time_all_str);
			});
			//编辑界面
			var tasktype = document.frm_timeset_add.tasktype.value;
			if (tasktype == "2") {
				var timesetId = document.frm_timeset_add.timesetId.value;
				$.ajax({
					url: "/bhost/get_timeset_list",
					type: "POST",
					async: false,
					data: { a0: $("input[name=se]").val(), a1: timesetId },
					success: function (result) {
						var timeset_result = JSON.parse(result);
						if (timeset_result.Result == true) {
							var timeset_data = timeset_result.info.data[0];
							$("#d_n").val(timeset_data.Name);
							$("#d_n").attr("disabled", true);
							if (timeset_data.Description == null) {
								timeset_data.Description = "";
							};
							$("#Description").val(timeset_data.Description);
							for (var i = 0; i < timeset_data.Set.length - 1; i++) {
								var $item_div = $('#time_all').find('div[name=select_time]').eq(0);
								var $H = $item_div.clone();
								$H.attr('style', 'padding-top: 5px;width:100%;');
								$H.find('.select2').remove();
								$('.filter-select,.form-select', $H).select2({ minimumResultsForSearch: -1 });
								$H.find('input.datepicker').each(function(){
									$(this).jeDate({
										format:"YYYY-MM-DD",
										isTime:true,
									});
								})
								$H.find('i').remove();
								//console.log($H);
								$item_div.after($H);
								$item_div = $item_div.next('div[name=select_time]');
								$item_div.append('<span style="">&nbsp;</span><i class="ctrl del" style="margin-top: 6px;margin-left: 6px;" onclick="_delTimeSet(this);"></i>');
								switch (timeset_data.Set[i].TimeSetType) {
									case 11:
										var time_all_str = "周期 每天" + "  " + timeset_data.Set[i].StartTime + "- " + timeset_data.Set[i].EndTime;
										$item_div.find('select[name=TimeType]').val(1).trigger('change');
										$item_div.find('select[name=TimeSetType]').val(1).trigger('change');
										var StartTime_str_array = timeset_data.Set[i].StartTime.split(':');
										var EndTime_str_array = timeset_data.Set[i].EndTime.split(':');
										$item_div.find('input[name=s_h]').val(StartTime_str_array[0]);
										$item_div.find('input[name=s_m]').val(StartTime_str_array[1]);
										$item_div.find('input[name=s_s]').val(StartTime_str_array[2]);
										$item_div.find('input[name=e_h]').val(EndTime_str_array[0]);
										$item_div.find('input[name=e_m]').val(EndTime_str_array[1]);
										$item_div.find('input[name=e_s]').val(EndTime_str_array[2]);
										break;
									case 12:
										switch (timeset_data.Set[i].StartPeriod) {
											case 1:
												var StartPeriod_str = "周一";
												break;
											case 2:
												var StartPeriod_str = "周二";
												break;
											case 3:
												var StartPeriod_str = "周三";
												break;
											case 4:
												var StartPeriod_str = "周四";
												break;
											case 5:
												var StartPeriod_str = "周五";
												break;
											case 6:
												var StartPeriod_str = "周六";
												break;
											case 7:
												var StartPeriod_str = "周日";
												break;
										}
										switch (timeset_data.Set[i].EndPeriod) {
											case 1:
												var EndPeriod_str = "周一";
												break;
											case 2:
												var EndPeriod_str = "周二";
												break;
											case 3:
												var EndPeriod_str = "周三";
												break;
											case 4:
												var EndPeriod_str = "周四";
												break;
											case 5:
												var EndPeriod_str = "周五";
												break;
											case 6:
												var EndPeriod_str = "周六";
												break;
											case 7:
												var EndPeriod_str = "周日";
												break;
										}
										var time_all_str = "周期 每周" + "  " + StartPeriod_str + timeset_data.Set[i].StartTime + "- " + EndPeriod_str + timeset_data.Set[i].EndTime;
										var StartTime_str_array = timeset_data.Set[i].StartTime.split(':');
										var EndTime_str_array = timeset_data.Set[i].EndTime.split(':');
										$item_div.find('select[name=TimeType]').val(1).trigger('change');
										$item_div.find('select[name=TimeSetType]').val(2).trigger('change');
										$item_div.find('select[name=StartPeriod]').val(timeset_data.Set[i].StartPeriod).trigger('change');
										$item_div.find('input[name=s_h]').val(StartTime_str_array[0]);
										$item_div.find('input[name=s_m]').val(StartTime_str_array[1]);
										$item_div.find('input[name=s_s]').val(StartTime_str_array[2]);
										$item_div.find('select[name=EndPeriod]').val(timeset_data.Set[i].EndPeriod).trigger('change');
										$item_div.find('input[name=e_h]').val(EndTime_str_array[0]);
										$item_div.find('input[name=e_m]').val(EndTime_str_array[1]);
										$item_div.find('input[name=e_s]').val(EndTime_str_array[2]);
										break;
									case 13:
										var time_all_str = "周期 每月" + "  " + ('0' + timeset_data.Set[i].StartPeriod).slice(-2) + "日 " + timeset_data.Set[i].StartTime + "- " + ('0' + timeset_data.Set[i].EndPeriod).slice(-2) + "日 " + timeset_data.Set[i].EndTime;
										var StartTime_str_array = timeset_data.Set[i].StartTime.split(':');
										var EndTime_str_array = timeset_data.Set[i].EndTime.split(':');
										$item_div.find('select[name=TimeType]').val(1).trigger('change');
										$item_div.find('select[name=TimeSetType]').val(3).trigger('change');
										$item_div.find('input[name=s_month]').val(('0' + timeset_data.Set[i].StartPeriod).slice(-2));
										$item_div.find('input[name=s_h]').val(StartTime_str_array[0]);
										$item_div.find('input[name=s_m]').val(StartTime_str_array[1]);
										$item_div.find('input[name=s_s]').val(StartTime_str_array[2]);
										$item_div.find('input[name=e_month]').val(('0' + timeset_data.Set[i].EndPeriod).slice(-2));
										$item_div.find('input[name=e_h]').val(EndTime_str_array[0]);
										$item_div.find('input[name=e_m]').val(EndTime_str_array[1]);
										$item_div.find('input[name=e_s]').val(EndTime_str_array[2]);
										break;
									case 20:
										var time_all_str = "区间     " + "  " + timeset_data.Set[i].StartDate.split('T')[0] + " " + timeset_data.Set[i].StartTime + "- " + timeset_data.Set[i].EndDate.split('T')[0] + " " + timeset_data.Set[i].EndTime;
										var StartTime_str_array = timeset_data.Set[i].StartTime.split(':');
										var EndTime_str_array = timeset_data.Set[i].EndTime.split(':');
										$item_div.find('select[name=TimeType]').val(2).trigger('change');
										$item_div.find('input[name=StartDate]').val(timeset_data.Set[i].StartDate.split('T')[0]);
										$item_div.find('input[name=s_h]').val(StartTime_str_array[0]);
										$item_div.find('input[name=s_m]').val(StartTime_str_array[1]);
										$item_div.find('input[name=s_s]').val(StartTime_str_array[2]);
										$item_div.find('input[name=EndDate]').val(timeset_data.Set[i].EndDate.split('T')[0]);
										$item_div.find('input[name=e_h]').val(EndTime_str_array[0]);
										$item_div.find('input[name=e_m]').val(EndTime_str_array[1]);
										$item_div.find('input[name=e_s]').val(EndTime_str_array[2]);
										break;
									case 31:
										var time_all_str = "任务 当前" + "  " + "- " + timeset_data.Set[i].EndTime;
										var EndTime_str_array = timeset_data.Set[i].EndTime.split(':');
										$item_div.find('select[name=TimeType]').val(3).trigger('change');
										$item_div.find('select[name=TimeSetType_t]').val(1).trigger('change');
										$item_div.find('input[name=e_h]').val(EndTime_str_array[0]);
										$item_div.find('input[name=e_m]').val(EndTime_str_array[1]);
										$item_div.find('input[name=e_s]').val(EndTime_str_array[2]);
										break;
									case 32:
										var time_all_str = "任务 当天" + "  " + timeset_data.Set[i].StartTime + "- " + timeset_data.Set[i].EndTime;
										var StartTime_str_array = timeset_data.Set[i].StartTime.split(':');
										var EndTime_str_array = timeset_data.Set[i].EndTime.split(':');
										$item_div.find('select[name=TimeType]').val(3).trigger('change');
										$item_div.find('select[name=TimeSetType_t]').val(2).trigger('change');
										$item_div.find('input[name=s_h]').val(StartTime_str_array[0]);
										$item_div.find('input[name=s_m]').val(StartTime_str_array[1]);
										$item_div.find('input[name=s_s]').val(StartTime_str_array[2]);
										$item_div.find('input[name=e_h]').val(EndTime_str_array[0]);
										$item_div.find('input[name=e_m]').val(EndTime_str_array[1]);
										$item_div.find('input[name=e_s]').val(EndTime_str_array[2]);
										break;
								}
								$item_div.attr('value', time_all_str);
							}
							var $item_div = $('#time_all').find('div[name=select_time]').eq(0);
							switch (timeset_data.Set[i].TimeSetType) {
								case 11:
									var time_all_str = "周期 每天" + "  " + timeset_data.Set[i].StartTime + "- " + timeset_data.Set[i].EndTime;
									$item_div.find('select[name=TimeType]').val(1).trigger('change');
									$item_div.find('select[name=TimeSetType]').val(1).trigger('change');
									var StartTime_str_array = timeset_data.Set[i].StartTime.split(':');
									var EndTime_str_array = timeset_data.Set[i].EndTime.split(':');
									$item_div.find('input[name=s_h]').val(StartTime_str_array[0]);
									$item_div.find('input[name=s_m]').val(StartTime_str_array[1]);
									$item_div.find('input[name=s_s]').val(StartTime_str_array[2]);
									$item_div.find('input[name=e_h]').val(EndTime_str_array[0]);
									$item_div.find('input[name=e_m]').val(EndTime_str_array[1]);
									$item_div.find('input[name=e_s]').val(EndTime_str_array[2]);
									break;
								case 12:
									switch (timeset_data.Set[i].StartPeriod) {
										case 1:
											var StartPeriod_str = "周一";
											break;
										case 2:
											var StartPeriod_str = "周二";
											break;
										case 3:
											var StartPeriod_str = "周三";
											break;
										case 4:
											var StartPeriod_str = "周四";
											break;
										case 5:
											var StartPeriod_str = "周五";
											break;
										case 6:
											var StartPeriod_str = "周六";
											break;
										case 7:
											var StartPeriod_str = "周日";
											break;
									}
									switch (timeset_data.Set[i].EndPeriod) {
										case 1:
											var EndPeriod_str = "周一";
											break;
										case 2:
											var EndPeriod_str = "周二";
											break;
										case 3:
											var EndPeriod_str = "周三";
											break;
										case 4:
											var EndPeriod_str = "周四";
											break;
										case 5:
											var EndPeriod_str = "周五";
											break;
										case 6:
											var EndPeriod_str = "周六";
											break;
										case 7:
											var EndPeriod_str = "周日";
											break;
									}
									var time_all_str = "周期 每周" + "  " + StartPeriod_str + timeset_data.Set[i].StartTime + "- " + EndPeriod_str + timeset_data.Set[i].EndTime;
									var StartTime_str_array = timeset_data.Set[i].StartTime.split(':');
									var EndTime_str_array = timeset_data.Set[i].EndTime.split(':');
									$item_div.find('select[name=TimeType]').val(1).trigger('change');
									$item_div.find('select[name=TimeSetType]').val(2).trigger('change');
									$item_div.find('select[name=StartPeriod]').val(timeset_data.Set[i].StartPeriod).trigger('change');
									$item_div.find('input[name=s_h]').val(StartTime_str_array[0]);
									$item_div.find('input[name=s_m]').val(StartTime_str_array[1]);
									$item_div.find('input[name=s_s]').val(StartTime_str_array[2]);
									$item_div.find('select[name=EndPeriod]').val(timeset_data.Set[i].EndPeriod).trigger('change');
									$item_div.find('input[name=e_h]').val(EndTime_str_array[0]);
									$item_div.find('input[name=e_m]').val(EndTime_str_array[1]);
									$item_div.find('input[name=e_s]').val(EndTime_str_array[2]);
									break;
								case 13:
									var time_all_str = "周期 每月" + "  " + ('0' + timeset_data.Set[i].StartPeriod).slice(-2) + "日 " + timeset_data.Set[i].StartTime + "- " + ('0' + timeset_data.Set[i].EndPeriod).slice(-2) + "日 " + timeset_data.Set[i].EndTime;
									var StartTime_str_array = timeset_data.Set[i].StartTime.split(':');
									var EndTime_str_array = timeset_data.Set[i].EndTime.split(':');
									$item_div.find('select[name=TimeType]').val(1).trigger('change');
									$item_div.find('select[name=TimeSetType]').val(3).trigger('change');
									$item_div.find('input[name=s_month]').val(('0' + timeset_data.Set[i].StartPeriod).slice(-2));
									$item_div.find('input[name=s_h]').val(StartTime_str_array[0]);
									$item_div.find('input[name=s_m]').val(StartTime_str_array[1]);
									$item_div.find('input[name=s_s]').val(StartTime_str_array[2]);
									$item_div.find('input[name=e_month]').val(('0' + timeset_data.Set[i].EndPeriod).slice(-2));
									$item_div.find('input[name=e_h]').val(EndTime_str_array[0]);
									$item_div.find('input[name=e_m]').val(EndTime_str_array[1]);
									$item_div.find('input[name=e_s]').val(EndTime_str_array[2]);
									break;
								case 20:
									var time_all_str = "区间     " + "  " + timeset_data.Set[i].StartDate.split('T')[0] + " " + timeset_data.Set[i].StartTime + "- " + timeset_data.Set[i].EndDate.split('T')[0] + " " + timeset_data.Set[i].EndTime;
									var StartTime_str_array = timeset_data.Set[i].StartTime.split(':');
									var EndTime_str_array = timeset_data.Set[i].EndTime.split(':');
									$item_div.find('select[name=TimeType]').val(2).trigger('change');
									$item_div.find('input[name=StartDate]').val(timeset_data.Set[i].StartDate.split('T')[0]);
									$item_div.find('input[name=s_h]').val(StartTime_str_array[0]);
									$item_div.find('input[name=s_m]').val(StartTime_str_array[1]);
									$item_div.find('input[name=s_s]').val(StartTime_str_array[2]);
									$item_div.find('input[name=EndDate]').val(timeset_data.Set[i].EndDate.split('T')[0]);
									$item_div.find('input[name=e_h]').val(EndTime_str_array[0]);
									$item_div.find('input[name=e_m]').val(EndTime_str_array[1]);
									$item_div.find('input[name=e_s]').val(EndTime_str_array[2]);
									break;
								case 31:
									var time_all_str = "任务 当前" + "  " + "- " + timeset_data.Set[i].EndTime;
									var EndTime_str_array = timeset_data.Set[i].EndTime.split(':');
									$item_div.find('select[name=TimeType]').val(3).trigger('change');
									$item_div.find('select[name=TimeSetType_t]').val(1).trigger('change');
									$item_div.find('input[name=e_h]').val(EndTime_str_array[0]);
									$item_div.find('input[name=e_m]').val(EndTime_str_array[1]);
									$item_div.find('input[name=e_s]').val('00');
									break;
								case 32:
									var time_all_str = "任务 当天" + "  " + timeset_data.Set[i].StartTime + "- " + timeset_data.Set[i].EndTime;
									var StartTime_str_array = timeset_data.Set[i].StartTime.split(':');
									var EndTime_str_array = timeset_data.Set[i].EndTime.split(':');
									$item_div.find('select[name=TimeType]').val(3).trigger('change');
									$item_div.find('select[name=TimeSetType_t]').val(2).trigger('change');
									$item_div.find('input[name=s_h]').val(StartTime_str_array[0]);
									$item_div.find('input[name=s_m]').val(StartTime_str_array[1]);
									$item_div.find('input[name=s_s]').val(StartTime_str_array[2]);
									$item_div.find('input[name=e_h]').val(EndTime_str_array[0]);
									$item_div.find('input[name=e_m]').val(EndTime_str_array[1]);
									$item_div.find('input[name=e_s]').val(EndTime_str_array[2]);
									break;
							}
							$item_div.attr('value', time_all_str);
						} else {
							_alert(1, '时间集合', timeset_ErrMsg);
							return false;
						}
					}
				});
			}
		});
		//检查格式
		function dataCheck(obj, min, max) {//min can not bigger than 1
			obj.value = obj.value.replace(/\D/g, "");
			if (min) {
				if (parseInt(obj.value, 10) < parseInt(min, 10)) obj.value = min;
			}
			if (max) {
				if (parseInt(obj.value, 10) > parseInt(max, 10)) obj.value = max;
			}
		}
		//添加零
		function add_zero(obj) {
			obj.value = obj.value.replace(/\D/g, "");
			var v = obj.value.trim();
			v = ('00' + v).slice(-2);
			obj.value = v;
		}
		//删除设置
		function _delTimeSet(obj) {
			var $c = $(obj).parent();
			$c.fadeOut(function () {
				$c.remove();
			});
		}
		//加入设置
		function _addTimeSet(obj) {
			var $item_div = $(obj).parent();
			var $H = $item_div.clone();
			var timetype_value = $item_div.find("select[name=TimeType]").val();
			switch (timetype_value) {
				case "1":
					var timesettype_value = $item_div.find("select[name=TimeSetType]").val();
					switch (timesettype_value) {
						case "1":
							var TimeSetType_str = "周期 每天";
							var TimeSetType_id = "11";
							var StartDate_str = null;
							var EndDate_str = null;
							var StartPeriod_str = null;
							var EndPeriod_str = null;
							var StartTime_str = "";
							$(">input.timeinput", $item_div.find("span[name=StartTime]")).each(function () {
								StartTime_str = StartTime_str + $(this).val() + ":";
							});
							StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
							var EndTime_str = "";
							$(">input.timeinput", $item_div.find("span[name=EndTime]")).each(function () {
								EndTime_str = EndTime_str + $(this).val() + ":";
							});
							EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
							break;
						case "2":
							var TimeSetType_str = "周期 每周";
							var TimeSetType_id = "12";
							var StartDate_str = null;
							var EndDate_str = null;
							var StartPeriod_str = $item_div.find("select[name=StartPeriod]").val();
							var EndPeriod_str = $item_div.find("select[name=EndPeriod]").val();
							var StartTime_str = "";
							$(">input.timeinput", $item_div.find("span[name=StartTime]")).each(function () {
								StartTime_str = StartTime_str + $(this).val() + ":";
							});
							StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
							var EndTime_str = "";
							$(">input.timeinput", $item_div.find("span[name=EndTime]")).each(function () {
								EndTime_str = EndTime_str + $(this).val() + ":";
							});
							EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
							break;
						case "3":
							var TimeSetType_str = "周期 每月";
							var TimeSetType_id = "13";
							var StartDate_str = null;
							var EndDate_str = null;
							var StartPeriod_str = $item_div.find("span[name=StartPeriod_month]").children("input").val();
							var EndPeriod_str = $item_div.find("span[name=EndPeriod_month]").children("input").val();;
							var StartTime_str = "";
							$(">input.timeinput", $item_div.find("span[name=StartTime]")).each(function () {
								StartTime_str = StartTime_str + $(this).val() + ":";
							});
							StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
							var EndTime_str = "";
							$(">input.timeinput", $item_div.find("span[name=EndTime]")).each(function () {
								EndTime_str = EndTime_str + $(this).val() + ":";
							});
							EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
							break;
					}
					break;
				case "2":
					var TimeSetType_str = "区间     "
					var TimeSetType_id = "20"
					var StartDate_str = $item_div.find("input[name=StartDate]").val();
					var EndDate_str = $item_div.find("input[name=EndDate]").val();
					var StartPeriod_str = null;
					var EndPeriod_str = null;
					var StartTime_str = "";
					$(">input.timeinput", $item_div.find("span[name=StartTime]")).each(function () {
						StartTime_str = StartTime_str + $(this).val() + ":";
					});
					StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
					var EndTime_str = "";
					$(">input.timeinput", $item_div.find("span[name=EndTime]")).each(function () {
						EndTime_str = EndTime_str + $(this).val() + ":";
					});
					EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
					break;
				case "3":
					var timesettype_t_value = $item_div.find("select[name=TimeSetType_t]").val();
					switch (timesettype_t_value) {
						case "1":
							var TimeSetType_str = "任务 当前";
							var TimeSetType_id = "31";
							var StartDate_str = null;
							var EndDate_str = null;
							var StartPeriod_str = null;
							var EndPeriod_str = null;
							var StartTime_str = null;
							var EndTime_str = "";
							$(">input.timeinput", $item_div.find("span[name=EndTime_today]")).each(function () {
								EndTime_str = EndTime_str + $(this).val() + ":";
							});
							EndTime_str = EndTime_str + '00';
							break;
						case "2":
							var TimeSetType_str = "任务 当天";
							var TimeSetType_id = "32";
							var StartDate_str = null;
							var EndDate_str = null;
							var StartPeriod_str = null;
							var EndPeriod_str = null;
							var StartTime_str = null;
							var StartTime_str = "";
							$(">input.timeinput", $item_div.find("span[name=StartTime]")).each(function () {
								StartTime_str = StartTime_str + $(this).val() + ":";
							});
							StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
							var EndTime_str = "";
							$(">input.timeinput", $item_div.find("span[name=EndTime]")).each(function () {
								EndTime_str = EndTime_str + $(this).val() + ":";
							});
							EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
							break;
					}
					break;
			}
			if (StartDate_str > EndDate_str) {
				_alert(2, "时间集合", "起始日期要在结束日期之前");
				return false;
			} else if (StartDate_str == EndDate_str) {
				var Start = StartPeriod_str + StartTime_str;
				var End = EndPeriod_str + EndTime_str;
				if ((Start) >= (End)) {
					_alert(2, "时间集合", "开始时间必须小于结束时间");
					return false;
				}
			}
			switch (TimeSetType_id) {
				case "11":
					var time_all_str = TimeSetType_str + "  " + StartTime_str + "- " + EndTime_str;
					break;
				case "12":
					var time_all_str = TimeSetType_str + "  " + $item_div.find("select[name=StartPeriod]").children("option:selected").text() + StartTime_str + "- " + $item_div.find("select[name=EndPeriod]").children("option:selected").text() + EndTime_str;
					break;
				case "13":
					var time_all_str = TimeSetType_str + "  " + StartPeriod_str + "日 " + StartTime_str + "- " + EndPeriod_str + "日 " + EndTime_str;
					break;
				case "20":
					var time_all_str = TimeSetType_str + "  " + StartDate_str + " " + StartTime_str + "- " + EndDate_str + " " + EndTime_str;
					break;
				case "31":
					var time_all_str = TimeSetType_str + "  " + "- " + EndTime_str;
					break;
				case "32":
					var time_all_str = TimeSetType_str + "  " + StartTime_str + "- " + EndTime_str;
					break;
			}
			var pass = 1;
			var $all = $('#time_all').find('div');
			var len = $all.length;
			for (i = 1; i < len; i++) {
				var input = $all.eq(i).attr('value');
				if (input == time_all_str) {
					_alert(2, '时间集合', '时间范围重复');
					pass = 0;
					return false;
				}
			}
			if (pass == 1) {
				$H.attr('style', 'padding-top: 5px;width:100%;');
				$H.find('.select2').remove();
				$('.filter-select,.form-select', $H).select2({ minimumResultsForSearch: -1 });
				$H.find('input.datepicker').each(function(){
					$(this).jeDate({
						format:"YYYY-MM-DD",
						isTime:true,
					});
				})
				$H.find('i').remove();
				$(obj).parent().after($H);
				$item_div = $(obj).parent().next('div[name=select_time]');
				$item_div.append('<span style="">&nbsp;</span><i class="ctrl del" style="margin-top: 6px;margin-left: 6px;" onclick="_delTimeSet(this);"></i>');
				//console.log(TimeSetType_id);
				switch (TimeSetType_id) {
					case "11":
						$item_div.find('select[name=TimeType]').val(1).trigger('change');
						$item_div.find('select[name=TimeSetType]').val(1).trigger('change');
						break;
					case "12":
						$item_div.find('select[name=TimeType]').val(1).trigger('change');
						$item_div.find('select[name=TimeSetType]').val(2).trigger('change');
						$item_div.find('select[name=StartPeriod]').val($(obj).parent().find('select[name=StartPeriod]').val()).trigger('change');
						$item_div.find('select[name=EndPeriod]').val($(obj).parent().find('select[name=EndPeriod]').val()).trigger('change');
						break;
					case "13":
						$item_div.find('select[name=TimeType]').val(1).trigger('change');
						$item_div.find('select[name=TimeSetType]').val(3).trigger('change');
						break;
					case "20":
						$item_div.find('select[name=TimeType]').val(2).trigger('change');
						break;
					case "31":
						$item_div.find('select[name=TimeType]').val(3).trigger('change');
						$item_div.find('select[name=TimeSetType_t]').val(1).trigger('change');
						break;
					case "32":
						$item_div.find('select[name=TimeType]').val(3).trigger('change');
						$item_div.find('select[name=TimeSetType_t]').val(2).trigger('change');
						break;
				}
				$item_div.attr('value', time_all_str);
				var $item_div = $(obj).parent();
				$item_div.find('select[name=TimeSetType_t]').val(1).trigger('change');
				$item_div.find('select[name=TimeType]').val(1).trigger('change');
				$item_div.find('select[name=StartPeriod]').val(1).trigger('change');
				$item_div.find('input[name=s_month]').val('01');
				var now = new Date();
				var year = now.getFullYear();
				var month = ("0" + (now.getMonth() + 1)).slice(-2);
				var date = ("0" + now.getDate()).slice(-2);
				$item_div.find('input[name=StartDate]').val(year + "-" + month + "-" + date);
				$item_div.find('input[name=s_h]').val('00');
				$item_div.find('input[name=s_m]').val('00');
				$item_div.find('input[name=s_s]').val('00');
				$item_div.find('select[name=EndPeriod]').val(7).trigger('change');
				$item_div.find('input[name=e_month]').val('31');
				$item_div.find('input[name=EndDate]').val(year + "-" + month + "-" + date);
				$item_div.find('input[name=e_h]').val('23');
				$item_div.find('input[name=e_m]').val('59');
				$item_div.find('input[name=e_s]').val('59');
				$item_div.attr('value', '周期 每天  00:00:00- 23:59:59');
			}

		}
		//创建
		function timeset_add() {
			var val = $("#d_n").val();
			var $i = $("#d_n").next('i.v-check');
			if (val == "") {
				_alert(2, "时间集合", '请输入名称', $("#d_n"));
				//$("#d_n").val("");
				return false;
			}
			if (!nameReg.test(val)) {
				_alert(1, "时间集合", '名称格式不正确', $("#d_n"));
				//$("#d_n").val("");
				return false;
			}
			var timesetId = document.frm_timeset_add.timesetId.value;
			timeset.TimeSetId = timesetId;
			timeset.Name = val;
			var Description = $("#Description").val().trim();
			if (Description == "") {
				Description = null;
			};
			timeset.Description = Description;
			timeset.Set = new Array();
			var i = 1;
			var $all = $('#time_all').find('div.item');
			var len = $all.length;
			for (var j = len - 1; j >= 0; j--) {
				var $item = $all.eq(j);
				var item_value = $item.attr('value');
				//console.log(item_value + ':' + j);
				//console.log('---------------');
				for (var m = j - 1; m >= 0; m--) {
					var $item_2 = $all.eq(m);
					var item_value_two = $item_2.attr('value');
					//console.log(item_value_two + ':' + m);
					if (item_value == item_value_two) {
						_alert(2, '时间集合', '时间范围重复');
						return false;
					}
					//console.log('11-11');
				}
				var timetype_value = $item.find("select[name=TimeType]").val();
				switch (timetype_value) {
					case "1":
						var timesettype_value = $item.find("select[name=TimeSetType]").val();
						switch (timesettype_value) {
							case "1":
								var TimeSetType_str = "周期 每天";
								var TimeSetType_id = "11";
								var StartDate_str = null;
								var EndDate_str = null;
								var StartPeriod_str = null;
								var EndPeriod_str = null;
								var StartTime_str = "";
								$(">input.timeinput", $item.find("span[name=StartTime]")).each(function () {
									StartTime_str = StartTime_str + $(this).val() + ":";
								});
								StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
								StartTime_str = '"' + StartTime_str + '"';
								var EndTime_str = "";
								$(">input.timeinput", $item.find("span[name=EndTime]")).each(function () {
									EndTime_str = EndTime_str + $(this).val() + ":";
								});
								EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
								EndTime_str = '"' + EndTime_str + '"';
								break;
							case "2":
								var TimeSetType_str = "周期 每周";
								var TimeSetType_id = "12";
								var StartDate_str = null;
								var EndDate_str = null;
								var StartPeriod_str = '"' + $item.find("select[name=StartPeriod]").val() + '"';
								var EndPeriod_str = '"' + $item.find("select[name=EndPeriod]").val() + '"';
								var StartTime_str = "";
								$(">input.timeinput", $item.find("span[name=StartTime]")).each(function () {
									StartTime_str = StartTime_str + $(this).val() + ":";
								});
								StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
								StartTime_str = '"' + StartTime_str + '"';
								var EndTime_str = "";
								$(">input.timeinput", $item.find("span[name=EndTime]")).each(function () {
									EndTime_str = EndTime_str + $(this).val() + ":";
								});
								EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
								EndTime_str = '"' + EndTime_str + '"';
								break;
							case "3":
								var TimeSetType_str = "周期 每月";
								var TimeSetType_id = "13";
								var StartDate_str = null;
								var EndDate_str = null;
								var StartPeriod_str = '"' + $item.find("span[name=StartPeriod_month]").children("input").val() + '"';
								var EndPeriod_str = '"' + $item.find("span[name=EndPeriod_month]").children("input").val() + '"';
								var StartTime_str = "";
								$(">input.timeinput", $item.find("span[name=StartTime]")).each(function () {
									StartTime_str = StartTime_str + $(this).val() + ":";
								});
								StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
								StartTime_str = '"' + StartTime_str + '"';
								var EndTime_str = "";
								$(">input.timeinput", $item.find("span[name=EndTime]")).each(function () {
									EndTime_str = EndTime_str + $(this).val() + ":";
								});
								EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
								EndTime_str = '"' + EndTime_str + '"';
								break;
						}
						break;
					case "2":
						var TimeSetType_str = "区间     "
						var TimeSetType_id = "20"
						var StartDate_str = '"' + $item.find("input[name=StartDate]").val() + '"';
						var EndDate_str = '"' + $item.find("input[name=EndDate]").val() + '"';
						var StartPeriod_str = null;
						var EndPeriod_str = null;
						var StartTime_str = "";
						$(">input.timeinput", $item.find("span[name=StartTime]")).each(function () {
							StartTime_str = StartTime_str + $(this).val() + ":";
						});
						StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
						StartTime_str = '"' + StartTime_str + '"';
						var EndTime_str = "";
						$(">input.timeinput", $item.find("span[name=EndTime]")).each(function () {
							EndTime_str = EndTime_str + $(this).val() + ":";
						});
						EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
						EndTime_str = '"' + EndTime_str + '"';
						break;
					case "3":
						var timesettype_t_value = $item.find("select[name=TimeSetType_t]").val();
						switch (timesettype_t_value) {
							case "1":
								var TimeSetType_str = "任务 当前";
								var TimeSetType_id = "31";
								var StartDate_str = null;
								var EndDate_str = null;
								var StartPeriod_str = null;
								var EndPeriod_str = null;
								var StartTime_str = null;
								var EndTime_str = "";
								$(">input.timeinput", $item.find("span[name=EndTime]")).each(function () {
									EndTime_str = EndTime_str + $(this).val() + ":";
								});
								EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
								EndTime_str = '"' + EndTime_str + '"';
								break;
							case "2":
								var TimeSetType_str = "任务 当天";
								var TimeSetType_id = "32";
								var StartDate_str = null;
								var EndDate_str = null;
								var StartPeriod_str = null;
								var EndPeriod_str = null;
								var StartTime_str = "";
								$(">input.timeinput", $item.find("span[name=StartTime]")).each(function () {
									StartTime_str = StartTime_str + $(this).val() + ":";
								});
								StartTime_str = StartTime_str.substr(0, StartTime_str.length - 1);
								StartTime_str = '"' + StartTime_str + '"';
								var EndTime_str = "";
								$(">input.timeinput", $item.find("span[name=EndTime]")).each(function () {
									EndTime_str = EndTime_str + $(this).val() + ":";
								});
								EndTime_str = EndTime_str.substr(0, EndTime_str.length - 1);
								EndTime_str = '"' + EndTime_str + '"';
								break;
						}
						break;
				}
				if (StartDate_str > EndDate_str) {
					_alert(2, "时间集合", "起始日期要在结束日期之前");
					return false;
				} else if (StartDate_str == EndDate_str) {
					var Start = StartPeriod_str + StartTime_str;
					var End = EndPeriod_str + EndTime_str;
					if ((Start) >= (End)) {
						_alert(2, "时间集合", "开始时间必须小于结束时间");
						return false;
					}
				}
				//console.log(TimeSetType_id);
				var json_a = '{"TimeSetMemberId":' + TimeSetType_id + ',"Order":' + i + ',"TimeSetType":' + TimeSetType_id + ',"StartDate":' + StartDate_str + ',"EndDate":' + EndDate_str + ',"StartTime":' + StartTime_str + ',"EndTime":' + EndTime_str + ',"StartPeriod":' + StartPeriod_str + ',"EndPeriod":' + EndPeriod_str + '}';
				//console.log(json_a);
				timeset.Set.push(JSON.parse(json_a));
				i++;
			}
			if (i == 1) {
				_alert(2, "时间集合", "请添加时间范围");
				return false;
			}
			msstr = aceg(JSON.stringify(timeset),$("input[name=se]").val());
			$.ajax({
				url: '/bhost/add_timeset',
				type: "POST",
				async: false,
				data: { a0: $("input[name=se]").val(), a1: JSON.stringify(timeset), m1:msstr},
				success: function (result) {
					var result = JSON.parse(result);
					if (result.Result == true) {
						$('.btn').blur(); parent.layer.open({
							type: 1,
							title: '时间集合',
							content: '<div class="layer-alert"><i class="alert succ"></i>保存成功</div>',
							btn: ['确&nbsp;&nbsp;定'],
							btnAlign: 'c',
							closeBtn: false,
							skin: 'layer-custom',
							area: ['380px', '310px'],
							move: false,
							resize: false,
							yes: function (i) {
								parent.layer.close(i);
								timeset_list(1, result.TimeSetId);
							}
						});
					} else {
						_alert(1, "时间集合", result.ErrMsg, $("#d_n"));
						return false;
					}
				}
			});

		}
		//显示列表页面
		function timeset_list(num, id) {
			if (num == 1) {
				$.ajax({
					url: '/bhost/PGetRecordRownum',
					type: "POST",
					async: false,
					data: { a0: $("input[name=se]").val(), a1: id, a2: 25 },
					success: function (result) {
						var result = JSON.parse(result);
						if (result.Result == true) {
							if (result.info % MAX_PAGE == 0) {
								document.frm_timeset_add.paging.value = parseInt(result.info / MAX_PAGE);
							} else {
								document.frm_timeset_add.paging.value = parseInt(result.info / MAX_PAGE) + 1;
							}
						}
					}
				});
				document.frm_timeset_add.search_typeall.value = '';
				document.frm_timeset_add.e.value = ':';
			}
			document.frm_timeset_add.tasktype.value = 3;
			document.frm_timeset_add.action = '/bhost/timeset_handle'
			document.frm_timeset_add.submit();
		}
		$(function () {
			$("#time_group").on("click", function () {
				location.reload();
			});
		});
	</script>
</body>

</html>
